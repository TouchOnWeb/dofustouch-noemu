!function(e) {
    function t(n) {
        if (i[n])
            return i[n].exports;
        var o = i[n] = {
            exports: {},
            id: n,
            loaded: !1
        };
        return e[n].call(o.exports, o, o.exports, t),
        o.loaded = !0,
        o.exports
    }
    var i = {};
    return t.m = e,
    t.c = i,
    t.p = "",
    t(0)
}([function(e, t, i) {
    function n(e) {
        return window.wizAssets && window.wizAssets.initialize ? void window.wizAssets.initialize(e, function() {
            console.error("failed to init wizAssets"),
            window.wizAssets = null ,
            e()
        }) : e()
    }
    function o() {
        if (c.isWebGlSupported()) {
            var e = i(1012);
            window.isoEngine = new e,
            window.actorManager = window.isoEngine.actorManager,
            window.background = window.isoEngine.background
        }
        window.dofus.start()
    }
    i(1),
    i(2),
    i(3),
    i(4),
    window.developmentMode = !1,
    window.assetPreloader = i(5),
    window.dofus = i(11);
    var s = document.createElement("div");
    s.id = "dofusBody",
    document.body.appendChild(s);
    var a = i(183)
      , r = i(294);
    window.gui = new r,
    window.foreground = new a;
    var l = i(7)
      , c = i(267)
      , u = window.chrome;
    "object" == typeof u && u.system && u.system.memory && l.isPhoneGap ? u.system.memory.getInfo(function(e) {
        l.capacity = e.capacity,
        n(o)
    }) : n(o)
}
, function(e, t) {}
, function(e, t) {}
, function(e, t) {
    !function(e) {
        "use strict";
        function t(e) {
            if ("string" != typeof e && (e = String(e)),
            /[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))
                throw new TypeError("Invalid character in header field name");
            return e.toLowerCase()
        }
        function i(e) {
            return "string" != typeof e && (e = String(e)),
            e
        }
        function n(e) {
            var t = {
                next: function() {
                    var t = e.shift();
                    return {
                        done: void 0 === t,
                        value: t
                    }
                }
            };
            return f.iterable && (t[Symbol.iterator] = function() {
                return t
            }
            ),
            t
        }
        function o(e) {
            this.map = {},
            e instanceof o ? e.forEach(function(e, t) {
                this.append(t, e)
            }, this) : e && Object.getOwnPropertyNames(e).forEach(function(t) {
                this.append(t, e[t])
            }, this)
        }
        function s(e) {
            return e.bodyUsed ? Promise.reject(new TypeError("Already read")) : void (e.bodyUsed = !0)
        }
        function a(e) {
            return new Promise(function(t, i) {
                e.onload = function() {
                    t(e.result)
                }
                ,
                e.onerror = function() {
                    i(e.error)
                }
            }
            )
        }
        function r(e) {
            var t = new FileReader;
            return t.readAsArrayBuffer(e),
            a(t)
        }
        function l(e) {
            var t = new FileReader;
            return t.readAsText(e),
            a(t)
        }
        function c() {
            return this.bodyUsed = !1,
            this._initBody = function(e) {
                if (this._bodyInit = e,
                "string" == typeof e)
                    this._bodyText = e;
                else if (f.blob && Blob.prototype.isPrototypeOf(e))
                    this._bodyBlob = e;
                else if (f.formData && FormData.prototype.isPrototypeOf(e))
                    this._bodyFormData = e;
                else if (f.searchParams && URLSearchParams.prototype.isPrototypeOf(e))
                    this._bodyText = e.toString();
                else if (e) {
                    if (!f.arrayBuffer || !ArrayBuffer.prototype.isPrototypeOf(e))
                        throw new Error("unsupported BodyInit type")
                } else
                    this._bodyText = "";
                this.headers.get("content-type") || ("string" == typeof e ? this.headers.set("content-type", "text/plain;charset=UTF-8") : this._bodyBlob && this._bodyBlob.type ? this.headers.set("content-type", this._bodyBlob.type) : f.searchParams && URLSearchParams.prototype.isPrototypeOf(e) && this.headers.set("content-type", "application/x-www-form-urlencoded;charset=UTF-8"))
            }
            ,
            f.blob ? (this.blob = function() {
                var e = s(this);
                if (e)
                    return e;
                if (this._bodyBlob)
                    return Promise.resolve(this._bodyBlob);
                if (this._bodyFormData)
                    throw new Error("could not read FormData body as blob");
                return Promise.resolve(new Blob([this._bodyText]))
            }
            ,
            this.arrayBuffer = function() {
                return this.blob().then(r)
            }
            ,
            this.text = function() {
                var e = s(this);
                if (e)
                    return e;
                if (this._bodyBlob)
                    return l(this._bodyBlob);
                if (this._bodyFormData)
                    throw new Error("could not read FormData body as text");
                return Promise.resolve(this._bodyText)
            }
            ) : this.text = function() {
                var e = s(this);
                return e ? e : Promise.resolve(this._bodyText)
            }
            ,
            f.formData && (this.formData = function() {
                return this.text().then(d)
            }
            ),
            this.json = function() {
                return this.text().then(JSON.parse)
            }
            ,
            this
        }
        function u(e) {
            var t = e.toUpperCase();
            return g.indexOf(t) > -1 ? t : e
        }
        function h(e, t) {
            t = t || {};
            var i = t.body;
            if (h.prototype.isPrototypeOf(e)) {
                if (e.bodyUsed)
                    throw new TypeError("Already read");
                this.url = e.url,
                this.credentials = e.credentials,
                t.headers || (this.headers = new o(e.headers)),
                this.method = e.method,
                this.mode = e.mode,
                i || (i = e._bodyInit,
                e.bodyUsed = !0)
            } else
                this.url = e;
            if (this.credentials = t.credentials || this.credentials || "omit",
            !t.headers && this.headers || (this.headers = new o(t.headers)),
            this.method = u(t.method || this.method || "GET"),
            this.mode = t.mode || this.mode || null ,
            this.referrer = null ,
            ("GET" === this.method || "HEAD" === this.method) && i)
                throw new TypeError("Body not allowed for GET or HEAD requests");
            this._initBody(i)
        }
        function d(e) {
            var t = new FormData;
            return e.trim().split("&").forEach(function(e) {
                if (e) {
                    var i = e.split("=")
                      , n = i.shift().replace(/\+/g, " ")
                      , o = i.join("=").replace(/\+/g, " ");
                    t.append(decodeURIComponent(n), decodeURIComponent(o))
                }
            }),
            t
        }
        function p(e) {
            var t = new o
              , i = (e.getAllResponseHeaders() || "").trim().split("\n");
            return i.forEach(function(e) {
                var i = e.trim().split(":")
                  , n = i.shift().trim()
                  , o = i.join(":").trim();
                t.append(n, o)
            }),
            t
        }
        function m(e, t) {
            t || (t = {}),
            this.type = "default",
            this.status = t.status,
            this.ok = this.status >= 200 && this.status < 300,
            this.statusText = t.statusText,
            this.headers = t.headers instanceof o ? t.headers : new o(t.headers),
            this.url = t.url || "",
            this._initBody(e)
        }
        if (!e.fetch) {
            var f = {
                searchParams: "URLSearchParams"in e,
                iterable: "Symbol"in e && "iterator"in Symbol,
                blob: "FileReader"in e && "Blob"in e && function() {
                    try {
                        return new Blob,
                        !0
                    } catch (e) {
                        return !1
                    }
                }(),
                formData: "FormData"in e,
                arrayBuffer: "ArrayBuffer"in e
            };
            o.prototype.append = function(e, n) {
                e = t(e),
                n = i(n);
                var o = this.map[e];
                o || (o = [],
                this.map[e] = o),
                o.push(n)
            }
            ,
            o.prototype["delete"] = function(e) {
                delete this.map[t(e)]
            }
            ,
            o.prototype.get = function(e) {
                var i = this.map[t(e)];
                return i ? i[0] : null
            }
            ,
            o.prototype.getAll = function(e) {
                return this.map[t(e)] || []
            }
            ,
            o.prototype.has = function(e) {
                return this.map.hasOwnProperty(t(e))
            }
            ,
            o.prototype.set = function(e, n) {
                this.map[t(e)] = [i(n)]
            }
            ,
            o.prototype.forEach = function(e, t) {
                Object.getOwnPropertyNames(this.map).forEach(function(i) {
                    this.map[i].forEach(function(n) {
                        e.call(t, n, i, this)
                    }, this)
                }, this)
            }
            ,
            o.prototype.keys = function() {
                var e = [];
                return this.forEach(function(t, i) {
                    e.push(i)
                }),
                n(e)
            }
            ,
            o.prototype.values = function() {
                var e = [];
                return this.forEach(function(t) {
                    e.push(t)
                }),
                n(e)
            }
            ,
            o.prototype.entries = function() {
                var e = [];
                return this.forEach(function(t, i) {
                    e.push([i, t])
                }),
                n(e)
            }
            ,
            f.iterable && (o.prototype[Symbol.iterator] = o.prototype.entries);
            var g = ["DELETE", "GET", "HEAD", "OPTIONS", "POST", "PUT"];
            h.prototype.clone = function() {
                return new h(this)
            }
            ,
            c.call(h.prototype),
            c.call(m.prototype),
            m.prototype.clone = function() {
                return new m(this._bodyInit,{
                    status: this.status,
                    statusText: this.statusText,
                    headers: new o(this.headers),
                    url: this.url
                })
            }
            ,
            m.error = function() {
                var e = new m(null ,{
                    status: 0,
                    statusText: ""
                });
                return e.type = "error",
                e
            }
            ;
            var _ = [301, 302, 303, 307, 308];
            m.redirect = function(e, t) {
                if (_.indexOf(t) === -1)
                    throw new RangeError("Invalid status code");
                return new m(null ,{
                    status: t,
                    headers: {
                        location: e
                    }
                })
            }
            ,
            e.Headers = o,
            e.Request = h,
            e.Response = m,
            e.fetch = function(e, t) {
                return new Promise(function(i, n) {
                    function o() {
                        return "responseURL"in a ? a.responseURL : /^X-Request-URL:/m.test(a.getAllResponseHeaders()) ? a.getResponseHeader("X-Request-URL") : void 0
                    }
                    var s;
                    s = h.prototype.isPrototypeOf(e) && !t ? e : new h(e,t);
                    var a = new XMLHttpRequest;
                    a.onload = function() {
                        var e = {
                            status: a.status,
                            statusText: a.statusText,
                            headers: p(a),
                            url: o()
                        }
                          , t = "response"in a ? a.response : a.responseText;
                        i(new m(t,e))
                    }
                    ,
                    a.onerror = function() {
                        n(new TypeError("Network request failed"))
                    }
                    ,
                    a.ontimeout = function() {
                        n(new TypeError("Network request failed"))
                    }
                    ,
                    a.open(s.method, s.url, !0),
                    "include" === s.credentials && (a.withCredentials = !0),
                    "responseType"in a && f.blob && (a.responseType = "blob"),
                    s.headers.forEach(function(e, t) {
                        a.setRequestHeader(t, e)
                    }),
                    a.send("undefined" == typeof s._bodyInit ? null : s._bodyInit)
                }
                )
            }
            ,
            e.fetch.polyfill = !0
        }
    }("undefined" != typeof self ? self : this)
}
, function(e, t) {
    "function" != typeof String.prototype.startsWith && (String.prototype.startsWith = function(e, t) {
        return void 0 === t && (t = 0),
        this.slice(t, e.length + t) === e
    }
    ),
    "function" != typeof String.prototype.endsWith && (String.prototype.endsWith = function(e, t) {
        var i = this.toString();
        (void 0 === t || t > i.length) && (t = i.length),
        t -= e.length;
        var n = i.indexOf(e, t);
        return n !== -1 && n === t
    }
    )
}
, function(e, t, i) {
    function n() {
        T = 0
    }
    function o(e) {
        return e.code === A && e.status > 499
    }
    function s(e, t, i, n) {
        this.url = e,
        this.cssFormat = t,
        this.callback = i,
        this.loadBatchIndex = n
    }
    function a(e) {
        return /^\/?ui\//.test(e)
    }
    function r(e) {
        return !(a(e) || !window.wizAssets)
    }
    function l(e) {
        if (I += 1,
        !e)
            return c("emptyPath", e);
        if (a(e))
            return window.wizAssets ? c(null , e, g.CDV_PATH + "/" + e) : c(null , e, window.Config.uiUrl + "/" + e);
        var t = window.Config.assetsUrl + "/" + e;
        if (!window.wizAssets)
            return c(null , e, t);
        var i = y
          , n = function(t) {
            return c(null , e, t)
        }
          , s = function(a) {
            return i -= 1,
            i > 0 && o(a) ? window.wizAssets.downloadFile(t, e, n, s) : c(a, e, null )
        };
        return _[e] ? (console.warn('initiateAssetLoading: known missing asset "' + e + '" will be skip'),
        c(null , e, null )) : window.wizAssets.downloadFile(t, e, n, s)
    }
    function c(e, t, i) {
        e && console.error("notifyAsLoaded: Could not load asset: " + t + " (" + JSON.stringify(e) + ")");
        for (var n = b[t], o = 0; o < n.length; o += 1) {
            var s, a = n[o], r = a.callback, l = a.loadBatchIndex;
            s = i ? a.cssFormat ? 'url("' + i + '")' : i : null ,
            r && r(s, l)
        }
        delete b[t],
        I -= 1,
        u()
    }
    function u() {
        for (; I < v && C.length > 0; ) {
            var e = C.pop();
            l(e)
        }
    }
    function h(e, t, i, n) {
        var o = new s(e,t,i,n);
        b[e] ? b[e].push(o) : (b[e] = [o],
        I < v ? l(e) : C.push(e))
    }
    function d(e, t, i, n) {
        function o(e, t) {
            if (s[t] = e,
            r += 1,
            i && i(e, t),
            r === a)
                return n && n(s)
        }
        var s = []
          , a = e.length;
        if (0 === a)
            return n && n(s);
        for (var r = 0, l = 0; l < e.length; l += 1)
            h(e[l], t, o, l)
    }
    function p(e, t, i, o, s) {
        0 === T && S(n, 0),
        T < w ? (T += 1,
        e(t, i, o, s)) : S(function() {
            p(e, t, i, o, s)
        }, 0)
    }
    function m(e, t, i, n) {
        if (!t)
            return i(g.EMPTY_IMAGE, n);
        var o = window.Config.imgCrossOrigin
          , s = new Image;
        o && (s.crossOrigin = o);
        var a = y;
        s.onload = function() {
            return this.onload = null ,
            this.onerror = null ,
            i(this, n)
        }
        ,
        s.onerror = function() {
            return a -= 1,
            a > 0 ? void (this.src = t) : (this.onload = null ,
            this.onerror = null ,
            r(e) && (console.error("loadAndCreateImage: Image not found: " + t),
            window.wizAssets.deleteFile(e, function() {}, function(e) {
                console.error("loadAndCreateImage: Image could not be deleted: " + t + " with error: " + e)
            })),
            i(g.EMPTY_IMAGE, n))
        }
        ,
        s.src = t
    }
    function f(e, t, i, n) {
        if (!t)
            return i(g.EMPTY_JSON, n);
        var o = y
          , s = new XMLHttpRequest;
        s.onreadystatechange = function() {
            if (4 === ~~s.readyState) {
                if (200 !== ~~s.status && 0 !== ~~s.status)
                    return o -= 1,
                    o > 0 ? (s.open("GET", t, !0),
                    void s.send()) : (a(e) || console.error("loadAndParseJson: Failed to load json " + t + ": " + s.status),
                    i(g.EMPTY_JSON, n));
                var l;
                try {
                    l = JSON.parse(s.response)
                } catch (c) {
                    return r(e) && (console.error("loadAndParseJson: Could not parse json " + t + ": " + c),
                    window.wizAssets.deleteFile(e, function() {}, function(e) {
                        console.error("loadAndParseJson: json could not be deleted: " + t + " with error: " + e)
                    })),
                    i(g.EMPTY_JSON, n)
                }
                return i(l, n)
            }
        }
        ,
        s.open("GET", t, !0),
        s.send()
    }
    var g = i(6)
      , _ = i(10)
      , v = 30
      , y = 3
      , w = 5
      , b = {}
      , C = []
      , I = 0
      , T = 0
      , S = window.setTimeout
      , A = window.WizAssetsError && window.WizAssetsError.HTTP_REQUEST_ERROR;
    t.preloadAsset = h,
    t.preloadAssets = d,
    t.preloadImages = function(e, t) {
        return d(e, !0, null , t)
    }
    ,
    t.preloadImage = function(e, t) {
        return h(e, !0, t)
    }
    ,
    t.preloadImageUrls = function(e, t) {
        return d(e, !1, null , t)
    }
    ,
    t.preloadImageUrl = function(e, t) {
        return h(e, !1, t)
    }
    ,
    t.loadImages = function(e, t, i) {
        function n(e, n) {
            if (o[n] = e,
            s += 1,
            t && t(e, n),
            s === a)
                return i && i(o)
        }
        var o = []
          , s = 0
          , a = e.length;
        return 0 === a ? i && i(o) : void d(e, !1, function(t, i) {
            p(m, e[i], t, n, i)
        }, null )
    }
    ,
    t.loadImage = function(e, t) {
        h(e, !1, function(i) {
            p(m, e, i, t)
        })
    }
    ,
    t.loadJsons = function(e, t, i) {
        d(e, !1, function(i, n) {
            p(f, e[n], i, t, n)
        }, i)
    }
    ,
    t.loadJson = function(e, t) {
        h(e, !1, function(i) {
            p(f, e, i, t)
        })
    }
}
, function(e, t, i) {
    var n = i(7);
    t.MAP_PATH = "maps/",
    t.IMG_PATH = "gfx/world/",
    t.SKIN_PATH = "skins/",
    t.BONE_PATH = "bones/",
    t.ICON_PATH = "gfx/icons/",
    t.ORNAMENT_PATH = "gfx/ornaments/",
    t.EMBEDDED_PATH = "ui/embedded/",
    t.BACKGROUND_PATH = "backgrounds/",
    t.FOREGROUND_PATH = "foregrounds/",
    t.BITMAP_FONTS = "ui/bitmapFonts/",
    t.WORLDMAP_PATH = "gfx/maps/",
    t.LOADER_PATH = "ui/loader/",
    t.MISSING_ANIM_PATH = "bones/missingAnimList.json",
    t.CDV_PATH = "./data/assets",
    t.ITEM_DIR = "/gfx/items/",
    t.MAP_SCENE_WIDTH_IN_CELLS = 14.5,
    t.MAP_SCENE_HEIGHT_IN_CELLS = 20.5,
    t.CELL_WIDTH = 86,
    t.CELL_HEIGHT = 43,
    t.CELL_SIDE = Math.sqrt(2 * t.CELL_HEIGHT * t.CELL_HEIGHT),
    t.NB_CELLS = 560,
    t.HORIZONTAL_OFFSET = 53,
    t.VERTICAL_OFFSET = 15,
    t.WIDTH_PADDING = 20,
    t.HEIGHT_PADDING = -16,
    t.MAP_BORDER_H = 30,
    t.MAP_BORDER_V = 20,
    t.GRID_ALTITUDE_OFFSET = 22,
    t.ICONBAR_CORNER_HEIGHT = 19,
    t.ICONBAR_CORNER_WIDTH = 36,
    t.ICONBAR_TAB_WIDTH = 42,
    t.ICONBAR_TAB_HEIGHT = 35,
    t.SHORTCUT_ICON_SIZE = 50,
    t.MENU_ICON_SIZE = 42,
    t.SHORTCUT_GAUGE_SIZE = 13,
    t.CHAT_BTN_MIN_WIDTH = 68,
    t.CHAT_BTN_MIN_HEIGHT = 50,
    t.PING_EMOTE_BTN_NARROW_MIN_WIDTH = 50,
    t.PING_EMOTE_BTN_WIDE_MIN_HEIGHT = 50,
    t.PING_EMOTE_BTN_WIDE_MIN_WIDTH = 40,
    t.MAP_SCENE_WIDTH = t.CELL_WIDTH * t.MAP_SCENE_WIDTH_IN_CELLS + t.WIDTH_PADDING,
    t.MAP_SCENE_HEIGHT = t.CELL_HEIGHT * t.MAP_SCENE_HEIGHT_IN_CELLS + t.HEIGHT_PADDING,
    t.PIXEL_RATIO = window.devicePixelRatio || 1,
    t.CHARACTER_COLORS = 5,
    t.FPS = 60,
    t.TIME_UNITS_PER_SECOND = 25,
    t.ANIM_SYMETRY = [!1, !1, !1, !0, !0, !1, !1, !0],
    t.ANIM_SYMBOLS = [0, 1, 2, 1, 0, 5, 6, 5],
    t.ANGLE_PER_DIRECTION = [0, Math.PI / 8, Math.PI / 2, Math.PI - Math.PI / 8, Math.PI, Math.PI + Math.PI / 8, -Math.PI / 2, -Math.PI / 8],
    t.MISSING_TEXTURE_IMAGE_SRC = "data:image/gif;base64,R0lGODlhAQABAIAAAOAv/wAAACwAAAAAAQABAAACAkQBADs=",
    t.EMPTY_IMAGE = new Image,
    t.EMPTY_IMAGE.src = t.MISSING_TEXTURE_IMAGE_SRC,
    t.EMPTY_JSON = {},
    t.MAP_LAYER_BACKGROUND = -1,
    t.MAP_LAYER_PLAYGROUND = 0,
    t.MAP_LAYER_FOREGROUND = 1,
    t.MAP_LAYER_TRANSPARENT = 2,
    t.MAP_LAYER_ICONS = 3,
    t.MAP_LAYER_POINT_LABELS = 4,
    t.MAP_LAYER_TAP_FEEDBACK = 5,
    t.MAP_LAYER_TARGET_INDICATOR = 6,
    t.TRANSPARENT_MODE_ALPHA = .725;
    var o = 153600
      , s = 1024e3
      , a = 120;
    if (n.isPhoneGap) {
        var r = n.capacity || 536870912
          , l = n.isAndroid ? .3 : .5
          , c = r * l * .4;
        t.MAX_MUSIC_SFX_MEMORY = Math.round(.43 * c / o),
        t.MAX_TEXTURE_MEMORY_MAP = Math.round(.25 * c),
        t.MAX_TEXTURE_MEMORY_WORLDMAP = Math.round(.1 * c),
        t.MAX_TEXTURE_MEMORY_CHARACTER_DISPLAY = Math.round(.05 * c),
        t.MAX_SPRITES_BUFFER_MAP = Math.max(Math.round(.04 * c / a), 2e4),
        t.MAX_SPRITES_BUFFER_WORLDMAP = Math.max(Math.round(.005 * c / a), 2500),
        t.MAX_SPRITES_BUFFER_CHARACTER_DISPLAY = Math.max(Math.round(.005 * c / a), 4e3),
        t.MAX_ANIMATIONS = Math.round(.12 * c / s)
    } else
        t.MAX_MUSIC_SFX_MEMORY = 1e3,
        t.MAX_TEXTURE_MEMORY_MAP = 104857600,
        t.MAX_TEXTURE_MEMORY_WORLDMAP = 52428800,
        t.MAX_TEXTURE_MEMORY_CHARACTER_DISPLAY = 20971520,
        t.MAX_SPRITES_BUFFER_MAP = 8e4,
        t.MAX_SPRITES_BUFFER_WORLDMAP = 4e3,
        t.MAX_SPRITES_BUFFER_CHARACTER_DISPLAY = 9e3,
        t.MAX_ANIMATIONS = 30;
    t.MAX_ZOOM_MAP = 1.1,
    t.PRERENDER_RATIO_MAP = t.PIXEL_RATIO,
    t.PRERENDER_RATIO_WORLDMAP = t.PIXEL_RATIO,
    t.PRERENDER_RATIO_CHARACTER_DISPLAY = 2 * t.PIXEL_RATIO
}
, function(e, t, i) {
    var n = i(8)
      , o = window.navigator.userAgent
      , s = new n(o)
      , a = s.getOS()
      , r = void 0 !== window.device && "string" == typeof window.device.model;
    t.osName = a.name,
    t.isIOS = "iOS" === a.name,
    t.isAndroid = "Android" === a.name,
    t.isDevice = t.isIOS || t.isAndroid,
    t.isPhoneGap = t.isCordova = !!(window.cordova || window.PhoneGap || window.phonegap),
    t.isIpad2 = r && "iPad2," === window.device.model.substr(0, 6),
    t.os = a.name.toLowerCase(),
    t.isIOSApp = window.device && window.device.platform && "iOS" === window.device.platform,
    t.isAndroidApp = window.device && window.device.platform && "Android" === window.device.platform
}
, function(e, t, i) {
    var n;
    !function(o, s) {
        "use strict";
        var a = "0.7.9"
          , r = ""
          , l = "?"
          , c = "function"
          , u = "undefined"
          , h = "object"
          , d = "string"
          , p = "major"
          , m = "model"
          , f = "name"
          , g = "type"
          , _ = "vendor"
          , v = "version"
          , y = "architecture"
          , w = "console"
          , b = "mobile"
          , C = "tablet"
          , I = "smarttv"
          , T = "wearable"
          , S = "embedded"
          , A = {
            extend: function(e, t) {
                for (var i in t)
                    "browser cpu device engine os".indexOf(i) !== -1 && t[i].length % 2 === 0 && (e[i] = t[i].concat(e[i]));
                return e
            },
            has: function(e, t) {
                return "string" == typeof e && t.toLowerCase().indexOf(e.toLowerCase()) !== -1
            },
            lowerize: function(e) {
                return e.toLowerCase()
            },
            major: function(e) {
                return typeof e === d ? e.split(".")[0] : s
            }
        }
          , E = {
            rgx: function() {
                for (var e, t, i, n, o, a, r, l = 0, d = arguments; l < d.length && !a; ) {
                    var p = d[l]
                      , m = d[l + 1];
                    if (typeof e === u) {
                        e = {};
                        for (n in m)
                            o = m[n],
                            typeof o === h ? e[o[0]] = s : e[o] = s
                    }
                    for (t = i = 0; t < p.length && !a; )
                        if (a = p[t++].exec(this.getUA()))
                            for (n = 0; n < m.length; n++)
                                r = a[++i],
                                o = m[n],
                                typeof o === h && o.length > 0 ? 2 == o.length ? typeof o[1] == c ? e[o[0]] = o[1].call(this, r) : e[o[0]] = o[1] : 3 == o.length ? typeof o[1] !== c || o[1].exec && o[1].test ? e[o[0]] = r ? r.replace(o[1], o[2]) : s : e[o[0]] = r ? o[1].call(this, r, o[2]) : s : 4 == o.length && (e[o[0]] = r ? o[3].call(this, r.replace(o[1], o[2])) : s) : e[o] = r ? r : s;
                    l += 2
                }
                return e
            },
            str: function(e, t) {
                for (var i in t)
                    if (typeof t[i] === h && t[i].length > 0) {
                        for (var n = 0; n < t[i].length; n++)
                            if (A.has(t[i][n], e))
                                return i === l ? s : i
                    } else if (A.has(t[i], e))
                        return i === l ? s : i;
                return e
            }
        }
          , x = {
            browser: {
                oldsafari: {
                    version: {
                        "1.0": "/8",
                        1.2: "/1",
                        1.3: "/3",
                        "2.0": "/412",
                        "2.0.2": "/416",
                        "2.0.3": "/417",
                        "2.0.4": "/419",
                        "?": "/"
                    }
                }
            },
            device: {
                amazon: {
                    model: {
                        "Fire Phone": ["SD", "KF"]
                    }
                },
                sprint: {
                    model: {
                        "Evo Shift 4G": "7373KT"
                    },
                    vendor: {
                        HTC: "APA",
                        Sprint: "Sprint"
                    }
                }
            },
            os: {
                windows: {
                    version: {
                        ME: "4.90",
                        "NT 3.11": "NT3.51",
                        "NT 4.0": "NT4.0",
                        2000: "NT 5.0",
                        XP: ["NT 5.1", "NT 5.2"],
                        Vista: "NT 6.0",
                        7: "NT 6.1",
                        8: "NT 6.2",
                        8.1: "NT 6.3",
                        10: ["NT 6.4", "NT 10.0"],
                        RT: "ARM"
                    }
                }
            }
        }
          , M = {
            browser: [[/(opera\smini)\/([\w\.-]+)/i, /(opera\s[mobiletab]+).+version\/([\w\.-]+)/i, /(opera).+version\/([\w\.]+)/i, /(opera)[\/\s]+([\w\.]+)/i], [f, v], [/\s(opr)\/([\w\.]+)/i], [[f, "Opera"], v], [/(kindle)\/([\w\.]+)/i, /(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i, /(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i, /(?:ms|\()(ie)\s([\w\.]+)/i, /(rekonq)\/([\w\.]+)*/i, /(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium)\/([\w\.-]+)/i], [f, v], [/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i], [[f, "IE"], v], [/(edge)\/((\d+)?[\w\.]+)/i], [f, v], [/(yabrowser)\/([\w\.]+)/i], [[f, "Yandex"], v], [/(comodo_dragon)\/([\w\.]+)/i], [[f, /_/g, " "], v], [/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i, /(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i], [f, v], [/(dolfin)\/([\w\.]+)/i], [[f, "Dolphin"], v], [/((?:android.+)crmo|crios)\/([\w\.]+)/i], [[f, "Chrome"], v], [/XiaoMi\/MiuiBrowser\/([\w\.]+)/i], [v, [f, "MIUI Browser"]], [/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i], [v, [f, "Android Browser"]], [/FBAV\/([\w\.]+);/i], [v, [f, "Facebook"]], [/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i], [v, [f, "Mobile Safari"]], [/version\/([\w\.]+).+?(mobile\s?safari|safari)/i], [v, f], [/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i], [f, [v, E.str, x.browser.oldsafari.version]], [/(konqueror)\/([\w\.]+)/i, /(webkit|khtml)\/([\w\.]+)/i], [f, v], [/(navigator|netscape)\/([\w\.-]+)/i], [[f, "Netscape"], v], [/fxios\/([\w\.-]+)/i], [v, [f, "Firefox"]], [/(swiftfox)/i, /(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i, /(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i, /(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i, /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i, /(links)\s\(([\w\.]+)/i, /(gobrowser)\/?([\w\.]+)*/i, /(ice\s?browser)\/v?([\w\._]+)/i, /(mosaic)[\/\s]([\w\.]+)/i], [f, v]],
            cpu: [[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i], [[y, "amd64"]], [/(ia32(?=;))/i], [[y, A.lowerize]], [/((?:i[346]|x)86)[;\)]/i], [[y, "ia32"]], [/windows\s(ce|mobile);\sppc;/i], [[y, "arm"]], [/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i], [[y, /ower/, "", A.lowerize]], [/(sun4\w)[;\)]/i], [[y, "sparc"]], [/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i], [[y, A.lowerize]]],
            device: [[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i], [m, _, [g, C]], [/applecoremedia\/[\w\.]+ \((ipad)/], [m, [_, "Apple"], [g, C]], [/(apple\s{0,1}tv)/i], [[m, "Apple TV"], [_, "Apple"]], [/(archos)\s(gamepad2?)/i, /(hp).+(touchpad)/i, /(kindle)\/([\w\.]+)/i, /\s(nook)[\w\s]+build\/(\w+)/i, /(dell)\s(strea[kpr\s\d]*[\dko])/i], [_, m, [g, C]], [/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i], [m, [_, "Amazon"], [g, C]], [/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i], [[m, E.str, x.device.amazon.model], [_, "Amazon"], [g, b]], [/\((ip[honed|\s\w*]+);.+(apple)/i], [m, _, [g, b]], [/\((ip[honed|\s\w*]+);/i], [m, [_, "Apple"], [g, b]], [/(blackberry)[\s-]?(\w+)/i, /(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i, /(hp)\s([\w\s]+\w)/i, /(asus)-?(\w+)/i], [_, m, [g, b]], [/\(bb10;\s(\w+)/i], [m, [_, "BlackBerry"], [g, b]], [/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i], [m, [_, "Asus"], [g, C]], [/(sony)\s(tablet\s[ps])\sbuild\//i, /(sony)?(?:sgp.+)\sbuild\//i], [[_, "Sony"], [m, "Xperia Tablet"], [g, C]], [/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i], [[_, "Sony"], [m, "Xperia Phone"], [g, b]], [/\s(ouya)\s/i, /(nintendo)\s([wids3u]+)/i], [_, m, [g, w]], [/android.+;\s(shield)\sbuild/i], [m, [_, "Nvidia"], [g, w]], [/(playstation\s[3portablevi]+)/i], [m, [_, "Sony"], [g, w]], [/(sprint\s(\w+))/i], [[_, E.str, x.device.sprint.vendor], [m, E.str, x.device.sprint.model], [g, b]], [/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i], [_, m, [g, C]], [/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i, /(zte)-(\w+)*/i, /(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i], [_, [m, /_/g, " "], [g, b]], [/(nexus\s9)/i], [m, [_, "HTC"], [g, C]], [/[\s\(;](xbox(?:\sone)?)[\s\);]/i], [m, [_, "Microsoft"], [g, w]], [/(kin\.[onetw]{3})/i], [[m, /\./g, " "], [_, "Microsoft"], [g, b]], [/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i, /mot[\s-]?(\w+)*/i, /(XT\d{3,4}) build\//i], [m, [_, "Motorola"], [g, b]], [/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i], [m, [_, "Motorola"], [g, C]], [/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i, /((SM-T\w+))/i], [[_, "Samsung"], m, [g, C]], [/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i, /(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i, /sec-((sgh\w+))/i], [[_, "Samsung"], m, [g, b]], [/(samsung);smarttv/i], [_, m, [g, I]], [/\(dtv[\);].+(aquos)/i], [m, [_, "Sharp"], [g, I]], [/sie-(\w+)*/i], [m, [_, "Siemens"], [g, b]], [/(maemo|nokia).*(n900|lumia\s\d+)/i, /(nokia)[\s_-]?([\w-]+)*/i], [[_, "Nokia"], m, [g, b]], [/android\s3\.[\s\w;-]{10}(a\d{3})/i], [m, [_, "Acer"], [g, C]], [/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i], [[_, "LG"], m, [g, C]], [/(lg) netcast\.tv/i], [_, m, [g, I]], [/(nexus\s[45])/i, /lg[e;\s\/-]+(\w+)*/i], [m, [_, "LG"], [g, b]], [/android.+(ideatab[a-z0-9\-\s]+)/i], [m, [_, "Lenovo"], [g, C]], [/linux;.+((jolla));/i], [_, m, [g, b]], [/((pebble))app\/[\d\.]+\s/i], [_, m, [g, T]], [/android.+;\s(glass)\s\d/i], [m, [_, "Google"], [g, T]], [/android.+(\w+)\s+build\/hm\1/i, /android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i, /android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i], [[m, /_/g, " "], [_, "Xiaomi"], [g, b]], [/(mobile|tablet);.+rv\:.+gecko\//i], [[g, A.lowerize], _, m]],
            engine: [[/windows.+\sedge\/([\w\.]+)/i], [v, [f, "EdgeHTML"]], [/(presto)\/([\w\.]+)/i, /(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i, /(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i, /(icab)[\/\s]([23]\.[\d\.]+)/i], [f, v], [/rv\:([\w\.]+).*(gecko)/i], [v, f]],
            os: [[/microsoft\s(windows)\s(vista|xp)/i], [f, v], [/(windows)\snt\s6\.2;\s(arm)/i, /(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i], [f, [v, E.str, x.os.windows.version]], [/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i], [[f, "Windows"], [v, E.str, x.os.windows.version]], [/\((bb)(10);/i], [[f, "BlackBerry"], v], [/(blackberry)\w*\/?([\w\.]+)*/i, /(tizen)[\/\s]([\w\.]+)/i, /(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i, /linux;.+(sailfish);/i], [f, v], [/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i], [[f, "Symbian"], v], [/\((series40);/i], [f], [/mozilla.+\(mobile;.+gecko.+firefox/i], [[f, "Firefox OS"], v], [/(nintendo|playstation)\s([wids3portablevu]+)/i, /(mint)[\/\s\(]?(\w+)*/i, /(mageia|vectorlinux)[;\s]/i, /(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i, /(hurd|linux)\s?([\w\.]+)*/i, /(gnu)\s?([\w\.]+)*/i], [f, v], [/(cros)\s[\w]+\s([\w\.]+\w)/i], [[f, "Chromium OS"], v], [/(sunos)\s?([\w\.]+\d)*/i], [[f, "Solaris"], v], [/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i], [f, v], [/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i], [[f, "iOS"], [v, /_/g, "."]], [/(mac\sos\sx)\s?([\w\s\.]+\w)*/i, /(macintosh|mac(?=_powerpc)\s)/i], [[f, "Mac OS"], [v, /_/g, "."]], [/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i, /(haiku)\s(\w+)/i, /(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i, /(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i, /(unix)\s?([\w\.]+)*/i], [f, v]]
        }
          , N = function(e, t) {
            if (!(this instanceof N))
                return new N(e,t).getResult();
            var i = e || (o && o.navigator && o.navigator.userAgent ? o.navigator.userAgent : r)
              , n = t ? A.extend(M, t) : M;
            return this.getBrowser = function() {
                var e = E.rgx.apply(this, n.browser);
                return e.major = A.major(e.version),
                e
            }
            ,
            this.getCPU = function() {
                return E.rgx.apply(this, n.cpu)
            }
            ,
            this.getDevice = function() {
                return E.rgx.apply(this, n.device)
            }
            ,
            this.getEngine = function() {
                return E.rgx.apply(this, n.engine)
            }
            ,
            this.getOS = function() {
                return E.rgx.apply(this, n.os)
            }
            ,
            this.getResult = function() {
                return {
                    ua: this.getUA(),
                    browser: this.getBrowser(),
                    engine: this.getEngine(),
                    os: this.getOS(),
                    device: this.getDevice(),
                    cpu: this.getCPU()
                }
            }
            ,
            this.getUA = function() {
                return i
            }
            ,
            this.setUA = function(e) {
                return i = e,
                this
            }
            ,
            this.setUA(i),
            this
        };
        N.VERSION = a,
        N.BROWSER = {
            NAME: f,
            MAJOR: p,
            VERSION: v
        },
        N.CPU = {
            ARCHITECTURE: y
        },
        N.DEVICE = {
            MODEL: m,
            VENDOR: _,
            TYPE: g,
            CONSOLE: w,
            MOBILE: b,
            SMARTTV: I,
            TABLET: C,
            WEARABLE: T,
            EMBEDDED: S
        },
        N.ENGINE = {
            NAME: f,
            VERSION: v
        },
        N.OS = {
            NAME: f,
            VERSION: v
        },
        typeof t !== u ? (typeof e !== u && e.exports && (t = e.exports = N),
        t.UAParser = N) : "function" === c && i(9) ? (n = function() {
            return N
        }
        .call(t, i, t, e),
        !(n !== s && (e.exports = n))) : o.UAParser = N;
        var R = o.jQuery || o.Zepto;
        if (typeof R !== u) {
            var O = new N;
            R.ua = O.getResult(),
            R.ua.get = function() {
                return O.getUA()
            }
            ,
            R.ua.set = function(e) {
                O.setUA(e);
                var t = O.getResult();
                for (var i in t)
                    R.ua[i] = t[i]
            }
        }
    }("object" == typeof window ? window : this)
}
, function(e, t) {
    (function(t) {
        e.exports = t
    }
    ).call(t, {})
}
, function(e, t) {
    e.exports = {
        "bones/1/AnimAttaque0_1.json": !0,
        "bones/1/AnimAttaque0_1.png": !0,
        "bones/1/AnimAttaque0_5.json": !0,
        "bones/1/AnimAttaque0_5.png": !0,
        "bones/1/AnimAttaque101_2.json": !0,
        "bones/1/AnimAttaque101_2.png": !0,
        "bones/1/AnimAttaque101_6.json": !0,
        "bones/1/AnimAttaque101_6.png": !0,
        "bones/1/AnimAttaque1102_0.json": !0,
        "bones/1/AnimAttaque1102_0.png": !0,
        "bones/1/AnimAttaque1102_2.json": !0,
        "bones/1/AnimAttaque1102_2.png": !0,
        "bones/1/AnimAttaque1102_6.json": !0,
        "bones/1/AnimAttaque1102_6.png": !0,
        "bones/1/AnimAttaque14051_6.json": !0,
        "bones/1/AnimAttaque14051_6.png": !0,
        "bones/1/AnimAttaque140_0.json": !0,
        "bones/1/AnimAttaque140_0.png": !0,
        "bones/1/AnimAttaque140_6.json": !0,
        "bones/1/AnimAttaque140_6.png": !0,
        "bones/1/AnimAttaque15751_1.json": !0,
        "bones/1/AnimAttaque15751_1.png": !0,
        "bones/1/AnimAttaque15751_5.json": !0,
        "bones/1/AnimAttaque15751_5.png": !0,
        "bones/1/AnimAttaque15752_5.json": !0,
        "bones/1/AnimAttaque15752_5.png": !0,
        "bones/1/AnimAttaque15755_1.json": !0,
        "bones/1/AnimAttaque15755_1.png": !0,
        "bones/1/AnimAttaque15755_5.json": !0,
        "bones/1/AnimAttaque15755_5.png": !0,
        "bones/1/AnimAttaque15761_5.json": !0,
        "bones/1/AnimAttaque15761_5.png": !0,
        "bones/1/AnimAttaque15762_1.json": !0,
        "bones/1/AnimAttaque15762_1.png": !0,
        "bones/1/AnimAttaque15762_5.json": !0,
        "bones/1/AnimAttaque15762_5.png": !0,
        "bones/1/AnimAttaque1_6.json": !0,
        "bones/1/AnimAttaque1_6.png": !0,
        "bones/1/AnimAttaque301_0.json": !0,
        "bones/1/AnimAttaque301_0.png": !0,
        "bones/1/AnimAttaque301_2.json": !0,
        "bones/1/AnimAttaque301_2.png": !0,
        "bones/1/AnimAttaque4_6.json": !0,
        "bones/1/AnimAttaque4_6.png": !0,
        "bones/1/AnimAttaque5_2.json": !0,
        "bones/1/AnimAttaque5_2.png": !0,
        "bones/1/AnimAttaque5_6.json": !0,
        "bones/1/AnimAttaque5_6.png": !0,
        "bones/1/AnimAttaque6_2.json": !0,
        "bones/1/AnimAttaque6_2.png": !0,
        "bones/1/AnimAttaque6_6.json": !0,
        "bones/1/AnimAttaque6_6.png": !0,
        "bones/1/AnimAttaque801_2.json": !0,
        "bones/1/AnimAttaque801_2.png": !0,
        "bones/1/AnimAttaque801_6.json": !0,
        "bones/1/AnimAttaque801_6.png": !0,
        "bones/1/AnimAttaque8_2.json": !0,
        "bones/1/AnimAttaque8_2.png": !0,
        "bones/1/AnimAttaque8_6.json": !0,
        "bones/1/AnimAttaque8_6.png": !0,
        "bones/1/AnimAttaque901_0.json": !0,
        "bones/1/AnimAttaque901_0.png": !0,
        "bones/1/AnimAttaque901_2.json": !0,
        "bones/1/AnimAttaque901_2.png": !0,
        "bones/1/AnimAttaque901_6.json": !0,
        "bones/1/AnimAttaque901_6.png": !0,
        "bones/1/AnimAttaque9_0.json": !0,
        "bones/1/AnimAttaque9_0.png": !0,
        "bones/1/AnimAttaque9_2.json": !0,
        "bones/1/AnimAttaque9_2.png": !0,
        "bones/1/AnimAttaque9_6.json": !0,
        "bones/1/AnimAttaque9_6.png": !0,
        "bones/1/AnimHit_0.json": !0,
        "bones/1/AnimHit_0.png": !0,
        "bones/1/AnimHit_2.json": !0,
        "bones/1/AnimHit_2.png": !0,
        "bones/1/AnimHit_6.json": !0,
        "bones/1/AnimHit_6.png": !0,
        "bones/1/AnimMort_0.json": !0,
        "bones/1/AnimMort_0.png": !0,
        "bones/1/AnimMort_2.json": !0,
        "bones/1/AnimMort_2.png": !0,
        "bones/1/AnimMort_6.json": !0,
        "bones/1/AnimMort_6.png": !0,
        "bones/1/AnimTacle_0.json": !0,
        "bones/1/AnimTacle_0.png": !0,
        "bones/1/AnimTacle_2.json": !0,
        "bones/1/AnimTacle_2.png": !0,
        "bones/1/AnimTacle_6.json": !0,
        "bones/1/AnimTacle_6.png": !0,
        "bones/1039/AnimTacle_1.json": !0,
        "bones/1039/AnimTacle_1.png": !0,
        "bones/1057/AnimTacle_1.json": !0,
        "bones/1057/AnimTacle_1.png": !0,
        "bones/1068/AnimHit_1.json": !0,
        "bones/1068/AnimHit_1.png": !0,
        "bones/1068/AnimHit_5.json": !0,
        "bones/1068/AnimHit_5.png": !0,
        "bones/1084/AnimEmoteEat_0_1.json": !0,
        "bones/1084/AnimEmoteEat_0_1.png": !0,
        "bones/1084/AnimHit_1.json": !0,
        "bones/1084/AnimHit_1.png": !0,
        "bones/1084/AnimHit_5.json": !0,
        "bones/1084/AnimHit_5.png": !0,
        "bones/1084/AnimMort_1.json": !0,
        "bones/1084/AnimMort_1.png": !0,
        "bones/1084/AnimPioche_5.json": !0,
        "bones/1084/AnimPioche_5.png": !0,
        "bones/1160/AnimTacle_1.json": !0,
        "bones/1160/AnimTacle_1.png": !0,
        "bones/1162/AnimTacle_5.json": !0,
        "bones/1162/AnimTacle_5.png": !0,
        "bones/1163/AnimTacle_1.json": !0,
        "bones/1163/AnimTacle_1.png": !0,
        "bones/1163/AnimTacle_5.json": !0,
        "bones/1163/AnimTacle_5.png": !0,
        "bones/1164/AnimTacle_1.json": !0,
        "bones/1164/AnimTacle_1.png": !0,
        "bones/1179/AnimTacle_5.json": !0,
        "bones/1179/AnimTacle_5.png": !0,
        "bones/1202/AnimPioche_1.json": !0,
        "bones/1202/AnimPioche_1.png": !0,
        "bones/1202/AnimPioche_5.json": !0,
        "bones/1202/AnimPioche_5.png": !0,
        "bones/1219/AnimTacle_1.json": !0,
        "bones/1219/AnimTacle_1.png": !0,
        "bones/1219/AnimTacle_5.json": !0,
        "bones/1219/AnimTacle_5.png": !0,
        "bones/1221/AnimTacle_1.json": !0,
        "bones/1221/AnimTacle_1.png": !0,
        "bones/1221/AnimTacle_5.json": !0,
        "bones/1221/AnimTacle_5.png": !0,
        "bones/1222/AnimTacle_1.json": !0,
        "bones/1222/AnimTacle_1.png": !0,
        "bones/1239/AnimTacle_1.json": !0,
        "bones/1239/AnimTacle_1.png": !0,
        "bones/1239/AnimTacle_5.json": !0,
        "bones/1239/AnimTacle_5.png": !0,
        "bones/1240/AnimTacle_1.json": !0,
        "bones/1240/AnimTacle_1.png": !0,
        "bones/1240/AnimTacle_5.json": !0,
        "bones/1240/AnimTacle_5.png": !0,
        "bones/1291/AnimTacle_1.json": !0,
        "bones/1291/AnimTacle_1.png": !0,
        "bones/1291/AnimTacle_5.json": !0,
        "bones/1291/AnimTacle_5.png": !0,
        "bones/1299/AnimTacle_1.json": !0,
        "bones/1299/AnimTacle_1.png": !0,
        "bones/1299/AnimTacle_5.json": !0,
        "bones/1299/AnimTacle_5.png": !0,
        "bones/14/AnimHitCarrying_1.json": !0,
        "bones/14/AnimHitCarrying_1.png": !0,
        "bones/14/AnimHitCarrying_5.json": !0,
        "bones/14/AnimHitCarrying_5.png": !0,
        "bones/14/AnimTacle_1.json": !0,
        "bones/14/AnimTacle_1.png": !0,
        "bones/14/AnimTacle_5.json": !0,
        "bones/14/AnimTacle_5.png": !0,
        "bones/14/carrying.json": !0,
        "bones/14/carrying.png": !0,
        "bones/1422/AnimAttaque1203_1.json": !0,
        "bones/1422/AnimAttaque1203_1.png": !0,
        "bones/1422/AnimAttaque1203_5.json": !0,
        "bones/1422/AnimAttaque1203_5.png": !0,
        "bones/1537/AnimVanish_1.json": !0,
        "bones/1537/AnimVanish_1.png": !0,
        "bones/1537/AnimVanish_5.json": !0,
        "bones/1537/AnimVanish_5.png": !0,
        "bones/1540/AnimTacle_1.json": !0,
        "bones/1540/AnimTacle_1.png": !0,
        "bones/1540/AnimTacle_5.json": !0,
        "bones/1540/AnimTacle_5.png": !0,
        "bones/1575/AnimPioche_5.json": !0,
        "bones/1575/AnimPioche_5.png": !0,
        "bones/1576/AnimAttaque14372_5.json": !0,
        "bones/1576/AnimAttaque14372_5.png": !0,
        "bones/1601/AnimTacle_1.json": !0,
        "bones/1601/AnimTacle_1.png": !0,
        "bones/1601/AnimTacle_5.json": !0,
        "bones/1601/AnimTacle_5.png": !0,
        "bones/1632/AnimTacle_1.json": !0,
        "bones/1632/AnimTacle_1.png": !0,
        "bones/1633/AnimEmoteEat_0_5.json": !0,
        "bones/1633/AnimEmoteEat_0_5.png": !0,
        "bones/1747/AnimVanish_1.json": !0,
        "bones/1747/AnimVanish_1.png": !0,
        "bones/1747/AnimVanish_5.json": !0,
        "bones/1747/AnimVanish_5.png": !0,
        "bones/1749/AnimThrow_1.json": !0,
        "bones/1749/AnimThrow_1.png": !0,
        "bones/1749/AnimThrow_5.json": !0,
        "bones/1749/AnimThrow_5.png": !0,
        "bones/1749/carrying.json": !0,
        "bones/1749/carrying.png": !0,
        "bones/177/AnimTacle_1.json": !0,
        "bones/177/AnimTacle_1.png": !0,
        "bones/18/AnimCueillirSol1_1.json": !0,
        "bones/18/AnimCueillirSol1_1.png": !0,
        "bones/18/AnimCueillirSol1_5.json": !0,
        "bones/18/AnimCueillirSol1_5.png": !0,
        "bones/1846/AnimVanish_1.json": !0,
        "bones/1846/AnimVanish_1.png": !0,
        "bones/1846/AnimVanish_5.json": !0,
        "bones/1846/AnimVanish_5.png": !0,
        "bones/1847/AnimTacle_1.json": !0,
        "bones/1847/AnimTacle_1.png": !0,
        "bones/1847/AnimTacle_5.json": !0,
        "bones/1847/AnimTacle_5.png": !0,
        "bones/1848/AnimTacle_1.json": !0,
        "bones/1848/AnimTacle_1.png": !0,
        "bones/1848/AnimTacle_5.json": !0,
        "bones/1848/AnimTacle_5.png": !0,
        "bones/186/AnimTacle_1.json": !0,
        "bones/186/AnimTacle_1.png": !0,
        "bones/186/AnimTacle_5.json": !0,
        "bones/186/AnimTacle_5.png": !0,
        "bones/1884/AnimTacle_1.json": !0,
        "bones/1884/AnimTacle_1.png": !0,
        "bones/1884/AnimTacle_5.json": !0,
        "bones/1884/AnimTacle_5.png": !0,
        "bones/1886/AnimCueillirSol1_1.json": !0,
        "bones/1886/AnimCueillirSol1_1.png": !0,
        "bones/1910/AnimTacle_1.json": !0,
        "bones/1910/AnimTacle_1.png": !0,
        "bones/1910/AnimTacle_5.json": !0,
        "bones/1910/AnimTacle_5.png": !0,
        "bones/195/AnimEmoteAlliance_0_5.json": !0,
        "bones/195/AnimEmoteAlliance_0_5.png": !0,
        "bones/195/AnimEmoteGuild_0_5.json": !0,
        "bones/195/AnimEmoteGuild_0_5.png": !0,
        "bones/195/AnimFaucher_1.json": !0,
        "bones/195/AnimFaucher_1.png": !0,
        "bones/195/AnimFaucher_5.json": !0,
        "bones/195/AnimFaucher_5.png": !0,
        "bones/1957/FX.json": !0,
        "bones/1957/FX.png": !0,
        "bones/1990/AnimEmoteAlliance_0_1.json": !0,
        "bones/1990/AnimEmoteAlliance_0_1.png": !0,
        "bones/1990/AnimEmoteDrink_0_1.json": !0,
        "bones/1990/AnimEmoteDrink_0_1.png": !0,
        "bones/1990/AnimEmoteEat_0_1.json": !0,
        "bones/1990/AnimEmoteEat_0_1.png": !0,
        "bones/1990/AnimEmoteEat_0_5.json": !0,
        "bones/1990/AnimEmoteEat_0_5.png": !0,
        "bones/1990/AnimPioche_5.json": !0,
        "bones/1990/AnimPioche_5.png": !0,
        "bones/1990/AnimTacle_1.json": !0,
        "bones/1990/AnimTacle_1.png": !0,
        "bones/2/AnimArme83_5.json": !0,
        "bones/2/AnimArme83_5.png": !0,
        "bones/2/AnimAttaque0_0.json": !0,
        "bones/2/AnimAttaque0_0.png": !0,
        "bones/2/AnimAttaque0_2.json": !0,
        "bones/2/AnimAttaque0_2.png": !0,
        "bones/2/AnimAttaque0_6.json": !0,
        "bones/2/AnimAttaque0_6.png": !0,
        "bones/2/AnimEmoteCard_0_1.json": !0,
        "bones/2/AnimEmoteCard_0_1.png": !0,
        "bones/2/AnimEmoteSeiza_0_1.json": !0,
        "bones/2/AnimEmoteSeiza_0_1.png": !0,
        "bones/2/AnimEmoteSeiza_0_5.json": !0,
        "bones/2/AnimEmoteSeiza_0_5.png": !0,
        "bones/2/AnimHitCarrying_1.json": !0,
        "bones/2/AnimHitCarrying_1.png": !0,
        "bones/2/AnimHitCarrying_5.json": !0,
        "bones/2/AnimHitCarrying_5.png": !0,
        "bones/2/AnimHit_0.json": !0,
        "bones/2/AnimHit_0.png": !0,
        "bones/2/AnimHit_2.json": !0,
        "bones/2/AnimHit_2.png": !0,
        "bones/2/AnimHit_6.json": !0,
        "bones/2/AnimHit_6.png": !0,
        "bones/2/AnimMort_0.json": !0,
        "bones/2/AnimMort_0.png": !0,
        "bones/2013/AnimEmoteDrink_0_1.json": !0,
        "bones/2013/AnimEmoteDrink_0_1.png": !0,
        "bones/2013/AnimEmoteDrink_0_5.json": !0,
        "bones/2013/AnimEmoteDrink_0_5.png": !0,
        "bones/2013/AnimEmoteEat_0_1.json": !0,
        "bones/2013/AnimEmoteEat_0_1.png": !0,
        "bones/2013/AnimEmoteEat_0_5.json": !0,
        "bones/2013/AnimEmoteEat_0_5.png": !0,
        "bones/2013/AnimEmoteGuild_0_1.json": !0,
        "bones/2013/AnimEmoteGuild_0_1.png": !0,
        "bones/2013/AnimHache_5.json": !0,
        "bones/2013/AnimHache_5.png": !0,
        "bones/2013/AnimTacle_1.json": !0,
        "bones/2013/AnimTacle_1.png": !0,
        "bones/2013/AnimTacle_5.json": !0,
        "bones/2013/AnimTacle_5.png": !0,
        "bones/2287/AnimTacle_1.json": !0,
        "bones/2287/AnimTacle_1.png": !0,
        "bones/2287/AnimTacle_5.json": !0,
        "bones/2287/AnimTacle_5.png": !0,
        "bones/2288/AnimTacle_1.json": !0,
        "bones/2288/AnimTacle_1.png": !0,
        "bones/2291/AnimTacle_5.json": !0,
        "bones/2291/AnimTacle_5.png": !0,
        "bones/2292/AnimTacle_1.json": !0,
        "bones/2292/AnimTacle_1.png": !0,
        "bones/23/AnimEmoteDrink_0_1.json": !0,
        "bones/23/AnimEmoteDrink_0_1.png": !0,
        "bones/23/AnimEmoteDrink_0_5.json": !0,
        "bones/23/AnimEmoteDrink_0_5.png": !0,
        "bones/230/AnimTacle_1.json": !0,
        "bones/230/AnimTacle_1.png": !0,
        "bones/230/AnimTacle_5.json": !0,
        "bones/230/AnimTacle_5.png": !0,
        "bones/2302/AnimTacle_1.json": !0,
        "bones/2302/AnimTacle_1.png": !0,
        "bones/2302/AnimTacle_5.json": !0,
        "bones/2302/AnimTacle_5.png": !0,
        "bones/2350/FX.json": !0,
        "bones/2350/FX.png": !0,
        "bones/238/AnimTacle_1.json": !0,
        "bones/238/AnimTacle_1.png": !0,
        "bones/239/AnimTacle_1.json": !0,
        "bones/239/AnimTacle_1.png": !0,
        "bones/239/AnimTacle_5.json": !0,
        "bones/239/AnimTacle_5.png": !0,
        "bones/240/AnimTacle_5.json": !0,
        "bones/240/AnimTacle_5.png": !0,
        "bones/241/AnimTacle_5.json": !0,
        "bones/241/AnimTacle_5.png": !0,
        "bones/255/AnimEmoteRest_0_1.json": !0,
        "bones/255/AnimEmoteRest_0_1.png": !0,
        "bones/255/AnimEmoteSit_0_1.json": !0,
        "bones/255/AnimEmoteSit_0_1.png": !0,
        "bones/267/AnimCueillir0_1.json": !0,
        "bones/267/AnimCueillir0_1.png": !0,
        "bones/267/AnimCueillir0_5.json": !0,
        "bones/267/AnimCueillir0_5.png": !0,
        "bones/267/AnimEmoteDrink_0_1.json": !0,
        "bones/267/AnimEmoteDrink_0_1.png": !0,
        "bones/281/AnimTacle_1.json": !0,
        "bones/281/AnimTacle_1.png": !0,
        "bones/281/AnimTacle_5.json": !0,
        "bones/281/AnimTacle_5.png": !0,
        "bones/282/AnimTacle_1.json": !0,
        "bones/282/AnimTacle_1.png": !0,
        "bones/282/AnimTacle_5.json": !0,
        "bones/282/AnimTacle_5.png": !0,
        "bones/284/AnimTacle_1.json": !0,
        "bones/284/AnimTacle_1.png": !0,
        "bones/284/AnimTacle_5.json": !0,
        "bones/284/AnimTacle_5.png": !0,
        "bones/285/AnimTacle_1.json": !0,
        "bones/285/AnimTacle_1.png": !0,
        "bones/285/AnimTacle_5.json": !0,
        "bones/285/AnimTacle_5.png": !0,
        "bones/286/AnimTacle_1.json": !0,
        "bones/286/AnimTacle_1.png": !0,
        "bones/286/AnimTacle_5.json": !0,
        "bones/286/AnimTacle_5.png": !0,
        "bones/287/AnimTacle_1.json": !0,
        "bones/287/AnimTacle_1.png": !0,
        "bones/287/AnimTacle_5.json": !0,
        "bones/287/AnimTacle_5.png": !0,
        "bones/288/AnimTacle_5.json": !0,
        "bones/288/AnimTacle_5.png": !0,
        "bones/289/AnimTacle_1.json": !0,
        "bones/289/AnimTacle_1.png": !0,
        "bones/289/AnimTacle_5.json": !0,
        "bones/289/AnimTacle_5.png": !0,
        "bones/291/AnimTacle_1.json": !0,
        "bones/291/AnimTacle_1.png": !0,
        "bones/291/AnimTacle_5.json": !0,
        "bones/291/AnimTacle_5.png": !0,
        "bones/292/AnimTacle_1.json": !0,
        "bones/292/AnimTacle_1.png": !0,
        "bones/292/AnimTacle_5.json": !0,
        "bones/292/AnimTacle_5.png": !0,
        "bones/301/AnimTacle_1.json": !0,
        "bones/301/AnimTacle_1.png": !0,
        "bones/306/AnimTacle_1.json": !0,
        "bones/306/AnimTacle_1.png": !0,
        "bones/306/AnimTacle_5.json": !0,
        "bones/306/AnimTacle_5.png": !0,
        "bones/308/AnimTacle_1.json": !0,
        "bones/308/AnimTacle_1.png": !0,
        "bones/308/AnimTacle_5.json": !0,
        "bones/308/AnimTacle_5.png": !0,
        "bones/309/AnimTacle_1.json": !0,
        "bones/309/AnimTacle_1.png": !0,
        "bones/309/AnimTacle_5.json": !0,
        "bones/309/AnimTacle_5.png": !0,
        "bones/310/AnimTacle_1.json": !0,
        "bones/310/AnimTacle_1.png": !0,
        "bones/310/AnimTacle_5.json": !0,
        "bones/310/AnimTacle_5.png": !0,
        "bones/311/AnimTacle_1.json": !0,
        "bones/311/AnimTacle_1.png": !0,
        "bones/312/AnimTacle_5.json": !0,
        "bones/312/AnimTacle_5.png": !0,
        "bones/313/AnimTacle_1.json": !0,
        "bones/313/AnimTacle_1.png": !0,
        "bones/313/AnimTacle_5.json": !0,
        "bones/313/AnimTacle_5.png": !0,
        "bones/314/AnimTacle_1.json": !0,
        "bones/314/AnimTacle_1.png": !0,
        "bones/314/AnimTacle_5.json": !0,
        "bones/314/AnimTacle_5.png": !0,
        "bones/315/AnimTacle_1.json": !0,
        "bones/315/AnimTacle_1.png": !0,
        "bones/315/AnimTacle_5.json": !0,
        "bones/315/AnimTacle_5.png": !0,
        "bones/316/AnimTacle_1.json": !0,
        "bones/316/AnimTacle_1.png": !0,
        "bones/317/AnimTacle_1.json": !0,
        "bones/317/AnimTacle_1.png": !0,
        "bones/317/AnimTacle_5.json": !0,
        "bones/317/AnimTacle_5.png": !0,
        "bones/318/AnimTacle_5.json": !0,
        "bones/318/AnimTacle_5.png": !0,
        "bones/319/AnimTacle_1.json": !0,
        "bones/319/AnimTacle_1.png": !0,
        "bones/319/AnimTacle_5.json": !0,
        "bones/319/AnimTacle_5.png": !0,
        "bones/322/AnimTacle_1.json": !0,
        "bones/322/AnimTacle_1.png": !0,
        "bones/322/AnimTacle_5.json": !0,
        "bones/322/AnimTacle_5.png": !0,
        "bones/323/AnimAttaque2_1.json": !0,
        "bones/323/AnimAttaque2_1.png": !0,
        "bones/323/AnimAttaque2_5.json": !0,
        "bones/323/AnimAttaque2_5.png": !0,
        "bones/325/AnimTacle_1.json": !0,
        "bones/325/AnimTacle_1.png": !0,
        "bones/325/AnimTacle_5.json": !0,
        "bones/325/AnimTacle_5.png": !0,
        "bones/326/AnimTacle_1.json": !0,
        "bones/326/AnimTacle_1.png": !0,
        "bones/326/AnimTacle_5.json": !0,
        "bones/326/AnimTacle_5.png": !0,
        "bones/327/AnimTacle_1.json": !0,
        "bones/327/AnimTacle_1.png": !0,
        "bones/327/AnimTacle_5.json": !0,
        "bones/327/AnimTacle_5.png": !0,
        "bones/328/AnimTacle_1.json": !0,
        "bones/328/AnimTacle_1.png": !0,
        "bones/328/AnimTacle_5.json": !0,
        "bones/328/AnimTacle_5.png": !0,
        "bones/329/AnimTacle_1.json": !0,
        "bones/329/AnimTacle_1.png": !0,
        "bones/329/AnimTacle_5.json": !0,
        "bones/329/AnimTacle_5.png": !0,
        "bones/331/AnimTacle_1.json": !0,
        "bones/331/AnimTacle_1.png": !0,
        "bones/331/AnimTacle_5.json": !0,
        "bones/331/AnimTacle_5.png": !0,
        "bones/332/AnimTacle_1.json": !0,
        "bones/332/AnimTacle_1.png": !0,
        "bones/332/AnimTacle_5.json": !0,
        "bones/332/AnimTacle_5.png": !0,
        "bones/334/AnimTacle_1.json": !0,
        "bones/334/AnimTacle_1.png": !0,
        "bones/334/AnimTacle_5.json": !0,
        "bones/334/AnimTacle_5.png": !0,
        "bones/337/AnimTacle_5.json": !0,
        "bones/337/AnimTacle_5.png": !0,
        "bones/342/AnimAttaque1203_1.json": !0,
        "bones/342/AnimAttaque1203_1.png": !0,
        "bones/342/AnimAttaque1203_5.json": !0,
        "bones/342/AnimAttaque1203_5.png": !0,
        "bones/342/AnimTacle_1.json": !0,
        "bones/342/AnimTacle_1.png": !0,
        "bones/342/AnimTacle_5.json": !0,
        "bones/342/AnimTacle_5.png": !0,
        "bones/343/AnimTacle_1.json": !0,
        "bones/343/AnimTacle_1.png": !0,
        "bones/343/AnimTacle_5.json": !0,
        "bones/343/AnimTacle_5.png": !0,
        "bones/346/AnimTacle_1.json": !0,
        "bones/346/AnimTacle_1.png": !0,
        "bones/346/AnimTacle_5.json": !0,
        "bones/346/AnimTacle_5.png": !0,
        "bones/347/AnimTacle_1.json": !0,
        "bones/347/AnimTacle_1.png": !0,
        "bones/347/AnimTacle_5.json": !0,
        "bones/347/AnimTacle_5.png": !0,
        "bones/348/AnimTacle_1.json": !0,
        "bones/348/AnimTacle_1.png": !0,
        "bones/348/AnimTacle_5.json": !0,
        "bones/348/AnimTacle_5.png": !0,
        "bones/349/AnimTacle_1.json": !0,
        "bones/349/AnimTacle_1.png": !0,
        "bones/349/AnimTacle_5.json": !0,
        "bones/349/AnimTacle_5.png": !0,
        "bones/350/AnimTacle_1.json": !0,
        "bones/350/AnimTacle_1.png": !0,
        "bones/350/AnimTacle_5.json": !0,
        "bones/350/AnimTacle_5.png": !0,
        "bones/351/AnimTacle_1.json": !0,
        "bones/351/AnimTacle_1.png": !0,
        "bones/351/AnimTacle_5.json": !0,
        "bones/351/AnimTacle_5.png": !0,
        "bones/352/AnimTacle_5.json": !0,
        "bones/352/AnimTacle_5.png": !0,
        "bones/353/AnimTacle_1.json": !0,
        "bones/353/AnimTacle_1.png": !0,
        "bones/353/AnimTacle_5.json": !0,
        "bones/353/AnimTacle_5.png": !0,
        "bones/354/AnimTacle_1.json": !0,
        "bones/354/AnimTacle_1.png": !0,
        "bones/354/AnimTacle_5.json": !0,
        "bones/354/AnimTacle_5.png": !0,
        "bones/355/AnimTacle_1.json": !0,
        "bones/355/AnimTacle_1.png": !0,
        "bones/355/AnimTacle_5.json": !0,
        "bones/355/AnimTacle_5.png": !0,
        "bones/356/AnimTacle_1.json": !0,
        "bones/356/AnimTacle_1.png": !0,
        "bones/356/AnimTacle_5.json": !0,
        "bones/356/AnimTacle_5.png": !0,
        "bones/357/AnimTacle_1.json": !0,
        "bones/357/AnimTacle_1.png": !0,
        "bones/357/AnimTacle_5.json": !0,
        "bones/357/AnimTacle_5.png": !0,
        "bones/363/AnimTacle_5.json": !0,
        "bones/363/AnimTacle_5.png": !0,
        "bones/364/AnimTacle_1.json": !0,
        "bones/364/AnimTacle_1.png": !0,
        "bones/364/AnimTacle_5.json": !0,
        "bones/364/AnimTacle_5.png": !0,
        "bones/372/AnimTacle_1.json": !0,
        "bones/372/AnimTacle_1.png": !0,
        "bones/373/AnimTacle_5.json": !0,
        "bones/373/AnimTacle_5.png": !0,
        "bones/377/AnimTacle_1.json": !0,
        "bones/377/AnimTacle_1.png": !0,
        "bones/377/AnimTacle_5.json": !0,
        "bones/377/AnimTacle_5.png": !0,
        "bones/379/AnimTacle_5.json": !0,
        "bones/379/AnimTacle_5.png": !0,
        "bones/380/AnimTacle_1.json": !0,
        "bones/380/AnimTacle_1.png": !0,
        "bones/380/AnimTacle_5.json": !0,
        "bones/380/AnimTacle_5.png": !0,
        "bones/381/AnimTacle_1.json": !0,
        "bones/381/AnimTacle_1.png": !0,
        "bones/381/AnimTacle_5.json": !0,
        "bones/381/AnimTacle_5.png": !0,
        "bones/382/AnimTacle_1.json": !0,
        "bones/382/AnimTacle_1.png": !0,
        "bones/382/AnimTacle_5.json": !0,
        "bones/382/AnimTacle_5.png": !0,
        "bones/383/AnimTacle_1.json": !0,
        "bones/383/AnimTacle_1.png": !0,
        "bones/383/AnimTacle_5.json": !0,
        "bones/383/AnimTacle_5.png": !0,
        "bones/384/AnimTacle_1.json": !0,
        "bones/384/AnimTacle_1.png": !0,
        "bones/384/AnimTacle_5.json": !0,
        "bones/384/AnimTacle_5.png": !0,
        "bones/385/AnimTacle_5.json": !0,
        "bones/385/AnimTacle_5.png": !0,
        "bones/386/AnimTacle_1.json": !0,
        "bones/386/AnimTacle_1.png": !0,
        "bones/387/AnimTacle_5.json": !0,
        "bones/387/AnimTacle_5.png": !0,
        "bones/388/AnimTacle_1.json": !0,
        "bones/388/AnimTacle_1.png": !0,
        "bones/388/AnimTacle_5.json": !0,
        "bones/388/AnimTacle_5.png": !0,
        "bones/389/AnimTacle_1.json": !0,
        "bones/389/AnimTacle_1.png": !0,
        "bones/389/AnimTacle_5.json": !0,
        "bones/389/AnimTacle_5.png": !0,
        "bones/396/AnimTacle_1.json": !0,
        "bones/396/AnimTacle_1.png": !0,
        "bones/396/AnimTacle_5.json": !0,
        "bones/396/AnimTacle_5.png": !0,
        "bones/40/AnimCueillirSol1_1.json": !0,
        "bones/40/AnimCueillirSol1_1.png": !0,
        "bones/40/AnimCueillirSol1_5.json": !0,
        "bones/40/AnimCueillirSol1_5.png": !0,
        "bones/403/AnimTacle_1.json": !0,
        "bones/403/AnimTacle_1.png": !0,
        "bones/403/AnimTacle_5.json": !0,
        "bones/403/AnimTacle_5.png": !0,
        "bones/405/AnimTacle_1.json": !0,
        "bones/405/AnimTacle_1.png": !0,
        "bones/405/AnimTacle_5.json": !0,
        "bones/405/AnimTacle_5.png": !0,
        "bones/406/AnimTacle_1.json": !0,
        "bones/406/AnimTacle_1.png": !0,
        "bones/406/AnimTacle_5.json": !0,
        "bones/406/AnimTacle_5.png": !0,
        "bones/407/AnimTacle_1.json": !0,
        "bones/407/AnimTacle_1.png": !0,
        "bones/407/AnimTacle_5.json": !0,
        "bones/407/AnimTacle_5.png": !0,
        "bones/408/AnimTacle_1.json": !0,
        "bones/408/AnimTacle_1.png": !0,
        "bones/408/AnimTacle_5.json": !0,
        "bones/408/AnimTacle_5.png": !0,
        "bones/409/AnimTacle_1.json": !0,
        "bones/409/AnimTacle_1.png": !0,
        "bones/409/AnimTacle_5.json": !0,
        "bones/409/AnimTacle_5.png": !0,
        "bones/410/AnimTacle_1.json": !0,
        "bones/410/AnimTacle_1.png": !0,
        "bones/410/AnimTacle_5.json": !0,
        "bones/410/AnimTacle_5.png": !0,
        "bones/411/AnimTacle_1.json": !0,
        "bones/411/AnimTacle_1.png": !0,
        "bones/411/AnimTacle_5.json": !0,
        "bones/411/AnimTacle_5.png": !0,
        "bones/412/AnimTacle_1.json": !0,
        "bones/412/AnimTacle_1.png": !0,
        "bones/412/AnimTacle_5.json": !0,
        "bones/412/AnimTacle_5.png": !0,
        "bones/413/AnimTacle_1.json": !0,
        "bones/413/AnimTacle_1.png": !0,
        "bones/413/AnimTacle_5.json": !0,
        "bones/413/AnimTacle_5.png": !0,
        "bones/415/AnimTacle_1.json": !0,
        "bones/415/AnimTacle_1.png": !0,
        "bones/415/AnimTacle_5.json": !0,
        "bones/415/AnimTacle_5.png": !0,
        "bones/416/AnimTacle_5.json": !0,
        "bones/416/AnimTacle_5.png": !0,
        "bones/421/AnimTacle_1.json": !0,
        "bones/421/AnimTacle_1.png": !0,
        "bones/421/AnimTacle_5.json": !0,
        "bones/421/AnimTacle_5.png": !0,
        "bones/423/AnimTacle_1.json": !0,
        "bones/423/AnimTacle_1.png": !0,
        "bones/424/AnimTacle_5.json": !0,
        "bones/424/AnimTacle_5.png": !0,
        "bones/426/AnimTacle_1.json": !0,
        "bones/426/AnimTacle_1.png": !0,
        "bones/426/AnimTacle_5.json": !0,
        "bones/426/AnimTacle_5.png": !0,
        "bones/427/AnimTacle_1.json": !0,
        "bones/427/AnimTacle_1.png": !0,
        "bones/427/AnimTacle_5.json": !0,
        "bones/427/AnimTacle_5.png": !0,
        "bones/428/AnimTacle_1.json": !0,
        "bones/428/AnimTacle_1.png": !0,
        "bones/428/AnimTacle_5.json": !0,
        "bones/428/AnimTacle_5.png": !0,
        "bones/429/AnimTacle_1.json": !0,
        "bones/429/AnimTacle_1.png": !0,
        "bones/429/AnimTacle_5.json": !0,
        "bones/429/AnimTacle_5.png": !0,
        "bones/43/AnimTacle_1.json": !0,
        "bones/43/AnimTacle_1.png": !0,
        "bones/433/AnimTacle_1.json": !0,
        "bones/433/AnimTacle_1.png": !0,
        "bones/433/AnimTacle_5.json": !0,
        "bones/433/AnimTacle_5.png": !0,
        "bones/434/AnimTacle_1.json": !0,
        "bones/434/AnimTacle_1.png": !0,
        "bones/436/AnimTacle_1.json": !0,
        "bones/436/AnimTacle_1.png": !0,
        "bones/436/AnimTacle_5.json": !0,
        "bones/436/AnimTacle_5.png": !0,
        "bones/437/AnimTacle_1.json": !0,
        "bones/437/AnimTacle_1.png": !0,
        "bones/437/AnimTacle_5.json": !0,
        "bones/437/AnimTacle_5.png": !0,
        "bones/44/AnimAttaque1210_5.json": !0,
        "bones/44/AnimAttaque1210_5.png": !0,
        "bones/44/AnimEmoteSit_0_5.json": !0,
        "bones/44/AnimEmoteSit_0_5.png": !0,
        "bones/44/AnimPeche_1.json": !0,
        "bones/44/AnimPeche_1.png": !0,
        "bones/44/AnimPeche_5.json": !0,
        "bones/44/AnimPeche_5.png": !0,
        "bones/441/AnimTacle_1.json": !0,
        "bones/441/AnimTacle_1.png": !0,
        "bones/441/AnimTacle_5.json": !0,
        "bones/441/AnimTacle_5.png": !0,
        "bones/442/AnimTacle_1.json": !0,
        "bones/442/AnimTacle_1.png": !0,
        "bones/442/AnimTacle_5.json": !0,
        "bones/442/AnimTacle_5.png": !0,
        "bones/443/AnimTacle_5.json": !0,
        "bones/443/AnimTacle_5.png": !0,
        "bones/444/AnimTacle_1.json": !0,
        "bones/444/AnimTacle_1.png": !0,
        "bones/444/AnimTacle_5.json": !0,
        "bones/444/AnimTacle_5.png": !0,
        "bones/445/AnimTacle_1.json": !0,
        "bones/445/AnimTacle_1.png": !0,
        "bones/445/AnimTacle_5.json": !0,
        "bones/445/AnimTacle_5.png": !0,
        "bones/45/AnimTacle_1.json": !0,
        "bones/45/AnimTacle_1.png": !0,
        "bones/45/AnimTacle_5.json": !0,
        "bones/45/AnimTacle_5.png": !0,
        "bones/452/AnimTacle_1.json": !0,
        "bones/452/AnimTacle_1.png": !0,
        "bones/452/AnimTacle_5.json": !0,
        "bones/452/AnimTacle_5.png": !0,
        "bones/453/AnimAttaque603_1.json": !0,
        "bones/453/AnimAttaque603_1.png": !0,
        "bones/453/AnimAttaque603_5.json": !0,
        "bones/453/AnimAttaque603_5.png": !0,
        "bones/453/AnimTacle_1.json": !0,
        "bones/453/AnimTacle_1.png": !0,
        "bones/453/AnimTacle_5.json": !0,
        "bones/453/AnimTacle_5.png": !0,
        "bones/455/AnimTacle_5.json": !0,
        "bones/455/AnimTacle_5.png": !0,
        "bones/456/AnimTacle_1.json": !0,
        "bones/456/AnimTacle_1.png": !0,
        "bones/456/AnimTacle_5.json": !0,
        "bones/456/AnimTacle_5.png": !0,
        "bones/457/AnimTacle_1.json": !0,
        "bones/457/AnimTacle_1.png": !0,
        "bones/457/AnimTacle_5.json": !0,
        "bones/457/AnimTacle_5.png": !0,
        "bones/458/AnimTacle_1.json": !0,
        "bones/458/AnimTacle_1.png": !0,
        "bones/458/AnimTacle_5.json": !0,
        "bones/458/AnimTacle_5.png": !0,
        "bones/459/AnimTacle_1.json": !0,
        "bones/459/AnimTacle_1.png": !0,
        "bones/459/AnimTacle_5.json": !0,
        "bones/459/AnimTacle_5.png": !0,
        "bones/460/AnimTacle_1.json": !0,
        "bones/460/AnimTacle_1.png": !0,
        "bones/460/AnimTacle_5.json": !0,
        "bones/460/AnimTacle_5.png": !0,
        "bones/461/AnimTacle_5.json": !0,
        "bones/461/AnimTacle_5.png": !0,
        "bones/462/AnimTacle_1.json": !0,
        "bones/462/AnimTacle_1.png": !0,
        "bones/462/AnimTacle_5.json": !0,
        "bones/462/AnimTacle_5.png": !0,
        "bones/463/AnimTacle_1.json": !0,
        "bones/463/AnimTacle_1.png": !0,
        "bones/464/AnimTacle_1.json": !0,
        "bones/464/AnimTacle_1.png": !0,
        "bones/464/AnimTacle_5.json": !0,
        "bones/464/AnimTacle_5.png": !0,
        "bones/465/AnimTacle_5.json": !0,
        "bones/465/AnimTacle_5.png": !0,
        "bones/469/AnimTacle_1.json": !0,
        "bones/469/AnimTacle_1.png": !0,
        "bones/469/AnimTacle_5.json": !0,
        "bones/469/AnimTacle_5.png": !0,
        "bones/47/AnimTacle_1.json": !0,
        "bones/47/AnimTacle_1.png": !0,
        "bones/47/AnimTacle_5.json": !0,
        "bones/47/AnimTacle_5.png": !0,
        "bones/476/AnimTacle_5.json": !0,
        "bones/476/AnimTacle_5.png": !0,
        "bones/477/AnimTacle_1.json": !0,
        "bones/477/AnimTacle_1.png": !0,
        "bones/477/AnimTacle_5.json": !0,
        "bones/477/AnimTacle_5.png": !0,
        "bones/480/AnimTacle_1.json": !0,
        "bones/480/AnimTacle_1.png": !0,
        "bones/480/AnimTacle_5.json": !0,
        "bones/480/AnimTacle_5.png": !0,
        "bones/482/AnimTacle_1.json": !0,
        "bones/482/AnimTacle_1.png": !0,
        "bones/482/AnimTacle_5.json": !0,
        "bones/482/AnimTacle_5.png": !0,
        "bones/484/AnimTacle_1.json": !0,
        "bones/484/AnimTacle_1.png": !0,
        "bones/484/AnimTacle_5.json": !0,
        "bones/484/AnimTacle_5.png": !0,
        "bones/486/AnimTacle_1.json": !0,
        "bones/486/AnimTacle_1.png": !0,
        "bones/489/AnimTacle_1.json": !0,
        "bones/489/AnimTacle_1.png": !0,
        "bones/489/AnimTacle_5.json": !0,
        "bones/489/AnimTacle_5.png": !0,
        "bones/492/AnimTacle_1.json": !0,
        "bones/492/AnimTacle_1.png": !0,
        "bones/492/AnimTacle_5.json": !0,
        "bones/492/AnimTacle_5.png": !0,
        "bones/493/AnimTacle_1.json": !0,
        "bones/493/AnimTacle_1.png": !0,
        "bones/493/AnimTacle_5.json": !0,
        "bones/493/AnimTacle_5.png": !0,
        "bones/494/AnimTacle_1.json": !0,
        "bones/494/AnimTacle_1.png": !0,
        "bones/494/AnimTacle_5.json": !0,
        "bones/494/AnimTacle_5.png": !0,
        "bones/498/AnimTacle_1.json": !0,
        "bones/498/AnimTacle_1.png": !0,
        "bones/498/AnimTacle_5.json": !0,
        "bones/498/AnimTacle_5.png": !0,
        "bones/499/AnimTacle_1.json": !0,
        "bones/499/AnimTacle_1.png": !0,
        "bones/51/AnimTacle_1.json": !0,
        "bones/51/AnimTacle_1.png": !0,
        "bones/51/AnimTacle_5.json": !0,
        "bones/51/AnimTacle_5.png": !0,
        "bones/512/AnimTacle_1.json": !0,
        "bones/512/AnimTacle_1.png": !0,
        "bones/512/AnimTacle_5.json": !0,
        "bones/512/AnimTacle_5.png": !0,
        "bones/513/AnimTacle_1.json": !0,
        "bones/513/AnimTacle_1.png": !0,
        "bones/52/AnimTacle_1.json": !0,
        "bones/52/AnimTacle_1.png": !0,
        "bones/52/AnimTacle_5.json": !0,
        "bones/52/AnimTacle_5.png": !0,
        "bones/521/AnimTacle_1.json": !0,
        "bones/521/AnimTacle_1.png": !0,
        "bones/521/AnimTacle_5.json": !0,
        "bones/521/AnimTacle_5.png": !0,
        "bones/523/AnimTacle_1.json": !0,
        "bones/523/AnimTacle_1.png": !0,
        "bones/525/AnimTacle_1.json": !0,
        "bones/525/AnimTacle_1.png": !0,
        "bones/525/AnimTacle_5.json": !0,
        "bones/525/AnimTacle_5.png": !0,
        "bones/526/AnimTacle_1.json": !0,
        "bones/526/AnimTacle_1.png": !0,
        "bones/526/AnimTacle_5.json": !0,
        "bones/526/AnimTacle_5.png": !0,
        "bones/528/AnimTacle_1.json": !0,
        "bones/528/AnimTacle_1.png": !0,
        "bones/528/AnimTacle_5.json": !0,
        "bones/528/AnimTacle_5.png": !0,
        "bones/531/AnimTacle_1.json": !0,
        "bones/531/AnimTacle_1.png": !0,
        "bones/531/AnimTacle_5.json": !0,
        "bones/531/AnimTacle_5.png": !0,
        "bones/532/AnimTacle_1.json": !0,
        "bones/532/AnimTacle_1.png": !0,
        "bones/532/AnimTacle_5.json": !0,
        "bones/532/AnimTacle_5.png": !0,
        "bones/533/AnimTacle_1.json": !0,
        "bones/533/AnimTacle_1.png": !0,
        "bones/533/AnimTacle_5.json": !0,
        "bones/533/AnimTacle_5.png": !0,
        "bones/534/AnimTacle_1.json": !0,
        "bones/534/AnimTacle_1.png": !0,
        "bones/534/AnimTacle_5.json": !0,
        "bones/534/AnimTacle_5.png": !0,
        "bones/535/AnimTacle_5.json": !0,
        "bones/535/AnimTacle_5.png": !0,
        "bones/536/AnimTacle_1.json": !0,
        "bones/536/AnimTacle_1.png": !0,
        "bones/539/AnimTacle_1.json": !0,
        "bones/539/AnimTacle_1.png": !0,
        "bones/539/AnimTacle_5.json": !0,
        "bones/539/AnimTacle_5.png": !0,
        "bones/540/AnimTacle_1.json": !0,
        "bones/540/AnimTacle_1.png": !0,
        "bones/540/AnimTacle_5.json": !0,
        "bones/540/AnimTacle_5.png": !0,
        "bones/547/AnimTacle_1.json": !0,
        "bones/547/AnimTacle_1.png": !0,
        "bones/547/AnimTacle_5.json": !0,
        "bones/547/AnimTacle_5.png": !0,
        "bones/548/AnimTacle_1.json": !0,
        "bones/548/AnimTacle_1.png": !0,
        "bones/549/AnimTacle_1.json": !0,
        "bones/549/AnimTacle_1.png": !0,
        "bones/550/AnimTacle_1.json": !0,
        "bones/550/AnimTacle_1.png": !0,
        "bones/550/AnimTacle_5.json": !0,
        "bones/550/AnimTacle_5.png": !0,
        "bones/551/AnimTacle_1.json": !0,
        "bones/551/AnimTacle_1.png": !0,
        "bones/551/AnimTacle_5.json": !0,
        "bones/551/AnimTacle_5.png": !0,
        "bones/552/AnimTacle_1.json": !0,
        "bones/552/AnimTacle_1.png": !0,
        "bones/554/AnimTacle_1.json": !0,
        "bones/554/AnimTacle_1.png": !0,
        "bones/557/AnimAttaque3_5.json": !0,
        "bones/557/AnimAttaque3_5.png": !0,
        "bones/557/AnimTacle_1.json": !0,
        "bones/557/AnimTacle_1.png": !0,
        "bones/557/AnimTacle_5.json": !0,
        "bones/557/AnimTacle_5.png": !0,
        "bones/558/AnimAttaque3_5.json": !0,
        "bones/558/AnimAttaque3_5.png": !0,
        "bones/559/AnimTacle_1.json": !0,
        "bones/559/AnimTacle_1.png": !0,
        "bones/559/AnimTacle_5.json": !0,
        "bones/559/AnimTacle_5.png": !0,
        "bones/560/AnimCueillir0_1.json": !0,
        "bones/560/AnimCueillir0_1.png": !0,
        "bones/560/AnimCueillir0_5.json": !0,
        "bones/560/AnimCueillir0_5.png": !0,
        "bones/560/AnimEmoteBeer_0_1.json": !0,
        "bones/560/AnimEmoteBeer_0_1.png": !0,
        "bones/560/AnimEmoteBeer_0_5.json": !0,
        "bones/560/AnimEmoteBeer_0_5.png": !0,
        "bones/560/AnimEmoteDrink_0_1.json": !0,
        "bones/560/AnimEmoteDrink_0_1.png": !0,
        "bones/560/AnimEmoteDrink_0_5.json": !0,
        "bones/560/AnimEmoteDrink_0_5.png": !0,
        "bones/560/AnimEmoteEat_0_1.json": !0,
        "bones/560/AnimEmoteEat_0_1.png": !0,
        "bones/560/AnimEmoteEat_0_5.json": !0,
        "bones/560/AnimEmoteEat_0_5.png": !0,
        "bones/560/AnimEmoteRest_0_1.json": !0,
        "bones/560/AnimEmoteRest_0_1.png": !0,
        "bones/560/AnimEmoteSit_0_1.json": !0,
        "bones/560/AnimEmoteSit_0_1.png": !0,
        "bones/560/AnimEmoteSit_0_5.json": !0,
        "bones/560/AnimEmoteSit_0_5.png": !0,
        "bones/560/AnimHache_1.json": !0,
        "bones/560/AnimHache_1.png": !0,
        "bones/560/AnimHache_5.json": !0,
        "bones/560/AnimHache_5.png": !0,
        "bones/560/AnimPioche_5.json": !0,
        "bones/560/AnimPioche_5.png": !0,
        "bones/561/AnimTacle_1.json": !0,
        "bones/561/AnimTacle_1.png": !0,
        "bones/561/AnimTacle_5.json": !0,
        "bones/561/AnimTacle_5.png": !0,
        "bones/562/AnimTacle_1.json": !0,
        "bones/562/AnimTacle_1.png": !0,
        "bones/562/AnimTacle_5.json": !0,
        "bones/562/AnimTacle_5.png": !0,
        "bones/566/AnimTacle_1.json": !0,
        "bones/566/AnimTacle_1.png": !0,
        "bones/566/AnimTacle_5.json": !0,
        "bones/566/AnimTacle_5.png": !0,
        "bones/570/AnimCueillir0_1.json": !0,
        "bones/570/AnimCueillir0_1.png": !0,
        "bones/570/AnimCueillir0_5.json": !0,
        "bones/570/AnimCueillir0_5.png": !0,
        "bones/570/AnimCueillirSol0_1.json": !0,
        "bones/570/AnimCueillirSol0_1.png": !0,
        "bones/570/AnimCueillirSol0_5.json": !0,
        "bones/570/AnimCueillirSol0_5.png": !0,
        "bones/570/AnimEmoteDrink_0_1.json": !0,
        "bones/570/AnimEmoteDrink_0_1.png": !0,
        "bones/571/AnimTacle_1.json": !0,
        "bones/571/AnimTacle_1.png": !0,
        "bones/571/AnimTacle_5.json": !0,
        "bones/571/AnimTacle_5.png": !0,
        "bones/572/AnimTacle_5.json": !0,
        "bones/572/AnimTacle_5.png": !0,
        "bones/573/AnimTacle_1.json": !0,
        "bones/573/AnimTacle_1.png": !0,
        "bones/574/AnimTacle_1.json": !0,
        "bones/574/AnimTacle_1.png": !0,
        "bones/576/AnimTacle_1.json": !0,
        "bones/576/AnimTacle_1.png": !0,
        "bones/576/AnimTacle_5.json": !0,
        "bones/576/AnimTacle_5.png": !0,
        "bones/577/AnimTacle_1.json": !0,
        "bones/577/AnimTacle_1.png": !0,
        "bones/577/AnimTacle_5.json": !0,
        "bones/577/AnimTacle_5.png": !0,
        "bones/578/AnimTacle_1.json": !0,
        "bones/578/AnimTacle_1.png": !0,
        "bones/578/AnimTacle_5.json": !0,
        "bones/578/AnimTacle_5.png": !0,
        "bones/579/AnimTacle_1.json": !0,
        "bones/579/AnimTacle_1.png": !0,
        "bones/579/AnimTacle_5.json": !0,
        "bones/579/AnimTacle_5.png": !0,
        "bones/580/AnimTacle_1.json": !0,
        "bones/580/AnimTacle_1.png": !0,
        "bones/580/AnimTacle_5.json": !0,
        "bones/580/AnimTacle_5.png": !0,
        "bones/581/AnimTacle_1.json": !0,
        "bones/581/AnimTacle_1.png": !0,
        "bones/581/AnimTacle_5.json": !0,
        "bones/581/AnimTacle_5.png": !0,
        "bones/583/AnimTacle_5.json": !0,
        "bones/583/AnimTacle_5.png": !0,
        "bones/585/AnimTacle_1.json": !0,
        "bones/585/AnimTacle_1.png": !0,
        "bones/585/AnimTacle_5.json": !0,
        "bones/585/AnimTacle_5.png": !0,
        "bones/586/AnimTacle_1.json": !0,
        "bones/586/AnimTacle_1.png": !0,
        "bones/587/AnimTacle_1.json": !0,
        "bones/587/AnimTacle_1.png": !0,
        "bones/588/AnimTacle_1.json": !0,
        "bones/588/AnimTacle_1.png": !0,
        "bones/594/AnimTacle_1.json": !0,
        "bones/594/AnimTacle_1.png": !0,
        "bones/594/AnimTacle_5.json": !0,
        "bones/594/AnimTacle_5.png": !0,
        "bones/601/AnimTacle_1.json": !0,
        "bones/601/AnimTacle_1.png": !0,
        "bones/609/AnimTacle_1.json": !0,
        "bones/609/AnimTacle_1.png": !0,
        "bones/609/AnimTacle_5.json": !0,
        "bones/609/AnimTacle_5.png": !0,
        "bones/611/AnimTacle_1.json": !0,
        "bones/611/AnimTacle_1.png": !0,
        "bones/611/AnimTacle_5.json": !0,
        "bones/611/AnimTacle_5.png": !0,
        "bones/620/AnimTacle_5.json": !0,
        "bones/620/AnimTacle_5.png": !0,
        "bones/624/AnimTacle_1.json": !0,
        "bones/624/AnimTacle_1.png": !0,
        "bones/625/AnimTacle_1.json": !0,
        "bones/625/AnimTacle_1.png": !0,
        "bones/627/AnimTacle_1.json": !0,
        "bones/627/AnimTacle_1.png": !0,
        "bones/627/AnimTacle_5.json": !0,
        "bones/627/AnimTacle_5.png": !0,
        "bones/63/AnimTacle_5.json": !0,
        "bones/63/AnimTacle_5.png": !0,
        "bones/630/AnimTacle_5.json": !0,
        "bones/630/AnimTacle_5.png": !0,
        "bones/631/AnimTacle_1.json": !0,
        "bones/631/AnimTacle_1.png": !0,
        "bones/631/AnimTacle_5.json": !0,
        "bones/631/AnimTacle_5.png": !0,
        "bones/632/AnimTacle_1.json": !0,
        "bones/632/AnimTacle_1.png": !0,
        "bones/632/AnimTacle_5.json": !0,
        "bones/632/AnimTacle_5.png": !0,
        "bones/633/AnimTacle_1.json": !0,
        "bones/633/AnimTacle_1.png": !0,
        "bones/633/AnimTacle_5.json": !0,
        "bones/633/AnimTacle_5.png": !0,
        "bones/639/AnimAttaque1001_1.json": !0,
        "bones/639/AnimAttaque1001_1.png": !0,
        "bones/639/AnimAttaque101_1.json": !0,
        "bones/639/AnimAttaque101_1.png": !0,
        "bones/639/AnimAttaque1102_1.json": !0,
        "bones/639/AnimAttaque1102_1.png": !0,
        "bones/639/AnimAttaque1102_5.json": !0,
        "bones/639/AnimAttaque1102_5.png": !0,
        "bones/639/AnimAttaque1103_1.json": !0,
        "bones/639/AnimAttaque1103_1.png": !0,
        "bones/639/AnimAttaque201_1.json": !0,
        "bones/639/AnimAttaque201_5.json": !0,
        "bones/639/AnimAttaque201_5.png": !0,
        "bones/639/AnimAttaque2_5.json": !0,
        "bones/639/AnimAttaque2_5.png": !0,
        "bones/639/AnimAttaque501_5.json": !0,
        "bones/639/AnimAttaque501_5.png": !0,
        "bones/639/AnimAttaque602_5.json": !0,
        "bones/639/AnimAttaque602_5.png": !0,
        "bones/639/AnimAttaque7_1.json": !0,
        "bones/639/AnimAttaque7_1.png": !0,
        "bones/639/AnimAttaque7_5.json": !0,
        "bones/639/AnimAttaque7_5.png": !0,
        "bones/639/AnimAttaque801_1.json": !0,
        "bones/639/AnimAttaque801_1.png": !0,
        "bones/639/AnimAttaque801_5.json": !0,
        "bones/639/AnimAttaque801_5.png": !0,
        "bones/639/AnimAttaque803_1.json": !0,
        "bones/639/AnimAttaque803_1.png": !0,
        "bones/639/AnimAttaque803_5.json": !0,
        "bones/639/AnimAttaque803_5.png": !0,
        "bones/639/AnimAttaque8_5.json": !0,
        "bones/639/AnimAttaque8_5.png": !0,
        "bones/639/AnimAttaque902_5.json": !0,
        "bones/639/AnimAttaque902_5.png": !0,
        "bones/639/AnimAttaque9_1.json": !0,
        "bones/639/AnimAttaque9_1.png": !0,
        "bones/639/AnimAttaque9_5.json": !0,
        "bones/639/AnimAttaque9_5.png": !0,
        "bones/639/AnimCueillir0_1.json": !0,
        "bones/639/AnimCueillir0_1.png": !0,
        "bones/639/AnimCueillir0_5.json": !0,
        "bones/639/AnimCueillir0_5.png": !0,
        "bones/639/AnimCueillirSol0_1.json": !0,
        "bones/639/AnimCueillirSol0_1.png": !0,
        "bones/639/AnimCueillirSol0_5.json": !0,
        "bones/639/AnimCueillirSol0_5.png": !0,
        "bones/639/AnimEmoteAlliance_0_1.json": !0,
        "bones/639/AnimEmoteAlliance_0_1.png": !0,
        "bones/639/AnimEmoteAlliance_0_5.json": !0,
        "bones/639/AnimEmoteAlliance_0_5.png": !0,
        "bones/639/AnimEmoteGuild_0_1.json": !0,
        "bones/639/AnimEmoteGuild_0_1.png": !0,
        "bones/639/AnimEmoteGuild_0_5.json": !0,
        "bones/639/AnimEmoteGuild_0_5.png": !0,
        "bones/639/AnimEmoteWeap_0_1.json": !0,
        "bones/639/AnimEmoteWeap_0_1.png": !0,
        "bones/639/AnimHache_1.json": !0,
        "bones/639/AnimHache_1.png": !0,
        "bones/639/AnimHache_5.json": !0,
        "bones/639/AnimHache_5.png": !0,
        "bones/639/AnimHit_0.json": !0,
        "bones/639/AnimHit_0.png": !0,
        "bones/639/AnimHit_2.json": !0,
        "bones/639/AnimHit_2.png": !0,
        "bones/639/AnimHit_6.json": !0,
        "bones/639/AnimHit_6.png": !0,
        "bones/639/AnimMort_0.json": !0,
        "bones/639/AnimMort_0.png": !0,
        "bones/639/AnimPickup_1.png": !0,
        "bones/639/AnimPioche_1.json": !0,
        "bones/639/AnimPioche_1.png": !0,
        "bones/639/AnimPioche_5.json": !0,
        "bones/639/AnimPioche_5.png": !0,
        "bones/639/AnimThrow_5.png": !0,
        "bones/643/AnimTacle_5.json": !0,
        "bones/643/AnimTacle_5.png": !0,
        "bones/644/AnimTacle_1.json": !0,
        "bones/644/AnimTacle_1.png": !0,
        "bones/68/AnimTacle_1.json": !0,
        "bones/68/AnimTacle_1.png": !0,
        "bones/68/AnimTacle_5.json": !0,
        "bones/68/AnimTacle_5.png": !0,
        "bones/69/AnimTacle_1.json": !0,
        "bones/69/AnimTacle_1.png": !0,
        "bones/69/AnimTacle_5.json": !0,
        "bones/69/AnimTacle_5.png": !0,
        "bones/706/AnimTacle_1.json": !0,
        "bones/706/AnimTacle_1.png": !0,
        "bones/706/AnimTacle_5.json": !0,
        "bones/706/AnimTacle_5.png": !0,
        "bones/708/AnimTacle_1.json": !0,
        "bones/708/AnimTacle_1.png": !0,
        "bones/78/AnimTacle_1.json": !0,
        "bones/78/AnimTacle_1.png": !0,
        "bones/78/AnimTacle_5.json": !0,
        "bones/78/AnimTacle_5.png": !0,
        "bones/79/AnimTacle_1.json": !0,
        "bones/79/AnimTacle_1.png": !0,
        "bones/81/AnimTacle_1.json": !0,
        "bones/81/AnimTacle_1.png": !0,
        "bones/81/AnimTacle_5.json": !0,
        "bones/81/AnimTacle_5.png": !0,
        "bones/834/AnimTacle_1.json": !0,
        "bones/834/AnimTacle_1.png": !0,
        "bones/834/AnimTacle_5.json": !0,
        "bones/834/AnimTacle_5.png": !0,
        "bones/839/AnimTacle_1.json": !0,
        "bones/839/AnimTacle_1.png": !0,
        "bones/839/AnimTacle_5.json": !0,
        "bones/839/AnimTacle_5.png": !0,
        "bones/840/AnimTacle_1.json": !0,
        "bones/840/AnimTacle_1.png": !0,
        "bones/840/AnimTacle_5.json": !0,
        "bones/840/AnimTacle_5.png": !0,
        "bones/85/AnimTacle_1.json": !0,
        "bones/85/AnimTacle_1.png": !0,
        "bones/85/AnimTacle_5.json": !0,
        "bones/85/AnimTacle_5.png": !0,
        "bones/889/AnimTacle_1.json": !0,
        "bones/889/AnimTacle_1.png": !0,
        "bones/889/AnimTacle_5.json": !0,
        "bones/889/AnimTacle_5.png": !0,
        "bones/892/AnimAttaque2_1.json": !0,
        "bones/892/AnimAttaque2_1.png": !0,
        "bones/892/AnimAttaque2_5.json": !0,
        "bones/892/AnimAttaque2_5.png": !0,
        "bones/892/AnimTacle_1.json": !0,
        "bones/892/AnimTacle_1.png": !0,
        "bones/892/AnimTacle_5.json": !0,
        "bones/892/AnimTacle_5.png": !0,
        "bones/91/AnimTacle_1.json": !0,
        "bones/91/AnimTacle_1.png": !0,
        "bones/91/AnimTacle_5.json": !0,
        "bones/91/AnimTacle_5.png": !0,
        "gfx/monsters/1122.png": !0,
        "gfx/monsters/3203.png": !0,
        "skins/0.json": !0,
        "skins/0.png": !0,
        "skins/919.json": !0,
        "skins/919.png": !0
    }
}
, function(e, t, i) {
    function n(e) {
        if (!window.Config.sessionId)
            return console.warn("Cannot make URL sticky (no session ID has been set):", e),
            e;
        var t = e.indexOf("?") === -1 ? "?" : "&";
        return e + t + M + "=" + encodeURIComponent(window.Config.sessionId)
    }
    function o() {
        var e = window.appInfo || {};
        return e.server ? e.server : "https://proxyconnection.touch.dofus.com"
    }
    function s(e) {
        for (var t = 0; t < R.length; t += 1) {
            var i = R[t];
            if (i.id === e)
                return i
        }
    }
    function a(e, t) {
        var i = window.appInfo && window.appInfo.version || ""
          , n = {
            appVersion: i
        };
        e && (n.lang = e),
        E.stringify(n);
        var s = o() + "/config.json?" + E.stringify(n);
        d.loadJson(s, function(e, i) {
            return e ? t(e) : (i.imgCrossOrigin = i.assetsUrl.match(/^https?:\/\/.+?:.+?@.+?/) ? void 0 : "anonymous",
            void t(null , i))
        })
    }
    function r(e, i) {
        h.auto({
            primus: function(e) {
                return window.Primus ? e() : void d.loadScript(o() + "/primus/primus.js", e)
            },
            config: function(i) {
                return window.Config ? e ? t.setLanguage(e, i) : i() : void a(e, function(e, t) {
                    return e ? i(e) : (window.Config = t,
                    void i())
                })
            },
            syncSetup: ["config", function(e) {
                m.setup(window.Config),
                _.initialize(window.Config),
                e()
            }
            ],
            getText: ["syncSetup", function(e) {
                v.initialize(window.Config, e)
            }
            ]
        }, i)
    }
    function l() {
        C.setupChannels(g.getValue("soundPreferences", {}, !0)),
        C.playLoopSound("music", "20000", .8)
    }
    function c() {
        C.stopAllLoopSounds(),
        C.release()
    }
    function u(e) {
        var t = {
            language: window.Config ? window.Config.language : "en",
            server: e
        };
        return "login" === e && (t.client = "android"),
        t
    }
    var h = i(12)
      , d = i(15)
      , p = i(16).EventEmitter
      , m = i(17)
      , f = i(49)
      , g = i(30)
      , _ = i(36)
      , v = i(35)
      , y = i(50);
    i(56);
    var w = i(154)
      , b = i(155)
      , C = i(84)
      , I = i(156)
      , T = i(157)
      , S = i(158)
      , A = i(181)
      , E = i(41)
      , x = i(7);
    window.developmentMode && i(182);
    var M = "STICKER"
      , N = window.appInfo && window.appInfo.version;
    t = e.exports = new p,
    t.logger = m,
    t.connectionManager = f,
    t.sessionId = null ;
    var R = [];
    t.setLanguage = function(e, t) {
        if (!window.Config || e && window.Config.language === e)
            return t();
        var i = o() + "/getLanguage.json?lang=" + e;
        d.loadJson(i, function(e, i) {
            return e ? t(e) : (window.Config.language = i.language,
            void t())
        })
    }
    ,
    t.start = function() {
        function e() {
            return window.gui.splashScreen.show(),
            window.setTimeout(function() {
                window.gui.splashScreen.hide(),
                t.start()
            }, 6e4)
        }
        window.gui.initialize();
        var i = g.getValue("lang");
        r(i, function(t) {
            return t ? (console.error(t),
            void (navigator.notification ? navigator.notification.alert("Server busy.", e, "Dofus Touch", "Reload") : (window.alert("Server busy."),
            e()))) : (S.init(null),
            A.initialize(window.Config.adjust),
            y.backToLogin(),
            window.gui.initialize(window.Config),
            void (window.isoEngine && window.isoEngine.initialize({
                config: window.Config
            })))
        })
    }
    ;
    var O, P = 0, D = 1, L = 2, B = 3, k = 4, F = P, H = {
        username: null ,
        token: null ,
        salt: null ,
        key: null
    };
    t.setCredentials = function(e, t) {
        g.setValue("token", t),
        H.username = e,
        H.token = t,
        H.salt = null ,
        H.key = null ,
        H.version = N
    }
    ,
    t.login = function(e) {
        if (F === L)
            return console.warn("Already logged in"),
            e();
        if (F === D)
            return console.warn("Already logging in"),
            t.once("loginEnd", e);
        F === k && f.disconnect("SWITCHING_TO_LOGIN"),
        F = D,
        H.salt = null ,
        H.key = null ;
        var i = T(f, function(i) {
            i ? (this.disconnect("LOGIN_ERROR"),
            F = P,
            t.emit("loginEnd", i)) : (F = L,
            t.emit("loginEnd")),
            e(i)
        });
        i("disconnect", function() {
            throw new Error("Disconnect during login")
        }),
        i("open", function() {
            this.send("connecting", u("login"))
        }),
        i("serverDisconnecting", function(e) {
            i.done(e)
        }),
        i("ProtocolRequired", function(e) {
            console.log("[Login server protocol] requiredVersion:", e.requiredVersion, "currentVersion:", e.currentVersion)
        }),
        i("HelloConnectMessage", function(e) {
            H.salt = e.salt,
            H.key = e.key;
            var t = this;
            b.getVersions(function(e, n) {
                return e ? i.done(e) : void t.send("checkAssetsVersion", n)
            })
        }),
        i("assetsVersionChecked", function(e) {
            var t = this;
            b.upgradeAssets(e, function(e) {
                return e ? i.done(e) : void t.send("login", H)
            })
        }),
        i("IdentificationSuccessMessage", "IdentificationSuccessWithLoginTokenMessage", function(e) {
            var i = window.gui.playerData.loginName;
            if (i) {
                if (/^\[GUEST]/.test(i)) {
                    var n = g.getValue("guestAccount", {}, !0);
                    n.nickname = e.nickname
                }
            } else
                console.error("dofus.login: loginName is empty");
            g.setAccount(e.nickname),
            g.setValue("token", e.loginToken),
            l(),
            I.start(),
            e.wasAlreadyConnected && t.emit("wasAlreadyConnected")
        }),
        i("IdentificationFailedMessage", "IdentificationFailedForBadVersionMessage", "IdentificationFailedBannedMessage", function(e) {
            i.done(e)
        }),
        i("ServersListMessage", function(e) {
            R = e.servers,
            i.done()
        }),
        f.connect(n(o()))
    }
    ,
    t.accessGameServer = function(e, i) {
        if (F === D)
            return t.once("loginEnd", function(n) {
                return n ? i(n) : void t.accessGameServer(e, i)
            });
        if (F === B)
            return e === O ? (console.warn("Already accessing this game server (" + e + ")"),
            t.once("accessGameEnd", i)) : i(new Error("Already accessing game server " + O + " (while trying to access " + e + ")"));
        if (O = e,
        F !== L)
            return t.login(function(n) {
                return n ? i(n) : void t.accessGameServer(e, i)
            });
        var o, a, r, l = s(e);
        if (!l)
            return i(new Error("Unknown server: " + e));
        F = B;
        var c = T(f, function(e) {
            e ? (this.disconnect("GAME_HANDSHAKE_ERROR"),
            F = P,
            t.emit("accessGameEnd", e)) : (F = k,
            t.emit("accessGameEnd")),
            O = null ,
            i(e)
        });
        c("SelectedServerDataMessage", function(e) {
            o = e.ticket,
            a = e.address,
            r = e.port,
            this.disconnect("SWITCHING_TO_GAME"),
            this.connect(n(e._access))
        }),
        c("SelectedServerRefusedMessage", function(t) {
            throw new Error("Server " + e + " not accessible: " + t.error)
        }),
        c("open", function() {
            this.send("connecting", u({
                address: a,
                port: r,
                id: e
            }))
        }),
        c("serverDisconnecting", function(e) {
            c.done(e)
        }),
        c("ProtocolRequired", function(e) {
            console.log("[Game server protocol] requiredVersion:", e.requiredVersion, "currentVersion:", e.currentVersion)
        }),
        c("HelloGameMessage", function() {
            this.sendMessage("AuthenticationTicketMessage", {
                ticket: o,
                lang: window.Config.language
            })
        }),
        c("AuthenticationTicketAcceptedMessage", function() {
            c.done()
        }),
        c("AuthenticationTicketRefusedMessage", function() {
            throw new Error("Server " + e + " Authentication failed")
        }),
        f.sendMessage("ServerSelectionMessage", {
            serverId: e
        })
    }
    ,
    f.on("HelloConnectMessage", function() {
        window.gui.connectionSplashScreen.onStateChange("CONNECTED")
    }),
    f.on("offline", function() {
        window.gui.connectionSplashScreen.onStateChange("UNSTABLE")
    }),
    f.on("reconnecting", function(e, t) {
        console.info("Reconnecting to " + t + " (attempt #" + e + ")"),
        window.gui.connectionSplashScreen.onStateChange("RECONNECTING", e)
    }),
    f.on("open", function(e) {
        e && f.send("reconnecting")
    }),
    f.on("sessionReconnected", function() {
        return window.isoEngine.onQuickReconnection(function() {
            window.gui.connectionSplashScreen.onStateChange("CONNECTED")
        })
    }),
    f.on("sessionTimedOut", function() {
        console.info("Session timed out"),
        f.disconnect("SESSION_TIMED_OUT")
    }),
    f.on("serverDisconnecting", function(e) {
        console.info("Server disconnecting, reason:", e.reason),
        f.disconnect("SOCKET_LOST")
    }),
    f.on("disconnect", function(e) {
        F = P,
        e.match(/^SWITCHING_/) || (c(),
        I.stop(),
        window.gui.disconnect(e),
        window.isoEngine.disconnect(),
        window.gui.connectionSplashScreen.onStateChange("RELOAD" === e ? "RELOADING" : "DISCONNECTED"))
    }),
    t.toggleTutorialListeners = function(e) {
        e ? w.setTutorialListeners(f) : w.removeTutorialListeners(f)
    }
    ,
    t.send = function(e, t) {
        f.send(e, t)
    }
    ,
    t.sendMessage = function(e, t) {
        f.sendMessage(e, t)
    }
    ,
    t.disconnect = function(e) {
        f.disconnect(e)
    }
    ,
    window.addEventListener("beforeunload", function() {
        f.disconnect("RELOAD")
    })
}
, function(e, t, i) {
    var n, o;
    (function(i, s, a) {
        /*!
	 * async
	 * https://github.com/caolan/async
	 *
	 * Copyright 2010-2014 Caolan McMahon
	 * Released under the MIT license
	 */
        !function() {
            function r() {}
            function l(e) {
                return e
            }
            function c(e) {
                return !!e
            }
            function u(e) {
                return !e
            }
            function h(e) {
                return function() {
                    if (null === e)
                        throw new Error("Callback was already called.");
                    e.apply(this, arguments),
                    e = null
                }
            }
            function d(e) {
                return function() {
                    null !== e && (e.apply(this, arguments),
                    e = null )
                }
            }
            function p(e) {
                return q(e) || "number" == typeof e.length && e.length >= 0 && e.length % 1 === 0
            }
            function m(e, t) {
                for (var i = -1, n = e.length; ++i < n; )
                    t(e[i], i, e)
            }
            function f(e, t) {
                for (var i = -1, n = e.length, o = Array(n); ++i < n; )
                    o[i] = t(e[i], i, e);
                return o
            }
            function g(e) {
                return f(Array(e), function(e, t) {
                    return t
                })
            }
            function _(e, t, i) {
                return m(e, function(e, n, o) {
                    i = t(i, e, n, o)
                }),
                i
            }
            function v(e, t) {
                m(V(e), function(i) {
                    t(e[i], i)
                })
            }
            function y(e, t) {
                for (var i = 0; i < e.length; i++)
                    if (e[i] === t)
                        return i;
                return -1
            }
            function w(e) {
                var t, i, n = -1;
                return p(e) ? (t = e.length,
                function() {
                    return n++,
                    n < t ? n : null
                }
                ) : (i = V(e),
                t = i.length,
                function() {
                    return n++,
                    n < t ? i[n] : null
                }
                )
            }
            function b(e, t) {
                return t = null == t ? e.length - 1 : +t,
                function() {
                    for (var i = Math.max(arguments.length - t, 0), n = Array(i), o = 0; o < i; o++)
                        n[o] = arguments[o + t];
                    switch (t) {
                    case 0:
                        return e.call(this, n);
                    case 1:
                        return e.call(this, arguments[0], n)
                    }
                }
            }
            function C(e) {
                return function(t, i, n) {
                    return e(t, n)
                }
            }
            function I(e) {
                return function(t, i, n) {
                    n = d(n || r),
                    t = t || [];
                    var o = w(t);
                    if (e <= 0)
                        return n(null );
                    var s = !1
                      , a = 0
                      , l = !1;
                    !function c() {
                        if (s && a <= 0)
                            return n(null );
                        for (; a < e && !l; ) {
                            var r = o();
                            if (null === r)
                                return s = !0,
                                void (a <= 0 && n(null ));
                            a += 1,
                            i(t[r], r, h(function(e) {
                                a -= 1,
                                e ? (n(e),
                                l = !0) : c()
                            }))
                        }
                    }()
                }
            }
            function T(e) {
                return function(t, i, n) {
                    return e(G.eachOf, t, i, n)
                }
            }
            function S(e) {
                return function(t, i, n, o) {
                    return e(I(i), t, n, o)
                }
            }
            function A(e) {
                return function(t, i, n) {
                    return e(G.eachOfSeries, t, i, n)
                }
            }
            function E(e, t, i, n) {
                n = d(n || r),
                t = t || [];
                var o = p(t) ? [] : {};
                e(t, function(e, t, n) {
                    i(e, function(e, i) {
                        o[t] = i,
                        n(e)
                    })
                }, function(e) {
                    n(e, o)
                })
            }
            function x(e, t, i, n) {
                var o = [];
                e(t, function(e, t, n) {
                    i(e, function(i) {
                        i && o.push({
                            index: t,
                            value: e
                        }),
                        n()
                    })
                }, function() {
                    n(f(o.sort(function(e, t) {
                        return e.index - t.index
                    }), function(e) {
                        return e.value
                    }))
                })
            }
            function M(e, t, i, n) {
                x(e, t, function(e, t) {
                    i(e, function(e) {
                        t(!e)
                    })
                }, n)
            }
            function N(e, t, i) {
                return function(n, o, s, a) {
                    function r() {
                        a && a(i(!1, void 0))
                    }
                    function l(e, n, o) {
                        return a ? void s(e, function(n) {
                            a && t(n) && (a(i(!0, e)),
                            a = s = !1),
                            o()
                        }) : o()
                    }
                    arguments.length > 3 ? e(n, o, l, r) : (a = s,
                    s = o,
                    e(n, l, r))
                }
            }
            function R(e, t) {
                return t
            }
            function O(e, t, i) {
                i = i || r;
                var n = p(t) ? [] : {};
                e(t, function(e, t, i) {
                    e(b(function(e, o) {
                        o.length <= 1 && (o = o[0]),
                        n[t] = o,
                        i(e)
                    }))
                }, function(e) {
                    i(e, n)
                })
            }
            function P(e, t, i, n) {
                var o = [];
                e(t, function(e, t, n) {
                    i(e, function(e, t) {
                        o = o.concat(t || []),
                        n(e)
                    })
                }, function(e) {
                    n(e, o)
                })
            }
            function D(e, t, i) {
                function n(e, t, i, n) {
                    if (null != n && "function" != typeof n)
                        throw new Error("task callback must be a function");
                    return e.started = !0,
                    q(t) || (t = [t]),
                    0 === t.length && e.idle() ? G.setImmediate(function() {
                        e.drain()
                    }) : (m(t, function(t) {
                        var o = {
                            data: t,
                            callback: n || r
                        };
                        i ? e.tasks.unshift(o) : e.tasks.push(o),
                        e.tasks.length === e.concurrency && e.saturated()
                    }),
                    void G.setImmediate(e.process))
                }
                function o(e, t) {
                    return function() {
                        s -= 1;
                        var i = !1
                          , n = arguments;
                        m(t, function(e) {
                            m(a, function(t, n) {
                                t !== e || i || (a.splice(n, 1),
                                i = !0)
                            }),
                            e.callback.apply(e, n)
                        }),
                        e.tasks.length + s === 0 && e.drain(),
                        e.process()
                    }
                }
                if (null == t)
                    t = 1;
                else if (0 === t)
                    throw new Error("Concurrency must not be zero");
                var s = 0
                  , a = []
                  , l = {
                    tasks: [],
                    concurrency: t,
                    payload: i,
                    saturated: r,
                    empty: r,
                    drain: r,
                    started: !1,
                    paused: !1,
                    push: function(e, t) {
                        n(l, e, !1, t)
                    },
                    kill: function() {
                        l.drain = r,
                        l.tasks = []
                    },
                    unshift: function(e, t) {
                        n(l, e, !0, t)
                    },
                    process: function() {
                        if (!l.paused && s < l.concurrency && l.tasks.length)
                            for (; s < l.concurrency && l.tasks.length; ) {
                                var t = l.payload ? l.tasks.splice(0, l.payload) : l.tasks.splice(0, l.tasks.length)
                                  , i = f(t, function(e) {
                                    return e.data
                                });
                                0 === l.tasks.length && l.empty(),
                                s += 1,
                                a.push(t[0]);
                                var n = h(o(l, t));
                                e(i, n)
                            }
                    },
                    length: function() {
                        return l.tasks.length
                    },
                    running: function() {
                        return s
                    },
                    workersList: function() {
                        return a
                    },
                    idle: function() {
                        return l.tasks.length + s === 0
                    },
                    pause: function() {
                        l.paused = !0
                    },
                    resume: function() {
                        if (l.paused !== !1) {
                            l.paused = !1;
                            for (var e = Math.min(l.concurrency, l.tasks.length), t = 1; t <= e; t++)
                                G.setImmediate(l.process)
                        }
                    }
                };
                return l
            }
            function L(e) {
                return b(function(t, i) {
                    t.apply(null , i.concat([b(function(t, i) {
                        "object" == typeof console && (t ? console.error && console.error(t) : console[e] && m(i, function(t) {
                            console[e](t)
                        }))
                    })]))
                })
            }
            function B(e) {
                return function(t, i, n) {
                    e(g(t), i, n)
                }
            }
            function k(e) {
                return b(function(t, i) {
                    var n = b(function(i) {
                        var n = this
                          , o = i.pop();
                        return e(t, function(e, t, o) {
                            e.apply(n, i.concat([o]))
                        }, o)
                    });
                    return i.length ? n.apply(this, i) : n
                })
            }
            function F(e) {
                return b(function(t) {
                    var i = t.pop();
                    t.push(function() {
                        var e = arguments;
                        n ? G.setImmediate(function() {
                            i.apply(null , e)
                        }) : i.apply(null , e)
                    });
                    var n = !0;
                    e.apply(this, t),
                    n = !1
                })
            }
            var H, G = {}, U = "object" == typeof self && self.self === self && self || "object" == typeof i && i.global === i && i || this;
            null != U && (H = U.async),
            G.noConflict = function() {
                return U.async = H,
                G
            }
            ;
            var j = Object.prototype.toString
              , q = Array.isArray || function(e) {
                return "[object Array]" === j.call(e)
            }
              , W = function(e) {
                var t = typeof e;
                return "function" === t || "object" === t && !!e
            }
              , V = Object.keys || function(e) {
                var t = [];
                for (var i in e)
                    e.hasOwnProperty(i) && t.push(i);
                return t
            }
              , z = "function" == typeof s && s
              , Y = z ? function(e) {
                z(e)
            }
            : function(e) {
                setTimeout(e, 0)
            }
            ;
            "object" == typeof a && "function" == typeof a.nextTick ? G.nextTick = a.nextTick : G.nextTick = Y,
            G.setImmediate = z ? Y : G.nextTick,
            G.forEach = G.each = function(e, t, i) {
                return G.eachOf(e, C(t), i)
            }
            ,
            G.forEachSeries = G.eachSeries = function(e, t, i) {
                return G.eachOfSeries(e, C(t), i)
            }
            ,
            G.forEachLimit = G.eachLimit = function(e, t, i, n) {
                return I(t)(e, C(i), n)
            }
            ,
            G.forEachOf = G.eachOf = function(e, t, i) {
                function n(e) {
                    a--,
                    e ? i(e) : null === o && a <= 0 && i(null )
                }
                i = d(i || r),
                e = e || [];
                for (var o, s = w(e), a = 0; null != (o = s()); )
                    a += 1,
                    t(e[o], o, h(n));
                0 === a && i(null )
            }
            ,
            G.forEachOfSeries = G.eachOfSeries = function(e, t, i) {
                function n() {
                    var a = !0;
                    return null === s ? i(null ) : (t(e[s], s, h(function(e) {
                        if (e)
                            i(e);
                        else {
                            if (s = o(),
                            null === s)
                                return i(null );
                            a ? G.setImmediate(n) : n()
                        }
                    })),
                    void (a = !1))
                }
                i = d(i || r),
                e = e || [];
                var o = w(e)
                  , s = o();
                n()
            }
            ,
            G.forEachOfLimit = G.eachOfLimit = function(e, t, i, n) {
                I(t)(e, i, n)
            }
            ,
            G.map = T(E),
            G.mapSeries = A(E),
            G.mapLimit = S(E),
            G.inject = G.foldl = G.reduce = function(e, t, i, n) {
                G.eachOfSeries(e, function(e, n, o) {
                    i(t, e, function(e, i) {
                        t = i,
                        o(e)
                    })
                }, function(e) {
                    n(e, t)
                })
            }
            ,
            G.foldr = G.reduceRight = function(e, t, i, n) {
                var o = f(e, l).reverse();
                G.reduce(o, t, i, n)
            }
            ,
            G.transform = function(e, t, i, n) {
                3 === arguments.length && (n = i,
                i = t,
                t = q(e) ? [] : {}),
                G.eachOf(e, function(e, n, o) {
                    i(t, e, n, o)
                }, function(e) {
                    n(e, t)
                })
            }
            ,
            G.select = G.filter = T(x),
            G.selectLimit = G.filterLimit = S(x),
            G.selectSeries = G.filterSeries = A(x),
            G.reject = T(M),
            G.rejectLimit = S(M),
            G.rejectSeries = A(M),
            G.any = G.some = N(G.eachOf, c, l),
            G.someLimit = N(G.eachOfLimit, c, l),
            G.all = G.every = N(G.eachOf, u, u),
            G.everyLimit = N(G.eachOfLimit, u, u),
            G.detect = N(G.eachOf, l, R),
            G.detectSeries = N(G.eachOfSeries, l, R),
            G.detectLimit = N(G.eachOfLimit, l, R),
            G.sortBy = function(e, t, i) {
                function n(e, t) {
                    var i = e.criteria
                      , n = t.criteria;
                    return i < n ? -1 : i > n ? 1 : 0
                }
                G.map(e, function(e, i) {
                    t(e, function(t, n) {
                        t ? i(t) : i(null , {
                            value: e,
                            criteria: n
                        })
                    })
                }, function(e, t) {
                    return e ? i(e) : void i(null , f(t.sort(n), function(e) {
                        return e.value
                    }))
                })
            }
            ,
            G.auto = function(e, t, i) {
                function n(e) {
                    h.unshift(e)
                }
                function o(e) {
                    var t = y(h, e);
                    t >= 0 && h.splice(t, 1)
                }
                function s() {
                    l--,
                    m(h.slice(0), function(e) {
                        e()
                    })
                }
                i || (i = t,
                t = null ),
                i = d(i || r);
                var a = V(e)
                  , l = a.length;
                if (!l)
                    return i(null );
                t || (t = l);
                var c = {}
                  , u = 0
                  , h = [];
                n(function() {
                    l || i(null , c)
                }),
                m(a, function(a) {
                    function r() {
                        return u < t && _(m, function(e, t) {
                            return e && c.hasOwnProperty(t)
                        }, !0) && !c.hasOwnProperty(a)
                    }
                    function l() {
                        r() && (u++,
                        o(l),
                        d[d.length - 1](p, c))
                    }
                    for (var h, d = q(e[a]) ? e[a] : [e[a]], p = b(function(e, t) {
                        if (u--,
                        t.length <= 1 && (t = t[0]),
                        e) {
                            var n = {};
                            v(c, function(e, t) {
                                n[t] = e
                            }),
                            n[a] = t,
                            i(e, n)
                        } else
                            c[a] = t,
                            G.setImmediate(s)
                    }), m = d.slice(0, d.length - 1), f = m.length; f--; ) {
                        if (!(h = e[m[f]]))
                            throw new Error("Has inexistant dependency");
                        if (q(h) && y(h, a) >= 0)
                            throw new Error("Has cyclic dependencies")
                    }
                    r() ? (u++,
                    d[d.length - 1](p, c)) : n(l)
                })
            }
            ,
            G.retry = function(e, t, i) {
                function n(e, t) {
                    if ("number" == typeof t)
                        e.times = parseInt(t, 10) || s;
                    else {
                        if ("object" != typeof t)
                            throw new Error("Unsupported argument type for 'times': " + typeof t);
                        e.times = parseInt(t.times, 10) || s,
                        e.interval = parseInt(t.interval, 10) || a
                    }
                }
                function o(e, t) {
                    function i(e, i) {
                        return function(n) {
                            e(function(e, t) {
                                n(!e || i, {
                                    err: e,
                                    result: t
                                })
                            }, t)
                        }
                    }
                    function n(e) {
                        return function(t) {
                            setTimeout(function() {
                                t(null )
                            }, e)
                        }
                    }
                    for (; l.times; ) {
                        var o = !(l.times -= 1);
                        r.push(i(l.task, o)),
                        !o && l.interval > 0 && r.push(n(l.interval))
                    }
                    G.series(r, function(t, i) {
                        i = i[i.length - 1],
                        (e || l.callback)(i.err, i.result)
                    })
                }
                var s = 5
                  , a = 0
                  , r = []
                  , l = {
                    times: s,
                    interval: a
                }
                  , c = arguments.length;
                if (c < 1 || c > 3)
                    throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");
                return c <= 2 && "function" == typeof e && (i = t,
                t = e),
                "function" != typeof e && n(l, e),
                l.callback = i,
                l.task = t,
                l.callback ? o() : o
            }
            ,
            G.waterfall = function(e, t) {
                function i(e) {
                    return b(function(n, o) {
                        if (n)
                            t.apply(null , [n].concat(o));
                        else {
                            var s = e.next();
                            s ? o.push(i(s)) : o.push(t),
                            F(e).apply(null , o)
                        }
                    })
                }
                if (t = d(t || r),
                !q(e)) {
                    var n = new Error("First argument to waterfall must be an array of functions");
                    return t(n)
                }
                return e.length ? void i(G.iterator(e))() : t()
            }
            ,
            G.parallel = function(e, t) {
                O(G.eachOf, e, t)
            }
            ,
            G.parallelLimit = function(e, t, i) {
                O(I(t), e, i)
            }
            ,
            G.series = function(e, t) {
                O(G.eachOfSeries, e, t)
            }
            ,
            G.iterator = function(e) {
                function t(i) {
                    function n() {
                        return e.length && e[i].apply(null , arguments),
                        n.next()
                    }
                    return n.next = function() {
                        return i < e.length - 1 ? t(i + 1) : null
                    }
                    ,
                    n
                }
                return t(0)
            }
            ,
            G.apply = b(function(e, t) {
                return b(function(i) {
                    return e.apply(null , t.concat(i))
                })
            }),
            G.concat = T(P),
            G.concatSeries = A(P),
            G.whilst = function(e, t, i) {
                if (i = i || r,
                e()) {
                    var n = b(function(o, s) {
                        o ? i(o) : e.apply(this, s) ? t(n) : i(null )
                    });
                    t(n)
                } else
                    i(null )
            }
            ,
            G.doWhilst = function(e, t, i) {
                var n = 0;
                return G.whilst(function() {
                    return ++n <= 1 || t.apply(this, arguments)
                }, e, i)
            }
            ,
            G.until = function(e, t, i) {
                return G.whilst(function() {
                    return !e.apply(this, arguments)
                }, t, i)
            }
            ,
            G.doUntil = function(e, t, i) {
                return G.doWhilst(e, function() {
                    return !t.apply(this, arguments)
                }, i)
            }
            ,
            G.during = function(e, t, i) {
                i = i || r;
                var n = b(function(t, n) {
                    t ? i(t) : (n.push(o),
                    e.apply(this, n))
                })
                  , o = function(e, o) {
                    e ? i(e) : o ? t(n) : i(null )
                };
                e(o)
            }
            ,
            G.doDuring = function(e, t, i) {
                var n = 0;
                G.during(function(e) {
                    n++ < 1 ? e(null , !0) : t.apply(this, arguments)
                }, e, i)
            }
            ,
            G.queue = function(e, t) {
                var i = D(function(t, i) {
                    e(t[0], i)
                }, t, 1);
                return i
            }
            ,
            G.priorityQueue = function(e, t) {
                function i(e, t) {
                    return e.priority - t.priority
                }
                function n(e, t, i) {
                    for (var n = -1, o = e.length - 1; n < o; ) {
                        var s = n + (o - n + 1 >>> 1);
                        i(t, e[s]) >= 0 ? n = s : o = s - 1
                    }
                    return n
                }
                function o(e, t, o, s) {
                    if (null != s && "function" != typeof s)
                        throw new Error("task callback must be a function");
                    return e.started = !0,
                    q(t) || (t = [t]),
                    0 === t.length ? G.setImmediate(function() {
                        e.drain()
                    }) : void m(t, function(t) {
                        var a = {
                            data: t,
                            priority: o,
                            callback: "function" == typeof s ? s : r
                        };
                        e.tasks.splice(n(e.tasks, a, i) + 1, 0, a),
                        e.tasks.length === e.concurrency && e.saturated(),
                        G.setImmediate(e.process)
                    })
                }
                var s = G.queue(e, t);
                return s.push = function(e, t, i) {
                    o(s, e, t, i)
                }
                ,
                delete s.unshift,
                s
            }
            ,
            G.cargo = function(e, t) {
                return D(e, 1, t)
            }
            ,
            G.log = L("log"),
            G.dir = L("dir"),
            G.memoize = function(e, t) {
                var i = {}
                  , n = {};
                t = t || l;
                var o = b(function(o) {
                    var s = o.pop()
                      , a = t.apply(null , o);
                    a in i ? G.setImmediate(function() {
                        s.apply(null , i[a])
                    }) : a in n ? n[a].push(s) : (n[a] = [s],
                    e.apply(null , o.concat([b(function(e) {
                        i[a] = e;
                        var t = n[a];
                        delete n[a];
                        for (var o = 0, s = t.length; o < s; o++)
                            t[o].apply(null , e)
                    })])))
                });
                return o.memo = i,
                o.unmemoized = e,
                o
            }
            ,
            G.unmemoize = function(e) {
                return function() {
                    return (e.unmemoized || e).apply(null , arguments)
                }
            }
            ,
            G.times = B(G.map),
            G.timesSeries = B(G.mapSeries),
            G.timesLimit = function(e, t, i, n) {
                return G.mapLimit(g(e), t, i, n)
            }
            ,
            G.seq = function() {
                var e = arguments;
                return b(function(t) {
                    var i = this
                      , n = t[t.length - 1];
                    "function" == typeof n ? t.pop() : n = r,
                    G.reduce(e, t, function(e, t, n) {
                        t.apply(i, e.concat([b(function(e, t) {
                            n(e, t)
                        })]))
                    }, function(e, t) {
                        n.apply(i, [e].concat(t))
                    })
                })
            }
            ,
            G.compose = function() {
                return G.seq.apply(null , Array.prototype.reverse.call(arguments))
            }
            ,
            G.applyEach = k(G.eachOf),
            G.applyEachSeries = k(G.eachOfSeries),
            G.forever = function(e, t) {
                function i(e) {
                    return e ? n(e) : void o(i)
                }
                var n = h(t || r)
                  , o = F(e);
                i()
            }
            ,
            G.ensureAsync = F,
            G.constant = b(function(e) {
                var t = [null ].concat(e);
                return function(e) {
                    return e.apply(this, t)
                }
            }),
            G.wrapSync = G.asyncify = function(e) {
                return b(function(t) {
                    var i, n = t.pop();
                    try {
                        i = e.apply(this, t)
                    } catch (o) {
                        return n(o)
                    }
                    W(i) && "function" == typeof i.then ? i.then(function(e) {
                        n(null , e)
                    })["catch"](function(e) {
                        n(e.message ? e : new Error(e))
                    }) : n(null , i)
                })
            }
            ,
            "object" == typeof e && e.exports ? e.exports = G : (n = [],
            o = function() {
                return G
            }
            .apply(t, n),
            !(void 0 !== o && (e.exports = o)))
        }()
    }
    ).call(t, function() {
        return this
    }(), i(13).setImmediate, i(14))
}
, function(e, t, i) {
    (function(e, n) {
        function o(e, t) {
            this._id = e,
            this._clearFn = t
        }
        var s = i(14).nextTick
          , a = Function.prototype.apply
          , r = Array.prototype.slice
          , l = {}
          , c = 0;
        t.setTimeout = function() {
            return new o(a.call(setTimeout, window, arguments),clearTimeout)
        }
        ,
        t.setInterval = function() {
            return new o(a.call(setInterval, window, arguments),clearInterval)
        }
        ,
        t.clearTimeout = t.clearInterval = function(e) {
            e.close()
        }
        ,
        o.prototype.unref = o.prototype.ref = function() {}
        ,
        o.prototype.close = function() {
            this._clearFn.call(window, this._id)
        }
        ,
        t.enroll = function(e, t) {
            clearTimeout(e._idleTimeoutId),
            e._idleTimeout = t
        }
        ,
        t.unenroll = function(e) {
            clearTimeout(e._idleTimeoutId),
            e._idleTimeout = -1
        }
        ,
        t._unrefActive = t.active = function(e) {
            clearTimeout(e._idleTimeoutId);
            var t = e._idleTimeout;
            t >= 0 && (e._idleTimeoutId = setTimeout(function() {
                e._onTimeout && e._onTimeout()
            }, t))
        }
        ,
        t.setImmediate = "function" == typeof e ? e : function(e) {
            var i = c++
              , n = !(arguments.length < 2) && r.call(arguments, 1);
            return l[i] = !0,
            s(function() {
                l[i] && (n ? e.apply(null , n) : e.call(null ),
                t.clearImmediate(i))
            }),
            i
        }
        ,
        t.clearImmediate = "function" == typeof n ? n : function(e) {
            delete l[e]
        }
    }
    ).call(t, i(13).setImmediate, i(13).clearImmediate)
}
, function(e, t) {
    function i() {
        throw new Error("setTimeout has not been defined")
    }
    function n() {
        throw new Error("clearTimeout has not been defined")
    }
    function o(e) {
        if (u === setTimeout)
            return setTimeout(e, 0);
        if ((u === i || !u) && setTimeout)
            return u = setTimeout,
            setTimeout(e, 0);
        try {
            return u(e, 0)
        } catch (t) {
            try {
                return u.call(null , e, 0)
            } catch (t) {
                return u.call(this, e, 0)
            }
        }
    }
    function s(e) {
        if (h === clearTimeout)
            return clearTimeout(e);
        if ((h === n || !h) && clearTimeout)
            return h = clearTimeout,
            clearTimeout(e);
        try {
            return h(e)
        } catch (t) {
            try {
                return h.call(null , e)
            } catch (t) {
                return h.call(this, e)
            }
        }
    }
    function a() {
        f && p && (f = !1,
        p.length ? m = p.concat(m) : g = -1,
        m.length && r())
    }
    function r() {
        if (!f) {
            var e = o(a);
            f = !0;
            for (var t = m.length; t; ) {
                for (p = m,
                m = []; ++g < t; )
                    p && p[g].run();
                g = -1,
                t = m.length
            }
            p = null ,
            f = !1,
            s(e)
        }
    }
    function l(e, t) {
        this.fun = e,
        this.array = t
    }
    function c() {}
    var u, h, d = e.exports = {};
    !function() {
        try {
            u = "function" == typeof setTimeout ? setTimeout : i
        } catch (e) {
            u = i
        }
        try {
            h = "function" == typeof clearTimeout ? clearTimeout : n
        } catch (e) {
            h = n
        }
    }();
    var p, m = [], f = !1, g = -1;
    d.nextTick = function(e) {
        var t = new Array(arguments.length - 1);
        if (arguments.length > 1)
            for (var i = 1; i < arguments.length; i++)
                t[i - 1] = arguments[i];
        m.push(new l(e,t)),
        1 !== m.length || f || o(r)
    }
    ,
    l.prototype.run = function() {
        this.fun.apply(null , this.array)
    }
    ,
    d.title = "browser",
    d.browser = !0,
    d.env = {},
    d.argv = [],
    d.version = "",
    d.versions = {},
    d.on = c,
    d.addListener = c,
    d.once = c,
    d.off = c,
    d.removeListener = c,
    d.removeAllListeners = c,
    d.emit = c,
    d.binding = function(e) {
        throw new Error("process.binding is not supported")
    }
    ,
    d.cwd = function() {
        return "/"
    }
    ,
    d.chdir = function(e) {
        throw new Error("process.chdir is not supported")
    }
    ,
    d.umask = function() {
        return 0
    }
}
, function(e, t) {
    function i(e, t) {
        var i = document.getElementsByTagName("head")[0]
          , n = document.createElement("script");
        n.onload = function() {
            return this.onload = null ,
            this.onerror = null ,
            t()
        }
        ,
        n.onerror = function() {
            return this.onload = null ,
            this.onerror = null ,
            t(new Error("Error loading script: " + e))
        }
        ,
        n.type = "text/javascript",
        n.src = e,
        i.appendChild(n)
    }
    function n(e, t) {
        var i = new XMLHttpRequest;
        i.overrideMimeType("application/json"),
        i.onreadystatechange = function() {
            if (4 === ~~i.readyState) {
                if (i.onreadystatechange = null ,
                200 !== ~~i.status)
                    return t(new Error("Error loading json: " + e));
                var n;
                try {
                    n = JSON.parse(i.responseText)
                } catch (o) {
                    return t(o)
                }
                return t(null , n)
            }
        }
        ,
        i.open("GET", e, !0),
        i.send(null )
    }
    e.exports.loadScript = i,
    e.exports.loadJson = n
}
, function(e, t) {
    var i = function() {
        this.eventHandlers = {}
    };
    i.EventEmitter = i,
    e.exports = i,
    i.listenerCount = function(e, t) {
        var i = e.eventHandlers[t];
        return i ? i.length : 0
    }
    ,
    i.prototype.on = function(e, t) {
        if ("function" != typeof t)
            return console.warn("Tried to register non-function", t, "as event handler for event:", e),
            this;
        this.emit("newListener", e, t);
        var i = this.eventHandlers
          , n = i[e];
        return void 0 === n ? (i[e] = [t],
        this) : (n.push(t),
        this)
    }
    ,
    i.prototype.addListener = i.prototype.on,
    i.prototype.once = function(e, t) {
        return t.once ? t.once += 1 : t.once = 1,
        this.on(e, t)
    }
    ,
    i.prototype.setMaxListeners = function() {
        console.warn("Method setMaxListeners not supported, there is no limit to the number of listeners")
    }
    ,
    i.prototype.removeListener = function(e, t) {
        var i = this.eventHandlers[e];
        if (void 0 !== i) {
            var n = i.indexOf(t);
            n !== -1 && (i.splice(n, 1),
            this.emit("removeListener", e, t),
            0 === i.length && delete this.eventHandlers[e])
        }
        return this
    }
    ,
    i.prototype.removeAllListeners = function(e) {
        return e ? delete this.eventHandlers[e] : this.eventHandlers = {},
        this
    }
    ,
    i.prototype.hasListeners = function(e) {
        return void 0 !== this.eventHandlers[e]
    }
    ,
    i.prototype.listeners = function(e) {
        var t = this.eventHandlers[e];
        return void 0 !== t ? t.slice() : []
    }
    ;
    var n = Array.prototype.slice;
    i.prototype.emit = function(e) {
        var t = this.eventHandlers[e];
        if (void 0 === t)
            return !1;
        t = t.slice();
        for (var i = !1, o = n.call(arguments, 1), s = 0, a = t.length; s < a; s++) {
            var r = t[s];
            void 0 !== r && (r.apply(this, o),
            i = !0,
            r.once && (r.once > 1 ? r.once-- : delete r.once,
            this.removeListener(e, r)))
        }
        return i
    }
}
, function(e, t, i) {
    function n(e) {
        f[e] || (f[e] = function() {
            f.emit(e, arguments)
        }
        )
    }
    function o() {
        var e = {};
        if (!window.gui.playerData)
            return e;
        var t = window.gui.playerData
          , i = t.identification || {}
          , n = t.characterBaseInformations || {}
          , o = t.position || {}
          , s = window.gui.fightManager || {}
          , a = window.appInfo
          , r = a && a.version;
        return e.nickname = i.nickname,
        e.accountId = i.accountId,
        e.charaName = n.name,
        e.charaId = n.id,
        e.breed = n.breed,
        e.level = n.level,
        e.mapId = o.mapId,
        e.openWindows = p.getOpenWindows(),
        e.lastClosedWindow = p.getLastClosedWindow(),
        e.fightState = s.fightState,
        e.cordovaBuildVersion = r,
        e
    }
    function s() {}
    function a() {}
    function r(e) {
        var t = b[e];
        if (t)
            return t;
        var i = w[e];
        return i ? (t = new i,
        b[e] = t,
        t) : void g.error("Unknown writer type:", e)
    }
    function l(e) {
        for (var t = Object.keys(m), i = 0, o = t.length; i < o; i++) {
            var s = t[i];
            n(s);
            for (var a in e) {
                var l = e[a]
                  , c = r(a);
                c && l.indexOf(s) !== -1 && c.addChannel(s)
            }
        }
    }
    function c(e) {
        if (!u) {
            u = {};
            for (var t in e)
                if (e.hasOwnProperty(t)) {
                    if (C[t])
                        continue;
                    u[t] = e[t]
                }
        }
    }
    var u, h = i(16).EventEmitter, d = i(18), p = i(22), m = {}, f = new h, g = window.console, _ = 10;
    g || (g = {
        log: function() {},
        info: function() {},
        debug: function() {},
        warn: function() {},
        error: function() {}
    });
    var v = {
        log: "verbose",
        debug: "debug",
        info: "info",
        warn: "warning",
        error: "error"
    }
      , y = {
        verbose: "color: #AAA",
        debug: "color: #0AA;",
        info: "color: #00A; font-weight: bold;",
        notice: "color: #0A0;",
        warning: "color: #F55;",
        error: "color: #A00;",
        critical: "color: #A00; font-weight: bold;",
        alert: "color: #A00; font-weight: bold; text-decoration: underline;",
        emergency: "background-color: #A00; font-weight: bold;"
    };
    Object.keys(v).forEach(function(e) {
        "function" == typeof g[e] ? g["_" + e] = g[e] : "object" == typeof g[e] && (g["_" + e] = Function.prototype.bind.call(g[e], g))
    }),
    s.prototype.addChannel = function(e) {
        var t, i = Array.prototype.slice, n = "%c[" + e + "]", o = "background-color: transparent;", s = m[e] || 0;
        y[e] && (o = y[e]),
        s > m.warning && (t = g._error),
        !t && s >= m.warning && (t = g._warn),
        !t && g._info && s >= m.info && (t = g._info),
        !t && g._debug && s >= m.debug && (t = g._debug),
        t || (t = g._log),
        f.on(e, function(e) {
            var s = i.call(e)
              , a = n;
            return g.group && f.groups ? (g.group(a, o),
            t.apply(g, s),
            void g.groupEnd()) : ("string" == typeof s[0] && (a = a + " " + s.shift()),
            e = [a, o].concat(s),
            void t.apply(g, e))
        })
    }
    ,
    a.prototype.addChannel = function(e) {
        var t = window.navigator || {}
          , i = {
            userAgent: t.userAgent || "unknown",
            clientConfig: u
        };
        f.on(e, function(t) {
            /*var n = d(t);
            n.data || (n.data = {}),
            Array.isArray(n.data.error) && n.data.error.length > _ && (n.data.error.length = _),
            i.characterInfo = o(),
            n.data.clientInfo = i;
            var s = window.Config && window.Config.dataUrl || ""
              , a = {};
            a.Accept = "application/json",
            a["Content-Type"] = "application/json",
            window.fetch(s + "/logger", {
                method: "post",
                headers: a,
                body: JSON.stringify({
                    channelName: e,
                    message: n.message,
                    data: n.data,
                    report: n
                })
            })*/
        })
    }
    ;
    var w = {
        console: s,
        server: a
    }
      , b = {}
      , C = {
        logging: !0,
        haapi: !0,
        adjust: !0,
        analytics: !0,
        serverLanguages: !0
    };
    f.setup = function(e) {
        e = e || {};
        var t = e.logging || {};
        c(e),
        m = t.logLevels || {},
        f.groups = t.groups,
        l(t.config),
        t.disableOverride || (f.overrideConsole(),
        f.logUncaughtExceptions("error", !1))
    }
    ,
    f.overrideConsole = function() {
        /*Object.keys(v).forEach(function(e) {
            var t = v[e];
            g[e] = function() {
                f.emit(t, arguments)
            }
        })*/
    }
    ,
    f.logUncaughtExceptions = function(e, t) {
        var i = window.ErrorEvent;
        window.onerror && f.debug("window.onerror was already assigned, overwriting."),
        window.onerror = function(n, o, s, a, r) {
            if (i && n instanceof i)
                f.emit(e, [n, r]);
            else if (i && window.event instanceof i)
                f.emit(e, [window.event, r]);
            else {
                var l = [{
                    message: n,
                    url: o,
                    lineno: s,
                    colno: a
                }];
                r && l.push(r),
                f.emit(e, l)
            }
            if (!t)
                return !0
        }
    }
    ,
    e.exports = f
}
, function(e, t, i) {
    function n(e, t) {
        function i(d) {
            if (void 0 === d)
                return JSON.stringify("<undefined>");
            if (u && d instanceof u)
                return JSON.stringify("[DOM Window]");
            if (c && d instanceof c)
                return JSON.stringify("[DOM Element (" + s(d) + ")]");
            if (l && d instanceof l)
                return JSON.stringify("[DOM Node (" + d.nodeName + ")]");
            if (r && d instanceof r)
                return JSON.stringify("[RegExp (" + d.toString() + ")]");
            if (d instanceof n) {
                try {
                    t.error = o.parse(d)
                } catch (p) {
                    "string" == typeof d.stack && (t.error = d.stack.split("\n"))
                }
                return JSON.stringify(d.name + ": " + d.message)
            }
            if (a && d instanceof a)
                return t.filename = d.filename,
                t.lineno = e.lineno,
                t.colno = e.colno || e.column,
                d.error && (t.error = i(d.error)),
                i(d.message);
            if (Array.isArray(d))
                return h.indexOf(d) !== -1 ? JSON.stringify("[Circular reference]") : (h.push(d),
                "[" + d.map(i).join(",") + "]");
            if (d && "object" == typeof d) {
                if (h.indexOf(d) !== -1)
                    return JSON.stringify("[Circular reference]");
                h.push(d);
                var m = Object.keys(d);
                return "{" + m.map(function(e) {
                    return JSON.stringify(e) + ":" + i(d[e])
                }).join(",") + "}"
            }
            return JSON.stringify(d)
        }
        var n = window.Error
          , a = window.ErrorEvent
          , r = window.RegExp
          , l = window.Node
          , c = window.Element
          , u = window.Window
          , h = [];
        return i(e)
    }
    var o = i(19)
      , s = i(21);
    e.exports = function(e) {
        for (var t = e.length, i = new Array(t), o = {}, s = 0; s < t; s++) {
            var a = e[s];
            "string" == typeof a ? i[s] = a : i[s] = n(e[s], o)
        }
        var r = i.join(" ");
        return 0 === Object.keys(o).length && (o = null ),
        {
            message: r,
            data: o
        }
    }
}
, function(e, t, i) {
    var n, o, s;
    !function(a, r) {
        "use strict";
        o = [i(20)],
        n = r,
        s = "function" == typeof n ? n.apply(t, o) : n,
        !(void 0 !== s && (e.exports = s))
    }(this, function(e) {
        "use strict";
        var t = /(^|@)\S+\:\d+/
          , i = /\s+at .*(\S+\:\d+|\(native\))/;
        return {
            parse: function(e) {
                if ("undefined" != typeof e.stacktrace || "undefined" != typeof e["opera#sourceloc"])
                    return this.parseOpera(e);
                if (e.stack && e.stack.match(i))
                    return this.parseV8OrIE(e);
                if (e.stack && e.stack.match(t))
                    return this.parseFFOrSafari(e);
                throw new Error("Cannot parse given Error object")
            },
            extractLocation: function(e) {
                if (e.indexOf(":") === -1)
                    return [e];
                var t = e.replace(/[\(\)\s]/g, "").split(":")
                  , i = t.pop()
                  , n = t[t.length - 1];
                if (!isNaN(parseFloat(n)) && isFinite(n)) {
                    var o = t.pop();
                    return [t.join(":"), o, i]
                }
                return [t.join(":"), i, void 0]
            },
            parseV8OrIE: function(t) {
                return t.stack.split("\n").filter(function(e) {
                    return !!e.match(i)
                }, this).map(function(t) {
                    var i = t.replace(/^\s+/, "").split(/\s+/).slice(1)
                      , n = this.extractLocation(i.pop())
                      , o = i[0] && "Anonymous" !== i[0] ? i[0] : void 0;
                    return new e(o,(void 0),n[0],n[1],n[2],t)
                }, this)
            },
            parseFFOrSafari: function(i) {
                return i.stack.split("\n").filter(function(e) {
                    return !!e.match(t)
                }, this).map(function(t) {
                    var i = t.split("@")
                      , n = this.extractLocation(i.pop())
                      , o = i.shift() || void 0;
                    return new e(o,(void 0),n[0],n[1],n[2],t)
                }, this)
            },
            parseOpera: function(e) {
                return !e.stacktrace || e.message.indexOf("\n") > -1 && e.message.split("\n").length > e.stacktrace.split("\n").length ? this.parseOpera9(e) : e.stack ? this.parseOpera11(e) : this.parseOpera10(e)
            },
            parseOpera9: function(t) {
                for (var i = /Line (\d+).*script (?:in )?(\S+)/i, n = t.message.split("\n"), o = [], s = 2, a = n.length; s < a; s += 2) {
                    var r = i.exec(n[s]);
                    r && o.push(new e((void 0),(void 0),r[2],r[1],(void 0),n[s]))
                }
                return o
            },
            parseOpera10: function(t) {
                for (var i = /Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i, n = t.stacktrace.split("\n"), o = [], s = 0, a = n.length; s < a; s += 2) {
                    var r = i.exec(n[s]);
                    r && o.push(new e(r[3] || void 0,(void 0),r[2],r[1],(void 0),n[s]))
                }
                return o
            },
            parseOpera11: function(i) {
                return i.stack.split("\n").filter(function(e) {
                    return !!e.match(t) && !e.match(/^Error created at/)
                }, this).map(function(t) {
                    var i, n = t.split("@"), o = this.extractLocation(n.pop()), s = n.shift() || "", a = s.replace(/<anonymous function(: (\w+))?>/, "$2").replace(/\([^\)]*\)/g, "") || void 0;
                    s.match(/\(([^\)]*)\)/) && (i = s.replace(/^[^\(]+\(([^\)]*)\)$/, "$1"));
                    var r = void 0 === i || "[arguments not available]" === i ? void 0 : i.split(",");
                    return new e(a,r,o[0],o[1],o[2],t)
                }, this)
            }
        }
    })
}
, function(e, t, i) {
    var n, o, s;
    !function(i, a) {
        "use strict";
        o = [],
        n = a,
        s = "function" == typeof n ? n.apply(t, o) : n,
        !(void 0 !== s && (e.exports = s))
    }(this, function() {
        "use strict";
        function e(e) {
            return !isNaN(parseFloat(e)) && isFinite(e)
        }
        function t(e, t, i, n, o, s) {
            void 0 !== e && this.setFunctionName(e),
            void 0 !== t && this.setArgs(t),
            void 0 !== i && this.setFileName(i),
            void 0 !== n && this.setLineNumber(n),
            void 0 !== o && this.setColumnNumber(o),
            void 0 !== s && this.setSource(s)
        }
        return t.prototype = {
            getFunctionName: function() {
                return this.functionName
            },
            setFunctionName: function(e) {
                this.functionName = String(e)
            },
            getArgs: function() {
                return this.args
            },
            setArgs: function(e) {
                if ("[object Array]" !== Object.prototype.toString.call(e))
                    throw new TypeError("Args must be an Array");
                this.args = e
            },
            getFileName: function() {
                return this.fileName
            },
            setFileName: function(e) {
                this.fileName = String(e)
            },
            getLineNumber: function() {
                return this.lineNumber
            },
            setLineNumber: function(t) {
                if (!e(t))
                    throw new TypeError("Line Number must be a Number");
                this.lineNumber = Number(t)
            },
            getColumnNumber: function() {
                return this.columnNumber
            },
            setColumnNumber: function(t) {
                if (!e(t))
                    throw new TypeError("Column Number must be a Number");
                this.columnNumber = Number(t)
            },
            getSource: function() {
                return this.source
            },
            setSource: function(e) {
                this.source = String(e)
            },
            toString: function() {
                var t = this.getFunctionName() || "{anonymous}"
                  , i = "(" + (this.getArgs() || []).join(",") + ")"
                  , n = this.getFileName() ? "@" + this.getFileName() : ""
                  , o = e(this.getLineNumber()) ? ":" + this.getLineNumber() : ""
                  , s = e(this.getColumnNumber()) ? ":" + this.getColumnNumber() : "";
                return t + i + n + o + s
            }
        },
        t
    })
}
, function(e, t) {
    function i(e) {
        if (!e || !e.tagName)
            throw new TypeError("Element expected");
        var t = o(e).join(" > ")
          , i = document.querySelectorAll(t);
        if (i.length > 1)
            for (var n = 0; n < i.length; n++)
                if (e === i[n]) {
                    n = [].indexOf.call(e.parentNode.children, e),
                    t += ":nth-child(" + (n + 1) + ")";
                    break
                }
        return t
    }
    function n(e) {
        var t = e.getAttribute("class");
        return t && t.length ? (t = t.replace(/\s+/g, " "),
        t = t.replace(/^\s+|\s+$/g, ""),
        t.split(" ")) : []
    }
    function o(e) {
        var t = []
          , i = null
          , o = null
          , s = null
          , a = null
          , r = null ;
        do {
            if (e.id)
                i = "#" + e.id;
            else {
                i = e.tagName.toLowerCase();
                var l = n(e);
                l.length && (i += "." + l.join("."))
            }
            (o = e.getAttribute("title")) ? i += '[title="' + o + '"]' : (s = e.getAttribute("alt")) ? i += '[alt="' + s + '"]' : (a = e.getAttribute("name")) && (i += '[name="' + a + '"]'),
            (r = e.getAttribute("value")) && (i += '[value="' + r + '"]'),
            t.unshift(i)
        } while (!e.id && (e = e.parentNode) && e.tagName);if (!t.length)
            throw new Error("Failed to identify CSS selector");
        return t
    }
    e.exports = i
}
, function(e, t, i) {
    function n(e, t) {
        delete e.closingTweener,
        e.hide(),
        e.emit("closed", t),
        v.emit("closed", {
            id: e.id
        })
    }
    function o(e, t, i) {
        i || (e.emit("opened", t),
        v.emit("opened", {
            id: e.id
        })),
        delete e.openingTweener
    }
    function s(e, t) {
        var i = y[e];
        if (!i)
            return console.error("Invalid window: " + e);
        if (i.openState) {
            i.openingTweener && (i.openingTweener.cancel(),
            o(i, null , !0)),
            i === b && (b = null ),
            i.openState = !1,
            C = e,
            i.emit("close", t),
            v.emit("close", {
                id: e
            });
            var s = i.position;
            i.closingTweener = m.tween(i, {
                opacity: 0,
                webkitTransform: "translate3d(" + s.x + "px," + s.y + "px,0) scale(0.8)"
            }, {
                time: 150,
                delay: 0,
                easing: "ease-out"
            }, function() {
                n(i, t)
            })
        }
    }
    function a() {
        if (w) {
            for (var e = 0, t = w.length; e < t; e += 1)
                s(w[e]);
            w = null ,
            window.foreground.unlock("windowsManagerDialog")
        }
    }
    function r(e, t) {
        if ("number" == typeof e)
            return e;
        var i = e.length;
        return "%" === e[i - 1] ? t * e.substr(0, i - 1) / 100 : ("px" === e.substr(i - 2) && (e = e.substr(0, i - 2)),
        e *= 1)
    }
    function l(e, t, i) {
        return e = e.substr(1),
        e ? t + r(e, i) : t
    }
    function c(e, t, i) {
        var n = (t - i) / 2;
        return l(e, n, t)
    }
    function u(e, t, i) {
        switch (e[0]) {
        case "c":
            return c(e, t, i);
        case "w":
            return l(e, t, t);
        case "h":
            return l(e, t, t);
        default:
            return r(e, t)
        }
    }
    function h(e) {
        var t = 0
          , i = 0
          , n = 0
          , o = 0
          , s = d.windowFullScreenWidth || d.screenWidth
          , a = d.windowFullScreenHeight || d.screenHeight;
        if (e.isFullScreen && (s = d.screenWidth,
        a = d.screenHeight),
        e.mustAvoidToolbar && (s = d.screenExceptToolbar.width,
        a = d.screenExceptToolbar.height),
        e.width) {
            t = u(e.width, s);
            var r = e.maxWidth || s;
            t = r && r < t ? r : t
        }
        if (e.height) {
            i = u(e.height, a);
            var l = Math.min(e.maxHeight || a, a);
            i = Math.min(i, l)
        }
        if (e.minHeight) {
            var c = u(e.minHeight, a);
            i = Math.max(c, i)
        }
        if (e.minWidth) {
            var h = u(e.minWidth, a);
            t = Math.max(h, t)
        }
        var p = e.hasOwnProperty("left");
        if ((p || e.hasOwnProperty("x")) && (n = u(p ? e.left : e.x, s, t)),
        e.hasOwnProperty("right")) {
            var m = u(e.right, s, t);
            t ? n = s - m - t : t = s - m - n
        }
        var f = e.hasOwnProperty("top");
        if ((f || e.hasOwnProperty("y")) && (o = u(f ? e.top : e.y, a, i)),
        e.bottom) {
            var g = u(e.bottom, a, i);
            i ? o = a - g - i : i = a - g - o
        }
        return n = Math.min(s - t, Math.max(0, n)),
        o = Math.max(0, Math.min(a - i, o)),
        {
            x: Math.round(n),
            y: Math.round(o),
            width: Math.round(t),
            height: Math.round(i)
        }
    }
    i(23);
    var d = i(24).dimensions
      , p = i(16).EventEmitter
      , m = i(31)
      , f = i(32)
      , g = i(48)
      , _ = 40
      , v = new p
      , y = {}
      , w = null
      , b = null
      , C = null ;
    v.makeMovable = function(e, t) {
        t = t || e.windowHeadWrapper,
        g(t);
        var i, n, o, s, a, r;
        t.on("slideStart", function(l, c) {
            if (!e.openState)
                return t.cancelSlide();
            var u = e.rootElement.getBoundingClientRect()
              , h = c.left - u.left
              , d = c.top - u.top;
            a = u.width,
            r = c.height + d,
            o = l.x - c.left + h,
            s = l.y - c.top + d,
            i = e.position.x,
            n = e.position.y
        }),
        t.on("slideEnd", function() {
            e.position.x = i,
            e.position.y = n,
            e.emit("positioned")
        }),
        t.on("slideCancel", function() {
            e.setStyle("webkitTransform", "translate3d(" + e.position.x + "px," + e.position.y + "px,0)")
        }),
        t.on("slide", function(t) {
            i = t.x - o,
            n = t.y - s,
            i < 0 ? i = 0 : i + a > d.windowFullScreenWidth && (i = d.windowFullScreenWidth - a),
            n < 0 ? n = 0 : n + r > d.windowFullScreenHeight && (n = d.windowFullScreenHeight - r),
            e.setStyle("webkitTransform", "translate3d(" + i + "px, " + n + "px, 0)")
        })
    }
    ,
    v.initialize = function(e) {
        e.on("disconnect", function() {
            w = null ,
            C = null
        }),
        e.on("ExchangeLeaveMessage", a),
        e.on("LeaveDialogMessage", a)
    }
    ,
    v.addWindow = function(e, t, i) {
        function n() {
            v.focusWindow(e)
        }
        i = i || {},
        y[e] = t,
        t.id = e,
        i.group && (t.group = i.group),
        t.hide(),
        t.openState = !1;
        var o = i.container || window.gui.windowsContainer;
        o.appendChild(t),
        t.allowDomEvents(),
        t.on("dom.touchstart", n),
        f(t.header),
        t.header.on("doubletap", function() {
            v.positionWindow(e)
        }),
        i.fixed || v.makeMovable(t)
    }
    ,
    v.open = function(e, t) {
        t = t || {};
        var i = y[e];
        if (!i)
            return console.error("Invalid window: " + e);
        i.closingTweener && (i.closingTweener.cancel(),
        n(i));
        var s = i.group;
        if (s)
            for (var a in y) {
                var r = y[a];
                s === r.group && r.openState && e !== a && this.close(a)
            }
        var l = i.positionInfo
          , c = i.position;
        if (l && !c && (i.position = c = h(l),
        i.setStyles({
            webkitTransform: "translate3d(" + c.x + "px," + c.y + "px,0) scale(0.8)",
            width: c.width + "px",
            height: c.height + "px",
            opacity: 0
        })),
        l && l.isModal || t.isModal) {
            i.addClassNames("modal");
            var u = window.gui.windowsContainer.createChild("div", {
                className: "modalWindowOverlay"
            });
            i.once("close", function() {
                u.destroy()
            })
        }
        i.openState = !0,
        i.show(),
        this.emit("open", {
            id: e
        }),
        i.emit("open", t),
        v.focusWindow(e),
        c = i.position;
        var p = l && l.isDefault;
        return p || i.initialPosition || (i.initialPosition = {
            x: c.x,
            y: c.y,
            width: c.width,
            height: c.height
        }),
        c.x = Math.min(d.windowFullScreenWidth - c.width, Math.max(0, c.x)),
        c.y = Math.max(0, Math.min(d.windowFullScreenHeight - _, c.y)),
        i.openingTweener = m.tween(i, {
            opacity: 1,
            webkitTransform: "translate3d(" + c.x + "px," + c.y + "px,0)  scale(1)"
        }, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, function() {
            o(i, t)
        }),
        window.gui.splashScreen.hide(),
        i
    }
    ,
    v.focusWindow = function(e) {
        var t = y[e];
        t.openState && b !== t && (b = t,
        t.getParent().appendChild(t),
        t.emit("focus"))
    }
    ,
    v.positionWindow = function(e, t) {
        var i, n = y[e];
        if (t)
            i = h(t);
        else if (n.initialPosition) {
            var o = n.initialPosition;
            i = {
                x: o.x,
                y: o.y,
                width: o.width,
                height: o.height
            }
        } else
            i = h(n.positionInfo);
        n.position = i,
        n.setStyles({
            width: i.width + "px",
            height: i.height + "px",
            webkitTransform: "translate3d(" + i.x + "px," + i.y + "px,0) scale(1)"
        }),
        t ? n.emit("positioned") : n.emit("repositioned")
    }
    ,
    v.openDialog = function(e, t) {
        if (!w) {
            Array.isArray(e) || (e = [e]),
            w = e;
            for (var i = 0, n = e.length; i < n; i += 1)
                v.open(e[i], t);
            window.foreground.lock("windowsManagerDialog");
        }
    }
    ,
    v.continueDialog = function(e, t) {
        w = null ,
        this.openDialog(e, t)
    }
    ,
    v.isDialogActive = function() {
        return !!w
    }
    ,
    v.close = function(e, t) {
        var i = t && t.keepDialog;
        return !i && w && w.indexOf(e) !== -1 ? (window.dofus.sendMessage("LeaveDialogRequestMessage", null ),
        a()) : void s(e, t)
    }
    ,
    v._forceClose = function(e) {
        return w && w.indexOf(e) !== -1 ? (window.gui.isConnected && window.dofus.sendMessage("LeaveDialogRequestMessage", null ),
        a()) : void s(e)
    }
    ,
    v.closeAll = function() {
        for (var e in y)
            "popup" !== e && y[e].openState && this._forceClose(e)
    }
    ,
    v["switch"] = function(e, t) {
        var i = y[e];
        i.openState ? i === b ? this.close(e) : v.focusWindow(e) : this.open(e, t)
    }
    ,
    v.getWindow = function(e) {
        return y[e]
    }
    ,
    v.moveAndResizeWindow = function(e, t, i, n, o) {
        var s = v.getWindow(e)
          , a = s.position.x
          , r = s.position.y
          , l = s.position.width
          , c = s.position.height;
        null !== t && void 0 !== t || (t = a),
        null !== i && void 0 !== i || (i = r),
        null !== n && void 0 !== n || (n = l),
        null !== o && void 0 !== o || (o = c);
        var u = "translate3d(" + t + "px, " + i + "px,0)";
        m.tween(s, {
            webkitTransform: u,
            width: n + "px",
            height: o + "px"
        }, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, function() {
            v.positionWindow(e, {
                left: t,
                top: i,
                width: n,
                height: o
            })
        })
    }
    ,
    v.arrangeOpeningWindow = function(e, t) {
        var i = t.leftOf || t.rightOf
          , n = v.getWindow(e)
          , o = v.getWindow(i);
        if (n && o.openState) {
            var s, a, r, l = n.position.width, c = o.position.width, u = o.position.x, h = u;
            t.leftOf ? (s = u - l,
            s < 0 && (s = 0,
            h = Math.min(l, d.screenWidth - c))) : t.rightOf && (s = u + c,
            s + l > d.screenWidth && (s = d.screenWidth - l,
            h = Math.max(0, s - c))),
            t.sameHeight && (a = n.position.height,
            r = n.position.y),
            n.position.x = s,
            t.height && (n.position.height = t.height),
            v.positionWindow(e, n.position),
            (h !== u || a) && v.moveAndResizeWindow(i, h, r, null , a)
        }
    }
    ,
    v.arrangeOpeningWindowVertically = function(e, t) {
        var i = t.below
          , n = v.getWindow(e)
          , o = v.getWindow(i);
        if (n && o.openState) {
            var s;
            t.below && (s = o.position.y + o.position.height,
            t.fullHeight && (n.position.height = d.windowFullScreenHeight - s)),
            n.position.x = o.position.x,
            n.position.y = s,
            t.height && (n.position.height = t.height),
            v.positionWindow(e, n.position)
        }
    }
    ,
    v.getOpenWindows = function() {
        var e = [];
        for (var t in y)
            "popup" !== t && y[t].openState && ("function" == typeof y[t].getOpenedTabId ? e.push(t + " > " + y[t].getOpenedTabId()) : e.push(t));
        return e
    }
    ,
    v.getLastClosedWindow = function() {
        return C
    }
    ,
    e.exports = v
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        p.screenWidth = e || document.documentElement.clientWidth,
        p.screenHeight = t || document.documentElement.clientHeight,
        p.physicalToViewportRatio = p.screenWidth / p.physicalScreenWidth
    }
    function o(e) {
        var t = e / c.MAP_SCENE_HEIGHT;
        p.mapWidth = ~~(c.MAP_SCENE_WIDTH * t),
        p.mapHeight = ~~(c.MAP_SCENE_HEIGHT * t),
        p.zoom = c.PIXEL_RATIO * t,
        p.sideBarWidth = p.screenWidth - p.mapWidth,
        p.bottomBarHeight = p.screenHeight - p.mapHeight
    }
    function s(e, t) {
        var i, n, o;
        "narrow" === e ? (i = p.screenWidth,
        n = c.CHAT_BTN_MIN_WIDTH,
        p.mainControlBarSize = 132,
        o = c.PING_EMOTE_BTN_NARROW_MIN_WIDTH) : (i = p.screenHeight,
        n = c.CHAT_BTN_MIN_HEIGHT,
        p.mainControlBarSize = 72,
        o = c.PING_EMOTE_BTN_WIDE_MIN_HEIGHT);
        var s = 0;
        "narrow" === e ? (p.posChatBtn = s,
        s += n,
        p.pingEmoteBtnSize = o,
        p.posPingEmoteBtn = s,
        s += o) : (p.pingEmoteBtnSize = o,
        o = 0),
        p.posMainControlBar = s,
        s += p.mainControlBarSize;
        var a = window.gui.shortcutBar
          , r = window.gui.menuBar
          , l = i - p.mainControlBarSize - n
          , h = t ? u.menubarSizeInFight : u.menubarSize
          , d = r.computeMinimumSize(h, e)
          , m = ~~(l - d - o)
          , f = a.computeBestSize(m, e)
          , g = l - f - o - d;
        p.menuBarSize = d + g,
        p.shortcutBarSize = f,
        p.posShortcutBar = s,
        s += p.shortcutBarSize,
        p.posMenuBar = s,
        s += p.menuBarSize,
        "wide" === e && (p.posChatBtn = s,
        p.posPingEmoteBtn = s)
    }
    function a(e) {
        var t;
        return t = "narrow" === e ? window.gui.playerData.isFighting ? u.toolbarThicknessInFight : 1 : 3,
        t * c.SHORTCUT_ICON_SIZE + c.SHORTCUT_GAUGE_SIZE + 5
    }
    function r(e) {
        var t = "narrow"
          , i = p.screenHeight - a(t)
          , n = i / c.MAP_SCENE_HEIGHT
          , r = ~~(c.MAP_SCENE_WIDTH * n);
        r > p.screenWidth && (n = p.screenWidth / c.MAP_SCENE_WIDTH,
        i = ~~(c.MAP_SCENE_HEIGHT * n)),
        o(i),
        p.bottomBarHeight = Math.min(p.bottomBarHeight, h),
        s(t, e),
        p.mapLeft = Math.round(p.sideBarWidth / 2),
        p.mapTop = p.screenHeight - p.bottomBarHeight - p.mapHeight,
        p.mapRight = p.mapLeft + p.mapWidth,
        p.mapBottom = p.mapTop + p.mapHeight,
        p.windowFullScreenWidth = p.screenWidth,
        p.windowFullScreenHeight = p.mapBottom,
        p.screenExceptToolbar = {
            left: 0,
            top: 0,
            width: p.screenWidth,
            height: p.screenHeight - p.bottomBarHeight
        }
    }
    function l(e) {
        var t = "wide"
          , i = p.screenWidth - a(t)
          , n = i / c.MAP_SCENE_WIDTH
          , r = ~~(c.MAP_SCENE_HEIGHT * n);
        o(Math.min(r, p.screenHeight)),
        p.sideBarWidth = Math.min(p.sideBarWidth, d),
        s(t, e),
        p.mapLeft = p.screenWidth - p.sideBarWidth - p.mapWidth,
        p.mapTop = Math.round(p.bottomBarHeight / 2),
        p.mapRight = p.mapLeft + p.mapWidth,
        p.mapBottom = p.mapTop + p.mapHeight,
        p.windowFullScreenWidth = p.screenWidth,
        p.windowFullScreenHeight = p.screenHeight,
        p.screenExceptToolbar = {
            left: 0,
            top: 0,
            width: p.screenWidth - p.sideBarWidth,
            height: p.screenHeight
        }
    }
    var c = i(6)
      , u = i(25)
      , h = 175
      , d = 210
      , p = {
        physicalScreenWidth: Math.max(window.screen.width, window.screen.height),
        physicalScreenHeight: Math.min(window.screen.width, window.screen.height)
    };
    n(),
    t.dimensions = p,
    t.updateScreen = n,
    t.resizeWideScreen = l,
    t.resizeNarrowScreen = r
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.optionDefs = null
    }
    var o = i(26).inherits
      , s = i(29).EventEmitter
      , a = i(30)
      , r = "option-";
    o(n, s),
    e.exports = new n,
    n.prototype.initialize = function(e) {
        this.optionDefs = {
            showAllMonsters: {
                init: !0
            },
            maxActorsBeforeCreatureMode: {
                init: 9999,
                onChange: window.actorManager.onMaxActorsBeforeCreatureModeChange.bind(window.actorManager)
            },
            hideDeadFighters: {
                init: !0
            },
            allowSpellEffects: {
                init: !0
            },
            autoGpsFlags: {
                init: !0
            },
            autoGpsPhoenixes: {
                init: !0,
                onChange: function() {
                    e.compass.updateMarkersPositions()
                }
            },
            menubarSize: {
                init: e.ipadRatio ? 6 : 3
            },
            menubarSizeInFight: {
                init: e.ipadRatio ? 3 : 2
            },
            toolbarThicknessInFight: {
                init: 1
            },
            tutorialTips: {
                init: !0
            },
            soundOnPlayerTurnStart: {
                init: !0
            },
            alwaysShowGrid: {
                init: !1,
                onChange: window.isoEngine.toggleGrid.bind(window.isoEngine)
            },
            spellTooltipName: {
                init: !0
            },
            spellTooltipApRange: {
                init: !0
            },
            spellTooltipCritical: {
                init: !1
            },
            spellTooltipEffect: {
                init: !1
            },
            spellTooltipDescription: {
                init: !0
            },
            confirmBoxWhenDragCasting: {
                init: !0
            },
            confirmBoxWhenClickCasting: {
                init: !0
            },
            confirmBoxWhenWalking: {
                init: !0
            },
            showSpeechBubbleInFight: {
                init: !0
            },
            orderFighters: {
                init: !1
            },
            showApMpUsed: {
                init: !1
            }
        },
        this._loadAllOptions()
    }
    ,
    n.prototype._loadAllOptions = function() {
        for (var e in this.optionDefs) {
            var t = this.optionDefs[e];
            this[e] = a.getValue(r + e, t.init)
        }
    }
    ,
    n.prototype.changeValue = function(e, t) {
        var i = this[e];
        this[e] = t,
        a.setValue(r + e, t);
        var n = this.optionDefs[e];
        n.onChange && n.onChange(t, i),
        this.emit(e, t, i)
    }
}
, function(e, t, i) {
    (function(e, n) {
        function o(e, i) {
            var n = {
                seen: [],
                stylize: a
            };
            return arguments.length >= 3 && (n.depth = arguments[2]),
            arguments.length >= 4 && (n.colors = arguments[3]),
            f(i) ? n.showHidden = i : i && t._extend(n, i),
            b(n.showHidden) && (n.showHidden = !1),
            b(n.depth) && (n.depth = 2),
            b(n.colors) && (n.colors = !1),
            b(n.customInspect) && (n.customInspect = !0),
            n.colors && (n.stylize = s),
            l(n, e, n.depth)
        }
        function s(e, t) {
            var i = o.styles[t];
            return i ? "[" + o.colors[i][0] + "m" + e + "[" + o.colors[i][1] + "m" : e
        }
        function a(e, t) {
            return e
        }
        function r(e) {
            var t = {};
            return e.forEach(function(e, i) {
                t[e] = !0
            }),
            t
        }
        function l(e, i, n) {
            if (e.customInspect && i && A(i.inspect) && i.inspect !== t.inspect && (!i.constructor || i.constructor.prototype !== i)) {
                var o = i.inspect(n, e);
                return y(o) || (o = l(e, o, n)),
                o
            }
            var s = c(e, i);
            if (s)
                return s;
            var a = Object.keys(i)
              , f = r(a);
            if (e.showHidden && (a = Object.getOwnPropertyNames(i)),
            S(i) && (a.indexOf("message") >= 0 || a.indexOf("description") >= 0))
                return u(i);
            if (0 === a.length) {
                if (A(i)) {
                    var g = i.name ? ": " + i.name : "";
                    return e.stylize("[Function" + g + "]", "special")
                }
                if (C(i))
                    return e.stylize(RegExp.prototype.toString.call(i), "regexp");
                if (T(i))
                    return e.stylize(Date.prototype.toString.call(i), "date");
                if (S(i))
                    return u(i)
            }
            var _ = ""
              , v = !1
              , w = ["{", "}"];
            if (m(i) && (v = !0,
            w = ["[", "]"]),
            A(i)) {
                var b = i.name ? ": " + i.name : "";
                _ = " [Function" + b + "]"
            }
            if (C(i) && (_ = " " + RegExp.prototype.toString.call(i)),
            T(i) && (_ = " " + Date.prototype.toUTCString.call(i)),
            S(i) && (_ = " " + u(i)),
            0 === a.length && (!v || 0 == i.length))
                return w[0] + _ + w[1];
            if (n < 0)
                return C(i) ? e.stylize(RegExp.prototype.toString.call(i), "regexp") : e.stylize("[Object]", "special");
            e.seen.push(i);
            var I;
            return I = v ? h(e, i, n, f, a) : a.map(function(t) {
                return d(e, i, n, f, t, v)
            }),
            e.seen.pop(),
            p(I, _, w)
        }
        function c(e, t) {
            if (b(t))
                return e.stylize("undefined", "undefined");
            if (y(t)) {
                var i = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'";
                return e.stylize(i, "string")
            }
            return v(t) ? e.stylize("" + t, "number") : f(t) ? e.stylize("" + t, "boolean") : g(t) ? e.stylize("null", "null") : void 0
        }
        function u(e) {
            return "[" + Error.prototype.toString.call(e) + "]"
        }
        function h(e, t, i, n, o) {
            for (var s = [], a = 0, r = t.length; a < r; ++a)
                R(t, String(a)) ? s.push(d(e, t, i, n, String(a), !0)) : s.push("");
            return o.forEach(function(o) {
                o.match(/^\d+$/) || s.push(d(e, t, i, n, o, !0))
            }),
            s
        }
        function d(e, t, i, n, o, s) {
            var a, r, c;
            if (c = Object.getOwnPropertyDescriptor(t, o) || {
                value: t[o]
            },
            c.get ? r = c.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : c.set && (r = e.stylize("[Setter]", "special")),
            R(n, o) || (a = "[" + o + "]"),
            r || (e.seen.indexOf(c.value) < 0 ? (r = g(i) ? l(e, c.value, null ) : l(e, c.value, i - 1),
            r.indexOf("\n") > -1 && (r = s ? r.split("\n").map(function(e) {
                return "  " + e
            }).join("\n").substr(2) : "\n" + r.split("\n").map(function(e) {
                return "   " + e
            }).join("\n"))) : r = e.stylize("[Circular]", "special")),
            b(a)) {
                if (s && o.match(/^\d+$/))
                    return r;
                a = JSON.stringify("" + o),
                a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (a = a.substr(1, a.length - 2),
                a = e.stylize(a, "name")) : (a = a.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"),
                a = e.stylize(a, "string"))
            }
            return a + ": " + r
        }
        function p(e, t, i) {
            var n = 0
              , o = e.reduce(function(e, t) {
                return n++,
                t.indexOf("\n") >= 0 && n++,
                e + t.replace(/\u001b\[\d\d?m/g, "").length + 1
            }, 0);
            return o > 60 ? i[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + i[1] : i[0] + t + " " + e.join(", ") + " " + i[1]
        }
        function m(e) {
            return Array.isArray(e)
        }
        function f(e) {
            return "boolean" == typeof e
        }
        function g(e) {
            return null === e
        }
        function _(e) {
            return null == e
        }
        function v(e) {
            return "number" == typeof e
        }
        function y(e) {
            return "string" == typeof e
        }
        function w(e) {
            return "symbol" == typeof e
        }
        function b(e) {
            return void 0 === e
        }
        function C(e) {
            return I(e) && "[object RegExp]" === x(e)
        }
        function I(e) {
            return "object" == typeof e && null !== e
        }
        function T(e) {
            return I(e) && "[object Date]" === x(e)
        }
        function S(e) {
            return I(e) && ("[object Error]" === x(e) || e instanceof Error)
        }
        function A(e) {
            return "function" == typeof e
        }
        function E(e) {
            return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" == typeof e || "undefined" == typeof e
        }
        function x(e) {
            return Object.prototype.toString.call(e)
        }
        function M(e) {
            return e < 10 ? "0" + e.toString(10) : e.toString(10)
        }
        function N() {
            var e = new Date
              , t = [M(e.getHours()), M(e.getMinutes()), M(e.getSeconds())].join(":");
            return [e.getDate(), L[e.getMonth()], t].join(" ")
        }
        function R(e, t) {
            return Object.prototype.hasOwnProperty.call(e, t)
        }
        var O = /%[sdj%]/g;
        t.format = function(e) {
            if (!y(e)) {
                for (var t = [], i = 0; i < arguments.length; i++)
                    t.push(o(arguments[i]));
                return t.join(" ")
            }
            for (var i = 1, n = arguments, s = n.length, a = String(e).replace(O, function(e) {
                if ("%%" === e)
                    return "%";
                if (i >= s)
                    return e;
                switch (e) {
                case "%s":
                    return String(n[i++]);
                case "%d":
                    return Number(n[i++]);
                case "%j":
                    try {
                        return JSON.stringify(n[i++])
                    } catch (t) {
                        return "[Circular]"
                    }
                default:
                    return e
                }
            }), r = n[i]; i < s; r = n[++i])
                a += g(r) || !I(r) ? " " + r : " " + o(r);
            return a
        }
        ,
        t.deprecate = function(i, o) {
            function s() {
                if (!a) {
                    if (n.throwDeprecation)
                        throw new Error(o);
                    n.traceDeprecation ? console.trace(o) : console.error(o),
                    a = !0
                }
                return i.apply(this, arguments)
            }
            if (b(e.process))
                return function() {
                    return t.deprecate(i, o).apply(this, arguments)
                }
                ;
            if (n.noDeprecation === !0)
                return i;
            var a = !1;
            return s
        }
        ;
        var P, D = {};
        t.debuglog = function(e) {
            if (b(P) && (P = n.env.NODE_DEBUG || ""),
            e = e.toUpperCase(),
            !D[e])
                if (new RegExp("\\b" + e + "\\b","i").test(P)) {
                    var i = n.pid;
                    D[e] = function() {
                        var n = t.format.apply(t, arguments);
                        console.error("%s %d: %s", e, i, n)
                    }
                } else
                    D[e] = function() {}
                    ;
            return D[e]
        }
        ,
        t.inspect = o,
        o.colors = {
            bold: [1, 22],
            italic: [3, 23],
            underline: [4, 24],
            inverse: [7, 27],
            white: [37, 39],
            grey: [90, 39],
            black: [30, 39],
            blue: [34, 39],
            cyan: [36, 39],
            green: [32, 39],
            magenta: [35, 39],
            red: [31, 39],
            yellow: [33, 39]
        },
        o.styles = {
            special: "cyan",
            number: "yellow",
            "boolean": "yellow",
            undefined: "grey",
            "null": "bold",
            string: "green",
            date: "magenta",
            regexp: "red"
        },
        t.isArray = m,
        t.isBoolean = f,
        t.isNull = g,
        t.isNullOrUndefined = _,
        t.isNumber = v,
        t.isString = y,
        t.isSymbol = w,
        t.isUndefined = b,
        t.isRegExp = C,
        t.isObject = I,
        t.isDate = T,
        t.isError = S,
        t.isFunction = A,
        t.isPrimitive = E,
        t.isBuffer = i(27);
        var L = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        t.log = function() {
            console.log("%s - %s", N(), t.format.apply(t, arguments))
        }
        ,
        t.inherits = i(28),
        t._extend = function(e, t) {
            if (!t || !I(t))
                return e;
            for (var i = Object.keys(t), n = i.length; n--; )
                e[i[n]] = t[i[n]];
            return e
        }
    }
    ).call(t, function() {
        return this
    }(), i(14))
}
, function(e, t) {
    e.exports = function(e) {
        return e && "object" == typeof e && "function" == typeof e.copy && "function" == typeof e.fill && "function" == typeof e.readUInt8
    }
}
, function(e, t) {
    "function" == typeof Object.create ? e.exports = function(e, t) {
        e.super_ = t,
        e.prototype = Object.create(t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        })
    }
    : e.exports = function(e, t) {
        e.super_ = t;
        var i = function() {};
        i.prototype = t.prototype,
        e.prototype = new i,
        e.prototype.constructor = e
    }
}
, function(e, t) {
    function i() {
        this._events = this._events || {},
        this._maxListeners = this._maxListeners || void 0
    }
    function n(e) {
        return "function" == typeof e
    }
    function o(e) {
        return "number" == typeof e
    }
    function s(e) {
        return "object" == typeof e && null !== e
    }
    function a(e) {
        return void 0 === e
    }
    e.exports = i,
    i.EventEmitter = i,
    i.prototype._events = void 0,
    i.prototype._maxListeners = void 0,
    i.defaultMaxListeners = 10,
    i.prototype.setMaxListeners = function(e) {
        if (!o(e) || e < 0 || isNaN(e))
            throw TypeError("n must be a positive number");
        return this._maxListeners = e,
        this
    }
    ,
    i.prototype.emit = function(e) {
        var t, i, o, r, l, c;
        if (this._events || (this._events = {}),
        "error" === e && (!this._events.error || s(this._events.error) && !this._events.error.length)) {
            if (t = arguments[1],
            t instanceof Error)
                throw t;
            var u = new Error('Uncaught, unspecified "error" event. (' + t + ")");
            throw u.context = t,
            u
        }
        if (i = this._events[e],
        a(i))
            return !1;
        if (n(i))
            switch (arguments.length) {
            case 1:
                i.call(this);
                break;
            case 2:
                i.call(this, arguments[1]);
                break;
            case 3:
                i.call(this, arguments[1], arguments[2]);
                break;
            default:
                r = Array.prototype.slice.call(arguments, 1),
                i.apply(this, r)
            }
        else if (s(i))
            for (r = Array.prototype.slice.call(arguments, 1),
            c = i.slice(),
            o = c.length,
            l = 0; l < o; l++)
                c[l].apply(this, r);
        return !0
    }
    ,
    i.prototype.addListener = function(e, t) {
        var o;
        if (!n(t))
            throw TypeError("listener must be a function");
        return this._events || (this._events = {}),
        this._events.newListener && this.emit("newListener", e, n(t.listener) ? t.listener : t),
        this._events[e] ? s(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t,
        s(this._events[e]) && !this._events[e].warned && (o = a(this._maxListeners) ? i.defaultMaxListeners : this._maxListeners,
        o && o > 0 && this._events[e].length > o && (this._events[e].warned = !0,
        console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e].length),
        "function" == typeof console.trace && console.trace())),
        this
    }
    ,
    i.prototype.on = i.prototype.addListener,
    i.prototype.once = function(e, t) {
        function i() {
            this.removeListener(e, i),
            o || (o = !0,
            t.apply(this, arguments))
        }
        if (!n(t))
            throw TypeError("listener must be a function");
        var o = !1;
        return i.listener = t,
        this.on(e, i),
        this
    }
    ,
    i.prototype.removeListener = function(e, t) {
        var i, o, a, r;
        if (!n(t))
            throw TypeError("listener must be a function");
        if (!this._events || !this._events[e])
            return this;
        if (i = this._events[e],
        a = i.length,
        o = -1,
        i === t || n(i.listener) && i.listener === t)
            delete this._events[e],
            this._events.removeListener && this.emit("removeListener", e, t);
        else if (s(i)) {
            for (r = a; r-- > 0; )
                if (i[r] === t || i[r].listener && i[r].listener === t) {
                    o = r;
                    break
                }
            if (o < 0)
                return this;
            1 === i.length ? (i.length = 0,
            delete this._events[e]) : i.splice(o, 1),
            this._events.removeListener && this.emit("removeListener", e, t)
        }
        return this
    }
    ,
    i.prototype.removeAllListeners = function(e) {
        var t, i;
        if (!this._events)
            return this;
        if (!this._events.removeListener)
            return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e],
            this;
        if (0 === arguments.length) {
            for (t in this._events)
                "removeListener" !== t && this.removeAllListeners(t);
            return this.removeAllListeners("removeListener"),
            this._events = {},
            this
        }
        if (i = this._events[e],
        n(i))
            this.removeListener(e, i);
        else if (i)
            for (; i.length; )
                this.removeListener(e, i[i.length - 1]);
        return delete this._events[e],
        this
    }
    ,
    i.prototype.listeners = function(e) {
        var t;
        return t = this._events && this._events[e] ? n(this._events[e]) ? [this._events[e]] : this._events[e].slice() : []
    }
    ,
    i.prototype.listenerCount = function(e) {
        if (this._events) {
            var t = this._events[e];
            if (n(t))
                return 1;
            if (t)
                return t.length
        }
        return 0
    }
    ,
    i.listenerCount = function(e, t) {
        return e.listenerCount(t)
    }
}
, function(e, t) {
    function i() {
        this._hasListeners = !1,
        this.autosave = null ,
        this.nextSaveTime = 0,
        this.accountName = null ,
        this.prefs = {},
        this._load()
    }
    var n = "dofus.1"
      , o = 180
      , s = "all";
    i.prototype.close = function() {
        this.setAccount(null )
    }
    ,
    i.prototype._setupListeners = function() {
        if (!this._hasListeners) {
            var e = this;
            window.gui.on("appOnBackground", function() {
                null !== e.accountName && e.autosave && e._save()
            }),
            this._hasListeners = !0
        }
    }
    ,
    i.prototype.setAccount = function(e) {
        this.autosave && this._save(),
        this.accountName = e,
        this._setupListeners()
    }
    ,
    i.prototype._load = function() {
        try {
            var e = window.localStorage.getItem(n);
            e && (this.prefs = JSON.parse(e))
        } catch (t) {
            console.warn("Failed to load user preferences: " + t)
        }
    }
    ,
    i.prototype._scheduleNextSave = function(e) {
        var t = this;
        e || (e = o);
        var i = Date.now() + 1e3 * e;
        this.autosave && this.nextSaveTime <= i || (this.autosave && window.clearTimeout(this.autosave),
        this.nextSaveTime = i,
        this.autosave = window.setTimeout(function() {
            t.autosave = null ,
            t._save()
        }, 1e3 * e))
    }
    ,
    i.prototype._save = function() {
        try {
            this.autosave && (window.clearTimeout(this.autosave),
            this.autosave = null ),
            window.localStorage.setItem(n, JSON.stringify(this.prefs))
        } catch (e) {
            console.warn("Failed to save user preferences: " + e)
        }
    }
    ,
    i.prototype.saveNow = function() {
        this._save()
    }
    ,
    i.prototype.getValue = function(e, t, i) {
        e = (this.accountName && !i ? this.accountName : s) + "#" + e;
        var n = this.prefs[e];
        return void 0 === n ? t : n
    }
    ,
    i.prototype.setValue = function(e, t, i, n) {
        e = (this.accountName && !n ? this.accountName : s) + "#" + e,
        this.prefs[e] = t,
        this._scheduleNextSave(i)
    }
    ,
    i.prototype.delValue = function(e, t, i) {
        e = (this.accountName && !i ? this.accountName : s) + "#" + e,
        delete this.prefs[e],
        this._scheduleNextSave(t)
    }
    ;
    var a = new i;
    e.exports = a
}
, function(e, t) {
    function i(e) {
        return !!e._tween && (e._tween.cancel(),
        e.emit("tweenCancelled"),
        !0)
    }
    t.tween = function(e, t, n, o) {
        function s() {
            window.clearTimeout(p),
            u.removeEventListener("webkitTransitionEnd", m),
            p = null ,
            u.style.webkitTransition = h,
            e._tween = null
        }
        function a() {
            f || g || (f = g = !0,
            s(),
            o = null )
        }
        i(e),
        n = n || {};
        var r = n.time || 500
          , l = n.delay || 0
          , c = n.easing || "ease-in-out"
          , u = e.rootElement
          , h = u.style.webkitTransition
          , d = "all " + r + "ms " + c;
        l && (d += " " + l + "ms");
        var p, m, f = !1, g = !1;
        return m = function(t) {
            g || (g = !0,
            t && t.stopPropagation(),
            s(),
            o && (o.call(e, t),
            o = null ))
        }
        ,
        window.setTimeout(function() {
            if (!f) {
                u.style.webkitTransition = d;
                for (var e in t)
                    u.style[e] = t[e];
                u.addEventListener("webkitTransitionEnd", m),
                p = window.setTimeout(m, l + r)
            }
        }, 0),
        e._tween = {
            cancel: a
        },
        e._tween
    }
    ,
    t.cancelTween = i
}
, function(e, t, i) {
    function n() {
        this.setEnable(!0)
    }
    function o() {
        this.setEnable(!1)
    }
    function s() {
        this.isEnable() && (this.emit("tapstart"),
        this.emit("tapend"),
        this.emit("tap"))
    }
    function a(e, t) {
        function i() {
            r = null ,
            window.clearTimeout(_),
            clearInterval(w),
            l.removeListener("dom.touchmove", m),
            l.removeListener("dom.touchend", g)
        }
        function a(t) {
            r === e && (T = !0,
            e.emit("tapend", t)),
            i()
        }
        function h(t) {
            w = setInterval(function() {
                e.emit("tap")
            }, t)
        }
        function m(e) {
            var t = c(e);
            (t.x < y.left || t.x > y.left + y.width || t.y < y.top || t.y > y.top + y.height) && a(t)
        }
        function f(t) {
            w = null ,
            v = c(t),
            r || !I || v.touchCount > 1 || (r = e,
            T = !1,
            y = e.rootElement.getBoundingClientRect(),
            e.emit("tapstart", v, y),
            window.clearTimeout(_),
            _ = window.setTimeout(function() {
                S ? h(S) : e.emit("longtap", v)
            }, d),
            l.on("dom.touchmove", m),
            l.on("dom.touchend", g),
            u.recordActivity())
        }
        function g(t) {
            if (!T) {
                var n = e !== r;
                if (i(),
                !n) {
                    var o = c(t);
                    if (e.emit("tapend", o),
                    !w) {
                        var s = Date.now();
                        !S && C && b >= s - C ? e.emit("doubletap", o) : e.emit("tap", o),
                        C = s
                    }
                }
            }
        }
        if (!e._tapBehavior) {
            t = t || {},
            e._tapBehavior = !0,
            e.allowDomEvents();
            var _, v, y, w, b = t.doubletapTimeout || p, C = 0, I = !0, T = !1, S = t.repeatDelay;
            e.setEnable = function(t) {
                "boolean" != typeof t && console.error(new Error("tapBehavior: setEnable has been called with an undefined param")),
                I = t,
                e.emit("enable", t)
            }
            ,
            e.isEnable = function() {
                return I
            }
            ,
            e.enable = n,
            e.disable = o,
            e.tap = s,
            e.cancelTap = a,
            e.on("dom.touchstart", f)
        }
    }
    var r, l, c = i(33).getPosition, u = i(34), h = i(47), d = 400, p = 200;
    e.exports = a,
    a.initialize = function(e) {
        l = e,
        h.on("handleTaken", function() {
            r && r.cancelTap()
        })
    }
}
, function(e, t) {
    var i = !1;
    "ontouchstart"in window && (i = !0);
    var n, o = {
        x: 0,
        y: 0
    };
    n = i ? function(e) {
        var t = e.touches || []
          , i = t.length;
        if (0 === i)
            return {
                x: o.x,
                y: o.y,
                touches: [],
                touchCount: 0
            };
        for (var n = [], s = 0; s < i; s += 1)
            n.push({
                x: t[s].clientX,
                y: t[s].clientY
            });
        return o.x = t[0].clientX,
        o.y = t[0].clientY,
        {
            x: o.x,
            y: o.y,
            touches: n,
            touchCount: i
        }
    }
    : function(e) {
        return o.x = e.clientX,
        o.y = e.clientY,
        {
            x: o.x,
            y: o.y,
            touchCount: "mouseup" === e.type ? 0 : 1,
            touches: [{
                x: o.x,
                y: o.y
            }]
        }
    }
    ,
    e.exports = {
        canTouch: i,
        getPosition: n,
        position: o,
        events: {
            start: i ? "touchstart" : "mousedown",
            move: i ? "touchmove" : "mousemove",
            end: i ? "touchend" : "mouseup"
        }
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.isListening = !1,
        this.isConnected = !1,
        this.pingInterval = null ,
        this.activityInterval = null ,
        this.isInactive = !1,
        this.hasSeenActivity = !1,
        this.lastActivityTime = null
    }
    var o = i(29).EventEmitter
      , s = i(35).getText
      , a = i(26).inherits
      , r = 6e5
      , l = 3e5
      , c = 6e5
      , u = 12e4
      , h = 1e3;
    a(n, o),
    e.exports = new n,
    n.prototype.initialize = function(e) {
        var t = this
          , i = window.dofus.connectionManager;
        i.on("ServersListMessage", function() {
            t._start()
        }),
        e.on("connected", function() {
            t.isConnected = !0
        }),
        e.on("disconnect", function() {
            t.isConnected = !1,
            t._stop()
        }),
        e.on("appOnBackground", function() {
            t._stop()
        }),
        i.on("sessionReconnected", function() {
            t.isListening || t._start()
        })
    }
    ,
    n.prototype._start = function() {
        this.isListening || (this.isListening = !0,
        this.activityInterval = window.setInterval(function(e) {
            e._checkActivity()
        }, u, this),
        this.pingInterval = window.setInterval(function(e) {
            e._pingServer()
        }, r, this),
        this.isInactive = !1,
        this.hasSeenActivity = !1,
        this.lastActivityTime = Date.now())
    }
    ,
    n.prototype._stop = function() {
        this.isListening && (this.isListening = !1,
        window.clearInterval(this.activityInterval),
        window.clearInterval(this.pingInterval))
    }
    ,
    n.prototype.recordActivity = function() {
        this.hasSeenActivity = !0,
        this.lastActivityTime = Date.now(),
        this.isInactive && this.isListening && this._leaveInactiveMode()
    }
    ,
    n.prototype.isActiveSince = function(e) {
        return this.lastActivityTime >= e
    }
    ,
    n.prototype._checkActivity = function() {
        var e = Date.now() - this.lastActivityTime + h;
        e < l || (this.isInactive ? e >= c && window.dofus.disconnect("INACTIVITY") : this._enterInactiveMode())
    }
    ,
    n.prototype._pingServer = function() {
        this.hasSeenActivity && (this.hasSeenActivity = !1,
        window.dofus.sendMessage("BasicPingMessage", {
            quiet: !0
        }))
    }
    ,
    n.prototype._enterInactiveMode = function() {
        this.isInactive = !0,
        this.isConnected && this.emit("inactive", !0),
        window.gui.openSimplePopup(s("ui.common.inactivityWarning"), s("ui.popup.warning"))
    }
    ,
    n.prototype._leaveInactiveMode = function() {
        this.isInactive = !1,
        this.isConnected ? this.emit("inactive", !1) : this._pingServer()
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        for (var n = void 0 !== i ? i : t[1], o = "", s = 0, a = e.length; s < a; s++) {
            var r = e[s];
            if ("%" === r || "#" === r) {
                var l = parseInt(e[s + 1], 10);
                if (!isNaN(l)) {
                    var c = t[l];
                    void 0 === i && (n = c),
                    void 0 !== c && null !== c && (o += c),
                    s++;
                    continue
                }
            }
            if ("{" === r || "(" === r) {
                var u = e.indexOf("{" === r ? "}" : ")", s);
                if (u !== -1 && "~" === e[s + 1]) {
                    var h = !1;
                    switch (e[s + 2]) {
                    case "p":
                        h = 1 !== n && "1" !== n;
                        break;
                        //!=1 is gramatically correct and similar to Ankama's code
                    case "s":
                        h = 1 === n || "1" === n;
                        break;
                    case "m":
                        h = 0 === n;
                        break;
                    case "f":
                        h = 0 !== n;
                        break;
                    case "1":
                        "~" === e[s + 3] && "2" === e[s + 4] && (h = void 0 !== t[1] && null !== t[1] && void 0 !== t[2] && null !== t[2],
                        s += 2);
                        break;
                    default:
                        console.error("Found unknown marker in:", e)
                    }
                    h && (o += e.substring(s + 3, u)),
                    s = u;
                    continue
                }
            }
            o += r
        }
        return o
    }
    function o(e, t) {
        return u ? a + "[" + e + "]" : void 0 === t[1] ? e : n(e, t)
    }
    var s = i(36)
      , a = "en"
      , r = "en"
      , l = null
      , c = null
      , u = !1;
    t.initialize = function(e, t) {
        return l && a === e.language && u === e.chaseText ? t() : (a = e.language,
        u = e.chaseText,
        r = e.failoverLanguage || r,
        void s.getDictionary(r, function(e, i) {
            return e ? t(e) : (c = i,
            void s.getDictionary(a, function(e, i) {
                return e ? t(e) : (l = i,
                void t())
            }))
        }))
    }
    ,
    t.initializeStatic = function(e, t) {
        a = e,
        l = t
    }
    ,
    t.findText = function(e) {
        return u ? a + "[" + e + "]" : e
    }
    ,
    t.getText = function(e) {
        var t = l[e];
        if (!t) {
            if (console.warn("getText: no getText was found for", e, "in", a),
            !c[e])
                return console.error("getText: no failover getText was found for", e, "in", r),
                a + "[?" + e + "]";
            t = c[e]
        }
        return o(t, arguments)
    }
    ,
    t.getTextFailover = function(e) {
        var t = c[e];
        return t ? o(t, arguments) : (console.error("getTextFailover: no failover getText was found for", e, "in", r),
        a + "[?" + e + "]")
    }
    ,
    t.processText = function(e) {
        return n(e, arguments)
    }
    ,
    t.processTextWithModifier = function(e, t) {
        return n(e, Array.prototype.slice.call(arguments, 1), t)
    }
}
, function(e, t, i) {
    function n(e) {
        p.initialize(_ + d.cacheDatabaseSuffix, d, e)
    }
    function o(e, t, i) {
        return m(g, "/data/" + e, t, _, i)
    }
    function s(e, t) {
        for (var i = Object.keys(e), n = i.length, o = new Array(n), s = 0; s < n; s++)
            o[s] = e[i[s]];
        if (t && t.sortBy) {
            var a = t.sortBy;
            o.sort(function(e, t) {
                return e[a] - t[a]
            })
        }
        return o
    }
    function a(e, t, i) {
        var n = [];
        for (var o in e)
            n.push(e[o]);
        if (i) {
            var s = d.getKey(t);
            n.sort(function(e, t) {
                return e[s] - t[s]
            })
        }
        return n
    }
    function r(e, t) {
        p.requestAll(e, function(i, n) {
            return i ? t(i) : n ? t(null , n) : o("map", {
                "class": e
            }, function(i, n) {
                if (i)
                    return t(i);
                var o, s = d.getKey(e);
                for (var a in n) {
                    o = n[a] && void 0 !== n[a][s];
                    break
                }
                return o ? p.putAll(e, n, function(e) {
                    e && console.warn("_getAllDataMap putAll: Caching data on disk failed with error: " + e)
                }) : console.warn("Request to cache table " + e + ' which has no "' + s + '" key; table will not be cached.'),
                t(null , n)
            })
        })
    }
    function l(e, t) {
        var i = {};
        h.eachLimit(e, 5, function(e, t) {
            return r(e, function(n, o) {
                return n ? t(n) : (i[e] = o,
                t())
            })
        }, function(e) {
            return e ? t(e) : t(null , i)
        })
    }
    function c(e, t, i) {
        r(e, function(n, o) {
            return n ? i(n) : i(null , a(o, e, t))
        })
    }
    function u(e, t, i) {
        var n = {};
        h.eachLimit(e, 5, function(e, i) {
            return c(e, t, function(t, o) {
                return t ? i(t) : (n[e] = o,
                i())
            })
        }, function(e) {
            return e ? i(e) : i(null , n)
        })
    }
    var h = i(12)
      , d = i(37)
      , p = i(38)
      , m = i(40)
      , f = p.DUMMY_RECORD_FLAG
      , g = null
      , _ = null ;
    t.initialize = function(e) {
        g = e.dataUrl
    }
    ,
    t.initializeDiskCache = n,
    t.eraseDiskCache = function(e) {
        var t = ["en", "fr"];
        h.eachSeries(t, function(e, t) {
            return p["delete"](e + d.cacheDatabaseSuffix, t)
        }, e)
    }
    ,
    t.changeLanguage = function(e) {
        _ = e
    }
    ,
    t.getDictionary = function(e, t) {
        o("dictionary", {
            lang: e
        }, function(i, o) {
            return i ? t(i) : (_ = e,
            void n(function() {
                t(null , o)
            }))
        })
    }
    ,
    t.getText = function(e, t) {
        var i = {};
        Array.isArray(e) ? i.ids = e : i.id = e,
        o("text", i, function(e, i) {
            return e ? t(e) : void t(null , i)
        })
    }
    ,
    t.getDataMap = function(e, t, i) {
        return Array.isArray(t) ? void p.request(e, t, function(t, n, s) {
            if (t)
                return i(t);
            var a = {};
            for (var r in n)
                n[r][f] || (a[r] = n[r]);
            if (0 === s.length)
                return i(null , a);
            var l = {
                "class": e,
                ids: s
            };
            o("map", l, function(t, n) {
                if (t)
                    return i(t);
                for (var o = 0, r = s.length; o < r; o++) {
                    var l = s[o]
                      , c = n[l];
                    c ? a[l] = c : n[l] = p.newDummyRecord(d.getKey(e), l)
                }
                return p.put(e, n, function(e) {
                    e && console.warn("getDataMap put: Caching data on disk failed with error:", e)
                }),
                i(null , a)
            })
        }) : i(new TypeError("Data ids should be passed as an array"))
    }
    ,
    t.getDataArray = function(e, i, n, o) {
        "function" == typeof n && (o = n,
        n = null ),
        t.getDataMap(e, i, function(e, t) {
            return e ? o(e) : void o(null , s(t, n))
        })
    }
    ,
    t.searchDataMap = function(e, t, i) {
        var n = {
            "class": e,
            match: t.match,
            matchProp: t.matchProp
        };
        o("map", n, function(t, n) {
            return t ? i(t) : (p.put(e, n, function(e) {
                e && console.warn("searchDataMap put: Caching search results on disk failed with error: " + e)
            }),
            i(null , n))
        })
    }
    ,
    t.getObject = function(e, i, n) {
        return i || 0 === i ? void t.getDataMap(e, [i], function(e, t) {
            return e ? n(e) : n(null , t[i])
        }) : n(new Error("You must pass an ID"))
    }
    ,
    t.getData = function(e, i, n) {
        return Array.isArray(i) ? t.getDataArray(e, i, null , n) : void t.getObject(e, i, n)
    }
    ,
    t.getAllDataTable = function(e, t) {
        return Array.isArray(e) ? u(e, !0, t) : c(e, !0, t)
    }
    ,
    t.getAllDataBulk = function(e, t) {
        return Array.isArray(e) ? u(e, !1, t) : c(e, !1, t)
    }
    ,
    t.getAllDataMap = function(e, t) {
        return Array.isArray(e) ? l(e, t) : r(e, t)
    }
}
, function(e, t) {
    e.exports.cacheDatabaseSuffix = "DataCache";
    var i = "isCacheComplete";
    e.exports.cacheCompletion = i,
    e.exports.typeNames = ["AbuseReasons", "AchievementCategories", "AchievementObjectives", "AchievementRewards", "Achievements", "ActionDescriptions", "AlignmentBalance", "AlignmentEffect", "AlignmentGift", "AlignmentOrder", "AlignmentRank", "AlignmentRankJntGift", "AlignmentSides", "AlignmentTitles", "AlmanaxCalendars", "Appearances", "Areas", "BidHouseCategories", "Breeds", "CensoredContents", "CensoredWords", "Challenge", "ChatChannels", "CompanionCharacteristics", "Companions", "CompanionSpells", "CreatureBonesOverrides", "CreatureBonesTypes", "Documents", "Dungeons", "Effects", "EmblemBackgrounds", "EmblemSymbolCategories", "EmblemSymbols", "Emoticons", "ExternalNotifications", "Heads", "HintCategory", "Hints", "Houses", "Incarnation", "IncarnationLevels", "InfoMessages", "Interactives", "Items", "ItemSets", "ItemTypes", "Jobs", "LegendaryTreasureHunts", "LivingObjectSkinJntMood", "MapCoordinates", "MapPositions", "MapReferences", "MapScrollActions", "MonsterMiniBoss", "MonsterRaces", "Monsters", "MonsterSuperRaces", "Months", "MountBehaviors", "MountBones", "Mounts", "Notifications", "NpcActions", "NpcMessages", "Npcs", "OptionalFeatures", "Ornaments", "Pack", "Pets", "Phoenixes", "PointOfInterest", "PointOfInterestCategory", "PresetIcons", "QuestCategory", "QuestObjectives", "QuestObjectiveTypes", "Quests", "QuestStepRewards", "QuestSteps", "RankNames", "Recipes", "RideFood", "ServerCommunities", "ServerGameTypes", "ServerPopulations", "Servers", "SkillNames", "Skills", "SkinMappings", "SkinPositions", "Smileys", "SoundBones", "SoundUi", "SoundUiHook", "SpeakingItemsText", "SpeakingItemsTriggers", "SpellBombs", "SpellLevels", "SpellPairs", "Spells", "SpellStates", "SpellTypes", "StealthBones", "SubAreas", "SubAreaIdPerCoordinate", "SubAreasWorldMapData", "SuperAreas", "TaxCollectorFirstnames", "TaxCollectorNames", "Tips", "TitleCategories", "Titles", "TypeActions", "Url", "Waypoints", "WorldMaps"];
    var n = {
        AbuseReasons: "_abuseReasonId",
        AlignmentTitles: "sideId",
        CreatureBonesOverrides: "creatureBoneId",
        Houses: "typeId",
        InfoMessages: "messageId",
        LivingObjectSkinJntMood: "skinId",
        MapCoordinates: "compressedCoords",
        Phoenixes: "mapId",
        Recipes: "resultId",
        SpeakingItemsText: "textId",
        SpeakingItemsTriggers: "triggersId"
    };
    e.exports.getKey = function(e) {
        return n[e] || "id"
    }
    ;
    var o = {};
    o[i] = !0,
    e.exports.hasStringId = function(e) {
        return o[e] || !1
    }
}
, function(e, t, i) {
    function n(e) {
        return "string" == typeof e ? e : e.toString()
    }
    function o(e) {
        if ("number" == typeof e)
            return e;
        var t = parseInt(e, 10);
        return isNaN(t) ? null : t
    }
    function s(e) {
        return d.hasStringId(e) ? n : o
    }
    function a(e) {
        function t(t) {
            var i = d.getKey(t)
              , n = e.createObjectStore(t, {
                keyPath: i
            })
              , o = n.transaction;
            o.oncomplete = function() {}
            ,
            o.onabort = function() {
                console.error(new Error("Object store creation aborted for:" + t + ", with error:" + o.error))
            }
            ,
            o.onerror = function() {
                console.error(new Error("Object store creation failed for:" + t + ", with error:" + o.error))
            }
        }
        for (var i = d.typeNames, n = 0, o = i.length; n < o; ++n)
            t(i[n]);
        d.cacheCompletion && t(d.cacheCompletion)
    }
    function r(e, t, i) {
        function n(t) {
            if (void 0 === t || null === t)
                return void console.error(new Error("IndexedDB id to get in object store: " + e + ", is invalid: " + t));
            if (t = c(t),
            null === t)
                return void console.error(new Error("IndexedDB id to get in object store: " + e + ", is invalid: " + t));
            var i = l.get(t);
            i.onsuccess = function(e) {
                e.target.result ? o[t] = e.target.result : a.push(t)
            }
            ,
            i.onerror = function(i) {
                console.error("Requesting id:", t + ", in store:", e + ", failed with error:", i.target.errorCode),
                a.push(t)
            }
        }
        var o = {}
          , a = [];
        if (!t.length)
            return i(null , o, a);
        for (var r = h.transaction(e, m.READ_ONLY), l = r.objectStore(e), c = s(e), u = 0, d = t.length; u < d; ++u)
            n(t[u]);
        r.oncomplete = function() {
            i(null , o, a)
        }
        ,
        r.onabort = function() {
            var e = r.error || {};
            i(new Error("IndexedDB request transaction aborted with error: " + e.name + ", " + e.message))
        }
        ,
        r.onerror = function() {
            var e = r.error || {};
            i(new Error("IndexedDB request transaction failed with error: " + e.name + ", " + e.message))
        }
    }
    function l(e, t, i) {
        function n(t) {
            if (!t)
                return void console.error("IndexedDB object to put in object store: " + e + ", is invalid: " + t);
            if (t[c] = u(t[c]),
            null === t[c])
                return void console.error("IndexedDB object to put in object store: " + e + ", is invalid: " + t);
            var i = l.put(t);
            i.onsuccess = function() {}
            ,
            i.onerror = function(t) {
                console.error(new Error("IndexedDB put object in store:" + e + ", failed with error: " + t.target.errorCode))
            }
        }
        var o, a = !0;
        for (o in t) {
            a = !1;
            break
        }
        if (a)
            return i();
        var r = h.transaction(e, m.READ_WRITE)
          , l = r.objectStore(e)
          , c = d.getKey(e)
          , u = s(e);
        for (o in t)
            n(t[o]);
        r.oncomplete = function() {
            i()
        }
        ,
        r.onabort = function() {
            var e;
            try {
                e = "IndexedDB put transaction aborted with error: " + JSON.stringify(r.error)
            } catch (t) {
                e = "IndexedDB put transaction aborted with exception: " + t
            }
            i(new Error(e))
        }
        ,
        r.onerror = function() {
            i(new Error("IndexedDB put transaction failed with error: " + r.error))
        }
    }
    function c(e, t) {
        var i = {}
          , n = h.transaction(e, m.READ_ONLY)
          , o = n.objectStore(e)
          , s = d.getKey(e)
          , a = o.openCursor();
        a.onsuccess = function(e) {
            var t = e.target.result;
            if (t) {
                var n = t.value;
                n[f] || (i[n[s]] = n),
                t["continue"]()
            }
        }
        ,
        a.onerror = function() {
            console.error(new Error("IndexedDB opening cursor on object store: " + e + ", failed."))
        }
        ,
        n.oncomplete = function() {
            t(null , i)
        }
        ,
        n.onabort = function() {
            t(new Error("IndexedDB requestAll transaction aborted with error: " + n.error))
        }
        ,
        n.onerror = function() {
            t(new Error("IndexedDB requestAll transaction failed with error: " + n.error))
        }
    }
    function u(e, t, i) {
        return h ? h.objectStoreNames.contains(e) ? void l(e, t, i) : void i(new Error("IndexedDB request failed: object store: " + e + " not found in disk cache")) : void i(new Error("IndexedDB request failed: disk cache not yet initialized"))
    }
    i(39);
    var h, d, p = window.indexedDB || window.shimIndexedDB, m = window.IDBTransaction, f = t.DUMMY_RECORD_FLAG = "MISSING_ID";
    t.newDummyRecord = function(e, t) {
        var i = {};
        return i[f] = !0,
        i[e] = t,
        i
    }
    ,
    t.initialize = function(e, t, i) {
        if (!p)
            return i(new Error("This browser doesn't support a stable version of IndexedDB."));
        h && (h.close(),
        h = null ),
        d = t;
        var n = p.open(e);
        n.onupgradeneeded = function(e) {
            var t = e.target.result;
            t.onerror = function(e) {
                console.error(new Error("IndexedDB database error: " + e.target.errorCode))
            }
            ,
            a(t)
        }
        ,
        n.onsuccess = function() {
            h = n.result,
            h.onerror = function(e) {
                console.error(new Error("IndexedDB database error: " + e.target.errorCode))
            }
            ,
            i()
        }
        ,
        n.onerror = function(e) {
            i(new Error("Opening IndexedDB database failed with error: " + e.target.errorCode))
        }
    }
    ,
    t["delete"] = function(e, t) {
        h && h.name === e && (h.close(),
        h = null );
        var i = p.deleteDatabase(e);
        i.onsuccess = function() {
            return t()
        }
        ,
        i.onerror = function() {
            return t(new Error("Could not delete database"))
        }
        ,
        i.onblocked = function() {
            return t(new Error("Could not delete database due to the operation being blocked"))
        }
    }
    ,
    t.request = function(e, t, i) {
        return h ? h.objectStoreNames.contains(e) ? void r(e, t, i) : void i(new Error("IndexedDB request failed: object store: " + e + " not found in disk cache")) : void i(new Error("IndexedDB request failed: disk cache not yet initialized"))
    }
    ,
    t.put = u,
    t.requestAll = function(e, t) {
        if (!h)
            return void t(new Error("IndexedDB request failed: disk cache not yet initialized"));
        var i = d.cacheCompletion;
        return i && h.objectStoreNames.contains(i) ? void r(i, [e], function(i, n) {
            if (i)
                return t(i);
            var o = n[e];
            return o ? h.objectStoreNames.contains(e) ? void c(e, t) : void t(new Error("IndexedDB request failed: object store: " + e + " not found in disk cache")) : t(null , null )
        }) : void t(new Error("IndexedDB isCacheComplete failed: cache completion not initialized"))
    }
    ,
    t.putAll = function(e, t, i) {
        u(e, t, function(t) {
            if (t)
                return i(t);
            var n = d.cacheCompletion;
            if (!n || !h.objectStoreNames.contains(n))
                return void i(new Error("IndexedDB putAll operation called but cache completion is not set up"));
            var o = {
                completedType: {
                    id: e
                }
            };
            u(n, o, function(e) {
                return e ? i(e) : i()
            })
        })
    }
}
, function(module, exports) {
    /*! IndexedDBShim - v0.1.2 - 2014-08-07 */
    "use strict";
    var idbModules = {}
      , cleanInterface = !1;
    !function() {
        var e = {
            test: !0
        };
        if (Object.defineProperty)
            try {
                Object.defineProperty(e, "test", {
                    enumerable: !1
                }),
                e.test && (cleanInterface = !0)
            } catch (t) {}
    }(),
    function(e) {
        function t(e, t, i, n) {
            i.target = t,
            "function" == typeof t[e] && t[e].apply(t, [i]),
            "function" == typeof n && n()
        }
        function i(t, i, n) {
            var o = new DOMException.prototype.constructor(0,i);
            throw o.name = t,
            o.message = i,
            e.DEBUG && (console.log(t, i, n, o),
            console.trace && console.trace()),
            o
        }
        var n = function() {
            this.length = 0,
            this._items = [],
            cleanInterface && Object.defineProperty(this, "_items", {
                enumerable: !1
            })
        };
        if (n.prototype = {
            contains: function(e) {
                return -1 !== this._items.indexOf(e)
            },
            item: function(e) {
                return this._items[e]
            },
            indexOf: function(e) {
                return this._items.indexOf(e)
            },
            push: function(e) {
                this._items.push(e),
                this.length += 1;
                for (var t = 0; this._items.length > t; t++)
                    this[t] = this._items[t]
            },
            splice: function() {
                this._items.splice.apply(this._items, arguments),
                this.length = this._items.length;
                for (var e in this)
                    e === parseInt(e, 10) + "" && delete this[e];
                for (e = 0; this._items.length > e; e++)
                    this[e] = this._items[e]
            }
        },
        cleanInterface)
            for (var o in {
                indexOf: !1,
                push: !1,
                splice: !1
            })
                Object.defineProperty(n.prototype, o, {
                    enumerable: !1
                });
        e.util = {
            throwDOMException: i,
            callback: t,
            quote: function(e) {
                return "'" + e + "'"
            },
            StringList: n
        }
    }(idbModules),
    function(idbModules) {
        var Sca = function() {
            return {
                decycle: function(object, callback) {
                    function checkForCompletion() {
                        0 === queuedObjects.length && returnCallback(derezObj)
                    }
                    function readBlobAsDataURL(e, t) {
                        var i = new FileReader;
                        i.onloadend = function(e) {
                            var i = e.target.result
                              , n = "blob";
                            updateEncodedBlob(i, t, n)
                        }
                        ,
                        i.readAsDataURL(e)
                    }
                    function updateEncodedBlob(dataURL, path, blobtype) {
                        var encoded = queuedObjects.indexOf(path);
                        path = path.replace("$", "derezObj"),
                        eval(path + '.$enc="' + dataURL + '"'),
                        eval(path + '.$type="' + blobtype + '"'),
                        queuedObjects.splice(encoded, 1),
                        checkForCompletion()
                    }
                    function derez(e, t) {
                        var i, n, o;
                        if (!("object" != typeof e || null === e || e instanceof Boolean || e instanceof Date || e instanceof Number || e instanceof RegExp || e instanceof Blob || e instanceof String)) {
                            for (i = 0; objects.length > i; i += 1)
                                if (objects[i] === e)
                                    return {
                                        $ref: paths[i]
                                    };
                            if (objects.push(e),
                            paths.push(t),
                            "[object Array]" === Object.prototype.toString.apply(e))
                                for (o = [],
                                i = 0; e.length > i; i += 1)
                                    o[i] = derez(e[i], t + "[" + i + "]");
                            else {
                                o = {};
                                for (n in e)
                                    Object.prototype.hasOwnProperty.call(e, n) && (o[n] = derez(e[n], t + "[" + JSON.stringify(n) + "]"))
                            }
                            return o
                        }
                        return e instanceof Blob ? (queuedObjects.push(t),
                        readBlobAsDataURL(e, t)) : e instanceof Boolean ? e = {
                            $type: "bool",
                            $enc: "" + e
                        } : e instanceof Date ? e = {
                            $type: "date",
                            $enc: e.getTime()
                        } : e instanceof Number ? e = {
                            $type: "num",
                            $enc: "" + e
                        } : e instanceof RegExp && (e = {
                            $type: "regex",
                            $enc: "" + e
                        }),
                        e
                    }
                    var objects = []
                      , paths = []
                      , queuedObjects = []
                      , returnCallback = callback
                      , derezObj = derez(object, "$");
                    checkForCompletion()
                },
                retrocycle: function retrocycle($) {
                    function dataURLToBlob(e) {
                        var t, i, n, o = ";base64,";
                        if (-1 === e.indexOf(o))
                            return i = e.split(","),
                            t = i[0].split(":")[1],
                            n = i[1],
                            new Blob([n],{
                                type: t
                            });
                        i = e.split(o),
                        t = i[0].split(":")[1],
                        n = window.atob(i[1]);
                        for (var s = n.length, a = new Uint8Array(s), r = 0; s > r; ++r)
                            a[r] = n.charCodeAt(r);
                        return new Blob([a.buffer],{
                            type: t
                        })
                    }
                    function rez(value) {
                        var i, item, name, path;
                        if (value && "object" == typeof value)
                            if ("[object Array]" === Object.prototype.toString.apply(value))
                                for (i = 0; value.length > i; i += 1)
                                    item = value[i],
                                    item && "object" == typeof item && (path = item.$ref,
                                    value[i] = "string" == typeof path && px.test(path) ? eval(path) : rez(item));
                            else if (void 0 !== value.$type)
                                switch (value.$type) {
                                case "blob":
                                case "file":
                                    value = dataURLToBlob(value.$enc);
                                    break;
                                case "bool":
                                    value = Boolean("true" === value.$enc);
                                    break;
                                case "date":
                                    value = new Date(value.$enc);
                                    break;
                                case "num":
                                    value = Number(value.$enc);
                                    break;
                                case "regex":
                                    value = eval(value.$enc)
                                }
                            else
                                for (name in value)
                                    "object" == typeof value[name] && (item = value[name],
                                    item && (path = item.$ref,
                                    value[name] = "string" == typeof path && px.test(path) ? eval(path) : rez(item)));
                        return value
                    }
                    var px = /^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;
                    return rez($),
                    $
                },
                encode: function(e, t) {
                    function i(e) {
                        t(JSON.stringify(e))
                    }
                    this.decycle(e, i)
                },
                decode: function(e) {
                    return this.retrocycle(JSON.parse(e))
                }
            }
        }();
        idbModules.Sca = Sca
    }(idbModules),
    function(e) {
        var t = ["", "number", "string", "boolean", "object", "undefined"]
          , i = function() {
            return {
                encode: function(e) {
                    return t.indexOf(typeof e) + "-" + JSON.stringify(e)
                },
                decode: function(e) {
                    return void 0 === e ? void 0 : JSON.parse(e.substring(2))
                }
            }
        }
          , n = {
            number: i("number"),
            "boolean": i(),
            object: i(),
            string: {
                encode: function(e) {
                    return t.indexOf("string") + "-" + e
                },
                decode: function(e) {
                    return "" + e.substring(2)
                }
            },
            undefined: {
                encode: function() {
                    return t.indexOf("undefined") + "-undefined"
                },
                decode: function() {}
            }
        }
          , o = function() {
            return {
                encode: function(e) {
                    return n[typeof e].encode(e)
                },
                decode: function(e) {
                    return n[t[e.substring(0, 1)]].decode(e)
                }
            }
        }();
        e.Key = o
    }(idbModules),
    function(e) {
        var t = function(e, t) {
            return {
                type: e,
                debug: t,
                bubbles: !1,
                cancelable: !1,
                eventPhase: 0,
                timeStamp: new Date
            }
        };
        e.Event = t
    }(idbModules),
    function(e) {
        var t = function() {
            this.onsuccess = this.onerror = this.result = this.error = this.source = this.transaction = null ,
            this.readyState = "pending"
        }
          , i = function() {
            this.onblocked = this.onupgradeneeded = null
        };
        i.prototype = t,
        e.IDBRequest = t,
        e.IDBOpenRequest = i
    }(idbModules),
    function(e, t) {
        var i = function(e, t, i, n) {
            this.lower = e,
            this.upper = t,
            this.lowerOpen = i,
            this.upperOpen = n
        };
        i.only = function(e) {
            return new i(e,e,(!1),(!1))
        }
        ,
        i.lowerBound = function(e, n) {
            return new i(e,t,n,t)
        }
        ,
        i.upperBound = function(e) {
            return new i(t,e,t,open)
        }
        ,
        i.bound = function(e, t, n, o) {
            return new i(e,t,n,o)
        }
        ,
        e.IDBKeyRange = i
    }(idbModules),
    function(e, t) {
        function i(i, n, o, s, a, r) {
            !i || i instanceof e.IDBKeyRange || (i = new e.IDBKeyRange(i,i,(!1),(!1))),
            this.__range = i,
            this.source = this.__idbObjectStore = o,
            this.__req = s,
            this.key = t,
            this.direction = n,
            this.__keyColumnName = a,
            this.__valueColumnName = r,
            this.__valueDecoder = "value" === r ? e.Sca : e.Key,
            this.source.transaction.__active || e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),
            this.__offset = -1,
            this.__lastKeyContinued = t,
            this["continue"]()
        }
        i.prototype.__find = function(i, n, o, s, a) {
            a = a || 1;
            var r = this
              , l = ["SELECT * FROM ", e.util.quote(r.__idbObjectStore.name)]
              , c = [];
            l.push("WHERE ", r.__keyColumnName, " NOT NULL"),
            r.__range && (r.__range.lower || r.__range.upper) && (l.push("AND"),
            r.__range.lower && (l.push(r.__keyColumnName + (r.__range.lowerOpen ? " >" : " >= ") + " ?"),
            c.push(e.Key.encode(r.__range.lower))),
            r.__range.lower && r.__range.upper && l.push("AND"),
            r.__range.upper && (l.push(r.__keyColumnName + (r.__range.upperOpen ? " < " : " <= ") + " ?"),
            c.push(e.Key.encode(r.__range.upper)))),
            i !== t && (r.__lastKeyContinued = i,
            r.__offset = 0),
            r.__lastKeyContinued !== t && (l.push("AND " + r.__keyColumnName + " >= ?"),
            c.push(e.Key.encode(r.__lastKeyContinued))),
            l.push("ORDER BY ", r.__keyColumnName),
            l.push("LIMIT " + a + " OFFSET " + r.__offset),
            e.DEBUG && console.log(l.join(" "), c),
            r.__prefetchedData = null ,
            n.executeSql(l.join(" "), c, function(i, n) {
                n.rows.length > 1 ? (r.__prefetchedData = n.rows,
                r.__prefetchedIndex = 0,
                e.DEBUG && console.log("Preloaded " + r.__prefetchedData.length + " records for cursor"),
                r.__decode(n.rows.item(0), o)) : 1 === n.rows.length ? r.__decode(n.rows.item(0), o) : (e.DEBUG && console.log("Reached end of cursors"),
                o(t, t))
            }, function(t, i) {
                e.DEBUG && console.log("Could not execute Cursor.continue"),
                s(i)
            })
        }
        ,
        i.prototype.__decode = function(t, i) {
            var n = e.Key.decode(t[this.__keyColumnName])
              , o = this.__valueDecoder.decode(t[this.__valueColumnName])
              , s = e.Key.decode(t.key);
            i(n, o, s)
        }
        ,
        i.prototype["continue"] = function(i) {
            var n = e.cursorPreloadPackSize || 100
              , o = this;
            this.__idbObjectStore.transaction.__addToTransactionQueue(function(e, s, a, r) {
                o.__offset++;
                var l = function(e, i, n) {
                    o.key = e,
                    o.value = i,
                    o.primaryKey = n,
                    a(o.key !== t ? o : t, o.__req)
                };
                return o.__prefetchedData && (o.__prefetchedIndex++,
                o.__prefetchedIndex < o.__prefetchedData.length) ? (o.__decode(o.__prefetchedData.item(o.__prefetchedIndex), l),
                t) : (o.__find(i, e, l, r, n),
                t)
            })
        }
        ,
        i.prototype.advance = function(i) {
            0 >= i && e.util.throwDOMException("Type Error - Count is invalid - 0 or negative", i);
            var n = this;
            this.__idbObjectStore.transaction.__addToTransactionQueue(function(e, o, s, a) {
                n.__offset += i,
                n.__find(t, e, function(e, i) {
                    n.key = e,
                    n.value = i,
                    s(n.key !== t ? n : t, n.__req)
                }, a)
            })
        }
        ,
        i.prototype.update = function(i) {
            var n = this
              , o = this.__idbObjectStore.transaction.__createRequest(function() {});
            return e.Sca.encode(i, function(i) {
                n.__idbObjectStore.transaction.__pushToQueue(o, function(o, s, a, r) {
                    n.__find(t, o, function(t, s, l) {
                        var c = "UPDATE " + e.util.quote(n.__idbObjectStore.name) + " SET value = ? WHERE key = ?";
                        e.DEBUG && console.log(c, i, t, l),
                        o.executeSql(c, [i, e.Key.encode(l)], function(e, i) {
                            n.__prefetchedData = null ,
                            1 === i.rowsAffected ? a(t) : r("No rows with key found" + t)
                        }, function(e, t) {
                            r(t)
                        })
                    }, r)
                })
            }),
            o
        }
        ,
        i.prototype["delete"] = function() {
            var i = this;
            return this.__idbObjectStore.transaction.__addToTransactionQueue(function(n, o, s, a) {
                i.__find(t, n, function(o, r, l) {
                    var c = "DELETE FROM  " + e.util.quote(i.__idbObjectStore.name) + " WHERE key = ?";
                    e.DEBUG && console.log(c, o, l),
                    n.executeSql(c, [e.Key.encode(l)], function(e, n) {
                        i.__prefetchedData = null ,
                        1 === n.rowsAffected ? (i.__offset--,
                        s(t)) : a("No rows with key found" + o)
                    }, function(e, t) {
                        a(t)
                    })
                }, a)
            })
        }
        ,
        e.IDBCursor = i
    }(idbModules),
    function(idbModules, undefined) {
        function IDBIndex(e, t) {
            this.indexName = this.name = e,
            this.__idbObjectStore = this.objectStore = this.source = t;
            var i = t.__storeProps && t.__storeProps.indexList;
            i && (i = JSON.parse(i)),
            this.keyPath = i && i[e] && i[e].keyPath || e,
            ["multiEntry", "unique"].forEach(function(t) {
                this[t] = !!(i && i[e] && i[e].optionalParams && i[e].optionalParams[t])
            }, this)
        }
        IDBIndex.prototype.__createIndex = function(indexName, keyPath, optionalParameters) {
            var me = this
              , transaction = me.__idbObjectStore.transaction;
            transaction.__addToTransactionQueue(function(tx, args, success, failure) {
                me.__idbObjectStore.__getStoreProps(tx, function() {
                    function error() {
                        idbModules.util.throwDOMException(0, "Could not create new index", arguments)
                    }
                    2 !== transaction.mode && idbModules.util.throwDOMException(0, "Invalid State error, not a version transaction", me.transaction);
                    var idxList = JSON.parse(me.__idbObjectStore.__storeProps.indexList);
                    idxList[indexName] !== undefined && idbModules.util.throwDOMException(0, "Index already exists on store", idxList);
                    var columnName = indexName;
                    idxList[indexName] = {
                        columnName: columnName,
                        keyPath: keyPath,
                        optionalParams: optionalParameters
                    },
                    me.__idbObjectStore.__storeProps.indexList = JSON.stringify(idxList);
                    var sql = ["ALTER TABLE", idbModules.util.quote(me.__idbObjectStore.name), "ADD", columnName, "BLOB"].join(" ");
                    idbModules.DEBUG && console.log(sql),
                    tx.executeSql(sql, [], function(tx, data) {
                        tx.executeSql("SELECT * FROM " + idbModules.util.quote(me.__idbObjectStore.name), [], function(tx, data) {
                            !function initIndexForRow(i) {
                                if (data.rows.length > i)
                                    try {
                                        var value = idbModules.Sca.decode(data.rows.item(i).value)
                                          , indexKey = eval("value['" + keyPath + "']");
                                        tx.executeSql("UPDATE " + idbModules.util.quote(me.__idbObjectStore.name) + " set " + columnName + " = ? where key = ?", [idbModules.Key.encode(indexKey), data.rows.item(i).key], function() {
                                            initIndexForRow(i + 1)
                                        }, error)
                                    } catch (e) {
                                        initIndexForRow(i + 1)
                                    }
                                else
                                    idbModules.DEBUG && console.log("Updating the indexes in table", me.__idbObjectStore.__storeProps),
                                    tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?", [me.__idbObjectStore.__storeProps.indexList, me.__idbObjectStore.name], function() {
                                        me.__idbObjectStore.__setReadyState("createIndex", !0),
                                        success(me)
                                    }, error)
                            }(0)
                        }, error)
                    }, error)
                }, "createObjectStore")
            })
        }
        ,
        IDBIndex.prototype.openCursor = function(e, t) {
            var i = new idbModules.IDBRequest;
            return new idbModules.IDBCursor(e,t,this.source,i,this.indexName,"value"),
            i
        }
        ,
        IDBIndex.prototype.openKeyCursor = function(e, t) {
            var i = new idbModules.IDBRequest;
            return new idbModules.IDBCursor(e,t,this.source,i,this.indexName,"key"),
            i
        }
        ,
        IDBIndex.prototype.__fetchIndexData = function(e, t) {
            var i = this;
            return i.__idbObjectStore.transaction.__addToTransactionQueue(function(n, o, s, a) {
                var r = ["SELECT * FROM ", idbModules.util.quote(i.__idbObjectStore.name), " WHERE", i.indexName, "NOT NULL"]
                  , l = [];
                e !== undefined && (r.push("AND", i.indexName, " = ?"),
                l.push(idbModules.Key.encode(e))),
                idbModules.DEBUG && console.log("Trying to fetch data for Index", r.join(" "), l),
                n.executeSql(r.join(" "), l, function(e, i) {
                    var n;
                    n = "count" === t ? i.rows.length : 0 === i.rows.length ? undefined : "key" === t ? idbModules.Key.decode(i.rows.item(0).key) : idbModules.Sca.decode(i.rows.item(0).value),
                    s(n)
                }, a)
            })
        }
        ,
        IDBIndex.prototype.get = function(e) {
            return this.__fetchIndexData(e, "value")
        }
        ,
        IDBIndex.prototype.getKey = function(e) {
            return this.__fetchIndexData(e, "key")
        }
        ,
        IDBIndex.prototype.count = function(e) {
            return this.__fetchIndexData(e, "count")
        }
        ,
        idbModules.IDBIndex = IDBIndex
    }(idbModules),
    function(idbModules) {
        var IDBObjectStore = function(e, t, i) {
            this.name = e,
            this.transaction = t,
            this.__ready = {},
            this.__setReadyState("createObjectStore", void 0 === i || i),
            this.indexNames = new idbModules.util.StringList
        };
        IDBObjectStore.prototype.__setReadyState = function(e, t) {
            this.__ready[e] = t
        }
        ,
        IDBObjectStore.prototype.__waitForReady = function(e, t) {
            var i = !0;
            if (void 0 !== t)
                i = void 0 === this.__ready[t] || this.__ready[t];
            else
                for (var n in this.__ready)
                    this.__ready[n] || (i = !1);
            if (i)
                e();
            else {
                idbModules.DEBUG && console.log("Waiting for to be ready", t);
                var o = this;
                window.setTimeout(function() {
                    o.__waitForReady(e, t)
                }, 100)
            }
        }
        ,
        IDBObjectStore.prototype.__getStoreProps = function(e, t, i) {
            var n = this;
            this.__waitForReady(function() {
                n.__storeProps ? (idbModules.DEBUG && console.log("Store properties - cached", n.__storeProps),
                t(n.__storeProps)) : e.executeSql("SELECT * FROM __sys__ where name = ?", [n.name], function(e, i) {
                    1 !== i.rows.length ? t() : (n.__storeProps = {
                        name: i.rows.item(0).name,
                        indexList: i.rows.item(0).indexList,
                        autoInc: i.rows.item(0).autoInc,
                        keyPath: i.rows.item(0).keyPath
                    },
                    idbModules.DEBUG && console.log("Store properties", n.__storeProps),
                    t(n.__storeProps))
                }, function() {
                    t()
                })
            }, i)
        }
        ,
        IDBObjectStore.prototype.__deriveKey = function(tx, value, key, callback) {
            function getNextAutoIncKey() {
                tx.executeSql("SELECT * FROM sqlite_sequence where name like ?", [me.name], function(e, t) {
                    callback(1 !== t.rows.length ? 0 : t.rows.item(0).seq)
                }, function(e, t) {
                    idbModules.util.throwDOMException(0, "Data Error - Could not get the auto increment value for key", t)
                })
            }
            var me = this;
            me.__getStoreProps(tx, function(props) {
                if (props || idbModules.util.throwDOMException(0, "Data Error - Could not locate defination for this table", props),
                props.keyPath)
                    if (void 0 !== key && idbModules.util.throwDOMException(0, "Data Error - The object store uses in-line keys and the key parameter was provided", props),
                    value)
                        try {
                            var primaryKey = eval("value['" + props.keyPath + "']");
                            void 0 === primaryKey ? "true" === props.autoInc ? getNextAutoIncKey() : idbModules.util.throwDOMException(0, "Data Error - Could not eval key from keyPath") : callback(primaryKey)
                        } catch (e) {
                            idbModules.util.throwDOMException(0, "Data Error - Could not eval key from keyPath", e)
                        }
                    else
                        idbModules.util.throwDOMException(0, "Data Error - KeyPath was specified, but value was not");
                else
                    void 0 !== key ? callback(key) : "false" === props.autoInc ? idbModules.util.throwDOMException(0, "Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ", props) : getNextAutoIncKey()
            })
        }
        ,
        IDBObjectStore.prototype.__insertData = function(tx, encoded, value, primaryKey, success, error) {
            var paramMap = {};
            void 0 !== primaryKey && (paramMap.key = idbModules.Key.encode(primaryKey));
            var indexes = JSON.parse(this.__storeProps.indexList);
            for (var key in indexes)
                try {
                    paramMap[indexes[key].columnName] = idbModules.Key.encode(eval("value['" + indexes[key].keyPath + "']"))
                } catch (e) {
                    error(e)
                }
            var sqlStart = ["INSERT INTO ", idbModules.util.quote(this.name), "("]
              , sqlEnd = [" VALUES ("]
              , sqlValues = [];
            for (key in paramMap)
                sqlStart.push(key + ","),
                sqlEnd.push("?,"),
                sqlValues.push(paramMap[key]);
            sqlStart.push("value )"),
            sqlEnd.push("?)"),
            sqlValues.push(encoded);
            var sql = sqlStart.join(" ") + sqlEnd.join(" ");
            idbModules.DEBUG && console.log("SQL for adding", sql, sqlValues),
            tx.executeSql(sql, sqlValues, function() {
                success(primaryKey)
            }, function(e, t) {
                error(t)
            })
        }
        ,
        IDBObjectStore.prototype.add = function(e, t) {
            var i = this
              , n = i.transaction.__createRequest(function() {});
            return idbModules.Sca.encode(e, function(o) {
                i.transaction.__pushToQueue(n, function(n, s, a, r) {
                    i.__deriveKey(n, e, t, function(t) {
                        i.__insertData(n, o, e, t, a, r)
                    })
                })
            }),
            n
        }
        ,
        IDBObjectStore.prototype.put = function(e, t) {
            var i = this
              , n = i.transaction.__createRequest(function() {});
            return idbModules.Sca.encode(e, function(o) {
                i.transaction.__pushToQueue(n, function(n, s, a, r) {
                    i.__deriveKey(n, e, t, function(t) {
                        var s = "DELETE FROM " + idbModules.util.quote(i.name) + " where key = ?";
                        n.executeSql(s, [idbModules.Key.encode(t)], function(n, s) {
                            idbModules.DEBUG && console.log("Did the row with the", t, "exist? ", s.rowsAffected),
                            i.__insertData(n, o, e, t, a, r)
                        }, function(e, t) {
                            r(t)
                        })
                    })
                })
            }),
            n
        }
        ,
        IDBObjectStore.prototype.get = function(e) {
            var t = this;
            return t.transaction.__addToTransactionQueue(function(i, n, o, s) {
                t.__waitForReady(function() {
                    var n = idbModules.Key.encode(e);
                    idbModules.DEBUG && console.log("Fetching", t.name, n),
                    i.executeSql("SELECT * FROM " + idbModules.util.quote(t.name) + " where key = ?", [n], function(e, t) {
                        idbModules.DEBUG && console.log("Fetched data", t);
                        try {
                            if (0 === t.rows.length)
                                return o();
                            o(idbModules.Sca.decode(t.rows.item(0).value))
                        } catch (i) {
                            idbModules.DEBUG && console.log(i),
                            o(void 0)
                        }
                    }, function(e, t) {
                        s(t)
                    })
                })
            })
        }
        ,
        IDBObjectStore.prototype["delete"] = function(e) {
            var t = this;
            return t.transaction.__addToTransactionQueue(function(i, n, o, s) {
                t.__waitForReady(function() {
                    var n = idbModules.Key.encode(e);
                    idbModules.DEBUG && console.log("Fetching", t.name, n),
                    i.executeSql("DELETE FROM " + idbModules.util.quote(t.name) + " where key = ?", [n], function(e, t) {
                        idbModules.DEBUG && console.log("Deleted from database", t.rowsAffected),
                        o()
                    }, function(e, t) {
                        s(t)
                    })
                })
            })
        }
        ,
        IDBObjectStore.prototype.clear = function() {
            var e = this;
            return e.transaction.__addToTransactionQueue(function(t, i, n, o) {
                e.__waitForReady(function() {
                    t.executeSql("DELETE FROM " + idbModules.util.quote(e.name), [], function(e, t) {
                        idbModules.DEBUG && console.log("Cleared all records from database", t.rowsAffected),
                        n()
                    }, function(e, t) {
                        o(t)
                    })
                })
            })
        }
        ,
        IDBObjectStore.prototype.count = function(e) {
            var t = this;
            return t.transaction.__addToTransactionQueue(function(i, n, o, s) {
                t.__waitForReady(function() {
                    var n = "SELECT * FROM " + idbModules.util.quote(t.name) + (void 0 !== e ? " WHERE key = ?" : "")
                      , a = [];
                    void 0 !== e && a.push(idbModules.Key.encode(e)),
                    i.executeSql(n, a, function(e, t) {
                        o(t.rows.length)
                    }, function(e, t) {
                        s(t)
                    })
                })
            })
        }
        ,
        IDBObjectStore.prototype.openCursor = function(e, t) {
            var i = new idbModules.IDBRequest;
            return new idbModules.IDBCursor(e,t,this,i,"key","value"),
            i
        }
        ,
        IDBObjectStore.prototype.index = function(e) {
            var t = new idbModules.IDBIndex(e,this);
            return t
        }
        ,
        IDBObjectStore.prototype.createIndex = function(e, t, i) {
            var n = this;
            i = i || {},
            n.__setReadyState("createIndex", !1);
            var o = new idbModules.IDBIndex(e,n);
            return n.__waitForReady(function() {
                o.__createIndex(e, t, i)
            }, "createObjectStore"),
            n.indexNames.push(e),
            o
        }
        ,
        IDBObjectStore.prototype.deleteIndex = function(e) {
            var t = new idbModules.IDBIndex(e,this,(!1));
            return t.__deleteIndex(e),
            t
        }
        ,
        idbModules.IDBObjectStore = IDBObjectStore
    }(idbModules),
    function(e) {
        var t = 0
          , i = 1
          , n = 2
          , o = function(n, o, s) {
            if ("number" == typeof o)
                this.mode = o,
                2 !== o && e.DEBUG && console.log("Mode should be a string, but was specified as ", o);
            else if ("string" == typeof o)
                switch (o) {
                case "readwrite":
                    this.mode = i;
                    break;
                case "readonly":
                    this.mode = t;
                    break;
                default:
                    this.mode = t
                }
            this.storeNames = "string" == typeof n ? [n] : n;
            for (var a = 0; this.storeNames.length > a; a++)
                s.objectStoreNames.contains(this.storeNames[a]) || e.util.throwDOMException(0, "The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.", this.storeNames[a]);
            this.__active = !0,
            this.__running = !1,
            this.__requests = [],
            this.__aborted = !1,
            this.db = s,
            this.error = null ,
            this.onabort = this.onerror = this.oncomplete = null
        };
        o.prototype.__executeRequests = function() {
            if (this.__running && this.mode !== n)
                return void (e.DEBUG && console.log("Looks like the request set is already running", this.mode));
            this.__running = !0;
            var t = this;
            window.setTimeout(function() {
                2 === t.mode || t.__active || e.util.throwDOMException(0, "A request was placed against a transaction which is currently not active, or which is finished", t.__active),
                t.db.__db.transaction(function(i) {
                    function n(t, i) {
                        i && (a.req = i),
                        a.req.readyState = "done",
                        a.req.result = t,
                        delete a.req.error;
                        var n = e.Event("success");
                        e.util.callback("onsuccess", a.req, n),
                        r++,
                        s()
                    }
                    function o() {
                        a.req.readyState = "done",
                        a.req.error = "DOMError";
                        var t = e.Event("error", arguments);
                        e.util.callback("onerror", a.req, t),
                        r++,
                        s()
                    }
                    function s() {
                        return r >= t.__requests.length ? (t.__active = !1,
                        void (t.__requests = [])) : (a = t.__requests[r],
                        void a.op(i, a.args, n, o))
                    }
                    t.__tx = i;
                    var a = null
                      , r = 0;
                    try {
                        s()
                    } catch (l) {
                        e.DEBUG && console.log("An exception occured in transaction", arguments),
                        "function" == typeof t.onerror && t.onerror()
                    }
                }, function() {
                    e.DEBUG && console.log("An error in transaction", arguments),
                    "function" == typeof t.onerror && t.onerror()
                }, function() {
                    e.DEBUG && console.log("Transaction completed", arguments),
                    "function" == typeof t.oncomplete && t.oncomplete()
                })
            }, 1)
        }
        ,
        o.prototype.__addToTransactionQueue = function(t, i) {
            this.__active || this.mode === n || e.util.throwDOMException(0, "A request was placed against a transaction which is currently not active, or which is finished.", this.__mode);
            var o = this.__createRequest();
            return this.__pushToQueue(o, t, i),
            o
        }
        ,
        o.prototype.__createRequest = function() {
            var t = new e.IDBRequest;
            return t.source = this.db,
            t.transaction = this,
            t
        }
        ,
        o.prototype.__pushToQueue = function(e, t, i) {
            this.__requests.push({
                op: t,
                args: i,
                req: e
            }),
            this.__executeRequests()
        }
        ,
        o.prototype.objectStore = function(t) {
            return new e.IDBObjectStore(t,this)
        }
        ,
        o.prototype.abort = function() {
            !this.__active && e.util.throwDOMException(0, "A request was placed against a transaction which is currently not active, or which is finished", this.__active)
        }
        ,
        o.prototype.READ_ONLY = 0,
        o.prototype.READ_WRITE = 1,
        o.prototype.VERSION_CHANGE = 2,
        e.IDBTransaction = o
    }(idbModules),
    function(e) {
        var t = function(t, i, n, o) {
            this.__db = t,
            this.version = n,
            this.__storeProperties = o,
            this.objectStoreNames = new e.util.StringList;
            for (var s = 0; o.rows.length > s; s++)
                this.objectStoreNames.push(o.rows.item(s).name);
            this.name = i,
            this.onabort = this.onerror = this.onversionchange = null
        };
        t.prototype.createObjectStore = function(t, i) {
            var n = this;
            i = i || {},
            i.keyPath = i.keyPath || null ;
            var o = new e.IDBObjectStore(t,n.__versionTransaction,(!1))
              , s = n.__versionTransaction;
            return s.__addToTransactionQueue(function(s, a, r) {
                function l() {
                    e.util.throwDOMException(0, "Could not create new object store", arguments)
                }
                n.__versionTransaction || e.util.throwDOMException(0, "Invalid State error", n.transaction);
                var c = ["CREATE TABLE", e.util.quote(t), "(key BLOB", i.autoIncrement ? ", inc INTEGER PRIMARY KEY AUTOINCREMENT" : "PRIMARY KEY", ", value BLOB)"].join(" ");
                e.DEBUG && console.log(c),
                s.executeSql(c, [], function(e) {
                    e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)", [t, i.keyPath, !!i.autoIncrement, "{}"], function() {
                        o.__setReadyState("createObjectStore", !0),
                        r(o)
                    }, l)
                }, l)
            }),
            n.objectStoreNames.push(t),
            o
        }
        ,
        t.prototype.deleteObjectStore = function(t) {
            var i = function() {
                e.util.throwDOMException(0, "Could not delete ObjectStore", arguments)
            }
              , n = this;
            !n.objectStoreNames.contains(t) && i("Object Store does not exist"),
            n.objectStoreNames.splice(n.objectStoreNames.indexOf(t), 1);
            var o = n.__versionTransaction;
            o.__addToTransactionQueue(function() {
                n.__versionTransaction || e.util.throwDOMException(0, "Invalid State error", n.transaction),
                n.__db.transaction(function(n) {
                    n.executeSql("SELECT * FROM __sys__ where name = ?", [t], function(n, o) {
                        o.rows.length > 0 && n.executeSql("DROP TABLE " + e.util.quote(t), [], function() {
                            n.executeSql("DELETE FROM __sys__ WHERE name = ?", [t], function() {}, i)
                        }, i)
                    })
                })
            })
        }
        ,
        t.prototype.close = function() {}
        ,
        t.prototype.transaction = function(t, i) {
            var n = new e.IDBTransaction(t,i || 1,this);
            return n
        }
        ,
        e.IDBDatabase = t
    }(idbModules),
    function(e) {
        var t = 4194304;
        if (window.openDatabase) {
            var i = window.openDatabase("__sysdb__", 1, "System Database", t);
            i.transaction(function(e) {
                e.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);", [])
            }, function() {
                e.DEBUG && console.log("Error in sysdb transaction - when creating dbVersions", arguments)
            });
            var n = {
                open: function(n, o) {
                    function s() {
                        if (!l) {
                            var t = e.Event("error", arguments);
                            r.readyState = "done",
                            r.error = "DOMError",
                            e.util.callback("onerror", r, t),
                            l = !0
                        }
                    }
                    function a(a) {
                        var l = window.openDatabase(n, 1, n, t);
                        r.readyState = "done",
                        void 0 === o && (o = a || 1),
                        (0 >= o || a > o) && e.util.throwDOMException(0, "An attempt was made to open a database using a lower version than the existing version.", o),
                        l.transaction(function(t) {
                            t.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)", [], function() {
                                t.executeSql("SELECT * FROM __sys__", [], function(t, c) {
                                    var u = e.Event("success");
                                    r.source = r.result = new e.IDBDatabase(l,n,o,c),
                                    o > a ? i.transaction(function(t) {
                                        t.executeSql("UPDATE dbVersions set version = ? where name = ?", [o, n], function() {
                                            var t = e.Event("upgradeneeded");
                                            t.oldVersion = a,
                                            t.newVersion = o,
                                            r.transaction = r.result.__versionTransaction = new e.IDBTransaction([],2,r.source),
                                            e.util.callback("onupgradeneeded", r, t, function() {
                                                var t = e.Event("success");
                                                e.util.callback("onsuccess", r, t)
                                            })
                                        }, s)
                                    }, s) : e.util.callback("onsuccess", r, u)
                                }, s)
                            }, s)
                        }, s)
                    }
                    var r = new e.IDBOpenRequest
                      , l = !1;
                    return i.transaction(function(e) {
                        e.executeSql("SELECT * FROM dbVersions where name = ?", [n], function(e, t) {
                            0 === t.rows.length ? e.executeSql("INSERT INTO dbVersions VALUES (?,?)", [n, o || 1], function() {
                                a(0)
                            }, s) : a(t.rows.item(0).version)
                        }, s)
                    }, s),
                    r
                },
                deleteDatabase: function(n) {
                    function o(t) {
                        if (!r) {
                            a.readyState = "done",
                            a.error = "DOMError";
                            var i = e.Event("error");
                            i.message = t,
                            i.debug = arguments,
                            e.util.callback("onerror", a, i),
                            r = !0
                        }
                    }
                    function s() {
                        i.transaction(function(t) {
                            t.executeSql("DELETE FROM dbVersions where name = ? ", [n], function() {
                                a.result = void 0;
                                var t = e.Event("success");
                                t.newVersion = null ,
                                t.oldVersion = l,
                                e.util.callback("onsuccess", a, t)
                            }, o)
                        }, o)
                    }
                    var a = new e.IDBOpenRequest
                      , r = !1
                      , l = null ;
                    return i.transaction(function(i) {
                        i.executeSql("SELECT * FROM dbVersions where name = ?", [n], function(i, r) {
                            if (0 === r.rows.length) {
                                a.result = void 0;
                                var c = e.Event("success");
                                return c.newVersion = null ,
                                c.oldVersion = l,
                                void e.util.callback("onsuccess", a, c)
                            }
                            l = r.rows.item(0).version;
                            var u = window.openDatabase(n, 1, n, t);
                            u.transaction(function(t) {
                                t.executeSql("SELECT * FROM __sys__", [], function(t, i) {
                                    var n = i.rows;
                                    !function a(i) {
                                        i >= n.length ? t.executeSql("DROP TABLE __sys__", [], function() {
                                            s()
                                        }, o) : t.executeSql("DROP TABLE " + e.util.quote(n.item(i).name), [], function() {
                                            a(i + 1)
                                        }, function() {
                                            a(i + 1)
                                        })
                                    }(0)
                                }, function() {
                                    s()
                                })
                            }, o)
                        })
                    }, o),
                    a
                },
                cmp: function(t, i) {
                    return e.Key.encode(t) > e.Key.encode(i) ? 1 : t === i ? 0 : -1
                }
            };
            e.shimIndexedDB = n
        }
    }(idbModules),
    function(e, t) {
        void 0 !== e.openDatabase && (e.shimIndexedDB = t.shimIndexedDB,
        e.shimIndexedDB && (e.shimIndexedDB.__useShim = function() {
            e.indexedDB = t.shimIndexedDB,
            e.IDBDatabase = t.IDBDatabase,
            e.IDBTransaction = t.IDBTransaction,
            e.IDBCursor = t.IDBCursor,
            e.IDBKeyRange = t.IDBKeyRange,
            e.indexedDB !== t.shimIndexedDB && Object.defineProperty && Object.defineProperty(e, "indexedDB", {
                value: t.shimIndexedDB
            })
        }
        ,
        e.shimIndexedDB.__debug = function(e) {
            t.DEBUG = e
        }
        )),
        "indexedDB"in e || (e.indexedDB = e.indexedDB || e.webkitIndexedDB || e.mozIndexedDB || e.oIndexedDB || e.msIndexedDB);
        var i = !1;
        if ((navigator.userAgent.match(/Android 2/) || navigator.userAgent.match(/Android 3/) || navigator.userAgent.match(/Android 4\.[0-3]/)) && (navigator.userAgent.match(/Chrome/) || (i = !0)),
        void 0 !== e.indexedDB && !i || void 0 === e.openDatabase) {
            e.IDBDatabase = e.IDBDatabase || e.webkitIDBDatabase,
            e.IDBTransaction = e.IDBTransaction || e.webkitIDBTransaction,
            e.IDBCursor = e.IDBCursor || e.webkitIDBCursor,
            e.IDBKeyRange = e.IDBKeyRange || e.webkitIDBKeyRange,
            e.IDBTransaction || (e.IDBTransaction = {});
            try {
                e.IDBTransaction.READ_ONLY = e.IDBTransaction.READ_ONLY || "readonly",
                e.IDBTransaction.READ_WRITE = e.IDBTransaction.READ_WRITE || "readwrite"
            } catch (n) {}
        } else
            e.shimIndexedDB.__useShim()
    }(window, idbModules)
}
, function(e, t, i) {
    var n = i(41)
      , o = i(44);
    e.exports = function(e, t, i, s, a) {
        if (!e)
            return a(new Error("staticContent is not initialized. Cannot perform request: " + t));
        var r = o.operation({
            retries: 4,
            randomize: !0
        });
        i = i || {};
        var l = new XMLHttpRequest;
        l.onreadystatechange = function() {
            if (4 === ~~l.readyState) {
                var e;
                if (200 !== ~~l.status && (e = "staticContent xhrError: " + l.status),
                r.retry(e))
                    return console.warn("staticContent.request failed code ", l.status + ", will retry...");
                if (e)
                    return a(r.mainError());
                var t;
                try {
                    t = JSON.parse(l.response)
                } catch (i) {
                    return a(i)
                }
                a(null , t)
            }
        }
        ;
        var c = {
            lang: i.lang || s,
            v: window.Config.buildVersion
        }
          , u = e + t + "?" + n.stringify(c);
        r.attempt(function() {
            l.open("POST", u, !0),
            l.setRequestHeader("Content-type", "application/json"),
            l.send(JSON.stringify(i))
        })
    }
}
, function(e, t, i) {
    "use strict";
    t.decode = t.parse = i(42),
    t.encode = t.stringify = i(43)
}
, function(e, t) {
    "use strict";
    function i(e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
    }
    e.exports = function(e, t, n, o) {
        t = t || "&",
        n = n || "=";
        var s = {};
        if ("string" != typeof e || 0 === e.length)
            return s;
        var a = /\+/g;
        e = e.split(t);
        var r = 1e3;
        o && "number" == typeof o.maxKeys && (r = o.maxKeys);
        var l = e.length;
        r > 0 && l > r && (l = r);
        for (var c = 0; c < l; ++c) {
            var u, h, d, p, m = e[c].replace(a, "%20"), f = m.indexOf(n);
            f >= 0 ? (u = m.substr(0, f),
            h = m.substr(f + 1)) : (u = m,
            h = ""),
            d = decodeURIComponent(u),
            p = decodeURIComponent(h),
            i(s, d) ? Array.isArray(s[d]) ? s[d].push(p) : s[d] = [s[d], p] : s[d] = p
        }
        return s
    }
}
, function(e, t) {
    "use strict";
    var i = function(e) {
        switch (typeof e) {
        case "string":
            return e;
        case "boolean":
            return e ? "true" : "false";
        case "number":
            return isFinite(e) ? e : "";
        default:
            return ""
        }
    };
    e.exports = function(e, t, n, o) {
        return t = t || "&",
        n = n || "=",
        null === e && (e = void 0),
        "object" == typeof e ? Object.keys(e).map(function(o) {
            var s = encodeURIComponent(i(o)) + n;
            return Array.isArray(e[o]) ? e[o].map(function(e) {
                return s + encodeURIComponent(i(e))
            }).join(t) : s + encodeURIComponent(i(e[o]))
        }).join(t) : o ? encodeURIComponent(i(o)) + n + encodeURIComponent(i(e)) : ""
    }
}
, function(e, t, i) {
    e.exports = i(45)
}
, function(e, t, i) {
    var n = i(46);
    t.operation = function(e) {
        var i = t.timeouts(e);
        return new n(i,{
            forever: e && e.forever,
            unref: e && e.unref
        })
    }
    ,
    t.timeouts = function(e) {
        if (e instanceof Array)
            return [].concat(e);
        var t = {
            retries: 10,
            factor: 2,
            minTimeout: 1e3,
            maxTimeout: 1 / 0,
            randomize: !1
        };
        for (var i in e)
            t[i] = e[i];
        if (t.minTimeout > t.maxTimeout)
            throw new Error("minTimeout is greater than maxTimeout");
        for (var n = [], o = 0; o < t.retries; o++)
            n.push(this.createTimeout(o, t));
        return n.sort(function(e, t) {
            return e - t
        }),
        n
    }
    ,
    t.createTimeout = function(e, t) {
        var i = t.randomize ? Math.random() + 1 : 1
          , n = Math.round(i * t.minTimeout * Math.pow(t.factor, e));
        return n = Math.min(n, t.maxTimeout)
    }
    ,
    t.wrap = function(e, i, n) {
        if (i instanceof Array && (n = i,
        i = null ),
        !n) {
            n = [];
            for (var o in e)
                "function" == typeof e[o] && n.push(o)
        }
        for (var s = 0; s < n.length; s++) {
            var a = n[s]
              , r = e[a];
            e[a] = function() {
                var n = t.operation(i)
                  , o = Array.prototype.slice.call(arguments)
                  , s = o.pop();
                o.push(function(e) {
                    n.retry(e) || (e && (arguments[0] = n.mainError()),
                    s.apply(this, arguments))
                }),
                n.attempt(function() {
                    r.apply(e, o)
                })
            }
            ,
            e[a].options = i
        }
    }
}
, function(e, t) {
    function i(e, t) {
        "boolean" == typeof t && (t = {
            forever: t
        }),
        this._timeouts = e,
        this._options = t || {},
        this._fn = null ,
        this._errors = [],
        this._attempts = 1,
        this._operationTimeout = null ,
        this._operationTimeoutCb = null ,
        this._timeout = null ,
        this._options.forever && (this._cachedTimeouts = this._timeouts.slice(0))
    }
    e.exports = i,
    i.prototype.retry = function(e) {
        if (this._timeout && clearTimeout(this._timeout),
        !e)
            return !1;
        this._errors.push(e);
        var t = this._timeouts.shift();
        if (void 0 === t) {
            if (!this._cachedTimeouts)
                return !1;
            this._errors.splice(this._errors.length - 1, this._errors.length),
            this._timeouts = this._cachedTimeouts.slice(0),
            t = this._timeouts.shift()
        }
        var i = this
          , n = setTimeout(function() {
            i._attempts++,
            i._operationTimeoutCb && (i._timeout = setTimeout(function() {
                i._operationTimeoutCb(i._attempts)
            }, i._operationTimeout),
            this._options.unref && i._timeout.unref()),
            i._fn(i._attempts)
        }, t);
        return this._options.unref && n.unref(),
        !0
    }
    ,
    i.prototype.attempt = function(e, t) {
        this._fn = e,
        t && (t.timeout && (this._operationTimeout = t.timeout),
        t.cb && (this._operationTimeoutCb = t.cb));
        var i = this;
        this._operationTimeoutCb && (this._timeout = setTimeout(function() {
            i._operationTimeoutCb()
        }, i._operationTimeout)),
        this._fn(this._attempts)
    }
    ,
    i.prototype["try"] = function(e) {
        console.log("Using RetryOperation.try() is deprecated"),
        this.attempt(e)
    }
    ,
    i.prototype.start = function(e) {
        console.log("Using RetryOperation.start() is deprecated"),
        this.attempt(e)
    }
    ,
    i.prototype.start = i.prototype["try"],
    i.prototype.errors = function() {
        return this._errors
    }
    ,
    i.prototype.attempts = function() {
        return this._attempts
    }
    ,
    i.prototype.mainError = function() {
        if (0 === this._errors.length)
            return null ;
        for (var e = {}, t = null , i = 0, n = 0; n < this._errors.length; n++) {
            var o = this._errors[n]
              , s = o.message
              , a = (e[s] || 0) + 1;
            e[s] = a,
            a >= i && (t = o,
            i = a)
        }
        return t
    }
}
, function(e, t, i) {
    var n, o, s = i(33), a = s.events, r = s.getPosition, l = i(16).EventEmitter, c = e.exports = new l;
    document.body.addEventListener(a.start, function() {
        o || (o = !0,
        n = null )
    }, !0),
    document.body.addEventListener(a.start, function() {
        n && c.emit("handleTaken", n)
    }, !1),
    document.body.addEventListener(a.end, function(e) {
        0 === r(e).touchCount && (n = null ,
        o = !1)
    }),
    c.isHandleFree = function() {
        return null === n
    }
    ,
    c.hasHandle = function(e) {
        return n === e
    }
    ,
    c.requestInteractionHandle = function(e) {
        return n ? n === e : (n = e,
        c.emit("handleTaken", n),
        !0)
    }
    ,
    c.abortInteraction = function() {
        n = null
    }
}
, function(e, t, i) {
    function n(e, t) {
        var i = Math.abs(e);
        return i > 10 && i / t > .65
    }
    function o(e, t) {
        function i(e) {
            h = "vertical" === e ? "y" : "x"
        }
        function o(e) {
            y = s(e),
            y.x -= g.left,
            y.y -= g.top
        }
        function l(t) {
            if (o(t),
            m) {
                if (1 !== y.touchCount)
                    return;
                return e.emit("slide", y),
                e.slideOut = y.x < 0 || y.x > g.width || y.y < 0 || y.y > g.height,
                void (e.slideOut ? _ || (_ = !0,
                e.emit("slideOut", y)) : (e.emit("slideIn", y),
                _ = !1))
            }
            var i = y.x - d.x
              , n = y.y - d.y
              , s = Math.sqrt(i * i + n * n);
            if (!(s < r))
                return Math.abs(n) > Math.abs(i) ? void (h && "y" !== h || !a(e) ? e.cancelSlide() : (m = !0,
                e.isSliding = !0,
                e.emit("slideStart", y, g))) : void (h && "x" !== h || !a(e) ? e.cancelSlide() : (m = !0,
                e.isSliding = !0,
                e.emit("slideStart", y, g)))
        }
        function c(t) {
            if (o(t),
            !(y.touchCount > 0)) {
                if (m) {
                    e.isSliding = !1;
                    var i, s = Date.now() - f;
                    i = h ? n(y[h] - d[h], s) : n(y.x - d.x, s) && "x" || n(y.y - d.y, s) && "y",
                    e.emit("slideEnd", y, d, i)
                }
                p = m = !1,
                window.gui.wBody.removeListener("dom.touchmove", l),
                window.gui.wBody.removeListener("dom.touchend", c),
                window.gui.wBody.removeListener("dom.touchcancel", u)
            }
        }
        function u() {
            e.isSliding = !1,
            m && e.emit("slideCancel", y, d, !1),
            p = m = !1,
            window.gui.wBody.removeListener("dom.touchmove", l),
            window.gui.wBody.removeListener("dom.touchend", c),
            window.gui.wBody.removeListener("dom.touchcancel", u)
        }
        if (!e._slideBehavior) {
            e._slideBehavior = !0,
            e.allowDomEvents();
            var h, d, p, m, f, g, _, v = !1, y = {};
            t && i(t),
            e.setSlideDirection = i,
            e.isSliding = !1,
            e.slideOut = !1,
            e.lockSlide = function(e) {
                v = e
            }
            ,
            e.cancelSlide = u,
            e.on("dom.touchstart", function(t) {
                p || v || (g = e.rootElement.getBoundingClientRect(),
                o(t),
                f = Date.now(),
                e.slideOut = !1,
                p = !0,
                d = {
                    x: y.x,
                    y: y.y
                },
                window.gui.wBody.on("dom.touchmove", l),
                window.gui.wBody.on("dom.touchend", c),
                window.gui.wBody.on("dom.touchcancel", u))
            })
        }
    }
    var s = i(33).getPosition
      , a = i(47).requestInteractionHandle
      , r = 5;
    e.exports = o
}
, function(e, t, i) {
    function n(e) {
        if (0 !== e.length) {
            var i = e.shift();
            setTimeout(function() {
                n(e),
                t.emit(i._messageType, i)
            }, 0)
        }
    }
    var o = i(16).EventEmitter;
    t = e.exports = new o,
    t.setMaxListeners(0);
    var s, a, r, l, c, u = [], h = 0, d = [], p = !1;
    t.lockMessages = function() {
        p = !0
    }
    ,
    t.unlockMessages = function() {
        if (p !== !1) {
            p = !1;
            var e = d.slice();
            n(e),
            d.length = 0
        }
    }
    ,
    t.connect = function(e) {
        if (s)
            return s.destroy(),
            s = null ,
            setTimeout(function() {
                t.connect(e)
            }, 0);
        var i = window.Primus
          , n = window.Config.maxReconnectionAttempt || 10;
        c = !1,
        r = !0,
        a = !1,
        l = !0,
        s = new i(e,{
            manual: !0,
            strategy: "disconnect,timeout",
            reconnect: {
                max: 5e3,
                min: 500,
                retries: n
            }
        }),
        s.on("open", function() {
            return s !== this ? console.warn("onOpen - Ignoring event: possible missing call to Primus#destroy") : (c = !1,
            t.emit("open", a),
            void (a = !0))
        }),
        s.on("offline", function() {
            l && (l = !1,
            r && t.emit("offline"))
        }),
        s.on("online", function() {
            return s !== this ? console.warn("onOnline - Ignoring event: possible missing call to Primus#destroy") : void (l || (l = !0,
            r && (t.emit("online"),
            s.readyState !== i.CLOSED || s.recovery.reconnecting() || window.setTimeout(function() {
                s.readyState !== i.CLOSED || s.recovery.reconnecting() || s.open()
            }, 0))))
        }),
        s.on("end", function() {
            l && (s = null ,
            c || (r = !1,
            t.disconnect("SOCKET_LOST")))
        }),
        s.on("reconnect scheduled", function(i) {
            t.emit("reconnecting", i.attempt, e)
        }),
        s.on("data", function(e) {
            if ("SequenceStartMessage" === e._messageType && (h += 1),
            h > 0) {
                if (u.push(e),
                "SequenceEndMessage" === e._messageType && (h -= 1,
                h <= 0)) {
                    var i = {
                        _messageType: "messageSequence",
                        sequence: u
                    };
                    p ? d.push(i) : t.emit("messageSequence", i),
                    u = [],
                    h = 0
                }
            } else
                t.emit("data", e),
                p ? d.push(e) : t.emit(e._messageType, e)
        }),
        s.on("error", function(e) {
            t.emit("error", e)
        }),
        s.open()
    }
    ,
    t.close = function() {
        c = !0,
        r = !1,
        s && (s.destroy(),
        s = null )
    }
    ,
    t.disconnect = function(e) {
        e = e || "CLIENT_CLOSING",
        console.info("connectionManager.disconnect: reason=" + e),
        "SOCKET_LOST" !== e && s && t.send("disconnecting", e),
        t.close(),
        t.emit("disconnect", e)
    }
    ,
    t.sendMessage = function(e, i) {
        t.send("sendMessage", {
            type: e,
            data: i
        })
    }
    ,
    t.send = function(e, i) {
        if (!s)
            return console.warn("Client trying to send while primus is null for call: " + e);
        var n = {
            call: e,
            data: i
        };
        s.write(n),
        t.emit("send", {
            call: e,
            data: n
        }),
        t.emit("send:" + e, n)
    }
}
, function(e, t, i) {
    function n(e) {
        if (e.reason)
            if (e.reason !== h.INCOMPATIBLE_VERSIONS)
                window.gui.openSimplePopup(c(e), l("ui.popup.accessDenied"));
            else {
                var t, i;
                r.isAndroidApp ? (t = l("tablet.ui.popup.accessDenied.incompatibleVersionsAndroid"),
                i = "market://details?id=com.ankama.dofustouch") : r.isIOSApp ? (t = l("tablet.ui.popup.accessDenied.incompatibleVersionsIOS"),
                i = "https://itunes.apple.com/app/id1041406978") : t = l("tablet.ui.popup.accessDenied.incompatibleVersions"),
                window.gui.openConfirmPopup({
                    title: l("ui.popup.accessDenied"),
                    message: t,
                    cb: function(e) {
                        e && i && window.open(i, "_system", "location=no")
                    }
                })
            }
        else
            window.gui.openSimplePopup(l("ui.popup.connectionFailed.text")),
            console.warn("login error without reason:", e)
    }
    function o(e, i, o) {
        function r(a, r) {
            return a ? (window.gui.openSimplePopup(u(a), l("ui.popup.accessDenied")),
            o(a)) : (window.dofus.setCredentials(i.account || r.username, r.token),
            window.gui.playerData.setLoginName(r.username),
            t.connectMethod = e,
            void window.dofus.login(function(e) {
                return d = !1,
                e ? (window.dofus.disconnect(),
                n(e)) : (t.lastServerId = s.getValue("lastServerId"),
                o())
            }))
        }
        if (i = i || {},
        o = o || function(e) {
            if (e)
                return console.error(e)
        }
        ,
        window.Config.byPassToken)
            return void r(null , {
                username: i.account,
                token: i.password
            });
        if (i.account) {
            var c = i.account
              , h = c.split("|");
            2 === h.length && (c = h[0]),
            a.login(c, i.password, i.save, r)
        } else
            a.login(r)
    }
    var s = i(30)
      , a = i(51)
      , r = i(7)
      , l = i(35).getText
      , c = i(52)
      , u = i(54)
      , h = i(55)
      , d = !1;
    t.characterId = null ,
    t.connectMethod = null ,
    t.lastServerId = null ,
    t.startLoginProcessWithPassword = function(e, t, i, n, s) {
        o(e, {
            account: t,
            password: i,
            save: n
        }, s)
    }
    ,
    t.startLoginProcessWithoutPassword = function(e, t) {
        o(e, {}, t)
    }
    ,
    t.reconnectByCharId = function(e) {
        t.characterId = e,
        d = !0,
        window.dofus.disconnect(),
        window.gui._shutDownUI(),
        t.startLoginProcessWithoutPassword("characterId")
    }
    ,
    t.selectServer = function(e) {
        var i = s.getValue("lastServerId");
        i !== e && s.setValue("lastServerId", e),
        t.lastServerId = e
    }
    ,
    t.backToLogin = function() {
        d || window.gui.loginScreen.backToLogin()
    }
    ,
    t.goBackToSelectionOf = function(e) {
        window.gui.splashScreen.show(),
        window.gui.loginScreen.hide(),
        d = !0,
        window.dofus.disconnect();
        var i = "character" === e ? "lastServer" : null ;
        t.startLoginProcessWithoutPassword(i)
    }
    ,
    t.onFullReconnection = function() {
        window.gui.splashScreen.show(),
        window.gui.loginScreen.hide(),
        t.connectMethod = "lastCharacter"
    }
}
, function(e, t, i) {
    function n(e) {
        if (e.status < 400 || e.status > 599)
            return e;
        var t = new Error(e.statusText);
        throw t.response = e,
        t
    }
    function o(e) {
        try {
            return window.localStorage.setItem("HAAPI_USERNAME", e),
            p = e,
            e
        } catch (t) {
            return !1
        }
    }
    function s(e, t) {
        if (t = t || {},
        d = e,
        !t.save)
            return e;
        try {
            if (!e)
                return window.localStorage.removeItem("HAAPI_KEY"),
                window.localStorage.removeItem("HAAPI_KEY_TIMEOUT"),
                e;
            var i = e ? Date.now() + g : null ;
            window.localStorage.setItem("HAAPI_KEY", e),
            window.localStorage.setItem("HAAPI_KEY_TIMEOUT", t.timeout || i)
        } catch (n) {
            return f.warning("Failed to store HAAPI_KEY in local storage:", n),
            null
        }
        return e
    }
    function a() {
        var e = Date.now()
          , t = window.localStorage.getItem("HAAPI_KEY")
          , i = window.localStorage.getItem("HAAPI_KEY_TIMEOUT");
        return !t || !i || i < e ? s(null , {
            save: !0
        }) : s(t, {
            save: !1
        })
    }
    function r() {
        return d ? d : a()
    }
    function l(e, t) {
        e.then(n).then(function(e) {
            e.json().then(function(i) {
                if (i._statusCode || e.status > 599)
                    throw i;
                t(null , i)
            })["catch"](t)
        })["catch"](t)
    }
    function c(e, t, i) {
        var n = window.Config.dataUrl;
        e = n + e;
        var o = m.stringify(t);
        l(window.fetch([e, o].join("?")), i)
    }
    function u(e, t, i) {
        var n = r()
          , o = window.Config.haapi.url;
        e = o + e;
        var s = {
            Accept: "application/json"
        };
        n && (s.APIKEY = n);
        var a = m.stringify(t);
        l(window.fetch([e, a].join("?"), {
            headers: s
        }), i)
    }
    function h(e, t, i) {
        var n = r()
          , o = window.Config.haapi.url;
        e = o + e;
        var s = {
            Accept: "application/json"
        };
        n && (s.apikey = n),
        l(window.fetch(e, {
            method: "post",
            headers: s,
            body: m.stringify(t)
        }), i)
    }
    var d, p, m = i(41), f = i(11).logger, g = 2592e6;
    t.hasKeyFromStorage = function() {
        return !!a()
    }
    ,
    t.hasKey = function() {
        return !!r()
    }
    ,
    t.getHaapiKey = r,
    t.resetHaapiKey = function() {
        s(null , {
            save: !0
        })
    }
    ,
    t.getHaapiUsername = function() {
        return p ? p : p = window.localStorage.getItem("HAAPI_USERNAME")
    }
    ,
    t.createGuest = function(e) {
        c("/haapi/createGuest", {
            lang: window.Config.language
        }, e)
    }
    ,
    t.validateGuest = function(e, t) {
        e.lang = window.Config.language,
        c("/haapi/validateGuest", e, t)
    }
    ,
    t.createAccount = function(e, t) {
        e.lang = window.Config.language,
        c("/haapi/createAccount", e, t)
    }
    ,
    t.createApiKey = function(e, t) {
        h("/Api/CreateApiKey", e, t)
    }
    ,
    t.createToken = function(e) {
        u("/Account/CreateToken", {
            game: window.Config.haapi.id
        }, e)
    }
    ,
    t.login = function(e, i, n, a) {
        function l(t, i) {
            return t ? a(t) : (o(e),
            i.username = e,
            a(null , i))
        }
        return 1 === arguments.length ? (a = e,
        e = t.getHaapiUsername(),
        r() ? t.createToken(l) : a({
            reason: "NOKEY"
        })) : (e = e.trim(),
        void t.createApiKey({
            login: e,
            password: i,
            long_life_token: n
        }, function(e, i) {
            if (e)
                return a(e);
            var o = new Date(i.expiration_date).getTime();
            return s(i.key, {
                save: n,
                timeout: o
            }),
            t.createToken(l)
        }))
    }
    ,
    t.getForumTopicsList = function(e) {
        var t = window.Config.language;
        c("/haapi/getForumTopicsList", {
            lang: t
        }, e)
    }
    ,
    t.getForumPostsList = function(e, t) {
        var i = window.Config.language;
        c("/haapi/getForumPostsList", {
            lang: i,
            topicId: e
        }, t)
    }
    ,
    t.getNewsList = function(e, t) {
        var i = window.Config.language;
        c("/haapi/getNewsList", {
            lang: i,
            count: e
        }, t)
    }
}
, function(e, t, i) {
    function n(e) {
        return "v" + [e.major, e.minor, e.release].join(".")
    }
    var o = i(53)
      , s = i(35).getText;
    e.exports = function(e) {
        switch (e.reason !== o.WRONG_CREDENTIALS && e.reason !== o.BANNED && e.reason !== o.IN_MAINTENANCE && e.reason !== o.BAD_IPRANGE && console.error("Identification failed:", e),
        e.reason) {
        case o.BAD_VERSION:
            return e.requiredVersion ? s("ui.popup.accessDenied.badVersion", n(e.currentVersion), n(e.requiredVersion)) : s("ui.popup.accessDenied.badVersion");
        case o.WRONG_CREDENTIALS:
            return s("ui.popup.accessDenied.wrongCredentials");
        case o.BANNED:
            return e.banEndDate ? s("ui.popup.accessDenied.bannedWithDuration", new Date(e.banEndDate)) : s("ui.popup.accessDenied.banned");
        case o.KICKED:
            return s("ui.popup.accessDenied.kicked");
        case o.IN_MAINTENANCE:
            return s("ui.popup.accessDenied.inMaintenance");
        case o.TOO_MANY_ON_IP:
            return s("ui.popup.accessDenied.toomanyonip");
        case o.TIME_OUT:
            return s("ui.popup.accessDenied.timeout");
        case o.BAD_IPRANGE:
            return s("ui.popup.accessDenied.badIpRange");
        case o.CREDENTIALS_RESET:
            return s("ui.popup.accessDenied.credentialsReset");
        case o.EMAIL_UNVALIDATED:
            return s("ui.popup.accessDenied.unvalidatedEmail");
        case o.SERVICE_UNAVAILABLE:
            return s("ui.popup.accessDenied.serviceUnavailable");
        default:
            return s("ui.popup.accessDenied.unknown")
        }
    }
}
, function(e, t) {
    e.exports = {
        BAD_VERSION: 1,
        WRONG_CREDENTIALS: 2,
        BANNED: 3,
        KICKED: 4,
        IN_MAINTENANCE: 5,
        TOO_MANY_ON_IP: 6,
        TIME_OUT: 7,
        BAD_IPRANGE: 8,
        CREDENTIALS_RESET: 9,
        EMAIL_UNVALIDATED: 10,
        SERVICE_UNAVAILABLE: 53,
        UNKNOWN_AUTH_ERROR: 99,
        SPARE: 100
    }
}
, function(e, t, i) {
    var n = i(35).getText;
    e.exports = function(e) {
        switch ("FAILED" !== e.reason && "OTPTIMEFAILED" !== e.reason && console.error("Haapi identification failed:", e),
        e.reason) {
        case "NOTOKEN":
            return n("ui.popup.accessDenied.notoken");
        case "BAN":
            return n("ui.popup.accessDenied.banned");
        case "BLACKLIST":
            return n("tablet.ui.popup.accessDenied.blacklist");
        case "LOCKED":
            return n("tablet.ui.popup.accessDenied.locked");
        case "DELETED":
            return n("tablet.ui.popup.accessDenied.deleted");
        case "OTPTIMEFAILED":
            return n("tablet.ui.popup.accessDenied.otptimefailed");
        case "BRUTEFORCE":
            return n("tablet.ui.popup.accessDenied.bruteForceDetected");
        case "FAILED":
            return n("ui.popup.accessDenied.wrongCredentials");
        case "MAILNOVALID":
            return n("ui.popup.accessDenied.unvalidatedEmail");
        case "BETACLOSED":
            return n("tablet.ui.popup.accessDenied.betaClosed");
        default:
            return n("ui.popup.accessDenied.unknown")
        }
    }
}
, function(e, t) {
    e.exports = {
        INCOMPATIBLE_VERSIONS: "INCOMPATIBLEVERSIONS"
    }
}
, function(e, t, i) {
    i(57),
    i(58),
    i(59),
    i(60),
    i(61),
    i(62),
    i(63),
    i(64),
    i(67),
    i(68),
    i(69),
    i(70),
    i(71),
    i(72),
    i(73),
    i(74),
    i(75),
    i(76),
    i(77),
    i(78),
    i(79),
    i(80),
    i(81),
    i(81),
    i(82),
    i(83),
    i(96),
    i(97),
    i(98),
    i(99),
    i(100),
    i(101),
    i(102),
    i(103),
    i(104),
    i(105),
    i(106),
    i(107),
    i(108),
    i(109),
    i(110),
    i(111),
    i(112),
    i(113),
    i(114),
    i(115),
    i(116),
    i(117),
    i(118),
    i(119),
    i(120),
    i(121),
    i(122),
    i(123),
    i(124),
    i(125),
    i(126),
    i(127),
    i(128),
    i(129),
    i(130),
    i(131),
    i(132),
    i(133),
    i(134),
    i(135),
    i(136),
    i(137),
    i(138),
    i(139),
    i(140),
    i(141),
    i(142),
    i(143),
    i(144),
    i(145),
    i(146),
    i(147),
    i(148),
    i(149),
    i(150),
    i(151),
    i(152),
    i(153)
}
, function(e, t, i) {
    var n = i(49);
    n.on("_ErrorPopupMessage", function(e) {
        window.gui.openSimplePopup(e.text, e.title)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("ConsoleMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ConsoleCommandsListMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("IdentificationSuccessMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("IdentificationSuccessWithLoginTokenMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ServersListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ServerStatusUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SelectedServerRefusedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AuthenticationTicketAcceptedMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("NicknameRegistrationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("NicknameRefusedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("NicknameAcceptedMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("AcquaintanceSearchErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n, o = i(65), s = i(66), a = i(49);
    a.on("DebugHighlightCellsMessage", function(e) {
        for (var t = {}, i = 0, a = 0; a < e.cells.length; a++) {
            var r = e.cells[a];
            t[r] = new o(r,i,s.fullRed)
        }
        window.background.removeGridLayer(n),
        n = window.background.addGridAnimation(t),
        window.setTimeout(function() {
            window.background.removeGridLayer(n)
        }, 5e3)
    }),
    a.on("DebugClearHighlightCellsMessage", function() {
        n && window.background.removeGridLayer(n)
    }),
    a.on("DebugInClientMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {
    function i(e, t, i) {
        this.cellId = e,
        this.distanceToPlayer = t,
        this.transformState = i
    }
    e.exports = i
}
, function(e, t) {
    function i(e, t, i, n, o, s) {
        this.sx = e,
        this.sy = t,
        this.r = i,
        this.g = n,
        this.b = o,
        this.a = s
    }
    t.empty = new i(.1,.1,.5,.5,.5,0),
    t.fullRed = new i(.78,.78,.8,.12,.08,.8),
    t.fullGreen = new i(.78,.78,0,1,.22,.7),
    t.fullBlue = new i(.78,.78,0,.51,.91,.8),
    t.walkable = new i(.9,.9,1,.92,0,.5),
    t.unwalkable = new i(.9,.9,.9,0,0,.8),
    t.walkableLast = new i(.9,.9,1,1,0,.8),
    t.inSight = new i(.78,.78,0,0,1,.5),
    t.outSight = new i(.78,.78,.6,.6,1,.5),
    t.areaOfEffect = new i(.78,.78,1,0,0,.9),
    t.inSightEnemyTurn = new i(.78,.78,.3,.3,.3,.8),
    t.outSightEnemyTurn = new i(.78,.78,.5,.5,.5,.7),
    t.areaOfEffectEnemyTurn = new i(.78,.78,1,1,1,1),
    t.blueTeamStart = new i(1,1,0,0,1,.5),
    t.blueTeamEnd = new i(.95,1,.1,.4,.8,.45),
    t.redTeamStart = new i(1,1,1,0,0,.5),
    t.redTeamEnd = new i(.95,1,.8,.4,.1,.45),
    t.walkArea = new i(1,1,0,.9,.02,.3),
    t.walkAreaRequiresAP = new i(1,1,0,.43,.4,.4),
    t.walkAreaRestricted = new i(1,1,1,0,0,.4),
    t.enemyWalkArea = new i(1,1,.1,.9,.032,.6),
    t.enemyWalkAreaRequiresAP = new i(1,1,.1,.435,.4,.6),
    t.enemyWalkAreaRestricted = new i(.9,.9,1,0,0,.6),
    t.TransformState = i
}
, function(e, t, i) {
    var n = i(49);
    n.on("AchievementListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AchievementDetailsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AchievementDetailedListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AchievementFinishedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AchievementRewardSuccessMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AchievementRewardErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("GameActionFightNoSpellCastMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameActionFightPointsVariationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameActionFightDeathMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    n.on("GameActionFightKillMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    n.on("GameActionFightLifePointsGainMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    n.on("GameActionFightLifePointsLostMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    n.on("GameActionFightLifeAndShieldPointsLostMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    n.on("GameActionFightDispellableEffectMessage", function(e) {
        console.error("GameActionFightDispellableEffectMessage received outside of sequence:", e)
    }),
    n.on("GameActionFightSlideMessage", function(e) {
        window.actorManager.actorMovement({
            actorId: e.targetId,
            keyMovements: [e.startCellId, e.endCellId],
            slide: !0
        })
    }),
    n.on("GameActionFightTeleportOnSameMapMessage", function(e) {
        window.actorManager.setActorsDisposition([{
            id: e.targetId,
            cellId: e.cellId
        }])
    }),
    n.on("GameActionFightExchangePositionsMessage", function(e) {
        window.actorManager.setActorsDisposition([{
            id: e.sourceId,
            cellId: e.casterCellId
        }, {
            id: e.targetId,
            cellId: e.targetCellId
        }])
    }),
    n.on("GameActionFightSummonMessage", function(e) {
        window.actorManager.addActor(e.summon)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("messageSequence", function(e) {
        window.isoEngine.transmitMessage(e),
        window.gui.emit("checkServerLag", "fightAction", "stop")
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("AllianceCreationStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceModificationStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceCreationResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceInvitedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceInvitationStateRecruterMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceInvitationStateRecrutedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceJoinedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceGuildLeavingMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceLeftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceMembershipMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("KohUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceFactsErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceFactsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceInsiderInfoMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("AccountLoggingKickedMessage", function() {
        window.gui.disconnect("AccountLoggingKickedMessage"),
        window.isoEngine.disconnect()
    }),
    n.on("ServerSettingsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ServerSessionConstantsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ServerOptionalFeaturesMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AccountCapabilitiesMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("AtlasPointInformationsMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("CompassResetMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("CompassUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("CompassUpdatePartyMemberMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("BasicTimeMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("BasicWhoIsNoMatchMessage", function(e) {
        window.gui.transmitMessage(e)
    });
    var o = 262
      , s = 12
      , a = 50;
    n.on("BasicLatencyStatsRequestMessage", function() {
        n.sendMessage("BasicLatencyStatsMessage", {
            latency: o,
            sampleCount: s,
            max: a
        })
    });
    var r = 0;
    n.on("send:login", function() {
        r = 0
    }),
    n.on("SequenceNumberRequestMessage", function() {
        r += 1,
        n.sendMessage("SequenceNumberMessage", {
            number: r
        })
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("CharacterCreationResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("CharacterNameSuggestionSuccessMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("CharacterNameSuggestionFailureMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("CharacterDeletionErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("CharacterStatsListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("FighterStatsListMessage", function(e) {
        window.isoEngine.sendToFightSequence(e)
    }),
    n.on("CharacterLevelUpMessage", function(e) {
        window.gui.transmitMessage(e),
        window.isoEngine.playLevelUpAnimation(window.gui.playerData.id)
    }),
    n.on("CharacterLevelUpInformationMessage", function(e) {
        var t = e.id;
        t !== window.gui.playerData.id && window.isoEngine.playLevelUpAnimation(t)
    }),
    n.on("UpdateLifePointsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("LifePointsRegenBeginMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("LifePointsRegenEndMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("ChatSmileyMessage", function(e) {
        window.gui.playerData.socialData.isIgnored(e.accountId) || window.actorManager.addSmileyOnActor(e.entityId, e.smileyId)
    }),
    n.on("MoodSmileyResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("MoodSmileyUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49)
      , o = i(84)
      , s = i(65)
      , a = i(66);
    n.on("GameContextCreateMessage", function(e) {
        window.gui.transmitMessage(e),
        window.isoEngine.changeGameContext(e.context),
        o.changeGameContext(e.context)
    }),
    n.on("GameContextDestroyMessage", function(e) {
        window.isoEngine.transmitMessage(e),
        window.actorManager.resetActors(),
        window.gui.transmitMessage(e)
    }),
    n.on("GameContextRemoveElementMessage", function(e) {
        window.actorManager.removeActor(e.id)
    }),
    n.on("GameContextRemoveMultipleElementsMessage", function(e) {
        window.actorManager.removeActors(e.id)
    }),
    n.on("GameContextRemoveElementWithEventMessage", function(e) {
        window.actorManager.removeActor(e.id)
    }),
    n.on("GameContextRemoveMultipleElementsWithEventsMessage", function(e) {
        window.actorManager.removeActors(e.id)
    }),
    n.on("GameContextRefreshEntityLookMessage", function(e) {
        window.actorManager.setActorLook(e.id, e.look),
        window.gui.transmitMessage(e)
    }),
    n.on("GameMapNoMovementMessage", function() {
        window.isoEngine.noMovement()
    }),
    n.on("GameMapMovementMessage", function(e) {
        window.actorManager.actorMovement(e)
    }),
    n.on("GameMapChangeOrientationMessage", function(e) {
        window.actorManager.setActorsDisposition([e.orientation])
    }),
    n.on("GameMapChangeOrientationsMessage", function(e) {
        window.actorManager.setActorsDisposition(e.orientations)
    }),
    n.on("GameEntityDispositionMessage", function(e) {
        window.actorManager.setActorsDisposition([e.disposition])
    }),
    n.on("GameEntitiesDispositionMessage", function(e) {
        window.actorManager.setActorsDisposition(e.dispositions, !0)
    }),
    n.on("ShowCellMessage", function(e) {
        var t = {}
          , i = 0;
        t[e.cellId] = new s(e.cellId,i,a.fullRed);
        var n = window.background.addGridAnimation(t);
        window.setTimeout(function() {
            window.background.removeGridLayer(n)
        }, 5e3)
    }),
    n.on("ShowCellSpectatorMessage", function(e) {
        for (var t = {}, i = 0, n = 0; n < e.cells.length; n++) {
            var o = e.cells[n];
            t[o] = new s(o,i,a.fullRed)
        }
        var r = window.background.addGridAnimation(t);
        window.setTimeout(function() {
            window.background.removeGridLayer(r)
        }, 5e3)
    })
}
, function(e, t, i) {
    function n() {
        window.gui.on("appOnBackground", function() {
            y.setMute(!0)
        }),
        window.gui.on("appBackFromBackground", function() {
            y.setMute(!1)
        })
    }
    function o() {
        for (var e in l)
            y.createSoundPermanent(l[e], "ui");
        v = !0
    }
    function s(e, t) {
        if (m && e === a.ROLE_PLAY)
            y.playLoopSound("music", m.id, m.volume / 100);
        else if (e === a.FIGHT) {
            var i = t && g ? g : f;
            i && y.playLoopSound("music", i.id, i.volume / 100)
        }
        _ && (e === a.ROLE_PLAY ? y.playLoopSound("ambient", _.id, _.volume / 100) : y.stopLoopSound("ambient"))
    }
    var a = i(85)
      , r = i(86)
      , l = i(93)
      , c = i(6)
      , u = i(7)
      , h = i(94)
      , d = i(95)
      , p = [null , "music", "ambient", "fight", "boss"]
      , m = null
      , f = null
      , g = null
      , _ = null
      , v = !1
      , y = new r(["music", "ambient", "sfx", "ui"]);
    y.settings.maxUsedMemory = c.MAX_MUSIC_SFX_MEMORY,
    window.wizAssets && (y.settings.getFileUri = function(e, t, i) {
        window.wizAssets.downloadFile(e + t + ".mp3", "audio/" + t + ".mp3", function(e) {
            i(null , e)
        }, i)
    }
    ),
    u.isCordova && (y.settings.getSoundConstructor = function(e) {
        return u.isIOSApp && h.isAvailable() ? h : u.isAndroidApp && d.isAvailable() ? "music" === e || "ambient" === e ? d.LoopYanap : "sfx" === e || "ui" === e ? d.SoundYanap : void 0 === e ? d.SoundYanap : void console.error(new Error("audioManager: unknown channelId `" + e + "`")) : null
    }
    );
    var t = e.exports = y;
    t.initialize = function() {
        y.init(),
        n()
    }
    ,
    t.createUiSound = function(e) {
        y.createSoundPermanent(l[e], "ui")
    }
    ,
    t.playUiSound = function(e) {
        if (!y.channels.ui.muted) {
            var t = l[e];
            if (!t)
                return console.warn("Incorrect UI sound id: " + e);
            v || o(),
            y.playSound("ui", t)
        }
    }
    ,
    t.mapChange = function(e, t) {
        var i = {
            music: null ,
            ambient: null ,
            fight: null ,
            boss: null
        };
        t = e.concat(t);
        for (var n = 0; n < t.length; n++) {
            var o = t[n]
              , a = p[o.type_id];
            a && (i[a] = o)
        }
        m = i.music || m,
        _ = i.ambient || _,
        f = i.fight,
        g = i.boss,
        s(window.gui.gameContext)
    }
    ,
    t.changeGameContext = function(e, t) {
        s(e, t)
    }
    ,
    t.createAnimSoundGroups = function(e, t) {
        var i = void 0 !== t && y.channels[t].muted;
        for (var n in e) {
            for (var o = e[n], s = [], a = 0; a < o.vol.length; a++)
                s.push(o.vol[a] / 100);
            y.createSoundGroup(n, {
                id: o.id,
                vol: s
            }, i)
        }
    }
    ,
    t.setChannelVolume = function(e, t, i) {
        var n = y.channels.music;
        "music" === e && y.channels.ambient.setMute(0 !== t),
        "ambient" === e && !n.muted && n.volume > 0 && (i = !0),
        y.setVolume(e, t, i),
        "sfx" === e && this.setChannelVolume("ambient", t)
    }
    ,
    t.setupChannels = function(e) {
        y.setVolume("ambient", 0, !0);
        for (var t in e)
            if ("ambient" !== t) {
                var i = e[t];
                this.setChannelVolume(t, i.volume, i.muted)
            }
    }
    ,
    t.getDefaultParams = function() {
        var e = {};
        for (var t in y.channels)
            if ("ambient" !== t) {
                var i = "music" === t && u.isIpad2
                  , n = i ? 0 : 1;
                e[t] = {
                    muted: i,
                    volume: n
                }
            }
        return e
    }
}
, function(e, t) {
    e.exports = {
        ROLE_PLAY: 1,
        FIGHT: 2
    }
}
, function(e, t, i) {
    function n(e) {
        this.soundsById = {},
        this.soundGroupsById = {},
        this.permanentSounds = {},
        this.freeSoundPool = [],
        this.soundArchive = new s(function() {
            return 1
        }
        ),
        this.soundGroupArchive = new s(function() {
            return 1
        }
        ),
        this.soundArchiveById = {},
        this.soundGroupArchiveById = {},
        this.usedMemory = 0,
        this.channels = {},
        this.audioContext = null ,
        this.muted = !1,
        this.settings = {
            audioPath: "",
            maxSoundGroup: 500,
            maxUsedMemory: 300,
            defaultFade: 2,
            maxPlayLatency: 1e3,
            crossFading: !1,
            getFileUri: function(e, t) {
                return e + t + ".mp3"
            },
            getSoundConstructor: function(e, t) {
                return null
            }
        };
        for (var t = 0; t < e.length; t++) {
            var i = e[t];
            this.channels[i] = new l(i)
        }
        c.prototype.audioManager = this,
        r.prototype.audioManager = this,
        l.prototype.audioManager = this
    }
    var o = window.AudioContext || window.webkitAudioContext
      , s = i(87)
      , a = i(88)
      , r = i(90)
      , l = i(91)
      , c = i(89);
    o || (console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),
    a = i(92),
    window.Audio || (console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),
    a = c)),
    e.exports = n,
    e.exports.ISound = c,
    n.prototype.init = function() {
        if (!this.audioContext && o) {
            this.audioContext = new o,
            a.prototype.audioContext = this.audioContext;
            for (var e in this.soundsById)
                this.soundsById[e].init()
        }
    }
    ,
    n.prototype.getEmptySound = function(e, t) {
        var i, n = this.settings.getSoundConstructor(e, t);
        return n ? i = new n : (this.freeSoundPool.length > 0 ? (i = this.freeSoundPool.pop(),
        i.init()) : i = new a,
        i)
    }
    ,
    n.prototype.setup = function(e) {
        for (var t in e) {
            var i = e[t];
            this.setVolume(t, i.volume, i.muted)
        }
    }
    ,
    n.prototype.setVolume = function(e, t, i) {
        var n = this.channels[e];
        n && n.setVolume(t, i)
    }
    ,
    n.prototype.setMute = function(e) {
        void 0 === e && (e = !this.muted),
        this.muted = !!e;
        for (var t in this.channels) {
            var i = this.channels[t];
            if (i.loopSound)
                if (e)
                    i.loopSound.stop();
                else {
                    var n = i.muted;
                    i.muted = !0,
                    i.setVolume(null , n)
                }
        }
    }
    ,
    n.prototype.loadSound = function(e, t) {
        var i = this.createSound(e);
        return i.load(t),
        i
    }
    ,
    n.prototype.createSound = function(e, t) {
        var i = this.getSound(e);
        return i ? i : (i = this.soundsById[e] = this.getEmptySound(t, e),
        i.setId(e),
        i)
    }
    ,
    n.prototype.createSoundPermanent = function(e, t) {
        var i = this.getSound(e);
        if (i)
            return i;
        var n = this.settings.getSoundConstructor(t, e) || a;
        return i = this.permanentSounds[e] = new n,
        i.setId(e),
        i
    }
    ,
    n.prototype.getSound = function(e) {
        var t = this.permanentSounds[e];
        return t ? t : (t = this.soundsById[e]) ? t : (t = this.soundArchiveById[e]) ? (this.soundArchive.removeByRef(t.poolRef),
        t.poolRef = null ,
        delete this.soundArchiveById[e],
        this.soundsById[e] = t,
        t) : null
    }
    ,
    n.prototype.getSoundGroup = function(e) {
        var t = this.soundGroupsById[e];
        return t ? t : (t = this.soundGroupArchiveById[e]) ? (this.soundGroupArchive.removeByRef(t.poolRef),
        t.poolRef = null ,
        delete this.soundGroupArchiveById[e],
        t.verifySounds(),
        this.soundGroupsById[e] = t,
        t) : null
    }
    ,
    n.prototype.freeSound = function(e) {
        var t = e.id;
        this.soundsById[t] && delete this.soundsById[t],
        this.soundArchiveById[t] && (this.soundArchive.removeByRef(e.poolRef),
        e.poolRef = null ,
        delete this.soundArchiveById[t]),
        e.unload(),
        e instanceof a && this.freeSoundPool.push(e)
    }
    ,
    n.prototype.playLoopSound = function(e, t, i, n, o) {
        var s = this.channels[e];
        return s ? void s.playLoopSound(t, i, n, o) : console.warn('Channel id "' + e + '" does not exist.')
    }
    ,
    n.prototype.stopLoopSound = function(e) {
        var t = this
          , i = this.channels[e];
        if (!i)
            return console.warn('Channel id "' + e + '" does not exist.');
        var n = i.loopSound;
        i.loopId = null ,
        n && n.stop(function() {
            t.freeSound(n),
            i.loopSound = null
        })
    }
    ,
    n.prototype.stopAllLoopSounds = function() {
        for (var e in this.channels)
            this.stopLoopSound(e)
    }
    ,
    n.prototype.release = function() {
        var e, t, i, n = this.settings.maxSoundGroup, o = this.settings.maxUsedMemory, s = {};
        for (e in this.channels) {
            var a = this.channels[e];
            a.loopSound && (s[a.loopSound.id] = !0)
        }
        for (e in this.soundGroupsById)
            t = this.soundGroupsById[e],
            t.poolRef = this.soundGroupArchive.add(t),
            this.soundGroupArchiveById[e] = t,
            delete this.soundGroupsById[e];
        for (e in this.soundsById)
            s[e] || (i = this.soundsById[e],
            i.poolRef = this.soundArchive.add(i),
            this.soundArchiveById[e] = i,
            delete this.soundsById[e]);
        for (var r = this.soundGroupArchive.getCount(); r > n && (t = this.soundGroupArchive.popFirst()); )
            t.poolRef = null ,
            delete this.soundGroupArchiveById[t.id],
            r -= 1;
        for (; this.usedMemory > o && (i = this.soundArchive.popFirst()); )
            i.poolRef = null ,
            delete this.soundArchiveById[i.id],
            this.freeSound(i)
    }
    ,
    n.prototype.playSound = function(e, t, i, n, o) {
        if (!this.muted) {
            var s = this.channels[e];
            if (!s.muted) {
                var a = this.getSound(t);
                a || (a = this.createSound(t, e)),
                i = i || 1,
                a.play(s.volume * i, n, o)
            }
        }
    }
    ,
    n.prototype.playSoundGroup = function(e, t, i, n, o) {
        if (!this.muted) {
            var s = this.channels[e];
            if (s && !s.muted) {
                var a = this.getSoundGroup(t);
                if (!a)
                    return console.warn('SoundGroup "' + t + '" does not exist.');
                i = i || 1,
                a.play(i * s.volume, n, o)
            }
        }
    }
    ,
    n.prototype.createSoundGroup = function(e, t, i) {
        if (!this.getSoundGroup(e)) {
            var n = new r(e,t.id,t.vol,t.pitch,i);
            this.soundGroupsById[e] = n
        }
    }
    ,
    n.prototype.createSoundGroups = function(e, t) {
        var i = void 0 !== t && this.channels[t].muted;
        for (var n in e)
            this.createSoundGroup(n, e[n], i)
    }
}
, function(e, t) {
    function i(e, t, i, n) {
        this.object = e,
        this.previous = t,
        this.next = i,
        this.container = n
    }
    function n(e) {
        this.count = 0,
        this.first = null ,
        this.last = null ,
        this.cmpFunc = e
    }
    n.prototype.add = function(e) {
        var t = new i(e,null ,null ,this);
        if (this.count += 1,
        null === this.first)
            return this.first = t,
            this.last = t,
            t;
        var n = this.cmpFunc(e, this.first.object);
        if (n < 0)
            return t.next = this.first,
            this.first.previous = t,
            this.first = t,
            t;
        var o = this.cmpFunc(e, this.last.object);
        if (o >= 0)
            return t.previous = this.last,
            this.last.next = t,
            this.last = t,
            t;
        var s;
        if (n + o < 0) {
            for (s = this.first.next; this.cmpFunc(e, s.object) >= 0; )
                s = s.next;
            t.next = s,
            t.previous = s.previous,
            t.previous.next = t,
            s.previous = t
        } else {
            for (s = this.last.previous; this.cmpFunc(e, s.object) < 0; )
                s = s.previous;
            t.previous = s,
            t.next = s.next,
            t.next.previous = t,
            s.next = t
        }
        return t
    }
    ,
    n.prototype.removeByRef = function(e) {
        return !(!e || e.container !== this) && (this.count -= 1,
        null === e.previous ? this.first = e.next : e.previous.next = e.next,
        null === e.next ? this.last = e.previous : e.next.previous = e.previous,
        e.previous = null ,
        e.next = null ,
        e.container = null ,
        !0)
    }
    ,
    n.prototype.moveToTheBeginning = function(e) {
        return !(!e || e.container !== this) && (null === e.previous || (e.previous.next = e.next,
        this.last === e ? this.last = e.previous : e.next.previous = e.previous,
        e.previous = null ,
        e.next = this.first,
        e.next.previous = e,
        this.first = e,
        !0))
    }
    ,
    n.prototype.moveToTheEnd = function(e) {
        return !(!e || e.container !== this) && (null === e.next || (e.next.previous = e.previous,
        this.first === e ? this.first = e.next : e.previous.next = e.next,
        e.next = null ,
        e.previous = this.last,
        e.previous.next = e,
        this.last = e,
        !0))
    }
    ,
    n.prototype.possess = function(e) {
        return e && e.container === this
    }
    ,
    n.prototype.popFirst = function() {
        var e = this.first;
        if (!e)
            return null ;
        this.count -= 1;
        var t = e.object;
        return this.first = e.next,
        null !== this.first && (this.first.previous = null ),
        e.next = null ,
        e.container = null ,
        t
    }
    ,
    n.prototype.popLast = function() {
        var e = this.last;
        if (!e)
            return null ;
        this.count -= 1;
        var t = e.object;
        return this.last = e.previous,
        null !== this.last && (this.last.next = null ),
        e.previous = null ,
        e.container = null ,
        t
    }
    ,
    n.prototype.getFirst = function() {
        return this.first && this.first.object
    }
    ,
    n.prototype.getLast = function() {
        return this.last && this.last.object
    }
    ,
    n.prototype.clear = function() {
        for (var e = this.first; e; e = e.next)
            e.container = null ;
        this.count = 0,
        this.first = null ,
        this.last = null
    }
    ,
    n.prototype.getCount = function() {
        return this.count
    }
    ,
    n.prototype.forEach = function(e, t) {
        for (var i = this.first; i; i = i.next)
            e(i.object, t)
    }
    ,
    n.prototype.forEachReverse = function(e, t) {
        for (var i = this.last; i; i = i.previous)
            e(i.object, t)
    }
    ,
    n.prototype.reposition = function(e) {
        if (e.container !== this)
            return this.add(e.object);
        var t = e.previous
          , i = e.next
          , n = e.object;
        for (null === i ? this.last = t : i.previous = t,
        null === t ? this.first = i : t.next = i; null !== t && this.cmpFunc(n, t.object) < 0; )
            i = t,
            t = t.previous;
        for (; null !== i && this.cmpFunc(n, i.object) >= 0; )
            t = i,
            i = i.next;
        return e.next = i,
        null === i ? this.last = e : i.previous = e,
        e.previous = t,
        null === t ? this.first = e : t.next = e,
        e
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.buffer = null ,
        this.source = null ,
        this.sourceConnector = null ,
        this.gain = null ,
        this.panNode = null ,
        this.rawAudioData = null ,
        this._playPitch = 0,
        this._fadeTimeout = null ,
        this._onStopCallback = null ,
        this._audioNodeReady = !1,
        this.init()
    }
    var o = i(26).inherits
      , s = i(89)
      , a = 1e-6;
    o(n, s),
    e.exports = n,
    n.prototype._createAudioNodes = function() {
        if (!this._audioNodeReady && this.audioContext) {
            var e, t = this.audioContext, i = t.createGain();
            e = t.createStereoPanner ? t.createStereoPanner() : t.createPanner(),
            i.connect(e),
            e.connect(t.destination),
            i.gain.value = 0,
            this.sourceConnector = i,
            this.gain = i.gain,
            this.panNode = e,
            this._audioNodeReady = !0
        }
    }
    ,
    n.prototype._destroyAudioNodes = function() {
        if (this._audioNodeReady) {
            var e = this.audioContext
              , t = this.panNode
              , i = this.sourceConnector;
            i.disconnect(t),
            t.disconnect(e.destination),
            this.source && (this.source.disconnect(i),
            this.source.onended = null ,
            this.source = null ),
            this.sourceConnector = null ,
            this.gain = null ,
            this.panNode = null ,
            this.rawAudioData = null ,
            this._audioNodeReady = !1
        }
    }
    ,
    n.prototype.init = function() {
        function e(e) {
            i.buffer = e,
            i.usedMemory = e.duration,
            i.audioManager.usedMemory += e.duration,
            i.rawAudioData = null ,
            i._loaded && i._playTriggered && ((i.loop || Date.now() - i._playTriggered < n) && i._play(),
            i._playTriggered = 0)
        }
        function t() {
            console.error("decode audio failed for sound ", i.id)
        }
        if (this._createAudioNodes(),
        this.rawAudioData) {
            var i = this
              , n = this.audioManager.settings.maxPlayLatency
              , o = this.audioContext;
            o.decodeAudioData(this.rawAudioData, e, t)
        }
    }
    ,
    n.prototype.setVolume = function(e) {
        if (this.volume = e,
        this.playing) {
            if (!this.fade)
                return void (this.gain.value = e);
            e <= 0 && (e = a);
            var t = this.audioContext.currentTime;
            this.gain.cancelScheduledValues(t),
            this.gain.setValueAtTime(this.gain.value || a, t),
            this.gain.linearRampToValueAtTime(e, t + this.fade)
        }
    }
    ,
    n.prototype.setPan = function(e) {
        this.pan = e,
        this.panNode && (this.panNode.pan ? this.panNode.pan.value = e : this.panNode.setPosition(e, 0, .2))
    }
    ,
    n.prototype.setLoop = function(e) {
        this.loop = e,
        this.source && this.buffer && (this.source.loop = e,
        this.source.loopStart = 0,
        this.source.loopEnd = this.buffer.duration)
    }
    ,
    n.prototype.setPitch = function(e, t) {
        this.pitch = e,
        this._setPlaybackRate(t)
    }
    ,
    n.prototype._updatePlayPitch = function(e) {
        !e && 0 !== e || e === this._playPitch || (this._playPitch = e,
        this._setPlaybackRate(0))
    }
    ,
    n.prototype._setPlaybackRate = function(e) {
        if (this.source) {
            var t = Math.pow(2, (this._playPitch + this.pitch) / 12);
            if (!e)
                return void (this.source.playbackRate.value = t);
            var i = this.audioContext.currentTime;
            this.source.playbackRate.cancelScheduledValues(i),
            this.source.playbackRate.setValueAtTime(this.source.playbackRate.value || a, i),
            this.source.playbackRate.linearRampToValueAtTime(t, i + e)
        }
    }
    ,
    n.prototype._load = function() {
        function e(e) {
            n._finalizeLoad(e)
        }
        function t(e) {
            n.buffer = e,
            n.usedMemory = e.duration,
            n.audioManager.usedMemory += e.duration,
            n._finalizeLoad(null )
        }
        function i(i) {
            var o = new XMLHttpRequest;
            o.responseType = "arraybuffer",
            o.onreadystatechange = function() {
                if (4 === ~~o.readyState)
                    return 200 !== ~~o.status && 0 !== ~~o.status ? e("xhrError:" + o.status) : void (n.audioContext ? n.audioContext.decodeAudioData(o.response, t, e) : (n.rawAudioData = o.response,
                    n._finalizeLoad(null )))
            }
            ,
            o.open("GET", i, !0),
            o.send()
        }
        var n = this;
        this._createAudioNodes();
        var o = this.audioManager.settings.getFileUri
          , s = this.audioManager.settings.audioPath;
        if (o.length > 2)
            o(s, this.id, function(t, n) {
                return t ? e(t) : void i(n)
            });
        else
            try {
                var a = o(s, this.id);
                if (!a)
                    return e("emptyUri");
                i(a)
            } catch (r) {
                e(r)
            }
    }
    ,
    n.prototype.unload = function() {
        s.prototype.unload.call(this) && (this._fadeTimeout && (this._onStopCallback = null ,
        this._stopAndClear()),
        this.buffer = null ,
        this.source && (this.source.onended = null ,
        this.source.stop(0),
        this.source = null ),
        this._destroyAudioNodes())
    }
    ,
    n.prototype._play = function(e) {
        if (!this.buffer)
            return void (this._playTriggered = Date.now());
        this.playing = !0;
        var t = this.audioContext.currentTime;
        if (this.gain.cancelScheduledValues(t),
        this.fade ? (this.gain.setValueAtTime(this.gain.value || a, t),
        this.gain.linearRampToValueAtTime(this.volume || a, t + this.fade)) : this.gain.value = this.volume,
        this._fadeTimeout)
            return this._onStopCallback = null ,
            this.source.onended = null ,
            this.stopping = !1,
            window.clearTimeout(this._fadeTimeout),
            void (this._fadeTimeout = null );
        this.source && (this.source.disconnect(this.sourceConnector),
        this.source.onended = null );
        var i = this.source = this.audioContext.createBufferSource();
        i.connect(this.sourceConnector);
        var n = this;
        i.onended = function() {
            n.playing = !1,
            i.onended = null ,
            n.source = null
        }
        ,
        this._playPitch = e || 0,
        (e || this.pitch) && this._setPlaybackRate(0),
        i.loop = this.loop,
        i.buffer = this.buffer,
        i.loopStart = 0,
        i.loopEnd = this.buffer.duration,
        i.start(0)
    }
    ,
    n.prototype._stopAndClear = function() {
        this.stopping = !1,
        this.source.onended = null ,
        this.source.stop(0),
        this.source = null ,
        this._fadeTimeout && (window.clearTimeout(this._fadeTimeout),
        this._fadeTimeout = null ),
        this._onStopCallback && (this._onStopCallback(),
        this._onStopCallback = null )
    }
    ,
    n.prototype.stop = function(e) {
        if (!this.playing && !this.stopping)
            return e && e();
        if (this._playTriggered = 0,
        this.stopping = !0,
        this.playing = !1,
        !this.source)
            return e && e();
        if (this._onStopCallback = e,
        !this._fadeTimeout) {
            if (this.fade) {
                var t = this
                  , i = this.audioContext.currentTime;
                return this.gain.cancelScheduledValues(i),
                this.gain.setValueAtTime(this.gain.value || a, i),
                this.gain.linearRampToValueAtTime(a, i + this.fade),
                void (this._fadeTimeout = window.setTimeout(function() {
                    t._fadeTimeout = null ,
                    t._stopAndClear()
                }, 1e3 * this.fade))
            }
            this._stopAndClear()
        }
    }
}
, function(e, t) {
    function i() {
        this.playing = !1,
        this.stopping = !1,
        this.fade = 0,
        this.usedMemory = 0,
        this.poolRef = null ,
        this.id = null ,
        this.volume = 1,
        this.pan = 0,
        this.loop = !1,
        this.pitch = 0,
        this._loaded = !1,
        this._loading = !1,
        this._unloading = !1,
        this._playTriggered = 0,
        this._onLoadQueuedCallback = []
    }
    e.exports = i,
    i.prototype.setId = function(e) {
        this.id = e,
        this._loaded = !1
    }
    ,
    i.prototype.load = function(e) {
        return this.id ? this._loaded ? e && e(null , this) : (e && this._onLoadQueuedCallback.push(e),
        this._loading ? void 0 : (this._loading = !0,
        this._load())) : e && e("noId")
    }
    ,
    i.prototype._finalizeLoad = function(e) {
        var t = this.audioManager.settings.maxPlayLatency;
        this._loaded = !e,
        this._loading = !1;
        for (var i = 0; i < this._onLoadQueuedCallback.length; i++)
            this._onLoadQueuedCallback[i](e, this);
        return this._onLoadQueuedCallback = [],
        this._unloading ? (this._unloading = !1,
        void this.unload()) : void (this._loaded && this._playTriggered && ((this.loop || Date.now() - this._playTriggered < t) && this._play(),
        this._playTriggered = 0))
    }
    ,
    i.prototype.cancelOnLoadCallbacks = function() {
        this._onLoadQueuedCallback = []
    }
    ,
    i.prototype.play = function(e, t, i) {
        return void 0 !== e && null !== e && this.setVolume(e),
        void 0 !== t && null !== t && this.setPan(t),
        this._loaded ? this.loop && this.playing ? void this._updatePlayPitch(i) : void this._play(i) : (this._playTriggered = Date.now(),
        void this.load())
    }
    ,
    i.prototype.init = function() {}
    ,
    i.prototype.setVolume = function(e) {
        this.volume = e
    }
    ,
    i.prototype.setPan = function(e) {
        this.pan = e
    }
    ,
    i.prototype.setLoop = function(e) {
        this.loop = e
    }
    ,
    i.prototype.setPitch = function(e) {
        this.pitch = e
    }
    ,
    i.prototype._updatePlayPitch = function(e) {}
    ,
    i.prototype._play = function(e) {
        this.playing = !0,
        console.log('ISound play call: "' + this.id + '"')
    }
    ,
    i.prototype.stop = function(e) {
        return this.playing = !1,
        e && e()
    }
    ,
    i.prototype._load = function() {
        return console.log("ISound load call: " + this.id),
        this._finalizeLoad(null )
    }
    ,
    i.prototype.unload = function() {
        return this._playTriggered = 0,
        this.setLoop(!1),
        this.fade = 0,
        this.pitch = 0,
        this.stop(),
        this._loading ? (this._unloading = !0,
        !1) : (this.audioManager.usedMemory -= this.usedMemory,
        this.setVolume(1),
        this.setPan(0),
        this.id = null ,
        this._loaded = !1,
        this.usedMemory = 0,
        !0)
    }
}
, function(e, t) {
    function i(e, t, i, n, o) {
        this.id = e,
        this.soundIds = t,
        this.volumes = i || [],
        this.pitches = n || [],
        this.soundIndex = 0,
        this.volIndex = 0,
        this.pitchIndex = 0,
        this.poolRef = null ,
        this._ready = !1,
        0 === this.volumes.length && this.volumes.push(1),
        0 === this.pitches.length && this.pitches.push(0),
        o || this._createSounds()
    }
    e.exports = i,
    i.prototype._createSounds = function() {
        for (var e = this.soundIds, t = 0; t < e.length; t++)
            this.audioManager.loadSound(e[t]);
        this._ready = !0
    }
    ,
    i.prototype.play = function(e, t, i) {
        if (0 !== this.soundIds.length) {
            this._ready || this._createSounds();
            var n = this.soundIds[this.soundIndex++]
              , o = this.audioManager.getSound(n);
            if (!o)
                return console.warn("[Sound Group: " + this.id + "] sound id " + n + "  cannot be played.");
            e = e || 1,
            i = i || 0,
            e *= this.volumes[this.volIndex++],
            i += this.pitches[this.pitchIndex++],
            o.play(e, t, i),
            this.soundIndex >= this.soundIds.length && (this.soundIndex = 0),
            this.volIndex >= this.volumes.length && (this.volIndex = 0),
            this.pitchIndex >= this.pitches.length && (this.pitchIndex = 0)
        }
    }
    ,
    i.prototype.verifySounds = function() {
        for (var e = 0; e < this.soundIds.length; e++) {
            var t = this.soundIds[e];
            this.audioManager.createSound(t)
        }
    }
}
, function(e, t) {
    function i(e) {
        this.id = e,
        this.volume = 1,
        this.muted = !0,
        this.loopSound = null ,
        this.loopId = null ,
        this.loopVol = 0,
        this.nextLoop = null
    }
    e.exports = i,
    i.prototype.setVolume = function(e, t) {
        var i = this.muted;
        this.muted = 0 === e || t || !1,
        void 0 !== e && null !== e ? this.volume = e : e = this.volume,
        this.loopId && (this.loopSound && this.muted ? this.loopSound.stop() : this.loopSound && this.loopSound.id === this.loopId ? (this.loopSound.setVolume(Math.max(0, Math.min(1, e * this.loopVol))),
        i && this.loopSound.play()) : this.muted || this.audioManager.playLoopSound(this.id, this.loopId, this.loopVol))
    }
    ,
    i.prototype.setMute = function(e) {
        this.setVolume(null , e)
    }
    ,
    i.prototype.playLoopSound = function(e, t, i, n) {
        function o(e, t) {
            return e ? void (e.stopping || e.stop(function() {
                return r.freeSound(e),
                e = null ,
                t && t()
            })) : t && t()
        }
        function s() {
            var e = d.loopSound = d.nextLoop;
            d.nextLoop = null ,
            e && (e.setLoop(!0),
            e.fade = l,
            e.load(function(o) {
                return o ? (e.unload(),
                void (d.loopSound = null )) : void e.play(t * d.volume, i, n)
            }))
        }
        function a() {
            d.loopSound = null ,
            window.setTimeout(s, 0)
        }
        var r = this.audioManager
          , l = r.settings.defaultFade
          , c = r.settings.crossFading
          , u = this.loopSound
          , h = u && u.id;
        if (t = Math.max(0, Math.min(1, t || 1)),
        this.loopId = e,
        this.loopVol = t,
        !r.muted && !this.muted) {
            if (e === h && u)
                return u.play(t * this.volume, i, n),
                void (this.nextLoop && (this.nextLoop.cancelOnLoadCallbacks(),
                this.nextLoop = null ));
            if (u = null ,
            !this.nextLoop || this.nextLoop.id !== e) {
                var d = this;
                c ? (this.nextLoop && this.nextLoop.cancelOnLoadCallbacks(),
                this.nextLoop = r.createSound(e, this.id),
                this.nextLoop.load(function(e) {
                    return e ? (d.nextLoop.unload(),
                    void (d.nextLoop = null )) : (o(d.loopSound),
                    void a())
                })) : (this.nextLoop = r.createSound(e, this.id),
                o(this.loopSound, a))
            }
        }
    }
}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e = new Audio;
        e.loop = !1,
        e.type = "audio/mpeg",
        this._audio = e,
        this.audioContext && (this.source = this.audioContext.createMediaElementSource(e),
        this.source.connect(this.audioContext.destination))
    }
    var o = i(26).inherits
      , s = i(89)
      , a = {
        playAudioWhenScreenIsLocked: !1
    };
    o(n, s),
    e.exports = n,
    n.prototype.setVolume = function(e) {
        this.volume = this._audio.volume = e
    }
    ,
    n.prototype.setLoop = function(e) {
        this.loop = this._audio.loop = e
    }
    ,
    n.prototype._load = function() {
        function e(e) {
            o._finalizeLoad(e)
        }
        function t() {
            this.removeEventListener("canplaythrough", t),
            this.removeEventListener("error", i),
            o.usedMemory = this.duration,
            o.audioManager.usedMemory += this.duration,
            o._finalizeLoad(null )
        }
        function i(n) {
            this.removeEventListener("canplaythrough", t),
            this.removeEventListener("error", i),
            e(n)
        }
        function n(e) {
            o._loading = !0,
            o._audio.addEventListener("canplaythrough", t),
            o._audio.addEventListener("error", i),
            o._audio.src = e,
            o._audio.load()
        }
        var o = this
          , s = this.audioManager.settings.getFileUri
          , a = this.audioManager.settings.audioPath;
        if (s.length > 2)
            s(a, this.id, function(t, i) {
                return t ? e(t) : void n(i)
            });
        else
            try {
                var r = s(a, this.id);
                if (!r)
                    return e("emptyUri");
                n(r)
            } catch (l) {
                e(l)
            }
    }
    ,
    n.prototype.unload = function() {
        s.prototype.unload.call(this) && (this._audio.volume = 1,
        this._audio.src = "",
        this._audio.load())
    }
    ,
    n.prototype._play = function(e) {
        this._audio.volume = this.volume,
        this._audio.pause(),
        this._audio.currentTime = 0,
        this._audio.play(a),
        this.playing = !0
    }
    ,
    n.prototype.stop = function(e) {
        return this._audio.pause(),
        this._audio.currentTime = 0,
        this._playTriggered = 0,
        this.playing = !1,
        e && e()
    }
}
, function(e, t) {
    e.exports = {
        LEVEL_UP: 16062,
        OPEN_INVENTORY: 16026,
        CLOSE_INVENTORY: 16027,
        ITEM_IN_INVENTORY_1: 16040,
        ITEM_IN_INVENTORY_2: 16041,
        ITEM_IN_INVENTORY_3: 16042,
        DROP_ITEM_1: 16043,
        EQUIP_BOOTS: 16028,
        EQUIP_WRISTBAND: 16029,
        EQUIP_CLOTH_1: 16030,
        EQUIP_CLOTH_2: 16031,
        EQUIP_NECKLACE: 16036,
        EQUIP_ACCESORIES: 16037,
        EQUIP_WEAPON: 16038,
        EQUIP_HAND: 16039,
        EQUIP_DOFUS: 16091,
        EQUIP_PET: 16092,
        OPTIONS_OPEN: 16023,
        OPTIONS_CLOSE: 16024,
        INTRO_FIGHT: 16067,
        OUTRO_FIGHT: 16068,
        READY_TO_FIGHT: 16070,
        END_TURN: 16069,
        PLAYER_TURN: 16077,
        NPC_TURN: 16078,
        FIGHT_POSITION: 16071,
        OK_BUTTON: 16002,
        PLAY_BUTTON: 16003,
        GEN_BUTTON: 16004,
        SPEC_BUTTON: 16005,
        CHECKBOX_CHECKED: 16006,
        CHECKBOX_UNCHECKED: 16007,
        TAB: 16009,
        ROLLOVER: 16010,
        SCROLL_UP: 16014,
        SCROLL_DOWN: 16015,
        CHARACTER_SELECTION_RIGHT: 16079,
        CHARACTER_SELECTION_LEFT: 16080,
        DELETE_CHARACTER: 16081,
        POPUP_YES: 16082,
        POPUP_NO: 16083,
        CANCEL_BUTTON: 16084,
        FRIENDS: 16085,
        CHARACTER_CREATION: 16086,
        BANNER_SPELL_TAB: 16087,
        BANNER_EMOTE_TAB: 16089,
        PLUS_BUTTON: 16090,
        STORE_SELL_BUTTON: 16099,
        STORE_BUY_BUTTON: 16100,
        VALID_KAMA_EXCHANGE: 16101,
        MERCHANT_REMOVE_SELL_BUTTON: 16096,
        DRAG_START: 16053,
        DRAG_END: 16059,
        CHALLENGE_CHECKPOINT: 16073,
        LITTLE_OBJECTIVE: 16074,
        POPUP_INFO: 16011,
        WINDOW_OPEN: 16012,
        WINDOW_CLOSE: 16013,
        OPEN_DOCUMENT: 16102,
        CLOSE_DOCUMENT: 16103,
        TURN_PAGE_DOCUMENT_1: 16104,
        TURN_PAGE_DOCUMENT_2: 16105,
        TURN_PAGE_DOCUMENT_3: 16106,
        BACK_TO_BEGINNING_DOCUMENT: 16108,
        GUILD_CHAT_MESSAGE: 16109,
        RED_CHAT_MESSAGE: 16114,
        MOUNT_HURT: 1412506,
        OPEN_MOUNT_UI: 1412505,
        OPEN_TRANSACTION_WINDOW: 16093,
        CLOSE_TRANSACTION_WINDOW: 16094,
        LEFT_TO_RIGHT_SWITCH: 16097,
        RIGHT_TO_LEFT_SWITCH: 16098,
        NEW_TIPS: 16112,
        NEW_REWARD: 16118
    }
}
, function(e, t, i) {
    function n() {
        return n.isAvailable() ? (s.call(this),
        this.media = null ,
        this.uri = null ,
        this.errorOccured = !1,
        void (r || (window.Media.shouldReleaseOnMemoryWarning(!1),
        r = !0))) : console.error(new Error("SoundCordova: cordova media plugin is not available"))
    }
    var o = i(26).inherits
      , s = i(86).ISound
      , a = i(7)
      , r = !1
      , l = !1;
    o(n, s),
    e.exports = n,
    n.isAvailable = function() {
        return a.isCordova && window.Media
    }
    ,
    n.prototype.setVolume = function(e) {
        s.prototype.setVolume.call(this, e),
        this.media && this.media.setVolume(e)
    }
    ,
    n.prototype._load = function() {
        function e() {}
        function t(e) {
            var t = !o.errorOccured
              , i = a.isIOSApp && window.navigator.userAgent.indexOf("iPad; CPU OS 8_0") !== -1;
            3 === e.code && i && (l && (t = !1),
            l = !0),
            o._loading && o._finalizeLoad(e),
            o.errorOccured || o.unload(),
            o.errorOccured = !0,
            t && console.error("SoundCordova: " + JSON.stringify(e) + ", file: " + o.uri)
        }
        function i() {
            if (!o.usedMemory) {
                var e = Number(o.media.getDuration());
                !e || e < 0 || (o.usedMemory = e,
                o.audioManager.usedMemory += e)
            }
        }
        function n(n) {
            o.uri = n,
            o.media = new window.Media(n,e,t,i),
            o._loading && !o.errorOccured && o._finalizeLoad(null )
        }
        var o = this;
        if (o.errorOccured)
            return this._finalizeLoad("previouslyFailed");
        var s = o.audioManager.settings.getFileUri
          , r = o.audioManager.settings.audioPath;
        if (s.length > 2)
            s(r, o.id, function(e, t) {
                return e ? o._finalizeLoad(e) : void n(t)
            });
        else
            try {
                var c = s(r, o.id);
                if (!c)
                    return o._finalizeLoad("emptyUri");
                n(c)
            } catch (u) {
                o._finalizeLoad(u)
            }
    }
    ,
    n.prototype.unload = function() {
        if (s.prototype.unload.call(this)) {
            if (!this.media)
                return;
            this.media.stop(),
            this.media.release()
        }
    }
    ,
    n.prototype._play = function() {
        this.media && (this.errorOccured || (this.media.setVolume(this.volume),
        this.loop && this.playing || (this.media.seekTo(0),
        this.media.play({
            numberOfLoops: this.loop ? 0 : 1,
            playAudioWhenScreenIsLocked: !1
        }),
        this.playing = !0)))
    }
    ,
    n.prototype.stop = function(e) {
        return this.media ? (this.media.stop(),
        s.prototype.stop.call(this, e)) : e && e()
    }
}
, function(e, t, i) {
    function n() {
        return u.isAndroidApp && window.cordova.plugins.Yanap
    }
    function o() {
        return n() ? (c.call(this),
        this.audioMode = null ,
        this.media = null ,
        this.uri = null ,
        void (this.errorOccured = !1)) : console.error(new Error("YanapAudioInstance: Yanap plugin is not available"))
    }
    function s() {
        o.call(this),
        this.audioMode = window.cordova.plugins.Yanap.AUDIO_TYPE.LOOP
    }
    function a() {
        o.call(this),
        this.audioMode = window.cordova.plugins.Yanap.AUDIO_TYPE.MUSIC
    }
    function r() {
        o.call(this),
        this.audioMode = window.cordova.plugins.Yanap.AUDIO_TYPE.SOUND
    }
    var l = i(26).inherits
      , c = i(86).ISound
      , u = i(7)
      , h = 12e3;
    l(o, c),
    o.prototype.setVolume = function(e) {
        c.prototype.setVolume.call(this, e),
        this.media && this.media.setVolume(e, e)
    }
    ,
    o.prototype._load = function() {
        function e(e) {
            var t = !n.errorOccured;
            n._loading && n._finalizeLoad(e),
            n.errorOccured || n.unload(),
            n.errorOccured = !0,
            t && console.error("SoundYanap: " + JSON.stringify(e) + ", file: " + n.uri)
        }
        function t(t, i) {
            if (t === window.cordova.plugins.Yanap.AUDIO_INSTANCE_STATUS.ERROR)
                return e(i);
            if (!n.usedMemory && n.media && n.media.fileLength) {
                var o = ~~n.media.fileLength / h;
                o <= 0 || (n.usedMemory = o,
                n.audioManager.usedMemory += o)
            }
        }
        function i(e) {
            n.uri = e,
            n.media = new window.cordova.plugins.Yanap.AudioInstance(n.audioMode,t),
            window.wizAssets && !window.wizAssets.initialize && (e = e.substr(e.indexOf("/audio/") + 1)),
            n.media.load(e),
            n._finalizeLoad(null )
        }
        var n = this;
        if (n.errorOccured)
            return this._finalizeLoad("previouslyFailed");
        var o = n.audioManager.settings.getFileUri
          , s = n.audioManager.settings.audioPath;
        if (o.length > 2)
            o(s, n.id, function(e, t) {
                return e ? n._finalizeLoad(e) : void i(t)
            });
        else
            try {
                var a = o(s, n.id);
                if (!a)
                    return n._finalizeLoad("emptyUri");
                i(a)
            } catch (r) {
                n._finalizeLoad(r)
            }
    }
    ,
    o.prototype.unload = function() {
        if (c.prototype.unload.call(this)) {
            if (!this.media)
                return;
            this.media.stop(),
            this.media.release()
        }
    }
    ,
    o.prototype._play = function() {
        this.media && (this.errorOccured || (this.media.setVolume(this.volume, this.volume),
        this.media.play(),
        this.playing = !0))
    }
    ,
    o.prototype.stop = function(e) {
        return this.media ? (this.media.stop(),
        c.prototype.stop.call(this, e)) : e && e()
    }
    ,
    l(s, o),
    l(a, o),
    l(r, o),
    e.exports = {
        LoopYanap: s,
        MusicYanap: a,
        SoundYanap: r,
        isAvailable: n
    }
}
, function(e, t, i) {
    function n(e) {
        window.isoEngine.displayNumericalValue(e)
    }
    var o = i(49);
    o.on("DisplayNumericalValueMessage", n),
    o.on("DisplayNumericalValueWithAgeBonusMessage", n)
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        window.gui.transmitMessage(e),
        window.isoEngine.transmitMessage(e)
    }
    var o = i(49);
    o.on("GameFightStartingMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightJoinMessage", function(e) {
        window.isoEngine.transmitMessage(e),
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightPlacementPossiblePositionsMessage", function(e) {
        window.isoEngine.displayFightPositions(e),
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightOptionStateUpdateMessage", function(e) {
        window.isoEngine.challengeOptionChange(e.fightId, e.teamId, e.option, e.state),
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightUpdateTeamMessage", function(e) {
        window.isoEngine.updateFightTeam(e),
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightRemoveTeamMemberMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightHumanReadyStateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightLeaveMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    o.on("GameFightStartMessage", function(e) {
        window.gui.transmitMessage(e),
        window.isoEngine.transmitMessage(e)
    }),
    o.on("GameFightSpectateMessage", n),
    o.on("GameFightResumeMessage", n),
    o.on("GameFightResumeWithSlavesMessage", n),
    o.on("GameFightEndMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    o.on("GameFightNewRoundMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnStartMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnStartPlayingMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnResumeMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnStartSlaveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("GameFightTurnReadyRequestMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    o.on("GameFightSynchronizeMessage", function(e) {
        window.isoEngine.transmitMessage(e)
    }),
    o.on("GameFightTurnEndMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("ChallengeInfoMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ChallengeResultMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("GameFightShowFighterMessage", function(e) {
        window.gui.transmitMessage(e),
        e.informations.alive ? window.actorManager.addActor(e.informations) : window.actorManager.userActor.actorId === e.informations.contextualId && window.actorManager.userActor.loadAndPlayAnimation({
            base: "AnimMort"
        }, !1, function() {
            window.actorManager.userActor.death()
        })
    }),
    n.on("GameFightRefreshFighterMessage", function(e) {
        window.gui.transmitMessage(e),
        window.actorManager.refreshFighter(e)
    }),
    n.on("GameFightShowFighterRandomStaticPoseMessage", function(e) {
        window.gui.transmitMessage(e),
        window.actorManager.addActor(e.informations)
    })
}
, function(e, t, i) {
    function n(e) {
        if (e._bonesId) {
            var t = {
                contextualId: "paddockItem:" + e.cellId,
                look: {
                    bonesId: e._bonesId,
                    scales: [100],
                    skins: []
                },
                disposition: {
                    cellId: e.cellId,
                    direction: 1
                },
                name: e._nameId,
                durability: e.durability,
                _type: "PaddockObject"
            };
            window.actorManager.addActor(t)
        }
    }
    var o = i(49);
    o.on("GameDataPaddockObjectAddMessage", function(e) {
        n(e.paddockItemDescription)
    }),
    o.on("GameDataPaddockObjectListAddMessage", function(e) {
        for (var t = e.paddockItemDescription, i = 0; i < t.length; i++)
            n(t[i])
    }),
    o.on("GameDataPaddockObjectRemoveMessage", function(e) {
        window.actorManager.removeActor("paddockItem:" + e.cellId)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("NotificationListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("NotificationByServerMessage", function(e) {
        console.info("NotificationByServerMessage: ", "id:" + e.id, e.parameters)
    })
}
, function(e, t, i) {
    function n(e) {
        window.gui.transmitMessage(e),
        a === e.mapId ? window.isoEngine.reloadMap(e) : (o.lockMessages(),
        window.isoEngine.loadMap(e)),
        a = e.mapId
    }
    var o = i(49)
      , s = i(84)
      , a = null ;
    o.on("disconnect", function() {
        a = null
    }),
    o.on("CurrentMapMessage", function(e) {
        o.sendMessage("MapInformationsRequestMessage", {
            mapId: e.mapId
        }),
        e.mapId !== a && (window.foreground.lock("loadMap"),
        window.gui.transmitMessage(e),
        s.release())
    }),
    o.on("TeleportOnSameMapMessage", function(e) {
        window.actorManager.setActorsDisposition([{
            id: e.targetId,
            cellId: e.cellId
        }])
    }),
    o.on("MapFightCountMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("MapRunningFightListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("MapRunningFightDetailsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    o.on("MapObstacleUpdateMessage", function(e) {
        window.isoEngine.updateObstacles(e.obstacles)
    }),
    o.on("MapComplementaryInformationsDataMessage", n),
    o.on("MapComplementaryInformationsDataInHouseMessage", n),
    o.on("MapComplementaryInformationsWithCoordsMessage", n),
    o.on("GameRolePlayShowActorMessage", function(e) {
        window.actorManager.addActor(e.informations)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("GameRolePlayPlayerLifeStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayGameOverMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("DocumentReadingBeginMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("EmoteListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("EmoteAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("EmoteRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("EmotePlayMessage", function(e) {
        window.isoEngine.playEmote(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("GameRolePlayAggressionMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayPlayerFightFriendlyRequestedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayPlayerFightFriendlyAnsweredMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayShowChallengeMessage", function(e) {
        window.isoEngine.showChallenge(e.commonsInfos)
    }),
    n.on("GameRolePlayRemoveChallengeMessage", function(e) {
        window.gui.transmitMessage(e),
        window.isoEngine.removeChallenge(e.fightId)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("GameRolePlayArenaRegistrationStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayArenaFightPropositionMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayArenaFighterStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlayArenaUpdatePlayerInfosMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("AccountHouseMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("HousePropertiesMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("HouseBuyResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("HouseSoldMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("HouseToSellListMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("HouseGuildNoneMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("HouseGuildRightsMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("JobDescriptionMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobLevelUpMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobUnlearntMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobExperienceMultiUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobExperienceUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobAllowMultiCraftRequestMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobMultiCraftAvailableSkillsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobCrafterDirectoryListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobCrafterDirectorySettingsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobListedUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobCrafterDirectoryRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobCrafterDirectoryAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("JobCrafterDirectoryEntryMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("LockableShowCodeDialogMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("LockableCodeResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("LockableStateUpdateHouseDoorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("MapNpcsQuestStatusUpdateMessage", function(e) {
        window.actorManager.updateQuestIcons(e)
    }),
    n.on("TaxCollectorDialogQuestionBasicMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorDialogQuestionExtendedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AllianceTaxCollectorDialogQuestionExtendedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AlliancePrismDialogQuestionMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49)
      , o = i(5)
      , s = i(6)
      , a = s.ITEM_DIR;
    n.on("ObjectGroundAddedMessage", function(e) {
        var t = {
            cellId: e.cellId,
            objectGID: e.objectGID
        };
        o.loadImage(a + e._iconId + ".png", function(e) {
            t.img = e,
            window.isoEngine.addObjects([t])
        })
    }),
    n.on("ObjectGroundListAddedMessage", function(e) {
        for (var t = [], i = [], n = 0, s = e.cells.length; n < s; n++)
            t.push({
                cellId: e.cells[n],
                objectGID: e.referenceIds[n]
            }),
            i.push(a + e._iconIds[n] + ".png");
        o.loadImages(i, null , function(e) {
            for (var i = 0; i < e.length; i++)
                t[i].img = e[i];
            window.isoEngine.addObjects(t)
        })
    }),
    n.on("ObjectGroundRemovedMessage", function(e) {
        window.isoEngine.removeObjects([e.cell])
    }),
    n.on("ObjectGroundRemovedMultipleMessage", function(e) {
        window.isoEngine.removeObjects(e.cells)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("PaddockPropertiesMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PaddockSellBuyDialogMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameDataPlayFarmObjectAnimationMessage", function(e) {
        for (var t = 0; t < e.cellId.length; t++) {
            var i = "paddockItem:" + e.cellId[t]
              , n = window.actorManager.getActor(i);
            n && n.loadAndPlayAnimation({
                base: "AnimHit",
                direction: 1
            }, !1)
        }
    }),
    n.on("PaddockToSellListMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("PartyInvitationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyInvitationDetailsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyInvitationCancelledForGuestMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyCancelInvitationNotificationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyRefuseInvitationNotificationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyCannotJoinErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyJoinMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyNewGuestMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyNewMemberMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyUpdateLightMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyMemberRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyMemberEjectedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyLeaderUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyFollowStatusUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyLeaveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyKickedByMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyDeletedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PartyMemberInFightMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("PurchasableDialogMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("QuestListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestValidatedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestObjectiveValidatedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestStepValidatedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestStepStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("QuestStepInfoMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("SpellForgetUIMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SpellForgottenMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SpellUpgradeSuccessMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SpellUpgradeFailureMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GameRolePlaySpellAnimMessage", function(e) {
        window.isoEngine.playRoleplaySpellAnim(e)
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("LeaveDialogMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("FriendsListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("IgnoredListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("FriendAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("FriendUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("IgnoredAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("IgnoredDeleteResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SpouseStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SpouseInformationsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("FriendWarnOnConnectionStateMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("GuildCreationStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildModificationStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildCreationResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInvitedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInvitationStateRecruterMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInvitationStateRecrutedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildJoinedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildMemberOnlineStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInformationsGeneralMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInformationsMembersMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildMemberWarnOnConnectionStateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInformationsMemberUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInformationsPaddocksMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildMemberLeavingMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildLeftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildMembershipMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInfosUpgradeMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildHousesInformationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildHouseUpdateInformationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildHouseRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildPaddockBoughtMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildPaddockRemovedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildFactsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildInAllianceFactsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ChallengeFightJoinRefusedMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("TaxCollectorMovementMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorMovementAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorMovementRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorAttackedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TaxCollectorAttackedResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildFightPlayersHelpersJoinMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildFightPlayersHelpersLeaveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildFightPlayersEnemiesListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("GuildFightPlayersEnemyRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("SetCharacterRestrictionsMessage", function(e) {
        window.isoEngine.actorManager.userActor.updateRestrictions(e.restrictions)
    }),
    n.on("ServerExperienceModificatorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("InteractiveUseErrorMessage", function(e) {
        window.isoEngine.onInteractiveUseErrorMessage(e)
    }),
    n.on("InteractiveUsedMessage", function(e) {
        window.isoEngine.interactiveUseStart(e),
        window.gui.transmitMessage(e)
    }),
    n.on("InteractiveUseEndedMessage", function(e) {
        window.isoEngine.interactiveUseEndedMessage(e),
        window.gui.transmitMessage(e)
    }),
    n.on("InteractiveMapUpdateMessage", function(e) {
        window.isoEngine.updateInteractiveElements(e.interactiveElements)
    }),
    n.on("InteractiveElementUpdatedMessage", function(e) {
        window.isoEngine.updateInteractiveElements([e.interactiveElement])
    }),
    n.on("StatedMapUpdateMessage", function(e) {
        window.isoEngine.updateStatedElements(e.statedElements)
    }),
    n.on("StatedElementUpdatedMessage", function(e) {
        window.isoEngine.updateStatedElements([e.statedElement])
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("TeleportDestinationsListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ZaapListMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("KamasUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ObjectAveragePricesMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("ExchangeReplayCountModifiedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeRequestedTradeMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartedWithPodsMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartedWithStorageMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftSlotCountIncreasedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeIsReadyMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeLeaveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartOkNpcTradeMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeOkMultiCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftResultWithObjectIdMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftResultWithObjectDescMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftResultMagicWithObjectDescMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeCraftInformationObjectMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartedMountStockMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeWeightMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeGuildTaxCollectorGetMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeReplyTaxVendorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountStableErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountStableAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountPaddockAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountStableBornAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountStableRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountPaddockRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountTakenFromPaddockMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountFreeFromPaddockMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMountSterilizeFromPaddockMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeItemAutoCraftStopedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeItemAutoCraftRemainingMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartOkCraftWithInformationMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartOkMulticraftCrafterMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartOkMulticraftCustomerMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeStartOkJobIndexMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeGoldPaymentForCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeItemPaymentForCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeModifiedPaymentForCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeRemovedPaymentForCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeClearPaymentForCraftMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("InventoryContentMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SetUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryWeightMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ObjectMovementMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ObjectAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ObjectsAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ObjectModifiedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("LivingObjectMessageMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryContentAndPresetMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectRemovedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectModifiedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectPutInBagMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectRemovedFromBagMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeObjectModifiedInBagMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeKamaModifiedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ExchangeMultiCraftCrafterCanUseHisRessourcesMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("InventoryPresetUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryPresetItemUpdateErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryPresetItemUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryPresetSaveResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryPresetDeleteResultMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("InventoryPresetUseResultMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("SpellListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("SlaveSwitchContextMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("StorageInventoryContentMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("StorageKamasUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("StorageObjectUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("StorageObjectsUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("StorageObjectRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("StorageObjectsRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("PrismFightDefenderAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightDefenderLeaveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightAttackerAddMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightAttackerRemoveMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismsListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismsListUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismsInfoValidMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightAddedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightRemovedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismFightStateUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("PrismSettingsErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("UpdateMapPlayersAgressableStatusMessage", function(e) {
        window.gui.transmitMessage(e),
        window.actorManager.updateActorsAggressableStatus(e.playerIds, e.enable)
    }),
    n.on("UpdateSelfAgressableStatusMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("AlignmentRankUpdateMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("ShortcutBarContentMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ShortcutBarAddErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ShortcutBarRemoveErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ShortcutBarSwapErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ShortcutBarRefreshMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("ShortcutBarRemovedMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("ContactLookMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("TitlesAndOrnamentsListMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TitleGainedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TitleLostMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("OrnamentGainedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TitleSelectedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("TitleSelectErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("OrnamentSelectedMessage", function(e) {
        window.gui.transmitMessage(e)
    }),
    n.on("OrnamentSelectErrorMessage", function(e) {
        window.gui.transmitMessage(e)
    })
}
, function(e, t, i) {
    var n = i(49);
    n.on("ClientUIOpenedMessage", function(e) {
        window.gui.emit("ClientUIOpened", e)
    }),
    n.on("ClientUIOpenedByObjectMessage", function(e) {
        window.gui.emit("ClientUIOpened", e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("TrustStatusMessage", function(e) {
        n.sendMessage("CharactersListRequestMessage"),
        window.gui.transmitMessage(e)
    })
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(49);
    n.on("SystemMessageDisplayMessage", function(e) {
        window.gui.openSimplePopup(e.text, e.title),
        e.hangUp && (window.gui.disconnect(),
        window.isoEngine.disconnect())
    })
}
, function(e, t) {}
, function(e, t) {}
, function(e, t) {}
, function(e, t) {
    function i(e) {
        window.gui.transmitMessage({
            _messageType: "_tutorialGameMapMovementMessage",
            actorId: e.actorId
        })
    }
    function n() {
        window.gui.transmitMessage({
            _messageType: "_tutorialGameEntitiesDispositionMessage"
        })
    }
    t.setTutorialListeners = function(e) {
        e.on("GameMapMovementMessage", i),
        e.on("GameEntitiesDispositionMessage", n)
    }
    ,
    t.removeTutorialListeners = function(e) {
        e.removeListener("GameMapMovementMessage", i),
        e.removeListener("GameEntitiesDispositionMessage", n)
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        function n(e) {
            return e || 0 === e || (e = t),
            i(null , e)
        }
        function o(e) {
            return i(e)
        }
        var a = window.plugins && window.plugins.appPreferences;
        if (a)
            return a.fetch(n, o, e);
        var r;
        try {
            r = window.localStorage.getItem(e)
        } catch (l) {
            return s.setImmediate(function() {
                return o(l)
            })
        }
        return s.setImmediate(function() {
            return n(r)
        })
    }
    function o(e, t, i) {
        var n = window.plugins && window.plugins.appPreferences;
        if (n)
            return n.store(function() {
                i()
            }, i, t, e);
        try {
            window.localStorage.setItem(t, e)
        } catch (o) {
            return s.setImmediate(function() {
                return i(o)
            })
        }
        return s.setImmediate(i)
    }
    var s = i(12)
      , a = i(36)
      , r = "plugins.wizassets.assetsversion"
      , l = "client.main.staticdataversion"
      , c = "0.0.0"
      , u = "1";
    t.upgradeAssets = function(e, t) {
        function i(t) {
            function i() {
                return o(n, r, t)
            }
            var n = e.assetsVersion;
            if (!n)
                return t();
            var s = window.wizAssets;
            return s ? s.deleteFiles(e.changedFiles, i, t) : i()
        }
        function n(t) {
            var i = e.staticDataVersion;
            return i ? void a.eraseDiskCache(function(e) {
                return e ? t(e) : void o(i, l, function(e) {
                    return e ? t(e) : void a.initializeDiskCache(t)
                })
            }) : t()
        }
        return e.staticDataVersion || e.assetsVersion ? void s.series([n, i], function(e) {
            return e ? t(e) : t()
        }) : t()
    }
    ,
    t.getVersions = function(e) {
        function t(e, t, i, o) {
            n(t, i, function(t, i) {
                return t ? o(t) : (a[e] = i,
                o())
            })
        }
        function i(e) {
            return t("assetsVersion", r, c, e)
        }
        function o(e) {
            return t("staticDataVersion", l, u, e)
        }
        var a = {};
        s.series([o, i], function(t) {
            return t ? e("Could not get the client assets version: " + t) : e(null , a)
        })
    }
}
, function(e, t) {
    var i = !1;
    t.start = function() {
        if (window.powerManagement)
            return i ? console.warn("PowerManager already active") : void window.powerManagement.dim(function() {
                i = !0
            }, function(e) {
                console.warn("PowerManager failed to acquire wakelock", e)
            })
    }
    ,
    t.stop = function() {
        if (window.powerManagement)
            return i ? void window.powerManagement.release(function() {
                i = !1
            }, function(e) {
                console.warn("PowerManager failed to release wakelock", e)
            }) : console.warn("PowerManager was not active")
    }
}
, function(e, t) {
    function i(e, t) {
        function i() {
            if (!t)
                throw new Error("Final callback was already called");
            for (var i = 0; i < o.length; i += 1)
                e.removeListener(o[i].eventName, o[i].callback);
            o = null ;
            try {
                t.apply(e, arguments)
            } catch (n) {
                setTimeout(function() {
                    throw n
                }, 0)
            } finally {
                t = null
            }
        }
        function n() {
            function t() {
                try {
                    n.apply(e, arguments)
                } catch (t) {
                    i(t)
                }
            }
            var n = arguments[arguments.length - 1];
            if ("function" != typeof n)
                throw new TypeError("Final argument must be a callback function");
            for (var s = 0; s < arguments.length - 1; s += 1) {
                var a = arguments[s];
                e.on(a, t),
                o.push({
                    eventName: a,
                    callback: t
                })
            }
        }
        var o = [];
        return t = t || function() {}
        ,
        n.done = i,
        n
    }
    e.exports = i
}
, function(e, t, i) {
    i(159),
    e.exports = i(160)
}
, function(e, t, i) {
    var n = i(160)
      , o = i(180)
      , s = 0;
    n.logTutorialStepStart = function(e) {
        var t = o.STEP_START[e];
        t && (s = Date.now(),
        n.log(t))
    }
    ,
    n.logTutorialStepEnd = function(e) {
        var t = o.STEP_END[e];
        if (t) {
            var i = Math.ceil((Date.now() - s) / 1e3);
            s = 0,
            n.log(o.STEP_END[e], {
                time_spent_on_action: i
            })
        }
    }
    ,
    n.logTutorialSubStep = function(e, t) {
        var i = o.SUB_STEP[e];
        i && i[t] && n.log(i[t])
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        l.length > 50 && (console.error("The stackEvent exceed 50 events, the stack is trash"),
        l = []),
        l.push({
            name: e,
            data: t,
            options: i
        })
    }
    function o() {
        for (; l.length; ) {
            var e = l.shift();
            t.log(e.name, e.data, e.options)
        }
    }
    var s = i(161)
      , a = i(170)
      , r = i(176)
      , l = []
      , c = !1;
    t.init = function(e) {
        e = e || {};
        var t = e.wizAnalytics;
        for (var n in t) {
            var o = t[n];
            s.register(n, o.token, o.options)
        }
        a.init(e.ankAnalytics),
        i(177)
    }
    ,
    t.register = function(e, t, i) {
        a.register(t),
        s.freeze(e, i),
        c = !0,
        o()
    }
    ,
    t.unregister = function() {
        c = !1,
        a.unregister()
    }
    ,
    t.log = function(e, t, i) {
        return t = t || {},
        i = i || {},
        c ? (i.withPlayerInfo !== !1 && r.addCharacterInfo(t),
        i.withEquipment && r.addEquippedItem(t),
        s.send(e, t),
        void a.send(e, t)) : void n(e, t, i)
    }
}
, function(e, t, i) {
    function n(e, t, n) {
        try {
            var o = i(162)("./" + e + "/index.js");
            o.init(t, n),
            l.push(o)
        } catch (s) {
            console.error("Analytics Error: Initialization failed", e, s)
        }
    }
    function o(e, t) {
        for (var i = 0; i < l.length; i += 1) {
            var n = l[i];
            if (n.idendity)
                try {
                    n.idendity(e.valueOf())
                } catch (o) {
                    console.error("Analytics Error: couldn't set identity", n.name, o)
                }
            if (n.register)
                try {
                    n.register(t)
                } catch (o) {
                    console.error("Analytics Error: couldn't freeze data", n.name, o)
                }
        }
    }
    function s(e, t) {
        for (var i = 0; i < l.length; i += 1) {
            var n = l[i];
            try {
                n.log(e, t)
            } catch (o) {
                console.error("Analytics Error: couldn't log", e, n.name, o)
            }
        }
    }
    function a(e) {
        for (var t = 0; t < l.length; t += 1) {
            var i = l[t];
            if (i.screen)
                try {
                    i.screen(e)
                } catch (n) {
                    console.error("Analytics Error: not able to register the screen", i.name, n)
                }
        }
    }
    function r(e, t) {
        for (var i = 0; i < l.length; i += 1) {
            var n = l[i];
            if (n.revenue)
                try {
                    n.revenue(e, t)
                } catch (o) {
                    console.error("Analytics Error: couldn't log revenue", n.name, o)
                }
        }
    }
    var l = [];
    t.freeze = o,
    t.send = s,
    t.screen = a,
    t.revenue = r,
    t.register = n
}
, function(e, t, i) {
    function n(e) {
        return i(o(e))
    }
    function o(e) {
        return s[e] || function() {
            throw new Error("Cannot find module '" + e + "'.")
        }()
    }
    var s = {
        "./analog/index.js": 163,
        "./flurry/index.js": 164,
        "./localytics/index.js": 166,
        "./mixpanel/index.js": 168
    };
    n.keys = function() {
        return Object.keys(s)
    }
    ,
    n.resolve = o,
    e.exports = n,
    n.id = 162
}
, function(e, t) {
    t.name = "analog",
    t._basicData = {},
    t.init = function(e) {
        console.log("inititialized with: ", e)
    }
    ,
    t.idendity = function(e) {
        console.log("Freeze ID: ", e.valueOf())
    }
    ,
    t.register = function(e) {
        for (var i in e)
            t._basicData["_" + i] = e[i];
        console.log("Freeze data: ", e)
    }
    ,
    t.log = function(e, i) {
        i = i || {};
        for (var n in t._basicData)
            i[n] = i[n] || t._basicData[n];
        console.log("Logging", e, i)
    }
    ,
    t.screen = function(e) {
        console.log("Screen", e)
    }
    ,
    t.revenue = function(e) {
        console.log("Revenue", e)
    }
}
, function(e, t, i) {
    t.name = "flurry",
    t.init = function(e) {
        i(165),
        t._flurry = window.FlurryAgent,
        t._flurry.startSession(e)
    }
    ,
    t.idendity = function(e) {
        t._flurry.setUserId(e)
    }
    ,
    t.register = function(e) {
        t._basicData = e || {}
    }
    ,
    t.log = function(e, i) {
        i = i || {};
        for (var n in t._basicData)
            i[n] = i[n] || t._basicData[n];
        t._flurry.logEvent(e, i)
    }
    ,
    t.screen = function(e) {
        t._flurry.logEvent("screen", {
            view: e
        })
    }
}
, function(e, t) {
    !function() {
        function e(e) {
            throw e
        }
        function t(e, t) {
            function i() {
                this.constructor = e
            }
            for (var n in t)
                g.call(t, n) && (e[n] = t[n]);
            i.prototype = t.prototype,
            e.prototype = new i,
            e.wa = t.prototype
        }
        var i, n, o, s, a, r, l, c, u, h, d, p = !0, m = null , f = !1, g = {}.hasOwnProperty;
        i = function(e, t, i, n, o) {
            o == m && (o = d),
            o.n(e),
            o.l(e),
            o.N(e),
            o.o(t),
            o.z(t),
            o.p(t.length, 255),
            o.n(n),
            o.l(n),
            this.ce = e,
            this.bp = t,
            this.bq = n,
            i ? (o.Ua(i),
            this.bs = i) : this.bs = {}
        }
        ,
        n = function() {
            function e() {}
            return e.ia = function(e) {
                var t, i, n, o, s, a, r, l, c, e = this.Ob(e);
                for (r = "",
                n = l = 0,
                c = e.length; l < c; n = l += 3)
                    t = e.charCodeAt(n),
                    i = e.charCodeAt(n + 1),
                    n = e.charCodeAt(n + 2),
                    o = t >> 2,
                    t = (3 & t) << 4 | i >> 4,
                    s = (15 & i) << 2 | n >> 6,
                    a = 63 & n,
                    isNaN(i) ? s = a = 64 : isNaN(n) && (a = 64),
                    r += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(o) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a);
                return r
            }
            ,
            e.lb = function(e) {
                var t, i, n, o, s, a, r, l, e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                for (a = "",
                s = r = 0,
                l = e.length; r < l; s = r += 4)
                    t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(s)),
                    i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(s + 1)),
                    o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(s + 2)),
                    s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(s + 3)),
                    t = t << 2 | i >> 4,
                    i = (15 & i) << 4 | o >> 2,
                    n = (3 & o) << 6 | s,
                    a += String.fromCharCode(t),
                    64 !== o && (a += String.fromCharCode(i)),
                    64 !== s && (a += String.fromCharCode(n));
                return a = this.Nb(a)
            }
            ,
            e.Ob = function(e) {
                var t, i, n, o, e = e.replace(/\r\n/g, "\n");
                for (i = "",
                t = n = 0,
                o = e.length; 0 <= o ? n < o : n > o; t = 0 <= o ? ++n : --n)
                    t = e.charCodeAt(t),
                    t < 128 ? i += String.fromCharCode(t) : (t > 127 && t < 2048 ? i += String.fromCharCode(t >> 6 | 192) : (i += String.fromCharCode(t >> 12 | 224),
                    i += String.fromCharCode(t >> 6 & 63 | 128)),
                    i += String.fromCharCode(63 & t | 128));
                return i
            }
            ,
            e.Nb = function(e) {
                var t, i, n, o, s;
                for (s = "",
                o = 0; o < e.length; )
                    t = e.charCodeAt(o),
                    t < 128 ? (s += String.fromCharCode(t),
                    o++) : t > 191 && t < 224 ? (i = e.charCodeAt(o + 1),
                    s += String.fromCharCode((31 & t) << 6 | 63 & i),
                    o += 2) : (i = e.charCodeAt(o + 1),
                    n = e.charCodeAt(o + 2),
                    s += String.fromCharCode((15 & t) << 12 | (63 & i) << 6 | 63 & n),
                    o += 3);
                return s
            }
            ,
            e
        }(),
        o = function() {
            function e() {}
            return e.bb = function(e) {
                var t, i, n, o, s;
                for (t = 1,
                i = 0,
                n = o = 0,
                s = e.length; 0 <= s ? o < s : o > s; n = 0 <= s ? ++o : --o)
                    n = e.charCodeAt(n),
                    t += n,
                    i += t;
                return t %= 65521,
                i %= 65521,
                65536 * i + t
            }
            ,
            e
        }(),
        s = function(e) {
            function i(e, t, n, o, s, a) {
                a == m && (a = d),
                a.M(o),
                i.wa.constructor.call(this, e, t, n, s),
                this.timed = o,
                this.br = 0
            }
            return t(i, e),
            i
        }(i),
        a = function() {
            function t() {}
            var i;
            return i = function(e) {
                var t, i;
                i = {};
                try {
                    t = n.lb(e),
                    i = JSON.parse(t)
                } catch (o) {
                    console.log(o)
                }
                return i
            }
            ,
            t.ga = function(e, t) {
                return (t ? this.Da : "") + {
                    install: "fit",
                    session: "fs",
                    lastPoll: "flp",
                    firstPartyCookie: "fid"
                }[e]
            }
            ,
            t.i = p,
            t.appVersion = "",
            t.O = "",
            t.Ha = 0,
            t.ka = Date.now(),
            t.Da = m,
            t.F = m,
            t.Ka = p,
            t.Bb = p,
            t.Qa = f,
            t.Ea = f,
            t.localStorage = f,
            t.fa = m,
            t.Ja = "",
            t.referrer = "",
            t.J = 0,
            t.e = m,
            t.$ = [],
            t.w = m,
            t.Y = 5e3,
            t.ea = m,
            t.I = f,
            t.Z = m,
            t.h = function(e) {
                if (this.Qa)
                    return "string" == typeof e ? this.g("" + e) : this.g("" + e.name + "=>" + e.message)
            }
            ,
            t.g = function(e) {
                if (this.Ea)
                    return console.log("Flurry " + new Date + ": " + e)
            }
            ,
            t.Ub = function() {}
            ,
            t.ub = function() {
                return this.g("getFlurryAgentVersion() called"),
                9
            }
            ,
            t.da = function(e) {
                this.g("setAppVersion(" + e + ") called");
                try {
                    return d.o(e),
                    d.z(e),
                    d.p(e.length, 255),
                    this.appVersion = e,
                    this.e && this.e.da(e),
                    this.i = p
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.ua = function(e) {
                this.g("setUserId(" + e + ") called");
                try {
                    return d.j(this.e),
                    d.o(e),
                    d.z(e),
                    d.p(e.length, "userId"),
                    this.e.ua(e),
                    this.i = p
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.ra = function(e) {
                this.g("setGender(" + e + ") called");
                try {
                    return d.j(this.e),
                    d.o(e),
                    d.Ta(e, {
                        m: 1,
                        f: 0
                    }),
                    this.e.ra(e),
                    this.i = p
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.qa = function(e) {
                this.g("setAge(" + e + ") called");
                try {
                    return d.j(this.e),
                    d.n(e),
                    d.l(e),
                    d.N(e),
                    d.va(e),
                    this.e.qa(e),
                    this.i = p
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.sa = function(e, t, i) {
                i == m && (i = 0),
                this.g("setLocation(" + e + "," + t + "," + i + ") called");
                try {
                    return d.j(this.e),
                    d.n(e),
                    d.l(e),
                    d.n(t),
                    d.l(t),
                    d.n(i),
                    d.l(i),
                    this.e.sa(e, t, i),
                    this.i = p
                } catch (n) {
                    return this.h(n)
                }
            }
            ,
            t.mb = function() {
                this.Ja = navigator.platform
            }
            ,
            t.nb = function() {
                this.referrer = document.referrer
            }
            ,
            t.ib = function() {
                this.mb(),
                this.nb()
            }
            ,
            t.L = function(e) {
                this.g("setSessionContinueSeconds(" + e + ") called");
                try {
                    if (d.n(e),
                    d.l(e),
                    d.N(e),
                    d.va(e),
                    this.J = e,
                    this.e)
                        return this.e.L(e)
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.Jb = function(e) {
                this.g("setShowErrorInLogEnabled(" + e + ") called");
                try {
                    return d.M(e),
                    this.Qa = e
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.Gb = function(e) {
                this.g("setDebugLogEnabled(" + e + ") called");
                try {
                    return d.M(e),
                    this.Ea = e
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.Ib = function(e) {
                this.g("setLocalStorageEnabled(" + e + ") called");
                try {
                    d.M(e),
                    this.localStorage = e
                } catch (t) {
                    this.h(t)
                }
            }
            ,
            t.kb = function() {
                var e, t, i = this;
                t = window.onfocus,
                window.onfocus = function() {
                    if (i.g("ACTIVE"),
                    t != m && t(),
                    i.e)
                        return i.e.Ma() ? i.ta() : (i.A(),
                        i.Ra(i.O))
                }
                ,
                e = window.onblur,
                window.onblur = function() {
                    var t;
                    if (i.g("PAUSE"),
                    e != m && e(),
                    i.e && (t = Date.now(),
                    i.e.Pa(t),
                    i.Q(),
                    i.Bb))
                        return i.q()
                }
            }
            ,
            t.jb = function() {
                var e;
                (e = parseInt(this.G("install"))) ? this.ka = e : this.K("install", this.ka)
            }
            ,
            t.Ca = function() {
                var e;
                (e = this.G("firstPartyCookie", f)) ? this.F = e : this.F !== m && this.K("firstPartyCookie", this.F, f)
            }
            ,
            t.Fb = function() {
                this.Da = n.ia(this.O).replace("=", "") + "_"
            }
            ,
            t.G = function(e, t) {
                var i, n, o, s, a, r, l;
                for (t == m && (t = p),
                a = this.ga(e, t),
                n = document.cookie.split(";"),
                r = 0,
                l = n.length; r < l; r++)
                    if (i = n[r],
                    s = i.indexOf("="),
                    o = i.slice(0, s).trim(),
                    o === a)
                        return i.slice(s + 1);
                return m
            }
            ,
            t.eb = function() {
                return this.G("install") != m
            }
            ,
            t.ha = function(e) {
                var t;
                return t == m && (t = p),
                document.cookie = "" + this.ga(e, t) + "=; expires='Thu, 01 Jan 1970 00:00:00 GMT'; path=/"
            }
            ,
            t.K = function(e, t, i) {
                var n;
                i == m && (i = p),
                n = new Date,
                n.setTime(Date.now() + 31536e7),
                document.cookie = this.ga(e, i) + "=" + t + "; expires=" + n.toGMTString() + "; path=/"
            }
            ,
            t.ta = function(e) {
                var t = this;
                try {
                    e && d.va(1e3 * e - 5e3),
                    d.j(this.e)
                } catch (i) {
                    return void this.h(i)
                }
                return this.Q(),
                e && (this.Y = 1e3 * e),
                this.fa = window.setInterval(function() {
                    return t.ea = Date.now(),
                    t.K("lastPoll", t.ea),
                    t.q()
                }, this.Y),
                this.ea && Date.now() - this.ea > this.Y && this.q(),
                this.Y / 1e3
            }
            ,
            t.Q = function() {
                this.fa && window.clearInterval(this.fa),
                this.fa = m
            }
            ,
            t.$a = function() {
                var e, t, n;
                return t = this.G("session"),
                e = this.G("lastPoll"),
                this.ha("session"),
                this.ha("lastPoll"),
                t != m && e != m && (this.g("found paused session"),
                t = i(t),
                t[h.c.r] = e,
                e = new h(t),
                this.J && e.L(this.J),
                e.Ma() && (this.g("paused session resumed"),
                n = e)),
                n || (this.g("creating new session"),
                n = new h,
                this.J && n.L(this.J)),
                this.appVersion && n.da(this.appVersion),
                n
            }
            ,
            t.Ra = function(t) {
                this.g("startSession(" + t + ") called");
                try {
                    if (!this.e)
                        return d.o(t),
                        d.z(t),
                        d.p(t, 255),
                        this.O = t,
                        this.Fb(),
                        this.i = p,
                        this.e = this.$a(),
                        this.jb(),
                        this.Ca(),
                        this.eb() || (this.Ka = f,
                        this.A(),
                        e("CookieError=>session ending since cookies not enabled!")),
                        this.Ha || (this.ib(),
                        this.kb()),
                        this.ta(),
                        this.q(),
                        this.Ha++
                } catch (i) {
                    return this.h(i)
                }
            }
            ,
            t.A = function() {
                this.g("endSession() called");
                try {
                    if (this.Q(),
                    this.e)
                        return this.e.A(),
                        this.i = p,
                        this.Ka ? this.q() : this.$.push(this.e),
                        this.e = m,
                        this.ha("session")
                } catch (e) {
                    return this.h(e)
                }
            }
            ,
            t.yb = function() {
                this.g("pauseSession() called");
                try {
                    return this.Q(),
                    this.Na(),
                    this.e ? (this.q(),
                    this.e = m) : this.g("no session to pause!")
                } catch (e) {
                    return this.h(e)
                }
            }
            ,
            t.Na = function() {
                var e;
                try {
                    d.j(this.e),
                    e = Date.now(),
                    this.e.Pa(e),
                    this.Tb = e,
                    this.K("session", this.e.Ya()),
                    this.K("lastPoll", e)
                } catch (t) {
                    this.h(t)
                }
            }
            ,
            t.t = function(e, t, i) {
                t == m && (t = {}),
                i == m && (i = f),
                this.g("logEvent(" + e + "," + t + "," + i + ") called");
                try {
                    return d.j(this.e),
                    this.e.Wa(e, t, i),
                    this.i = p
                } catch (n) {
                    return this.h(n)
                }
            }
            ,
            t.qb = function(e, t) {
                t == m && (t = m),
                this.g("endTimedEvent(" + e + "," + t + ") called");
                try {
                    return d.j(this.e),
                    this.e.pb(e, t),
                    this.i = p
                } catch (i) {
                    return this.h(i)
                }
            }
            ,
            t.k = function() {
                var e, t, i, n, o;
                t = [];
                try {
                    for (d.j(this.e),
                    o = this.e[h.c.k],
                    i = 0,
                    n = o.length; i < n; i++)
                        e = o[i],
                        t.push(e.bp)
                } catch (s) {
                    this.h(s)
                }
                return t
            }
            ,
            t.Hb = function(e) {
                this.g("setEventLogging(" + e + ") called");
                try {
                    return d.j(this.e),
                    d.M(e),
                    this.e.ja = e
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.U = function(e, t, i, n) {
                t == m && (t = 0),
                i == m && (i = "USD"),
                n == m && (n = {}),
                this.g("logPurchase(" + e + "," + t + "," + i + "," + n + ") called");
                try {
                    return d.j(this.e),
                    this.e.Xa(e, t, i, n),
                    this.i = p
                } catch (o) {
                    return this.h(o)
                }
            }
            ,
            t.wb = function(e, t, i) {
                i == m && (i = 0),
                this.g("logError(" + e + "," + t + "," + i + ") called");
                try {
                    return d.j(this.e),
                    this.e.Va(e, t, i),
                    this.i = p
                } catch (n) {
                    return this.h(n)
                }
            }
            ,
            t.q = function() {
                var e;
                this.g("REQUEST INITIATED");
                try {
                    if (!this.I && (this.w ? this.w.Kb() : this.i && (e = new u,
                    e.Za(this.appVersion, this.O, this.ka, this.Ja, this.Rb, this.referrer, this.e, this.$, this.F),
                    this.w = e.request,
                    this.fb(e)),
                    this.w))
                        return this.Na(),
                        this.rb(JSON.stringify(this.w))
                } catch (t) {
                    return this.h(t)
                }
            }
            ,
            t.fb = function(e) {
                this.e.gb(e.sessionIncluded.events, e.sessionIncluded.purchases, e.sessionIncluded.errors),
                this.$ = this.$.slice(e.sessionsIncluded),
                0 === e.level && (this.i = f)
            }
            ,
            t.rb = function(e) {
                var t, i = this;
                return this.g("REQUEST EXECUTED"),
                this.I = p,
                this.Z = window.setInterval(function() {
                    return i.P(f)
                }, 1e4),
                t = document.createElement("script"),
                t.type = "text/javascript",
                t.async = p,
                t.src = encodeURI(c.Fa + "?d=" + n.ia(e) + "&c=" + o.bb(e)),
                e = document.getElementsByTagName("script"),
                e[0].parentNode.insertBefore(t, e[0])
            }
            ,
            t.Cb = function(t) {
                this.g("RESPONSE RECEIVED");
                try {
                    if (this.I || e("ResponseError=>request considered timed out!"),
                    "object" != typeof t && (this.P(f),
                    e("ResponseError=>input is not a valid object!")),
                    t.a != m && t.a > 0 ? this.P(p) : this.P(f),
                    t.b != m && this.Ib(t.b),
                    t.d != m && (this.F = t.d,
                    this.Ca(),
                    this.i = p),
                    this.i)
                        return this.q()
                } catch (i) {
                    return this.h(i)
                }
            }
            ,
            t.P = function(e) {
                if (this.g("CLEAR REQUEST with " + e),
                this.I)
                    return this.Z && window.clearInterval(this.Z),
                    e && (this.w = m),
                    this.I = f,
                    this.Z = m
            }
            ,
            t
        }(),
        window.FlurryAgent = a,
        a.setAppVersion = a.da,
        a.getFlurryAgentVersion = a.ub,
        a.setShowErrorInLogEnabled = a.Jb,
        a.setDebugLogEnabled = a.Gb,
        a.setSessionContinueSeconds = a.L,
        a.setRequestInterval = a.ta,
        a.startSession = a.Ra,
        a.endSession = a.A,
        a.pauseSession = a.yb,
        a.logEvent = a.t,
        a.endTimedEvent = a.qb,
        a.timedEvents = a.k,
        a.logError = a.wb,
        a.logPurchase = a.U,
        a.setUserId = a.ua,
        a.setAge = a.qa,
        a.setGender = a.ra,
        a.setLocation = a.sa,
        a.setEventLogging = a.Hb,
        a.requestCallback = a.Cb,
        r = function(e, t, i, n, o) {
            o == m && (o = d),
            o.n(e),
            o.l(e),
            o.N(e),
            o.o(t),
            o.z(t),
            o.p(t.length, 255),
            o.o(i),
            o.z(i),
            o.p(i.length, 255),
            o.n(n),
            o.l(n),
            o.N(n),
            this.cf = e,
            this.bz = t,
            this.ca = i,
            this.cb = n.toString(),
            this.cc = Date.now()
        }
        ,
        l = function(e) {
            function i(e, t, o, s, a, r, l) {
                l == m && (l = d),
                l.n(o),
                l.l(o),
                l.Qb(o),
                l.o(s),
                l.Ta(s, n),
                i.wa.constructor.call(this, e, t, a, r),
                this.bw = 100 * o,
                this.bx = n[s]
            }
            var n;
            return t(i, e),
            n = {
                USD: 0,
                EUR: 1,
                GBP: 2,
                CHF: 3
            },
            i
        }(i),
        c = function() {
            function e(n, o, s, a, r, l, c, u, d, p, f) {
                for (this.a = {},
                this.a.af = Date.now(),
                this.a.aa = t,
                this.a.ab = n,
                this.a.ac = o,
                this.a.ae = s,
                this.a.ad = a,
                this.a.ag = r,
                this.a.ah = d[h.c.timestamp],
                e.g("about to check if firstPartyCookieUID " + f + " should be assigned to global map in the report request"),
                f !== m && (this.a.cg = f,
                e.g("firstPartyCookieUID " + f + " was assigned to global map")),
                0 === d.requestsMade && (this.a.ai = l,
                this.a.aj = u,
                d.Db()),
                this.a.ak = i,
                this.b = [],
                d && (d.Oa(),
                s = e.za(d),
                this.b.push(s)),
                n = 0,
                o = p.length; n < o; n++)
                    s = p[n],
                    s = e.za(s),
                    this.b.push(s)
            }
            var t, i;
            return i = t = 1,
            e.Ab = {
                timedEvents: "timedEvents",
                eventLogging: "eventLogging",
                sessionContinue: "sessionContinue",
                pauseTimestamp: "pauseTimestamp",
                age: "age",
                numEventNames: "numEventNames",
                numPurchaseNames: "numPurchaseNames",
                requestsMade: "requestsMade",
                totalEventNames: "totalEventNames",
                totalPurchaseNames: "totalPurchaseNames",
                numEventsLogged: "numEventsLogged",
                numPurchasesLogged: "numPurchasesLogged",
                numErrorsLogged: "numErrorsLogged",
                eventCounter: "eventCounter",
                purchaseCounter: "purchaseCounter",
                errorCounter: "errorCounter"
            },
            e.zb = {
                timed: "timed"
            },
            e.Fa = "https://data.flurry.com/aah.do",
            e.g = function() {}
            ,
            e.Sb = function() {
                return this.Fa
            }
            ,
            e.hb = function(e) {
                var t, i, n;
                i = {};
                for (t in e)
                    n = e[t],
                    this.zb.hasOwnProperty(t) || (i[t] = n);
                return i
            }
            ,
            e.za = function(e) {
                var t, i, n, o, s, a;
                n = {};
                for (i in e)
                    if (o = e[i],
                    i === h.c.location)
                        o.bg != m && (n[i] = o);
                    else if (i === h.c.D)
                        for (n[i] = [],
                        s = 0,
                        a = o.length; s < a; s++)
                            t = o[s],
                            n[i].push(this.hb(t));
                    else
                        this.Ab.hasOwnProperty(i) || (n[i] = o);
                return n
            }
            ,
            e.prototype.Kb = function() {
                this.a.af = Date.now()
            }
            ,
            e
        }(),
        u = function() {
            function t() {
                this.sessionsIncluded = 0,
                this.sessionIncluded = {},
                this.request = {},
                this.level = 0
            }
            return t.g = function() {}
            ,
            t.prototype.Za = function(t, i, n, o, s, a, r, l, u) {
                for (this.request = new c(10,9,t,i,n,o,s,a,r,l,u),
                i = []; ; ) {
                    if (4 === this.level && e("RequestError=>request length is set too short!"),
                    t = JSON.stringify(this.request),
                    4 * t.length / 3 <= 3e3) {
                        this.sessionsIncluded = this.request.b.length - 1,
                        this.sessionIncluded.events = this.request.b[0].bo.length,
                        this.sessionIncluded.purchases = this.request.b[0].bv.length,
                        this.sessionIncluded.errors = this.request.b[0].by.length;
                        break
                    }
                    i.push(this.request = this.xb(this.request))
                }
            }
            ,
            t.prototype.xb = function(e) {
                switch (this.level) {
                case 0:
                    1 === e.b.length ? this.level = 1 : e.b = this.R(e.b);
                    break;
                case 1:
                    0 === e.b[0].by.length ? this.level = 2 : e.b[0].by = this.R(e.b[0].by);
                    break;
                case 2:
                    0 === e.b[0].bv.length ? this.level = 3 : e.b[0].bv = this.R(e.b[0].bv);
                    break;
                case 3:
                    0 === e.b[0].bo.length ? this.level = 4 : e.b[0].bo = this.R(e.b[0].bo)
                }
                return e
            }
            ,
            t.prototype.R = function(e) {
                var t;
                return e.length >= 1 && (t = parseInt(e.length / 2),
                e = e.slice(0, t)),
                e
            }
            ,
            t
        }(),
        h = function() {
            function t(e) {
                e == m && (e = {}),
                this[t.c.appVersion] = "",
                this[t.c.Sa] = "",
                this[t.c.Ga] = -1,
                this[t.c.xa] = 0,
                this[t.c.ya] = 0,
                this[t.c.location] = {},
                this[t.c.vb] = t.sb(),
                this[t.c.k] = e[t.c.k] || [],
                this[t.c.C] = e[t.c.C] || 0,
                this[t.c.D] = [],
                this[t.c.V] = 0,
                this[t.c.Aa] = f,
                this[t.c.T] = {},
                this[t.c.s] = {},
                this[t.c.ma] = 0,
                this[t.c.H] = e[t.c.H] || 0,
                this[t.c.X] = [],
                this[t.c.W] = 0,
                this[t.c.Ba] = f,
                this[t.c.oa] = {},
                this[t.c.v] = {},
                this[t.c.na] = 0,
                this[t.c.B] = e[t.c.B] || 0,
                this[t.c.S] = [],
                this[t.c.la] = 0,
                this[t.c.Ia] = 0,
                this.ba = e[t.c.timestamp] || Date.now(),
                this[t.c.duration] = 0,
                this[t.c.ja] = p,
                this[t.c.pa] = i,
                this[t.c.r] = e[t.c.r] || 0,
                this[t.c.u] = e[t.c.u] || -1,
                this[t.c.La] = 0,
                this[t.c.Lb] = t.tb()
            }
            var i;
            return t.c = {
                appVersion: "bd",
                Sa: "be",
                Ga: "bk",
                xa: "age",
                ya: "bl",
                location: "bf",
                vb: "bj",
                k: "timedEvents",
                C: "eventCounter",
                D: "bo",
                V: "numEventsLogged",
                Aa: "bm",
                T: "totalEventNames",
                s: "bn",
                ma: "numEventNames",
                H: "purchaseCounter",
                X: "bv",
                W: "numPurchasesLogged",
                Ba: "bt",
                oa: "totalPurchaseNames",
                v: "bu",
                na: "numPurchaseNames",
                B: "errorCounter",
                S: "by",
                la: "numErrorsLogged",
                Ia: "cd",
                timestamp: "ba",
                duration: "bb",
                ja: "eventLogging",
                pa: "sessionContinue",
                r: "pauseTimestamp",
                u: "bc",
                La: "requestsMade",
                Lb: "ch"
            },
            i = 3e5,
            t.sb = function() {
                var e;
                return e = "",
                navigator.language != m ? e = navigator.language : navigator.Mb != m && (e = navigator.Mb),
                e
            }
            ,
            t.tb = function() {
                var e;
                return e = (new Date).getTimezoneOffset() / 60,
                "Etc/GMT" + (e > 0 ? "+" : "-") + Math.abs(e)
            }
            ,
            t.prototype.Db = function() {
                this[t.c.La]++
            }
            ,
            t.prototype.da = function(e) {
                return this[t.c.appVersion] = e
            }
            ,
            t.prototype.ua = function(e) {
                return this[t.c.Sa] = e
            }
            ,
            t.prototype.ra = function(e) {
                return this[t.c.Ga] = "f" === e ? 0 : 1
            }
            ,
            t.prototype.qa = function(e) {
                return this.Eb(e),
                this[t.c.xa] = e
            }
            ,
            t.prototype.Eb = function(e) {
                var i;
                i = new Date,
                this[t.c.ya] = new Date(i.getFullYear() - e,i.getMonth(),1).getTime()
            }
            ,
            t.prototype.sa = function(e, i, n) {
                return this[t.c.location] = {
                    bg: e,
                    bh: i,
                    bi: n
                }
            }
            ,
            t.prototype.L = function(e) {
                return this[t.c.pa] = 1e3 * e
            }
            ,
            t.prototype.Oa = function() {
                this[t.c.duration] = Date.now() - this[t.c.timestamp]
            }
            ,
            t.prototype.gb = function(e, i, n) {
                this[t.c.D] = this[t.c.D].slice(e),
                this[t.c.s] = {},
                this[t.c.X] = this[t.c.X].slice(i),
                this[t.c.v] = {},
                this[t.c.S] = this[t.c.S].slice(n)
            }
            ,
            t.prototype.A = function() {
                if (this.ob(),
                this.Oa(),
                this[t.c.V] < 1e3 && (this[t.c.Aa] = f),
                this[t.c.W] < 100)
                    return this[t.c.Ba] = f
            }
            ,
            t.prototype.Pa = function(e) {
                this[t.c.r] = e
            }
            ,
            t.prototype.Ma = function() {
                var e;
                return e = this[t.c.r] > 0 ? Date.now() - this[t.c.r] : 0,
                e > 0 && (this[t.c.u] === -1 && (this[t.c.u] = 0),
                this[t.c.u] += e,
                this[t.c.r] = 0),
                e < this[t.c.pa]
            }
            ,
            t.prototype.Ya = function() {
                var e, i, o, s, a;
                for (e = {},
                o = [t.c.timestamp, t.c.u, t.c.C, t.c.H, t.c.B, t.c.k],
                s = 0,
                a = o.length; s < a; s++)
                    i = o[s],
                    e[i] = this[i];
                return n.ia(JSON.stringify(e))
            }
            ,
            t.prototype.t = function(e) {
                if (this[t.c.ja] && this[t.c.V] < 1e3)
                    return e.timed && !e.br ? this[t.c.k].push(e) : (this[t.c.D].push(e),
                    this[t.c.V]++)
            }
            ,
            t.prototype.Wa = function(i, n, o) {
                this[t.c.C]++,
                n = new s(this[t.c.C],i,n,o,Date.now() - this[t.c.timestamp]),
                i in this[t.c.T] ? (this[t.c.T][i]++,
                i in this[t.c.s] ? this[t.c.s][i]++ : this[t.c.s][i] = 1,
                this.t(n)) : this[t.c.ma] < 100 ? (this[t.c.T][i] = this[t.c.s][i] = 1,
                this[t.c.ma]++,
                this.t(n)) : e("LogError=>unique name limit reached!")
            }
            ,
            t.prototype.pb = function(e, i) {
                var n, o, s, a, r;
                for (o = 0,
                r = this[t.c.k],
                s = 0,
                a = r.length; s < a; s++) {
                    if (n = r[s],
                    n.bp === e) {
                        n.br = Date.now() - (this[t.c.timestamp] + n.bq),
                        i && d.Ua(i) && (n.bs = i),
                        this.t(n);
                        break
                    }
                    o++
                }
                this[t.c.k].splice(o, 1)
            }
            ,
            t.prototype.ob = function() {
                var e, i, n, o;
                for (o = this[t.c.k],
                i = 0,
                n = o.length; i < n; i++)
                    e = o[i],
                    e.br = Date.now() - (this[t.c.timestamp] + e.bq),
                    this.t(e);
                this[t.c.k] = []
            }
            ,
            t.prototype.U = function(e) {
                if (this[t.c.W] < 100)
                    return this[t.c.X].push(e),
                    this[t.c.W]++
            }
            ,
            t.prototype.Xa = function(i, n, o, s) {
                this[t.c.H]++,
                n = new l(this[t.c.H],i,n,o,s,Date.now() - this[t.c.timestamp]),
                i in this[t.c.oa] ? (this.totalPurchaseNames[i]++,
                i in this[t.c.v] ? this[t.c.v][i]++ : this[t.c.v][i] = 1,
                this.U(n)) : this[t.c.na] < 10 ? (this[t.c.oa][i] = this[t.c.v][i] = 1,
                this[t.c.na]++,
                this.U(n)) : e("PurchaseError=>unique name limit reached!")
            }
            ,
            t.prototype.Va = function(e, i, n) {
                this[t.c.B]++,
                e = new r(this[t.c.B],e,i,n),
                this[t.c.la] < 10 && (this[t.c.S].push(e),
                this[t.c.la]++),
                this[t.c.Ia]++
            }
            ,
            t
        }(),
        String.prototype.trim || (String.prototype.trim = function() {
            return this.replace(/^\s+|\s+$/g, "")
        }
        ),
        d = function() {
            function t() {}
            return t.M = function(t) {
                "boolean" != typeof t && e("ValidationError=>input is not valid!")
            }
            ,
            t.n = function(t) {
                "number" != typeof t && e("ValidationError=>input is not valid!")
            }
            ,
            t.o = function(t) {
                "string" != typeof t && e("ValidationError=>input is not valid!")
            }
            ,
            t.Pb = function(t) {
                "object" != typeof t && e("ValidationError=>input is not valid!")
            }
            ,
            t.N = function(t) {
                t !== parseInt(t) && e("ValidationError=>input is not valid!")
            }
            ,
            t.z = function(t) {
                t.trim() || e("ValidationError=>input is not valid!")
            }
            ,
            t.p = function(t, i) {
                t > i && e("ValidationError=>input is not valid!")
            }
            ,
            t.l = function(t) {
                isNaN(t) && e("ValidationError=>input is not valid!")
            }
            ,
            t.Qb = function(t) {
                t === parseInt(t) || t.toFixed(2) === t.toString() || t.toFixed(1) === t.toString() || e("ValidationError=>input is not valid!")
            }
            ,
            t.Ta = function(t, i) {
                i.hasOwnProperty(t) || e("ValidationError=>input is not valid!")
            }
            ,
            t.va = function(t) {
                t < 0 && e("ValidationError=>input is not valid!")
            }
            ,
            t.j = function(t) {
                t || e("ValidationError=>input does not exist!")
            }
            ,
            t.Ua = function(e) {
                var t, i, n;
                this.Pb(e),
                i = 1;
                for (t in e)
                    n = e[t],
                    this.o(t),
                    this.p(t.length, 255),
                    this.o(n),
                    this.p(n.length, 255),
                    this.p(i, 10),
                    i++;
                return p
            }
            ,
            t
        }()
    }()
}
, function(e, t, i) {
    t.name = "localytics";
    var n;
    t.init = function(e, o) {
        var s = i(167);
        o = o || {},
        o.useCustomerId = !0,
        o.sessionTimeoutSeconds = o.sessionTimeoutSeconds || !1,
        o.polling = o.polling || 0,
        t._localyticsSession = s(e, o),
        n = o.defaultDimension,
        t._localyticsSession.open(),
        t._localyticsSession.upload()
    }
    ,
    t.idendity = function(e) {
        t._localyticsSession.setCustomerId(e)
    }
    ,
    t.register = function(e) {
        for (var i in e)
            t._localyticsSession.setIdentifier("customer_" + i, e[i])
    }
    ;
    var o = null ;
    t.log = function(e, i) {
        t._localyticsSession.tagEvent(e, i, n),
        o || (o = window.setTimeout(function() {
            t._localyticsSession.upload(),
            o = null
        }, 1e3))
    }
    ,
    t.screen = function(e) {
        t._localyticsSession.tagScreen(e)
    }
    ,
    t.revenue = function(e, i) {
        t._localyticsSession.tagEvent("revenue", {
            price: e
        }, i, e),
        t._localyticsSession.upload()
    }
}
, function(e, t) {
    /*!
	 * Localytics HTML5/JavaScript Library
	 * Copyright (C) 2013 Char Software Inc., DBA Localytics
	 *
	 * This code is provided under the Localytics Modified BSD License.
	 * A copy of this license is available at
	 * http://www.localytics.com/docs/opensourceinfo/#license-documentation
	 *
	 * Please visit www.localytics.com for more information.
	 */
    var i = function(e, t) {
        var i = function(e) {}
          , n = function() {
            return console && console.log ? function(e) {
                console.log(e)
            }
            : i
        }()
          , o = i
          , s = {}
          , a = {};
        s.setItem = function(e, t) {
            try {
                window.localStorage.setItem(e, t)
            } catch (i) {
                o("setItem failed by exception.")
            }
            a[e] = t.toString()
        }
        ,
        s.getItem = function(e) {
            var t = null ;
            try {
                t = window.localStorage.getItem(e)
            } catch (i) {
                o("getItem failed by exception.")
            }
            return a.hasOwnProperty(e) ? t || a[e] : t
        }
        ,
        s.removeItem = function(e) {
            try {
                window.localStorage.removeItem(e)
            } catch (t) {
                o("removeItem failed by exception.")
            }
            delete a[e]
        }
        ,
        t = t ? t : {};
        var r = null == t.namespace ? "" : t.namespace + "_";
        return function(a, l) {
            var c, u, h, d, p, m, f, g, _, v, y, w, b, C, I, T, S, A, E, x = 'window.__localytics_callbacks__["' + r + '"]', M = "html5_2.6", N = 16e3, R = ["open", "close", "tagEvent", "tagScreen", "tagEvent", "upload", "setIdentifier", "setCustomerEmail", "setCustomerId", "setCustomerName"], O = 30, P = 1e4, D = 3e4, L = 500, B = !1, k = 1e4, F = {}, H = "__ll_" + r + "iu", G = "__ll_" + r + "es", U = "__ll_" + r + "ch", j = "__ll_" + r + "pa", q = "__ll_" + r + "csu", W = "__ll_" + r + "cst", V = "__ll_" + r + "csi", z = "__ll_" + r + "csq", Y = "__ll_" + r + "cso", X = "__ll_" + r + "ub", Q = "__ll_" + r + "lot", K = "__ll_" + r + "lct", J = "__ll_" + r + "chs", Z = "__ll_" + r + "fl", $ = "__ll_" + r + "cd", ee = "__ll_" + r + "ids", te = [H, G, U, j, q, W, V, z, Y, X, K, J, Z, $, ee], ie = /loaded|complete/;
            F._switchLogger = function(e) {
                o = e ? n : i
            }
            ;
            var ne = navigator.userAgent
              , oe = function() {
                return "undefined" != typeof WinJS && "function" == typeof WinJS.xhr
            }();
            F._getStore = function(e, t) {
                if (s) {
                    var i, n = s.getItem(e);
                    if (null != n)
                        try {
                            i = t ? JSON.parse(n) : n
                        } catch (a) {
                            o("Error parsing JSON from localStorage." + e)
                        }
                    return i
                }
            }
            ;
            var se = function(e) {
                var t = (F._getStore(J, !1) || "").length
                  , i = ("" + e).length
                  , n = i - t;
                e += n;
                try {
                    return s.setItem(J, e),
                    I = e,
                    e
                } catch (o) {
                    return l
                }
            }
              , ae = function() {
                I = ue(),
                se(I)
            };
            F._writeStore = function(e, t) {
                if (s) {
                    var i, n, a, r, c;
                    I === l && (I = F._getStore(J, !0),
                    I || ae()),
                    i = F._getStore(e, !1),
                    i = i ? i.length : 0;
                    try {
                        if (null == t)
                            se(I - i),
                            s.removeItem(e);
                        else if (r = JSON.stringify(t),
                        n = r.length,
                        a = n - i)
                            if (c = I + a,
                            a < 0) {
                                if (se(c) === l)
                                    return o("Write aborted: delta was negative, but unable to update storage"),
                                    l;
                                s.setItem(e, r)
                            } else {
                                if (c += ("" + c).length - ("" + I).length,
                                !(c < k && se(c) !== l))
                                    return o("Write aborted: writing would exceed storage limits"),
                                    l;
                                s.setItem(e, r)
                            }
                        else
                            s.setItem(e, r);
                        return t
                    } catch (u) {
                        return o("Write to localStorage failed by exception."),
                        l
                    }
                }
            }
            ;
            var re = function(e) {
                d || (o("No event store found, searching localStorage"),
                d = F._getStore(G, !0),
                d || (o("No event storage in localStorage found, creating an empty array"),
                d = [])),
                o("Pushing event to event store"),
                d.push(e),
                F._writeStore(G, d)
            }
              , le = function(t) {
                var i = "http:" + F.__url__ + "api/v2/applications/" + encodeURIComponent(e) + "/uploads";
                WinJS.xhr({
                    url: i,
                    type: "POST",
                    data: t,
                    headers: {
                        "Content-Type": "application/json",
                        "x-upload-time": de()
                    }
                }).done(ke, ke)
            }
              , ce = function(t) {
                var i = document.createElement("script")
                  , n = document.head || document.getElementsByTagName("head")[0] || document.documentElement
                  , s = "http:" + F.__url__ + "api/v2/applications/" + encodeURIComponent(e) + "/uploads?callback=" + x + "&client_date=" + de() + "&data=" + encodeURIComponent(t);
                return o("Uploading blob: \n" + t),
                o("Request length: " + s.length),
                s.length > N ? (o("Upload length exceeds maximum supported length.  Deleting data without uploading."),
                void F._clearStoredUploads()) : (i.async = "async",
                i.src = s,
                i.onload = function() {
                    i.readyState && !ie.test(i.readyState) || (o("Unloading script tag from header"),
                    i.onload = null ,
                    n && i.parentNode && n.removeChild(i),
                    i = l)
                }
                ,
                void n.insertBefore(i, n.firstChild))
            };
            F._send = function() {
                return oe ? function(e) {
                    le(e)
                }
                : function(e) {
                    ce(e)
                }
            }();
            var ue = function() {
                var e, t, i, n = 0;
                for (e = 0,
                t = te.length; e < t; e += 1)
                    i = F._getStore(te[e], !1),
                    i && i.length && (n += i.length);
                return n
            }
              , he = function() {
                var e = function() {
                    return (65536 * (1 + Math.random()) | 0).toString(16).substring(1)
                };
                return e() + e() + "-" + e() + "-" + e() + "-" + e() + "-" + e() + e() + e()
            }
              , de = function() {
                return (new Date).getTime() / 1e3 | 0
            }
              , pe = function() {
                return (new Date).getTime()
            }
              , me = function() {
                return !1
            }
              , fe = function() {
                return []
            }
              , ge = function() {
                return ""
            }
              , _e = function() {
                return 0
            }
              , ve = function() {
                return {}
            };
            F._getOrCreateProperty = function(e, t, i, n) {
                return n ? (e = i(),
                F._writeStore(t, e)) : null == e && (e = F._getStore(t, !0),
                e || (e = i(),
                F._writeStore(t, e))),
                e
            }
            ;
            var ye = function() {
                var e = F._getStore(ee, !0);
                return null == e && (o("No identifiers in localStorage found, creating an empty map"),
                e = ve()),
                e
            }
              , we = function() {
                return t.useCustomerId ? "" : he()
            }
              , be = function() {
                return h = F._getOrCreateProperty(h, H, we, !1)
            }
              , Ce = function(e) {
                return f = F._getOrCreateProperty(f, q, he, e)
            }
              , Ie = function(e) {
                return g = F._getOrCreateProperty(g, W, de, e)
            }
              , Te = function() {
                return m = F._getOrCreateProperty(m, j, de, !1)
            };
            F._getSessionIndex = function() {
                return _ = F._getOrCreateProperty(_, V, _e, !1)
            }
            ;
            var Se = function() {
                return F._getSessionIndex(),
                _ += 1,
                F._writeStore(V, _),
                _
            }
              , Ae = function() {
                return v = F._getOrCreateProperty(v, z, _e, !1),
                v += 1,
                F._writeStore(z, v),
                v
            }
              , Ee = function() {
                return y = F._getOrCreateProperty(y, Y, me, !1)
            };
            F._getOSVersion = function(e) {
                var t, i, n, o, s, a, r = e.split(/[)]?\s[(]?/), l = r.length, c = r[1];
                if (e.match(/iPhone|iPad|iPod/))
                    o = e.match(/OS (\d+)\D(\d+)/),
                    o && 3 === o.length && (n = "iOS " + o[1] + "." + o[2]);
                else if (c && c.match(/Macintosh/)) {
                    for (t = 2; t < l; t++)
                        if ("OS" == r[t]) {
                            var u = t - 1
                              , h = t + 2;
                            for (i = t - 1; i > 1; i--)
                                if (";" === r[i].substr(-1) || "Intel" === r[i] || "CPU" === r[i]) {
                                    u = i + 1;
                                    break
                                }
                            for (i = t + 1; i < t + 4; i++) {
                                if (";" === r[i].substr(-1)) {
                                    h = i;
                                    break
                                }
                                if ("like" === r[i]) {
                                    h = i - 1;
                                    break
                                }
                            }
                            n = r.splice(u, h - (u - 1)).join(" "),
                            n = n.replace(";", "").replace("_", ".").replace(/_\d$/, "").replace("Mac ", "");
                            break
                        }
                } else
                    /^Android/.test(r[3]) ? n = (r[3] + " " + r[4]).replace(";", "") : (o = e.match(/Windows NT (\d)\.(\d)/)) ? o.length > 2 && (s = o[1],
                    a = o[2],
                    "6" === s && "2" === a ? n = "Windows 8" : "6" === s && "1" === a ? n = "Windows 7" : "6" === s && "0" === a ? n = "Windows Vista" : "5" === s && "1" === a ? n = "Windows XP" : "5" === s && "0" === a ? n = "Windows 2000" : "5" === s && "2" === a && (n = "Windows Server 2003")) : e.match(/SymbOS/) ? n = "SymbOS" : e.match(/BlackBerry/) && (o = e.match(/Version\/(\d+)\./)) && (n = "BlackBerry " + o[1]);
                return n
            }
            ,
            F._generateHeader = function() {
                o("Generating a new header");
                var t, i = (navigator.language || navigator.userLanguage || "").toUpperCase();
                if (i)
                    if (i.match(/-/)) {
                        var n = i.split(/-/);
                        i = n[0],
                        t = n[1]
                    } else
                        t = ne.match(new RegExp("^.*?\\(.*?" + i + "-(\\w\\w).*?\\).*?$","i")),
                        t = t && t[1];
                var s = navigator.platform
                  , a = navigator.vendor
                  , r = navigator.platform
                  , l = {
                    dt: "h",
                    pa: Te(),
                    seq: Ae(),
                    u: he()
                }
                  , h = {
                    dt: "a",
                    au: e,
                    iu: be(),
                    lv: M,
                    ua: ne
                };
                r && (h.dmo = r),
                s && (h.dp = s),
                i && (h.dll = i);
                var d = F._getOSVersion(ne);
                return d && (h.dov = d),
                c && (h.av = c),
                u && (h.nc = u),
                t && (h.dc = t.toUpperCase()),
                a && (h.dma = a),
                l.attrs = h,
                0 == Fe(ye()) && (l.ids = ye()),
                l
            }
            ;
            var xe = function(e) {
                return p = F._getOrCreateProperty(p, U, F._generateHeader, e)
            }
              , Me = function() {
                A ? o("Already polling.") : (o("Beginning to poll for closes"),
                A = a.setTimeout(Re, P))
            }
              , Ne = function() {
                A ? (o("Stopping close polling"),
                a.clearTimeout(A),
                A = null ) : o("No polling to stop")
            }
              , Re = function() {
                F._markNewClose(),
                A = a.setTimeout(Re, P)
            };
            F._markNewClose = function() {
                return o("Marking a new close."),
                b = pe(),
                F._writeStore(K, b)
            }
            ;
            var Oe = function() {
                b = F._getOrCreateProperty(b, K, pe, !1),
                T = F._getOrCreateProperty(T, Z, fe, !1);
                var e = b / 1e3 | 0
                  , t = Ie()
                  , i = e - t
                  , n = {
                    dt: "c",
                    u: he(),
                    ss: t,
                    su: Ce(),
                    ct: e,
                    ctl: i,
                    cta: i
                };
                return T.length > 0 && (n.fl = T),
                Le(n, F._getOrCreateProperty(S, $, fe, !1)),
                n
            }
              , Pe = function() {
                o("Finalizing close with last polled close"),
                Ne(),
                re(Oe()),
                T = [],
                F._writeStore(Z, T),
                F._writeStore(Y, !1)
            };
            F._finalizeClose = Pe,
            F._clearStoredUploads = function() {
                w = null ,
                F._writeStore(X, w)
            }
            ;
            var De = function(e) {
                var t;
                if (null != e.polling && (P = e.polling ? +e.polling : 0),
                e.uploadTimeout && (D = e.uploadTimeout),
                e.screenLimit && (L = e.screenLimit),
                e.appVersion)
                    c = "" + e.appVersion;
                else if (e.version)
                    o("'version' is deprecated, please use 'appVersion' instead."),
                    c = "" + e.version;
                else if ("undefined" != typeof Windows)
                    try {
                        t = Windows.ApplicationModel.Package.current.id.version,
                        c = [t.major, t.minor, t.build, t.revision].join(".")
                    } catch (i) {}
                e.carrier && (u = "" + e.carrier),
                null != e.sessionTimeoutSeconds ? O = e.sessionTimeoutSeconds ? +e.sessionTimeoutSeconds : 0 : null != e.timeout && (o("'timeout' is deprecated, please use 'sessionTimeoutSeconds' instead."),
                O = e.timeout ? +e.timeout / 1e3 : 0),
                null != e.storage && (k = e.storage ? +e.storage : 0),
                null != e.logger && (B = !!e.logger),
                F._switchLogger(B),
                ae(),
                oe || (a.__localytics_callbacks__ = a.__localytics_callbacks__ || {},
                a.__localytics_callbacks__[r] = ke),
                xe(!0),
                o("LocalyticsSession successfully initialized")
            }
              , Le = function(e, t) {
                var i;
                if (t && Be(t))
                    for (i = 0; i < 4; i += 1)
                        t[i] && (e["c" + i] = "" + t[i])
            }
              , Be = Array.isArray || function(e) {
                return "[object Array]" === Object.prototype.toString.call(e)
            }
            ;
            F._open = function(e) {
                var t;
                if (b = F._getStore(K, !0) || 0,
                pe() - b < 1e3 * O)
                    o("Open called within timeout, resuming last session.");
                else {
                    Ee() && Pe(),
                    Se();
                    var i = Ie(!0);
                    if (t = {
                        dt: "s",
                        ct: i,
                        u: Ce(!0),
                        nth: F._getSessionIndex()
                    },
                    C = C || F._getStore(Q, !0) || 0,
                    C && 0 != C) {
                        var n = i - C;
                        n >= 1 && (t.sl = Math.round(n))
                    }
                    C = F._writeStore(Q, i),
                    e && (S = F._writeStore($, e.slice(0)),
                    Le(t, e)),
                    re(t)
                }
                y = !0,
                F._writeStore(Y, y),
                o("Appended open tag to event store"),
                P ? Me() : o("Polling timeout was set to 0; no close polling will be done.")
            }
            ,
            F._tagEvent = function(e, t, i, n) {
                if (!Ee())
                    return void o("Cannot tag event: either no session was opened, or it was already closed");
                isNaN(n) ? (o("Customer value increase not a number, setting to 0."),
                n = 0) : parseFloat(n) != parseInt(n) && o("Customer value increase passed as floating point number.");
                var s, a, r = {
                    dt: "e",
                    ct: de(),
                    u: he(),
                    su: Ce(),
                    n: "" + e,
                    v: n
                };
                if (!i && Be(t) && (i = t,
                t = null ),
                t) {
                    a = {};
                    for (s in t)
                        t.hasOwnProperty(s) && (a[s] = "" + t[s]);
                    r.attrs = a
                }
                Le(r, i),
                re(r),
                o("Tagged event: '" + e + "' with attributes (JSON): '" + JSON.stringify(a) + "'")
            }
            ,
            F._tagScreen = function(e) {
                if (!Ee())
                    return void o("Cannot tag screen: either no session was opened, or it was already closed");
                T = F._getOrCreateProperty(T, Z, fe, !1);
                var t = T.length || 0
                  , i = "" + e;
                t < L && T[t - 1] !== i && (T.push(i),
                F._writeStore(Z, T))
            }
            ,
            F._close = function() {
                return Ee() ? (Ne(),
                void F._markNewClose()) : void o("Cannot close session: either no session was opened, or it was already closed")
            }
            ,
            F._upload = function() {
                if (null != E && pe() - E < D)
                    return void o("Upload in progress, returning");
                if (d = F._getOrCreateProperty(d, G, fe, !1),
                w = F._getOrCreateProperty(w, X, ge, !1),
                !(d && 0 !== d.length || w))
                    return void o("Nothing to upload, returning.");
                var e, t, i = d.splice(0), n = "";
                for (i.unshift(xe(!1)),
                e = 0,
                t = i.length; e < t; e += 1)
                    n += JSON.stringify(i[e]) + "\n";
                w += n,
                F._writeStore(X, w),
                d = null ,
                F._writeStore(G, d),
                F._send(w),
                E = pe(),
                xe(!0)
            }
            ;
            var ke = function(e) {
                var t = +(e.response_code || e.status);
                E = null ,
                o("Callback called with response:"),
                t && (o("Response code: " + t),
                202 === t || 200 === t ? (o("Upload succeeded, clearing uploaded items."),
                F._clearStoredUploads()) : t >= 400 && t > 500 ? (o("Response was 4XX, clearing items"),
                F._clearStoredUploads()) : e.message && (o("Upload failed with message:"),
                o(e.message)))
            }
              , Fe = function(e) {
                for (var t in e)
                    if (e.hasOwnProperty(t))
                        return !1;
                return !0
            }
              , He = function(e, t) {
                e += "",
                t += "";
                var i = ye();
                o("Adding identifier:" + e + " to identifiers map"),
                i[e] = t,
                F._writeStore(ee, i)
            }
              , Ge = function(e) {
                e += "";
                var t = ye();
                o("Deleting value for key:" + e),
                delete t[e],
                F._writeStore(ee, t)
            };
            F._setIdentifier = function(e, t) {
                null != e && 0 != e.length && (null == t ? Ge(e) : 0 == t.length ? Ge(e) : He(e, t))
            }
            ,
            F._setCustomerName = function(e) {
                F.setIdentifier("customer_name", e)
            }
            ,
            F._setCustomerId = function(e) {
                F.setIdentifier("customer_id", e),
                t.useCustomerId && (h = e,
                F._writeStore(H, h),
                xe(!0))
            }
            ,
            F._setCustomerEmail = function(e) {
                F.setIdentifier("customer_email", e)
            }
            ,
            F.__url__ = "//analytics.localytics.com/";
            var Ue = function(e, t) {
                console.log("> Call to Localytics client library failed ."),
                console.log("> localyticsSession." + e + " failed ."),
                console.log("> " + t),
                console.log(t);
                for (var e in R)
                    F[e] = i
            };
            return function() {
                var e, i, n = R.length;
                for (e = 0; e < n; e++)
                    i = R[e],
                    F[i] = function(e) {
                        return function() {
                            try {
                                F["_" + e].apply(F, arguments)
                            } catch (t) {
                                Ue(e, t)
                            }
                        }
                    }(i);
                De(t)
            }(),
            F
        }(window)
    };
    e.exports = i
}
, function(e, t, i) {
    t.name = "mixpanel",
    t._mixpanel = window.mixpanel = [],
    t._mixpanel.__SV = 1.2,
    t.init = function(e, n) {
        i(169),
        window.mixpanel.init(e, n),
        t._mixpanel = window.mixpanel
    }
    ,
    t.idendity = function(e) {
        t._mixpanel.identify(e),
        t._mixpanel.people.set_once("firstLogin", new Date),
        t._mixpanel.people.set("lastLogin", new Date),
        t._mixpanel.people.increment("nbLogin")
    }
    ,
    t.register = function(e) {
        e.name && (t._mixpanel.people.set("$name", e.name),
        t._mixpanel.name_tag(e.name)),
        t._mixpanel.register(e),
        t._mixpanel.people.set(e)
    }
    ,
    t.log = function(e, i) {
        t._mixpanel.track(e, i)
    }
    ,
    t.screen = function(e) {
        t._mixpanel.track_pageview(e)
    }
    ,
    t.revenue = function(e, i) {
        i = i || {},
        i.$time = new Date,
        t._mixpanel.people.track_charge(e, i)
    }
}
, function(e, t) {
    !function(e) {
        function t() {
            t.done || (t.done = !0,
            R = !0,
            E = !1,
            x.each(G, function(e) {
                e._dom_loaded()
            }))
        }
        function i() {
            try {
                u.documentElement.doScroll("left")
            } catch (e) {
                return void setTimeout(i, 1)
            }
            t()
        }
        var n = Array.prototype
          , o = Object.prototype
          , s = n.slice
          , a = o.toString
          , r = o.hasOwnProperty
          , l = window.console
          , c = window.navigator
          , u = window.document
          , h = c.userAgent
          , d = "mixpanel"
          , p = "__mps"
          , m = "__mpso"
          , f = "__mpa"
          , g = "__mpap"
          , _ = "$set"
          , v = "$set_once"
          , y = "$add"
          , w = "$append"
          , b = "$people_distinct_id"
          , C = "__alias"
          , I = [p, m, f, g, b, C]
          , T = "https:" == u.location.protocol ? "https://" : "http://"
          , S = e && e.__SV || 0
          , A = window.XMLHttpRequest && "withCredentials"in new XMLHttpRequest
          , E = !A && h.indexOf("MSIE") == -1
          , x = {}
          , M = !1
          , N = {
            api_host: T + "api.mixpanel.com",
            cross_subdomain_cookie: !0,
            cookie_name: "",
            loaded: function() {},
            store_google: !0,
            save_referrer: !0,
            test: !1,
            verbose: !1,
            img: !1,
            track_pageview: !0,
            debug: !1,
            track_links_timeout: 300,
            cookie_expiration: 365,
            upgrade: !1,
            disable_cookie: !1,
            secure_cookie: !1,
            ip: !0
        }
          , R = !1;
        !function() {
            var e = n.forEach
              , t = n.indexOf
              , i = Array.isArray
              , o = {}
              , l = x.each = function(t, i, n) {
                if (null != t)
                    if (e && t.forEach === e)
                        t.forEach(i, n);
                    else if (t.length === +t.length) {
                        for (var s = 0, a = t.length; s < a; s++)
                            if (s in t && i.call(n, t[s], s, t) === o)
                                return
                    } else
                        for (var l in t)
                            if (r.call(t, l) && i.call(n, t[l], l, t) === o)
                                return
            }
            ;
            x.extend = function(e) {
                return l(s.call(arguments, 1), function(t) {
                    for (var i in t)
                        void 0 !== t[i] && (e[i] = t[i])
                }),
                e
            }
            ,
            x.isArray = i || function(e) {
                return "[object Array]" === a.call(e)
            }
            ,
            x.isFunction = function(e) {
                try {
                    return /^\s*\bfunction\b/.test(e)
                } catch (t) {
                    return !1
                }
            }
            ,
            x.isArguments = function(e) {
                return !(!e || !r.call(e, "callee"))
            }
            ,
            x.toArray = function(e) {
                return e ? e.toArray ? e.toArray() : x.isArray(e) ? s.call(e) : x.isArguments(e) ? s.call(e) : x.values(e) : []
            }
            ,
            x.values = function(e) {
                var t = [];
                return null == e ? t : (l(e, function(e) {
                    t[t.length] = e
                }),
                t)
            }
            ,
            x.identity = function(e) {
                return e
            }
            ,
            x.include = function(e, i) {
                var n = !1;
                return null == e ? n : t && e.indexOf === t ? e.indexOf(i) != -1 : (l(e, function(e) {
                    if (n || (n = e === i))
                        return o
                }),
                n)
            }
            ,
            x.includes = function(e, t) {
                return e.indexOf(t) !== -1
            }
        }(),
        x.inherit = function(e, t) {
            return e.prototype = new t,
            e.prototype.constructor = e,
            e.superclass = t.prototype,
            e
        }
        ,
        x.isObject = function(e) {
            return e === Object(e) && !x.isArray(e)
        }
        ,
        x.isEmptyObject = function(e) {
            if (x.isObject(e)) {
                for (var t in e)
                    if (r.call(e, t))
                        return !1;
                return !0
            }
            return !1
        }
        ,
        x.isUndefined = function(e) {
            return void 0 === e
        }
        ,
        x.isString = function(e) {
            return "[object String]" == a.call(e)
        }
        ,
        x.isDate = function(e) {
            return "[object Date]" == a.call(e)
        }
        ,
        x.isNumber = function(e) {
            return "[object Number]" == a.call(e)
        }
        ,
        x.encodeDates = function(e) {
            return x.each(e, function(t, i) {
                x.isDate(t) ? e[i] = x.formatDate(t) : x.isObject(t) && (e[i] = x.encodeDates(t))
            }),
            e
        }
        ,
        x.formatDate = function(e) {
            function t(e) {
                return e < 10 ? "0" + e : e
            }
            return e.getUTCFullYear() + "-" + t(e.getUTCMonth() + 1) + "-" + t(e.getUTCDate()) + "T" + t(e.getUTCHours()) + ":" + t(e.getUTCMinutes()) + ":" + t(e.getUTCSeconds())
        }
        ,
        x.strip_empty_properties = function(e) {
            var t = {};
            return x.each(e, function(e, i) {
                x.isString(e) && e.length > 0 && (t[i] = e)
            }),
            t
        }
        ,
        x.truncate = function(e, t) {
            var i;
            return "string" == typeof e ? i = e.slice(0, t) : x.isArray(e) ? (i = [],
            x.each(e, function(e) {
                i.push(x.truncate(e, t))
            })) : x.isObject(e) ? (i = {},
            x.each(e, function(e, n) {
                i[n] = x.truncate(e, t)
            })) : i = e,
            i
        }
        ,
        x.JSONEncode = function() {
            return function(e) {
                var t = e
                  , i = function(e) {
                    var t = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g
                      , i = {
                        "\b": "\\b",
                        "\t": "\\t",
                        "\n": "\\n",
                        "\f": "\\f",
                        "\r": "\\r",
                        '"': '\\"',
                        "\\": "\\\\"
                    };
                    return t.lastIndex = 0,
                    t.test(e) ? '"' + e.replace(t, function(e) {
                        var t = i[e];
                        return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
                    }) + '"' : '"' + e + '"'
                }
                  , n = function(e, t) {
                    var o = ""
                      , s = "    "
                      , l = 0
                      , c = ""
                      , u = ""
                      , h = 0
                      , d = o
                      , p = []
                      , m = t[e];
                    switch (m && "object" == typeof m && "function" == typeof m.toJSON && (m = m.toJSON(e)),
                    typeof m) {
                    case "string":
                        return i(m);
                    case "number":
                        return isFinite(m) ? String(m) : "null";
                    case "boolean":
                    case "null":
                        return String(m);
                    case "object":
                        if (!m)
                            return "null";
                        if (o += s,
                        p = [],
                        "[object Array]" === a.apply(m)) {
                            for (h = m.length,
                            l = 0; l < h; l += 1)
                                p[l] = n(l, m) || "null";
                            return u = 0 === p.length ? "[]" : o ? "[\n" + o + p.join(",\n" + o) + "\n" + d + "]" : "[" + p.join(",") + "]",
                            o = d,
                            u
                        }
                        for (c in m)
                            r.call(m, c) && (u = n(c, m),
                            u && p.push(i(c) + (o ? ": " : ":") + u));
                        return u = 0 === p.length ? "{}" : o ? "{" + p.join(",") + d + "}" : "{" + p.join(",") + "}",
                        o = d,
                        u
                    }
                };
                return n("", {
                    "": t
                })
            }
        }(),
        x.JSONDecode = function() {
            var e, t, i, n, o = {
                '"': '"',
                "\\": "\\",
                "/": "/",
                b: "\b",
                f: "\f",
                n: "\n",
                r: "\r",
                t: "\t"
            }, s = function(t) {
                throw {
                    name: "SyntaxError",
                    message: t,
                    at: e,
                    text: i
                }
            }, a = function(n) {
                return n && n !== t && s("Expected '" + n + "' instead of '" + t + "'"),
                t = i.charAt(e),
                e += 1,
                t
            }, r = function() {
                var e, i = "";
                for ("-" === t && (i = "-",
                a("-")); t >= "0" && t <= "9"; )
                    i += t,
                    a();
                if ("." === t)
                    for (i += "."; a() && t >= "0" && t <= "9"; )
                        i += t;
                if ("e" === t || "E" === t)
                    for (i += t,
                    a(),
                    "-" !== t && "+" !== t || (i += t,
                    a()); t >= "0" && t <= "9"; )
                        i += t,
                        a();
                return e = +i,
                isFinite(e) ? e : void s("Bad number")
            }, l = function() {
                var e, i, n, r = "";
                if ('"' === t)
                    for (; a(); ) {
                        if ('"' === t)
                            return a(),
                            r;
                        if ("\\" === t)
                            if (a(),
                            "u" === t) {
                                for (n = 0,
                                i = 0; i < 4 && (e = parseInt(a(), 16),
                                isFinite(e)); i += 1)
                                    n = 16 * n + e;
                                r += String.fromCharCode(n)
                            } else {
                                if ("string" != typeof o[t])
                                    break;
                                r += o[t]
                            }
                        else
                            r += t
                    }
                s("Bad string")
            }, c = function() {
                for (; t && t <= " "; )
                    a()
            }, u = function() {
                switch (t) {
                case "t":
                    return a("t"),
                    a("r"),
                    a("u"),
                    a("e"),
                    !0;
                case "f":
                    return a("f"),
                    a("a"),
                    a("l"),
                    a("s"),
                    a("e"),
                    !1;
                case "n":
                    return a("n"),
                    a("u"),
                    a("l"),
                    a("l"),
                    null
                }
                s("Unexpected '" + t + "'")
            }, h = function() {
                var e = [];
                if ("[" === t) {
                    if (a("["),
                    c(),
                    "]" === t)
                        return a("]"),
                        e;
                    for (; t; ) {
                        if (e.push(n()),
                        c(),
                        "]" === t)
                            return a("]"),
                            e;
                        a(","),
                        c()
                    }
                }
                s("Bad array")
            }, d = function() {
                var e, i = {};
                if ("{" === t) {
                    if (a("{"),
                    c(),
                    "}" === t)
                        return a("}"),
                        i;
                    for (; t; ) {
                        if (e = l(),
                        c(),
                        a(":"),
                        Object.hasOwnProperty.call(i, e) && s('Duplicate key "' + e + '"'),
                        i[e] = n(),
                        c(),
                        "}" === t)
                            return a("}"),
                            i;
                        a(","),
                        c()
                    }
                }
                s("Bad object")
            };
            return n = function() {
                switch (c(),
                t) {
                case "{":
                    return d();
                case "[":
                    return h();
                case '"':
                    return l();
                case "-":
                    return r();
                default:
                    return t >= "0" && t <= "9" ? r() : u()
                }
            }
            ,
            function(o) {
                var a;
                return i = o,
                e = 0,
                t = " ",
                a = n(),
                c(),
                t && s("Syntax error"),
                a
            }
        }(),
        x.base64Encode = function(e) {
            var t, i, n, o, s, a, r, l, c = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", u = 0, h = 0, d = "", p = [];
            if (!e)
                return e;
            e = x.utf8Encode(e);
            do
                t = e.charCodeAt(u++),
                i = e.charCodeAt(u++),
                n = e.charCodeAt(u++),
                l = t << 16 | i << 8 | n,
                o = l >> 18 & 63,
                s = l >> 12 & 63,
                a = l >> 6 & 63,
                r = 63 & l,
                p[h++] = c.charAt(o) + c.charAt(s) + c.charAt(a) + c.charAt(r);
            while (u < e.length);switch (d = p.join(""),
            e.length % 3) {
            case 1:
                d = d.slice(0, -2) + "==";
                break;
            case 2:
                d = d.slice(0, -1) + "="
            }
            return d
        }
        ,
        x.utf8Encode = function(e) {
            e = (e + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n");
            var t, i, n, o = "", s = 0;
            for (t = i = 0,
            s = e.length,
            n = 0; n < s; n++) {
                var a = e.charCodeAt(n)
                  , r = null ;
                a < 128 ? i++ : r = a > 127 && a < 2048 ? String.fromCharCode(a >> 6 | 192, 63 & a | 128) : String.fromCharCode(a >> 12 | 224, a >> 6 & 63 | 128, 63 & a | 128),
                null !== r && (i > t && (o += e.substring(t, i)),
                o += r,
                t = i = n + 1)
            }
            return i > t && (o += e.substring(t, e.length)),
            o
        }
        ,
        x.UUID = function() {
            var e = function() {
                for (var e = 1 * new Date, t = 0; e == 1 * new Date; )
                    t++;
                return e.toString(16) + t.toString(16)
            }
              , t = function() {
                return Math.random().toString(16).replace(".", "")
            }
              , i = function(e) {
                function t(e, t) {
                    var i, n = 0;
                    for (i = 0; i < t.length; i++)
                        n |= s[i] << 8 * i;
                    return e ^ n
                }
                var i, n, o = h, s = [], a = 0;
                for (i = 0; i < o.length; i++)
                    n = o.charCodeAt(i),
                    s.unshift(255 & n),
                    s.length >= 4 && (a = t(a, s),
                    s = []);
                return s.length > 0 && (a = t(a, s)),
                a.toString(16)
            };
            return function() {
                var n = (screen.height * screen.width).toString(16);
                return e() + "-" + t() + "-" + i() + "-" + n + "-" + e()
            }
        }(),
        x.isBlockedUA = function() {
            var e = h;
            return !!/(google web preview|baiduspider|yandexbot)/i.test(e)
        }
        ,
        x.HTTPBuildQuery = function(e, t) {
            var i, n, o = [];
            return "undefined" == typeof t && (t = "&"),
            x.each(e, function(e, t) {
                i = encodeURIComponent(e.toString()),
                n = encodeURIComponent(t),
                o[o.length] = n + "=" + i
            }),
            o.join(t)
        }
        ,
        x.getQueryParam = function(e, t) {
            t = t.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var i = "[\\?&]" + t + "=([^&#]*)"
              , n = new RegExp(i)
              , o = n.exec(e);
            return null === o || o && "string" != typeof o[1] && o[1].length ? "" : decodeURIComponent(o[1]).replace(/\+/g, " ")
        }
        ,
        x.cookie = {
            get: function(e) {
                for (var t = e + "=", i = u.cookie.split(";"), n = 0; n < i.length; n++) {
                    for (var o = i[n]; " " == o.charAt(0); )
                        o = o.substring(1, o.length);
                    if (0 == o.indexOf(t))
                        return decodeURIComponent(o.substring(t.length, o.length))
                }
                return null
            },
            parse: function(e) {
                var t;
                try {
                    t = x.JSONDecode(x.cookie.get(e)) || {}
                } catch (i) {}
                return t
            },
            set: function(e, t, i, n, o) {
                var s = ""
                  , a = ""
                  , r = "";
                if (n) {
                    var l = u.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i)
                      , c = l ? l[0] : "";
                    s = c ? "; domain=." + c : ""
                }
                if (i) {
                    var h = new Date;
                    h.setTime(h.getTime() + 24 * i * 60 * 60 * 1e3),
                    a = "; expires=" + h.toGMTString()
                }
                o && (r = "; secure"),
                u.cookie = e + "=" + encodeURIComponent(t) + a + "; path=/" + s + r
            },
            remove: function(e, t) {
                x.cookie.set(e, "", -1, t)
            }
        },
        x.register_event = function() {
            function e(e, i, n) {
                var o = function(o) {
                    if (o = o || t(window.event)) {
                        var s, a, r = !0;
                        return x.isFunction(n) && (s = n(o)),
                        a = i.call(e, o),
                        !1 !== s && !1 !== a || (r = !1),
                        r
                    }
                };
                return o
            }
            function t(e) {
                return e && (e.preventDefault = t.preventDefault,
                e.stopPropagation = t.stopPropagation),
                e
            }
            var i = function(t, i, n, o) {
                if (!t)
                    return void O.error("No valid element provided to register_event");
                if (t.addEventListener && !o)
                    t.addEventListener(i, n, !1);
                else {
                    var s = "on" + i
                      , a = t[s];
                    t[s] = e(t, n, a)
                }
            };
            return t.preventDefault = function() {
                this.returnValue = !1
            }
            ,
            t.stopPropagation = function() {
                this.cancelBubble = !0
            }
            ,
            i
        }(),
        x.dom_query = function() {
            function e(e) {
                return e.all ? e.all : e.getElementsByTagName("*")
            }
            function t(e, t) {
                var i = " " + t + " ";
                return (" " + e.className + " ").replace(n, " ").indexOf(i) >= 0
            }
            function i(i) {
                if (!u.getElementsByTagName)
                    return new Array;
                for (var n, o = i.split(" "), s = new Array(u), a = 0; a < o.length; a++)
                    if (n = o[a].replace(/^\s+/, "").replace(/\s+$/, ""),
                    n.indexOf("#") > -1) {
                        var r = n.split("#")
                          , l = r[0]
                          , c = r[1]
                          , h = u.getElementById(c);
                        if (!h || l && h.nodeName.toLowerCase() != l)
                            return new Array;
                        s = new Array(h)
                    } else if (n.indexOf(".") > -1) {
                        var r = n.split(".")
                          , l = r[0]
                          , d = r[1];
                        l || (l = "*");
                        for (var p = new Array, m = 0, f = 0; f < s.length; f++) {
                            var g;
                            g = "*" == l ? e(s[f]) : s[f].getElementsByTagName(l);
                            for (var _ = 0; _ < g.length; _++)
                                p[m++] = g[_]
                        }
                        s = new Array;
                        for (var v = 0, y = 0; y < p.length; y++)
                            p[y].className && x.isString(p[y].className) && t(p[y], d) && (s[v++] = p[y])
                    } else if (n.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)) {
                        var l = RegExp.$1
                          , w = RegExp.$2
                          , b = RegExp.$3
                          , C = RegExp.$4;
                        l || (l = "*");
                        for (var p = new Array, m = 0, f = 0; f < s.length; f++) {
                            var g;
                            g = "*" == l ? e(s[f]) : s[f].getElementsByTagName(l);
                            for (var _ = 0; _ < g.length; _++)
                                p[m++] = g[_]
                        }
                        s = new Array;
                        var I, v = 0;
                        switch (b) {
                        case "=":
                            I = function(e) {
                                return e.getAttribute(w) == C
                            }
                            ;
                            break;
                        case "~":
                            I = function(e) {
                                return e.getAttribute(w).match(new RegExp("\\b" + C + "\\b"))
                            }
                            ;
                            break;
                        case "|":
                            I = function(e) {
                                return e.getAttribute(w).match(new RegExp("^" + C + "-?"))
                            }
                            ;
                            break;
                        case "^":
                            I = function(e) {
                                return 0 == e.getAttribute(w).indexOf(C)
                            }
                            ;
                            break;
                        case "$":
                            I = function(e) {
                                return e.getAttribute(w).lastIndexOf(C) == e.getAttribute(w).length - C.length
                            }
                            ;
                            break;
                        case "*":
                            I = function(e) {
                                return e.getAttribute(w).indexOf(C) > -1
                            }
                            ;
                            break;
                        default:
                            I = function(e) {
                                return e.getAttribute(w)
                            }
                        }
                        s = new Array,
                        v = 0;
                        for (var y = 0; y < p.length; y++)
                            I(p[y]) && (s[v++] = p[y])
                    } else {
                        l = n;
                        for (var p = new Array, m = 0, f = 0; f < s.length; f++)
                            for (var g = s[f].getElementsByTagName(l), _ = 0; _ < g.length; _++)
                                p[m++] = g[_];
                        s = p
                    }
                return s
            }
            var n = /[\t\r\n]/g;
            return i
        }(),
        x.info = {
            campaignParams: function() {
                var e = "utm_source utm_medium utm_campaign utm_content utm_term".split(" ")
                  , t = ""
                  , i = {};
                return x.each(e, function(e) {
                    t = x.getQueryParam(u.URL, e),
                    t.length && (i[e] = t)
                }),
                i
            },
            searchEngine: function(e) {
                return 0 === e.search("https?://(.*)google.([^/?]*)") ? "google" : 0 === e.search("https?://(.*)bing.com") ? "bing" : 0 === e.search("https?://(.*)yahoo.com") ? "yahoo" : 0 === e.search("https?://(.*)duckduckgo.com") ? "duckduckgo" : null
            },
            searchInfo: function(e) {
                var t = x.info.searchEngine(e)
                  , i = "yahoo" != t ? "q" : "p"
                  , n = {};
                if (null !== t) {
                    n.$search_engine = t;
                    var o = x.getQueryParam(e, i);
                    o.length && (n.mp_keyword = o)
                }
                return n
            },
            browser: function() {
                var e = h
                  , t = c.vendor || "";
                return window.opera ? x.includes(e, "Mini") ? "Opera Mini" : "Opera" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : x.includes(e, "Chrome") ? "Chrome" : x.includes(t, "Apple") ? x.includes(e, "Mobile") ? "Mobile Safari" : "Safari" : x.includes(e, "Android") ? "Android Mobile" : x.includes(e, "Konqueror") ? "Konqueror" : x.includes(e, "Firefox") ? "Firefox" : x.includes(e, "MSIE") ? "Internet Explorer" : x.includes(e, "Gecko") ? "Mozilla" : ""
            },
            os: function() {
                var e = h;
                return /Windows/i.test(e) ? /Phone/.test(e) ? "Windows Mobile" : "Windows" : /(iPhone|iPad|iPod)/.test(e) ? "iOS" : /Android/.test(e) ? "Android" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : /Mac/i.test(e) ? "Mac OS X" : /Linux/.test(e) ? "Linux" : ""
            },
            device: function() {
                var e = h;
                return /iPhone/.test(e) ? "iPhone" : /iPad/.test(e) ? "iPad" : /iPod/.test(e) ? "iPod Touch" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : /Windows Phone/i.test(e) ? "Windows Phone" : /Android/.test(e) ? "Android" : ""
            },
            referringDomain: function(e) {
                var t = e.split("/");
                return t.length >= 3 ? t[2] : ""
            },
            properties: function() {
                return x.strip_empty_properties({
                    $os: x.info.os(),
                    $browser: x.info.browser(),
                    $referrer: u.referrer,
                    $referring_domain: x.info.referringDomain(u.referrer),
                    $device: x.info.device(),
                    mp_lib: "web"
                })
            },
            people_properties: function() {
                return x.strip_empty_properties({
                    $os: x.info.os(),
                    $browser: x.info.browser()
                })
            },
            pageviewInfo: function(e) {
                return x.strip_empty_properties({
                    mp_page: e,
                    mp_referrer: u.referrer,
                    mp_browser: x.info.browser(),
                    mp_platform: x.info.os()
                })
            }
        };
        var O = {
            log: function() {
                if (M && !x.isUndefined(l) && l)
                    try {
                        l.log.apply(l, arguments)
                    } catch (e) {
                        x.each(arguments, function(e) {
                            l.log(e)
                        })
                    }
            },
            error: function() {
                if (M && !x.isUndefined(l) && l) {
                    var e = ["Mixpanel error:"].concat(x.toArray(arguments));
                    try {
                        l.error.apply(l, e)
                    } catch (t) {
                        x.each(e, function(e) {
                            l.error(e)
                        })
                    }
                }
            },
            critical: function() {
                if (!x.isUndefined(l) && l) {
                    var e = ["Mixpanel error:"].concat(x.toArray(arguments));
                    try {
                        l.error.apply(l, e)
                    } catch (t) {
                        x.each(e, function(e) {
                            l.error(e)
                        })
                    }
                }
            }
        }
          , P = function() {};
        P.prototype.create_properties = function() {}
        ,
        P.prototype.event_handler = function() {}
        ,
        P.prototype.after_track_handler = function() {}
        ,
        P.prototype.init = function(e) {
            return this.mp = e,
            this
        }
        ,
        P.prototype.track = function(e, t, i, n) {
            var o = this
              , s = x.dom_query(e);
            return 0 == s.length ? void O.error("The DOM query (" + e + ") returned 0 elements") : (x.each(s, function(e) {
                x.register_event(e, this.override_event, function(e) {
                    var s = {}
                      , a = o.create_properties(i, this)
                      , r = o.mp.get_config("track_links_timeout");
                    o.event_handler(e, this, s),
                    window.setTimeout(o.track_callback(n, a, s, !0), r),
                    o.mp.track(t, a, o.track_callback(n, a, s))
                })
            }, this),
            !0)
        }
        ,
        P.prototype.track_callback = function(e, t, i, n) {
            n = n || !1;
            var o = this;
            return function() {
                i.callback_fired || (i.callback_fired = !0,
                e && e(n, t) === !1 || o.after_track_handler(t, i, n))
            }
        }
        ,
        P.prototype.create_properties = function(e, t) {
            var i;
            return i = "function" == typeof e ? e(t) : x.extend({}, e)
        }
        ;
        var D = function() {
            this.override_event = "click"
        };
        x.inherit(D, P),
        D.prototype.create_properties = function(e, t) {
            var i = D.superclass.create_properties.apply(this, arguments);
            return t.href && (i.url = t.href),
            i
        }
        ,
        D.prototype.event_handler = function(e, t, i) {
            i.new_tab = 2 === e.which || e.metaKey || "_blank" === t.target,
            i.href = t.href,
            i.new_tab || e.preventDefault()
        }
        ,
        D.prototype.after_track_handler = function(e, t, i) {
            t.new_tab || setTimeout(function() {
                window.location = t.href
            }, 0)
        }
        ;
        var L = function() {
            this.override_event = "submit"
        };
        x.inherit(L, P),
        L.prototype.event_handler = function(e, t, i) {
            i.element = t,
            e.preventDefault()
        }
        ,
        L.prototype.after_track_handler = function(e, t, i) {
            setTimeout(function() {
                t.element.submit()
            }, 0)
        }
        ;
        var B = function(e) {
            this.props = {},
            this.campaign_params_saved = !1,
            e.cookie_name ? this.name = "mp_" + e.cookie_name : this.name = "mp_" + e.token + "_mixpanel",
            this.load(),
            this.update_config(e),
            this.upgrade(e),
            this.save()
        };
        B.prototype.properties = function() {
            var e = {};
            return x.each(this.props, function(t, i) {
                x.include(I, i) || (e[i] = t)
            }),
            e
        }
        ,
        B.prototype.load = function() {
            if (!this.disabled) {
                var e = x.cookie.parse(this.name);
                e && (this.props = x.extend({}, e))
            }
        }
        ,
        B.prototype.upgrade = function(e) {
            var t, i, n = e.upgrade;
            n && (t = "mp_super_properties",
            "string" == typeof n && (t = n),
            i = x.cookie.parse(t),
            x.cookie.remove(t),
            x.cookie.remove(t, !0),
            i && (this.props = x.extend(this.props, i.all, i.events))),
            e.cookie_name || "mixpanel" === e.name || (t = "mp_" + e.token + "_" + e.name,
            i = x.cookie.parse(t),
            i && (x.cookie.remove(t),
            x.cookie.remove(t, !0),
            this.register_once(i)))
        }
        ,
        B.prototype.save = function() {
            this.disabled || x.cookie.set(this.name, x.JSONEncode(this.props), this.expire_days, this.cross_subdomain, this.secure)
        }
        ,
        B.prototype.remove = function() {
            x.cookie.remove(this.name, !1),
            x.cookie.remove(this.name, !0)
        }
        ,
        B.prototype.clear = function() {
            this.remove(),
            this.props = {}
        }
        ,
        B.prototype.register_once = function(e, t, i) {
            return !!x.isObject(e) && ("undefined" == typeof t && (t = "None"),
            this.expire_days = "undefined" == typeof i ? this.default_expiry : i,
            x.each(e, function(e, i) {
                this.props[i] && this.props[i] !== t || (this.props[i] = e)
            }, this),
            this.save(),
            !0)
        }
        ,
        B.prototype.register = function(e, t) {
            return !!x.isObject(e) && (this.expire_days = "undefined" == typeof t ? this.default_expiry : t,
            x.extend(this.props, e),
            this.save(),
            !0)
        }
        ,
        B.prototype.unregister = function(e) {
            e in this.props && (delete this.props[e],
            this.save())
        }
        ,
        B.prototype.update_campaign_params = function() {
            this.campaign_params_saved || (this.register_once(x.info.campaignParams()),
            this.campaign_params_saved = !0)
        }
        ,
        B.prototype.update_search_keyword = function(e) {
            this.register(x.info.searchInfo(e))
        }
        ,
        B.prototype.update_referrer_info = function(e) {
            this.register_once({
                $initial_referrer: e || "$direct",
                $initial_referring_domain: x.info.referringDomain(e) || "$direct"
            }, "")
        }
        ,
        B.prototype.get_referrer_info = function() {
            return x.strip_empty_properties({
                $initial_referrer: this.props.$initial_referrer,
                $initial_referring_domain: this.props.$initial_referring_domain
            })
        }
        ,
        B.prototype.safe_merge = function(e) {
            return x.each(this.props, function(t, i) {
                i in e || (e[i] = t)
            }),
            e
        }
        ,
        B.prototype.update_config = function(e) {
            this.default_expiry = this.expire_days = e.cookie_expiration,
            this.set_disabled(e.disable_cookie),
            this.set_cross_subdomain(e.cross_subdomain_cookie),
            this.set_secure(e.secure_cookie)
        }
        ,
        B.prototype.set_disabled = function(e) {
            this.disabled = e,
            this.disabled && this.remove()
        }
        ,
        B.prototype.set_cross_subdomain = function(e) {
            e !== this.cross_subdomain && (this.cross_subdomain = e,
            this.remove(),
            this.save())
        }
        ,
        B.prototype.get_cross_subdomain = function() {
            return this.cross_subdomain
        }
        ,
        B.prototype.set_secure = function(e) {
            e !== this.secure && (this.secure = !!e,
            this.remove(),
            this.save())
        }
        ,
        B.prototype._add_to_people_queue = function(e, t) {
            var i = this._get_queue_key(e)
              , n = t[e]
              , o = this._get_or_create_queue(_)
              , s = this._get_or_create_queue(v)
              , a = this._get_or_create_queue(y)
              , r = this._get_or_create_queue(w, []);
            i === p ? (x.extend(o, n),
            this._pop_from_people_queue(y, n)) : i === m ? x.each(n, function(e, t) {
                t in s || (s[t] = e)
            }) : i === f ? x.each(n, function(e, t) {
                t in o ? o[t] += e : (t in a || (a[t] = 0),
                a[t] += e)
            }, this) : i === g && r.push(n),
            O.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),
            O.log(t),
            this.save()
        }
        ,
        B.prototype._pop_from_people_queue = function(e, t) {
            var i = this._get_queue(e);
            x.isUndefined(i) || (x.each(t, function(e, t) {
                delete i[t]
            }, this),
            this.save())
        }
        ,
        B.prototype._get_queue_key = function(e) {
            return e === _ ? p : e === v ? m : e === y ? f : e === w ? g : void O.error("Invalid queue:", e)
        }
        ,
        B.prototype._get_queue = function(e) {
            return this.props[this._get_queue_key(e)]
        }
        ,
        B.prototype._get_or_create_queue = function(e, t) {
            var i = this._get_queue_key(e)
              , t = x.isUndefined(t) ? {} : t;
            return this.props[i] || (this.props[i] = t)
        }
        ;
        var k = function(t, i, n) {
            var o, s = n === d ? e : e[n];
            return s && !x.isArray(s) ? void O.error("You have already initialized " + n) : (o = new F,
            o._init(t, i, n),
            o.people = new H,
            o.people._init(o),
            M = M || o.get_config("debug"),
            x.isUndefined(s) || (o._execute_array.call(o.people, s.people),
            o._execute_array(s)),
            o)
        }
          , F = function() {};
        F.prototype.init = function(t, i, n) {
            if ("undefined" == typeof n)
                return void O.error("You must name your new library: init(token, config, name)");
            if (n === d)
                return void O.error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");
            var o = k(t, i, n);
            return e[n] = o,
            o._loaded(),
            o
        }
        ,
        F.prototype._init = function(e, t, i) {
            this.__loaded = !0,
            this.config = {},
            this.set_config(x.extend({}, N, t, {
                name: i,
                token: e,
                callback_fn: (i === d ? i : "mixpanel." + i) + "._jsc"
            })),
            this._jsc = function() {}
            ,
            this.__dom_loaded_queue = [],
            this.__request_queue = [],
            this.__disabled_events = [],
            this._flags = {
                disable_all_events: !1,
                identify_called: !1
            },
            this.cookie = new B(this.config),
            this.register_once({
                distinct_id: x.UUID()
            }, "")
        }
        ,
        F.prototype._loaded = function() {
            this.get_config("loaded")(this),
            this.get_config("track_pageview") && this.track_pageview()
        }
        ,
        F.prototype._dom_loaded = function() {
            x.each(this.__dom_loaded_queue, function(e) {
                this._track_dom.apply(this, e)
            }, this),
            x.each(this.__request_queue, function(e) {
                this._send_request.apply(this, e)
            }, this),
            delete this.__dom_loaded_queue,
            delete this.__request_queue
        }
        ,
        F.prototype._track_dom = function(e, t) {
            if (this.get_config("img"))
                return O.error("You can't use DOM tracking functions with img = true."),
                !1;
            if (!R)
                return this.__dom_loaded_queue.push([e, t]),
                !1;
            var i = (new e).init(this);
            return i.track.apply(i, t)
        }
        ,
        F.prototype._prepare_callback = function(e, t) {
            if (x.isUndefined(e))
                return null ;
            if (A) {
                var i = function(i) {
                    e(i, t)
                };
                return i
            }
            var n = this._jsc
              , o = "" + Math.floor(1e8 * Math.random())
              , s = this.get_config("callback_fn") + '["' + o + '"]';
            return n[o] = function(i) {
                delete n[o],
                e(i, t)
            }
            ,
            s
        }
        ,
        F.prototype._send_request = function(e, t, i) {
            if (E)
                return void this.__request_queue.push(arguments);
            var n = this.get_config("verbose");
            if (this.get_config("test") && (t.test = 1),
            n && (t.verbose = 1),
            this.get_config("img") && (t.img = 1),
            A || (i ? t.callback = i : (n || this.get_config("test")) && (t.callback = "(function(){})")),
            t.ip = this.get_config("ip") ? 1 : 0,
            t._ = (new Date).getTime().toString(),
            e += "?" + x.HTTPBuildQuery(t),
            "img"in t) {
                var o = u.createElement("img");
                o.src = e,
                u.body.appendChild(o)
            } else if (A) {
                var s = new XMLHttpRequest;
                s.open("GET", e, !0),
                s.withCredentials = !0,
                s.onreadystatechange = function(e) {
                    if (4 === s.readyState)
                        if (200 === s.status)
                            i && i(n ? x.JSONDecode(s.responseText) : Number(s.responseText));
                        else {
                            var t = "Bad HTTP status: " + s.status + " " + s.statusText;
                            O.error(t),
                            i && i(n ? {
                                status: 0,
                                error: t
                            } : 0)
                        }
                }
                ,
                s.send(null )
            } else {
                var a = u.createElement("script");
                a.type = "text/javascript",
                a.async = !0,
                a.defer = !0,
                a.src = e;
                var r = u.getElementsByTagName("script")[0];
                r.parentNode.insertBefore(a, r)
            }
        }
        ,
        F.prototype._execute_array = function(e) {
            var t, i = [], n = [], o = [];
            x.each(e, function(e) {
                e && (t = e[0],
                "function" == typeof e ? e.call(this) : x.isArray(e) && "alias" === t ? i.push(e) : x.isArray(e) && t.indexOf("track") != -1 && "function" == typeof this[t] ? o.push(e) : n.push(e))
            }, this);
            var s = function(e, t) {
                x.each(e, function(e) {
                    this[e[0]].apply(this, e.slice(1))
                }, t)
            };
            s(i, this),
            s(n, this),
            s(o, this)
        }
        ,
        F.prototype.push = function(e) {
            this._execute_array([e])
        }
        ,
        F.prototype.disable = function(e) {
            "undefined" == typeof e ? this._flags.disable_all_events = !0 : this.__disabled_events = this.__disabled_events.concat(e)
        }
        ,
        F.prototype.track = function(e, t, i) {
            if ("undefined" == typeof e)
                return void O.error("No event name provided to mixpanel.track");
            if (x.isBlockedUA() || this._flags.disable_all_events || x.include(this.__disabled_events, e))
                return void ("undefined" != typeof i && i(0));
            t = t || {},
            t.token = t.token || this.get_config("token"),
            this.cookie.update_search_keyword(u.referrer),
            this.get_config("store_google") && this.cookie.update_campaign_params(),
            this.get_config("save_referrer") && this.cookie.update_referrer_info(u.referrer),
            t = x.extend({}, x.info.properties(), this.cookie.properties(), t);
            var n = {
                event: e,
                properties: t
            }
              , o = x.truncate(n, 255)
              , s = x.JSONEncode(o)
              , a = x.base64Encode(s);
            return O.log("MIXPANEL REQUEST:"),
            O.log(o),
            this._send_request(this.get_config("api_host") + "/track/", {
                data: a
            }, this._prepare_callback(i, o)),
            o
        }
        ,
        F.prototype.track_pageview = function(e) {
            "undefined" == typeof e && (e = u.location.href),
            this.track("mp_page_view", x.info.pageviewInfo(e))
        }
        ,
        F.prototype.track_links = function() {
            return this._track_dom.call(this, D, arguments)
        }
        ,
        F.prototype.track_forms = function() {
            return this._track_dom.call(this, L, arguments)
        }
        ,
        F.prototype.register = function(e, t) {
            this.cookie.register(e, t)
        }
        ,
        F.prototype.register_once = function(e, t, i) {
            this.cookie.register_once(e, t, i)
        }
        ,
        F.prototype.unregister = function(e) {
            this.cookie.unregister(e)
        }
        ,
        F.prototype._register_single = function(e, t) {
            var i = {};
            i[e] = t,
            this.register(i)
        }
        ,
        F.prototype.identify = function(e, t, i, n, o) {
            e != this.get_distinct_id() && e != this.get_property(C) && (this.unregister(C),
            this._register_single("distinct_id", e)),
            this._flags.identify_called = !0,
            this.people._flush(t, i, n, o)
        }
        ,
        F.prototype.get_distinct_id = function() {
            return this.get_property("distinct_id")
        }
        ,
        F.prototype.alias = function(e, t) {
            if (e === this.get_property(b))
                return O.critical("Attempting to create alias for existing People user - aborting."),
                -2;
            var i = this;
            return x.isUndefined(t) && (t = this.get_distinct_id()),
            e !== t ? (this._register_single(C, e),
            this.track("$create_alias", {
                alias: e,
                distinct_id: t
            }, function(t) {
                i.identify(e)
            })) : (O.error("alias matches current distinct_id - skipping api call."),
            this.identify(e),
            -1)
        }
        ,
        F.prototype.name_tag = function(e) {
            this._register_single("mp_name_tag", e)
        }
        ,
        F.prototype.set_config = function(e) {
            x.isObject(e) && (x.extend(this.config, e),
            this.cookie && this.cookie.update_config(this.config),
            M = M || this.get_config("debug"))
        }
        ,
        F.prototype.get_config = function(e) {
            return this.config[e]
        }
        ,
        F.prototype.get_property = function(e) {
            return this.cookie.props[e]
        }
        ,
        F.prototype.toString = function() {
            var e = this.get_config("name");
            return e !== d && (e = "mixpanel." + e),
            e
        }
        ;
        var H = function() {};
        if (H.prototype._init = function(e) {
            this._mixpanel = e
        }
        ,
        H.prototype.set = function(e, t, i) {
            var n = {}
              , o = {};
            return x.isObject(e) ? (x.each(e, function(e, t) {
                "$distinct_id" != t && "$token" != t && (o[t] = e)
            }),
            i = t) : o[e] = t,
            this._get_config("save_referrer") && this._mixpanel.cookie.update_referrer_info(u.referrer),
            o = x.extend({}, x.info.people_properties(), this._mixpanel.cookie.get_referrer_info(), o),
            n[_] = o,
            this._send_request(n, i)
        }
        ,
        H.prototype.set_once = function(e, t, i) {
            var n = {}
              , o = {};
            return x.isObject(e) ? (x.each(e, function(e, t) {
                "$distinct_id" != t && "$token" != t && (o[t] = e)
            }),
            i = t) : o[e] = t,
            n[v] = o,
            this._send_request(n, i)
        }
        ,
        H.prototype.increment = function(e, t, i) {
            var n = {}
              , o = {};
            return x.isObject(e) ? (x.each(e, function(e, t) {
                if ("$distinct_id" != t && "$token" != t)
                    return isNaN(parseFloat(e)) ? void O.error("Invalid increment value passed to mixpanel.people.increment - must be a number") : void (o[t] = e)
            }),
            i = t) : (x.isUndefined(t) && (t = 1),
            o[e] = t),
            n[y] = o,
            this._send_request(n, i)
        }
        ,
        H.prototype.append = function(e, t, i) {
            var n = {}
              , o = {};
            return x.isObject(e) ? (x.each(e, function(e, t) {
                "$distinct_id" != t && "$token" != t && (o[t] = e)
            }),
            i = t) : o[e] = t,
            n[w] = o,
            this._send_request(n, i)
        }
        ,
        H.prototype.track_charge = function(e, t, i) {
            return !x.isNumber(e) && (e = parseFloat(e),
            isNaN(e)) ? void O.error("Invalid value passed to mixpanel.people.track_charge - must be a number") : this.append("$transactions", x.extend({
                $amount: e
            }, t), i)
        }
        ,
        H.prototype.clear_charges = function(e) {
            return this.set("$transactions", [], e)
        }
        ,
        H.prototype.delete_user = function() {
            if (!this._identify_called())
                return void O.error("mixpanel.people.delete_user() requires you to call identify() first");
            var e = {
                $delete: this._mixpanel.get_distinct_id()
            };
            return this._send_request(e)
        }
        ,
        H.prototype.toString = function() {
            return this._mixpanel.toString() + ".people"
        }
        ,
        H.prototype._send_request = function(e, t) {
            e.$token = this._get_config("token"),
            e.$distinct_id = this._mixpanel.get_distinct_id();
            var i = x.encodeDates(e)
              , n = x.truncate(i, 255)
              , o = x.JSONEncode(i)
              , s = x.base64Encode(o);
            return this._identify_called() ? (O.log("MIXPANEL PEOPLE REQUEST:"),
            O.log(n),
            this._mixpanel._send_request(this._get_config("api_host") + "/engage/", {
                data: s
            }, this._mixpanel._prepare_callback(t, n)),
            n) : (this._enqueue(e),
            x.isUndefined(t) || t(this._get_config("verbose") ? {
                status: -1,
                error: null
            } : -1),
            n)
        }
        ,
        H.prototype._get_config = function(e) {
            return this._mixpanel.get_config(e)
        }
        ,
        H.prototype._identify_called = function() {
            return this._mixpanel._flags.identify_called === !0
        }
        ,
        H.prototype._enqueue = function(e) {
            _ in e ? this._mixpanel.cookie._add_to_people_queue(_, e) : v in e ? this._mixpanel.cookie._add_to_people_queue(v, e) : y in e ? this._mixpanel.cookie._add_to_people_queue(y, e) : w in e ? this._mixpanel.cookie._add_to_people_queue(w, e) : O.error("Invalid call to _enqueue():", e)
        }
        ,
        H.prototype._flush = function(e, t, i, n) {
            var o = this
              , s = x.extend({}, this._mixpanel.cookie._get_queue(_))
              , a = x.extend({}, this._mixpanel.cookie._get_queue(v))
              , r = x.extend({}, this._mixpanel.cookie._get_queue(y))
              , l = this._mixpanel.cookie._get_queue(w);
            if (x.isUndefined(s) || !x.isObject(s) || x.isEmptyObject(s) || (o._mixpanel.cookie._pop_from_people_queue(_, s),
            this.set(s, function(t, i) {
                0 == t && o._mixpanel.cookie._add_to_people_queue(_, s),
                x.isUndefined(e) || e(t, i)
            })),
            x.isUndefined(a) || !x.isObject(a) || x.isEmptyObject(a) || (o._mixpanel.cookie._pop_from_people_queue(v, a),
            this.set_once(a, function(e, t) {
                0 == e && o._mixpanel.cookie._add_to_people_queue(v, a),
                x.isUndefined(n) || n(e, t)
            })),
            x.isUndefined(r) || !x.isObject(r) || x.isEmptyObject(r) || (o._mixpanel.cookie._pop_from_people_queue(y, r),
            this.increment(r, function(e, i) {
                0 == e && o._mixpanel.cookie._add_to_people_queue(y, r),
                x.isUndefined(t) || t(e, i)
            })),
            !x.isUndefined(l) && x.isArray(l) && l.length) {
                for (var c = l.length - 1; c >= 0; c--) {
                    var u = l.pop();
                    o.append(u, function(e, t) {
                        0 == e && o._mixpanel.cookie._add_to_people_queue(w, u),
                        x.isUndefined(i) || i(e, t)
                    })
                }
                o._mixpanel.cookie.save()
            }
        }
        ,
        x.toArray = x.toArray,
        x.isObject = x.isObject,
        x.JSONEncode = x.JSONEncode,
        x.JSONDecode = x.JSONDecode,
        x.isEmptyObject = x.isEmptyObject,
        F.prototype.init = F.prototype.init,
        F.prototype.disable = F.prototype.disable,
        F.prototype.track = F.prototype.track,
        F.prototype.track_links = F.prototype.track_links,
        F.prototype.track_forms = F.prototype.track_forms,
        F.prototype.track_pageview = F.prototype.track_pageview,
        F.prototype.register = F.prototype.register,
        F.prototype.register_once = F.prototype.register_once,
        F.prototype.unregister = F.prototype.unregister,
        F.prototype.identify = F.prototype.identify,
        F.prototype.alias = F.prototype.alias,
        F.prototype.name_tag = F.prototype.name_tag,
        F.prototype.set_config = F.prototype.set_config,
        F.prototype.get_config = F.prototype.get_config,
        F.prototype.get_property = F.prototype.get_property,
        F.prototype.get_distinct_id = F.prototype.get_distinct_id,
        F.prototype.toString = F.prototype.toString,
        B.prototype.properties = B.prototype.properties,
        B.prototype.update_search_keyword = B.prototype.update_search_keyword,
        B.prototype.update_referrer_info = B.prototype.update_referrer_info,
        B.prototype.get_cross_subdomain = B.prototype.get_cross_subdomain,
        B.prototype.clear = B.prototype.clear,
        H.prototype.set = H.prototype.set,
        H.prototype.set_once = H.prototype.set_once,
        H.prototype.increment = H.prototype.increment,
        H.prototype.append = H.prototype.append,
        H.prototype.track_charge = H.prototype.track_charge,
        H.prototype.clear_charges = H.prototype.clear_charges,
        H.prototype.delete_user = H.prototype.delete_user,
        H.prototype.toString = H.prototype.toString,
        x.isUndefined(e))
            return void O.critical("'mixpanel' object not initialized. Ensure you are using the latest version of the Mixpanel JS Library along with the snippet we provide.");
        if (e.__loaded || e.config && e.cookie)
            return void O.error("Mixpanel library has already been downloaded at least once.");
        if (S < 1.1)
            return void O.critical("Version mismatch; please ensure you're using the latest version of the Mixpanel code snippet.");
        var G = {};
        x.each(e._i, function(e) {
            var t, i;
            e && x.isArray(e) && (t = e[e.length - 1],
            i = k.apply(this, e),
            G[t] = i)
        });
        var U = function() {
            x.each(G, function(t, i) {
                i !== d && (e[i] = t)
            }),
            e._ = x
        };
        if (e.init = function(t, i, n) {
            if (n)
                e[n] || (e[n] = G[n] = k(t, i, n),
                e[n]._loaded());
            else {
                var o = e;
                G[d] ? o = G[d] : t && (o = k(t, i, d)),
                window[d] = e = o,
                U()
            }
        }
        ,
        e.init(),
        x.each(G, function(e) {
            e._loaded()
        }),
        u.addEventListener)
            "complete" == u.readyState ? t() : u.addEventListener("DOMContentLoaded", t, !1);
        else if (u.attachEvent) {
            u.attachEvent("onreadystatechange", t);
            var j = !1;
            try {
                j = null == window.frameElement
            } catch (q) {}
            u.documentElement.doScroll && j && i()
        }
        x.register_event(window, "load", t, !0)
    }(window.mixpanel)
}
, function(e, t, i) {
    function n(e) {
        var t = a[e];
        return void 0 === t ? (s.error("ankAnalytics.getEventId: " + e + " is missing from the event map"),
        -1) : t
    }
    function o(e, t) {
        var i = r[e];
        if (!i)
            return void console.error("ankAnalytics checkModel: " + e + " is missing from the models");
        for (var n = Object.keys(t), o = [], s = 0, a = i.length; s < a; s += 1) {
            var l = i[s];
            "relative_soft_currency_gained" !== l && "relative_hard_currency_gained" !== l && "time_spent_on_action" !== l && n.indexOf(l) === -1 && o.push(l)
        }
        o.length && console.error("ankAnalytics checkModel: missing params on event", e, o)
    }
    var s, a = i(171), r = i(172), l = i(173), c = i(174), u = i(175), h = !1, d = !1, p = !1, m = !1, f = 18, g = null , _ = !1;
    t.init = function(e) {
        s = window.dofus.logger,
        e && (e.debug && (p = !0),
        e.analog ? (d = !0,
        _ = !0) : e.useUrlMap ? (m = !0,
        _ = !0) : _ = !1)
    }
    ,
    t.register = function(e) {
        _ && (g = e || 0)
    }
    ,
    t.unregister = function() {
        g = null
    }
    ,
    t.send = function(e, t) {
        if (_) {
            t = t || {};
            var i = n(e);
            window.developmentMode && p && o(e, t);
            var a = {
                game_id: f,
                event_id: i,
                session_id: g,
                date: u(t.date || Date.now(), "UTC:yyyy-mm-dd HH:MM:ss") + " GMT",
                data: t
            };
            if (d)
                s.info("ankAnalytics.send: " + e, JSON.stringify(a));
            else if (m) {
                var r = window.gui.serversData.connectedServerId
                  , v = l[r];
                if (!v)
                    return void (h || (h = !0,
                    console.error("ankAnalytics send: eventServerURL is missing for server " + r)));
                c(v, a, function(e) {
                    if (e)
                        return s.error("ankAnalytics.send:", e)
                })
            }
        }
    }
}
, function(e, t) {
    e.exports = {
        "Session_Info.Login": 558,
        "Session_Info.Choose_Server": 559,
        "Session_Info.Choose_Character": 560,
        "F_T_U_E.Step0000_Chose_Nickname": 320,
        "F_T_U_E.Step0100_Chose_Server": 321,
        "F_T_U_E.Step0200_Create_First_Character": 322,
        "F_T_U_E.Step0300_Enter_Tuto": 323,
        "F_T_U_E.Step9999_Quit_Tuto": 324,
        "F_T_U_E.Step0400_Start_Tuto_Step_1_Move": 325,
        "F_T_U_E.Step0500_Succeed_Tuto_Step_1_Move": 326,
        "F_T_U_E.Step0600_Start_Tuto_Step_2_Speak_To_NPC": 327,
        "F_T_U_E.Step0630_Clic_Maitre_Pifo": 328,
        "F_T_U_E.Step0660_Answer_Maitre_Pifo": 329,
        "F_T_U_E.Step0700_Succeed_Tuto_Step_2_Speak_To_NPC": 330,
        "F_T_U_E.Step0800_Start_Tuto_Step_3_Equip_Ring": 331,
        "F_T_U_E.Step0820_Clic_Menu_Bag": 332,
        "F_T_U_E.Step0840_Clic_Menu_Weapons": 333,
        "F_T_U_E.Step0860_Equip_Ring": 334,
        "F_T_U_E.Step0880_Close_Menu": 335,
        "F_T_U_E.Step0900_Succed_Tuto_Step_3_Equip_Ring": 336,
        "F_T_U_E.Step1000_Start_Tuto_Step_4_Change_Map": 337,
        "F_T_U_E.Step1100_Succeed_Tuto_Step_4_Change_Map": 338,
        "F_T_U_E.Step1200_Start_Tuto_Step_5_Start_Fight": 339,
        "F_T_U_E.Step1230_Clic_Scarecrow": 340,
        "F_T_U_E.Step1260_Clic_Attack": 341,
        "F_T_U_E.Step1300_Succeed_Tuto_Step_5_Start_Fight": 342,
        "F_T_U_E.Step1400_Start_Tuto_Step_6_Chose_Starting_Position": 343,
        "F_T_U_E.Step1430_Clic_Desired_Position_Square": 344,
        "F_T_U_E.Step1460_Clic_Ready_Button": 345,
        "F_T_U_E.Step1500_Succeed_Tuto_Step_6_Chose_Starting_Position": 346,
        "F_T_U_E.Step1600_Start_Tuto_Step_7_Move_In_Fight": 347,
        "F_T_U_E.Step1630_Clic_Desired_Position_Square": 348,
        "F_T_U_E.Step1660_Clic_Validate_Move": 349,
        "F_T_U_E.Step1700_Succed_Tuto_Step_7_Move_In_Fight": 350,
        "F_T_U_E.Step1800_Start_Tuto_Step_8_Use_Spell": 351,
        "F_T_U_E.Step1820_Clic_Attack_Button": 352,
        "F_T_U_E.Step1850_Select_Target": 353,
        "F_T_U_E.Step1870_Validate_Attack": 354,
        "F_T_U_E.Step1890_Succeed_Tuto_Step_8_Use_Spell": 355,
        "F_T_U_E.Step1900_Start_Tuto_Step_9_End_Turn": 356,
        "F_T_U_E.Step1950_Clic_End_Turn_Button": 357,
        "F_T_U_E.Step2000_Succeed_Tuto_Step_9_End_Turn": 358,
        "F_T_U_E.Step2100_Start_Tuto_Step_10_Win_Fight": 359,
        "F_T_U_E.Step2140_Scarecrow_Figh_End": 360,
        "F_T_U_E.Step2180_Close_Fight_Summary_Window": 361,
        "F_T_U_E.Step2200_Succeed_Tuto_Step_10_Win_Fight": 362,
        "F_T_U_E.Step2300_Start_Tuto_Step_11_Start_Quest": 363,
        "F_T_U_E.Step2330_Talk_To_NPC_Maitre_Pifo": 364,
        "F_T_U_E.Step2360_Answer_NPC_Maitre_Pifo": 365,
        "F_T_U_E.Step2400_Succeed_Tuto_Step_11_Start_Quest": 366,
        "F_T_U_E.Step2500_Start_Tuto_Step_12_Equip_Items": 367,
        "F_T_U_E.Step2510_Clic_Bag_Menu": 368,
        "F_T_U_E.Step2520_Clic_Weapon_Menu": 369,
        "F_T_U_E.Step2530_Equip_Cloak": 370,
        "F_T_U_E.Step2540_Equip_Amulet": 371,
        "F_T_U_E.Step2550_Equip_Belt": 372,
        "F_T_U_E.Step2560_Equip_Shield": 373,
        "F_T_U_E.Step2570_Equip_Sword": 374,
        "F_T_U_E.Step2580_Equip_Boots": 375,
        "F_T_U_E.Step2590_Quit_Bag_Menu": 376,
        "F_T_U_E.Step2600_Succeed_Tuto_Step_12_Equip_Items": 377,
        "F_T_U_E.Step2700_Start_Tuto_Step_13_Defeat_Monster": 378,
        "F_T_U_E.Step2720_Change_Map": 379,
        "F_T_U_E.Step2750_Clic_Monster_Lupus_Minimus": 380,
        "F_T_U_E.Step2770_Attack_Monster_Lupus_Minimus": 381,
        "F_T_U_E.Step2800_Succed_Tuto_Step_13_Defeat_Monster": 382,
        "F_T_U_E.Step2900_Start_Tuto_Step_14_End_Fight": 383,
        "F_T_U_E.Step2910_Lupus_Minimus_Figh_End": 384,
        "F_T_U_E.Step2930_Win_Fight_Monster_Lupus_Minimus": 385,
        "F_T_U_E.Step2960_Close_Fight_Summary_Window": 386,
        "F_T_U_E.Step3000_Succed_Tuto_Step_14_End_Fight": 387,
        "F_T_U_E.Step3100_Start_Tuto_Step_15_End_Learning": 388,
        "F_T_U_E.Step3130_Talk_To_NPC_Maitre_Pifo": 389,
        "F_T_U_E.Step3160_Answer_NPC_Maitre_Pifo": 390,
        "F_T_U_E.Step3200_Succeed_Tuto_Step_15_End_Learning": 391,
        "fight_report.fight_end_alive_monster_description": 583,
        "character_progression.spell_level_change": 585,
        "social.fight_group_join": 586,
        "social.fight_group_quit": 587,
        "social.guild_join": 588,
        "social.guild_quit": 589,
        "Fight_Action.Spell_Cast_By_User": 398,
        "Fight_Report.Fight_Start": 405,
        "Fight_Report.Fight_End": 407,
        "User_Life_Cycle.Level_Up": 415,
        "User_Life_Cycle.Achievement_Achieved": 416,
        "User_Life_Cycle.Achievement_Get_Reward": 417,
        "User_Life_Cycle.Quest_Start": 418,
        "User_Life_Cycle.Quest_End": 419,
        "User_Life_Cycle.Quest_Step_Success": 420,
        "User_Life_Cycle.Quest_Step_Objective_Success": 421,
        "User_Life_Cycle.Profession_Level_Up": 426,
        "User_Life_Cycle.Death": 427,
        "HUD.Click_on_button": 413,
        "HUD.Display_Menu": 414
    }
}
, function(e, t) {
    e.exports = {
        "Session_Info.Login": ["account_session_id", "character_level"],
        "Session_Info.Choose_Server": ["account_session_id", "character_level"],
        "Session_Info.Choose_Character": ["character_level"],
        "F_T_U_E.Step0000_Chose_Nickname": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0100_Chose_Server": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0200_Create_First_Character": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "used_name_generator", "used_proposed_style"],
        "F_T_U_E.Step0300_Enter_Tuto": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step9999_Quit_Tuto": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0400_Start_Tuto_Step_1_Move": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0500_Succeed_Tuto_Step_1_Move": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0600_Start_Tuto_Step_2_Speak_To_NPC": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0630_Clic_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "message_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0660_Answer_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0700_Succeed_Tuto_Step_2_Speak_To_NPC": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0800_Start_Tuto_Step_3_Equip_Ring": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0820_Clic_Menu_Bag": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0840_Clic_Menu_Weapons": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0860_Equip_Ring": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0880_Close_Menu": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step0900_Succed_Tuto_Step_3_Equip_Ring": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1000_Start_Tuto_Step_4_Change_Map": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1100_Succeed_Tuto_Step_4_Change_Map": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1200_Start_Tuto_Step_5_Start_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1230_Clic_Scarecrow": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1260_Clic_Attack": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1300_Succeed_Tuto_Step_5_Start_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1400_Start_Tuto_Step_6_Chose_Starting_Position": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1430_Clic_Desired_Position_Square": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1460_Clic_Ready_Button": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1500_Succeed_Tuto_Step_6_Chose_Starting_Position": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1600_Start_Tuto_Step_7_Move_In_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1630_Clic_Desired_Position_Square": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1660_Clic_Validate_Move": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1700_Succed_Tuto_Step_7_Move_In_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1800_Start_Tuto_Step_8_Use_Spell": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1820_Clic_Attack_Button": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1850_Select_Target": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1870_Validate_Attack": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1890_Succeed_Tuto_Step_8_Use_Spell": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1900_Start_Tuto_Step_9_End_Turn": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step1950_Clic_End_Turn_Button": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2000_Succeed_Tuto_Step_9_End_Turn": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2100_Start_Tuto_Step_10_Win_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2140_Scarecrow_Figh_End": ["character_level", "fight_id", "hard_currency_balance", "map_id", "nb_turns", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "winner_team_id", "winner_team_life_points"],
        "F_T_U_E.Step2180_Close_Fight_Summary_Window": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2200_Succeed_Tuto_Step_10_Win_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2300_Start_Tuto_Step_11_Start_Quest": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2330_Talk_To_NPC_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "message_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2360_Answer_NPC_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2400_Succeed_Tuto_Step_11_Start_Quest": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2500_Start_Tuto_Step_12_Equip_Items": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2510_Clic_Bag_Menu": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2520_Clic_Weapon_Menu": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2530_Equip_Cloak": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2540_Equip_Amulet": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2550_Equip_Belt": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2560_Equip_Shield": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2570_Equip_Sword": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2580_Equip_Boots": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2590_Quit_Bag_Menu": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2600_Succeed_Tuto_Step_12_Equip_Items": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2700_Start_Tuto_Step_13_Defeat_Monster": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2720_Change_Map": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2750_Clic_Monster_Lupus_Minimus": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2770_Attack_Monster_Lupus_Minimus": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2800_Succed_Tuto_Step_13_Defeat_Monster": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2900_Start_Tuto_Step_14_End_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2910_Lupus_Minimus_Figh_End": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2930_Win_Fight_Monster_Lupus_Minimus": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step2960_Close_Fight_Summary_Window": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step3000_Succed_Tuto_Step_14_End_Fight": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step3100_Start_Tuto_Step_15_End_Learning": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step3130_Talk_To_NPC_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "message_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step3160_Answer_NPC_Maitre_Pifo": ["answer_id", "character_level", "hard_currency_balance", "map_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "F_T_U_E.Step3200_Succeed_Tuto_Step_15_End_Learning": ["character_level", "fight_id", "hard_currency_balance", "map_id", "nb_turns", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "winner_team_id", "winner_team_life_points"],
        "fight_report.fight_end_alive_monster_description": ["character_level", "fight_id", "hard_currency_balance", "map_id", "monster_grade", "monster_id", "monster_level", "ratio_life_remaining", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "team_id", "time_spent_on_action"],
        "character_progression.spell_level_change": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "spell_id", "spell_level_after", "spell_level_before", "time_spent_on_action"],
        "social.fight_group_join": ["character_level", "group_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "social.fight_group_quit": ["character_level", "group_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "social.guild_join": ["character_level", "guild_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "social.guild_quit": ["character_level", "guild_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Fight_Action.Spell_Cast_By_User": ["character_level", "fight_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "spell_id", "spell_level", "time_spent_on_action"],
        "Fight_Action.Spell_Confirmation": ["character_level", "fight_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "spell_id", "spell_level", "spell_was_confirmed", "time_spent_on_action"],
        "Fight_Action.Move_confirmation": ["character_level", "fight_id", "hard_currency_balance", "map_id", "moved_confirmed", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Fight_Report.Fight_Start": ["character_level", "fight_id", "fight_type", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "team_0_hp", "team_1_hp", "time_spent_on_action"],
        "Fight_Report.Fight_End": ["character_level", "fight_id", "hard_currency_balance", "map_id", "nb_turns", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "winner_team_id", "winner_team_life_points"],
        "User_Life_Cycle.Level_Up": ["character_level", "hard_currency_balance", "map_id", "old_level", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Achievement_Achieved": ["achievement_id", "character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Achievement_Get_Reward": ["achievement_id", "character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Quest_Start": ["character_level", "hard_currency_balance", "map_id", "quest_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Quest_End": ["character_level", "hard_currency_balance", "map_id", "quest_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Quest_Step_Success": ["character_level", "hard_currency_balance", "map_id", "quest_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "step_id", "time_spent_on_action"],
        "User_Life_Cycle.Quest_Step_Objective_Success": ["character_level", "hard_currency_balance", "map_id", "objective_id", "quest_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "step_id", "time_spent_on_action"],
        "User_Life_Cycle.Profession_Level_Up": ["character_level", "hard_currency_balance", "job_id", "map_id", "new_level", "old_level", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "User_Life_Cycle.Death": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Fight_Report.Fight_Character_Description": ["amu_id", "belt_id", "boots_id", "character_level", "cloack_id", "comp_id", "fight_id", "hard_currency_balance", "hat_id", "is_incarnation", "map_id", "pet_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "ride_id", "ringl_id", "ringr_id", "shield_id", "soft_currency_balance", "team_id", "time_spent_on_action", "weapon_id"],
        "Fight_Report.Fight_Monster_Description": ["character_level", "fight_id", "hard_currency_balance", "map_id", "monster_grade", "monster_id", "monster_level", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "team_id", "time_spent_on_action"],
        "Game_Action.Arrives_On_Map": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Virtual_Economy.Receive_Item": ["character_level", "context", "context_id", "hard_currency_balance", "item_id", "map_id", "quantity", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Virtual_Economy.Dispose_Item": ["character_level", "context", "context_id", "hard_currency_balance", "item_id", "map_id", "quantity", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "fight_action.spell_cast_by_monster": ["character_level", "fight_id", "hard_currency_balance", "map_id", "monster_grade", "monster_id", "monster_level", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "spell_id", "spell_level", "time_spent_on_action"],
        "fight_action.damage_ally": ["ally_is_killed", "character_level", "fight_id", "hard_currency_balance", "life_points_removed_count", "life_points_removed_percentage", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "target_character_id", "target_monster_id", "time_spent_on_action"],
        "fight_action.heal_ennemy": ["character_level", "fight_id", "hard_currency_balance", "life_points_given_count", "life_points_given_percentage", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "target_character_id", "target_monster_id", "time_spent_on_action"],
        "user_life_cycle.xp_gained": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "xp"],
        "Game_Action.Travel": ["character_level", "destination_map_id", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "travel_method_category", "travel_method_id"],
        "Game_Action.Talk_To_NPC": ["answer_id", "character_level", "hard_currency_balance", "map_id", "message_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Game_Action.Player_Answer_To_NPC": ["answer_id", "character_level", "hard_currency_balance", "map_id", "npc_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Game_Action.Mode_Marchant_On": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Game_Action.Memorize_New_Zaap": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action", "zaap_id"],
        "Game_Action.Use_Scenery_Object": ["character_level", "element_uid", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Character_Progression.Caracteristic_Level_Up": ["character_level", "characteristic_id", "characteristic_initial", "characteristic_new", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Character_Progression.Caracteristic_Reset": ["character_level", "characteristic_name", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Character_Progression.New_Spell_Unlocked": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "spell_id", "time_spent_on_action"],
        "Character_Progression.Incarnation_Level_Up": ["character_level", "hard_currency_balance", "incarnation_id", "incarnation_new_level", "incarnation_old_level", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "HUD.Click_on_button": ["button_id", "character_level", "clic_parameter_key", "clic_parameter_value", "clic_type", "hard_currency_balance", "interface_id", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "HUD.Display_Menu": ["character_level", "hard_currency_balance", "interface_id", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"],
        "Virtual_Economy.Use_Bank_Account": ["character_level", "hard_currency_balance", "map_id", "relative_hard_currency_gained", "relative_soft_currency_gained", "soft_currency_balance", "time_spent_on_action"]
    }
}
, function(e, t) {
    e.exports = {
        300: "http://localhost:8888/forward",
        401: "https://analytics-north-virginia.touch.dofus.com/forward",
        402: "https://analytics-north-virginia.touch.dofus.com/forward",
        407: "https://analytics-north-virginia.touch.dofus.com/forward",
        403: "https://analytics-ireland.touch.dofus.com/forward",
        404: "https://analytics-ireland.touch.dofus.com/forward",
        405: "https://analytics-ireland.touch.dofus.com/forward",
        406: "https://analytics-ireland.touch.dofus.com/forward",
        408: "https://analytics-ireland.touch.dofus.com/forward",
        409: "https://analytics-ireland.touch.dofus.com/forward",
        410: "https://analytics-ireland.touch.dofus.com/forward"
    }
}
, function(e, t, i) {
    function n(e, t) {
        var i;
        return 204 !== ~~t && (i = "analytics.request: event " + e + ", xhrError: " + t),
        i
    }
    var o = i(44);
    e.exports = function(e, t, i) {
        if (!e)
            return i(new Error("analytics.request: url is empty"));
        t = t || {};
        var s = t.event_id
          , a = new XMLHttpRequest;
        a.timeout = 5e3;
        var r = o.operation({
            retries: 4,
            randomize: !0
        });
        a.onreadystatechange = function() {
            if (4 === ~~a.readyState) {
                var e = n(s, a.status);
                return r.retry(e) ? void console.warn("analytics.request failed event", s, "will retry...") : e ? i(r.mainError()) : void i()
            }
        }
        ,
        r.attempt(function() {
            a.open("POST", e, !0),
            a.setRequestHeader("Content-type", "application/json"),
            a.send(JSON.stringify(t))
        })
    }
}
, function(e, t, i) {
    var n;
    !function(o) {
        "use strict";
        function s(e, t) {
            for (e = String(e),
            t = t || 2; e.length < t; )
                e = "0" + e;
            return e
        }
        function a(e) {
            var t = new Date(e.getFullYear(),e.getMonth(),e.getDate());
            t.setDate(t.getDate() - (t.getDay() + 6) % 7 + 3);
            var i = new Date(t.getFullYear(),0,4);
            i.setDate(i.getDate() - (i.getDay() + 6) % 7 + 3);
            var n = t.getTimezoneOffset() - i.getTimezoneOffset();
            t.setHours(t.getHours() - n);
            var o = (t - i) / 6048e5;
            return 1 + Math.floor(o)
        }
        function r(e) {
            var t = e.getDay();
            return 0 === t && (t = 7),
            t
        }
        function l(e) {
            return null === e ? "null" : void 0 === e ? "undefined" : "object" != typeof e ? typeof e : Array.isArray(e) ? "array" : {}.toString.call(e).slice(8, -1).toLowerCase()
        }
        var c = function() {
            var e = /d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g
              , t = /\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g
              , i = /[^-+\dA-Z]/g;
            return function(n, o, u, h) {
                if (1 !== arguments.length || "string" !== l(n) || /\d/.test(n) || (o = n,
                n = void 0),
                n = n || new Date,
                n instanceof Date || (n = new Date(n)),
                isNaN(n))
                    throw TypeError("Invalid date");
                o = String(c.masks[o] || o || c.masks["default"]);
                var d = o.slice(0, 4);
                "UTC:" !== d && "GMT:" !== d || (o = o.slice(4),
                u = !0,
                "GMT:" === d && (h = !0));
                var p = u ? "getUTC" : "get"
                  , m = n[p + "Date"]()
                  , f = n[p + "Day"]()
                  , g = n[p + "Month"]()
                  , _ = n[p + "FullYear"]()
                  , v = n[p + "Hours"]()
                  , y = n[p + "Minutes"]()
                  , w = n[p + "Seconds"]()
                  , b = n[p + "Milliseconds"]()
                  , C = u ? 0 : n.getTimezoneOffset()
                  , I = a(n)
                  , T = r(n)
                  , S = {
                    d: m,
                    dd: s(m),
                    ddd: c.i18n.dayNames[f],
                    dddd: c.i18n.dayNames[f + 7],
                    m: g + 1,
                    mm: s(g + 1),
                    mmm: c.i18n.monthNames[g],
                    mmmm: c.i18n.monthNames[g + 12],
                    yy: String(_).slice(2),
                    yyyy: _,
                    h: v % 12 || 12,
                    hh: s(v % 12 || 12),
                    H: v,
                    HH: s(v),
                    M: y,
                    MM: s(y),
                    s: w,
                    ss: s(w),
                    l: s(b, 3),
                    L: s(Math.round(b / 10)),
                    t: v < 12 ? "a" : "p",
                    tt: v < 12 ? "am" : "pm",
                    T: v < 12 ? "A" : "P",
                    TT: v < 12 ? "AM" : "PM",
                    Z: h ? "GMT" : u ? "UTC" : (String(n).match(t) || [""]).pop().replace(i, ""),
                    o: (C > 0 ? "-" : "+") + s(100 * Math.floor(Math.abs(C) / 60) + Math.abs(C) % 60, 4),
                    S: ["th", "st", "nd", "rd"][m % 10 > 3 ? 0 : (m % 100 - m % 10 != 10) * m % 10],
                    W: I,
                    N: T
                };
                return o.replace(e, function(e) {
                    return e in S ? S[e] : e.slice(1, e.length - 1)
                })
            }
        }();
        c.masks = {
            "default": "ddd mmm dd yyyy HH:MM:ss",
            shortDate: "m/d/yy",
            mediumDate: "mmm d, yyyy",
            longDate: "mmmm d, yyyy",
            fullDate: "dddd, mmmm d, yyyy",
            shortTime: "h:MM TT",
            mediumTime: "h:MM:ss TT",
            longTime: "h:MM:ss TT Z",
            isoDate: "yyyy-mm-dd",
            isoTime: "HH:MM:ss",
            isoDateTime: "yyyy-mm-dd'T'HH:MM:sso",
            isoUtcDateTime: "UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",
            expiresHeaderFormat: "ddd, dd mmm yyyy HH:MM:ss Z"
        },
        c.i18n = {
            dayNames: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            monthNames: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        },
        n = function() {
            return c
        }
        .call(t, i, t, e),
        !(void 0 !== n && (e.exports = n))
    }(this)
}
, function(e, t) {
    var i = {
        0: "amulet",
        1: "weapon",
        2: "ringLeft",
        3: "belt",
        4: "ringRight",
        5: "boots",
        6: "hat",
        7: "cloack",
        8: "pet",
        15: "shield"
    };
    t.addEquippedItem = function(e) {
        var t = window.gui.playerData.inventory.equippedItems;
        for (var n in i) {
            var o = t[n]
              , s = i[n];
            o ? e[s] = o.getProperty("objectGID") : e[s] = "none"
        }
        var a = window.gui.playerData.equippedMount;
        e.mount = a && a.model || "none"
    }
    ,
    t.addCharacterInfo = function(e) {
        if (window.gui.playerData) {
            var t = window.gui.playerData
              , i = t.characterBaseInformations || {}
              , n = t.position || {};
            e.server_id = window.gui.serversData.connectedServerId,
            e.character_id = t.id,
            e.character_level = i.level,
            e.soft_currency_balance = t.inventory.kamas,
            e.hard_currency_balance = t.inventory.goultines,
            e.map_id = n.mapId
        }
    }
}
, function(e, t, i) {
    function n(e) {
        a = !1,
        l = e.accountId,
        c = e.login,
        u = e.nickname,
        o.log("Session_Info.Login", {
            account_session_id: c
        })
    }
    var o = i(160)
      , s = i(178);
    i(179);
    var a = !1
      , r = 0
      , l = 0
      , c = 0
      , u = 0
      , h = window.dofus.connectionManager;
    window.gui.on("disconnect", function() {
        o.unregister()
    }),
    h.on("NicknameAcceptedMessage", function() {
        o.log("F_T_U_E.Step0000_Chose_Nickname")
    }),
    h.on("ServersListMessage", function(e) {
        for (var t = 0, i = e.servers || [], n = 0, o = i.length; n < o; n += 1) {
            var s = i[n];
            t += s.charactersCount
        }
        a = !t
    }),
    h.on("IdentificationSuccessMessage", n),
    h.on("IdentificationSuccessWithLoginTokenMessage", n),
    h.on("SelectedServerDataMessage", function(e) {
        o.log("Session_Info.Choose_Server", {
            account_session_id: c
        }),
        a && o.log("F_T_U_E.Step0100_Chose_Server", {
            server_id: e.serverId
        })
    }),
    h.on("CharacterCreationResultMessage", function(e) {
        a && e.result === s.OK && o.log("F_T_U_E.Step0200_Create_First_Character")
    }),
    window.gui.playerData.on("characterSelectedSuccess", function() {
        r = window.gui.playerData.characterBaseInformations.level,
        window.dofus.send("kpiStartSession", {
            accountSessionId: window.gui.playerData.identification.accountSessionUid,
            isSubscriber: window.gui.playerData.isSubscriber()
        }),
        o.log("Session_Info.Choose_Character")
    }),
    h.on("kpiStartSessionMessage", function(e) {
        o.register(l, e.sessionId, {
            login: window.gui.playerData.loginName,
            nickname: u
        })
    }),
    h.on("kpiStartSessionErrorMessage", function() {
        console.error("kpiStartSessionErrorMessage"),
        o.register(l, null , {
            login: window.gui.playerData.loginName,
            nickname: u
        })
    }),
    h.on("CharacterLevelUpMessage", function(e) {
        o.log("User_Life_Cycle.Level_Up", {
            old_level: r
        }, {
            withEquipment: !0
        }),
        r = e.newLevel
    }),
    h.on("AchievementFinishedMessage", function(e) {
        o.log("User_Life_Cycle.Achievement_Achieved", {
            achievement_id: e.id
        })
    }),
    h.on("AchievementRewardSuccessMessage", function(e) {
        o.log("User_Life_Cycle.Achievement_Get_Reward", {
            achievement_id: e.achievementId
        })
    }),
    h.on("QuestStartedMessage", function(e) {
        o.log("User_Life_Cycle.Quest_Start", {
            quest_id: e.questId
        })
    }),
    h.on("QuestValidatedMessage", function(e) {
        o.log("User_Life_Cycle.Quest_End", {
            quest_id: e.questId
        })
    }),
    h.on("QuestObjectiveValidatedMessage", function(e) {
        var t = window.gui.playerData.quests.all[e.questId] || {}
          , i = t.stepId || 0;
        o.log("User_Life_Cycle.Quest_Step_Objective_Success", {
            quest_id: e.questId,
            objective_id: e.objectiveId,
            step_id: i
        })
    }),
    h.on("QuestStepValidatedMessage", function(e) {
        o.log("User_Life_Cycle.Quest_Step_Success", {
            quest_id: e.questId,
            step_id: e.stepId
        })
    }),
    h.on("DungeonEnteredMessage", function(e) {
        o.log("User_Life_Cycle.Donjon_Start", {
            dungeon_id: e.dungeonId
        })
    }),
    h.on("JobLevelUpMessage", function(e) {
        o.log("User_Life_Cycle.Profession_Level_Up", {
            job_id: e.jobsDescription.jobId,
            new_level: e.newLevel
        })
    }),
    h.on("GameRolePlayPlayerLifeStatusMessage", function(e) {
        e.state > 0 && o.log("User_Life_Cycle.Death")
    }),
    h.on("PartyJoinMessage", function(e) {
        o.log("social.fight_group_join", {
            group_id: e.partyId
        })
    }),
    h.on("PartyDeletedMessage", function(e) {
        o.log("social.fight_group_quit", {
            group_id: e.partyId
        })
    }),
    h.on("PartyLeaveMessage", function(e) {
        o.log("social.fight_group_quit", {
            group_id: e.partyId
        })
    }),
    h.on("PartyKickedByMessage", function(e) {
        o.log("social.fight_group_quit", {
            group_id: e.partyId
        })
    });
    var d = null ;
    h.on("GuildMembershipMessage", function(e) {
        d = e.guildInfo.guildId
    }),
    h.on("GuildJoinedMessage", function(e) {
        d = e.guildInfo.guildId,
        o.log("social.guild_join", {
            guild_id: d
        })
    }),
    h.on("GuildLeftMessage", function() {
        o.log("social.guild_quit", {
            guild_id: d
        })
    })
}
, function(e, t) {
    e.exports = {
        OK: 0,
        ERR_NO_REASON: 1,
        ERR_INVALID_NAME: 2,
        ERR_NAME_ALREADY_EXISTS: 3,
        ERR_TOO_MANY_CHARACTERS: 4,
        ERR_NOT_ALLOWED: 5,
        ERR_NEW_PLAYER_NOT_ALLOWED: 6,
        ERR_RESTRICED_ZONE: 7
    }
}
, function(e, t, i) {
    function n(e) {
        var t = p[e.contextualId] = {};
        t.monster_id = e.creatureGenericId,
        t.monster_level = e._level,
        t.monster_grade = e.creatureGrade,
        t.team_id = e.teamId
    }
    function o(e) {
        if (!(e.id >= 0)) {
            var t = p[e.id];
            t || (t = p[e.id] = {});
            var i = e.data.stats;
            t.ratio_life_remaining = Math.ceil(100 * i.lifePoints / i.maxLifePoints) / 100,
            1 === t.ratio_life_remaining && i.lifePoints !== i.maxLifePoints && (t.ratio_life_remaining = .99)
        }
    }
    function s(e) {
        for (var t = 0; t < e.results.length; t++) {
            var i = e.results[t];
            if (i.alive && !(i.id >= 0)) {
                var n = p[i.id] || {};
                n.fight_id = window.gui.fightManager.fightId,
                void 0 === n.ratio_life_remaining && (n.ratio_life_remaining = 1),
                h.log("fight_report.fight_end_alive_monster_description", n, {
                    noSessionId: !0
                })
            }
        }
    }
    function a(e) {
        if (!m) {
            var t = window.gui.playerData.id
              , i = "GameActionFightSpellCastMessage" === e._messageType || "GameActionFightCloseCombatMessage" === e._messageType;
            i && e.sourceId === t && h.log("Fight_Action.Spell_Cast_By_User", {
                spell_id: e.spellId,
                spell_level: e.spellLevel,
                fight_id: window.gui.fightManager.fightId
            })
        }
    }
    function r(e) {
        var t = 0;
        for (var i in e)
            t += e[i];
        return t
    }
    function l(e, t, i) {
        0 !== e && 1 !== e || (f[e][t] = i)
    }
    function c(e, t) {
        0 !== e && 1 !== e || (f[e][t] = 0)
    }
    function u(e) {
        for (var t = null , i = 0, n = e.results.length; i < n; i += 1) {
            var o = e.results[i];
            if (o.alive) {
                t = o.id;
                break
            }
        }
        return f[0][t] ? 0 : f[1][t] ? 1 : -1
    }
    var h = i(160)
      , d = window.dofus.connectionManager
      , p = {}
      , m = !1
      , f = {
        0: {},
        1: {}
    };
    d.on("GameFightJoinMessage", function(e) {
        return e.isSpectator ? void (m = !0) : (p = {},
        void (m = !1))
    }),
    d.on("GameFightTurnReadyRequestMessage", function() {
        if (!m) {
            var e = window.gui.fightManager.getAvailableFighters();
            for (var t in e)
                o(e[t])
        }
    }),
    d.on("messageSequence", function(e) {
        for (var t = 0; t < e.sequence.length; t += 1)
            a(e.sequence[t])
    }),
    d.on("GameActionFightSpellCastMessage", a),
    d.on("GameActionFightCloseCombatMessage", a),
    d.on("GameFightShowFighterMessage", function(e) {
        if (!m) {
            var t = e.informations;
            l(t.teamId, t.contextualId, t.stats.lifePoints),
            t.contextualId < 0 && n(t)
        }
    }),
    d.on("GameFightRemoveTeamMemberMessage", function(e) {
        m || c(e.teamId, e.charId)
    }),
    d.on("GameFightStartMessage", function() {
        if (!m) {
            var e = window.gui.fightManager;
            h.log("Fight_Report.Fight_Start", {
                fight_id: e.fightId,
                fight_type: e.fightType,
                team_0_hp: r(f[0]),
                team_1_hp: r(f[1])
            }, {
                noSessionId: !0
            })
        }
    }),
    d.on("GameFightEndMessage", function(e) {
        if (!m) {
            s(e);
            var t = u(e);
            h.log("Fight_Report.Fight_End", {
                nb_turns: window.gui.fightManager.getTurnCount() + 1,
                fight_id: window.gui.fightManager.fightId,
                winner_team_id: t
            }, {
                noSessionId: !0
            }),
            f = {
                0: {},
                1: {}
            },
            p = {},
            m = !1
        }
    })
}
, function(e, t) {
    t.STEP_START = {
        1: "F_T_U_E.Step0400_Start_Tuto_Step_1_Move",
        2: "F_T_U_E.Step0600_Start_Tuto_Step_2_Speak_To_NPC",
        3: "F_T_U_E.Step0800_Start_Tuto_Step_3_Equip_Ring",
        4: "F_T_U_E.Step1000_Start_Tuto_Step_4_Change_Map",
        5: "F_T_U_E.Step1200_Start_Tuto_Step_5_Start_Fight",
        6: "F_T_U_E.Step1400_Start_Tuto_Step_6_Chose_Starting_Position",
        7: "F_T_U_E.Step1600_Start_Tuto_Step_7_Move_In_Fight",
        8: "F_T_U_E.Step1800_Start_Tuto_Step_8_Use_Spell",
        9: "F_T_U_E.Step1900_Start_Tuto_Step_9_End_Turn",
        10: "F_T_U_E.Step2100_Start_Tuto_Step_10_Win_Fight",
        11: "F_T_U_E.Step2300_Start_Tuto_Step_11_Start_Quest",
        12: "F_T_U_E.Step2500_Start_Tuto_Step_12_Equip_Items",
        13: "F_T_U_E.Step2700_Start_Tuto_Step_13_Defeat_Monster",
        14: "F_T_U_E.Step2900_Start_Tuto_Step_14_End_Fight",
        15: "F_T_U_E.Step3100_Start_Tuto_Step_15_End_Learning"
    },
    t.STEP_END = {
        1: "F_T_U_E.Step0500_Succeed_Tuto_Step_1_Move",
        2: "F_T_U_E.Step0700_Succeed_Tuto_Step_2_Speak_To_NPC",
        3: "F_T_U_E.Step0900_Succed_Tuto_Step_3_Equip_Ring",
        4: "F_T_U_E.Step1100_Succeed_Tuto_Step_4_Change_Map",
        5: "F_T_U_E.Step1300_Succeed_Tuto_Step_5_Start_Fight",
        6: "F_T_U_E.Step1500_Succeed_Tuto_Step_6_Chose_Starting_Position",
        7: "F_T_U_E.Step1700_Succed_Tuto_Step_7_Move_In_Fight",
        8: "F_T_U_E.Step1890_Succeed_Tuto_Step_8_Use_Spell",
        9: "F_T_U_E.Step2000_Succeed_Tuto_Step_9_End_Turn",
        10: "F_T_U_E.Step2200_Succeed_Tuto_Step_10_Win_Fight",
        11: "F_T_U_E.Step2400_Succeed_Tuto_Step_11_Start_Quest",
        12: "F_T_U_E.Step2600_Succeed_Tuto_Step_12_Equip_Items",
        13: "F_T_U_E.Step2800_Succed_Tuto_Step_13_Defeat_Monster",
        14: "F_T_U_E.Step3000_Succed_Tuto_Step_14_End_Fight",
        15: "F_T_U_E.Step3200_Succeed_Tuto_Step_15_End_Learning"
    },
    t.SUB_STEP = {
        2: {
            1: "F_T_U_E.Step0630_Clic_Maitre_Pifo",
            2: "F_T_U_E.Step0660_Answer_Maitre_Pifo"
        },
        3: {
            1: "F_T_U_E.Step0820_Clic_Menu_Bag",
            2: "F_T_U_E.Step0840_Clic_Menu_Weapons",
            item2: "F_T_U_E.Step0860_Equip_Ring",
            item4: "F_T_U_E.Step0860_Equip_Ring",
            4: "F_T_U_E.Step0880_Close_Menu"
        },
        5: {
            1: "F_T_U_E.Step1230_Clic_Scarecrow",
            2: "F_T_U_E.Step1260_Clic_Attack"
        },
        6: {
            1: "F_T_U_E.Step1430_Clic_Desired_Position_Square",
            2: "F_T_U_E.Step1460_Clic_Ready_Button"
        },
        7: {
            1: "F_T_U_E.Step1630_Clic_Desired_Position_Square",
            2: "F_T_U_E.Step1660_Clic_Validate_Move"
        },
        8: {
            1: "F_T_U_E.Step1820_Clic_Attack_Button",
            2: "F_T_U_E.Step1850_Select_Target",
            3: "F_T_U_E.Step1870_Validate_Attack"
        },
        9: {
            1: "F_T_U_E.Step1950_Clic_End_Turn_Button"
        },
        10: {
            1: "F_T_U_E.Step2140_Scarecrow_Figh_End",
            2: "F_T_U_E.Step2180_Close_Fight_Summary_Window"
        },
        11: {
            1: "F_T_U_E.Step2330_Talk_To_NPC_Maitre_Pifo",
            2: "F_T_U_E.Step2360_Answer_NPC_Maitre_Pifo"
        },
        12: {
            1: "F_T_U_E.Step2510_Clic_Bag_Menu",
            2: "F_T_U_E.Step2520_Clic_Weapon_Menu",
            item7: "F_T_U_E.Step2530_Equip_Cloak",
            item0: "F_T_U_E.Step2540_Equip_Amulet",
            item3: "F_T_U_E.Step2550_Equip_Belt",
            item15: "F_T_U_E.Step2560_Equip_Shield",
            item1: "F_T_U_E.Step2570_Equip_Sword",
            item5: "F_T_U_E.Step2580_Equip_Boots",
            9: "F_T_U_E.Step2590_Quit_Bag_Menu"
        },
        13: {
            1: "F_T_U_E.Step2720_Change_Map",
            2: "F_T_U_E.Step2750_Clic_Monster_Lupus_Minimus",
            3: "F_T_U_E.Step2770_Attack_Monster_Lupus_Minimus"
        },
        14: {
            1: "F_T_U_E.Step2910_Lupus_Minimus_Figh_End",
            2: "F_T_U_E.Step2930_Win_Fight_Monster_Lupus_Minimus",
            3: "F_T_U_E.Step2960_Close_Fight_Summary_Window"
        },
        15: {
            1: "F_T_U_E.Step3130_Talk_To_NPC_Maitre_Pifo",
            2: "F_T_U_E.Step3160_Answer_NPC_Maitre_Pifo"
        }
    }
}
, function(e, t) {
    function i() {}
    function n(e, t) {
        if (u) {
            var i = new c(e);
            if (t) {
                var n = t.revenue;
                n && i.setRevenue(n.price, n.currency);
                var o = t.transactionId;
                o && (o = "string" == typeof o ? o : o.toString(),
                i.setTransactionId(o))
            }
            r.trackEvent(i)
        }
    }
    var o, s, a, r = window.Adjust, l = window.AdjustConfig, c = window.AdjustEvent, u = !1;
    r && (o = function(e) {
        if (e) {
            var t = l[e.environment] || l.EnvironmentSandbox
              , i = new l(e.appToken,t);
            i.setLogLevel(l.LogLevelVerbose),
            r.create(i),
            u = !0
        }
    }
    ,
    s = function(e, t, i) {
        n("m38gxs", {
            revenue: {
                price: e,
                currency: t
            },
            transactionId: i
        })
    }
    ,
    a = function() {
        n("806tbe")
    }
    ),
    t.initialize = o || i,
    t.trackIAPBought = s || i,
    t.trackTutorialCompleted = a || i
}
, function(e, t, i) {
    var n = i(49)
      , o = {
        BasicAckMessage: null ,
        BasicLatencyStatsRequestMessage: null ,
        BasicNoOperationMessage: null ,
        SequenceNumberRequestMessage: null
    }
      , s = {
        BasicLatencyStatsMessage: null ,
        SequenceNumberMessage: null
    };
    n.on("data", function(e) {
        if (null !== o[e._messageType]) {
            var t = "background-color: #BFA;";
            e._messageType && e._messageType.indexOf("ErrorMessage") === -1 || (t = "background-color: #F00; color: #FFF;"),
            console.log("[DOFUS PROXY] received: %c" + e._messageType, t, e)
        }
    }),
    n.on("messageSequence", function(e) {
        var t = "background-color: #CB98E7;";
        console.log("[DOFUS PROXY] received: %cmessageSequence", t, e)
    }),
    n.on("open", function() {
        console.log("[DOFUS PROXY] %c Connected to remote server ", "background-color: #FF0;")
    }),
    n.on("reconnecting", function() {
        console.log("[DOFUS PROXY] %c Reconnecting to remote server... ", "background-color: #FF0;")
    }),
    n.on("reconnected", function() {
        console.log("[DOFUS PROXY] %c Reconnected to remote server ", "background-color: #FF0;")
    }),
    n.on("error", function(e) {
        console.error("[DOFUS PROXY] ", e)
    }),
    n.on("disconnect", function() {
        console.log("[DOFUS PROXY] %c disconnecting ", "background-color: #FF0;")
    }),
    n.on("send", function(e) {
        if ("sendMessage" === e.call) {
            if (s[e.data.data.type])
                return;
            return void console.log("[DOFUS PROXY]     send: %c" + e.data.data.type, "background-color: #6DF;", e.data.data.data)
        }
        console.log("[DOFUS PROXY]     send: %c" + e.call, "background-color: #6DF;", e.data)
    })
}
, function(e, t, i) {
    i(184),
    e.exports = i(185),
    i(214),
    i(215),
    i(216),
    i(293)
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            t.setStyles({
                left: o.mapLeft + "px",
                top: o.mapTop + "px",
                width: o.mapWidth + "px",
                height: o.mapHeight + "px"
            })
        }
        d.call(this, "div", {
            className: "foreground",
            hidden: !0
        }),
        this.tapOptions = {},
        this.fightIsUserTurn = !1,
        this.isTacticMode = !1,
        this.locked = !1,
        this.lockMap = {};
        var t = this
          , i = window.gui;
        i.once("connected", function() {
            t._setupInfoBox(),
            t._createConfirmBox(),
            t._setupDrop(),
            t._setupTouchInteraction(),
            t._setupBorderArrow(),
            e(),
            i.timeline.setStyles({
                top: o.mapHeight - 150 + "px",
                left: o.mapWidth + "px"
            }),
            t._initHandlers(this),
            this.on("disconnect", function() {
                t.tapOptions = {},
                t.fightIsUserTurn = !1,
                t.locked = !1,
                t.lockMap = {},
                t.hideInfobox(),
                t.confirmBox.close(),
                t.minMaxSelector.hide(),
                t.hide()
            })
        }),
        i.on("resize", e)
    }
    var o = i(24).dimensions
      , s = i(186)
      , a = i(85)
      , r = i(25)
      , l = i(26).inherits
      , c = i(201)
      , u = i(84).playUiSound
      , h = i(213)
      , d = i(190)
      , p = i(35).getText
      , m = i(35).processText;
    l(n, d),
    e.exports = n,
    n.prototype._setupDrop = function() {
        function e(e) {
            var i = window.gui.playerData.inventory.objects[t]
              , n = i ? i.getName() : t;
            window.gui.openConfirmPopup({
                title: p("ui.common.confirm"),
                message: m(p("ui.common.confirmationDropItem"), e, n),
                cb: function(i) {
                    i && (window.dofus.sendMessage("ObjectDropMessage", {
                        objectUID: t,
                        quantity: e
                    }),
                    u("DROP_ITEM_1"))
                }
            })
        }
        var t, i = this, n = this.minMaxSelector = window.gui.windowsContainer.appendChild(new c);
        n.on("confirm", e),
        s.setDroppable(this, ["itemContextMenu", "equipment"]),
        this.on("drop", function(o, s, a) {
            switch (s) {
            case "itemContextMenu":
                var r = i.convertScreenToCanvasCoordinate(a.x, a.y);
                window.isoEngine.useItem(r.x, r.y, o.item.objectUID);
                break;
            case "equipment":
                t = o.itemInstance.objectUID;
                var l = o.itemInstance.quantity;
                1 === l ? e(1) : n.open({
                    min: 1,
                    max: l,
                    x: a.x,
                    y: a.y
                })
            }
        })
    }
    ,
    n.prototype._initHandlers = function(e) {
        function t() {
            o.tapOptions.mode = "fight",
            o.tapOptions.possiblePlacements && delete o.tapOptions.possiblePlacements
        }
        function i() {
            o.fightIsUserTurn && (o.fightIsUserTurn = !1,
            o.confirmBox.hide(),
            window.isoEngine.clearUserMovementZone())
        }
        function n(t) {
            var i = o.fightIsUserTurn = e.playerData.characters.canControlCharacterId(t.id)
              , n = window.isoEngine;

            if(i)
                window.top.client.alertTurn(e.playerData.characterBaseInformations.name);

            if (n.fightTurnStart(i),
            n.clearHighlights(),
            i && r.soundOnPlayerTurnStart && u("PLAYER_TURN"),
            !n.mapRenderer.isReady)
                return n.mapRenderer.once("ready", function() {
                    o._displayUserZones()
                })
        }
        var o = this;
        e.on("sendAllFightEvent", function() {
            o._displayUserZones()
        }),
        e.on("GameFightPlacementPossiblePositionsMessage", function(e) {
            o.tapOptions.mode = "fightPlacement",
            e.teamNumber === h.TEAM_CHALLENGER ? o.tapOptions.possiblePlacements = e.positionsForChallengers : e.teamNumber === h.TEAM_DEFENDER ? o.tapOptions.possiblePlacements = e.positionsForDefenders : o.tapOptions.possiblePlacements && delete o.tapOptions.possiblePlacements
        }),
        e.on("GameFightJoinMessage", function(e) {
            return e.isFightStarted ? t() : void (o.tapOptions.mode = "fightPlacement")
        }),
        e.on("GameFightStartMessage", t),
        e.on("GameFightResumeMessage", t),
        e.on("GameFightResumeWithSlavesMessage", t),
        e.on("GameFightTurnStartPlayingMessage", function() {
            o.fightIsUserTurn = !0
        }),
        e.on("GameFightTurnStartMessage", n),
        e.on("GameFightTurnResumeMessage", n),
        e.on("GameFightTurnStartSlaveMessage", n),
        e.on("GameFightTurnEndMessage", i),
        e.on("GameFightEndMessage", i),
        e.on("spellSlotSelected", function(e) {
            o.selectSpell(e)
        }),
        e.on("spellSlotDeselected", function() {
            o.deselectSpell()
        }),
        e.playerData.on("movementPointsCurrentUpdated", function() {
            this.isFighting && o.fightIsUserTurn && (o.isSpellSelected() || window.isoEngine.displayUserMovementZone())
        })
    }
    ,
    n.prototype._displayUserZones = function() {
        var e = this.isSpellSelected();
        this.fightIsUserTurn ? e ? this._displaySpellRange() : window.isoEngine.displayUserMovementZone() : e && this._displaySpellRange()
    }
    ,
    n.prototype._displaySpellRange = function() {
        var e = this.tapOptions
          , t = e.spellId
          , i = window.gui.playerData.characters.getControlledCharacter()
          , n = i.spellData.spells[t]
          , o = n.getZoneEffectWhenCasting()
          , s = {
            spellId: t,
            castInDiagonal: n.getProperty("castInDiagonal"),
            castInLine: n.getProperty("castInLine"),
            castTestLos: n.getProperty("castTestLos"),
            minRange: n.getProperty("minRange"),
            range: n.getProperty("range"),
            apCost: n.getProperty("apCost", n.level),
            needFreeCell: n.getProperty("needFreeCell"),
            needFreeTrapCell: n.getProperty("needFreeTrapCell"),
            needTakenCell: n.getProperty("needTakenCell"),
            name: n.getName(),
            zoneEffect: o
        };
        e.spell = n,
        window.isoEngine.setCurrentSpell(s),
        window.isoEngine.displaySpellRange()
    }
    ,
    n.prototype.refreshSpellRange = function() {
        this.isSpellSelected() && this._displaySpellRange()
    }
    ,
    n.prototype.selectSpell = function(e) {
        this.tapOptions.spellId = e,
        this.tapOptions.characterId = window.gui.playerData.characters.controlledCharacterId,
        "fight" === this.tapOptions.mode && this._displayUserZones()
    }
    ,
    n.prototype.deselectSpell = function() {
        void 0 !== this.tapOptions.spellId && (this.confirmBox.close(),
        delete this.tapOptions.spellId),
        "fight" === this.tapOptions.mode && this._displayUserZones()
    }
    ,
    n.prototype.isSpellSelected = function() {
        return !!this.tapOptions.spellId || 0 === this.tapOptions.spellId
    }
    ,
    n.prototype.lock = function(e) {
        return e ? (this.lockMap[e] = !0,
        this.locked = !0,
        void this.cancelTransform()) : console.error(new Error("Foreground.lock: no reason provided"))
    }
    ,
    n.prototype.unlock = function(e) {
        if (!e)
            return console.error(new Error("Foreground.unlock: no reason provided"));
        this.lockMap[e] = !1;
        for (var t = Object.keys(this.lockMap), i = 0; i < t.length; i++)
            if (this.lockMap[t[i]])
                return;
        this.locked = !1
    }
    ,
    n.prototype.changeGameContext = function(e) {
        e === a.ROLE_PLAY ? this.tapOptions.mode = "roleplay" : delete this.tapOptions.mode,
        this.isTacticMode && window.isoEngine.toggleTacticMode(e === a.FIGHT)
    }
    ,
    n.prototype.toggleTacticMode = function(e) {
        return e = void 0 === e ? !this.isTacticMode : e,
        this.isTacticMode === e ? e : (this.isTacticMode = e,
        window.isoEngine.toggleTacticMode(e),
        e)
    }
}
, function(e, t, i) {
    function n() {
        d = !1,
        w = b = null ,
        f = g = v = null
    }
    function o(e, t) {
        var i = 1.5
          , n = 0
          , o = 0
          , s = 0;
        void 0 !== f.customScale && null !== f.customScale && (i = f.customScale),
        void 0 !== f.customXOffset && null !== f.customXOffset && (n = f.customXOffset),
        void 0 !== f.customYOffset && null !== f.customYOffset && (o = f.customYOffset),
        void 0 !== f.customRotation && null !== f.customRotation && (s = f.customRotation);
        var a = e - T.x - p + n
          , r = t - T.y - m + o;
        f.setStyle("webkitTransform", "translate3d(" + a + "px, " + r + "px, 0) scale(" + i + ") rotateZ(" + s + "deg)")
    }
    function s(e, t) {
        a.removeListener("dragMove", o),
        h.isDragging = !1,
        y && (y.delClassNames("dragOver", "notAllowed"),
        y = null ),
        S.x = e,
        S.y = t;
        var i = document.elementFromPoint(e, t);
        if (i) {
            var n = document.createEvent("Event");
            n.initEvent("drop", !0, !0),
            i.dispatchEvent(n)
        }
        l.stop()
    }
    i(187);
    var a = i(188)
      , r = i(16).EventEmitter
      , l = i(189)
      , c = i(31)
      , u = i(190)
      , h = new r
      , d = !1;
    h.isDragging = !1;
    var p, m, f, g, _, v, y = null , w = null , b = null , C = {
        x: 0,
        y: 0
    }, I = {
        left: 0,
        top: 0
    }, T = {
        x: 0,
        y: 0
    }, S = {
        x: 0,
        y: 0
    };
    h.init = function(e) {
        _ = new u("div",{
            className: "dragElement"
        }),
        _.icon = _.createChild("div", {
            className: "icon"
        }),
        e.appendChild(_),
        _.hide(),
        window.gui.wBody.on("dom.drop", function() {
            c.tween(f, {
                webkitTransform: "translate3d(0,0,0) scale(1)"
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                v.onDragClassName && f.delClassNames(v.onDragClassName),
                h.isLostDrop = !0,
                f !== _ ? (g.appendChild(f),
                f.delClassNames("customDragElement"),
                f.setStyles(I),
                f.emit("dragEnd", S.x, S.y)) : (_.hide(),
                w.emit("dragEnd", S.x, S.y)),
                h.emit("dragEnd", w, w._dragManager.source, b),
                _.hide(),
                n()
            })
        })
    }
    ,
    h.setElementSource = function(e, t) {
        e._dragManager && (e._dragManager.source = t)
    }
    ,
    h.isDraggable = function(e) {
        return e._dragManager && e._dragManager.draggable
    }
    ,
    h.setDraggable = function(e, t, i, n, r) {
        e._dragManager = e._dragManager || {},
        e._dragManager.draggable || (e._dragManager.draggable = !0,
        e._dragManager.source = i,
        r = r || {},
        t = t || {},
        a.initializeListeners(e, r),
        e.on("_dragStart", function(i, u) {
            if (f = r.dragElement ? e : _,
            !d && (!t.prepareForDrag || t.prepareForDrag(n, f))) {
                d = !0,
                h.isDragging = !0,
                w = e,
                b = n,
                v = t;
                var y = e.rootElement.getBoundingClientRect()
                  , S = {
                    left: y.left,
                    top: y.top,
                    width: r.containerWidth || y.width,
                    height: r.containerHeight || y.height
                };
                if (C.x = S.left,
                C.y = S.top,
                r.dragElement)
                    g = e.getParent(),
                    window.gui.gameGuiContainer.appendChild(e),
                    I.left = e.getStyle("left"),
                    I.top = e.getStyle("top"),
                    f.setStyles({
                        left: S.left + "px",
                        top: S.top + "px",
                        webkitTransform: "translate3d(0,0,0)"
                    }),
                    f.addClassNames("customDragElement");
                else {
                    I.left = I.top = 0,
                    f.setStyles({
                        left: S.left + "px",
                        top: S.top + "px",
                        width: S.width + "px",
                        height: S.height + "px",
                        webkitTransform: "translate3d(0,0,0)"
                    });
                    var A = v.styles || {};
                    A.backgroundImage = v.backgroundImage || A.backgroundImage || "none",
                    f.icon.setStyles(A)
                }
                v.onDragClassName && f.addClassNames(v.onDragClassName),
                f.show(),
                p = S.left + Math.floor(S.width / 2) - i,
                m = S.top + Math.floor(S.height / 2) - u,
                T.x = i,
                T.y = u,
                c.tween(f, {
                    webkitTransform: "translate3d(" + -p + "px," + -m + "px,0) scale(1.5)"
                }, {
                    time: 100,
                    easing: "ease-out"
                }, function() {
                    a.on("dragMove", o),
                    r.noHover || l.start(),
                    e.emit("dragStart"),
                    h.emit("dragStart", w, w._dragManager.source, b)
                }),
                a.once("dragEnd", s)
            }
        }))
    }
    ,
    h.setDragEnable = function(e, t) {
        e._dragManager && (e._dragManager.enable = t)
    }
    ,
    h.enableDrag = function(e) {
        h.setDragEnable(e, !0)
    }
    ,
    h.disableDrag = function(e) {
        h.setDragEnable(e, !1)
    }
    ,
    h.cancelDragFromSource = function(e) {
        w && e === w._dragManager.source && h.cancelDrag()
    }
    ,
    h.cancelDrag = function() {
        v && v.onDragClassName && f.delClassNames(v.onDragClassName),
        a.cancel()
    }
    ,
    h.setDroppable = function(e, t, i) {
        function o() {
            var e = i.isAllowed
              , n = !0;
            return e && (n = e()),
            t.indexOf(w._dragManager.source) !== -1 && n
        }
        e._dragManager = e._dragManager || {},
        e._dragManager.droppable || (e._dragManager.droppable = !0,
        i = i || {},
        l(e),
        e.on("touchenter", function() {
            h.isDragging && o() && (y = e,
            e.addClassNames("dragOver"),
            e.emit("dragEnter", w, w._dragManager.source, b))
        }),
        e.on("touchleave", function() {
            h.isDragging && o() && (y = null ,
            e.delClassNames("dragOver"),
            e.emit("dragLeave"))
        }),
        e.on("dom.drop", function(t) {
            if (o()) {
                t.stopPropagation();
                var s, a;
                if (i.matchPositionOnDrop) {
                    var r = e.rootElement.getBoundingClientRect();
                    s = r.left - T.x + Math.floor(r.width / 2) - p,
                    a = r.top - T.y + Math.floor(r.height / 2) - m
                } else
                    s = S.x - T.x,
                    a = S.y - T.y;
                e.emit("beforeDragEnd"),
                c.tween(f, {
                    webkitTransform: "translate3d(" + s + "px," + a + "px,0) scale(1)"
                }, {
                    time: 100,
                    easing: "ease-out"
                }, function() {
                    b = b || {},
                    b.x = S.x,
                    b.y = S.y,
                    v.onDragClassName && f.delClassNames(v.onDragClassName),
                    f !== _ ? (g.appendChild(f),
                    f.delClassNames("customDragElement"),
                    f.setStyles({
                        left: I.left,
                        top: I.top,
                        webkitTransform: "translate3d(0px,0px, 0)"
                    }),
                    f.emit("dragEnd", s, a)) : w.emit("dragEnd", s, a),
                    h.isLostDrop = !1,
                    h.emit("dragEnd", w, w._dragManager.source, b),
                    e.delClassNames("dragOver"),
                    e.emit("drop", w, w._dragManager.source, b),
                    _.hide(),
                    n()
                })
            }
        }))
    }
    ,
    e.exports = h
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        g = !1,
        c = null
    }
    function o(e) {
        var t = d(e);
        if (!g) {
            if (Math.abs(t.x - r) < v && Math.abs(t.y - l) < v)
                return;
            if (!p.requestInteractionHandle(m))
                return m.cancel();
            g = !0,
            c.emit("_dragStart", t.x, t.y)
        }
        c.emit("dragMove", t.x, t.y),
        m.emit("dragMove", t.x, t.y)
    }
    function s() {
        _ || (_ = !0,
        window.gui.wBody.on("dom.touchmove", o),
        window.gui.wBody.on("dom.touchend", u))
    }
    function a() {
        _ && (_ = !1,
        window.gui.wBody.removeListener("dom.touchmove", o),
        window.gui.wBody.removeListener("dom.touchend", u))
    }
    var r, l, c, u, h = i(16).EventEmitter, d = i(33).getPosition, p = i(47), m = e.exports = new h, f = 5, g = !1, _ = !1, v = f;
    u = function(e) {
        var t = d(e);
        a(),
        g && (n(),
        m.emit("dragEnd", t.x, t.y))
    }
    ,
    m.cancel = function() {
        a(),
        g && (n(),
        m.emit("dragEnd", 0, 0),
        p.abortInteraction())
    }
    ,
    m.initializeListeners = function(e, t) {
        e.allowDomEvents();
        var i = t.hasOwnProperty("sensitivity") ? t.sensitiviy : f;
        e.on("dom.touchstart", function(n) {
            if (e._dragManager.enable && !_) {
                v = i;
                var a = d(n);
                r = a.x,
                l = a.y,
                s(),
                c = e,
                t.dragOnTouchstart && (v = 0,
                o(n))
            }
        }),
        e._dragManager.enable = !0
    }
}
, function(e, t, i) {
    function n(e) {
        var t = w(e);
        d = b.x = t.x,
        p = b.y = t.y,
        b.touchCount = t.touchCount
    }
    function o() {
        C = !0
    }
    function s() {
        if (C) {
            C = !1;
            var e = document.elementFromPoint(d, p);
            if (!e)
                return void (C = !0);
            if (e === _)
                return void o();
            _ = e,
            f = b.touchedElements = [];
            var t = document.createEvent("Event");
            t.initEvent("touching", !0, !0),
            e.dispatchEvent(t)
        }
    }
    function a(e) {
        n(e),
        (Math.abs(d - I) > 15 || Math.abs(p - T) > 15 || e.timeStamp - S > 50) && (I = d,
        T = p,
        s()),
        S = e.timeStamp
    }
    function r(e) {
        var t = w(e);
        b.touchCount = t.touchCount,
        0 === t.touchCount && y()
    }
    function l() {
        f.push(v),
        g = b.topElement = f[0];
        for (var e = f.length - 1, t = m.length - 1, i = Math.max(e, t); i >= 0; i -= 1) {
            var n = m[t]
              , o = f[e];
            n !== o && (n && n.emit("touchleave", b),
            o && o.emit("touchenter", b)),
            t -= 1,
            e -= 1
        }
        m = f,
        C = !0
    }
    function c() {
        h || (h = !0,
        m = [],
        f = [],
        _ = null ,
        g = null ,
        C = !0,
        v.on("dom.touchmove", a),
        v.on("dom.touchend", r))
    }
    function u(e) {
        e._hoverBehavior || (e._hoverBehavior = !0,
        e.allowDomEvents(),
        e.on("dom.touching", function(t) {
            return g !== e || f.length ? void f.push(e) : (t.stopPropagation(),
            o())
        }))
    }
    var h, d, p, m, f, g, _, v, y, w = i(33).getPosition, b = {
        x: 0,
        y: 0,
        touchCount: 0,
        topElement: null ,
        touchedElements: null
    }, C = !1, I = 0, T = 0, S = 0;
    y = function() {
        h && (h = !1,
        v.removeListener("dom.touchend", r),
        v.removeListener("dom.touchmove", a))
    }
    ,
    e.exports = u,
    u.start = c,
    u.stop = y,
    u.initialize = function(e) {
        return window._hoverBehavior ? console.error("hover behavior initialised more than one time.") : (window._hoverBehavior = !0,
        v = e,
        void v.on("dom.touching", l))
    }
}
, function(e, t, i) {
    function n(e) {
        return u.apply([], e).filter(Boolean)
    }
    function o(e, t) {
        var i, n = document.createElement(e);
        if (t && t.attr)
            for (i in t.attr)
                n.setAttribute(i, t.attr[i]);
        return n
    }
    function s(e, t) {
        r.call(this),
        this._elementIsVisible = !0,
        this._currentTextContent = null ,
        this.rootElement = null ,
        this._text = null ,
        this._name = null ,
        this._childrenList = [],
        this._childrenMap = {},
        this._contentType = c.EMPTY,
        this._parent = null ,
        e && this._assign(e, t)
    }
    var a = i(26).inherits
      , r = i(191).EventEmitter
      , l = i(192);
    i(193);
    var c = {
        EMPTY: null ,
        WUI: "wui",
        TEXT: "text",
        HTML: "html"
    }
      , u = Array.prototype.concat;
    a(s, r),
    e.exports = s,
    s.prototype._assign = function(e, t) {
        if (this.rootElement)
            throw new Error("WuiDom has already an element assigned");
        if ("string" == typeof e)
            this.rootElement = o(e, t),
            t && t.hasOwnProperty("text") && this.setText(t.text);
        else {
            if (!(e instanceof window.Element))
                throw new Error("WuiDom.assign requires the given argument to be a DOM Element or tagName.");
            this.rootElement = e
        }
        t = t || {},
        t.hidden && this.hide(),
        "name"in t && (this._name = String(t.name)),
        "className"in t && this.addClassNames(t.className),
        "style"in t && this.setStyles(t.style || {})
    }
    ,
    s.prototype.assign = function(e, t) {
        this._assign(e, t)
    }
    ,
    s.prototype.getWuiName = function() {
        return this._name
    }
    ,
    s.prototype.removeChild = function(e) {
        var t = e instanceof s;
        if (!t && (e = this._childrenMap[e],
        !e))
            throw new Error("WuiDom: Given name is not a current child");
        var i = this._childrenList.indexOf(e);
        if (i === -1)
            throw new Error("WuiDom: Not a current child");
        return this.rootElement.removeChild(e.rootElement),
        this._childrenList.splice(i, 1),
        this._childrenMap.hasOwnProperty(e._name) && delete this._childrenMap[e._name],
        e._parent = null ,
        e
    }
    ,
    s.prototype._unsetParent = function() {
        this._parent && this._parent.removeChild(this)
    }
    ,
    s.prototype._setParent = function(e) {
        if (e !== this._parent) {
            if (this._name) {
                if (e._childrenMap[this._name])
                    throw new Error("WuiDom: Parent already has a child with this name");
                e._childrenMap[this._name] = this
            }
            this._parent = e
        }
    }
    ,
    s.prototype.getParent = function() {
        return this._parent
    }
    ,
    s.prototype.appendChild = function(e) {
        if (this._contentType && this._contentType !== c.WUI && this._clearLinearContent(),
        this === e._parent) {
            var t = this._childrenList.indexOf(e);
            t !== -1 && this._childrenList.splice(t, 1)
        } else
            e._unsetParent(),
            e._setParent(this);
        return this._childrenList.push(e),
        this.rootElement.appendChild(e.rootElement),
        e.rebindTouchListeners(),
        this._contentType = c.WUI,
        e
    }
    ,
    s.prototype.createChild = function(e, t) {
        return this.appendChild(new s(e,t))
    }
    ,
    s.prototype.appendTo = function(e) {
        e.appendChild(this)
    }
    ,
    s.prototype.insertChildBefore = function(e, t) {
        this._contentType && this._contentType !== c.WUI && this._clearLinearContent();
        var i;
        if (this === e._parent) {
            var n = this._childrenList.indexOf(e);
            n !== -1 && this._childrenList.splice(n, 1)
        } else
            e._unsetParent();
        if (t) {
            if (i = this._childrenList.indexOf(t),
            i === -1)
                throw new Error("WuiDom: Wanted sibling is not a child")
        } else
            i = this._childrenList.length;
        return e._setParent(this),
        this.rootElement.insertBefore(e.rootElement, t && t.rootElement),
        e.rebindTouchListeners(),
        this._childrenList.splice(i, 0, e),
        this._contentType = c.WUI,
        e
    }
    ,
    s.prototype.insertBefore = function(e) {
        if (!e._parent)
            throw new Error("WuiDom: sibling has no parent");
        return e._parent.insertChildBefore(this, e),
        e
    }
    ,
    s.prototype.insertAsFirstChild = function(e) {
        var t = this._childrenList[0];
        return t ? this.insertChildBefore(e, t) : this.appendChild(e)
    }
    ,
    s.prototype.getChildren = function() {
        return this._childrenList.concat()
    }
    ,
    s.prototype.getChildCount = function() {
        return this._childrenList.length
    }
    ,
    s.prototype.getChild = function(e) {
        return this._childrenMap[e]
    }
    ,
    s.prototype._clearLinearContent = function() {
        this._text = null ,
        this._currentTextContent = null ,
        this.rootElement.innerHTML = ""
    }
    ,
    s.prototype.setHtml = function(e) {
        this._contentType === c.WUI && this._destroyChildren(),
        this._contentType === c.TEXT && this._clearLinearContent(),
        this.rootElement.innerHTML = e,
        this._contentType = c.HTML
    }
    ,
    s.prototype.setText = function(e) {
        this._contentType === c.WUI && this._destroyChildren(),
        this._contentType === c.HTML && this._clearLinearContent(),
        null !== e && void 0 !== e && (e = e.valueOf(),
        this._text || (this._text = document.createTextNode(""),
        this.rootElement.appendChild(this._text)),
        e !== this._currentTextContent && (this._currentTextContent = e,
        this._text.nodeValue = e),
        this._contentType = c.TEXT)
    }
    ,
    s.prototype.getText = function() {
        return this._currentTextContent
    }
    ,
    s.prototype.setStyle = function(e, t) {
        this.rootElement.style[e] = t
    }
    ,
    s.prototype.setStyles = function(e) {
        var t = this.rootElement.style;
        for (var i in e)
            t[i] = e[i]
    }
    ,
    s.prototype.unsetStyle = function(e) {
        this.rootElement.style[e] = ""
    }
    ,
    s.prototype.getStyle = function(e) {
        return this.rootElement.style[e]
    }
    ,
    s.prototype.getComputedStyle = function(e) {
        var t = window.getComputedStyle(this.rootElement);
        return t ? t.getPropertyValue(e) : null
    }
    ,
    s.prototype.getComputedStyles = function() {
        var e = window.getComputedStyle(this.rootElement);
        if (!e)
            return {};
        for (var t = {}, i = 0, n = arguments.length; i < n; i += 1) {
            var o = arguments[i];
            t[o] = e.getPropertyValue(o)
        }
        return t
    }
    ,
    s.prototype.getClassNames = function() {
        return n(this.rootElement.classList)
    }
    ,
    s.prototype.hasClassName = function(e) {
        return this.rootElement.classList.contains(e)
    }
    ,
    s.prototype.setClassNames = function() {
        this.rootElement.className = "";
        var e = this.rootElement.classList;
        e.add.apply(e, n(arguments))
    }
    ,
    s.prototype.addClassNames = function() {
        var e = this.rootElement.classList;
        e.add.apply(e, n(arguments))
    }
    ,
    s.prototype.replaceClassNames = function(e, t) {
        var i = this.rootElement.classList;
        i.remove.apply(i, n(e)),
        i.add.apply(i, n(t))
    }
    ,
    s.prototype.delClassNames = function() {
        var e = this.rootElement.classList;
        e.remove.apply(e, n(arguments))
    }
    ,
    s.prototype.toggleClassNames = function(e, t) {
        for (var i = 0; i < e.length; i += 1)
            this.toggleClassName(e[i], t)
    }
    ,
    s.prototype.toggleClassName = function(e, t) {
        return t === !0 || t === !1 ? this.rootElement.classList.toggle(e, t) : this.rootElement.classList.toggle(e)
    }
    ,
    s.prototype._removeDom = function() {
        var e = this.rootElement;
        e && (e.remove(),
        this.rootElement = null )
    }
    ,
    s.prototype._destroyChildren = function() {
        var e = this._childrenList.concat();
        this._childrenList = [],
        this._childrenMap = {};
        for (var t = 0, i = e.length; t < i; t += 1) {
            var n = e[t];
            n.emit("destroy"),
            n._parent = null ,
            n._destroyChildren(),
            n._removeDom(),
            n.removeAllListeners()
        }
    }
    ,
    s.prototype.clearContent = function() {
        switch (this._contentType) {
        case c.HTML:
        case c.TEXT:
            this._clearLinearContent();
            break;
        case c.WUI:
            this._destroyChildren()
        }
        this._contentType = c.EMPTY,
        this.emit("cleared")
    }
    ,
    s.prototype.destroy = function() {
        this.emit("destroy"),
        this._unsetParent(),
        this._destroyChildren(),
        this._removeDom(),
        this.removeAllListeners()
    }
    ,
    s.prototype.showMethod = function() {
        this.rootElement.style.display = ""
    }
    ,
    s.prototype.hideMethod = function() {
        this.rootElement.style.display = "none"
    }
    ,
    s.prototype.show = function() {
        this._elementIsVisible || (this._elementIsVisible = !0,
        this.showMethod(),
        this.emit("show"))
    }
    ,
    s.prototype.hide = function() {
        this._elementIsVisible && (this._elementIsVisible = !1,
        this.hideMethod(),
        this.emit("hide"))
    }
    ,
    s.prototype.toggleDisplay = function(e) {
        return void 0 === e && (e = !this._elementIsVisible),
        e ? this.show() : this.hide(),
        !!e
    }
    ,
    s.prototype.isVisible = function(e) {
        return !!this._elementIsVisible && (!e || !this._parent || this._parent.isVisible(!0))
    }
    ,
    s.prototype.rebindTouchListeners = function() {
        if (this.domListeners) {
            var e = this.rootElement;
            for (var t in this.domListeners)
                if (t.match(/^touch/)) {
                    var i = this.domListeners[t];
                    for (var n in i) {
                        var o = i[n];
                        e.removeEventListener(n, o),
                        e.addEventListener(n, o)
                    }
                }
        }
    }
    ,
    s.prototype.bindToTome = function(e, t) {
        function i(e) {
            t(this.valueOf(), e)
        }
        var n = this;
        t || (t = function(e) {
            n.setText(e)
        }
        ),
        e.on("readable", i),
        t(e.valueOf()),
        this.on("destroy", function() {
            e.removeListener("readable", i)
        })
    }
    ,
    s.prototype.allowDomEvents = function() {
        this.domListeners || (this.domListeners = {},
        this.on("newListener", l["new"]),
        this.on("removeListener", l.remove),
        this.on("destroy", l.destroy))
    }
}
, function(e, t) {
    function i() {
        this._events = this._events || {},
        this._maxListeners = this._maxListeners || void 0
    }
    function n(e) {
        return "function" == typeof e
    }
    function o(e) {
        return "number" == typeof e
    }
    function s(e) {
        return "object" == typeof e && null !== e
    }
    function a(e) {
        return void 0 === e
    }
    e.exports = i,
    i.EventEmitter = i,
    i.prototype._events = void 0,
    i.prototype._maxListeners = void 0,
    i.defaultMaxListeners = 10,
    i.prototype.setMaxListeners = function(e) {
        if (!o(e) || e < 0 || isNaN(e))
            throw TypeError("n must be a positive number");
        return this._maxListeners = e,
        this
    }
    ,
    i.prototype.emit = function(e) {
        var t, i, o, r, l, c;
        if (this._events || (this._events = {}),
        "error" === e && (!this._events.error || s(this._events.error) && !this._events.error.length)) {
            if (t = arguments[1],
            t instanceof Error)
                throw t;
            throw TypeError('Uncaught, unspecified "error" event.')
        }
        if (i = this._events[e],
        a(i))
            return !1;
        if (n(i))
            switch (arguments.length) {
            case 1:
                i.call(this);
                break;
            case 2:
                i.call(this, arguments[1]);
                break;
            case 3:
                i.call(this, arguments[1], arguments[2]);
                break;
            default:
                r = Array.prototype.slice.call(arguments, 1),
                i.apply(this, r)
            }
        else if (s(i))
            for (r = Array.prototype.slice.call(arguments, 1),
            c = i.slice(),
            o = c.length,
            l = 0; l < o; l++)
                c[l].apply(this, r);
        return !0
    }
    ,
    i.prototype.addListener = function(e, t) {
        var o;
        if (!n(t))
            throw TypeError("listener must be a function");
        return this._events || (this._events = {}),
        this._events.newListener && this.emit("newListener", e, n(t.listener) ? t.listener : t),
        this._events[e] ? s(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t,
        s(this._events[e]) && !this._events[e].warned && (o = a(this._maxListeners) ? i.defaultMaxListeners : this._maxListeners,
        o && o > 0 && this._events[e].length > o && (this._events[e].warned = !0,
        console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e].length),
        "function" == typeof console.trace && console.trace())),
        this
    }
    ,
    i.prototype.on = i.prototype.addListener,
    i.prototype.once = function(e, t) {
        function i() {
            this.removeListener(e, i),
            o || (o = !0,
            t.apply(this, arguments))
        }
        if (!n(t))
            throw TypeError("listener must be a function");
        var o = !1;
        return i.listener = t,
        this.on(e, i),
        this
    }
    ,
    i.prototype.removeListener = function(e, t) {
        var i, o, a, r;
        if (!n(t))
            throw TypeError("listener must be a function");
        if (!this._events || !this._events[e])
            return this;
        if (i = this._events[e],
        a = i.length,
        o = -1,
        i === t || n(i.listener) && i.listener === t)
            delete this._events[e],
            this._events.removeListener && this.emit("removeListener", e, t);
        else if (s(i)) {
            for (r = a; r-- > 0; )
                if (i[r] === t || i[r].listener && i[r].listener === t) {
                    o = r;
                    break
                }
            if (o < 0)
                return this;
            1 === i.length ? (i.length = 0,
            delete this._events[e]) : i.splice(o, 1),
            this._events.removeListener && this.emit("removeListener", e, t)
        }
        return this
    }
    ,
    i.prototype.removeAllListeners = function(e) {
        var t, i;
        if (!this._events)
            return this;
        if (!this._events.removeListener)
            return 0 === arguments.length ? this._events = {} : this._events[e] && delete this._events[e],
            this;
        if (0 === arguments.length) {
            for (t in this._events)
                "removeListener" !== t && this.removeAllListeners(t);
            return this.removeAllListeners("removeListener"),
            this._events = {},
            this
        }
        if (i = this._events[e],
        n(i))
            this.removeListener(e, i);
        else if (i)
            for (; i.length; )
                this.removeListener(e, i[i.length - 1]);
        return delete this._events[e],
        this
    }
    ,
    i.prototype.listeners = function(e) {
        var t;
        return t = this._events && this._events[e] ? n(this._events[e]) ? [this._events[e]] : this._events[e].slice() : []
    }
    ,
    i.prototype.listenerCount = function(e) {
        if (this._events) {
            var t = this._events[e];
            if (n(t))
                return 1;
            if (t)
                return t.length
        }
        return 0
    }
    ,
    i.listenerCount = function(e, t) {
        return e.listenerCount(t)
    }
}
, function(e, t) {
    function i() {
        s = Date.now()
    }
    function n() {
        s = 0
    }
    function o() {
        return 0 !== s && Date.now() - s < a
    }
    var s = 0
      , a = 500
      , r = "dom";
    t["new"] = function(e) {
        var t = this
          , a = e.split(".");
        if (a[0] === r) {
            var l = a[1];
            if (l && !this.domListeners[l])
                switch (l) {
                case "touchstart":
                    var c = function(e) {
                        o() || 1 !== e.which || t.emit("dom.touchstart", e)
                    }
                      , u = function(e) {
                        i(),
                        t.emit("dom.touchstart", e)
                    };
                    this.domListeners.touchstart = {
                        mousedown: c,
                        touchstart: u
                    },
                    this.rootElement.addEventListener("mousedown", c),
                    this.rootElement.addEventListener("touchstart", u);
                    break;
                case "touchmove":
                    var h = function(e) {
                        s || 1 !== e.which || t.emit("dom.touchmove", e)
                    }
                      , d = function(e) {
                        t.emit("dom.touchmove", e)
                    };
                    this.domListeners.touchmove = {
                        mousemove: h,
                        touchmove: d
                    },
                    this.rootElement.addEventListener("mousemove", h),
                    this.rootElement.addEventListener("touchmove", d);
                    break;
                case "touchend":
                    var p = function(e) {
                        return o() || 1 !== e.which ? void n() : void t.emit("dom.touchend", e)
                    }
                      , m = function(e) {
                        i(),
                        t.emit("dom.touchend", e),
                        e.preventDefault()
                    };
                    this.domListeners.touchend = {
                        mouseup: p,
                        touchend: m
                    },
                    this.rootElement.addEventListener("mouseup", p),
                    this.rootElement.addEventListener("touchend", m);
                    break;
                default:
                    var f = function(i) {
                        t.emit(e, i)
                    };
                    this.domListeners[l] = f,
                    this.rootElement.addEventListener(l, f)
                }
        }
    }
    ,
    t.remove = function(e) {
        if (0 === this.listeners(e).length) {
            var t = e.split(".");
            if (t[0] === r) {
                var i = t[1]
                  , n = this.domListeners[i];
                if (n) {
                    if (null !== n && "object" == typeof n) {
                        for (var o in n) {
                            var s = n[o];
                            this.rootElement.removeEventListener(o, s)
                        }
                        return void delete this.domListeners[i]
                    }
                    this.rootElement.removeEventListener(i, n),
                    delete this.domListeners[i]
                }
            }
        }
    }
    ,
    t.destroy = function() {
        for (var e in this.domListeners) {
            var t = this.domListeners[e];
            if (null === t || "object" != typeof t)
                this.rootElement.removeEventListener(e, t);
            else
                for (var i in t) {
                    var n = t[i];
                    this.rootElement.removeEventListener(i, n)
                }
        }
        this.domListeners = {}
    }
}
, function(e, t, i) {
    i(194),
    i(195),
    i(196),
    i(197),
    i(198),
    i(199)
}
, function(e, t) {
    "HTMLDocument"in window || (window.HTMLDocument = window.Document)
}
, function(e, t) {
    !function() {
        "use strict";
        function e(e, t) {
            if ("string" != typeof e)
                throw new TypeError('Failed to construct "CustomEvent": An event name must be provided.');
            var i = document.createEvent("CustomEvent")
              , n = {
                bubbles: !1,
                cancelable: !1,
                detail: null
            };
            return t = t || n,
            i.initCustomEvent(e, t.bubbles, t.cancelable, t.detail),
            i
        }
        var t = "CustomEvent"in window && ("function" == typeof window.CustomEvent || window.CustomEvent.toString().indexOf("CustomEventConstructor") > -1);
        t || (window.CustomEvent = e)
    }()
}
, function(e, t) {
    !function() {
        "use strict";
        var e = Element.prototype
          , t = e.matches = e.matches || e.mozMatchesSelector || e.msMatchesSelector || e.oMatchesSelector || e.webkitMatchesSelector
          , i = "matches"in e && t.call(document.createElement("a"), "a");
        i || (e.matches = function(e) {
            var i = Array.prototype.indexOf
              , n = this.parentNode;
            return n || (n = document.createDocumentFragment(),
            n.appendChild(this)),
            t ? t.call(this, e) : i.call(n.querySelectorAll(e), this) > -1
        }
        )
    }()
}
, function(e, t) {
    !function() {
        "use strict";
        var e = Element.prototype;
        "closest"in e || (e.closest = function(e) {
            for (var t = this; t; ) {
                if (t.matches(e))
                    return t;
                t = t.parentElement
            }
            return null
        }
        )
    }()
}
, function(e, t) {
    !function() {
        "use strict";
        function e(e) {
            return "string" == typeof e ? document.createTextNode(e) : e
        }
        function t(t) {
            var i, n, o;
            if (t && (o = t.length),
            !o)
                throw new Error("No node was specified (DOM Exception 8)");
            if (1 === o)
                return e(t[0]);
            for (i = document.createDocumentFragment(),
            n = 0; n < o; n++)
                i.appendChild(e(t[n]));
            return i
        }
        var i = Element.prototype
          , n = i.after && i.append && i.before && i.prepend && i.remove && i.replace;
        n || (i.prepend = function() {
            this.insertBefore(t(arguments), this.firstChild)
        }
        ,
        i.append = function() {
            this.appendChild(t(arguments))
        }
        ,
        i.before = function() {
            var e = this.parentNode;
            e && e.insertBefore(t(arguments), this)
        }
        ,
        i.after = function() {
            var e = this.parentNode;
            e && e.insertBefore(t(arguments), this.nextSibling)
        }
        ,
        i.replace = function() {
            var e = this.parentNode;
            e && e.replaceChild(t(arguments), this)
        }
        ,
        i.remove = function() {
            var e = this.parentNode;
            e && e.removeChild(this)
        }
        )
    }()
}
, function(e, t, i) {
    !function() {
        "use strict";
        var e, t = document.createElement("x"), n = document.createElementNS("http://www.w3.org/2000/svg", "svg"), o = function(e) {
            return "classList"in e && (!e.classList.toggle("a", !1) && !e.classList.contains("a"))
        };
        if (o(n) || (e = i(200),
        Object.defineProperty(Element.prototype, "classList", {
            get: function() {
                function t() {}
                return t.prototype = new e(this,"class"),
                new t
            }
        })),
        !o(t)) {
            e = i(200);
            var s = DOMTokenList.prototype
              , a = function(e) {
                return function() {
                    var t, i = arguments.length;
                    for (t = 0; t < i; t++)
                        e.call(this, arguments[t])
                }
            };
            s.add = a(s.add),
            s.remove = a(s.remove),
            s.toggle = function(t, i) {
                return 1 in arguments && this.contains(t) === i ? i : e.prototype.toggle.call(this, t, i)
            }
        }
    }()
}
, function(e, t) {
    "use strict";
    function i(e, t) {
        this._getString = function() {
            return e.getAttribute(t) || ""
        }
        ,
        this._setString = function(i) {
            e.setAttribute(t, i)
        }
        ,
        n(this, o(this))
    }
    function n(e, t) {
        for (var i = t.length, n = 0; n < i; n++)
            e[n] = t[n];
        delete e[i]
    }
    function o(e) {
        var t = e._getString();
        return t && "" !== t ? t.split(/\s+/) : []
    }
    function s(e) {
        if ("" === e || void 0 === e)
            throw new Error("An invalid or illegal string was specified (DOM Exception 12)");
        if (/\s+/.test(e))
            throw new Error("InvalidCharacterError: String contains an invalid character (DOM Exception 5)")
    }
    i.prototype = {
        add: function(e) {
            for (var t, i = 0, a = arguments.length, r = o(this), l = !1; i < a; i++)
                t = arguments[i],
                s(t),
                r.indexOf(t) < 0 && (r.push(t),
                l = !0);
            l && (this._setString(r.join(" ").trim()),
            n(this, r))
        },
        contains: function(e) {
            return s(e),
            o(this).indexOf(e) > -1
        },
        item: function(e) {
            return o(this)[e] || null
        },
        get length() {
            return o(this).length
        },
        remove: function(e) {
            for (var t, i, a = 0, r = arguments.length, l = o(this), c = !1; a < r; a++)
                for (i = arguments[a],
                s(i); (t = l.indexOf(i)) > -1; )
                    l.splice(t, 1),
                    c = !0;
            c && (this._setString(l.join(" ").trim()),
            n(this, l))
        },
        toggle: function(e, t) {
            var i = this.contains(e)
              , n = i ? t !== !0 && "remove" : t !== !1 && "add";
            return n && this[n](e),
            "boolean" == typeof t ? t : !i
        },
        toString: function() {
            return this._getString()
        }
    },
    e.exports = i
}
, function(e, t, i) {
    function n() {
        var e = this;
        d.call(this, "div", {
            className: "minMaxSelector",
            hidden: !0
        });
        var t = this.createChild("div", {
            className: "topRow"
        })
          , i = this.createChild("div", {
            className: "botRow"
        });
        this.decrButton = t.appendChild(new r({
            className: ["simpleButton", "arrow", "decrButton"],
            repeatDelay: m
        })),
        this.numberInput = t.appendChild(new c({
            className: "numberInput"
        })),
        this.incrButton = t.appendChild(new r({
            className: ["simpleButton", "arrow", "incrButton"],
            repeatDelay: m
        })),
        this.minButton = i.appendChild(new l(s("ui.common.minWord"),{
            className: "minButton"
        })),
        this.maxButton = i.appendChild(new l(s("ui.common.maxWord"),{
            className: "maxButton"
        })),
        this.close = i.appendChild(new r({
            className: ["simpleButton", "closeBtn"]
        })),
        this.confirm = i.appendChild(new r({
            className: ["simpleButton", "confirmBtn"]
        })),
        this.currentValue = 0,
        this.minButton.on("tap", function() {
            e.currentValue = e.min,
            e.numberInput.setValue(e.currentValue)
        }),
        this.maxButton.on("tap", function() {
            e.currentValue = e.max,
            e.numberInput.setValue(e.currentValue)
        }),
        this.decrButton.on("tap", function() {
            e.currentValue <= e.min || (e.currentValue--,
            e.numberInput.setValue(e.currentValue))
        }),
        this.incrButton.on("tap", function() {
            e.currentValue >= e.max || (e.currentValue++,
            e.numberInput.setValue(e.currentValue))
        }),
        this.confirm.on("tap", function() {
            e.closeMinMax(),
            e.emit("confirm", e.currentValue)
        }),
        this.close.on("tap", function() {
            e.closeMinMax()
        }),
        this.numberInput.on("change", function(t) {
            e.currentValue = t
        })
    }
    i(202);
    var o = i(203).getElementPositionAt
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(204)
      , l = r.DofusButton
      , c = i(208)
      , u = i(212)
      , h = i(31)
      , d = i(190)
      , p = u.MAX_NUMBER
      , m = 100
      , f = {
        opacity: 0,
        webkitTransform: "scale(0.8)"
    }
      , g = {
        opacity: 1,
        webkitTransform: "scale(1)"
    };
    a(n, d),
    e.exports = n,
    n.prototype.position = function(e, t) {
        var i = o(this, e, t);
        this.setStyles({
            left: i.x + "px",
            top: i.y + "px"
        })
    }
    ,
    n.prototype.open = function(e) {
        function t() {
            delete i.openTweener,
            i.emit("opened")
        }
        var i = this;
        e = e || {},
        this.min = e.min || 0,
        this.max = e.max || p;
        var n;
        return n = void 0 !== e.defaultValue ? Math.max(this.min, Math.min(this.max, e.defaultValue)) : this.min,
        void 0 !== e.placeholder && void 0 === e.defaultValue ? (this.numberInput.setPlaceholder(e.placeholder),
        this.currentValue = "") : this.currentValue = n,
        this.numberInput.setValue(this.currentValue),
        this.numberInput.minValue = this.min,
        this.numberInput.maxValue = this.max,
        this.show(),
        e.hasOwnProperty("x") && e.hasOwnProperty("y") && this.position(e.x, e.y),
        this.setStyles(f),
        this.openTweener ? (this.openTweener.cancel(),
        t()) : void (this.openTweener = h.tween(this, g, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, t))
    }
    ,
    n.prototype.openAround = function(e, t) {
        var i = e.rootElement.getBoundingClientRect();
        t.x = i.left,
        t.y = i.top,
        this.open(t)
    }
    ,
    n.prototype.closeMinMax = function() {
        function e() {
            delete t.closeTweener,
            t.hide(),
            t.emit("closed"),
            t.numberInput.rootElement.blur()
        }
        var t = this;
        return this.closeTweener ? (this.closeTweener.cancel(),
        e()) : void (this.closeTweener = h.tween(this, f, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, e))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i, n, s) {
        var a = i - e;
        a < r && (a = n,
        a + e > o.screenWidth && (a = Math.max(0, o.screenWidth - e)));
        var l = Math.max(s - t, r);
        return {
            x: Math.round(a),
            y: Math.round(l)
        }
    }
    var o = i(24).dimensions;
    t.positionNextTo = function(e, t, i) {
        e.setStyle("opacity", 0),
        e.show();
        var n = t.rootElement.getBoundingClientRect()
          , s = e.rootElement.getBoundingClientRect()
          , a = 0
          , r = 0;
        if (i && i.padding) {
            var l = i.padding;
            s.width += 2 * l,
            s.height += 2 * l
        }
        n.left > s.width ? a = n.left - s.width : o.screenWidth - n.right > s.width && (a = n.left + n.width),
        r = o.screenHeight - n.bottom + n.height > s.height ? n.top : n.top + n.height > s.height ? n.top + n.height - s.height : o.screenHeight - s.height,
        e.setStyles({
            left: Math.round(a) + "px",
            top: Math.round(r) + "px"
        }),
        e.setStyle("opacity", 1)
    }
    ;
    var s = 42
      , a = s / 2
      , r = 10;
    t.getElementPositionAt = function(e, t, i) {
        return n(e.rootElement.clientWidth, e.rootElement.clientHeight, t - a, t + a, i - a)
    }
    ;
    var l = 60;
    t.getElementPositionCenteredAt = function(e, t, i, n) {
        n = n || {};
        var s = e.rootElement.clientWidth
          , a = e.rootElement.clientHeight
          , c = t - s / 2;
        c < r ? c = r : c + s > o.screenWidth - r && (c = o.screenWidth - r - s);
        var u = void 0 !== n.verticalMargin ? n.verticalMargin : l
          , h = i - a - u;
        return h < r && (h = i + u),
        {
            x: Math.round(c),
            y: Math.round(h)
        }
    }
    ,
    t.getElementPositionAround = function(e, t) {
        var i = t.rootElement.getBoundingClientRect()
          , o = i.width / 2
          , s = i.height / 2
          , r = i.left + o
          , l = i.top + s;
        return o = o < a ? a : o,
        s = s < a ? a : s,
        n(e.rootElement.clientWidth, e.rootElement.clientHeight, r - o, r + o, l - s)
    }
}
, function(e, t, i) {
    function n(e, t) {
        e = e || {},
        r.call(this, "div", e),
        this.addClassNames("Button"),
        l(this, {
            repeatDelay: e.repeatDelay,
            doubletapTimeout: 1
        });
        var i = e.addIcon;
        if (i) {
            if ("string" == typeof i && u.indexOf(i) < 0)
                return console.error("Invalid addIcon option:", i);
            var n = new r("div",{
                className: "btnIcon"
            });
            "before" === i && this.appendChild(n),
            e.text && this.createChild("div", {
                className: "btnText",
                text: e.text
            }),
            "after" !== i && i !== !0 || this.appendChild(n)
        }
        (e.scaleOnPress || void 0 === e.scaleOnPress) && this.addClassNames("scaleOnPress"),
        e.tooltip && s(this, e.tooltip),
        "function" == typeof t && this.on("tap", t),
        this.on("tap", function() {
            c(e.sound || "GEN_BUTTON")
        }),
        this.on("tapstart", function() {
            this.addClassNames("pressed")
        }),
        this.on("tapend", function() {
            this.delClassNames("pressed")
        }),
        this.on("enable", function(e) {
            this.toggleClassName("disabled", !e)
        }),
        e.disable && this.disable()
    }
    function o(e, t, i) {
        t = t || {},
        t.text = e,
        n.call(this, t, i),
        this.addClassNames("button")
    }
    i(205);
    var s = i(206).addTooltip
      , a = i(26).inherits
      , r = i(190)
      , l = i(32)
      , c = i(84).playUiSound
      , u = ["before", "after"];
    a(n, r),
    e.exports = n,
    a(o, n),
    n.DofusButton = o
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        p.call(this, "div", {
            className: "TooltipBox",
            name: e.name
        }),
        this.content = this.createChild("div", {
            className: "content"
        }),
        this.openState = !0,
        e.openTooltipBox || this.close(!0),
        this.setContent(e.content)
    }
    function o() {
        this.addClassNames("transition")
    }
    function s() {
        this.delClassNames("transition"),
        this.hide()
    }
    function a() {
        b && (b.emit("tooltipOut"),
        b = null ),
        clearTimeout(y),
        y = null ,
        w.close()
    }
    function r() {
        b && (b.emit("tooltipOut"),
        b = null ),
        clearTimeout(y),
        y = setTimeout(a, 500)
    }
    function l(e) {
        return Math.max(I, e / 25 * 1e3)
    }
    i(207);
    var c = i(203)
      , u = c.getElementPositionAround
      , h = c.getElementPositionAt
      , d = i(26).inherits
      , p = i(190)
      , m = i(31)
      , f = i(32)
      , g = i(189)
      , _ = i(47)
      , v = i(84).playUiSound;
    d(n, p);
    var t = e.exports = n;
    n.prototype.setContent = function(e) {
        for (var t = this.content.getChildren(), i = 0; i < t.length; i++)
            this.content.removeChild(t[i]);
        e && this.content.appendChild(e)
    }
    ,
    n.prototype.position = function(e) {
        var t = u(this, e);
        this.setStyle("webkitTransform", "translate3d(" + t.x + "px," + t.y + "px,0)")
    }
    ,
    n.prototype.positionAt = function(e, t) {
        var i = h(this, e, t);
        this.setStyle("webkitTransform", "translate3d(" + i.x + "px," + i.y + "px,0)")
    }
    ,
    n.prototype.open = function(e, t) {
        return this.openState ? void (t ? this.positionAt(t.x, t.y) : this.position(e)) : (this.openState = !0,
        v("ROLLOVER"),
        this.show(),
        t ? this.positionAt(t.x, t.y) : this.position(e),
        void m.tween(this, {
            opacity: 1
        }, {
            time: 150,
            easing: "ease-out"
        }, o))
    }
    ,
    n.prototype.close = function(e) {
        if (this.openState)
            return this.openState = !1,
            e ? (this.setStyle("opacity", 0),
            void s.call(this)) : void m.tween(this, {
                opacity: 0
            }, {
                time: 150,
                easing: "ease-out"
            }, s)
    }
    ;
    var y, w, b, C;
    t.initialiseTooltipBehavior = function(e) {
        return w = new n,
        e.on("dom.touchend", function() {
            C && g.stop(),
            C = !1,
            a()
        }),
        w
    }
    ,
    t.addTooltip = function(e, t, i) {
        function n() {
            var i = t;
            return "function" == typeof t && (i = t.call(e),
            i = "string" == typeof i ? new p("div",{
                text: i
            }) : i),
            i
        }
        function o() {
            if (e._tooltipEnabled && _.requestInteractionHandle(w) && (clearTimeout(y),
            y = null ,
            !b || b !== e)) {
                var t = n()
                  , o = t instanceof p;
                if (b && b.emit("tooltipOut"),
                !o)
                    return w.close(!0),
                    void w.setContent(!1);
                w.setContent(t),
                w.open(e, i.position),
                b = e,
                e.emit("tooltipOn")
            }
        }
        e.hasOwnProperty("_tooltipEnabled") || (e._tooltipEnabled = !0,
        i = i || {},
        t = "string" == typeof t ? new p("div",{
            text: t
        }) : t,
        f(e),
        g(e),
        e.on("longtap", function() {
            g.start(),
            o(),
            C = !0
        }),
        e.on("touchenter", function() {
            C && o()
        }),
        i.openOnTap && e.on("tap", o),
        e.on("touchleave", r))
    }
    ,
    t.enableTooltip = function(e, t) {
        e.hasOwnProperty("_tooltipEnabled") && e._tooltipEnabled !== t && (e._tooltipEnabled = t)
    }
    ;
    var I = 3e3;
    t.computeNotificationDisplayTime = l,
    t.showNotification = function(e, t, i) {
        "string" == typeof e ? (i = i || l(e.length),
        e = w.createChild("div", {
            text: e
        })) : i = i || I,
        w.setContent(e),
        w.open(t),
        y = setTimeout(a, i)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        this.title = e.title,
        this.minValue = void 0 !== e.minValue ? e.minValue : u,
        this.maxValue = e.maxValue || c;
        var t = {
            type: "text",
            maxlength: h + 1,
            placeholder: 0
        };
        if (e.attr)
            for (var i in e.attr)
                t[i] = e.attr[i];
        e.attr = t,
        l.call(this, "input", e),
        this.addClassNames("NumberInputBox"),
        r(this),
        this.on("tap", this._tapOnNumberInputBox)
    }
    i(209);
    var o = i(210)
      , s = i(26).inherits
      , a = i(212)
      , r = i(32)
      , l = i(190)
      , c = a.MAX_NUMBER
      , u = 1
      , h = a.MAX_NUMBER_LEN;
    s(n, l),
    e.exports = n,
    n.prototype._parseNumber = function(e) {
        var t = o.stringToInt(e);
        return Math.min(Math.max(t, this.minValue), this.maxValue)
    }
    ,
    n.prototype._tapOnNumberInputBox = function() {
        this.emit("focus"),
        void 0 === this.minValue && (this.minValue = u),
        void 0 === this.maxValue && (this.maxValue = c),
        window.gui.numberInputPad.open(this, this.title, this.minValue, this.maxValue)
    }
    ,
    n.prototype.promptForValue = function(e) {
        function t() {
            n = !0
        }
        if (this._tapOnNumberInputBox(),
        e) {
            var i = this
              , n = !1;
            this.on("change", t),
            window.gui.numberInputPad.once("hide", function() {
                return i.removeListener("change", t),
                e(n)
            })
        }
    }
    ,
    n.prototype.getValue = function() {
        return o.stringToInt(this.rootElement.value)
    }
    ,
    n.prototype.getFormattedValue = function() {
        return o.intToString(o.stringToInt(this.rootElement.value))
    }
    ,
    n.prototype.setValue = function(e, t) {
        var i, n;
        "number" == typeof e ? (n = e,
        i = o.intToString(n)) : (i = e,
        n = this._parseNumber(i)),
        this.rootElement.value = i,
        t && this.emit("change", n)
    }
    ,
    n.prototype.setReadonly = function(e) {
        e === !1 ? this.rootElement.removeAttribute("readonly") : this.rootElement.setAttribute("readonly", "readonly"),
        this.setEnable(!e)
    }
    ,
    n.prototype.setPlaceholder = function(e) {
        this.rootElement.placeholder = e
    }
    ,
    n.prototype.blur = function() {}
    ,
    n.prototype.focus = function() {}
    ,
    n.prototype.disable = function() {
        this.setEnable(!1),
        this.rootElement.disabled = !0
    }
    ,
    n.prototype.enable = function() {
        this.setEnable(!0),
        this.rootElement.disabled = !1
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1")
    }
    var o = i(35).getText
      , s = i(12)
      , a = i(211).time.dofusTimeYearLag
      , r = i(31);
    t.sortObjectInArray = function(e, t, i) {
        var n = i ? 1 : -1
          , o = i ? -1 : 1;
        e.sort(function(e, i) {
            return e[t] < i[t] ? n : e[t] > i[t] ? o : 0
        })
    }
    ,
    t.getObjectInArrayIndexById = function(e, t, i) {
        if (!Array.isArray(e))
            return console.error("Input not an array.", e);
        for (var n = 0; n < e.length; n += 1) {
            var o = e[n];
            if (o.hasOwnProperty(t) && o[t] === i)
                return n
        }
        return -1
    }
    ,
    t.getObjectInArrayById = function(t, i, n) {
        var o = e.exports.getObjectInArrayIndexById(t, i, n);
        if (o >= 0)
            return t[o]
    }
    ,
    t.removeObjectInArrayById = function(e, t, i) {
        if (!Array.isArray(e))
            return console.error("Input not an array.", e);
        for (var n = !1, o = e.length - 1; o >= 0; o -= 1) {
            var s = e[o];
            s.hasOwnProperty(t) && s[t] === i && (e.splice(o, 1),
            n = !0)
        }
        return n
    }
    ,
    t.mergeObjects = function(e) {
        for (var t = e || arguments, i = {}, n = 0, o = t.length; n < o; n += 1) {
            var s = t[n];
            for (var a in s)
                s.hasOwnProperty(a) && (i[a] = s[a])
        }
        return i
    }
    ;
    var l = /[^0-9]+/g
      , c = /\B(?=(\d{3})+(?!\d))/g
      , u = null
      , h = null ;
    t.kamasToString = function(e, t) {
        t || "" === t || (t = o("ui.common.short.kama"));
        var i = this.intToString(e);
        return t ? i + " " + t : i
    }
    ,
    t.stringToKamas = function(e) {
        return Number(e.replace(l, ""))
    }
    ,
    t.intToString = function(e) {
        return isNaN(e) ? "" : (h = null !== h ? h : o("ui.common.numberSeparator"),
        e.toString().replace(c, h))
    }
    ,
    t.stringToInt = function(e) {
        return u || (h = null !== h ? h : o("ui.common.numberSeparator"),
        u = new RegExp(n(h),"g")),
        Number(e.replace(u, ""))
    }
    ,
    t.hardAndSoftToString = function(e, i) {
        var n = e ? t.kamasToString(e, "G") + " / " : "";
        return n + t.kamasToString(i, "K")
    }
    ,
    t.extractElementsFrom = function(e, t, i, n) {
        i = i || !1,
        n = n || "id",
        e = e.map(function(e) {
            return e.toString()
        });
        var o, s;
        if (o = i ? {} : [],
        t instanceof Array) {
            var a = t.length;
            for (s = 0; s < a; s++)
                t[s] && e.indexOf(t[s][n].toString()) !== -1 && (i ? o[t[s][n]] = t[s] : o.push(t[s]))
        } else
            for (s in t)
                t[s] && e.indexOf(t[s][n].toString()) !== -1 && (i ? o[t[s][n]] = t[s] : o.push(t[s]));
        return o
    }
    ,
    t.storeMapAndEmit = function(e, t, i, n) {
        var o = !1;
        for (var s in i)
            t[s] !== i[s] && (t[s] = i[s],
            o = !0);
        o && e.emit(n)
    }
    ,
    t.storeValueAndEmit = function(e, t, i, n, o) {
        t[i] !== n && (t[i] = n,
        e.emit(o, n))
    }
    ,
    t.hexToRgb = function(e) {
        for (var t = 6 - e.length, i = 0; i < t; i++)
            e = t + e;
        var n = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
        return n ? [parseInt(n[1], 16), parseInt(n[2], 16), parseInt(n[3], 16)] : null
    }
    ,
    t.durationToString = function(e) {
        var t = ~~e % 60;
        t < 10 && (t = "0" + t);
        var i = ~~(e / 60) % 60;
        i < 10 && (i = "0" + i);
        var n = ~~(e / 3600);
        return n < 10 && (n = "0" + n),
        n + ":" + i + ":" + t
    }
    ,
    t.getAlmanaxDate = function(e, t) {
        e = e ? new Date(e) : new Date;
        var i = t ? e.getFullYear() : e.getUTCFullYear()
          , n = t ? e.getMonth() : e.getUTCMonth()
          , o = t ? e.getDate() : e.getUTCDate()
          , s = t ? e.getHours() : e.getUTCHours()
          , r = t ? e.getMinutes() : e.getUTCMinutes();
        return {
            year: i + a,
            month: n + 1,
            day: o,
            monthName: window.gui.databases.Months[n].nameId,
            hour: s < 10 ? "0" + s : s,
            minute: r < 10 ? "0" + r : r
        }
    }
    ,
    t.simplifyString = function(e) {
        e = e.split("");
        for (var t = [], i = e.length, n = "", o = "AAAAAAaaaaaaOOOOOOOooooooEEEEeeeeeCcDIIIIiiiiUUUUuuuuNnSsYyyZz", s = 0; s < i; s++)
            n.indexOf(e[s]) !== -1 ? t[s] = o.substr(n.indexOf(e[s]), 1) : t[s] = e[s];
        return t = t.join(""),
        t.toLowerCase()
    }
    ,
    t.createFifo = function() {
        return s.queue(function(e, t) {
            try {
                e(function(e) {
                    if (e)
                        throw new Error(e);
                    t()
                })
            } catch (i) {
                console.error(i),
                t(i)
            }
        })
    }
    ,
    t.getObjectInstanceName = function(e) {
        if (!e)
            return null ;
        var t = /function ([^(]+)/.exec(String(Object.getPrototypeOf(e).constructor)) || [];
        return t[1]
    }
    ,
    t.mapToArray = function(e, t) {
        for (var i = Object.keys(e), n = i.length, o = new Array(n), s = 0; s < n; s++)
            o[s] = e[i[s]];
        if (t && t.sortBy) {
            var a = t.sortBy;
            o.sort(function(e, t) {
                return e[a] - t[a]
            })
        }
        return o
    }
    ,
    t.forceReflow = function(e) {
        e.rootElement.offsetWidth
    }
    ,
    t.showProgressively = function(e, i, n, o) {
        function s() {
            o && r.tween(o, {
                opacity: 0
            }, {
                time: i || 250
            }),
            e && r.tween(e, {
                opacity: 1
            }, {
                time: i || 250
            })
        }
        e && (e.setStyle("opacity", 0),
        e.show(),
        t.forceReflow(e)),
        n ? window.setTimeout(s, n) : s()
    }
    ,
    t.allLinksOnTargetBlank = function(e) {
        for (var i = e.rootElement.getElementsByTagName("a"), n = function(e) {
            e.preventDefault(),
            t.openUrlInAppBrowser(this.href)
        }, o = 0; o < i.length; o++)
            i[o].onclick = n
    }
    ,
    t.openUrlInDeviceBrowser = function(e) {
        window.open(e, "_system")
    }
    ,
    t.openUrlInAppBrowser = function(e) {
        //window.cordova && window.cordova.InAppBrowser ? window.cordova.InAppBrowser.open(e, "_blank", "closebuttoncaption=" + o("tablet.common.backToGame")) : window.open(e, "_blank")
         window.open(e, "_blank")
    }
    ,
    t.cssTransform = function(e, t) {
        e.setStyles({
            transform: t,
            oTransform: t,
            msTransform: t,
            mozTransform: t,
            webkitTransform: t
        })
    }
    ,
    t.cssTransition = function(e, t) {
        e.setStyles({
            transition: t,
            oTransition: t,
            msTransition: t,
            mozTransition: t,
            webkitTransition: t
        })
    }
}
, function(e, t, i) {
    function n(e) {
        return ("0" + e).slice(-2)
    }
    function o(e) {
        this.timestamp = e
    }
    var s = i(35).getText;
    t.time = {
        serverTimeLag: 0,
        serverUtcTimeLag: 0,
        timezoneOffset: 0,
        dofusTimeYearLag: -1370
    },
    t.leadWithZero = n,
    t.initialize = function(e) {
        e.on("BasicTimeMessage", function(e) {
            var i = Date.now()
              , n = t.time;
            n.serverTimeLag = 1e3 * (e.timestamp + 60 * e.timezoneOffset) - i,
            n.serverUtcTimeLag = 1e3 * e.timestamp - i,
            n.timezoneOffset = 60 * e.timezoneOffset * 1e3
        })
    }
    ,
    t.DofusDate = o,
    o.prototype.getLocalDate = function(e) {
        var i = new Date(1e3 * this.timestamp);
        return this.dofusDate = e,
        this.date = i,
        this.year = i.getFullYear() + (e ? t.time.dofusTimeYearLag : 0),
        this.month = i.getMonth(),
        this.day = i.getDate(),
        this.hour = i.getHours(),
        this.minute = i.getMinutes(),
        this
    }
    ,
    o.prototype.getServerDate = function(e) {
        var i = new Date(1e3 * this.timestamp + t.time.timezoneOffset);
        return this.dofusDate = e,
        this.date = i,
        this.year = i.getUTCFullYear() + (e ? t.time.dofusTimeYearLag : 0),
        this.month = i.getUTCMonth(),
        this.day = i.getUTCDate(),
        this.hour = i.getUTCHours(),
        this.minute = i.getUTCMinutes(),
        this
    }
    ,
    o.prototype.toString = function(e) {
        if (!this.date)
            return {};
        var i = !this.dofusDate && e
          , o = this.year + (i ? t.time.dofusTimeYearLag : 0)
          , a = n(this.day)
          , r = n(this.month + 1)
          , l = n(this.hour)
          , c = n(this.minute);
        return {
            date: s("ui.time.dateNumbers", a, r, o),
            time: l + ":" + c,
            year: o,
            month: r,
            monthName: window.gui.databases.Months[this.month].nameId,
            day: a,
            hour: l,
            minute: c
        }
    }
}
, function(e, t) {
    e.exports = {
        MAP_CELL_COUNT: 560,
        MAX_LEVEL: 200,
        MAX_GUILD_LEVEL: 200,
        MAX_MOUNT_LEVEL: 100,
        MAX_CHAT_LEN: 512,
        USER_MAX_CHAT_LEN: 256,
        MIN_LOGIN_LEN: 3,
        MAX_LOGIN_LEN: 50,
        MIN_PLAYER_NAME_LEN: 2,
        MAX_PLAYER_NAME_LEN: 20,
        MIN_NICK_LEN: 2,
        MAX_NICK_LEN: 30,
        MIN_GUILDNAME_LEN: 3,
        MAX_GUILDNAME_LEN: 30,
        MIN_ALLIANCENAME_LEN: 3,
        MAX_ALLIANCENAME_LEN: 30,
        MIN_ALLIANCETAG_LEN: 3,
        MAX_ALLIANCETAG_LEN: 5,
        MAX_PLAYER_COLOR: 5,
        MAX_ENTITY_COLOR: 8,
        MAX_PLAYERS_PER_TEAM: 8,
        MAX_MEMBERS_PER_PARTY: 8,
        MAX_GUESTS_PER_PARTY: 7,
        MAX_MEMBERS_PER_ARENA_PARTY: 5,
        MAX_MONSTERS_IN_GROUP_ON_MAP: 16,
        MAX_CHAT_OBJECT_REF: 16,
        NOT_EQUIPED: 63,
        MAX_EQUIPED: 255,
        MAX_JOBS_PER_CHARACTER: 6,
        MAX_CRAFT_SLOT: 9,
        MAX_JOB_LEVEL: 100,
        MAX_HONOR: 2e4,
        MAX_SHORTCUT: 99,
        MAX_ARENA_RANK: 2300,
        CHAR_MIN_LEVEL_ARENA: 50,
        CHAR_MIN_LEVEL_RIDE: 60,
        MAX_DUNGEON_REGISTER: 10,
        MIN_RIDE_NAME_LEN: 0,
        MAX_RIDE_NAME_LEN: 16,
        MAX_EFFECTS_COUNT: 100,
        MAX_LOCKABLE_CODE_LEN: 8,
        MAX_PRESET_ITEM_COUNT: 24,
        MIN_OBJ_COUNT_BY_XFERT: 1,
        MAX_OBJ_COUNT_BY_XFERT: 1e3,
        MAX_OBJECT_EFFECT_STRING_LEN: 30,
        MAX_PLAYER_OR_ACCOUNT_NAME_LEN: 31,
        MAX_NUMBER: 2e9,
        MAX_NUMBER_LEN: 13
    }
}
, function(e, t) {
    e.exports = {
        TEAM_CHALLENGER: 0,
        TEAM_DEFENDER: 1,
        TEAM_SPECTATOR: 2
    }
}
, function(e, t, i) {
    var n = i(185)
      , o = i(35).getText;
    n.prototype._setupInfoBox = function() {
        var e = this.infoBox = this.createChild("div", {
            className: "infoBox",
            hidden: !0
        });
        e.mp = e.createChild("div", {
            className: "mp"
        }),
        e.ap = e.createChild("div", {
            className: "ap"
        })
    }
    ,
    n.prototype.hideInfobox = function() {
        this.infoBox.hide()
    }
    ,
    n.prototype.showInfobox = function(e, t) {
        "tackle" === e && (this.infoBox.mp.setText(t.mp ? -t.mp + " " + o("ui.stats.shortMP") : ""),
        this.infoBox.ap.setText(t.ap ? -t.ap + " " + o("ui.stats.shortAP") : "")),
        this.infoBox.show()
    }
}
, function(e, t, i) {
    var n = i(204)
      , o = i(185)
      , s = i(35).getText
      , a = i(203).getElementPositionCenteredAt
      , r = i(33).position
      , l = i(31);
    o.prototype._createConfirmBox = function() {
        function e() {
            o.hide(),
            o.tween = null
        }
        var t, i = {
            x: 0,
            y: 0
        }, o = this.confirmBox = window.gui.gameGuiContainer.createChild("div", {
            className: "fightConfirmBox",
            hidden: !0
        });
        o.isOpen = !0,
        o.allowDomEvents();
        var c = o.createChild("div", {
            className: "title"
        })
          , u = o.createChild("div", {
            className: "content"
        });
        u.appendChild(new n({
            className: "cancel",
            scaleOnPress: !0
        },function() {
            t(!1),
            o.close()
        }
        ));
        var h = u.createChild("div", {
            className: "mpAndAp"
        })
          , d = h.createChild("div", {
            className: "mp"
        });
        d.createChild("div", {
            className: "logo"
        });
        var p = d.createChild("div", {
            className: "value"
        })
          , m = h.createChild("div", {
            className: "ap"
        });
        m.createChild("div", {
            className: "logo"
        });
        var f = m.createChild("div", {
            className: "value"
        })
          , g = u.appendChild(new n({
            className: "valid",
            scaleOnPress: !0
        },function() {
            g.disable(),
            t(!0),
            o.close()
        }
        ))
          , _ = null ;
        o.open = function(e, n, u, h, v) {
            return _ && h && _ === h ? (u(!0),
            void o.close()) : (_ = h,
            g.enable(),
            "move" === e ? (c.setText(s("ui.common.move")),
            d.show(),
            p.setText(s("ui.short.movementPoints") + s("ui.common.colon") + "-" + n.mp),
            n.ap > 0 ? (f.setText(s("ui.short.actionPoints") + s("ui.common.colon") + "-" + n.ap),
            m.show()) : m.hide()) : (c.setText(n.name),
            d.hide(),
            m.show(),
            f.setText(s("ui.short.actionPoints") + s("ui.common.colon") + "-" + n.apCost)),
            o.show(),
            i = a(o, r.x, r.y),
            o.isOpen ? o.setStyles({
                webkitTransformOrigin: r.x + "px " + r.y + "px"
            }) : o.setStyles({
                webkitTransform: "scale(0) translate3d(" + i.x + "px," + i.y + "px,0)",
                webkitTransformOrigin: r.x + "px " + r.y + "px"
            }),
            l.tween(o, {
                webkitTransform: "scale(1) translate3d(" + i.x + "px," + i.y + "px,0)"
            }, {
                time: 100,
                easing: "linear"
            }),
            o.isOpen = !0,
            v && o.hide(),
            void (t = u))
        }
        ,
        o.close = function() {
            o.isOpen && (o.isOpen = !1,
            g.disable(),
            _ = null ,
            l.tween(o, {
                webkitTransform: "scale(0) translate3d(" + i.x + "px," + i.y + "px,0)"
            }, {
                time: 100,
                easing: "linear"
            }, e))
        }
        ,
        o.close()
    }
}
, function(e, t, i) {
    var n = i(217).FIGHT_STATES
      , o = i(185)
      , s = i(24).dimensions
      , a = i(203)
      , r = a.getElementPositionAt
      , l = a.getElementPositionCenteredAt
      , c = i(33)
      , u = c.position
      , h = c.getPosition
      , d = i(47).requestInteractionHandle
      , p = i(284)
      , m = i(286)
      , f = i(206)
      , g = i(31)
      , _ = i(261).Tween
      , v = f.addTooltip
      , y = i(287)
      , w = i(190);
    o.prototype._setupTouchInteraction = function() {
        function e(e) {
            if (u.isVisible()) {
                var t = r(u, e.x, e.y);
                u.setStyle("webkitTransform", "translate3d(" + t.x + "px, " + t.y + "px, 0)")
            }
        }
        function t(t) {
            var i = h(t);
            if (e(i),
            Math.abs(s - i.x) > 10 || Math.abs(a - i.y) > 10) {
                if (!d(f))
                    return l();
                s = i.x,
                a = i.y;
                var n = c.convertScreenToCanvasCoordinate(s, a);
                p.touchMove(n.x, n.y, this.tapOptions)
            }
        }
        var i, o, s, a, l, c = this, u = this.infoBox, p = window.isoEngine, m = window.gui.fightManager, f = {};
        l = function() {
            o = !0,
            p.touchCancel(),
            c.removeListener("dom.touchmove", t)
        }
        ,
        this.on("dom.touchstart", function(e) {
            if (i)
                return l();
            var r = h(e);
            this.locked || r.touchCount > 1 || (s = r.x,
            a = r.y,
            i = !0,
            o = !1,
            m.fightState === n.BATTLE && this.on("dom.touchmove", t))
        }),
        this.on("dom.touchend", function(e) {
            if (this.removeListener("dom.touchmove", t),
            this.locked || o || !i || !d(f))
                return void (i = !1);
            i = !1;
            var n = h(e)
              , s = c.convertScreenToCanvasCoordinate(n.x, n.y);
            p.touchEnd(s.x, s.y, this.tapOptions)
        }),
        this._setupHighlightInteraction(),
        this._setupCameraInteraction()
    }
    ,
    o.prototype._setupHighlightInteraction = function() {
        function e() {
            window.clearTimeout(g),
            g = window.setTimeout(function() {
                I.close()
            }, 500)
        }
        function t(e) {
            for (var t, i, n, o, s = e.humanoidInfo.options || [], a = 0; a < s.length; a += 1) {
                var r = s[a];
                "HumanOptionGuild" === r._type ? n = r.guildInformations : "HumanOptionAlliance" === r._type ? o = r.allianceInformations : "HumanOptionOrnament" === r._type ? i = r.ornamentId : "HumanOptionTitle" === r._type && (t = r.titleId)
            }
            c.setAttributes({
                charName: e.name,
                titleId: t,
                ornamentId: i,
                guild: n,
                alliance: o,
                gender: e.humanoidInfo.sex,
                alignmentInfos: e.alignmentInfos
            }),
            c.display()
        }
        function i() {
            h.getChild("ornamentTooltip") && h.removeChild("ornamentTooltip"),
            h.clearContent()
        }
        function n(e) {
            window.clearTimeout(g),
            I.open(null , u);
            var t = e.bbox
              , i = T.convertSceneToCanvasCoordinate(t[0], t[2])
              , n = T.convertSceneToCanvasCoordinate(t[1], t[3])
              , o = (i.x + n.x) / 2
              , s = (i.y + n.y) / 2
              , a = n.y - i.y
              , r = a / 2 + 15
              , c = l(I, o, s, {
                verticalMargin: r
            });
            I.setStyle("webkitTransform", "translate3d(" + c.x + "px," + c.y + "px,0)")
        }
        function o(t) {
            var i = C.getFighter(t.actorId);
            return i ? (h.appendChild(i.createStatsTooltipContent()),
            window.isoEngine.displayEnemyMovementZone(i),
            !0) : (I.openState && (e(),
            window.isoEngine.removeEnemyMovementZone()),
            !1)
        }
        function s(i, n) {
            if (n.name && n.humanoidInfo)
                return m = i,
                t(n),
                I.addClassNames("noBackground"),
                !1;
            if (n.npcData && n.npcData.nameId)
                h.setText(n.npcData.nameId);
            else if ("GameRolePlayGroupMonsterInformations" === n.type) {
                h.appendChild(new p(n.ageBonus));
                for (var o = [n.staticInfos.mainCreatureLightInfos].concat(n.staticInfos.underlings), s = 0, a = o.length; s < a; s += 1) {
                    var r = o[s].staticInfos;
                    r && h.createChild("div", {
                        text: r.nameId + " (" + r.level + ")"
                    })
                }
            } else {
                if ("PaddockObject" !== n.type)
                    return I.openState && e(),
                    !1;
                var l = n.durability.durability + "/" + n.durability.durabilityMax;
                h.setText(n.name + " (" + l + ")")
            }
            return !0
        }
        function a() {
            var t = r.convertScreenToCanvasCoordinate(u.x, u.y)
              , a = _.holdAndMove(t.x, t.y);
            if (!a)
                return d = null ,
                void (I.openState && e());
            if (d !== a) {
                d = a;
                var l, c, m, f, g = a.data, v = b.playerData.isFighting;
                if (g) {
                    if (i(),
                    v) {
                        if (!o(g))
                            return
                    } else if (!s(a, g))
                        return
                } else {
                    if (l = S.interactiveElements[a.id],
                    !l || v)
                        return void (I.openState && e());
                    if (i(),
                    l.ageBonus) {
                        var y = l.ageBonus;
                        h.appendChild(new p(y))
                    }
                    l._name && h.createChild("div", {
                        className: "name",
                        text: l._name
                    });
                    var w;
                    for (m = 0,
                    f = l.enabledSkills.length; m < f; m += 1)
                        c = l.enabledSkills[m],
                        w = h.createChild("div"),
                        w.createChild("div", {
                            className: ["interaction", "cursor", "id" + c._cursor]
                        }),
                        w.createChild("div", {
                            className: "interaction",
                            text: c._name
                        });
                    for (m = 0,
                    f = l.disabledSkills.length; m < f; m += 1)
                        c = l.disabledSkills[m],
                        w = h.createChild("div"),
                        w.createChild("div", {
                            className: ["interaction", "cursor", "id" + c._cursor, "disable"]
                        }),
                        w.createChild("div", {
                            className: "interaction",
                            text: c._name
                        })
                }
                I.delClassNames("noBackground"),
                n(a)
            }
        }
        var r = this
          , c = new y({
            name: "ornamentTooltip"
        },{
            scaleFactor: .8
        })
          , h = new w("div",{
            className: "sceneTooltip"
        });
        v(this, new w("div"), {
            position: u
        });
        var d, m, g, _ = window.isoEngine, b = window.gui, C = b.fightManager, I = this.appendChild(new f({
            content: h
        })), T = _.mapScene, S = _.mapRenderer;
        this.on("tooltipOn", function() {
            window.gui.tooltipBox.close(!0),
            d = null ,
            _.holdStart(),
            b.wBody.on("dom.touchmove", a),
            a()
        }),
        this.on("tooltipOut", function() {
            I.close(),
            b.wBody.removeListener("dom.touchmove", a),
            _.holdEnd()
        }),
        c.on("rendered", function() {
            m === d && (h.appendChild(c),
            n(m))
        })
    }
    ,
    o.prototype._setupCameraInteraction = function() {
        function e(e) {
            P[A] = e[A] - x[A],
            P[E] = e[E],
            P[A] < N.min ? (P[A] = N.min,
            x[A] = e[A] - N.min) : P[A] > N.max && (P[A] = N.max,
            x[A] = e[A] - N.max),
            w.setStyle("webkitTransform", "translate3d(" + P.x + "px," + P.y + "px,0)")
        }
        function t(e) {
            R[E] = P[E];
            var t = o.convertScreenToCanvasCoordinate(R.x, R.y);
            if (T = r.getChangeMapCellAt(t.x, t.y, b),
            w.arrow.setStyle("opacity", T !== -1 ? 1 : 0),
            e[E] < C)
                S = Math.abs(C - e[E]),
                L[E] = c.min[E];
            else {
                if (!(e[E] > I))
                    return;
                S = Math.abs(I - e[E]),
                L[E] = c.max[E]
            }
            if (L[E] !== c[E]) {
                D.x = c.x,
                D.y = c.y,
                c.follow(D);
                var i = 0
                  , n = k
                  , s = D[E]
                  , a = L[E];
                Math.abs(L[E] - D[E]) > i && (i = Math.abs(L[E] - D[E]),
                n = k * S);
                var l = B[E];
                l.playing || l.start(!1),
                "x" === E ? l.reset().from({
                    x: s
                }).to({
                    x: a
                }, i / n) : l.reset().from({
                    y: s
                }).to({
                    y: a
                }, i / n)
            }
        }
        m(this);
        var i, o = this, a = window.gui, r = window.isoEngine, l = r.mapScene, c = l.camera, u = a.fightManager, h = 0, d = 0, p = this.createChild("div", {
            className: ["slide", "left"]
        });
        p.arrow = p.createChild("div", {
            className: "arrow"
        });
        var f = this.createChild("div", {
            className: ["slide", "right"]
        });
        f.arrow = f.createChild("div", {
            className: "arrow"
        });
        var v = this.createChild("div", {
            className: ["slide", "top"]
        });
        v.arrow = v.createChild("div", {
            className: "arrow"
        });
        var y = this.createChild("div", {
            className: ["slide", "bottom"]
        });
        y.arrow = y.createChild("div", {
            className: "arrow"
        });
        var w, b, C, I, T, S, A, E, x = {
            x: 0,
            y: 0
        }, M = {
            x: 80,
            y: 60
        }, N = {
            max: 0,
            min: 0
        }, R = {}, O = 5, P = {
            x: 0,
            y: 0
        }, D = {}, L = {
            x: 0,
            y: 0
        }, B = {
            x: new _(D,["x"]),
            y: new _(D,["y"])
        };
        this.on("transformStart", function(e, t) {
            if (this.locked)
                return this.cancelTransform();
            if (w = null ,
            u.fightState === n.UNDEFINED && 1 === e.touchCount) {
                var o = e.x - t[0].x
                  , a = e.y - t[0].y;
                x = e;
                var r, l = c.zoom === c.minZoom || c.zoom === c.maxZoom;
                if (Math.abs(o) > Math.abs(a)) {
                    if (r = l || Math.abs(a) < O,
                    Math.abs(c.x - c.min.x) < 1 && o > 0 && r)
                        return w = p,
                        b = "left",
                        R.x = 0,
                        N.min = 0,
                        N.max = M.x,
                        C = s.mapHeight / 3,
                        I = 2 * C,
                        A = "x",
                        void (E = "y");
                    if (Math.abs(c.x - c.max.x) < 1 && o < 0 && r)
                        return w = f,
                        b = "right",
                        R.x = s.mapWidth,
                        N.min = -M.x,
                        N.max = 0,
                        C = s.mapHeight / 3,
                        I = 2 * C,
                        A = "x",
                        void (E = "y")
                } else {
                    if (r = l || Math.abs(o) < O,
                    Math.abs(c.y - c.min.y) < 1 && a > 0 && r)
                        return w = v,
                        b = "top",
                        R.y = 0,
                        N.min = 0,
                        N.max = M.y,
                        C = s.mapWidth / 3,
                        I = 2 * C,
                        A = "y",
                        void (E = "x");
                    if (Math.abs(c.y - c.max.y) < 1 && a < 0 && r)
                        return w = y,
                        b = "bottom",
                        R.y = s.mapHeight,
                        N.min = -M.y,
                        N.max = 0,
                        C = s.mapWidth / 3,
                        I = 2 * C,
                        A = "y",
                        void (E = "x")
                }
            }
            h = d = 0,
            this.setTranslationEnable(!0),
            i = Date.now()
        });
        var k = .5;
        this.on("transform", function(n, o, s, a, u, p) {
            return w ? (e(p),
            void t(p)) : (r.cancelCameraMovement(),
            i = Date.now(),
            c.zoom === c.minZoom && (s = a = 0),
            h = .5 * h + .5 * -s,
            d = .5 * d + .5 * -a,
            void l.move(n, o, -s, -a, u))
        }),
        this.on("transformEnd", function() {
            if (B.x.playing && B.x.stop(),
            B.y.playing && B.y.stop(),
            w) {
                var e;
                if (e = "x" === A ? "translate3d(0," + P.y + "px,0)" : "translate3d(" + P.x + "px,0,0)",
                g.tween(w, {
                    webkitTransform: e
                }, {
                    time: 200,
                    easing: "ease-out"
                }),
                w.arrow.setStyle("opacity", 0),
                w = null ,
                this.locked)
                    return;
                if (Math.abs(P[A]) === M[A] && T !== -1) {
                    var t = o.convertScreenToCanvasCoordinate(R.x, R.y)
                      , s = l.convertCanvasToSceneCoordinate(R.x, R.y);
                    r._tapRoleplay(s.x, s.y, r.mapRenderer.getCellId(s.x, s.y), {
                        canvasX: t.x,
                        canvasY: t.y,
                        changeMapRequest: b,
                        mode: "roleplay"
                    })
                }
            } else
                this.setTranslationEnable(u.fightState !== n.BATTLE),
                Date.now() - i > 100 || c.addInertia(h, d, .8)
        }),
        u.on("fightEnterBattle", function() {
            o.setTranslationEnable(!1)
        }),
        u.on("fightEnd", function() {
            o.setTranslationEnable(!0)
        }),
        a.playerData.position.on("mapUpdate", function() {
            c.follow(window.isoEngine.actorManager.userActor)
        })
    }
    ,
    o.prototype.convertScreenToCanvasCoordinate = function(e, t) {
        return {
            x: e - s.mapLeft,
            y: t - s.mapTop
        }
    }
    ,
    o.prototype.convertCanvasToScreenCoordinate = function(e, t) {
        return {
            x: e + s.mapLeft,
            y: t + s.mapTop
        }
    }
    ,
    o.prototype.convertScreenToSceneCoordinate = function(e, t) {
        return e -= s.mapLeft,
        t -= s.mapTop,
        window.isoEngine.mapScene.convertCanvasToSceneCoordinate(e, t)
    }
    ,
    o.prototype.convertSceneToScreenCoordinate = function(e, t) {
        var i = window.isoEngine.mapScene.convertSceneToCanvasCoordinate(e, t);
        return {
            x: i.x + s.mapLeft,
            y: i.y + s.mapTop
        }
    }
}
, function(e, t, i) {
    function n(e) {
        e = void 0 === e || e,
        this.castingSpellId = null ,
        this.casterId = null ,
        this.targetedCell = null ,
        this.spell = null ,
        this.spellRank = null ,
        this.markId = null ,
        this.markType = null ,
        this.silentCast = null ,
        this.weaponId = -1,
        this.isCriticalHit = null ,
        this.isCriticalFail = null ,
        e && (this.castingSpellId = n.uniqueSpellId++)
    }
    function o() {
        r.call(this),
        this.turnCount = 0,
        this.turnsList = [],
        this.deadTurnsList = [],
        this.currentFighterId = 0,
        this._lastFighterId = 0,
        this._fighters = {},
        this.FIGHT_STATES = N,
        this.fightState = N.UNDEFINED,
        this.fightType = R,
        this.isInReconnection = !1,
        this.isInactive = !1,
        this.turnStartTime = 0,
        this.spellCastCounts = {},
        this.fightMessagesStack = [],
        this.isProcessing = !1,
        this.asyncFightMessages = {
            GameActionFightDispellableEffectMessage: this.addDispellableEffect,
            GameActionFightCloseCombatMessage: this.gameActionFightCloseCombatAndSpell,
            GameActionFightSpellCastMessage: this.gameActionFightCloseCombatAndSpell
        },
        a = window.gui.playerData,
        this._isTurnEndRequestPending = !1
    }
    function s(e) {
        switch (e._messageType) {
        case "GameFightRefreshFighterMessage":
        case "GameFightShowFighterMessage":
            return e.informations;
        case "GameActionFightSummonMessage":
            return e.summon;
        default:
            return null
        }
    }
    var a, r = i(16).EventEmitter, l = i(35).getText, c = i(34), u = i(26).inherits, h = i(30), d = i(218), p = i(219), m = i(220), f = i(237), g = i(222), _ = i(281), v = i(234), y = i(85), w = i(12), b = i(22), C = i(232), I = i(283), T = I.pushStep, S = 1e4, A = 1024, E = 1097, x = 1008, M = _.WEAPON_SPELL_ID, N = {
        UNDEFINED: -1,
        PREPARATION: 0,
        BATTLE: 1
    }, R = -1, O = {
        isSecret: p.FIGHT_OPTION_SET_SECRET,
        isRestrictedToPartyOnly: p.FIGHT_OPTION_SET_TO_PARTY_ONLY,
        isClosed: p.FIGHT_OPTION_SET_CLOSED,
        isAskingForHelp: p.FIGHT_OPTION_ASK_FOR_HELP
    }, P = [p.FIGHT_OPTION_SET_TO_PARTY_ONLY, p.FIGHT_OPTION_SET_CLOSED, p.FIGHT_OPTION_ASK_FOR_HELP];
    n.uniqueSpellId = 0;
    var D;
    u(o, r),
    e.exports = o,
    o.FIGHT_STATES = N,
    o.FIGHT_OPTION_KEY_TO_ENUM = O,
    o.FIGHT_OPTION_ICON_ID = P,
    o.prototype.INCREMENT_MODE_SOURCE = 1,
    o.prototype.INCREMENT_MODE_TARGET = 2,
    o.prototype.getFighters = function() {
        return "fightPlacement" === window.foreground.tapOptions.mode ? this.getOrdonnedPreFighters() : this.turnsList
    }
    ,
    o.prototype.getDeadFighters = function() {
        return this.deadTurnsList
    }
    ,
    o.prototype.getAvailableFighters = function() {
        return this._fighters
    }
    ,
    o.prototype.getFighter = function(e) {
        return this._fighters[e]
    }
    ,
    o.prototype.getTurnCount = function() {
        return this.turnCount
    }
    ,
    o.prototype.getFighterSpell = function(e, t, i) {
        var n = this.getAvailableFighters()
          , o = n[t];
        if (!o)
            return i(new Error("Spell could not be found, its fighter does not exist"));
        if (o.spells[e])
            return i(null , o.spells[e]);
        var s = a.characters.mainCharacter.spellData;
        if (s.spells[e])
            return o.spells[e] = s.spells[e].clone(),
            o.spells[e].setLevel(s.spells[e].level),
            i(null , o.spells[e]);
        for (var r in n) {
            var l = n[r];
            if (l.id !== t && l.spells[e])
                return o.spells[e] = l.spells[e].clone(),
                i(null , o.spells[e])
        }
        _.createSpells([e], function(t, n) {
            return t ? i(t) : (o.spells[e] = n[e],
            i(null , o.spells[e]))
        })
    }
    ,
    o.prototype._checkInactivityOnTurnStart = function() {
        this.isInactive && (c.isActiveSince(this.turnStartTime) ? this.isInactive = !1 : this.finishTurn()),
        this.turnStartTime = Date.now()
    }
    ,
    o.prototype.finishTurn = function() {
        window.dofus.sendMessage("GameFightTurnFinishMessage"),
        this._isTurnEndRequestPending = !0
    }
    ,
    o.prototype._checkInactivityOnTurnEnd = function() {
        !this.isInactive && !c.isActiveSince(this.turnStartTime) && Date.now() - this.turnStartTime > S && (this.isInactive = !0,
        window.gui.openSimplePopup(l("ui.fight.inactivityMessage"), l("ui.fight.inactivityTitle")))
    }
    ,
    o.prototype.initialize = function(e) {
        function t() {
            e.timeline && e.timeline.close(),
            r.turnsList = [],
            r.deadTurnsList = [],
            r.currentFighterId = 0,
            r._lastFighterId = 0;
            for (var t in r._fighters)
                r.removeFighter(t);
            r._fighters = {},
            r.fightState = N.UNDEFINED,
            r.fightType = R,
            r.isInReconnection = !1,
            r.spellCastCounts = {},
            r.fightMessagesStack = [],
            r.isProcessing = !1,
            a.isFightLeader = !1,
            a.isFighting = !1,
            a.isSpectator = !1,
            a.characters.switchControlledCharacter(a.characters.mainCharacterId),
            a.characters.mainCharacter.currentSummonedCreature = 0,
            a.characters.mainCharacter.currentSummonedBomb = 0,
            a.characters.clearSlaves(),
            window.actorManager.removeTeamCircles(),
            r._isTurnEndRequestPending = !1
        }
        function i(e) {
            var t = e.id;
            r.currentFighterId = t,
            "GameFightTurnResumeMessage" !== e._messageType && r.decrementDuration(t),
            a.characters.canControlCharacterId(t) && (r.spellCastCounts = {},
            r._checkInactivityOnTurnStart(),
            window.isoEngine.displayTextBanner("tablet.fight.animation.userTurn")),
            r.emit("GameFightTurnStart", e.id, e.waitTime, h.getValue("turnPicture")),
            r._isTurnEndRequestPending = !1
        }
        function n(e) {
            if (r.fightState === N.PREPARATION) {
                var t = s(e);
                r.emit("UpdatePreFightersList", t.contextualId)
            }
        }
        function o(e, t) {
            var i = r.getAvailableFighters()
              , n = i[e];
            if (!n || !n.data.alive)
                return console.warn("Fighter was killed previously.");
            for (var o in i) {
                var s = i[o];
                s.id !== e && s.data.stats.summoner === e && T(I.fightDeathStep, [D ? D.castingSpellId : -1, s.id])
            }
            T(I.fightDeathStep, [D ? D.castingSpellId : -1, e, !t]);
            var l = n.data.stats.summoner;
            a.characters.canControlCharacterId(l) && (n.isBomb ? a.characters.removeSummonedBomb(l) : a.characters.removeSummonedCreature(l),
            r.emit("updateSpellsAvailability"))
        }
        var r = this
          , l = window.dofus.connectionManager;
        e.on("GameFightStartMessage", function() {
            r.fightState = N.BATTLE,
            r.emit("fightEnterBattle"),
            r.prepareSpellsWithInitialCooldown(a.characters.mainCharacter);
            for (var e in a.characters.slaves)
                r.prepareSpellsWithInitialCooldown(a.characters.slaves[e]);
            window.isoEngine.displayTextBanner("tablet.fight.animation.fightStarts"),
            window.actorManager.removeReadyIcon()
        }),
        e.on("GameFightStartingMessage", function(t) {
            r.fightType = t.fightType,
            r.turnCount = 0,
            e.timeline.show(),
            r.emit("fightStart")
        }),
        e.on("disconnect", function() {
            t(),
            C.reset()
        }),
        e.on("GameFightEndMessage", function(e) {
            var i = r.getAvailableFighters();
            e.results && e.results.length > 0 && b.open("fightEnd", {
                msg: e,
                fighters: i
            }),
            C.flush(function(e) {
                e && console.error(e),
                t(),
                a.isSpectator || C.send(d.FIGHT_END),
                C.reset()
            })
        }),
        e.on("GameFightTurnResumeMessage", function(e) {
            i(e)
        }),
        e.on("GameFightTurnStartMessage", function(e) {
            i(e)
        }),
        e.on("GameFightTurnStartSlaveMessage", function(e) {
            i(e)
        }),
        e.on("GameFightHumanReadyStateMessage", function(e) {
            e.characterId === a.id && r.emit("playerReady", e.isReady),
            window.actorManager.setReadyIconOnActor(e.characterId, e.isReady)
        }),
        e.on("confirmTurnEnd", function() {
            if (r._lastFighterId) {
                var e = r._lastFighterId
                  , t = r.getFighter(e);
                if (!t)
                    return console.warn("Turn confirmation failed, fighter does not exist:", e);
                if (t.markFinishingBuffs(),
                t.data.stats.actionPoints = t.data.stats.maxActionPoints,
                t.data.stats.movementPoints = t.data.stats.maxMovementPoints,
                e === a.characters.controlledCharacterId) {
                    var i = a.characters.getControlledCharacter();
                    i.setCharacteristic("actionPointsCurrent", t.data.stats.maxActionPoints),
                    i.setCharacteristic("movementPointsCurrent", t.data.stats.maxMovementPoints);
                    for (var n in t.spells) {
                        var o = t.spells[n];
                        o.newTurn()
                    }
                    r._checkInactivityOnTurnEnd(),
                    window.isoEngine.displayTextBanner("tablet.fight.animation.endOfUserTurn")
                }
                r.prepareNextPlayableCharacter(),
                r.emit("GameFightTurnEnd", e)
            }
        }),
        e.on("GameFightTurnEndMessage", function(e) {
            var t = e.id;
            r._lastFighterId = t;
            var i = r.getFighter(t);
            if (!i)
                return console.warn("Turn end failed, fighter does not exist");
            if (!i.data.alive && (r.decrementDuration(t),
            i.markFinishingBuffs(),
            i.data.stats.actionPoints = i.data.stats.maxActionPoints,
            i.data.stats.movementPoints = i.data.stats.maxMovementPoints,
            r.emit("GameFightTurnEnd", t),
            t === a.characters.controlledCharacterId))
                for (var n in i.spells) {
                    var o = i.spells[n];
                    o.newTurn()
                }
        }),
        e.on("GameFightShowFighterMessage", function(e) {
            r.loadFighter(e),
            n(e)
        }),
        e.on("GameFightShowFighterRandomStaticPoseMessage", function(e) {
            r.loadFighter(e)
        }),
        e.on("GameActionFightSummonMessage", function(e) {
            n(e);
            var t = e.sourceId
              , i = e.actionId
              , o = e.summon;
            if (t === a.id && i !== g.ACTION_SUMMON_STATIC_CREATURE) {
                var s = r.getFighter(o.contextualId);
                if (!s)
                    return console.error(new Error("Summoning failed, fighter does not exist"));
                i === x || s.isBomb ? a.characters.addSummonedBomb() : s.isCreature && a.characters.addSummonedCreature()
            }
            T(I.fightSummonStep, [D ? D.castingSpellId : -1, t, o])
        }),
        e.on("GameFightTurnListMessage", function(e) {
            r.turnsList = e.ids,
            r.deadTurnsList = e.deadsIds,
            r.emit("FightersListUpdated")
        }),
        e.on("GameFightSynchronizeMessage", function(e) {
            var t = e.fighters
              , i = r.getAvailableFighters();
            if (e._synchronizeBuff)
                for (var n in i)
                    i[n].enableBuffs();
            for (var o = 0; o < t.length; o++) {
                var s = t[o];
                if (s.alive) {
                    var a = i[s.contextualId];
                    if (!a)
                        return console.error(new Error("Synchronizing failed, fighter does not exist"));
                    a.synchronizeData(s)
                }
            }
        }),
        e.on("GameFightLeaveMessage", function(e) {
            var t = e.charId;
            t === a.id && ("fightPlacement" === window.foreground.tapOptions.mode || a.isSpectator) && r.emit("gameFightLeave", t)
        }),
        e.on("_GameActionFightLeaveMessage", function(e) {
            o(e.targetId, !0)
        }),
        e.on("GameActionFightDeathMessage", function(e) {
            o(e.targetId, !1)
        }),
        e.on("GameFightRefreshFighterMessage", function(e) {
            var t = e.informations
              , i = t.contextualId
              , n = r.getFighter(i);
            return n ? (n.data.updateData({
                look: t.look,
                disposition: t.disposition
            }),
            void ("fightPlacement" === window.foreground.tapOptions.mode && (n.updateFighterIllustration(),
            r.emit("UpdatePreFightersList", i)))) : console.error("Refreshing fighter failed, fighter " + i + " does not exist")
        }),
        e.on("GameFightRemoveTeamMemberMessage", function(e) {
            var t = e.charId;
            r.removeFighter(t),
            "fightPlacement" === window.foreground.tapOptions.mode && r.emit("UpdatePreFightersList", t)
        }),
        e.on("GameFightNewRoundMessage", function(e) {
            r.turnCount = e.roundNumber - 1,
            r.emit("TurnCountUpdated", e.roundNumber - 1)
        }),
        e.on("GameFightResumeMessage", function(e) {
            r.gameFightResumeMessage(e)
        }),
        e.on("GameFightResumeWithSlavesMessage", function(e) {
            r.gameFightResumeMessage(e)
        }),
        e.on("GameFightSpectateMessage", function(e) {
            r.gameFightResumeMessage(e)
        }),
        e.on("GameActionFightChangeLookMessage", function(e) {
            var t = e.targetId
              , i = r.getFighter(t);
            if (!i)
                return console.error(new Error("Changing fighter's look failed, fighter does not exist"));
            var n = e.entityLook;
            i.data.updateData({
                look: n
            }),
            i.updateFighterIllustration(),
            r.emit(d.FIGHTER_CHANGE_LOOK, [t, n], t)
        }),
        e.on("GameActionFightDispellEffectMessage", function(e) {
            T(I.fightDispelEffectStep, [D ? D.castingSpellId : -1, e.targetId, e.boostUID])
        }),
        e.on("GameActionFightDispellSpellMessage", function(e) {
            T(I.fightDispelSpellStep, [D ? D.castingSpellId : -1, e.targetId, e.spellId])
        }),
        e.on("GameActionFightDispellMessage", function(e) {
            T(I.fightDispelStep, [D ? D.castingSpellId : -1, e.targetId])
        }),
        e.on("GameActionFightNoSpellCastMessage", function(e) {
            var t, i = e.spellLevelId, n = a.characters.getControlledCharacter();
            if (t = 0 === i ? n.spellData.spells[M] : n.spellData.getSpellBySpellLevelId(e.spellLevelId),
            t && r.spellCastCounts[t.id]) {
                r.spellCastCounts[t.id] = r.spellCastCounts[t.id] - 1;
                var o = t.getProperty("apCost", t.level);
                n.setCharacteristic("actionPointsCurrent", n.characteristics.actionPointsCurrent + o)
            }
        }),
        e.on("GameActionFightLifePointsGainMessage", function(e) {
            T(I.fightLifePointsVariationStep, [D ? D.castingSpellId : -1, e.targetId, e.delta, 0, e.actionId])
        }),
        e.on("GameActionFightLifePointsLostMessage", function(e) {
            T(I.fightLifePointsVariationStep, [D ? D.castingSpellId : -1, e.targetId, -e.loss, -e.permanentDamages, e.actionId])
        }),
        e.on("GameActionFightLifeAndShieldPointsLostMessage", function(e) {
            T(I.fightShieldPointsVariationStep, [D ? D.castingSpellId : -1, e.targetId, -e.shieldLoss, e.actionId]),
            T(I.fightLifePointsVariationStep, [D ? D.castingSpellId : -1, e.targetId, -e.loss, -e.permanentDamages, e.actionId])
        }),
        e.on("GameActionFightPointsVariationMessage", function(e) {
            var t = e.targetId
              , i = e.actionId
              , n = e.delta;
            i === g.ACTION_CHARACTER_ACTION_POINTS_USE || i === g.ACTION_CHARACTER_ACTION_POINTS_LOST || i === g.ACTION_CHARACTER_ACTION_POINTS_WIN ? T(I.fightActionPointsVariationStep, [D ? D.castingSpellId : -1, t, n, i === g.ACTION_CHARACTER_ACTION_POINTS_USE]) : i !== g.ACTION_CHARACTER_MOVEMENT_POINTS_USE && i !== g.ACTION_CHARACTER_MOVEMENT_POINTS_LOST && i !== g.ACTION_CHARACTER_MOVEMENT_POINTS_WIN || T(I.fightMovementPointsVariationStep, [D ? D.castingSpellId : -1, t, n, i === g.ACTION_CHARACTER_MOVEMENT_POINTS_USE])
        }),
        e.on("GameActionFightVanishMessage", function(e) {
            var t = e.targetId
              , i = r.getFighter(t);
            return i ? (i.setAlive(!1),
            i.dispel(!1, !1, !0),
            r.removeLinkedBuff(t, !1, !0),
            void r.reaffectBuffs(t)) : console.error(new Error("Vanish failed, fighter does not exist"))
        }),
        l.on("CharacterSelectedForceMessage", function() {
            r.isInReconnection = !0
        }),
        e.on("GameFightJoinMessage", function(e) {
            r.fightState = e.isFightStarted ? N.BATTLE : N.PREPARATION,
            r.fightType = e.fightType;
            var t = e.isSpectator;
            t ? window.actorManager.userActor.hide() : window.actorManager.userActor.show(),
            a.isSpectator = t,
            a.isFighting = !0,
            e.isFightStarted ? (window.isoEngine.displayTextBanner("tablet.fight.animation.fightStarts"),
            r.emit("fightEnterBattle", "PREPARATION_SKIPPED")) : (window.isoEngine.displayTextBanner("tablet.fight.animation.preparationPhase"),
            r.emit("fightEnterPreparation", e))
        }),
        e.on("GameActionFightSpellCooldownVariationMessage", function(e) {
            T(I.fightSpellCooldownVariationStep, [D ? D.castingSpellId : -1, e.targetId, e.spellId, e.value])
        }),
        e.on("GameActionFightModifyEffectsDurationMessage", function(e) {
            T(I.fightModifyEffectsDurationStep, [D ? D.castingSpellId : -1, e.sourceId, e.targetId, e.delta])
        }),
        e.on("GameActionFightExchangePositionsMessage", function(e) {
            T(I.fightExchangePositionsStep, [D ? D.castingSpellId : -1, e.sourceId, e.casterCellId, e.targetId, e.targetCellId])
        }),
        e.on("GameActionFightSlideMessage", function(e) {
            T(I.fightSlideStep, [D ? D.castingSpellId : -1, e.targetId, e.endCellId])
        }),
        e.on("GameActionFightTeleportOnSameMapMessage", function(e) {
            T(I.fightTeleportOnSameMapStep, [D ? D.castingSpellId : -1, e.targetId, e.cellId])
        }),
        e.on("GameMapMovementMessage", function(e) {
            var t = e.keyMovements[e.keyMovements.length - 1];
            T(I.mapMovementStep, [D ? D.castingSpellId : -1, e.actorId, t])
        }),
        e.on("GameActionFightCarryCharacterMessage", function(e) {
            T(I.fightCarryCharacterStep, [D ? D.castingSpellId : -1, e.sourceId, e.targetId])
        }),
        e.on("GameActionFightThrowCharacterMessage", function(e) {
            T(I.fightThrowCharacterStep, [D ? D.castingSpellId : -1, e.sourceId, e.targetId, e.cellId])
        }),
        e.on("GameActionFightDropCharacterMessage", function(e) {
            T(I.fightThrowCharacterStep, [D ? D.castingSpellId : -1, e.sourceId, e.targetId, e.cellId])
        }),
        e.on("sendAllFightEvent", function() {
            C.flush()
        }),
        e.on("GameActionFightReduceDamagesMessage", function(e) {
            T(I.fightReduceDamages, [D ? D.castingSpellId : -1, e.targetId, e.amount])
        }),
        e.on("GameActionFightDodgePointLossMessage", function(e) {
            var t = e.actionId;
            t === g.ACTION_FIGHT_SPELL_DODGED_PA ? T(I.fightActionPointsLossDodge, [D ? D.castingSpellId : -1, e.targetId, e.amount]) : t === g.ACTION_FIGHT_SPELL_DODGED_PM && T(I.fightMovementPointsLossDodge, [D ? D.castingSpellId : -1, e.targetId, e.amount])
        }),
        e.on("GameActionFightSpellImmunityMessage", function(e) {
            T(I.fightSpellImmunity, [D ? D.castingSpellId : -1, e.targetId])
        }),
        e.on("GameActionFightReflectSpellMessage", function(e) {
            T(I.fightReflectSpellStep, [D ? D.castingSpellId : -1, e.targetId])
        }),
        e.on("GameActionFightReflectDamagesMessage", function(e) {
            T(I.fightReflectDamagesStep, [D ? D.castingSpellId : -1, e.sourceId])
        }),
        e.on("GameActionFightTackledMessage", function(e) {
            T(I.fightTackledStep, [D ? D.castingSpellId : -1, e.sourceId])
        }),
        e.on("GameActionFightKillMessage", function(e) {
            T(I.fightKillStep, [D ? D.castingSpellId : -1, e.targetId, e.sourceId])
        }),
        e.on("GameActionFightInvisibilityMessage", function(e) {
            T(I.fightInvisibilityStep, [D ? D.castingSpellId : -1, e.targetId, e.state])
        }),
        e.on("GameActionFightTriggerGlyphTrapMessage", function(e) {
            T(I.fightTriggerGlyphTrapStep, [D ? D.castingSpellId : -1, e.triggeringCharacterId, e.sourceId, e._spellId])
        }),
        e.on("GameFightUpdateTeamMessage", function(e) {
            a.isFightLeader = e.team.leaderId === a.id
        }),
        e.on("GameContextDestroyMessage", function() {
            window.isoEngine.gameContext === y.FIGHT && (r.fightState = N.UNDEFINED)
        })
    }
    ,
    o.prototype.getNextControllableCharacterId = function() {
        var e = this.turnsList
          , t = e.length;
        if (0 === t)
            return a.characters.controlledCharacterId;
        for (var i = e.indexOf(this.currentFighterId), n = 1; n < t; n++) {
            var o = e[(i + n) % t]
              , s = this.getFighter(o);
            if (!s)
                return console.error(new Error("Find next controllable character failed, fighter does not exist"));
            if (a.characters.canControlCharacterId(o) && s.data.alive)
                return o
        }
        return a.characters.controlledCharacterId
    }
    ,
    o.prototype.prepareNextPlayableCharacter = function() {
        var e = this.getNextControllableCharacterId();
        a.characters.switchControlledCharacter(e)
    }
    ,
    o.prototype.removeFighter = function(e) {
        var t = this.getFighter(e);
        return t ? (t.clear(),
        void delete this._fighters[e]) : console.warn("Removing fighter failed, it does not exist")
    }
    ,
    o.prototype.loadFighter = function(e) {
        var t = e.actionId
          , i = "GameFightShowFighterRandomStaticPoseMessage" === e._type || t === A || t === E
          , n = s(e);
        if (!n)
            return void console.warn("Fighter informations could not be extracted from this message type: " + e._messageType);
        var o = this.addFighter(n.contextualId, i);
        o.setData(n);
        var a = window.actorManager.getActor(o.id);
        a && a.addTeamCircle()
    }
    ,
    o.prototype.prepareSpellsWithInitialCooldown = function(e) {
        function t(e, t) {
            return e ? console.error(e) : void t.resetInitialCooldown(i.turnCount)
        }
        var i = this;
        for (var n in e.spellData.spells) {
            var o = e.spellData.spells[n];
            o.isItem || 0 === o.spellLevel.initialCooldown || this.getFighterSpell(n, e.spellData.characterId, t)
        }
    }
    ,
    o.prototype.addDispellableEffect = function(e, t) {
        function i() {
            function i(i, o) {
                if (i)
                    return console.error(i);
                if (o.timeCreationStarted = s,
                o instanceof m.StateBuff && (952 === o.actionId ? T(I.fightLeavingStateStep, [D ? D.castingSpellId : -1, o.targetId, o.stateId]) : T(I.fightEnteringStateStep, [D ? D.castingSpellId : -1, o.targetId, o.stateId, o.effect.getDurationString()])),
                "FightTemporaryBoostEffect" === n._type) {
                    var a = e.actionId;
                    a !== g.ACTION_CHARACTER_MAKE_INVISIBLE && a !== g.ACTION_CHARACTER_UPDATE_BOOST && a !== g.ACTION_CHARACTER_CHANGE_LOOK && a !== g.ACTION_CHARACTER_CHANGE_COLOR && a !== g.ACTION_CHARACTER_ADD_APPEARANCE && a !== g.ACTION_FIGHT_SET_STATE && T(I.fightTemporaryBoostStep, [D ? D.castingSpellId : -1, e.effect.targetId, o.effect.description, o.effect.duration, o.effect.getDurationString()])
                }
                return T(I.fightDisplayBuffStep, [D ? D.castingSpellId : -1, o]),
                delete o.timeCreationStarted,
                t()
            }
            var n = e.effect;
            m.makeBuffFromEffect(n, o, e.actionId, i)
        }
        var o;
        o = new n(e.actionId === g.ACTION_CHARACTER_UPDATE_BOOST ? !1 : !D),
        D && (o.castingSpellId = D.castingSpellId,
        D.spell.id === e.effect.spellId && (o.spellRank = D.spellRank));
        var s = Date.now()
          , a = e.effect.spellId;
        o.casterId = e.sourceId,
        this.getFighterSpell(a, o.casterId, function(e, n) {
            return e ? t(e) : n ? (o.spell = n,
            void i()) : t(new Error("unable to find spell id " + a))
        })
    }
    ,
    o.prototype.gameActionFightCloseCombatAndSpell = function(e, t) {
        var i = this
          , o = "GameActionFightCloseCombatMessage" === e._messageType
          , s = 0;
        o && (e.spellId = M,
        e.spellLevel = 1,
        s = e.weaponGenericId),
        this.spellCastCounts[e.spellId] && (this.spellCastCounts[e.spellId] = this.spellCastCounts[e.spellId] - 1),
        this.getFighterSpell(e.spellId, e.sourceId, function(r, l) {
            return r ? t(r) : l ? (D = new n,
            D.casterId = e.sourceId,
            D.spell = l,
            D.spellRank = o ? null : l.getProperty("spellLevel", e.spellLevel),
            D.isCriticalFail = e.critical === v.CRITICAL_FAIL,
            D.isCriticalHit = e.critical === v.CRITICAL_HIT,
            D.silentCast = e.silentCast,
            o && (D.weaponId = e.weaponGenericId),
            e.sourceId === a.characters.controlledCharacterId && e.critical !== v.CRITICAL_FAIL && l.cast(i.turnCount, [e.targetId]),
            o && 0 !== s ? T(I.fightCloseCombatStep, [D ? D.castingSpellId : -1, e.sourceId, s, e.critical]) : T(I.fightSpellCastStep, [D ? D.castingSpellId : -1, e.sourceId, e.spellId, e.critical]),
            void t()) : t(new Error("unable to find spell id " + e.spellId))
        })
    }
    ,
    o.prototype._restoreSpellCooldown = function(e, t, i) {
        if (t.cast(this.turnCount, [], !1),
        63 === e.cooldown)
            return t.forceLastCastTurn(this.turnCount + e.cooldown - t.spellLevel.minCastInterval),
            i();
        var n = t.getModifiedInterval();
        return t.forceLastCastTurn(this.turnCount + e.cooldown - n),
        i()
    }
    ,
    o.prototype._restoreCooldowns = function(e, t, i) {
        var n = this;
        if (!t || 0 === t.length)
            return i();
        var o = this.getFighter(e);
        return o ? void w.each(t, function(t, i) {
            if ("GameFightSpellCooldown" !== t._type)
                return i();
            var s = t.spellId
              , a = o.spells[s];
            return a ? n._restoreSpellCooldown(t, a, i) : void n.getFighterSpell(s, e, function(e, o) {
                return e ? i(e) : n._restoreSpellCooldown(t, o, i)
            })
        }, function(e) {
            i(e)
        }) : console.error(new Error("Restoring cooldowns failed, fighter does not exist."))
    }
    ,
    o.prototype._restoreBuffs = function(e, t) {
        function i(e, i, n, o) {
            m.makeBuffFromEffect(e, i, n, function(e, i) {
                if (e)
                    return o(e);
                var n = s.getFighter(i.targetId);
                if (!n)
                    return o(new Error("Restoring buffs failed, fighter does not exist"));
                var a = !t || !(i instanceof m.StatBuff);
                return n.addBuff(i, a),
                o()
            })
        }
        function o(e, t) {
            var o = e.effect;
            a[o.targetId] || (a[o.targetId] = {}),
            a[o.targetId][o.turnDuration] || (a[o.targetId][o.turnDuration] = {});
            var r = a[o.targetId][o.turnDuration][o.spellId];
            return r ? void i(o, r, e.actionId, t) : (r = new n,
            r.casterId = e.sourceId,
            s.getFighterSpell(o.spellId, r.casterId, function(n, s) {
                return n ? t(n) : s ? (r.spell = s,
                a[o.targetId][o.turnDuration][o.spellId] = r,
                void i(o, r, e.actionId, t)) : t(new Error("unable to find spell id " + o.spellId))
            }))
        }
        var s = this
          , a = {};
        w.eachSeries(e, function(e, t) {
            return o(e, t)
        }, function(e) {
            if (s.isInReconnection = !1,
            e)
                return console.error(e)
        })
    }
    ,
    o.prototype.gameFightResumeMessage = function(e) {
        var t = this;
        if (a.characters.mainCharacter.currentSummonedCreature = e.summonCount,
        a.characters.mainCharacter.currentSummonedBomb = e.bombCount,
        this.turnCount = e.gameTurn - 1,
        this.emit("TurnCountUpdated", e.gameTurn - 1),
        "GameFightSpectateMessage" === e._messageType)
            return t._restoreBuffs(e.effects, !0),
            C.flush();
        var i = e.slavesInfo || [];
        i.unshift({
            slaveId: a.characters.mainCharacterId,
            spellCooldowns: e.spellCooldowns
        }),
        w.eachSeries(i, function(e, i) {
            return t._restoreCooldowns(e.slaveId, e.spellCooldowns, i)
        }, function(i) {
            return i ? console.error(i) : t._restoreBuffs(e.effects, !1)
        })
    }
    ,
    o.prototype.addFighter = function(e, t) {
        var i = this.getFighter(e);
        return i ? i : (i = new f(e,t),
        this._fighters[e] = i,
        i)
    }
    ,
    o.prototype.getOrdonnedPreFighters = function() {
        var e = []
          , t = []
          , i = []
          , n = 0
          , o = 0
          , s = this.getAvailableFighters();
        for (var a in s) {
            var r = s[a]
              , l = r.data.stats;
            if (l) {
                l.initiative || 0 === l.initiative || (console.warn("Initiative stats is not defined, it will be initialized at 0."),
                l.initiative = 0);
                var c = ~~(l.initiative * l.lifePoints / l.maxLifePoints);
                0 === r.data.teamId ? (i.push({
                    fighter: a,
                    init: c
                }),
                n += c) : (t.push({
                    fighter: a,
                    init: c
                }),
                o += c)
            }
        }
        var u = function(e, t) {
            return e.init === t.init ? t.fighter - e.fighter : t.init - e.init
        };
        i.sort(u),
        t.sort(u);
        var h = i
          , d = t;
        (0 === i.length || 0 === t.length || n / i.length < o / t.length) && (h = t,
        d = i);
        var p, m = Math.min(h.length, d.length);
        for (p = 0; p < m; p++)
            e.push(h[p].fighter),
            e.push(d[p].fighter);
        var f = i.length > t.length ? i : t;
        for (m = f.length; p < m; p++)
            e.push(f[p].fighter);
        return e
    }
    ,
    o.prototype.canCastThisSpell = function(e) {
        var t = a.characters.getControlledCharacter()
          , i = a.characters.controlledCharacterId
          , n = this.getFighter(i);
        if (!n)
            return !1;
        var o, s = n.states, r = t.spellData.spells, l = r[e], c = l.getProperty("apCost"), u = t.characteristics.actionPointsCurrent;
        if (c > u)
            return !1;
        var h = l.getProperty("canSummon");
        if (h && !a.characters.canSummonCreature())
            return !1;
        var d = l.getProperty("canBomb");
        if (d && !a.characters.canSummonBomb())
            return !1;
        var p = l.getProperty("statesForbidden")
          , m = l.getProperty("statesRequired");
        for (o = 0; o < s.length; o++) {
            var f = window.gui.databases.SpellStates[s[o]];
            if (p && p.length > 0 && p.indexOf(s[o]) !== -1)
                return !1;
            if (e === M && f && f.preventsFight)
                return !1
        }
        if (m)
            for (o = 0; o < m.length; o++)
                if (s.indexOf(m[o]) === -1)
                    return !1;
        var g = n.spells[e];
        if (g && g.hasBeenCast()) {
            var _ = g.getProperty("maxCastPerTurn");
            if (_ > 0 && g.castingData.castThisTurn >= _)
                return !1;
            if (g.getCooldown() > 0)
                return !1
        }
        return !0
    }
    ,
    o.prototype.getSpellCooldown = function(e) {
        var t = a.characters.controlledCharacterId
          , i = this.getFighter(t);
        if (!i || !i.spells[e])
            return 0;
        var n = i.spells[e].getCooldown();
        return Math.max(0, n)
    }
    ,
    o.prototype.decrementDuration = function(e) {
        this.incrementDuration(e, -1)
    }
    ,
    o.prototype.incrementDuration = function(e, t, i, n) {
        void 0 === n && (n = this.INCREMENT_MODE_SOURCE);
        var o, s = this.getAvailableFighters();
        for (var a in s) {
            o = [];
            for (var r = s[a], l = r.buffs, c = 0; c < l.length; c++) {
                var u = l[c];
                if (n === this.INCREMENT_MODE_SOURCE && u.aliveSource === e || n === this.INCREMENT_MODE_TARGET && u.targetId === e) {
                    var h = u.incrementDuration(t, i);
                    u.isActive() ? (o.push(u),
                    h && this.emit("BuffUpdate", u, r)) : (u.remove(),
                    this.emit("BuffRemove", u, r))
                } else
                    o.push(u)
            }
            r.buffs = o
        }
    }
    ,
    o.prototype.removeLinkedBuff = function(e, t, i) {
        var n = this.getAvailableFighters();
        for (var o in n)
            for (var s = n[o], a = s.buffs, r = 0; r < a.length; r++) {
                var l = a[r];
                l.source === e && s.dispelUniqueBuff(l.id, t, i, !1),
                i && s.isSummon() && (l.aliveSource = s.data.stats.summoner)
            }
    }
    ,
    o.prototype.reaffectBuffs = function(e) {
        var t = this.getFighter(e);
        if (!t)
            return console.error(new Error("Reaffecting buffs failed, fighter does not exist"));
        if (t.isSummon()) {
            var i = this.getNextFighterId(e);
            if (i === -1)
                return;
            var n = this.getAvailableFighters();
            for (var o in n)
                for (var s = n[o].buffs, a = 0; a < s.length; a++) {
                    var r = s[a];
                    r.aliveSource === e && (r.aliveSource = i)
                }
        }
    }
    ,
    o.prototype.getNextFighterId = function(e) {
        var t = this.turnsList.indexOf(e);
        return t === -1 ? -1 : (t + 1) % this.turnsList.length
    }
    ,
    o.prototype.spellCastSucceeded = function(e, t) {
        if (a.characters.controlledCharacterId === t) {
            var i = this.spellCastCounts[e];
            this.spellCastCounts[e] = i ? i + 1 : 1;
            var n = a.characters.getControlledCharacter()
              , o = n.spellData.spells[e]
              , s = o.getProperty("apCost", o.level);
            n.setCharacteristic("actionPointsCurrent", n.characteristics.actionPointsCurrent - s)
        }
    }
    ,
    o.prototype.processFightSequenceMessage = function(e) {
        function t() {
            i.isProcessing = !1,
            i.fightMessagesStack.length && i.processFightSequenceMessage(i.fightMessagesStack.shift())
        }
        if (this.isProcessing)
            return this.fightMessagesStack.push(e);
        var i = this;
        this.isProcessing = !0;
        var n = this.asyncFightMessages[e._messageType];
        return n ? (window.gui.emit(e._messageType, e),
        n.call(this, e, t)) : (window.gui.emit(e._messageType, e),
        void t())
    }
    ,
    o.prototype.isInBattle = function() {
        return this.fightState === N.BATTLE
    }
    ,
    o.prototype.isFightersTurn = function(e) {
        return this.currentFighterId === e
    }
    ,
    o.prototype.getIsTurnEndRequestPending = function() {
        return this._isTurnEndRequestPending
    }
    ,
    o.prototype.isFighterOnUsersTeam = function(e) {
        var t = this.getFighter(window.actorManager.userActor.actorId)
          , i = this.getFighter(e);
        return t && i ? t.data.teamId === i.data.teamId : (console.warning("fighter not found"),
        !1)
    }
}
, function(e, t) {
    e.exports = {
        UNKNOWN_FIGHT_EVENT: "unknown",
        FIGHTER_LIFE_GAIN: "fighterLifeGain",
        FIGHTER_LIFE_LOSS: "fighterLifeLoss",
        FIGHTER_LIFE_LOSS_AND_DEATH: "fightLifeLossAndDeath",
        FIGHTER_NO_CHANGE: "fighterNoChange",
        FIGHTER_DEATH: "fighterDeath",
        FIGHT_END: "fightEnd",
        FIGHTER_LEAVE: "fighterLeave",
        FIGHTER_CHANGE_LOOK: "fighterChangeLook",
        FIGHTER_GOT_DISPELLED: "fighterGotDispelled",
        FIGHTER_SPELL_DISPELLED: "fighterSpellDispelled",
        FIGHTER_EFFECTS_MODIFY_DURATION: "fighterEffectsModifyDuration",
        FIGHTER_SPELL_COOLDOWN_VARIATION: "fighterSpellCooldownVariation",
        FIGHTER_SPELL_IMMUNITY: "fighterSpellImmunity",
        FIGHTER_AP_LOSS_DODGED: "fighterDodgedAPLoss",
        FIGHTER_MP_LOSS_DODGED: "fighterDodgedMPLoss",
        FIGHTERS_POSITION_EXCHANGE: "fightersExchangedPositions",
        FIGHTER_VISIBILITY_CHANGED: "fighterVisibilityChanged",
        FIGHTER_INVISIBLE_OBSTACLE: "fighterInvisibleObstacle",
        FIGHTER_GOT_KILLED: "fighterGotKilled",
        FIGHTER_TEMPORARY_BOOSTED: "fighterTemporaryBoosted",
        FIGHTER_AP_USED: "fighterUsedAP",
        FIGHTER_AP_LOST: "fighterLostAP",
        FIGHTER_AP_GAINED: "fighterGainedAP",
        FIGHTER_MP_USED: "fighterUsedMP",
        FIGHTER_MP_LOST: "fighterLostMP",
        FIGHTER_MP_GAINED: "fighterGainedMP",
        FIGHTER_SHIELD_GAIN: "fighterShieldGain",
        FIGHTER_SHIELD_LOSS: "fighterShieldLoss",
        FIGHTER_REDUCED_DAMAGES: "fighterReducedDamages",
        FIGHTER_REFLECTED_DAMAGES: "fighterReflectedDamages",
        FIGHTER_REFLECTED_SPELL: "fighterReflectedSpell",
        FIGHTER_SLIDE: "fighterSlided",
        FIGHTER_CASTED_SPELL: "fighterCastedSpell",
        FIGHTER_CLOSE_COMBAT: "fighterCloseCombat",
        FIGHTER_DID_CRITICAL_HIT: "fighterDidCriticalHit",
        FIGHTER_DID_CRITICAL_MISS: "fighterDidCriticalMiss",
        FIGHTER_ENTERING_STATE: "fighterEnteredState",
        FIGHTER_LEAVING_STATE: "fighterLeftState",
        FIGHTER_STEALING_KAMAS: "fighterStoleKamas",
        FIGHTER_SUMMONED: "fighterSummoned",
        FIGHTER_GOT_TACKLED: "fighterGotTackled",
        FIGHTER_TELEPORTED: "fighterTeleported",
        FIGHTER_TRIGGERED_GLYPH: "fighterTriggeredGlyph",
        FIGHTER_TRIGGERED_TRAP: "fighterTriggeredTrap",
        FIGHTER_CARRY: "fighterCarry",
        FIGHTER_THROW: "fighterThrow",
        GLYPH_APPEARED: "glyphAppeared",
        GLYPH_DISAPPEARED: "glyphDisappeared",
        TRAP_APPEARED: "trapAppeared",
        TRAP_DISAPPEARED: "trapDisappeared"
    }
}
, function(e, t) {
    e.exports = {
        FIGHT_OPTION_SET_SECRET: 0,
        FIGHT_OPTION_SET_TO_PARTY_ONLY: 1,
        FIGHT_OPTION_SET_CLOSED: 2,
        FIGHT_OPTION_ASK_FOR_HELP: 3
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var c;
        switch (e._type) {
        case "FightTemporarySpellBoostEffect":
            c = new s(e,t,i,n);
            break;
        case "FightTriggeredEffect":
            c = new l(e,t,i,n);
            break;
        case "FightTemporaryBoostWeaponDamagesEffect":
            c = new o(e,t,i,e.weaponTypeId,e.delta,e.weaponTypeId,n);
            break;
        case "FightTemporaryBoostStateEffect":
            c = new r(e,t,i,n);
            break;
        case "FightTemporarySpellImmunityEffect":
            c = new o(e,t,i,e.immuneSpellId,null ,null ,n);
            break;
        case "FightTemporaryBoostEffect":
            c = new a(e,t,i,n)
        }
        return c
    }
    var o = i(221)
      , s = i(225)
      , a = i(230)
      , r = i(231)
      , l = i(236);
    o.setStateBuff(r),
    t.BasicBuff = o,
    t.SpellBuff = s,
    t.StatBuff = a,
    t.StateBuff = r,
    t.TriggeredBuff = l,
    t.makeBuffFromEffect = n
}
, function(e, t, i) {
    function n(e, t, i, n, o, s, a) {
        this._disabled = !1,
        this._removed = !1,
        this.id = e.uid,
        this.uid = e.uid,
        this.actionId = i,
        this.targetId = e.targetId,
        this.castingSpell = t,
        this.duration = e.turnDuration,
        this.dispelable = e.dispelable,
        this.source = t.casterId,
        this.stack = null ;
        var r = window.gui.fightManager;
        r.isInReconnection || window.gui.playerData.isSpectator || 0 === r.currentFighterId ? this.aliveSource = this.source : this.aliveSource = r.currentFighterId,
        this.parentBoostUid = 0,
        this.initParam(n, o, s, a)
    }
    var o, s = i(222), a = i(223), r = i(224), l = r.EffectInstance, c = [s.ACTION_BOOST_SPELL_RANGE, s.ACTION_BOOST_SPELL_RANGEABLE, s.ACTION_BOOST_SPELL_DMG, s.ACTION_BOOST_SPELL_HEAL, s.ACTION_BOOST_SPELL_AP_COST, s.ACTION_BOOST_SPELL_CAST_INTVL, s.ACTION_BOOST_SPELL_CC, s.ACTION_BOOST_SPELL_CASTOUTLINE, s.ACTION_BOOST_SPELL_NOLINEOFSIGHT, s.ACTION_BOOST_SPELL_MAXPERTURN, s.ACTION_BOOST_SPELL_MAXPERTARGET, s.ACTION_BOOST_SPELL_CAST_INTVL_SET, s.ACTION_BOOST_SPELL_BASE_DMG, s.ACTION_DEBOOST_SPELL_RANGE, 406, 787, 792, 793, 1017, 1018, 1019, 1035, 1036, 1044, 1045], u = function(e) {
        e && console.error(e)
    };
    e.exports = n,
    n.prototype.getParam1 = function() {
        return "EffectInstanceDice" === this.effect._type ? this.effect.diceNum : null
    }
    ,
    n.prototype.getParam2 = function() {
        return "EffectInstanceDice" === this.effect._type ? this.effect.diceSide : null
    }
    ,
    n.prototype.getParam3 = function() {
        return "EffectInstanceInteger" === this.effect._type ? this.effect.value : null
    }
    ,
    n.prototype._setParameter = function(e, t) {
        this.effect.setParameter(e, 0 === t ? null : t)
    }
    ,
    n.prototype.setParam1 = function(e) {
        this._setParameter(0, e)
    }
    ,
    n.prototype.setParam2 = function(e) {
        this._setParameter(1, e)
    }
    ,
    n.prototype.setParam3 = function(e) {
        this._setParameter(2, e)
    }
    ,
    n.prototype.initParam = function(e, t, i, n) {
        n || (n = u);
        var o = {
            effectId: this.actionId,
            duration: this.duration,
            trigger: this.isTrigger(),
            value: i
        };
        (e || t) && (o.diceNum = e,
        o.diceSide = t),
        this.effect = new l(o);
        var s = this;
        r.collectEffectInstanceData([this.effect], function(e) {
            return e ? n(e) : void n(null , s)
        })
    }
    ,
    n.prototype.updateParam = function(e, t, i) {
        switch (this.actionId) {
        case 788:
            this.setParam1(t);
            break;
        case 950:
        case 951:
            break;
        default:
            this.setParam1(e),
            this.setParam2(t),
            this.setParam3(i)
        }
        this.refreshDescription()
    }
    ,
    n.prototype.equals = function(e, t) {
        var i = this.castingSpell.spellRank && e.castingSpell.spellRank && !t && this.castingSpell.spellRank.id !== e.castingSpell.spellRank.id;
        if (this.targetId !== e.targetId || this.effect.effectId !== e.actionId || this.duration !== e.duration || this.effect.hasOwnProperty("delay") && this.effect.delay !== e.effect.delay || i || !t && this.castingSpell.spell.id !== e.castingSpell.spell.id || this.constructor !== e.constructor || this.source !== e.source || this.isTrigger())
            return !1;
        var n = this.actionId;
        if (788 === n) {
            if (this.getParam1() !== e.getParam1())
                return !1
        } else if (c.indexOf(n) !== -1) {
            if (this.getParam1() !== e.getParam1())
                return !1
        } else {
            if (165 === n)
                return !1;
            if (n === e.actionId && (952 === n || 951 === n || 950 === n) && this instanceof o && e instanceof o && this.stateId !== e.stateId)
                return !1
        }
        return !0
    }
    ,
    n.prototype.apply = function() {
        this._disabled = !1,
        this._removed = !1
    }
    ,
    n.prototype.remove = function() {
        this._removed = !0,
        this._disabled || this.disable()
    }
    ,
    n.prototype.enable = function() {
        this._disabled = !1
    }
    ,
    n.prototype.disable = function() {
        this._disabled = !0
    }
    ,
    n.prototype.incrementDuration = function(e, t) {
        return !(t && !this.canBeDispell()) && (!(this.duration >= 63) && (this.duration + e > 0 ? (this.duration += e,
        this.effect.duration += e,
        !0) : this.duration > 0 && (this.duration = 0,
        this.effect.duration = 0,
        !0)))
    }
    ,
    n.prototype.isActive = function() {
        return 0 !== this.duration
    }
    ,
    n.prototype.isTrigger = function() {
        return !1
    }
    ,
    n.prototype.canBeDispell = function(e, t, i) {
        if (t = void 0 === t ? Number.MIN_VALUE : t,
        t === this.id)
            return !0;
        switch (this.dispelable) {
        case a.DISPELLABLE:
            return !0;
        case a.DISPELLABLE_BY_STRONG_DISPEL:
            return e;
        case a.DISPELLABLE_BY_DEATH:
            return i || e;
        case a.REALLY_NOT_DISPELLABLE:
            return t === this.id;
        default:
            return !1
        }
    }
    ,
    n.prototype.add = function(e) {
        switch (this.stack || (this.stack = [],
        this.stack.push(this)),
        this.stack.push(e),
        this.actionId) {
        case 293:
            this.setParam1(e.getParam1()),
            this.setParam2(this.getParam2() + e.getParam2()),
            this.setParam3(this.getParam3() + e.getParam3());
            break;
        case 788:
            this.setParam1(this.getParam1() + e.getParam2());
            break;
        case 950:
        case 951:
        case 952:
            break;
        default:
            this.setParam1(this.getParam1() + e.getParam1()),
            this.setParam2(this.getParam2() + e.getParam2()),
            this.setParam3(this.getParam3() + e.getParam3())
        }
        this.refreshDescription()
    }
    ,
    n.prototype.isUnusableNextTurn = function() {
        if (this.duration > 1 || this.duration < 0)
            return !1;
        var e = window.gui.fightManager
          , t = e.currentFighterId
          , i = window.gui.playerData.id;
        if (t === i || t === this.source)
            return !1;
        var n = e.turnsList
          , o = n.indexOf(i)
          , s = n.indexOf(t)
          , a = n.indexOf(this.source);
        return a < s && (a += n.length),
        o < s && (o += n.length),
        !(o < a)
    }
    ,
    n.prototype.refreshDescription = function() {
        this.effect.forceDescriptionRefresh()
    }
    ,
    e.exports.setStateBuff = function(e) {
        o = e
    }
    ,
    n.prototype.getDelta = function() {
        return console.warn("BasicBuff.prototype.getDelta should not be called directly"),
        0
    }
}
, function(e, t) {
    function i(e) {
        return s[e] ? s[e][0] : null
    }
    function n(e) {
        return !!s[e] && s[e][1]
    }
    var o = {
        ACTION_ENCAPSULATE_BINARY_COMMAND: 993,
        ACTION_ENDS_TURN: -2,
        ACTION_INTERNAL_SEND_ACTION_BUFFER: -1,
        ACTION_NO_OPERATION: 0,
        ACTION_SEQUENCE_START: 83,
        ACTION_SEQUENCE_END: 70,
        ACTION_CHARACTER_MOVEMENT: 1,
        ACTION_CHARACTER_CHANGE_MAP: 2,
        ACTION_CHARACTER_CHANGE_RESPAWN_MAP: 3,
        ACTION_CHARACTER_TELEPORT_ON_SAME_MAP: 4,
        ACTION_CHARACTER_PUSH: 5,
        ACTION_CHARACTER_PULL: 6,
        ACTION_CHARACTER_DIVORCE_WIFE_OR_HUSBAND: 7,
        ACTION_CHARACTER_EXCHANGE_PLACES: 8,
        ACTION_CHARACTER_DODGE_HIT: 9,
        ACTION_CHARACTER_LEARN_EMOTICON: 10,
        ACTION_CHARACTER_SET_DIRECTION: 11,
        ACTION_CHARACTER_CREATE_GUILD: 12,
        ACTION_USE_PUSHPULL_ELEMENT: 14,
        ACTION_AREA_CHANGE_ALIGNMENT: 15,
        ACTION_AREA_GIVE_KAMAS: 16,
        ACTION_SCRIPT_START: 17,
        ACTION_AREA_DUNGEON_ATTACKED: 20,
        ACTION_GAIN_AREA_KAMAS: 21,
        ACTION_AREA_DUNGEON_CITY_OPENED: 23,
        ACTION_AREA_DUNGEON_HEART_OPENED: 24,
        ACTION_AREA_DUNGEON_HEART_CLOSED: 25,
        ACTION_AREA_CHANGE_ALIGNMENT_SUB: 26,
        ACTION_QUEST_OBJECTIVE_VALIDATE: 30,
        ACTION_QUEST_STEP_VALIDATE: 31,
        ACTION_QUEST_QUEST_VALIDATE: 32,
        ACTION_QUEST_STEP_START: 33,
        ACTION_QUEST_START: 34,
        ACTION_QUEST_CHECK_STARTED_OBJECTIVES: 35,
        ACTION_QUEST_RESET: 36,
        ACTION_START_DIALOG_WITH_NPC: 40,
        ACTION_CARRY_CHARACTER: 50,
        ACTION_THROW_CARRIED_CHARACTER: 51,
        ACTION_NO_MORE_CARRIED: 52,
        ACTION_CHARACTER_MOVEMENT_POINTS_STEAL: 77,
        ACTION_CHARACTER_MOVEMENT_POINTS_WIN: 78,
        ACTION_CHARACTER_MULTIPLY_RECEIVED_DAMAGE_OR_GIVE_LIFE_WITH_RATIO: 79,
        ACTION_CHARACTER_LIFE_POINTS_LOST_FROM_PUSH: 80,
        ACTION_CHARACTER_LIFE_POINTS_WIN_WITHOUT_ELEMENT: 81,
        ACTION_CHARACTER_LIFE_POINTS_STEAL_WITHOUT_BOOST: 82,
        ACTION_CHARACTER_ACTION_POINTS_STEAL: 84,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_FROM_WATER: 85,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_FROM_EARTH: 86,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_FROM_AIR: 87,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_FROM_FIRE: 88,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE: 89,
        ACTION_CHARACTER_DISPATCH_LIFE_POINTS_PERCENT: 90,
        ACTION_CHARACTER_LIFE_POINTS_STEAL_FROM_WATER: 91,
        ACTION_CHARACTER_LIFE_POINTS_STEAL_FROM_EARTH: 92,
        ACTION_CHARACTER_LIFE_POINTS_STEAL_FROM_AIR: 93,
        ACTION_CHARACTER_LIFE_POINTS_STEAL_FROM_FIRE: 94,
        ACTION_CHARACTER_LIFE_POINTS_STEAL: 95,
        ACTION_CHARACTER_LIFE_POINTS_LOST_FROM_WATER: 96,
        ACTION_CHARACTER_LIFE_POINTS_LOST_FROM_EARTH: 97,
        ACTION_CHARACTER_LIFE_POINTS_LOST_FROM_AIR: 98,
        ACTION_CHARACTER_LIFE_POINTS_LOST_FROM_FIRE: 99,
        ACTION_CHARACTER_LIFE_POINTS_MALUS: 1047,
        ACTION_CHARACTER_LIFE_POINTS_MALUS_PERCENT: 1048,
        ACTION_CHARACTER_LIFE_POINTS_LOST: 100,
        ACTION_CHARACTER_ACTION_POINTS_LOST: 101,
        ACTION_CHARACTER_ACTION_POINTS_USE: 102,
        ACTION_CHARACTER_DEATH: 103,
        ACTION_CHARACTER_ACTION_TACKLED: 104,
        ACTION_CHARACTER_LIFE_LOST_MODERATOR: 105,
        ACTION_CHARACTER_LIFE_LOST_CASTER_MODERATOR: 265,
        ACTION_CHARACTER_SPELL_REFLECTOR: 106,
        ACTION_CHARACTER_LIFE_LOST_REFLECTOR: 107,
        ACTION_CHARACTER_LIFE_POINTS_WIN: 108,
        ACTION_CHARACTER_LIFE_POINTS_LOST_CASTER: 109,
        ACTION_CHARACTER_BOOST_LIFE_POINTS: 110,
        ACTION_CHARACTER_BOOST_ACTION_POINTS: 111,
        ACTION_CHARACTER_BOOST_DAMAGES: 112,
        ACTION_CHARACTER_MULTIPLY_DAMAGES: 114,
        ACTION_CHARACTER_BOOST_CRITICAL_HIT: 115,
        ACTION_CHARACTER_DEBOOST_RANGE: 116,
        ACTION_CHARACTER_BOOST_RANGE: 117,
        ACTION_CHARACTER_BOOST_STRENGTH: 118,
        ACTION_CHARACTER_BOOST_AGILITY: 119,
        ACTION_CHARACTER_ACTION_POINTS_WIN: 120,
        ACTION_CHARACTER_BOOST_DAMAGES_FOR_ALL_GAME: 121,
        ACTION_CHARACTER_BOOST_CRITICAL_MISS: 122,
        ACTION_CHARACTER_BOOST_CHANCE: 123,
        ACTION_CHARACTER_BOOST_WISDOM: 124,
        ACTION_CHARACTER_BOOST_VITALITY: 125,
        ACTION_CHARACTER_BOOST_INTELLIGENCE: 126,
        ACTION_CHARACTER_MOVEMENT_POINTS_LOST: 127,
        ACTION_CHARACTER_BOOST_MOVEMENT_POINTS: 128,
        ACTION_CHARACTER_MOVEMENT_POINTS_USE: 129,
        ACTION_CHARACTER_STEAL_GOLD: 130,
        ACTION_CHARACTER_MANA_USE_KILL_LIFE: 131,
        ACTION_CHARACTER_REMOVE_ALL_EFFECTS: 132,
        ACTION_CHARACTER_ACTION_POINTS_LOST_CASTER: 133,
        ACTION_CHARACTER_MOVEMEMT_POINTS_LOST_CASTER: 134,
        ACTION_CHARACTER_DEBOOST_RANGE_CASTER: 135,
        ACTION_CHARACTER_BOOST_RANGE_CASTER: 136,
        ACTION_CHARACTER_BOOST_DAMAGES_CASTER: 137,
        ACTION_CHARACTER_BOOST_DAMAGES_PERCENT: 138,
        ACTION_CHARACTER_DEBOOST_DAMAGES_PERCENT: 186,
        ACTION_CHARACTER_ENERGY_POINTS_WIN: 139,
        ACTION_CHARACTER_PASS_NEXT_TURN: 140,
        ACTION_CHARACTER_KILL: 141,
        ACTION_CHARACTER_BOOST_PHYSICAL_DAMAGES: 142,
        ACTION_CHARACTER_LIFE_POINTS_WIN_WITHOUT_BOOST: 143,
        ACTION_CHARACTER_LIFE_POINTS_LOST_WITHOUT_BOOST: 144,
        ACTION_CHARACTER_DEBOOST_DAMAGES: 145,
        ACTION_CHARACTER_CURSE: 146,
        ACTION_CHARACTER_RESURECT_ALLY_IN_FIGHT: 147,
        ACTION_CHARACTER_ADD_FOLLOWING_CHARACTER: 148,
        ACTION_CHARACTER_MAKE_INVISIBLE: 150,
        ACTION_SPELL_INVISIBLE_OBSTACLE: 151,
        ACTION_CHARACTER_CHANGE_COLOR: 333,
        ACTION_CHARACTER_CHANGE_LOOK: 149,
        ACTION_CHARACTER_ADD_APPEARANCE: 335,
        ACTION_CHARACTER_DEBOOST_CHANCE: 152,
        ACTION_CHARACTER_DEBOOST_VITALITY: 153,
        ACTION_CHARACTER_DEBOOST_AGILITY: 154,
        ACTION_CHARACTER_DEBOOST_INTELLIGENCE: 155,
        ACTION_CHARACTER_DEBOOST_WISDOM: 156,
        ACTION_CHARACTER_DEBOOST_STRENGTH: 157,
        ACTION_CHARACTER_BOOST_MAXIMUM_WEIGHT: 158,
        ACTION_CHARACTER_DEBOOST_MAXIMUM_WEIGHT: 159,
        ACTION_CHARACTER_BOOST_ACTION_POINTS_LOST_DODGE: 160,
        ACTION_CHARACTER_BOOST_MOVEMENT_POINTS_LOST_DODGE: 161,
        ACTION_CHARACTER_DEBOOST_ACTION_POINTS_LOST_DODGE: 162,
        ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS_LOST_DODGE: 163,
        ACTION_CHARACTER_BOOST_DODGE: 752,
        ACTION_CHARACTER_BOOST_TACKLE: 753,
        ACTION_CHARACTER_DEBOOST_DODGE: 754,
        ACTION_CHARACTER_DEBOOST_TACKLE: 755,
        ACTION_CHARACTER_BOOST_WEAPON_DAMAGE_PERCENT: 165,
        ACTION_CHARACTER_DEBOOST_ACTION_POINTS: 168,
        ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS: 169,
        ACTION_CHARACTER_LIFE_POINTS_WIN_IN_RP: 170,
        ACTION_CHARACTER_DEBOOST_CRITICAL_HIT: 171,
        ACTION_CHARACTER_DEBOOST_MAGICAL_REDUCTION: 172,
        ACTION_CHARACTER_DEBOOST_PHYSICAL_REDUCTION: 173,
        ACTION_CHARACTER_BOOST_INITIATIVE: 174,
        ACTION_CHARACTER_DEBOOST_INITIATIVE: 175,
        ACTION_CHARACTER_BOOST_MAGIC_FIND: 176,
        ACTION_CHARACTER_DEBOOST_MAGIC_FIND: 177,
        ACTION_CHARACTER_BOOST_HEAL_BONUS: 178,
        ACTION_CHARACTER_DEBOOST_HEAL_BONUS: 179,
        ACTION_CHARACTER_ADD_DOUBLE: 180,
        ACTION_SUMMON_CREATURE: 181,
        ACTION_CHARACTER_BOOST_MAXIMUM_SUMMONED_CREATURES: 182,
        ACTION_CHARACTER_BOOST_MAGICAL_REDUCTION: 183,
        ACTION_CHARACTER_BOOST_PHYSICAL_REDUCTION: 184,
        ACTION_SUMMON_STATIC_CREATURE: 185,
        ACTION_CHARACTER_ALIGNMENT_RANK_SET: 187,
        ACTION_CHARACTER_ALIGNMENT_SIDE_SET: 188,
        ACTION_CHARACTER_ALIGNMENT_VALUE_SET: 189,
        ACTION_CHARACTER_ALIGNMENT_VALUE_MODIFICATION: 190,
        ACTION_CHARACTER_INVENTORY_CLEAR: 191,
        ACTION_CHARACTER_INVENTORY_REMOVE_ITEM: 192,
        ACTION_CHARACTER_INVENTORY_ADD_ITEM: 193,
        ACTION_CHARACTER_INVENTORY_ADD_ITEM_NOCHECK: 209,
        ACTION_CHARACTER_INVENTORY_ADD_ITEM_RANDOM_NOCHECK: 221,
        ACTION_CHARACTER_INVENTORY_ADD_ITEM_FROM_RANDOM_DROP: 222,
        ACTION_CHARACTER_INVENTORY_GAIN_KAMAS: 194,
        ACTION_CHARACTER_INVENTORY_LOSE_KAMAS: 195,
        ACTION_CHARACTER_OPEN_MY_STORAGE: 196,
        ACTION_CHARACTER_TRANSFORM: 197,
        ACTION_CHARACTER_CLEAR_ALL_JOB: 198,
        ACTION_CHARACTER_REPAIR_OBJECT: 199,
        ACTION_CHARACTER_INVENTORY_ADD_ITEM_ON_RP_MAP: 232,
        ACTION_CHARACTER_INVENTORY_REMOVE_ITEM_ON_RP_MAP: 233,
        ACTION_DECORS_PLAY_OBJECT_ANIMATION: 200,
        ACTION_DECORS_ADD_OBJECT: 201,
        ACTION_DECORS_REVEAL_UNVISIBLE: 202,
        ACTION_DECORS_OBSTACLE_CLOSE: 203,
        ACTION_DECORS_OBSTACLE_OPEN: 204,
        ACTION_CHARACTER_CHANGE_RESTRICTION: 205,
        ACTION_CHARACTER_RESURRECTION: 206,
        ACTION_COLLECT_RESOURCE: 207,
        ACTION_DECORS_PLAY_ANIMATION: 208,
        ACTION_DECORS_PLAY_ANIMATION_UNLIGHTED: 228,
        ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PERCENT: 210,
        ACTION_CHARACTER_BOOST_WATER_ELEMENT_PERCENT: 211,
        ACTION_CHARACTER_BOOST_AIR_ELEMENT_PERCENT: 212,
        ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PERCENT: 213,
        ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PERCENT: 214,
        ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_PERCENT: 215,
        ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_PERCENT: 216,
        ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_PERCENT: 217,
        ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_PERCENT: 218,
        ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_PERCENT: 219,
        ACTION_CHARACTER_REFLECTOR_UNBOOSTED: 220,
        ACTION_DECORS_OBSTACLE_CLOSE_RANDOM: 223,
        ACTION_DECORS_OBSTACLE_OPEN_RANDOM: 224,
        ACTION_CHARACTER_BOOST_TRAP: 225,
        ACTION_CHARACTER_BOOST_TRAP_PERCENT: 226,
        ACTION_CHARACTER_GAIN_RIDE: 229,
        ACTION_CHARACTER_ENERGY_LOSS_BOOST: 230,
        ACTION_CHARACTER_ENERGY_POINTS_LOOSE: 231,
        ACTION_CHARACTER_BOOST_EARTH_ELEMENT_RESIST: 240,
        ACTION_CHARACTER_BOOST_WATER_ELEMENT_RESIST: 241,
        ACTION_CHARACTER_BOOST_AIR_ELEMENT_RESIST: 242,
        ACTION_CHARACTER_BOOST_FIRE_ELEMENT_RESIST: 243,
        ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_RESIST: 244,
        ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_RESIST: 245,
        ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_RESIST: 246,
        ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_RESIST: 247,
        ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_RESIST: 248,
        ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_RESIST: 249,
        ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PVP_PERCENT: 250,
        ACTION_CHARACTER_BOOST_WATER_ELEMENT_PVP_PERCENT: 251,
        ACTION_CHARACTER_BOOST_AIR_ELEMENT_PVP_PERCENT: 252,
        ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PVP_PERCENT: 253,
        ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PVP_PERCENT: 254,
        ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_PVP_PERCENT: 255,
        ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_PVP_PERCENT: 256,
        ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_PVP_PERCENT: 257,
        ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_PVP_PERCENT: 258,
        ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_PVP_PERCENT: 259,
        ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PVP_RESIST: 260,
        ACTION_CHARACTER_BOOST_WATER_ELEMENT_PVP_RESIST: 261,
        ACTION_CHARACTER_BOOST_AIR_ELEMENT_PVP_RESIST: 262,
        ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PVP_RESIST: 263,
        ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PVP_RESIST: 264,
        ACTION_CHARACTER_STEAL_CHANCE: 266,
        ACTION_CHARACTER_STEAL_VITALITY: 267,
        ACTION_CHARACTER_STEAL_AGILITY: 268,
        ACTION_CHARACTER_STEAL_INTELLIGENCE: 269,
        ACTION_CHARACTER_STEAL_WISDOM: 270,
        ACTION_CHARACTER_STEAL_STRENGTH: 271,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_MISSING_FROM_WATER: 275,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_MISSING_FROM_EARTH: 276,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_MISSING_FROM_AIR: 277,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_MISSING_FROM_FIRE: 278,
        ACTION_CHARACTER_LIFE_POINTS_LOST_BASED_ON_CASTER_LIFE_MISSING: 279,
        ACTION_CHARACTER_BOOST_SHIELD_BASED_ON_CASTER_LIFE: 1039,
        ACTION_CHARACTER_BOOST_SHIELD: 1040,
        ACTION_CHARACTER_ADD_SPELL_COOLDOWN: 1035,
        ACTION_CHARACTER_REMOVE_SPELL_COOLDOWN: 1036,
        ACTION_CHARACTER_UPDATE_BOOST: 515,
        ACTION_CHARACTER_BOOST_DISPELLED: 514,
        ACTION_BOOST_SPELL_RANGE: 281,
        ACTION_BOOST_SPELL_RANGEABLE: 282,
        ACTION_BOOST_SPELL_DMG: 283,
        ACTION_BOOST_SPELL_HEAL: 284,
        ACTION_BOOST_SPELL_AP_COST: 285,
        ACTION_BOOST_SPELL_CAST_INTVL: 286,
        ACTION_BOOST_SPELL_CC: 287,
        ACTION_BOOST_SPELL_CASTOUTLINE: 288,
        ACTION_BOOST_SPELL_NOLINEOFSIGHT: 289,
        ACTION_BOOST_SPELL_MAXPERTURN: 290,
        ACTION_BOOST_SPELL_MAXPERTARGET: 291,
        ACTION_BOOST_SPELL_CAST_INTVL_SET: 292,
        ACTION_BOOST_SPELL_BASE_DMG: 293,
        ACTION_DEBOOST_SPELL_RANGE: 294,
        ACTION_FIGHT_CAST_SPELL: 300,
        ACTION_FIGHT_CAST_SPELL_CRITICAL_HIT: 301,
        ACTION_FIGHT_CAST_SPELL_CRITICAL_MISS: 302,
        ACTION_FIGHT_CLOSE_COMBAT: 303,
        ACTION_FIGHT_CLOSE_COMBAT_CRITICAL_HIT: 304,
        ACTION_FIGHT_CLOSE_COMBAT_CRITICAL_MISS: 305,
        ACTION_FIGHT_TRIGGER_TRAP: 306,
        ACTION_FIGHT_TRIGGER_GLYPH: 307,
        ACTION_FIGHT_SPELL_DODGED_PA: 308,
        ACTION_FIGHT_SPELL_DODGED_PM: 309,
        ACTION_CHARACTER_STEAL_RANGE: 320,
        ACTION_FIGHT_ADD_TRAP_CASTING_SPELL: 400,
        ACTION_FIGHT_ADD_GLYPH_CASTING_SPELL: 401,
        ACTION_FIGHT_ADD_GLYPH_CASTING_SPELL_ENDTURN: 402,
        ACTION_FIGHT_KILL_AND_SUMMON: 405,
        ACTION_INTERACTIVE_ELEMENT: 500,
        ACTION_SKILL_ANIMATION: 501,
        ACTION_EXCHANGE_CRAFT_OPEN: 502,
        ACTION_USE_WAYPOINT: 503,
        ACTION_DO_ELEMENT_PARAMETERIZED_OPERATION: 505,
        ACTION_INTERACTIVE_ELEMENT_AT_HOME_INNER_DOOR: 507,
        ACTION_SAVE_WAYPOINT: 508,
        ACTION_CHANGE_COMPASS: 509,
        ACTION_USE_SUBWAY: 510,
        ACTION_EXCHANGE_JOBINDEX_OPEN: 511,
        ACTION_USE_PRISM: 512,
        ACTION_ADD_PRISM: 513,
        ACTION_GOTO_WAYPOINT: 600,
        ACTION_GOTO_MAP: 601,
        ACTION_CHARACTER_LEARN_JOB: 603,
        ACTION_CHARACTER_LEARN_SPELL: 604,
        ACTION_CHARACTER_GAIN_XP: 605,
        ACTION_CHARACTER_GAIN_WISDOM: 606,
        ACTION_CHARACTER_GAIN_STRENGTH: 607,
        ACTION_CHARACTER_GAIN_CHANCE: 608,
        ACTION_CHARACTER_GAIN_AGILITY: 609,
        ACTION_CHARACTER_GAIN_VITALITY: 610,
        ACTION_CHARACTER_GAIN_INTELLIGENCE: 611,
        ACTION_CHARACTER_GAIN_STATS_POINTS: 612,
        ACTION_CHARACTER_GAIN_SPELL_POINTS: 613,
        ACTION_CHARACTER_GAIN_JOB_XP: 614,
        ACTION_CHARACTER_UNLEARN_JOB: 615,
        ACTION_CHARACTER_UNBOOST_SPELL: 616,
        ACTION_CHARACTER_GET_MARRIED: 617,
        ACTION_CHARACTER_GET_MARRIED_ACCEPT: 618,
        ACTION_CHARACTER_GET_MARRIED_DECLINE: 619,
        ACTION_CHARACTER_READ_BOOK: 620,
        ACTION_CHARACTER_SUMMON_MONSTER: 621,
        ACTION_GOTO_HOUSE: 622,
        ACTION_CHARACTER_SUMMON_MONSTER_GROUP: 623,
        ACTION_CHARACTER_SUMMON_MONSTER_GROUP_SET_MAP: 627,
        ACTION_CHARACTER_SUMMON_MONSTER_GROUP_DYNAMIC: 628,
        ACTION_CHARACTER_UNLEARN_GUILDSPELL: 624,
        ACTION_CHARACTER_UNBOOST_CARACS: 625,
        ACTION_CHARACTER_UNBOOST_CARACS_TO_101: 626,
        ACTION_CHARACTER_SEND_INFORMATION_TEXT: 630,
        ACTION_CHARACTER_SEND_DIALOG_ACTION: 631,
        ACTION_CHARACTER_GAIN_HONOUR: 640,
        ACTION_CHARACTER_GAIN_DISHONOUR: 641,
        ACTION_CHARACTER_LOOSE_HONOUR: 642,
        ACTION_CHARACTER_LOOSE_DISHONOUR: 643,
        ACTION_MAP_RESURECTION_ALLIES: 645,
        ACTION_MAP_HEAL_ALLIES: 646,
        ACTION_MAP_FORCE_ENNEMIES_GHOST: 647,
        ACTION_FORCE_ENNEMY_GHOST: 648,
        ACTION_FAKE_ALIGNMENT: 649,
        ACTION_TELEPORT_NOOBY_MAP: 650,
        ACTION_USE_ELEMENT_ACTIONS: 651,
        ACTION_SET_STATED_ELEMENT_STATE: 652,
        ACTION_RESET_STATED_ELEMENT: 653,
        ACTION_HOUSE_LEAVE: 654,
        ACTION_NOOP: 666,
        ACTION_INCARNATION: 669,
        ACTION_CHARACTER_REFERENCEMENT: 699,
        ACTION_ITEM_CHANGE_EFFECT: 700,
        ACTION_ITEM_ADD_EFFECT: 701,
        ACTION_ITEM_ADD_DURABILITY: 702,
        ACTION_CAPTURE_SOUL: 705,
        ACTION_CAPTURE_RIDE: 706,
        ACTION_CHARACTER_ADD_COST_TO_ACTION: 710,
        ACTION_LADDER_SUPERRACE: 715,
        ACTION_LADDER_RACE: 716,
        ACTION_LADDER_ID: 717,
        ACTION_PVP_LADDER: 720,
        ACTION_VICTIM_OF: 721,
        ACTION_GAIN_TEMP_SPELL: 722,
        ACTION_GAIN_AURA: 723,
        ACTION_GAIN_TITLE: 724,
        ACTION_CHARACTER_RENAME_GUILD: 725,
        ACTION_TELEPORT_NEAREST_PRISM: 730,
        ACTION_AUTO_AGGRESS_ENEMY_PLAYER: 731,
        ACTION_SHUSHU_STACK_RUNE: 742,
        ACTION_BOOST_SOUL_CAPTURE_BONUS: 750,
        ACTION_BOOST_RIDE_XP_BONUS: 751,
        ACTION_REMOVE_ON_MOVE: 760,
        ACTION_CHARACTER_SACRIFY: 765,
        ACTION_HOURLY_CONFUSION_DEGREE: 770,
        ACTION_HOURLY_CONFUSION_PI_2: 771,
        ACTION_HOURLY_CONFUSION_PI_4: 772,
        ACTION_UNHOURLY_CONFUSION_DEGREE: 773,
        ACTION_UNHOURLY_CONFUSION_PI_2: 774,
        ACTION_UNHOURLY_CONFUSION_PI_4: 775,
        ACTION_CHARACTER_BOOST_PERMANENT_DAMAGE_PERCENT: 776,
        ACTION_CHARACTER_SUMMON_DEAD_ALLY_IN_FIGHT: 780,
        ACTION_CHARACTER_UNLUCKY: 781,
        ACTION_CHARACTER_MAXIMIZE_ROLL: 782,
        ACTION_CHARACTER_WALK_FOUR_DIR: 785,
        ACTION_FIND_BOUNTY_TARGET: 790,
        ACTION_MARK_TARGET_MERCENARY: 791,
        ACTION_ITEM_CHANGE_PETS_LIFE: 800,
        ACTION_ITEM_CHANGE_DURATION: 805,
        ACTION_ITEM_PETS_SHAPE: 806,
        ACTION_ITEM_PETS_EAT: 807,
        ACTION_PETS_LAST_MEAL: 808,
        ACTION_ITEM_CHANGE_DURABILITY: 812,
        ACTION_ITEM_UPDATE_DATE: 813,
        ACTION_ITEM_CHOOSE_IN_ITEM_LIST: 820,
        ACTION_CLIENT_OPEN_UI: 830,
        PARAM_CLIENT_OPEN_UI_GUILD_TELEPORT_HOUSE: 1,
        PARAM_CLIENT_OPEN_UI_GUILD_TELEPORT_FARM: 2,
        ACTION_CLIENT_OPEN_UI_SPELL_FORGET: 831,
        ACTION_FIGHT_TURN_FINISHED: 899,
        ACTION_FIGHT_CHALLENGE: 900,
        ACTION_FIGHT_CHALLENGE_ACCEPT: 901,
        ACTION_FIGHT_CHALLENGE_DECLINE: 902,
        ACTION_FIGHT_CHALLENGE_JOIN: 903,
        ACTION_FIGHT_CHALLENGE_AGAINST_MONSTER: 905,
        ACTION_FIGHT_AGGRESSION: 906,
        ACTION_FIGHT_AGAINST_TAXCOLLECTOR: 909,
        ACTION_FIGHT_CHALLENGE_AGAINST_MUTANT: 910,
        ACTION_FIGHT_CHALLENGE_MIXED_VERSUS_MONSTER: 911,
        ACTION_FIGHT_AGAINST_PRISM: 912,
        ACTION_TOOLTIP_ACTIVATE_TIP: 915,
        ACTION_PNJ_REMOVE_RIDE: 938,
        ACTION_PET_SET_POWER_BOOST: 939,
        ACTION_FARM_WITHDRAW_ITEM: 947,
        ACTION_FARM_PLACE_ITEM: 948,
        ACTION_MOUNT_RIDE: 949,
        ACTION_FIGHT_SET_STATE: 950,
        ACTION_FIGHT_UNSET_STATE: 951,
        ACTION_CREATED_SINCE: 963,
        ACTION_SHOW_PLAYERNAME: 964,
        ACTION_ID_LIVING_OBJECT_MOOD: 971,
        ACTION_ID_LIVING_OBJECT_SKIN: 972,
        ACTION_ID_LIVING_OBJECT_CATEGORY: 973,
        ACTION_ID_LIVING_OBJECT_LEVEL: 974,
        ACTION_BOOST_GLOBAL_RESISTS_BONUS: 1076,
        ACTION_BOOST_GLOBAL_RESISTS_MALUS: 1077
    }
      , s = {};
    s[o.ACTION_CHARACTER_BOOST_LIFE_POINTS] = ["lifePoints", !0],
    s[o.ACTION_CHARACTER_MOVEMENT_POINTS_LOST] = ["movementPoints", !1],
    s[o.ACTION_CHARACTER_BOOST_MOVEMENT_POINTS] = ["movementPoints", !0],
    s[o.ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS] = ["movementPoints", !1],
    s[o.ACTION_CHARACTER_ACTION_POINTS_LOST] = ["actionPoints", !1],
    s[o.ACTION_CHARACTER_BOOST_ACTION_POINTS] = ["actionPoints", !0],
    s[o.ACTION_CHARACTER_DEBOOST_ACTION_POINTS] = ["actionPoints", !1],
    s[o.ACTION_CHARACTER_DEBOOST_DAMAGES] = ["allDamagesBonus", !1],
    s[o.ACTION_CHARACTER_BOOST_DAMAGES] = ["allDamagesBonus", !0],
    s[o.ACTION_CHARACTER_BOOST_PHYSICAL_DAMAGES] = ["physicalDamagesBonus", !0],
    s[o.ACTION_CHARACTER_DEBOOST_DAMAGES_PERCENT] = ["damagesBonusPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_DAMAGES_PERCENT] = ["damagesBonusPercent", !0],
    s[o.ACTION_CHARACTER_BOOST_MAXIMUM_SUMMONED_CREATURES] = ["summonableCreaturesBoost", !0],
    s[o.ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_PERCENT] = ["earthElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PERCENT] = ["earthElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_PERCENT] = ["waterElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_WATER_ELEMENT_PERCENT] = ["waterElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_PERCENT] = ["airElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_AIR_ELEMENT_PERCENT] = ["airElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_PERCENT] = ["fireElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PERCENT] = ["fireElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_PERCENT] = ["neutralElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PERCENT] = ["neutralElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_PVP_PERCENT] = ["pvpEarthElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PVP_PERCENT] = ["pvpEarthElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_PVP_PERCENT] = ["pvpWaterElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_WATER_ELEMENT_PVP_PERCENT] = ["pvpWaterElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_PVP_PERCENT] = ["pvpAirElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_AIR_ELEMENT_PVP_PERCENT] = ["pvpAirElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_PVP_PERCENT] = ["pvpFireElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PVP_PERCENT] = ["pvpFireElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_PVP_PERCENT] = ["pvpNeutralElementResistPercent", !1],
    s[o.ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PVP_PERCENT] = ["pvpNeutralElementResistPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_RANGE] = ["range", !1],
    s[o.ACTION_CHARACTER_BOOST_RANGE] = ["range", !0],
    s[o.ACTION_CHARACTER_DEBOOST_STRENGTH] = ["strength", !1],
    s[o.ACTION_CHARACTER_BOOST_STRENGTH] = ["strength", !0],
    s[o.ACTION_CHARACTER_DEBOOST_AGILITY] = ["agility", !1],
    s[o.ACTION_CHARACTER_BOOST_AGILITY] = ["agility", !0],
    s[o.ACTION_CHARACTER_DEBOOST_CHANCE] = ["chance", !1],
    s[o.ACTION_CHARACTER_BOOST_CHANCE] = ["chance", !0],
    s[o.ACTION_CHARACTER_DEBOOST_WISDOM] = ["wisdom", !1],
    s[o.ACTION_CHARACTER_BOOST_WISDOM] = ["wisdom", !0],
    s[o.ACTION_CHARACTER_DEBOOST_VITALITY] = ["vitality", !1],
    s[o.ACTION_CHARACTER_BOOST_VITALITY] = ["vitality", !0],
    s[o.ACTION_CHARACTER_DEBOOST_INTELLIGENCE] = ["intelligence", !1],
    s[o.ACTION_CHARACTER_BOOST_INTELLIGENCE] = ["intelligence", !0],
    s[o.ACTION_CHARACTER_BOOST_TRAP] = ["trapBonus", !0],
    s[o.ACTION_CHARACTER_BOOST_TRAP_PERCENT] = ["trapBonusPercent", !0],
    s[o.ACTION_CHARACTER_DEBOOST_EARTH_ELEMENT_RESIST] = ["earthElementReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_EARTH_ELEMENT_RESIST] = ["earthElementReduction", !0],
    s[o.ACTION_CHARACTER_DEBOOST_WATER_ELEMENT_RESIST] = ["waterElementReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_WATER_ELEMENT_RESIST] = ["waterElementReduction", !0],
    s[o.ACTION_CHARACTER_DEBOOST_AIR_ELEMENT_RESIST] = ["airElementReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_AIR_ELEMENT_RESIST] = ["airElementReduction", !0],
    s[o.ACTION_CHARACTER_DEBOOST_FIRE_ELEMENT_RESIST] = ["fireElementReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_FIRE_ELEMENT_RESIST] = ["fireElementReduction", !0],
    s[o.ACTION_CHARACTER_DEBOOST_NEUTRAL_ELEMENT_RESIST] = ["neutralElementReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_RESIST] = ["neutralElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_EARTH_ELEMENT_PVP_RESIST] = ["pvpEarthElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_WATER_ELEMENT_PVP_RESIST] = ["pvpWaterElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_AIR_ELEMENT_PVP_RESIST] = ["pvpAirElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_FIRE_ELEMENT_PVP_RESIST] = ["pvpFireElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_NEUTRAL_ELEMENT_PVP_RESIST] = ["pvpNeutralElementReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_CRITICAL_MISS] = ["criticalMiss", !0],
    s[o.ACTION_CHARACTER_BOOST_CRITICAL_HIT] = ["criticalHit", !0],
    s[o.ACTION_CHARACTER_DEBOOST_CRITICAL_HIT] = ["criticalHit", !1],
    s[o.ACTION_CHARACTER_BOOST_INITIATIVE] = ["initiative", !0],
    s[o.ACTION_CHARACTER_DEBOOST_INITIATIVE] = ["initiative", !1],
    s[o.ACTION_CHARACTER_BOOST_MAGIC_FIND] = ["prospecting", !0],
    s[o.ACTION_CHARACTER_DEBOOST_MAGIC_FIND] = ["prospecting", !1],
    s[o.ACTION_CHARACTER_BOOST_HEAL_BONUS] = ["healBonus", !0],
    s[o.ACTION_CHARACTER_BOOST_SHIELD_BASED_ON_CASTER_LIFE] = ["shieldPoints", !0],
    s[o.ACTION_CHARACTER_BOOST_SHIELD] = ["shieldPoints", !0],
    s[o.ACTION_CHARACTER_LIFE_POINTS_MALUS] = ["lifePointsMalus", !1],
    s[o.ACTION_CHARACTER_LIFE_POINTS_MALUS_PERCENT] = ["lifePointsMalus", !1],
    s[o.ACTION_CHARACTER_REFLECTOR_UNBOOSTED] = ["reflectorUnboosted", !0],
    s[o.ACTION_CHARACTER_DEBOOST_ACTION_POINTS_LOST_DODGE] = ["dodgePALostProbability", !1],
    s[o.ACTION_CHARACTER_BOOST_ACTION_POINTS_LOST_DODGE] = ["dodgePALostProbability", !0],
    s[o.ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS_LOST_DODGE] = ["dodgePMLostProbability", !1],
    s[o.ACTION_CHARACTER_BOOST_MOVEMENT_POINTS_LOST_DODGE] = ["dodgePMLostProbability", !0],
    s[o.ACTION_CHARACTER_BOOST_DAMAGES_FOR_ALL_GAME] = ["allDamagesBonus", !0],
    s[o.ACTION_CHARACTER_DEBOOST_MAXIMUM_WEIGHT] = ["maximumWeight", !1],
    s[o.ACTION_CHARACTER_BOOST_MAXIMUM_WEIGHT] = ["maximumWeight", !0],
    s[o.ACTION_CHARACTER_DEBOOST_PHYSICAL_REDUCTION] = ["physicalReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_PHYSICAL_REDUCTION] = ["physicalReduction", !0],
    s[o.ACTION_CHARACTER_DEBOOST_MAGICAL_REDUCTION] = ["magicalReduction", !1],
    s[o.ACTION_CHARACTER_BOOST_MAGICAL_REDUCTION] = ["magicalReduction", !0],
    s[o.ACTION_CHARACTER_BOOST_DODGE] = ["tackleEvade", !0],
    s[o.ACTION_CHARACTER_BOOST_TACKLE] = ["tackleBlock", !0],
    s[o.ACTION_CHARACTER_DEBOOST_DODGE] = ["tackleEvade", !1],
    s[o.ACTION_CHARACTER_DEBOOST_TACKLE] = ["tackleBlock", !1],
    s[o.ACTION_CHARACTER_BOOST_PERMANENT_DAMAGE_PERCENT] = ["permanentDamagePercent", !0],
    s[o.ACTION_BOOST_GLOBAL_RESISTS_BONUS] = ["globalResistPercentBonus", !0],
    s[o.ACTION_BOOST_GLOBAL_RESISTS_MALUS] = ["globalResistPercentMalus", !0],
    o.getActionStatName = i,
    o.getIsABoost = n,
    e.exports = o
}
, function(e, t) {
    e.exports = {
        DISPELLABLE: 1,
        DISPELLABLE_BY_DEATH: 2,
        DISPELLABLE_BY_STRONG_DISPEL: 3,
        REALLY_NOT_DISPELLABLE: 4
    }
}
, function(e, t, i) {
    function n(e) {
        var t = e.substr(0, 1)
          , i = e.length > 1 ? e.substr(1).split(",") : []
          , n = 0
          , o = 0
          , s = 0
          , a = 0;
        switch (i.length) {
        case 1:
            n = parseInt(i[0], 10);
            break;
        case 2:
            n = parseInt(i[0], 10),
            w[t].hasMinSize ? o = parseInt(i[1], 10) : s = parseInt(i[1], 10);
            break;
        case 3:
            n = parseInt(i[0], 10),
            w[t].hasMinSize ? (o = parseInt(i[1], 10),
            s = parseInt(i[2], 10)) : (s = parseInt(i[1], 10),
            a = parseInt(i[2], 10));
            break;
        case 4:
            n = parseInt(i[0], 10),
            o = parseInt(i[1], 10),
            s = parseInt(i[2], 10),
            a = parseInt(i[3], 10)
        }
        return {
            zoneShape: t,
            zoneSize: n,
            zoneMinSize: o,
            zoneEfficiencyPercent: s,
            zoneMaxEfficiency: a
        }
    }
    function o(e) {
        if (!e)
            return "";
        var t = e.zoneShape
          , i = e.zoneSize;
        return "L" === t && (i += 1),
        w[t].desc ? g(w[t].desc, i) : ""
    }
    function s(e) {
        return void 0 === e || null === e
    }
    function a(e) {
        for (var t in e)
            e.hasOwnProperty(t) && (this[t] = e[t]);
        this._init()
    }
    function r(e, t) {
        e instanceof Array || (e = [e]);
        for (var i = [], n = 0; n < e.length; n++)
            i.push(new a(e[n]));
        h(i, t)
    }
    function l(e, t) {
        var i = [];
        for (var n in e)
            e.hasOwnProperty(n) && (i.push(e[n]),
            e[n] = i.length - 1);
        r(i, function(i, n) {
            if (i)
                return t(i);
            for (var o in e)
                e.hasOwnProperty(o) && (e[o] = n[e[o]]);
            return t(null , e)
        })
    }
    function c(e) {
        if (null !== e.effectId && "null" !== e.effectId)
            return !0;
        var t = "effectInstanceFactory: an effectId is null. ";
        return t += "description: " + e.description + " ",
        t += "type: " + e._type + " ",
        t += "keys: " + JSON.stringify(Object.keys(e)),
        console.error(new Error(t)),
        !1
    }
    function u(e, t) {
        for (var i = {}, n = 0; n < e.length; n++) {
            var o = e[n];
            c(o) && (i[o.effectId] = !0)
        }
        return i = Object.keys(i),
        0 === i.length ? t(null , {}) : void y.getData("Effects", i, function(e, n) {
            return e ? t(e) : void t(null , _.extractElementsFrom(i, n, !0))
        })
    }
    var h, d, p, m, f = i(12), g = i(35).getText, _ = i(210), v = i(35).processText, y = i(36), w = {
        X: {
            code: 88,
            desc: "ui.spellarea.cross",
            alt: "",
            hasMinSize: !0
        },
        L: {
            code: 76,
            desc: "ui.spellarea.line",
            alt: "",
            hasMinSize: !1
        },
        T: {
            code: 84,
            desc: "ui.spellarea.tarea",
            alt: "",
            hasMinSize: !1
        },
        P: {
            code: 80,
            desc: "",
            alt: "",
            hasMinSize: !1
        },
        D: {
            code: 68,
            desc: "ui.spellarea.chessboard",
            alt: "",
            hasMinSize: !1
        },
        C: {
            code: 67,
            desc: "ui.spellarea.circle",
            alt: "",
            hasMinSize: !0
        },
        O: {
            code: 79,
            desc: "ui.spellarea.ring",
            alt: "",
            hasMinSize: !1
        },
        Q: {
            code: 81,
            desc: "ui.spellarea.crossVoid",
            alt: "",
            hasMinSize: !0
        },
        V: {
            code: 86,
            desc: "ui.spellarea.cone",
            alt: "",
            hasMinSize: !1
        },
        W: {
            code: 87,
            desc: "",
            alt: "",
            hasMinSize: !1
        },
        "+": {
            code: 43,
            desc: "",
            alt: "plus",
            hasMinSize: !0
        },
        "#": {
            code: 35,
            desc: "",
            alt: "sharp",
            hasMinSize: !0
        },
        "*": {
            code: 42,
            desc: "",
            alt: "star",
            hasMinSize: !1
        },
        "/": {
            code: 47,
            desc: "",
            alt: "slash",
            hasMinSize: !1
        },
        "-": {
            code: 45,
            desc: "ui.spellarea.diagonal",
            alt: "minus",
            hasMinSize: !1
        },
        G: {
            code: 71,
            desc: "ui.spellarea.square",
            alt: "",
            hasMinSize: !1
        },
        I: {
            code: 73,
            desc: "",
            alt: "",
            hasMinSize: !1
        },
        U: {
            code: 85,
            desc: "ui.spellarea.halfcircle",
            alt: "",
            hasMinSize: !1
        },
        A: {
            code: 65,
            desc: "ui.spellarea.everyone",
            alt: "",
            hasMinSize: !1
        }
    }, b = {
        effectId: 0,
        targetId: 0,
        targetMask: null ,
        duration: 0,
        delay: 0,
        random: 0,
        group: 0,
        modificator: 0,
        trigger: !1,
        triggers: null ,
        hidden: !0,
        zoneSize: 0,
        zoneShape: 0,
        zoneMinSize: 0,
        zoneEfficiencyPercent: 0,
        zoneMaxEfficiency: 0
    }, C = {
        ObjectEffectString: "EffectInstanceString",
        ObjectEffectInteger: "EffectInstanceInteger",
        ObjectEffectMinMax: "EffectInstanceMinMax",
        ObjectEffectDice: "EffectInstanceDice",
        ObjectEffectDate: "EffectInstanceDate",
        ObjectEffectDuration: "EffectInstanceDuration",
        ObjectEffectLadder: "EffectInstanceLadder",
        ObjectEffectCreature: "EffectInstanceCreature",
        ObjectEffectMount: "EffectInstanceMount"
    }, I = {
        undefined: -1,
        miscellaneous: 0,
        resistance: 1,
        damage: 2,
        special: 3
    };
    a.prototype._init = function() {
        if (this.description = "",
        this.subEffectDescription = "",
        this.effect = null ,
        this._retrieveInstanceType(),
        this.hasOwnProperty("actionId"))
            if (this.duration = 0,
            this.effectId = this.actionId,
            "EffectInstanceDice" === this._type && 669 === this.effectId) {
                this._type = "EffectInstanceDate",
                this.year = this.diceNum,
                this.month = 32768 * this.diceSide + this.diceConst;
                for (var e = 1, t = 0, i = window.gui.databases.IncarnationLevels; t < this.month && e < 50; ) {
                    var n = i[100 * this.diceNum + e];
                    n && (t = n.requiredXp),
                    e += 1
                }
                this.day = e,
                this.hour = 0,
                this.minute = 0
            } else
                switch (this._type) {
                case "EffectInstanceString":
                    this.text = this.value,
                    delete this.value;
                    break;
                case "EffectInstanceDice":
                    this.value = this.diceConst,
                    delete this.diceConst;
                    break;
                case "EffectInstanceDate":
                    this.month += 1
                }
    }
    ,
    a.prototype._retrieveInstanceType = function() {
        return this._type ? void (C[this._type] && (this._type = C[this._type])) : void (this.hasOwnProperty("diceNum") ? this._type = "EffectInstanceDice" : this.hasOwnProperty("year") ? this._type = "EffectInstanceDate" : this.hasOwnProperty("days") ? this._type = "EffectInstanceDuration" : this.hasOwnProperty("min") ? this._type = "EffectInstanceMinMax" : this.hasOwnProperty("monsterCount") ? this._type = "EffectInstanceLadder" : this.hasOwnProperty("monsterFamilyId") ? this._type = "EffectInstanceCreature" : this.hasOwnProperty("mountId") ? this._type = "EffectInstanceMount" : this.hasOwnProperty("text") ? this._type = "EffectInstanceString" : this._type = "EffectInstanceInteger")
    }
    ,
    a.prototype.getParams = function() {
        switch (this._type) {
        case "EffectInstanceString":
            return [null , null , null , this.text];
        case "EffectInstanceInteger":
            return [this.value];
        case "EffectInstanceMinMax":
            return [this.min, this.min !== this.max ? this.max : null ];
        case "EffectInstanceDice":
            var e = this.value || null
              , t = this.diceSide || null ;
            return [0 !== this.diceNum ? this.diceNum : null , t, e];
        case "EffectInstanceDate":
            var i = this.month > 9 ? this.month : "0" + this.month
              , n = this.day > 9 ? this.day : "0" + this.day
              , o = this.hour > 9 ? this.hour : "0" + this.hour
              , s = this.minute > 9 ? this.minute : "0" + this.minute;
            return [this.year, i + "" + n, o + "" + s, this.month, this.day];
        case "EffectInstanceDuration":
            return [this.days, this.hours, this.minutes];
        case "EffectInstanceLadder":
            return [this.monsterFamilyId, this.monsterCount];
        case "EffectInstanceCreature":
            return [this.monsterFamilyId];
        case "EffectInstanceMount":
            return [this.date, this.modelId, this.mountId];
        default:
            return []
        }
    }
    ,
    a.prototype.setParameter = function(e, t) {
        switch (this._type) {
        case "EffectInstanceString":
            return void (3 === e && (this.text = t.toString()));
        case "EffectInstanceInteger":
            return void (2 === e && (this.value = t));
        case "EffectInstanceMinMax":
            return void (0 === e ? this.min = t : 1 === e && (this.max = t));
        case "EffectInstanceDice":
            return void (0 === e ? this.diceNum = t : 1 === e ? this.diceSide = t : 2 === e && (this.value = t));
        case "EffectInstanceDate":
            return void (0 === e ? this.year = t : 1 === e ? (this.month = t.substr(0, 2),
            this.day = t.substr(2, 2)) : 2 === e ? (this.hour = t.substr(0, 2),
            this.minute = t.substr(2, 2)) : 3 === e ? this.month = t : 4 === e && (this.day = t));
        case "EffectInstanceDuration":
            return void (0 === e ? this.days = t : 1 === e ? this.hours = t : 2 === e && (this.minutes = t));
        case "EffectInstanceLadder":
            return void (0 === e ? this.monsterFamilyId = t : 2 === e && (this.monsterCount = t));
        case "EffectInstanceCreature":
            return void (0 === e && (this.monsterFamilyId = t));
        case "EffectInstanceMount":
            return void (0 === e ? this.date = Number(t) : 1 === e ? this.modelId = Number(t) : 2 === e && (this.mountId = Number(t)));
        default:
            return
        }
    }
    ,
    a.prototype.getValue = function(e) {
        return this.hasOwnProperty(e) ? this[e] : b[e]
    }
    ,
    a.prototype.setDescription = function(e) {
        if (this.effect.hasOwnProperty("descriptionId")) {
            e.unshift(this.effect.descriptionId);
            var t = v.apply(null , e);
            this.description = t || "";
            var i = this.getValue("modificator");
            0 !== i && (this.description += " " + g("ui.effect.boosted.spell.complement", [i], "%"));
            var n = this.getValue("random");
            n > 0 && (this.getValue("group") > 0 ? this.description += " (" + g("ui.common.random") + ")" : this.description += " " + g("ui.effect.randomProbability", [n], "%")),
            this.trigger && (this.description = g("ui.spell.trigger", this.description))
        }
    }
    ,
    a.prototype.getDurationString = function(e) {
        return this.delay ? g("ui.common.delayTurn", this.delay, this.delay <= 1) : !this.duration || isNaN(this.duration) ? "" : this.duration < 0 ? g("ui.common.infinit") : this.duration > 1 ? g("ui.common.turn", this.duration, !0) : e ? g("ui.common.lastTurn") : g("ui.common.turn", this.duration, !1)
    }
    ,
    a.prototype.isDamageEffect = function() {
        return this.effect && this.effect.category === I.damage
    }
    ,
    a.prototype.getZoneEffect = function() {
        return this.rawZone ? n(this.rawZone) : {
            zoneShape: this.getValue("zoneShape"),
            zoneSize: this.getValue("zoneSize"),
            zoneMinSize: this.getValue("zoneMinSize"),
            zoneEfficiencyPercent: this.getValue("zoneEfficiencyPercent"),
            zoneMaxEfficiency: this.getValue("zoneMaxEfficiency")
        }
    }
    ,
    a.prototype.getHumanReadableZoneInfo = function() {
        return o(this.getZoneEffect())
    }
    ,
    a.prototype.requiresInvocationDescription = function() {
        return 181 === this.effectId || 1011 === this.effectId
    }
    ,
    a.prototype.requiresGlyphDescription = function() {
        return 401 === this.effectId || 402 === this.effectId
    }
    ,
    a.prototype.requiresTrapDescription = function() {
        return 400 === this.effectId
    }
    ,
    a.prototype.requiresBombDescription = function() {
        return 1008 === this.effectId
    }
    ,
    a.prototype.forceDescriptionRefresh = function(e) {
        this.description = "",
        this.subEffectDescription = "",
        m([this], null , function(t) {
            return e ? e(t) : void (t && console.error(t))
        })
    }
    ,
    m = function(e, t, i) {
        var n, o = {}, s = function(e, t) {
            o[e] || (o[e] = {}),
            o[e][t] = !0
        };
        f.each(e, function(e, i) {
            return e ? (e.description || (n = e.getParams(),
            d(e, n, t, s)),
            void ("" === e.subEffectDescription ? (n = e.getParams(),
            p(e, n, t, s, i)) : i())) : i()
        }, function(n) {
            if (n)
                return i(n);
            if (0 === Object.keys(o).length)
                return i(null , e);
            for (var s in o)
                o.hasOwnProperty(s) && (o[s] = Object.keys(o[s]));
            f.each(Object.keys(o), function(e, i) {
                y.getData(e, o[e], function(n, s) {
                    if (n)
                        return i(n);
                    for (var a = _.extractElementsFrom(o[e], s, !0), r = 0; r < o[e].length; r++) {
                        var l = o[e][r];
                        if (!a[l])
                            return i(new Error("id " + o[e][l] + " unavailable in table " + e))
                    }
                    o[e] = a,
                    t || (t = {}),
                    t[e] || (t[e] = {});
                    for (var c in o[e])
                        o[e].hasOwnProperty(c) && (t[e][c] = o[e][c]);
                    i()
                })
            }, function(n) {
                return n ? i(n) : void m(e, t, i)
            })
        })
    }
    ,
    d = function(e, t, i, n) {
        switch (e.effectId) {
        case 10:
            null === t[0] && t[2] && (t[0] = t[2]),
            i ? (t[2] = i.Emoticons[t[0]].nameId,
            e.setDescription(t)) : n("Emoticons", t[0]);
            break;
        case 165:
        case 1084:
            i ? (t[0] = i.ItemTypes[t[0]].nameId,
            e.setDescription(t)) : n("ItemTypes", t[0]);
            break;
        case 197:
        case 181:
        case 185:
        case 717:
        case 1008:
        case 1011:
            i ? (t[0] = i.Monsters[t[0]].nameId,
            e.setDescription(t)) : n("Monsters", t[0]);
            break;
        case 281:
        case 282:
        case 283:
        case 284:
        case 285:
        case 286:
        case 287:
        case 288:
        case 289:
        case 290:
        case 291:
        case 292:
        case 293:
        case 294:
        case 1160:
        case 787:
        case 792:
        case 793:
        case 1017:
        case 1018:
        case 1019:
        case 1035:
        case 1036:
        case 1044:
        case 1045:
            i ? (t[0] = i.Spells[t[0]].nameId,
            e.setDescription(t)) : n("Spells", t[0]);
            break;
        case 406:
            if (!t[2])
                break;
            i ? (t[2] = i.Spells[t[2]].nameId,
            e.setDescription(t)) : n("Spells", t[2]);
            break;
        case 603:
        case 615:
            null === t[0] && t[2] && (t[0] = t[2]),
            i ? (t[2] = i.Jobs[t[0]].nameId,
            e.setDescription(t)) : n("Jobs", t[0]);
            break;
        case 604:
            s(t[2]) && (t[2] = t[0]),
            i && i.SpellLevels && i.SpellLevels[t[2]] ? i.Spells && i.Spells[i.SpellLevels[t[2]].spellId] ? (t[2] = i.Spells[i.SpellLevels[t[2]].spellId].nameId,
            e.setDescription(t)) : n("Spells", i.SpellLevels[t[2]].spellId) : n("SpellLevels", t[2]);
            break;
        case 614:
        case 1050:
            t[0] = t[2],
            i ? (t[1] = i.Jobs[t[1]].nameId,
            e.setDescription(t)) : n("Jobs", t[1]);
            break;
        case 616:
        case 624:
            if (s(t[0]))
                break;
            i ? (t[2] = i.Spells[t[0]].nameId,
            e.setDescription(t)) : n("Spells", t[0]);
            break;
        case 620:
            if (s(t[0]))
                break;
            i ? (t[2] = i.Documents[t[0]].titleId,
            e.setDescription(t)) : n("Documents", t[0]);
            break;
        case 621:
            i ? (t[2] = i.Monsters[t[1]].nameId,
            e.setDescription(t)) : n("Monsters", t[1]);
            break;
        case 623:
        case 628:
            if (s(t[2]))
                break;
            if (i) {
                var o = i.Monsters[t[2]];
                t[1] = o.grades[t[0] - 1].level,
                t[2] = o.nameId,
                e.setDescription(t)
            } else
                n("Monsters", t[2]);
            break;
        case 649:
        case 960:
            i ? (t[2] = i.AlignmentSides[t[0]].titleId,
            e.setDescription(t)) : n("AlignmentSides", t[0]);
            break;
        case 699:
            i ? (t[0] = i.Jobs[t[0]].nameId,
            e.setDescription(t)) : n("Jobs", t[0]);
            break;
        case 716:
            i ? (t[0] = i.MonsterRaces[t[0]].nameId,
            e.setDescription(t)) : n("MonsterRaces", t[0]);
            break;
        case 724:
            if (s(t[0]) && !s(t[2]) && (t[0] = t[2]),
            i) {
                var a = window.gui.playerData.characterBaseInformations && window.gui.playerData.characterBaseInformations.sex ? "nameFemaleId" : "nameMaleId";
                t[2] = i.Titles[t[0]][a],
                e.setDescription(t)
            } else
                n("Titles", t[0]);
            break;
        case 800:
            t[2] = t[0],
            e.setDescription(t);
            break;
        case 806:
            t[1] > 6 ? t[0] = g("ui.petWeight.fat", [t[1]]) : t[2] > 6 ? t[0] = g("ui.petWeight.lean", [t[2]]) : "EffectInstanceInteger" === e._type && t[0] > 6 ? t[0] = g("ui.petWeight.lean", [t[0]]) : t[0] = g("ui.petWeight.nominal"),
            e.setDescription(t);
            break;
        case 807:
            t[0] ? i ? (t[0] = i.Items[t[0]].nameId,
            e.setDescription(t)) : n("Items", t[0]) : (t[0] = g("ui.common.none"),
            e.setDescription(t));
            break;
        case 814:
        case 1151:
            i ? (t[0] = i.Items[t[0]].nameId,
            e.setDescription(t)) : n("Items", t[0]);
            break;
        case 905:
            i ? (t[1] = i.Monsters[t[1]].nameId,
            e.setDescription(t)) : n("Monsters", t[1]);
            break;
        case 939:
            if (s(t[0]))
                break;
            i ? (t[2] = i.Items[t[0]].nameId,
            e.setDescription(t)) : n("Items", t[0]);
            break;
        case 950:
        case 951:
        case 952:
            if (t[2] || (t[2] = t[0]),
            s(t[2]))
                break;
            i ? (t[2] = i.SpellStates[t[2]].nameId,
            e.setDescription(t)) : n("SpellStates", t[2]);
            break;
        case 961:
        case 962:
            t[2] = t[0],
            e.setDescription(t);
            break;
        case 988:
        case 987:
        case 985:
        case 996:
            e.setDescription(t);
            break;
        case 1111:
            t[2] = t[0],
            e.setDescription(t);
            break;
        case 1161:
            i ? (t[0] = i.Companions[t[0]].nameId,
            e.setDescription(t)) : n("Companions", t[0]);
            break;
        case 805:
        case 808:
        case 983:
            if (t[2] = s(t[2]) ? "0" : t[2],
            "string" != typeof t[1] || "string" != typeof t[2])
                break;
            var r = t[0]
              , l = t[1].substr(0, 2)
              , c = t[1].substr(2, 2)
              , u = t[2].substr(0, 2)
              , h = t[2].substr(2, 2)
              , d = window.Config.language;
            switch (d) {
            case "fr":
                t[0] = c + "/" + l + "/" + r + " " + u + ":" + h;
                break;
            default:
                t[0] = l + "/" + c + "/" + r + " " + u + ":" + h
            }
            e.setDescription(t);
            break;
        default:
            e.setDescription(t)
        }
    }
    ,
    p = function(e, t, i, n, o) {
        if (e.requiresInvocationDescription()) {
            var s = t[0];
            if (!i || !i.Monsters || !i.Monsters[s])
                return n("Monsters", s),
                o();
            var a = i.Monsters[s]
              , l = []
              , c = t[1];
            (c < 1 || c > a.grades.length) && (c = a.grades.length);
            var u = a.grades[c - 1]
              , h = 1;
            window.gui.playerData.characterBaseInformations && window.gui.playerData.characterBaseInformations.level && (h = window.gui.playerData.characterBaseInformations.level);
            var d = Math.floor(u.lifePoints + u.lifePoints * h / 100)
              , p = Math.floor((u.wisdom + u.wisdom * h / 100) / 10);
            l.push(g("ui.stats.HP") + g("ui.common.colon") + d),
            l.push(g("ui.stats.shortAP") + g("ui.common.colon") + u.actionPoints),
            l.push(g("ui.stats.shortMP") + g("ui.common.colon") + u.movementPoints),
            l.push(g("ui.stats.dodgeAP") + g("ui.common.colon") + (u.paDodge + p)),
            l.push(g("ui.stats.dodgeMP") + g("ui.common.colon") + (u.pmDodge + p)),
            l.push(g("ui.stats.neutralReductionPercent") + g("ui.common.colon") + u.neutralResistance),
            l.push(g("ui.stats.earthReductionPercent") + g("ui.common.colon") + u.earthResistance),
            l.push(g("ui.stats.fireReductionPercent") + g("ui.common.colon") + u.fireResistance),
            l.push(g("ui.stats.waterReductionPercent") + g("ui.common.colon") + u.waterResistance),
            l.push(g("ui.stats.airReductionPercent") + g("ui.common.colon") + u.airResistance),
            e.subEffectDescription = l,
            o()
        } else if (e.requiresGlyphDescription() || e.requiresTrapDescription() || e.requiresBombDescription()) {
            var m = t[0];
            if (e.requiresBombDescription()) {
                var f = t[0];
                if (!i || !i.SpellBombs || !i.SpellBombs[f])
                    return n("SpellBombs", f),
                    o();
                m = i.SpellBombs[f].explodSpellId
            }
            if (!i || !i.Spells || !i.Spells[m])
                return n("Spells", m),
                o();
            var _ = i.Spells[m].spellLevels[t[1] - 1 || 0];
            if (!i || !i.SpellLevels || !i.SpellLevels[_])
                return n("SpellLevels", _),
                o();
            var v = i.SpellLevels[_].effects;
            r(v, function(t, i) {
                if (t)
                    return o(t);
                for (var n = [], s = 0; s < i.length; s++)
                    if (i[s].description) {
                        if (i[s].hidden)
                            continue;
                        n.push(i[s].description);
                        var a = i[s].getDurationString();
                        a && (n[n.length - 1] += " (" + a + ")")
                    }
                e.subEffectDescription = n.length > 0 && n,
                o()
            })
        } else
            e.subEffectDescription = !1,
            o()
    }
    ,
    h = function(e, t) {
        u(e, function(i, n) {
            if (i)
                return t(i);
            for (var o = 0; o < e.length; o++) {
                var s = e[o]
                  , a = n[s.effectId];
                a ? s.effect = a : e[o] = null
            }
            m(e, null , t)
        })
    }
    ,
    e.exports = {
        createEffectInstances: r,
        createEffectInstancesIndexed: l,
        EffectInstance: a,
        collectEffectInstanceData: h,
        category: I,
        getHumanReadableZoneInfo: o,
        parseZone: n,
        EFFECT_SHAPES: w
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var s = this;
        o.call(this, e, t, i, e.boostedSpellId, null , e.delta, function(t, i) {
            return t ? n(t) : (s.modifType = 0,
            s.spellId = e.boostedSpellId,
            s._delta = e.delta,
            n(null , i))
        })
    }
    var o = i(221)
      , s = i(222)
      , a = i(226)
      , r = i(26).inherits
      , l = i(228);
    r(n, o),
    e.exports = n,
    n.prototype.getDelta = function() {
        return this._delta
    }
    ,
    n.prototype.apply = function() {
        if (this.targetId === window.gui.playerData.characters.controlledCharacterId) {
            this.modifType = a(this.actionId),
            this.actionId === s.ACTION_DEBOOST_SPELL_RANGE && (this._delta *= -1);
            for (var e = !1, t = window.gui.playerData.characters.mainCharacter.characteristics.spellModifications, i = 0; i < t.length; i++) {
                var n = t[i];
                this.spellId === n.spellId && n.modificationType === this.modifType && (e = !0,
                n.value.contextModif += this._delta)
            }
            if (!e) {
                var r = new l;
                r.modificationType = this.modifType,
                r.spellId = this.spellId,
                r.value.contextModif = this._delta,
                t.push(r)
            }
        }
        o.prototype.apply.call(this)
    }
    ,
    n.prototype.remove = function() {
        if (!this._removed && this.targetId === window.gui.playerData.characters.controlledCharacterId)
            for (var e = window.gui.playerData.characters.mainCharacter.characteristics.spellModifications, t = 0; t < e.length; t++) {
                var i = e[t];
                this.spellId === i.spellId && i.modificationType === this.modifType && (e[t].value.contextModif -= this._delta)
            }
        o.prototype.remove.call(this)
    }
}
, function(e, t, i) {
    function n(e) {
        return a[e]
    }
    var o = i(222)
      , s = i(227)
      , a = {};
    a[o.ACTION_BOOST_SPELL_RANGEABLE] = s.RANGEABLE,
    a[o.ACTION_BOOST_SPELL_DMG] = s.DAMAGE,
    a[o.ACTION_BOOST_SPELL_BASE_DMG] = s.BASE_DAMAGE,
    a[o.ACTION_BOOST_SPELL_HEAL] = s.HEAL_BONUS,
    a[o.ACTION_BOOST_SPELL_AP_COST] = s.AP_COST,
    a[o.ACTION_BOOST_SPELL_CAST_INTVL] = s.CAST_INTERVAL,
    a[o.ACTION_BOOST_SPELL_CAST_INTVL_SET] = s.CAST_INTERVAL_SET,
    a[o.ACTION_BOOST_SPELL_CC] = s.CRITICAL_HIT_BONUS,
    a[o.ACTION_BOOST_SPELL_CASTOUTLINE] = s.CAST_LINE,
    a[o.ACTION_BOOST_SPELL_NOLINEOFSIGHT] = s.LOS,
    a[o.ACTION_BOOST_SPELL_MAXPERTURN] = s.MAX_CAST_PER_TURN,
    a[o.ACTION_BOOST_SPELL_MAXPERTARGET] = s.MAX_CAST_PER_TARGET,
    a[o.ACTION_BOOST_SPELL_RANGE] = s.RANGE,
    a[o.ACTION_DEBOOST_SPELL_RANGE] = s.RANGE,
    e.exports = n
}
, function(e, t) {
    e.exports = {
        INVALID_MODIFICATION: 0,
        RANGEABLE: 1,
        DAMAGE: 2,
        BASE_DAMAGE: 3,
        HEAL_BONUS: 4,
        AP_COST: 5,
        CAST_INTERVAL: 6,
        CAST_INTERVAL_SET: 7,
        CRITICAL_HIT_BONUS: 8,
        CAST_LINE: 9,
        LOS: 10,
        MAX_CAST_PER_TURN: 11,
        MAX_CAST_PER_TARGET: 12,
        RANGE: 13
    }
}
, function(e, t, i) {
    function n() {
        this._type = "CharacterSpellModification",
        this.modificationType = 0,
        this.spellId = 0,
        this.value = new o
    }
    var o = i(229);
    e.exports = n
}
, function(e, t) {
    function i() {
        this._type = "CharacterBaseCharacteristic",
        this.base = 0,
        this.objectsAndMountBonus = 0,
        this.alignGiftBonus = 0,
        this.contextModif = 0
    }
    e.exports = i
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var s = this;
        o.call(this, e, t, i, e.delta, null , null , function(e, t) {
            return e ? n(e) : (s.statName = a.getActionStatName(i),
            s.isABoost = a.getIsABoost(i),
            n(null , t))
        })
    }
    var o = i(221)
      , s = i(26).inherits
      , a = i(222);
    s(n, o),
    e.exports = n,
    n.prototype.getDelta = function() {
        return "EffectInstanceDice" === this.effect._type ? this.isABoost ? this.effect.diceNum : -this.effect.diceNum : 0
    }
    ,
    n.prototype.apply = function() {
        var e = this.getDelta();
        this.incrementStats(e),
        o.prototype.apply.call(this)
    }
    ,
    n.prototype.remove = function() {
        if (!this._removed && !this.effect.effect.active) {
            var e = this.getDelta();
            this.decrementStats(e)
        }
        o.prototype.remove.call(this)
    }
    ,
    n.prototype.disable = function() {
        if (!this._disabled && this.effect.effect.active) {
            var e = this.getDelta();
            this.decrementStats(e)
        }
        o.prototype.disable.call(this)
    }
    ,
    n.prototype.incrementStats = function(e) {
        var t = window.gui
          , i = t.fightManager.getFighter(this.targetId);
        if (!i)
            return void console.error("Trying to apply a stats buff on non-existing fighter " + this.targetId);
        var n = i.data.stats;
        switch (this.statName) {
        case "vitality":
            n.lifePoints += e,
            n.maxLifePoints += e;
            break;
        case "lifePointsMalus":
            n.lifePoints = Math.min(n.lifePoints + e, n.maxLifePoints);
            break;
        case "lifePoints":
        case "shieldPoints":
        case "dodgePALostProbability":
        case "dodgePMLostProbability":
            n[this.statName] = Math.max(n[this.statName] + e, 0);
            break;
        case "agility":
            n.tackleEvade += ~~(e / 10),
            n.tackleBlock += ~~(e / 10);
            break;
        case "globalResistPercentMalus":
        case "globalResistPercentBonus":
            var o = "globalResistPercentBonus" === this.statName ? 1 : -1;
            n.neutralElementResistPercent += e * o,
            n.airElementResistPercent += e * o,
            n.waterElementResistPercent += e * o,
            n.earthElementResistPercent += e * o,
            n.fireElementResistPercent += e * o;
            break;
        case "actionPoints":
            n.actionPoints += e,
            n.maxActionPoints += e;
            break;
        case "movementPoints":
            n.movementPoints += e,
            n.maxMovementPoints += e;
            break;
        default:
            n.hasOwnProperty(this.statName) && (n[this.statName] += e)
        }
        var s = t.playerData.characters;
        if (s.mainCharacterId === this.targetId || s.controlledCharacterId === this.targetId) {
            var a;
            if (a = s.mainCharacterId === this.targetId ? s.mainCharacter : s.getControlledCharacter(),
            a.timeStatsSynchronized - this.timeCreationStarted > 0)
                return void ("summonableCreaturesBoost" === this.statName ? t.fightManager.emit("updateSpellsAvailability") : "range" === this.statName && window.foreground.refreshSpellRange());
            var r = a.characteristics;
            switch (r.hasOwnProperty(this.statName) && (r[this.statName].contextModif += e),
            this.statName) {
            case "vitality":
                a.setCharacteristic("maxLifePoints", Math.max(0, r.maxLifePoints + e)),
                a.setCharacteristic("lifePoints", Math.max(0, r.lifePoints + e));
                break;
            case "lifePoints":
            case "lifePointsMalus":
                a.setCharacteristic("lifePoints", Math.max(0, r.lifePoints + e));
                break;
            case "movementPoints":
                a.setCharacteristic("movementPointsCurrent", r.movementPointsCurrent + e);
                break;
            case "actionPoints":
                a.setCharacteristic("actionPointsCurrent", r.actionPointsCurrent + e);
                break;
            case "summonableCreaturesBoost":
                t.fightManager.emit("updateSpellsAvailability");
                break;
            case "range":
                window.foreground.refreshSpellRange()
            }
        }
    }
    ,
    n.prototype.decrementStats = function(e) {
        this.incrementStats(-e);
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var s = this;
        o.call(this, e, t, i, e.stateId, null , null , function(t, o) {
            return t ? n(t) : (s.statName = a.getActionStatName(i),
            s.stateId = e.stateId,
            n(null , o))
        })
    }
    var o = i(221)
      , s = i(26).inherits
      , a = i(222)
      , r = i(232)
      , l = i(218);
    s(n, o),
    e.exports = n,
    n.prototype.apply = function() {
        var e = window.gui.fightManager.getFighter(this.targetId);
        return e ? (e.addState(this.stateId),
        window.gui.shortcutBar.updateSpellsAvailability(),
        void o.prototype.apply.call(this)) : console.error("Applying state buff failed, fighter does not exist.")
    }
    ,
    n.prototype.remove = function() {
        if (!this._removed) {
            var e = window.gui.fightManager.getFighter(this.targetId);
            if (!e)
                return console.error("Removing state buff failed, fighter does not exist.");
            e.removeState(this.stateId),
            window.gui.shortcutBar.updateSpellsAvailability();
            var t = this.targetId;
            window.gui.fightManager.deadTurnsList.indexOf(t) === -1 && (952 === this.actionId ? r.send(l.FIGHTER_ENTERING_STATE, [t, this.stateId], t, -1) : r.send(l.FIGHTER_LEAVING_STATE, [t, this.stateId], t, -1))
        }
        o.prototype.remove.call(this)
    }
}
, function(e, t, i) {
    function n(e, t, i, n, o, s) {
        return void 0 === o && (o = 0),
        void 0 === s && (s = 1),
        {
            name: e,
            targetId: i,
            params: t,
            checkParams: o,
            castingSpellId: n,
            order: b.length,
            firstParamToCheck: s
        }
    }
    function o(e, t) {
        var i, n = window.gui.databases.TypeActions[t], o = n ? n.elementId : -1;
        switch (e = "-" + e,
        o) {
        case -1:
            i = "multi";
            break;
        case 0:
            i = "neutral";
            break;
        case 1:
            i = "earth";
            break;
        case 2:
            i = "fire";
            break;
        case 3:
            i = "water";
            break;
        case 4:
            i = "air"
        }
        return i ? "{style:" + i + "Damage," + e + "}" : e
    }
    function s(e, t) {
        if (e.name === d.FIGHT_END)
            return t(null , _("ui.fight.fightEnd"));
        var i, n, s = window.gui.fightManager, a = e.params, r = s.getFighter(a[0]);
        if (!r)
            return t(new Error("Fighter does not exist."));
        var l;
        if (e.name === d.FIGHTER_DEATH)
            i = v(_("ui.fight.isDead"), 0, r.name);
        else {
            if (e.name === d.FIGHTER_TRIGGERED_GLYPH)
                return l = s.getFighter(a[1]),
                l ? s.getFighterSpell(a[2], a[1], function(e, n) {
                    return e ? t(e) : (i = _("ui.fight.startTrap", r.name, n.getName(), l.name),
                    t(null , i))
                }) : t(new Error("Second fighter does not exist."));
            if (e.name === d.FIGHTER_ENTERING_STATE) {
                var c = a[2] ? "</b> (" + a[2] + ")<b>" : "";
                n = window.gui.databases.SpellStates[a[1]],
                i = _("ui.fight.enterState", r.name, n.nameId + c)
            } else if (e.name === d.FIGHTER_LEAVING_STATE)
                n = window.gui.databases.SpellStates[a[1]],
                i = _("ui.fight.exitState", r.name, n.nameId);
            else {
                if (e.name === d.FIGHTER_SPELL_DISPELLED)
                    return s.getFighterSpell(a[1], a[0], function(e, n) {
                        return e ? t(e) : (i = _("ui.fight.dispellSpell", r.name, n.getName()),
                        t(null , i))
                    });
                if (e.name === d.FIGHTER_CASTED_SPELL)
                    return s.getFighterSpell(a[1], a[0], function(e, n) {
                        return e ? t(e) : (i = _("ui.fight.launchSpell", r.name, n.getName()),
                        a[2] === m.CRITICAL_HIT ? i += " " + _("ui.fight.criticalHit") : a[2] === m.CRITICAL_FAIL && (i += " " + _("ui.fight.criticalMiss")),
                        t(null , i))
                    });
                if (e.name === d.FIGHTER_CLOSE_COMBAT)
                    return f.getData("Items", [a[1]], function(e, n) {
                        return e ? t(e) : (i = _("ui.fight.closeCombat", r.name, n[0].nameId),
                        a[2] === m.CRITICAL_HIT ? i += " " + _("ui.fight.criticalHit") : a[2] === m.CRITICAL_FAIL && (i += " " + _("ui.fight.criticalMiss")),
                        t(null , i))
                    });
                if (e.name === d.FIGHTER_LIFE_LOSS_AND_DEATH)
                    i = _("ui.fight.lifeLossAndDeath", r.name, o(a[1], a[2]));
                else if (e.name === d.FIGHTER_LIFE_LOSS)
                    i = _("ui.fight.lifeLoss", r.name, o(a[1], a[2]));
                else if (e.name === d.FIGHTER_SHIELD_LOSS)
                    i = _("ui.fight.lostShieldPoints", r.name, o(a[1], a[2]));
                else if (e.name === d.FIGHTER_REDUCED_DAMAGES)
                    i = _("ui.fight.reduceDamages", r.name, a[1]);
                else if (e.name === d.FIGHTER_LIFE_GAIN)
                    i = _("ui.fight.lifeGain", r.name, a[1]);
                else if (e.name === d.FIGHTER_AP_LOST)
                    i = _("ui.fight.lostAP", r.name, a[1]);
                else if (e.name === d.FIGHTER_AP_GAINED)
                    i = _("ui.fight.winAP", r.name, a[1]);
                else if (e.name === d.FIGHTER_AP_LOSS_DODGED)
                    i = _("ui.fight.dodgeAP", r.name, a[1]);
                else if (e.name === d.FIGHTER_MP_LOST)
                    i = _("ui.fight.lostMP", r.name, a[1]);
                else if (e.name === d.FIGHTER_MP_GAINED)
                    i = _("ui.fight.winMP", r.name, a[1]);
                else if (e.name === d.FIGHTER_MP_LOSS_DODGED)
                    i = _("ui.fight.dodgeMP", r.name, a[1]);
                else if (e.name === d.FIGHTER_TEMPORARY_BOOSTED) {
                    var u = ~~a[2];
                    i = _("ui.fight.effect", r.name, u ? a[1] + " (" + a[3] + ")" : a[1])
                } else if (e.name === d.FIGHTER_EFFECTS_MODIFY_DURATION)
                    i = _("ui.fight.effectsModifyDuration", r.name, a[2]);
                else if (e.name === d.FIGHTER_SPELL_IMMUNITY)
                    i = _("ui.fight.noChange", r.name);
                else if (e.name === d.FIGHTER_NO_CHANGE)
                    i = _("ui.fight.noChange", r.name);
                else if (e.name === d.FIGHTER_LEAVE)
                    i = _("ui.fight.leave", r.name);
                else if (e.name === d.FIGHTER_GOT_DISPELLED)
                    i = _("ui.fight.dispell", r.name);
                else if (e.name === d.FIGHTER_REFLECTED_SPELL)
                    i = _("ui.fight.reflectSpell", r.name);
                else if (e.name === d.FIGHTER_REFLECTED_DAMAGES)
                    i = _("ui.fight.reflectDamages", r.name);
                else if (e.name === d.FIGHTER_GOT_TACKLED)
                    i = _("ui.fight.dodgeFailed");
                else if (e.name === d.FIGHTER_VISIBILITY_CHANGED) {
                    var h = a[1] === p.INVISIBLE;
                    i = h ? _("ui.fight.invisibility", r.name) : _("ui.fight.visibility", r.name)
                } else if (e.name === d.FIGHTER_GOT_KILLED) {
                    if (l = s.getFighter(a[1]),
                    !l)
                        return t(new Error("Second fighter does not exist."));
                    if (a[0] === a[1])
                        return t();
                    i = _("ui.fight.killed", r.name, l.name)
                }
            }
        }
        return t(null , i)
    }
    function a(e, t) {
        if (t || (t = A),
        window.gui.fightManager.emit(e.name, e.params),
        e.name === d.FIGHTER_LIFE_LOSS && C[e.params[0]])
            e.name = d.FIGHTER_LIFE_LOSS_AND_DEATH;
        else if (e.name === d.FIGHTER_DEATH && I[e.params[0]])
            return t();
        s(e, function(e, i) {
            return e ? t(e) : i ? (window.gui.chat.logMsg(i, w.PSEUDO_CHANNEL_FIGHT_LOG),
            t()) : t()
        })
    }
    function r(e, t, i, o, s, r) {
        var l = n(e, t, i, o, s, r);
        a(l)
    }
    function l(e, t, i, o, s, a) {
        var r = n(e, t, i, o, s, a);
        r.name === d.FIGHTER_LIFE_LOSS ? I[r.params[0]] = !0 : r.name === d.FIGHTER_DEATH && (C[r.params[0]] = !0),
        b.push(r)
    }
    function c() {
        b = [],
        C = {},
        I = {},
        T = !1,
        S = []
    }
    function u(e, t) {
        T = !0,
        t || (t = A),
        y.eachSeries(e, function(e, t) {
            a(e, t)
        }, function(e) {
            if (T = !1,
            C = {},
            I = {},
            e)
                return t(e);
            if (t(),
            S.length) {
                var i = S.shift();
                return u(i[0], i[1])
            }
        })
    }
    function h(e) {
        var t = b;
        return b = [],
        T ? S.push([t, e]) : void u(t, e)
    }
    var d = i(218)
      , p = i(233)
      , m = i(234)
      , f = i(36)
      , g = i(35)
      , _ = g.getText
      , v = g.processTextWithModifier
      , y = i(12)
      , w = i(235)
      , b = []
      , C = {}
      , I = {}
      , T = !1
      , S = []
      , A = function(e) {
        if (e)
            return console.error(e)
    };
    t.send = r,
    t.push = l,
    t.reset = c,
    t.flush = h
}
, function(e, t) {
    e.exports = {
        INVISIBLE: 1,
        DETECTED: 2,
        VISIBLE: 3
    }
}
, function(e, t) {
    e.exports = {
        NORMAL: 1,
        CRITICAL_HIT: 2,
        CRITICAL_FAIL: 3
    }
}
, function(e, t) {
    e.exports = {
        CHANNEL_GLOBAL: 0,
        CHANNEL_TEAM: 1,
        CHANNEL_GUILD: 2,
        CHANNEL_ALLIANCE: 3,
        CHANNEL_PARTY: 4,
        CHANNEL_SALES: 5,
        CHANNEL_SEEK: 6,
        CHANNEL_NOOB: 7,
        CHANNEL_ADMIN: 8,
        CHANNEL_ADS: 12,
        CHANNEL_ARENA: 13,
        PSEUDO_CHANNEL_PRIVATE: 9,
        PSEUDO_CHANNEL_INFO: 10,
        PSEUDO_CHANNEL_FIGHT_LOG: 11
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var s = this;
        o.call(this, e, t, i, e.param1, e.param2, e.param3, function(t, i) {
            return t ? n(t) : (s.delay = e.delay,
            s.effect.delay = e.delay,
            n(null , i))
        })
    }
    var o = i(221)
      , s = i(26).inherits;
    s(n, o),
    e.exports = n,
    n.prototype.isActive = function() {
        return this.delay > 0 || o.prototype.isActive.call(this)
    }
    ,
    n.prototype.isTrigger = function() {
        return !0
    }
    ,
    n.prototype.incrementDuration = function(e, t) {
        return this.delay > 0 && !t && (this.delay + e >= 0 ? (this.delay--,
        this.effect.delay--) : (e += this.delay,
        this.delay = 0,
        this.effect.delay = 0)),
        0 === e || o.prototype.incrementDuration.call(this, e, t)
    }
    ,
    n.prototype.isUnusableNextTurn = function() {
        return this.delay <= 1 && o.prototype.isUnusableNextTurn.call(this)
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.data = new u,
        this.id = e,
        this.name = null ,
        this.level = null ,
        this.isBomb = !1,
        this.isCreature = !1,
        this.canTackle = !0,
        this.buffs = [],
        this._finishingBuffs = [],
        this.states = [],
        this.spells = {},
        t || (this.picto = this.createPicto(e),
        this.isShieldBarVisible = !1,
        window.gui.timeline.linkToTimeline(this))
    }
    var o = i(190)
      , s = i(238)
      , a = i(279)
      , r = i(25)
      , l = i(213)
      , c = i(220)
      , u = i(280)
      , h = i(35).getText
      , d = 40
      , p = 30
      , m = 7
      , f = 50
      , g = 0;
    e.exports = n,
    n.prototype.clear = function() {
        this.picto && this.picto.destroy()
    }
    ,
    n.prototype.createPicto = function(e) {
        var t = new o("div",{
            name: e,
            className: "fighter"
        });
        return t.fighterTimeBar = t.createChild("div", {
            className: "fighterTimeBar"
        }),
        t.fighterTimeValue = t.fighterTimeBar.createChild("div", {
            className: "fighterTimeValue"
        }),
        t.fighterIllus = t.appendChild(new s({
            className: "fighterIllus",
            scale: "fitin"
        })),
        t.fighterHPBar = t.createChild("div", {
            className: "fighterHPBar"
        }),
        t.fighterHPValue = t.fighterHPBar.createChild("div", {
            className: "fighterHPValue"
        }),
        t.fighterShieldBar = t.createChild("div", {
            className: "fighterShieldBar",
            hidden: !0
        }),
        t.fighterShieldValue = t.fighterShieldBar.createChild("div", {
            className: "fighterShieldValue"
        }),
        t.fighterNumber = t.createChild("div", {
            className: "fighterNumber"
        }),
        t.fighterNumber.toggleDisplay(!!r.orderFighters),
        t
    }
    ,
    n.prototype.createStatsTooltipContent = function() {
        var e, t = new o("table",{
            className: "statsDetails",
            name: "statsDetails"
        });
        return e = t.createChild("tr"),
        t.fighterName = e.createChild("td", {
            className: "fighterName",
            attr: {
                colspan: 3
            }
        }),
        t.level = e.createChild("td", {
            className: "fighterLevel",
            attr: {
                colspan: 2
            }
        }),
        e = t.createChild("tr"),
        t.lifePoints = e.createChild("td", {
            className: ["label", "iconLifePoints"],
            attr: {
                colspan: 2
            }
        }),
        t.shieldPoints = e.createChild("td", {
            className: ["label", "iconShieldPoints"]
        }),
        t.fighterUsedAP = e.createChild("td", {
            className: ["label", "iconActionPoints"]
        }),
        t.movementPoints = e.createChild("td", {
            className: ["label", "iconMovementPoints"]
        }),
        e = t.createChild("tr"),
        t.dodgePALostProbability = e.createChild("td", {
            className: ["label", "iconActionPoints"]
        }),
        t.dodgePMLostProbability = e.createChild("td", {
            className: ["label", "iconMovementPoints"]
        }),
        t.tackleBlock = e.createChild("td", {
            className: ["label", "iconTackle"]
        }),
        t.criticalDamageReduction = e.createChild("td", {
            className: ["label", "iconCriticalDamage"]
        }),
        t.pushDamageReduction = e.createChild("td", {
            className: ["label", "iconPushDamageReduction"]
        }),
        e = t.createChild("tr"),
        t.neutral = e.createChild("td", {
            className: ["label", "iconYinyang"]
        }),
        t.strength = e.createChild("td", {
            className: ["label", "iconStrength"]
        }),
        t.intelligence = e.createChild("td", {
            className: ["label", "iconIntelligence"]
        }),
        t.chance = e.createChild("td", {
            className: ["label", "iconChance"]
        }),
        t.agility = e.createChild("td", {
            className: ["label", "iconAgility"]
        }),
        e = t.createChild("tr"),
        t.neutralPercent = e.createChild("td", {
            className: ["label", "iconYinyang"]
        }),
        t.strengthPercent = e.createChild("td", {
            className: ["label", "iconStrength"]
        }),
        t.intelligencePercent = e.createChild("td", {
            className: ["label", "iconIntelligence"]
        }),
        t.chancePercent = e.createChild("td", {
            className: ["label", "iconChance"]
        }),
        t.agilityPercent = e.createChild("td", {
            className: ["label", "iconAgility"]
        }),
        this.refreshStatsTooltipContent(t),
        t
    }
    ,
    n.prototype.refreshStatsTooltipContent = function(e) {
        var t = this.data.stats;
        e.fighterName.setText(this.name),
        e.level.setText(h("ui.common.short.level") + " " + this.level),
        e.lifePoints.setText(t.lifePoints + " / " + t.maxLifePoints),
        e.shieldPoints.setText(t.shieldPoints),
        e.fighterUsedAP.setText(t.actionPoints),
        e.movementPoints.setText(t.movementPoints),
        e.dodgePALostProbability.setText(t.dodgePALostProbability),
        e.dodgePMLostProbability.setText(t.dodgePMLostProbability),
        e.tackleBlock.setText(Math.max(g, t.tackleBlock)),
        e.criticalDamageReduction.setText(t.criticalDamageFixedResist),
        e.pushDamageReduction.setText(t.pushDamageFixedResist),
        e.neutral.setText(t.neutralElementReduction),
        e.strength.setText(t.earthElementReduction),
        e.intelligence.setText(t.fireElementReduction),
        e.chance.setText(t.waterElementReduction),
        e.agility.setText(t.airElementReduction),
        "GameFightCharacterInformations" === this.data._type ? (e.neutralPercent.setText(Math.min(f, t.neutralElementResistPercent) + "%"),
        e.strengthPercent.setText(Math.min(f, t.earthElementResistPercent) + "%"),
        e.intelligencePercent.setText(Math.min(f, t.fireElementResistPercent) + "%"),
        e.chancePercent.setText(Math.min(f, t.waterElementResistPercent) + "%"),
        e.agilityPercent.setText(Math.min(f, t.airElementResistPercent) + "%")) : (e.neutralPercent.setText(t.neutralElementResistPercent + "%"),
        e.strengthPercent.setText(t.earthElementResistPercent + "%"),
        e.intelligencePercent.setText(t.fireElementResistPercent + "%"),
        e.chancePercent.setText(t.waterElementResistPercent + "%"),
        e.agilityPercent.setText(t.airElementResistPercent + "%"))
    }
    ,
    n.prototype.getFinishingBuffs = function() {
        var e = this._finishingBuffs;
        return this._finishingBuffs = [],
        e
    }
    ,
    n.prototype.synchronizeData = function(e) {
        this.applyFinishingBuffs(e),
        this.setAlive(e.alive),
        this.data.updateData(e),
        this.setHP(e.stats.lifePoints),
        this.setShield(e.stats.shieldPoints)
    }
    ,
    n.prototype.applyFinishingBuffs = function(e) {
        var t = this.getFinishingBuffs();
        if (0 !== t.length)
            for (var i = 0; i < t.length; i++)
                for (var n = t[i], o = n.statName, s = 0; s < this.buffs.length; s++) {
                    var a = this.buffs[s];
                    a.id === n.id && o && e.stats.hasOwnProperty(o) && a.effect.effect.active && ("actionPoints" === o && (e.stats.maxActionPoints = e.stats.maxActionPoints - n.getDelta()),
                    e.stats[o] = e.stats[o] - n.getDelta())
                }
    }
    ,
    n.prototype.getAvailableWidth = function() {
        var e = this.isSummon() ? p : d;
        return this.isShieldBarVisible ? e - m : e
    }
    ,
    n.prototype.isSummon = function() {
        return this.data.stats.summoned
    }
    ,
    n.prototype.resizeFighterIllustration = function() {
        if (this.picto) {
            var e = this.getAvailableWidth();
            this.picto.fighterTimeBar.setStyles({
                width: e + "px"
            }),
            this.picto.fighterIllus.setStyles({
                width: e + "px"
            }),
            this.picto.fighterIllus.resize()
        }
    }
    ,
    n.prototype.setData = function(e) {
        this.data.updateData(e);
        var t = e.alive;
        this.data.alive = null ,
        this.setAlive(t),
        this.setHP(this.data.stats.lifePoints),
        this.setShield(this.data.stats.shieldPoints),
        this.setNameAndLevel(e),
        this.picto && (e.teamId === l.TEAM_CHALLENGER && this.picto.addClassNames("challenger"),
        e.stats.summoned && this.picto.addClassNames("summoned"),
        this.data.look && this.updateFighterIllustration(),
        this.resizeFighterIllustration())
    }
    ,
    n.prototype.setAlive = function(e, t) {
        (this.data.alive !== e || t) && (this.data.alive = e,
        e || (this.setHP(0),
        this.setShield(0)),
        this.picto && (this.picto.toggleClassName("dead", !e),
        t && this.picto.toggleDisplay(e || !r.hideDeadFighters)))
    }
    ,
    n.prototype.setHP = function(e) {
        if (this.data.stats) {
            e = Math.max(0, e);
            var t = this.data.stats;
            t.lifePoints = e;
            var i = this.id === window.gui.playerData.characters.controlledCharacterId;
            if (i) {
                var n = window.gui.playerData.characters.getControlledCharacter();
                n.setCharacteristic("lifePoints", t.lifePoints),
                n.setCharacteristic("maxLifePoints", t.maxLifePoints)
            }
            this.picto && this.picto.fighterHPValue.setStyle("height", Math.min(e / t.maxLifePoints * 100, 100) + "%")
        }
    }
    ,
    n.prototype.setShield = function(e) {
        if (this.data.stats) {
            e = Math.max(0, e);
            var t = this.data.stats;
            if (t.shieldPoints = e,
            this.picto) {
                var i = 0 !== t.shieldPoints;
                i && this.picto.fighterShieldValue.setStyle("height", e / t.maxLifePoints * 100 + "%"),
                this.isShieldBarVisible !== i && (this.isShieldBarVisible = i,
                this.picto.fighterShieldBar.toggleDisplay(i),
                this.resizeFighterIllustration())
            }
        }
    }
    ,
    n.prototype.setNameAndLevel = function(e) {
        switch (e._type) {
        case "GameFightCharacterInformations":
            this.name = e.name,
            this.level = e.level;
            break;
        case "GameFightMutantInformations":
            this.name = e.name,
            this.level = e.powerLevel;
            break;
        case "GameFightMonsterInformations":
        case "GameFightMonsterWithAlignmentInformations":
            this.name = e._name,
            this.level = e._level,
            this.isBomb = e._isBomb,
            this.isCreature = e._isCreature,
            this.canTackle = e._canTackle;
            break;
        case "GameFightTaxCollectorInformations":
            this.name = e._name,
            this.level = e.level;
            break;
        default:
            console.warn('Retrieving details of fighter type "' + e._type + '" not supported')
        }
    }
    ,
    n.prototype.updateFighterIllustration = function() {
        this.picto && this.picto.fighterIllus.setLook(this.data.look, {
            riderOnly: !0,
            direction: a.DIRECTION_SOUTH_EAST,
            animation: "AnimArtwork",
            boneType: "timeline/",
            skinType: "timeline/",
            showSubentities: !1
        })
    }
    ,
    n.prototype.refreshHP = function() {
        this.data.alive && this.setHP(this.data.stats.lifePoints)
    }
    ,
    n.prototype.refreshShield = function() {
        this.setShield(this.data.stats.shieldPoints)
    }
    ,
    n.prototype.updateNumber = function(e) {
        if (this.picto) {
            var t = e || "";
            this.picto.fighterNumber.setText(t),
            r.orderFighters && window.actorManager.turnNumberOn(this.id, t)
        }
    }
    ,
    n.prototype.addBuff = function(e, t) {
        t = void 0 === t || t;
        for (var i, n = 0, o = this.buffs.length; n < o; n++)
            if (e.equals(this.buffs[n])) {
                i = this.buffs[n];
                break
            }
        if (i) {
            var s = i.castingSpell.spellRank && i.castingSpell.spellRank.maxStack > 0
              , a = s && i.stack && i.stack.length === i.castingSpell.spellRank.maxStack;
            if (a)
                return;
            i.add(e)
        } else
            this.buffs.push(e);
        t && e.apply(),
        i ? window.gui.fightManager.emit("BuffUpdate", i, this) : window.gui.fightManager.emit("BuffAdd", e, this)
    }
    ,
    n.prototype.updateBuff = function(e) {
        var t = this.getBuffIndex(e.id);
        if (t === -1)
            return !1;
        var i = this.buffs[t];
        return i.remove(),
        i.updateParam(e.getParam1(), e.getParam2(), e.getParam3(), e.id),
        i.apply(),
        window.gui.fightManager.emit("BuffUpdate", i, this),
        !0
    }
    ,
    n.prototype.getBuff = function(e) {
        for (var t = 0; t < this.buffs.length; t++) {
            var i = this.buffs[t];
            if (e === i.id)
                return i
        }
        return null
    }
    ,
    n.prototype.getBuffIndex = function(e) {
        for (var t = 0; t < this.buffs.length; t++) {
            var i = this.buffs[t];
            if (e === i.id)
                return t;
            if (i.stack)
                for (var n = 0; n < i.stack.length; n++)
                    if (e === i.stack[n].id)
                        return t
        }
        return -1
    }
    ,
    n.prototype.addState = function(e) {
        this.states.push(e)
    }
    ,
    n.prototype.removeState = function(e) {
        this.states.indexOf(e) !== -1 && this.states.splice(this.states.indexOf(e), 1)
    }
    ,
    n.prototype.hasState = function(e) {
        return this.states.indexOf(e) !== -1
    }
    ,
    n.prototype.dispel = function(e, t, i) {
        for (var n = [], o = 0; o < this.buffs.length; o++) {
            var s = this.buffs[o];
            s.canBeDispell(e, Number.MIN_VALUE, i) ? (window.gui.fightManager.emit("BuffRemove", s, this),
            s.remove()) : n.push(s)
        }
        this.buffs = n
    }
    ,
    n.prototype.dispelSpell = function(e, t, i, n) {
        var o, s = [], a = [];
        for (o = 0; o < this.buffs.length; o++) {
            var r = this.buffs[o];
            e === r.castingSpell.spell.id && r.canBeDispell(t, Number.MIN_VALUE, n) ? (r.remove(),
            s.push(r)) : a.push(r)
        }
        for (this.buffs = a,
        o = 0; o < s.length; o++)
            window.gui.fightManager.emit("BuffRemove", s[o], this)
    }
    ,
    n.prototype.dispelUniqueBuff = function(e, t, i, n) {
        var o = this.getBuffIndex(e);
        if (o === -1)
            return console.warn("Buff id", e, "does not exist");
        var s = this.buffs[o]
          , a = window.gui.fightManager;
        if (s.canBeDispell(t, n ? e : Number.MIN_VALUE, i))
            if (s.remove(),
            !i && s.stack && s.stack.length > 1) {
                switch (s.actionId) {
                case 293:
                    s.setParam1(s.stack[0].getParam1()),
                    s.setParam2(s.getParam2() - s.stack[0].getParam2()),
                    s.setParam3(s.getParam3() - s.stack[0].getParam3());
                    break;
                case 788:
                    s.setParam1(s.getParam1() - s.stack[0].getParam2());
                    break;
                case 950:
                case 951:
                    break;
                default:
                    s.setParam1(s.getParam1() - s.stack[0].getParam1()),
                    s.setParam2(s.getParam2() - s.stack[0].getParam2()),
                    s.setParam3(s.getParam3() - s.stack[0].getParam3())
                }
                s.stack.shift(),
                s.refreshDescription(),
                s.apply(),
                a.emit("BuffUpdate", s, this)
            } else
                this.buffs.splice(o, 1),
                a.emit("BuffRemove", s, this),
                a.emit("BuffRemove", s, this)
    }
    ,
    n.prototype.markFinishingBuffs = function() {
        var e = window.gui.fightManager;
        for (var t in this.buffs) {
            var i = this.buffs[t];
            if (1 === i.duration) {
                for (var n = !1, o = 0, s = !1, a = 0; a < e.turnsList.length; a++) {
                    var r = e.turnsList[a];
                    r === i.aliveSource && (s = !0),
                    r === e.currentFighterId && (o = 1),
                    1 === o && (s && r !== e.currentFighterId ? (o = 2,
                    n = !0) : r === this.id && r !== e.currentFighterId && (o = 2,
                    n = !1))
                }
                if (n) {
                    if (i instanceof c.StatBuff && this.id !== window.gui.playerData.characters.mainCharacterId && i.statName) {
                        var l = e.getFighter(i.targetId);
                        if (!l)
                            return console.error("Mark finishing buffs failed, fighter does not exist");
                        l._finishingBuffs.push(i)
                    }
                    i.disable()
                }
            }
        }
    }
    ,
    n.prototype.enableBuffs = function() {
        for (var e in this.buffs)
            this.buffs[e].enable()
    }
}
, function(e, t, i) {
    function n() {
        return null
    }
    function o() {
        return p = document.createElement("canvas"),
        p.id = "characterDisplayCanvas",
        p.width = g,
        p.height = _,
        m = new h(p,g,_,u.MAX_SPRITES_BUFFER_CHARACTER_DISPLAY,u.MAX_TEXTURE_MEMORY_CHARACTER_DISPLAY,u.PRERENDER_RATIO_CHARACTER_DISPLAY,(!0)),
        f = {
            renderer: m,
            updateList: {
                push: n
            },
            displayList: {
                add: n,
                removeByRef: n
            }
        }
    }
    function s(e) {
        r.call(this, "div", e),
        this.addClassNames("CharacterDisplay"),
        e = e || {},
        this.canvas = this.appendChild(new l),
        this.ctx = this.canvas.getContext("2d"),
        this.entity = null ,
        this.scale = void 0 !== e.scale ? e.scale : 1,
        this._scale = 1 / 0,
        this.only4Directions = !1,
        "fitin" === this.scale ? (this.horizontalAlign = e.horizontalAlign || "left",
        this.verticalAlign = e.verticalAlign || "bottom") : (this.horizontalAlign = e.horizontalAlign || "none",
        this.verticalAlign = e.verticalAlign || "none"),
        this.canvasInitialized = !1,
        this.renderingRequired = !1;
        var t = this;
        window.setTimeout(function() {
            t.rootElement && (t.canvasInitialized = !0,
            t.resize())
        }, 0)
    }
    i(239);
    var a = i(26).inherits
      , r = i(190)
      , l = i(240)
      , c = i(242)
      , u = i(6)
      , h = i(267)
      , d = i(261).Delay
      , p = null
      , m = null
      , f = null
      , g = Math.ceil(512 * u.PIXEL_RATIO)
      , _ = Math.ceil(512 * u.PIXEL_RATIO)
      , v = 2.5;
    a(s, r),
    e.exports = s,
    s.prototype.setLook = function(e, t, i) {
        var n = this;
        if (t = t || {},
        null === this.entity) {
            this.entity = new c({
                scene: f || o()
            });
            var s = t.showSubentities;
            this.entity.showSubentities = null === s || void 0 === s || s
        }
        var a = void 0 !== t.direction ? t.direction : 1;
        t.keepDirection || (this.entity.direction = a),
        t.riderOnly && (e = c.getLookWithoutMount(e));
        var r = !1
          , l = !1
          , u = new d(30,function() {
            l || n.rootElement && (n.addClassNames("spinner"),
            r = !0)
        }
        );
        u.start(!1),
        this.entity.setLook(e, t, function() {
            return l = !0,
            r && n.rootElement && n.delClassNames("spinner"),
            null !== n.entity && n.rootElement ? (1 === e.bonesId && e.skins[0] && n.entity.animManager.addAnimationModifier("AnimStatique", "AnimStatique" + e.skins[0]),
            n.only4Directions = n.entity.animManager.only4Directions,
            t.animation && (n.entity.animSymbol.base = t.animation),
            n._scale = 1 / 0,
            n._render(),
            i && i()) : i && i()
        })
    }
    ,
    s.prototype.release = function() {
        m && (null !== this.entity && (this.entity.remove(),
        this.entity = null ),
        this._scale = 1 / 0,
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height))
    }
    ,
    s.prototype.clear = function() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
    }
    ,
    s.prototype.rotateCharacter = function(e) {
        if (this.canvasInitialized) {
            var t = this.entity.direction;
            return this.only4Directions ? (0 === (1 & t) && (t += 1),
            t += e ? 2 : -2,
            t > 7 && (t = 1),
            t < 0 && (t = 7)) : (t += e ? 1 : -1,
            t > 7 && (t = 0),
            t < 0 && (t = 7)),
            this.entity.direction = t,
            this._render(),
            t
        }
    }
    ,
    s.prototype.resize = function() {
        var e = this.canvas
          , t = parseInt(this.getComputedStyle("width"), 10)
          , i = parseInt(this.getComputedStyle("height"), 10)
          , n = e.width
          , o = e.height;
        e.width = t * u.PIXEL_RATIO,
        e.height = i * u.PIXEL_RATIO,
        e.style.width = t + "px",
        e.style.height = i + "px",
        0 !== e.width && 0 !== e.height && (this.renderingRequired || e.width !== n || e.height !== o) && this._render()
    }
    ,
    s.prototype.setScale = function(e) {
        e !== this.scale && (this.scale = e,
        this._render())
    }
    ,
    s.prototype._computeScale = function(e, t, i, n, o, s) {
        var a;
        if ("cover" === e)
            a = this._scale = Math.min(this._scale, n / Math.abs(s[0]), n / Math.abs(s[1]), o / Math.abs(s[2]), o / Math.abs(s[3]));
        else if ("width" === e)
            a = this._scale = Math.min(this._scale, t / (s[1] - s[0]));
        else if ("height" === e)
            a = this._scale = Math.min(this._scale, i / (s[2] - s[3]));
        else if ("fitin" === e)
            a = this._scale = Math.min(this._scale, t / (s[1] - s[0]), i / (s[2] - s[3])),
            a = Math.min(a, v);
        else if ("%" === e[e.length - 1]) {
            var r = parseFloat(e);
            isNaN(r) ? r = this._scale : r *= .01;
            var l = t / (s[1] - s[0])
              , c = i / (s[2] - s[3])
              , u = l > c ? c : l;
            a = this._scale = r * u,
            a = Math.min(a, v)
        }
        return a || this._scale
    }
    ,
    s.prototype._render = function() {
        if (!this.canvasInitialized)
            return void (this.renderingRequired = !0);
        if (m && this.entity) {
            var e = this.canvas
              , t = e.width
              , i = e.height
              , n = m.gl
              , o = this.entity
              , s = this.scale;
            if (0 === t || 0 === i) {
                var a = this;
                return void window.setTimeout(function() {
                    if (a.resize(),
                    0 === e.width || 0 === e.height)
                        return console.warn("[CharacterDisplay._render] Character display size must be greater than zero.")
                }, 0)
            }
            m.clear(),
            o.x = 0,
            o.y = 0,
            o.scaleX = u.PIXEL_RATIO,
            o.scaleY = -u.PIXEL_RATIO,
            o.updateAnimation(),
            o.refreshAnimation();
            var r = o.bbox;
            if (r[1] < r[0] || r[2] < r[3]) {
                var l = o.animManager.template.id
                  , c = o.animSymbol.base;
                return void console.error(new Error("Entity animation frame is empty, template:" + l + ", animation:" + c))
            }
            var h = .5 * t
              , d = .85 * i;
            "string" == typeof s && (s = this._computeScale(s, t, i, h, d, r)),
            o.scaleX *= s,
            o.scaleY *= s;
            var p = Math.floor(r[0] * s)
              , f = Math.ceil(r[1] * s)
              , g = -Math.floor(r[2] * s)
              , v = -Math.ceil(r[3] * s)
              , y = f - p
              , w = v - g;
            if (0 === y || 0 === w)
                return console.warn("[CharacterDisplay._render] Character to render is of size 0.");
            o.x = -p,
            o.y = v,
            o.render(),
            o.animManager.releaseBuffer();
            var b = new Uint8Array(y * w * 4);
            n.readPixels(0, _ - w, y, w, n.RGBA, n.UNSIGNED_BYTE, b);
            for (var C = this.ctx.createImageData(y, w), I = C.data, T = 0; T < b.length; T++)
                I[T] = b[T];
            var S, A;
            switch (this.horizontalAlign) {
            case "left":
                S = 0;
                break;
            case "center":
                S = (t - y) / 2;
                break;
            case "right":
                S = t - y;
                break;
            default:
                S = h + p
            }
            switch (this.verticalAlign) {
            case "top":
                A = 0;
                break;
            case "center":
                A = (i - w) / 2;
                break;
            case "bottom":
                A = i - w;
                break;
            default:
                A = d + g
            }
            this.ctx.clearRect(0, 0, t, i),
            this.ctx.putImageData(C, S, A)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "canvas", e),
        this.addClassNames("Canvas"),
        this.style = this.rootElement.style
    }
    i(241);
    var o = i(26).inherits
      , s = i(190);
    o(n, s),
    e.exports = n,
    n.prototype.getContext = function(e) {
        return e = e || "2d",
        this.rootElement.getContext(e)
    }
    ,
    Object.defineProperty(n.prototype, "width", {
        get: function() {
            return this.rootElement.width
        },
        set: function(e) {
            this.rootElement.width = e
        }
    }),
    Object.defineProperty(n.prototype, "height", {
        get: function() {
            return this.rootElement.height
        },
        set: function(e) {
            this.rootElement.height = e
        }
    })
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, e, t),
        this.direction = void 0 !== e.direction ? e.direction : 1,
        this.animSymbol = {
            base: "AnimStatique",
            type: null ,
            direction: this.direction
        },
        this.look = null ,
        this.showSubentities = !0
    }
    var o = i(26).inherits
      , s = i(243)
      , a = i(247)
      , r = i(248)
      , l = i(249)
      , c = i(263)
      , u = i(266);
    o(n, s),
    e.exports = n,
    n.prototype.updateAnimation = function() {
        this.animSymbol.direction = this.direction,
        this.animManager.assignSymbol(this.animSymbol, !1)
    }
    ,
    n.prototype.addSubentity = function(e, t, i) {
        if (this.showSubentities) {
            var n = e.subEntityLook;
            if (!n)
                return void console.error(new Error("Subentity has no look: " + Object.keys(e).join(";")));
            var o = n.bonesId + "/motion"
              , s = n.skins
              , r = n.scales[0]
              , u = a.parseIndexedColors(n.indexedColors)
              , h = this;
            t.addToSprite = !1,
            l.loadCharacterAnimationManager(this, o, s, u, r, t, function(t) {
                return h.animManager.addSubentity({
                    animManager: t,
                    bindingPoint: "carried_" + e.bindingPointCategory + "_" + e.bindingPointIndex,
                    symbolModifier: c[e.bindingPointCategory],
                    bindingPointCategory: e.bindingPointCategory
                }),
                i && i(t)
            })
        }
    }
    ,
    n.prototype.addSubentities = function(e, t, i) {
        function n() {
            if (s += 1,
            s === o)
                return i && i()
        }
        if (!e)
            return i && i();
        for (var o = e.length + 1, s = 0, a = 0; a < e.length; a += 1)
            this.addSubentity(e[a], t, n);
        n()
    }
    ,
    n.prototype.setLook = function(e, t, i) {
        function n() {
            return m.clear(!0),
            i && i()
        }
        for (var o = this.look, s = e.scales[0], c = e.skins, u = o && this.look.bonesId === e.bonesId && this.look.skins.length === c.length && this.look.scales[0] === s, h = 0; u && h < c.length; h += 1)
            u = u && c[h] === this.look.skins[h];
        this.look = e;
        var d = a.parseIndexedColors(e.indexedColors);
        if (u)
            return this.animManager.setTints(d),
            this.animManager.cleanupAnimationsAndRemoveSubentities(),
            void this.addSubentities(e.subentities, t, i);
        if (o) {
            var p = new r({
                x: this.x,
                y: this.y,
                position: this.position + 1,
                scene: this.scene
            });
            l.loadAnimationManager(p, "bone", "1165/FX", function(e) {
                e.assignSymbol({
                    base: "FX",
                    direction: 0
                }, !1, function() {
                    p.remove()
                })
            })
        }
        var m = this.animManager;
        l.loadLook(this, e, t, n)
    }
    ;
    var h = u.HOOK_POINT_CATEGORY_MOUNT_DRIVER
      , d = {};
    d[2] = 1,
    d[1084] = 44,
    d[1068] = 113,
    d[1202] = 453,
    d[1575] = 1,
    d[1576] = 1,
    d[2456] = 1107,
    n.getLookWithoutMount = function(e) {
        for (var t = e.subentities, i = 0; i < t.length; i++) {
            var n = t[i];
            if (n.bindingPointCategory === h && 0 === n.bindingPointIndex) {
                e = n.subEntityLook;
                var o = d[e.bonesId];
                return void 0 === o && (o = e.bonesId),
                {
                    _type: "EntityLook",
                    bonesId: o,
                    indexedColors: e.indexedColors,
                    scales: e.scales,
                    skins: e.skins,
                    subentities: e.subentities
                }
            }
        }
        return e
    }
}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, e),
        this.animManager = t || new a(this)
    }
    var o = i(26).inherits
      , s = i(244)
      , a = i(246);
    o(n, s),
    e.exports = n,
    n.prototype.setAnimManager = function(e) {
        this.animManager.switchAnimationManager(e),
        this.animManager = e
    }
    ,
    n.prototype.render = function() {
        this.renderer.save(),
        this.renderer.multiplyColor(this.tint[0], this.tint[1], this.tint[2], this.tint[3]),
        this.renderer.translate(this._x, this._y),
        0 !== this._rotation && this.renderer.rotate(this._rotation),
        this.renderer.scale(this._scaleX, this._scaleY),
        this.animManager.draw(this.renderer),
        this.renderer.restore()
    }
    ,
    n.prototype.remove = function() {
        return this.hide(),
        this.isWhiteListed === !0 ? this.animManager.stop() : void (this._cleared !== !0 && (this._cleared = !0,
        this.animManager.clear()))
    }
    ,
    n.prototype.refreshAnimation = function(e) {
        if (this.isOutdated = !1,
        this.isDisplayed === !1)
            return void 0 !== e && e.push(this.bbox),
            void (this.bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)]);
        var t = this.bbox
          , i = this.animManager.generateCurrentFrameData();
        if (0 === this._rotation)
            this.bbox = [this._x + this._scaleX * (this._scaleX > 0 ? i[0] : i[1]), this._x + this._scaleX * (this._scaleX > 0 ? i[1] : i[0]), this._y + this._scaleY * i[2], this._y + this._scaleY * i[3]];
        else {
            var n = Math.cos(this._rotation)
              , o = Math.sin(this._rotation)
              , s = this._scaleX * i[0]
              , a = this._scaleX * i[1]
              , r = this._scaleY * i[2]
              , l = this._scaleY * i[3]
              , c = n * s - o * r
              , u = o * s + n * r
              , h = n * a - o * r
              , d = o * a + n * r
              , p = n * s - o * l
              , m = o * s + n * l
              , f = n * a - o * l
              , g = o * a + n * l;
            this.bbox = [this._x + Math.min(c, h, p, f), this._x + Math.max(c, h, p, f), this._y + Math.min(u, d, m, g), this._y + Math.max(u, d, m, g)]
        }
        t[0] = Math.floor(Math.min(t[0], this.bbox[0])),
        t[1] = Math.ceil(Math.max(t[1], this.bbox[1])),
        t[2] = Math.floor(Math.min(t[2], this.bbox[2])),
        t[3] = Math.ceil(Math.max(t[3], this.bbox[3])),
        void 0 !== e && e.push(t)
    }
    ,
    n.prototype._refreshAnimation = n.prototype.refreshAnimation
}
, function(e, t, i) {
    function n(e) {
        a.call(this, e),
        this._layer = e.layer || 0,
        this._x = e.x || 0,
        this._y = e.y || 0,
        this._scaleX = e.sx || 1,
        this._scaleY = e.sy || 1,
        this._rotation = e.rotation || 0,
        this._spriteRef = null ,
        this.isDisplayed = !1,
        this.isWhiteListed = !1,
        this.scene = e.scene,
        this.renderer = this.scene.renderer,
        this.updateList = this.scene.updateList,
        this.displayList = this.scene.displayList,
        this.holdsStatics && (this.displayList = this.scene.staticElements),
        e.isHudElement && (this.displayList = this.scene.hudDisplayList),
        this._cleared = !1,
        this.show()
    }
    function o(e) {
        var t = document.createElement("canvas");
        t.width = l,
        t.height = l;
        var i = t.getContext("2d");
        return i.fillStyle = "#FF0000",
        i.fillRect(0, 0, l, l),
        r = e.createTexture(t, null , "nearest", "permanent")
    }
    var s = i(26).inherits
      , a = i(245);
    s(n, a),
    e.exports = n,
    Object.defineProperty(n.prototype, "x", {
        get: function() {
            return this._x
        },
        set: function(e) {
            this._x = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "y", {
        get: function() {
            return this._y
        },
        set: function(e) {
            this._y = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "scaleX", {
        get: function() {
            return this._scaleX
        },
        set: function(e) {
            this._scaleX = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "scaleY", {
        get: function() {
            return this._scaleY
        },
        set: function(e) {
            this._scaleY = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "rotation", {
        get: function() {
            return this._rotation
        },
        set: function(e) {
            this._rotation = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "layer", {
        get: function() {
            return this._layer
        },
        set: function(e) {
            e !== this._layer && (this._layer = e,
            this.isDisplayed && this._show(),
            this.forceRefresh())
        }
    }),
    n.prototype.render = function() {
        this.renderer.save(),
        this.renderer.multiplyColor(this.tint[0], this.tint[1], this.tint[2], this.tint[3]),
        this.renderer.translate(this._x, this._y),
        0 !== this._rotation && this.renderer.rotate(this._rotation),
        this.renderer.scale(this._scaleX, this._scaleY),
        this.draw(this.renderer),
        this.renderer.restore()
    }
    ,
    n.prototype._show = function() {
        null === this._spriteRef ? this._spriteRef = this.displayList.add(this) : this._spriteRef = this.displayList.reposition(this._spriteRef)
    }
    ,
    n.prototype._hide = function() {
        null !== this._spriteRef && (this.displayList.removeByRef(this._spriteRef) || console.warn("[Sprite.remove] Sprite not found in display list", this, this.displayList),
        this._spriteRef = null )
    }
    ,
    n.prototype.show = function() {
        this._show(),
        this.isDisplayed = !0,
        this.forceRefresh()
    }
    ,
    n.prototype.hide = function() {
        this._hide(),
        this.isDisplayed = !1,
        this.forceRefresh()
    }
    ,
    n.prototype.forceRefresh = function() {
        this.isOutdated === !1 && (this.updateList.push(this),
        this.isOutdated = !0)
    }
    ,
    n.prototype.setWhiteListedness = function(e) {
        this.isWhiteListed = e
    }
    ,
    n.prototype.remove = function() {
        if (this.hide(),
        this.isWhiteListed === !1) {
            if (this._cleared === !0)
                return;
            this._cleared = !0,
            this.clear()
        }
    }
    ,
    n.prototype.isWithinBounds = function(e, t) {
        return this.bbox[0] <= e && e <= this.bbox[1] && this.bbox[2] <= t && t <= this.bbox[3]
    }
    ,
    n.prototype.refreshAnimation = function(e) {
        if (this.isOutdated = !1,
        this.isDisplayed === !1)
            return void 0 !== e && e.push(this.bbox),
            void (this.bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)]);
        var t = this.bbox
          , i = this.generateCurrentFrameData();
        if (0 === this._rotation)
            this.bbox = [this._x + this._scaleX * (this._scaleX > 0 ? i[0] : i[1]), this._x + this._scaleX * (this._scaleX > 0 ? i[1] : i[0]), this._y + this._scaleY * i[2], this._y + this._scaleY * i[3]];
        else {
            var n = Math.cos(this._rotation)
              , o = Math.sin(this._rotation)
              , s = this._scaleX * i[0]
              , a = this._scaleX * i[1]
              , r = this._scaleY * i[2]
              , l = this._scaleY * i[3]
              , c = n * s - o * r
              , u = o * s + n * r
              , h = n * a - o * r
              , d = o * a + n * r
              , p = n * s - o * l
              , m = o * s + n * l
              , f = n * a - o * l
              , g = o * a + n * l;
            this.bbox = [this._x + Math.min(c, h, p, f), this._x + Math.max(c, h, p, f), this._y + Math.min(u, d, m, g), this._y + Math.max(u, d, m, g)];
        }
        t[0] = Math.floor(Math.min(t[0], this.bbox[0])),
        t[1] = Math.ceil(Math.max(t[1], this.bbox[1])),
        t[2] = Math.floor(Math.min(t[2], this.bbox[2])),
        t[3] = Math.ceil(Math.max(t[3], this.bbox[3])),
        void 0 !== e && e.push(t)
    }
    ;
    var r = null
      , l = 32;
    n.prototype.draw = function() {
        window.isoEngine.debug && this.renderer.drawImage(r || o(this.renderer), -l / 2, -l / 2, l, l)
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        return [-l / 2, l / 2, -l / 2, l / 2]
    }
    ,
    n.prototype.clear = n.prototype.releaseBuffer = function() {}
}
, function(e, t) {
    function i(e) {
        this.sprite = e,
        this._red = 1,
        this._green = 1,
        this._blue = 1,
        this._alpha = 1
    }
    function n(e) {
        this.id = e.id,
        this._position = e.position || 0,
        this.bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this.renderer = null ,
        this._highlight = new i(this),
        this._hue = e.hue || [1, 1, 1, 1],
        this.tint = this.hue.slice(),
        this._alpha = 1,
        this.alpha = void 0 === e.alpha ? 1 : e.alpha,
        this.isOutdated = !1
    }
    Object.defineProperty(i.prototype, "red", {
        get: function() {
            return this._red
        },
        set: function(e) {
            this._red = e;
            var t = this.sprite;
            t.tint[0] = t.hue[0] * e,
            t.forceRefresh()
        }
    }),
    Object.defineProperty(i.prototype, "green", {
        get: function() {
            return this._green
        },
        set: function(e) {
            this._green = e;
            var t = this.sprite;
            t.tint[1] = t.hue[1] * e,
            t.forceRefresh()
        }
    }),
    Object.defineProperty(i.prototype, "blue", {
        get: function() {
            return this._blue
        },
        set: function(e) {
            this._blue = e;
            var t = this.sprite;
            t.tint[2] = t.hue[2] * e,
            t.forceRefresh()
        }
    }),
    Object.defineProperty(i.prototype, "alpha", {
        get: function() {
            return this._alpha
        },
        set: function(e) {
            this._alpha = e;
            var t = this.sprite;
            t.tint[3] = t.hue[3] * e,
            t.forceRefresh()
        }
    }),
    e.exports = n,
    Object.defineProperty(n.prototype, "position", {
        get: function() {
            return this._position
        },
        set: function(e) {
            e !== this._position && (this._position = e,
            this.isDisplayed && this._show(),
            this.forceRefresh())
        }
    }),
    Object.defineProperty(n.prototype, "hue", {
        get: function() {
            return this._hue
        },
        set: function(e) {
            e !== this._hue && (this._hue = e,
            this.tint[0] = this.hue[0] * this._highlight.red,
            this.tint[1] = this.hue[1] * this._highlight.green,
            this.tint[2] = this.hue[2] * this._highlight.blue,
            this.tint[3] = this.hue[3] * this._highlight.alpha * this._alpha,
            this.isDisplayed && this._show(),
            this.forceRefresh())
        }
    }),
    Object.defineProperty(n.prototype, "highlight", {
        get: function() {
            return this._highlight
        },
        set: function(e) {
            this.setHighlight(e)
        }
    }),
    Object.defineProperty(n.prototype, "alpha", {
        get: function() {
            return this._alpha
        },
        set: function(e) {
            e !== this._alpha && (this._alpha = e,
            this.tint[3] = this.hue[3] * this._highlight.alpha * this._alpha,
            this.forceRefresh())
        }
    }),
    n.prototype.setHighlight = function(e) {
        return null === e ? void this.removeHighlight() : (this._highlight._red = e.red,
        this._highlight._green = e.green,
        this._highlight._blue = e.blue,
        this._highlight._alpha = e.alpha,
        this.tint[0] = this.hue[0] * e.red,
        this.tint[1] = this.hue[1] * e.green,
        this.tint[2] = this.hue[2] * e.blue,
        this.tint[3] = this.hue[3] * e.alpha * this._alpha,
        void this.forceRefresh())
    }
    ,
    n.prototype.removeHighlight = function() {
        this.tint[0] = this.hue[0],
        this.tint[1] = this.hue[1],
        this.tint[2] = this.hue[2],
        this.tint[3] = this.hue[3] * this._alpha,
        this.forceRefresh()
    }
    ,
    n.prototype.forceRefresh = function() {}
}
, function(e, t) {
    function i(e) {
        this.sprite = e,
        this.hasSubentities = !1,
        this.subentities = [],
        this.animationModifiers = {}
    }
    function n(e) {
        var t = document.createElement("canvas");
        t.width = s,
        t.height = s;
        var i = t.getContext("2d");
        return i.fillStyle = "#FF0000",
        i.fillRect(0, 0, s, s),
        o = e.createTexture(t, null , "nearest", "permanent")
    }
    e.exports = i,
    i.prototype.isTemporary = !0,
    i.prototype.switchAnimationManager = function(e) {
        e.hasSubentities = this.hasSubentities,
        e.subentities = this.subentities,
        e.animationModifiers = this.animationModifiers
    }
    ,
    i.prototype.addSubentity = function(e) {
        this.subentities.push(e),
        this.hasSubentities = !0
    }
    ,
    i.prototype.removeSubentity = function(e) {
        var t = this.subentities.indexOf(e);
        return t === -1 ? console.error("Subentity does not exist.") : (e.animManager.cleanupAnimations(),
        this.subentities.splice(t, 1),
        void (this.hasSubentities = this.subentities.length > 0))
    }
    ,
    i.prototype.addAnimationModifier = function(e, t) {
        this.animationModifiers[e] = t
    }
    ,
    i.prototype.removeAnimationModifier = function(e) {
        delete this.animationModifiers[e]
    }
    ,
    i.prototype.cleanupAnimations = function() {
        for (var e = 0; e < this.subentities.length; e++)
            this.subentities[e].animManager.cleanupAnimations()
    }
    ,
    i.prototype.cleanupAnimationsAndRemoveSubentities = function() {
        for (var e = 0; e < this.subentities.length; e++)
            this.subentities[e].animManager.cleanupAnimations();
        this.subentities = [],
        this.hasSubentities = !1
    }
    ;
    var o = null
      , s = 32;
    i.prototype.draw = function() {
        window.isoEngine.debug && this.sprite.renderer.drawImage(o || n(this.sprite.renderer), -s / 2, -s / 2, s, s)
    }
    ,
    i.prototype.generateCurrentFrameData = function() {
        return [-s / 2, s / 2, -s / 2, s / 2]
    }
    ,
    i.prototype.assignSymbol = function(e, t, i) {
        return console.warn("Attempt to call abstract method TemporaryAnimationManager.assignSymbol", e),
        i && i()
    }
    ,
    i.prototype.getSymbolDuration = function() {
        return 0
    }
    ,
    i.prototype.clear = i.prototype.stop = i.prototype.releaseBuffer = i.prototype.addAnimation = i.prototype.applyAnimationModifier = i.prototype.setTints = i.prototype.prepareCurrentAnimationFrame = function() {}
}
, function(e, t) {
    function i(e, t) {
        var i = e.toString(16).toUpperCase();
        if (t)
            for (; i.length < t; )
                i = "0" + i;
        return i
    }
    function n(e) {
        var t = i(e[0], 2)
          , n = i(e[1], 2)
          , o = i(e[2], 2);
        return "#" + t + n + o
    }
    function o(e) {
        return e = e.substr(1),
        3 === e.length ? [parseInt(e[0] + e[0], 16) / 255, parseInt(e[1] + e[1], 16) / 255, parseInt(e[2] + e[2], 16) / 255, 1] : [parseInt(e.substr(0, 2), 16) / 255, parseInt(e.substr(2, 2), 16) / 255, parseInt(e.substr(4, 2), 16) / 255, 1]
    }
    function s(e) {
        var t = e.indexOf("(")
          , i = e.indexOf(",")
          , n = e.indexOf(",", i + 1)
          , o = e.indexOf(",", n + 1)
          , s = e.indexOf(")", o + 1);
        return [parseInt(e.substr(t + 1, i), 10) / 255, parseInt(e.substr(i + 1, n), 10) / 255, parseInt(e.substr(n + 1, o), 10) / 255, parseFloat(e.substr(o + 1, s))]
    }
    function a(e) {
        var t = (251658240 & e) >> 24
          , i = (16711680 & e) >> 16
          , n = (65280 & e) >> 8
          , o = 255 & e;
        return {
            index: t,
            color: {
                r: i,
                g: n,
                b: o
            }
        }
    }
    function r(e, t) {
        return e + (t << 24)
    }
    function l(e) {
        for (var t = [], i = 0; i < e.length; i++)
            t.push(r(e[i], i + 1));
        return t
    }
    function c(e) {
        if ("string" == typeof e) {
            if (0 === e.indexOf("#"))
                return o(e);
            if (0 === e.indexOf("rgba("))
                return s(e)
        }
        return e
    }
    function u(e) {
        var t = null ;
        if (e && e.length > 0) {
            t = [null , null , null , null , null , null ];
            for (var i = 0; i < e.length; i++) {
                var n = a(e[i]);
                t[n.index] = n.color
            }
        }
        return t
    }
    function h(e, t, i, n) {
        var o = 0;
        return o |= (15 & e) << 24,
        o |= (255 & t) << 16,
        o |= (255 & i) << 8,
        o |= 255 & n
    }
    function d(e) {
        var t = parseInt(e, 16);
        if (6 === e.length)
            return {
                r: (16711680 & t) >> 16,
                g: (65280 & t) >> 8,
                b: 255 & t
            };
        if (3 === e.length) {
            var i = (3840 & t) >> 8
              , n = (240 & t) >> 4
              , o = 15 & t;
            return {
                r: i + (i << 4),
                g: n + (n << 4),
                b: o + (o << 4)
            }
        }
        return console.warn("[hexToRgb] Invalid hex value"),
        null
    }
    t.colorArrayToHexa = n,
    t.hexToColorArray = o,
    t.rgbaToColorArray = s,
    t.parseIndexedColor = a,
    t.addIndex = r,
    t.addIndexes = l,
    t.anyToColorArray = c,
    t.parseIndexedColors = u,
    t.getIndexedColor = h,
    t.hexToRgb = d
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e, e.animManager),
        this.offsetY = e.offsetY || 0
    }
    var o = i(26).inherits
      , s = i(243);
    o(n, s),
    e.exports = n,
    n.prototype.isFx = !0
}
, function(e, t, i) {
    function n(e, t, i) {
        this.type = e,
        this.id = t,
        this.usage = i || ""
    }
    function o(e, i, n, o, a, r) {
        var l = i.subEntityLook
          , c = l.bonesId + "/motion"
          , h = l.skins
          , d = l.scales[0]
          , p = s.parseIndexedColors(l.indexedColors);
        t.loadCharacterAnimationManager(e, c, h, p, d, a, function(t) {
            o[n] = t,
            i.bindingPointCategory === u && (e.riderEntity = t),
            r()
        })
    }
    var s = i(247)
      , a = i(250)
      , r = i(260)
      , l = i(263)
      , c = i(266)
      , u = c.HOOK_POINT_CATEGORY_MOUNT_DRIVER;
    t.loadCharacterAnimationManager = function(e, t, i, o, s, l, c) {
        function u(i) {
            for (var n = i[0], a = i.length - 1, l = 1; l <= a; l += 1) {
                var u = i[l];
                n.merge(u, !0)
            }
            var h = t.split("/")[0]
              , d = new r(e,n,s ? s / 100 : 1,h,o);
            return m !== !1 && e.setAnimManager(d),
            c && c(d)
        }
        l = l || {};
        var h = [];
        h.push(new n("bone",t,l.boneType));
        for (var d = i.length, p = 0; p < d; p += 1)
            h.push(new n("skin",i[p],l.skinType));
        var m = l.addToSprite
          , f = l.textureCache || e.renderer;
        a.loadTemplates(h, u, f, "archivable")
    }
    ,
    t.loadAnimationManager = function(e, t, i, n) {
        function o(t) {
            var o = "string" == typeof i ? i.split("/").shift() : i
              , s = new r(e,t,1,o);
            return e.setAnimManager(s),
            n && n(s)
        }
        var s = e.renderer;
        a.loadTemplate(t, i, "", o, s, "archivable")
    }
    ,
    t.loadLook = function(e, i, n, a) {
        function r() {
            if (p += 1,
            p === m) {
                for (var e = 0; e < d; e += 1) {
                    var t = h[e];
                    c.addSubentity({
                        animManager: u[e],
                        bindingPoint: "carried_" + t.bindingPointCategory + "_" + t.bindingPointIndex,
                        symbolModifier: l[t.bindingPointCategory],
                        bindingPointCategory: t.bindingPointCategory
                    })
                }
                return a & a(c)
            }
        }
        n = n || {};
        var c = null
          , u = []
          , h = e.showSubentities ? i.subentities : null
          , d = h ? h.length : 0
          , p = 0
          , m = 2 + d
          , f = i.bonesId + "/motion"
          , g = i.skins
          , _ = s.parseIndexedColors(i.indexedColors)
          , v = i.scales[0];
        t.loadCharacterAnimationManager(e, f, g, _, v, n, function(e) {
            c = e,
            r()
        }),
        n.addToSprite = !1;
        for (var y = 0; y < d; y += 1)
            o(e, h[y], y, u, n, r);
        r()
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        this.symbols = e,
        this.matrices = t,
        this.colors = i
    }
    function o(e, t, i) {
        if (t === a.EMPTY_JSON)
            return w;
        var o, s, r, l = !!t.symbols, c = {};
        l ? (s = new n(c,t.matrices,t.colors),
        r = d,
        o = t.symbols) : (s = c,
        r = p,
        o = t);
        for (var u = Object.keys(o), m = 0; m < u.length; m += 1) {
            var f = u[m]
              , g = o[f];
            g.isGraphic && (c[f] = new h(g,s,i)),
            g.isAnim && (c[f] = new r(g,s,i))
        }
        return v.addAndHoldElement(s, 1, e)
    }
    function s(e, t, i, n) {
        var o = !!n.element.symbols
          , s = o ? new m(t) : new f(t);
        return s.generateTemplate(i, n),
        u.createAnimSoundGroups(s.getAnimationSounds(t), "sfx"),
        s
    }
    var a = i(6)
      , r = i(251)
      , l = i(5)
      , c = i(253)
      , u = i(84)
      , h = i(254)
      , d = i(255)
      , p = i(256)
      , m = i(257)
      , f = i(259)
      , g = {
        skin: a.SKIN_PATH,
        bone: a.BONE_PATH,
        icon: a.ICON_PATH,
        ornaments: a.ORNAMENT_PATH,
        embedded: a.EMBEDDED_PATH,
        loader: a.LOADER_PATH
    }
      , _ = {
        skin: "mipmap",
        bone: "mipmap",
        icon: "linear",
        ornaments: "linear",
        embedded: "linear",
        loader: "linear"
    }
      , v = new r(a.MAX_ANIMATIONS)
      , y = {};
    t.loadMissingTemplatesInfo = function() {
        l.loadJson(a.MISSING_ANIM_PATH, function(e) {
            for (var t = 0; t < e.length; t++)
                y[e[t]] = !0
        })
    }
    ;
    var w = {
        element: new n({},[],[]),
        release: function() {}
    };
    t.loadTemplate = function(e, t, i, n, a, r) {
        function u(i) {
            if (m = i,
            I += 1,
            I === T) {
                S = o(C, m, p);
                var a = s(e, t, p, S);
                return n && n(a)
            }
        }
        function h(i) {
            if (p = i,
            I += 1,
            I === T) {
                void 0 === S && (S = o(C, m, p));
                var a = s(e, t, p, S);
                return n && n(a)
            }
        }
        if (y[t]) {
            var d = a.getEmptyTexture();
            return n && n(s(e, t, d, w))
        }
        var p, m, f = g[e] + i + t, b = f + ".png", C = f + ".json", I = 0, T = 1, S = v.holdElement(C);
        void 0 === S && (T += 1,
        l.loadJson(C, u)),
        c.loadTexture(b, h, a, _[e], r)
    }
    ,
    t.loadTemplates = function(e, t, i, n) {
        function a(i, n) {
            var a = C[n]
              , r = u[a];
            if (void 0 === r)
                d[a] = i;
            else {
                var l = f[a]
                  , c = o(l, i, r);
                h[a] = c;
                var m = e[a];
                p[a] = s(m.type, m.id, r, c)
            }
            if (T += 1,
            T === S)
                return t && t(p)
        }
        function r(i, n) {
            u[n] = i;
            var a, r, l = d[n];
            if (void 0 === l)
                a = h[n],
                void 0 !== a && (r = e[n],
                p[n] = s(r.type, r.id, i, a));
            else {
                var c = f[n];
                a = o(c, l, i),
                r = e[n],
                p[n] = s(r.type, r.id, i, a)
            }
            if (T += 1,
            T === S)
                return t && t(p)
        }
        for (var u = [], h = [], d = [], p = [], m = [], f = [], b = [], C = [], I = e.length, T = 0, S = 0, A = 0; A < I; A += 1) {
            var E = e[A]
              , x = E.type
              , M = E.id;
            if (y[M]) {
                var N = i.getEmptyTexture();
                p[A] = s(x, M, N, w)
            } else {
                var R = g[x] + E.usage + M
                  , O = R + ".png"
                  , P = R + ".json";
                m.push(O),
                f.push(P),
                S += 1;
                var D = v.holdElement(P);
                void 0 === D ? (b.push(P),
                C.push(A),
                S += 1) : h[A] = D
            }
        }
        var L = _[e[0].type];
        c.loadTextures(m, r, null , i, L, n),
        l.loadJsons(b, a, null )
    }
}
, function(e, t, i) {
    function n(e, t, i, n, o) {
        this.id = n,
        this.cache = e,
        this.element = t,
        this.memorySize = i,
        this.type = a[o],
        this.nLocks = 0,
        this.reference = null ,
        this.attachment = null
    }
    function o(e, t) {
        this.elementsById = {},
        this.actives = new s,
        this.archives = new s,
        this.memoryUsed = 0,
        this.memoryAllocated = e,
        this.onElementRemoved = t || null ,
        this.unidentifiedElementsCount = 0,
        this.addCount = 0,
        this.removeCount = 0
    }
    var s = i(252)
      , a = {
        permanent: 0,
        archivable: 1,
        throwable: 2
    };
    n.prototype.isPermanent = function() {
        return this.type === a.permanent
    }
    ,
    n.prototype._hold = function() {
        return this.type === a.permanent ? this : (this.nLocks += 1,
        this.cache._holdElement(this),
        this)
    }
    ,
    n.prototype.release = function() {
        return this.type === a.permanent ? this : (this.nLocks -= 1,
        void (0 === this.nLocks ? this.cache._releaseElement(this) : this.nLocks < 0 && console.error(new Error("[ElementHandle.release] Number of locks is negative: " + this.id))))
    }
    ,
    n.prototype.isFree = function() {
        return 0 === this.nLocks
    }
    ,
    e.exports = o,
    o.prototype._clean = function() {
        for (var e = this.archives.first; null !== e && this.memoryUsed > this.memoryAllocated; ) {
            var t = e.object;
            e = e.next,
            t.nLocks <= 0 && this._removeElement(t)
        }
    }
    ,
    o.prototype.log = function() {
        console.log("***** Cache Stats *****"),
        console.log("  Actives", this.actives.length),
        console.log("  Archives", this.archives.length),
        console.log("  Total", Object.keys(this.elementsById).length),
        console.log("  Usage (units)", this.memoryUsed),
        console.log("  Usage (percentage)", (100 * this.memoryUsed / this.memoryAllocated).toFixed(0), "%"),
        console.log("  Elements", this.elementsById)
    }
    ,
    o.prototype._holdElement = function(e) {
        e.type !== a.permanent && (e.reference.container === this.actives ? this.actives.moveToTheEnd(e.reference) : (this.archives.removeByReference(e.reference),
        e.reference = this.actives.addBack(e)))
    }
    ,
    o.prototype._releaseElement = function(e) {
        this._archiveElement(e)
    }
    ,
    o.prototype._archiveElement = function(e) {
        return e.reference.container !== this.actives ? void console.warn("[Cache3State.archiveElement] The element cannot be archived:", e.id) : void (e.type === a.throwable ? this._removeElement(e) : (this.actives.removeByReference(e.reference),
        e.reference = this.archives.addBack(e),
        this._clean()))
    }
    ,
    o.prototype._addElement = function(e) {
        this.elementsById[e.id] = e,
        this.memoryUsed += e.memorySize,
        this._clean(),
        e.type !== a.permanent && (e.reference = this.actives.addBack(e)),
        this.addCount += 1
    }
    ,
    o.prototype.addAndHoldElement = function(e, t, i, o, s) {
        var r = Boolean(i);
        r === !1 && (i = "unidentified" + String(this.unidentifiedElementsCount++)),
        void 0 !== o && null !== o || (o = r ? "archivable" : "throwable");
        var l = this.elementsById[i];
        if (void 0 !== l) {
            if (!s)
                return l.type !== a[o] && console.warn("[Cache3State.addElement] Trying to change type of an exisiting element", i),
                l._hold();
            if (l.isFree() === !1)
                return console.warn("[Cache3State.addElement] Trying to replace a locked element", i),
                l._hold();
            this._removeElement(l)
        }
        return l = new n(this,e,t,i,o),
        this._addElement(l),
        l._hold()
    }
    ,
    o.prototype.holdElement = function(e) {
        var t = this.elementsById[e];
        if (void 0 !== t)
            return t._hold()
    }
    ,
    o.prototype.useElement = function(e) {
        var t = this.elementsById[e];
        if (void 0 !== t)
            return t
    }
    ,
    o.prototype._removeElement = function(e) {
        delete this.elementsById[e.id],
        this.memoryUsed -= e.memorySize,
        e.type !== a.permanent && (e.reference.container === this.actives ? e.reference = this.actives.removeByReference(e.reference) : e.reference = this.archives.removeByReference(e.reference)),
        null !== this.onElementRemoved && this.onElementRemoved(e.element),
        this.removeCount += 1
    }
}
, function(e, t) {
    function i(e, t, i, n) {
        this.object = e,
        this.previous = t,
        this.next = i,
        this.container = n
    }
    function n() {
        this.first = null ,
        this.last = null ,
        this.length = 0
    }
    e.exports = n,
    n.prototype.addFront = function(e) {
        var t = new i(e,null ,this.first,this);
        return null === this.first ? (this.first = t,
        this.last = t) : (this.first.previous = t,
        this.first = t),
        this.length += 1,
        t
    }
    ,
    n.prototype.add = n.prototype.addFront,
    n.prototype.addBack = function(e) {
        var t = new i(e,this.last,null ,this);
        return null === this.first ? (this.first = t,
        this.last = t) : (this.last.next = t,
        this.last = t),
        this.length += 1,
        t
    }
    ,
    n.prototype.popFront = function() {
        var e = this.first.object;
        return this.removeByReference(this.first),
        e
    }
    ,
    n.prototype.pop = n.prototype.popFront,
    n.prototype.popBack = function() {
        var e = this.last.object;
        return this.removeByReference(this.last),
        e
    }
    ,
    n.prototype.addBefore = function(e, t) {
        var n = new i(t,e.previous,e,this);
        return null !== e.previous && (e.previous.next = n),
        e.previous = n,
        this.first === e && (this.first = n),
        this.length += 1,
        n
    }
    ,
    n.prototype.addAfter = function(e, t) {
        var n = new i(t,e,e.next,this);
        return null !== e.next && (e.next.previous = n),
        e.next = n,
        this.last === e && (this.last = n),
        this.length += 1,
        n
    }
    ,
    n.prototype.moveToTheBeginning = function(e) {
        return !(!e || e.container !== this) && (null === e.previous || (e.previous.next = e.next,
        this.last === e ? this.last = e.previous : e.next.previous = e.previous,
        e.previous = null ,
        e.next = this.first,
        e.next.previous = e,
        this.first = e,
        !0))
    }
    ,
    n.prototype.moveToTheEnd = function(e) {
        return !(!e || e.container !== this) && (null === e.next || (e.next.previous = e.previous,
        this.first === e ? this.first = e.next : e.previous.next = e.next,
        e.next = null ,
        e.previous = this.last,
        e.previous.next = e,
        this.last = e,
        !0))
    }
    ,
    n.prototype.removeByReference = function(e) {
        return e.container !== this ? (console.warn("[DoublyList.removeByReference] Trying to remove a node that does not belong to the list"),
        e) : (null === e.next ? this.last = e.previous : e.next.previous = e.previous,
        null === e.previous ? this.first = e.next : e.previous.next = e.next,
        e.container = null ,
        this.length -= 1,
        null )
    }
    ,
    n.prototype.remove = function(e) {
        for (var t = this.first; null !== t; t = t.next)
            if (t.object === e)
                return this.removeByReference(t),
                !0;
        return !1
    }
    ,
    n.prototype.clear = function() {
        for (var e = this.first; null !== e; e = e.next)
            e.container = null ;
        this.first = null ,
        this.last = null ,
        this.length = 0
    }
    ,
    n.prototype.forEach = function(e, t) {
        for (var i = this.first; i; i = i.next)
            e(i.object, t)
    }
    ,
    n.prototype.toArray = function() {
        for (var e = [], t = this.first; null !== t; t = t.next)
            e.push(t.object);
        return e
    }
}
, function(e, t, i) {
    var n = i(6)
      , o = i(5);
    t.loadTexture = function(e, t, i, s, a) {
        var r = i.holdTexture(e);
        return r ? void t(r) : void o.loadImage(e, function(o) {
            var r;
            r = o === n.EMPTY_IMAGE ? i.getEmptyTexture() : i.createTexture(o, e, s, a),
            t(r)
        })
    }
    ,
    t.loadTextures = function(e, t, i, s, a, r) {
        for (var l = [], c = [], u = e.length, h = 0; h < u; h += 1) {
            var d = e[h]
              , p = s.holdTexture(d);
            p ? t(p, h) : (l.push(d),
            c.push(h))
        }
        return 0 === l.length ? i && i() : void o.loadImages(l, function(e, i) {
            var o, u = l[i];
            o = e === n.EMPTY_IMAGE ? s.getEmptyTexture() : s.createTexture(e, u, a, r),
            t(o, c[i])
        }, i)
    }
}
, function(e, t) {
    function i(e, t, i) {
        this.vertexPos = [e.x, e.y, e.x + e.w, e.y + e.h],
        this.textureCoord = [e.sx / i.element.width, e.sy / i.element.height, (e.sx + e.sw) / i.element.width, (e.sy + e.sh) / i.element.height],
        this.id = e.id,
        this.tint = e.tint,
        this.texture = i,
        this.className = e.className,
        this.nbFrames = 1,
        this.animationData = t
    }
    i.prototype.isGraphic = !0,
    e.exports = i
}
, function(e, t) {
    function i(e) {
        this.id = e.id,
        this.matrices = e.matrices,
        this.colors = e.colors,
        this.frames = e.frames,
        this.maskStart = e.maskStart || !1,
        this.maskEnd = e.maskEnd || !1
    }
    function n(e, t) {
        var n = e.children;
        this.children = [];
        for (var o = 0, s = 0; s < n.length; s += 1) {
            var a = n[s];
            this.children.push(new i(a)),
            o < a.frames[1] && (o = a.frames[1])
        }
        this.id = e.id,
        this.duration = e.duration,
        this.className = e.className,
        this.sounds = e.sounds,
        this.nbFrames = o + 1,
        this.animationData = t
    }
    n.prototype.isAnim = !0,
    e.exports = n
}
, function(e, t, i) {
    function n(e, t, i) {
        var n = e.frames;
        this.frames = [];
        for (var s = 0; s < n.length; s += 1)
            this.frames.push(new o(n[s].position,t,i));
        this.id = e.id,
        this.className = e.className,
        this.sounds = e.sounds,
        this.duration = e.duration,
        this.nbFrames = this.frames.length,
        this.animationData = t
    }
    var o = i(254);
    n.prototype.isAnim = !0,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        this._id = e,
        c.call(this, e),
        this.externalSymbols = {},
        this.mergedTemplates = {},
        this.mergedSymbols = {},
        this.matrices = [],
        this.colors = [],
        this.only4Directions = !1
    }
    function o(e, t, i, n) {
        this.color = n,
        this.texture = e,
        this.vertexPos = t,
        this.textureCoord = i
    }
    function s(e) {
        this.id = e
    }
    function a(e) {
        this.id = e
    }
    function r(e) {
        this.id = e
    }
    var l = i(252)
      , c = i(258)
      , u = i(26).inherits;
    u(n, c),
    e.exports = n,
    n.prototype._updateId = function() {
        this.id = this._id;
        for (var e = Object.keys(this.mergedTemplates), t = 0; t < e.length; t += 1)
            this.id += "#" + this.mergedTemplates[e[t]].id;
        for (e = Object.keys(this.parentTemplates),
        t = 0; t < e.length; t += 1)
            this.parentTemplates[e[t]]._updateId()
    }
    ,
    n.prototype.clear = function() {
        c.prototype.clear.call(this);
        for (var e = Object.keys(this.mergedTemplates), t = 0; t < e.length; t += 1)
            this.mergedTemplates[e[t]].clear()
    }
    ,
    n.prototype.merge = function(e, t) {
        var i = e.name
          , n = {};
        this.mergedSymbols[i] = n,
        this.mergedTemplates[i] = e,
        e.parentTemplates[this.name] = this;
        var o = e.exposedSymbols;
        for (var s in o) {
            var a = o[s]
              , r = this.externalSymbols[a.className];
            r || (r = new l,
            this.externalSymbols[a.className] = r),
            n[a.className] = t ? r.addBack(a) : r.addFront(a)
        }
        return this._updateId(),
        i
    }
    ,
    n.prototype.unmerge = function(e) {
        var t = e.name
          , i = this.mergedSymbols[t];
        if (i) {
            for (var n in i) {
                var o = this.externalSymbols[n];
                o.removeByReference(i[n]),
                0 === o.length && delete this.externalSymbols[n]
            }
            delete e.parentTemplates[this.name],
            delete this.mergedTemplates[t],
            delete this.mergedSymbols[t],
            e.clear(),
            this._updateId()
        }
    }
    ,
    n.prototype.generateTemplate = function(e, t) {
        this.animationHandle = t;
        var i = t.element;
        this.texture = e,
        this.symbols = i.symbols,
        this.matrices = i.matrices,
        this.colors = i.colors;
        for (var n = Object.keys(this.symbols), o = 0; o < n.length; o += 1) {
            var s = this.symbols[n[o]];
            s.className && (this.exposedSymbols[s.className] = s)
        }
        this.isEmpty = 0 === n.length
    }
    ,
    n.prototype.getSymbol = function(e) {
        var t = this.exposedSymbols[e];
        return t ? t : (t = this.externalSymbols[e],
        t ? t.last.object : null )
    }
    ,
    s.prototype.isMaskTag = !0,
    s.prototype.isMaskDef = !0,
    a.prototype.isMaskTag = !0,
    a.prototype.isMaskUse = !0,
    r.prototype.isMaskTag = !0,
    r.prototype.isMaskStop = !0,
    n.prototype.createSprites = function(e, t, i, n, l, c, u) {
        if (void 0 === i)
            return [];
        var h, d, p, m, f, g, _, v, y, w, b, C, I, T = i.animationData, S = T.matrices[e.matrices[t]], A = T.colors[e.colors[t]], E = S[0], x = S[1], M = S[2], N = S[3], R = S[4] * l, O = S[5] * c, P = A[0], D = A[1], L = A[2], B = A[3], k = A[4], F = A[5], H = A[6], G = A[7];
        if (i.className) {
            if (u[i.className]) {
                var U = u[i.className];
                U.mirrored && (E = -E,
                x = -x),
                f = U.prepareCurrentAnimationFrame();
                var j = []
                  , q = f.length;
                for (p = 0; p < q; p += 1)
                    m = f[p],
                    j.push(m),
                    m.isMaskTag || (d = m.color,
                    m.color = [d[0] * P, d[1] * D, d[2] * L, d[3] * B, d[4] * P + k, d[5] * D + F, d[6] * L + H, d[7] * B + G],
                    h = m.vertexPos,
                    g = h[0],
                    _ = h[1],
                    v = h[2],
                    y = h[3],
                    w = h[4],
                    b = h[5],
                    C = h[6],
                    I = h[7],
                    m.vertexPos = [E * g + M * _ + R, x * g + N * _ + O, E * v + M * y + R, x * v + N * y + O, E * w + M * b + R, x * w + N * b + O, E * C + M * I + R, x * C + N * I + O]);
                return j
            }
            var W = this.externalSymbols[i.className];
            W && W.length > 0 && (i = W.last.object,
            T = i.animationData)
        }
        if (E *= l,
        x *= c,
        M *= l,
        N *= c,
        i.isGraphic) {
            if (d = [P, D, L, B, k, F, H, G],
            void 0 !== i.tint) {
                var V = n[i.tint] || {
                    r: 1,
                    g: 1,
                    b: 1
                };
                d[0] *= V.r,
                d[1] *= V.g,
                d[2] *= V.b
            }
            var z = i.vertexPos;
            return g = z[0],
            _ = z[1],
            v = z[2],
            y = z[3],
            h = [E * g + M * _ + R, x * g + N * _ + O, E * v + M * _ + R, x * v + N * _ + O, E * g + M * y + R, x * g + N * y + O, E * v + M * y + R, x * v + N * y + O],
            [new o(i.texture,h,i.textureCoord,d)]
        }
        if (i.isAnim) {
            t %= i.nbFrames;
            for (var Y, X, Q, K, J, Z, $, ee, te = [], ie = i.children, ne = ie.length - 1; ne >= 0; ne -= 1) {
                var oe = ie[ne];
                if (!(t < oe.frames[0] || t > oe.frames[1]))
                    if (oe.maskEnd)
                        te.push(new r(oe.id));
                    else {
                        for (oe.maskStart && te.push(new s(oe.id)),
                        f = this.createSprites(oe, t - oe.frames[0], T.symbols[oe.id], n, 1, 1, u),
                        p = 0; p < f.length; p += 1)
                            m = f[p],
                            te.push(m),
                            m.isMaskTag || (h = m.vertexPos,
                            Y = h[0],
                            X = h[1],
                            Q = h[2],
                            K = h[3],
                            J = h[4],
                            Z = h[5],
                            $ = h[6],
                            ee = h[7],
                            h[0] = E * Y + M * X + R,
                            h[1] = x * Y + N * X + O,
                            h[2] = E * Q + M * K + R,
                            h[3] = x * Q + N * K + O,
                            h[4] = E * J + M * Z + R,
                            h[5] = x * J + N * Z + O,
                            h[6] = E * $ + M * ee + R,
                            h[7] = x * $ + N * ee + O,
                            d = m.color,
                            d[0] *= P,
                            d[1] *= D,
                            d[2] *= L,
                            d[3] *= B,
                            d[4] = d[4] * P + k,
                            d[5] = d[5] * D + F,
                            d[6] = d[6] * L + H,
                            d[7] = d[7] * B + G);
                        oe.maskStart && te.push(new a(oe.id))
                    }
            }
            return te
        }
        return []
    }
    ,
    n.prototype.prepareAnimationFrame = function(e, t, i, n, l, c) {
        var u = this.getSymbol(e);
        if (!u)
            return console.warn("Symbol " + e + " not registered in character's template"),
            [];
        var h = u.animationData;
        if (u.isGraphic) {
            var d = u.vertexPos
              , p = [d[0], d[1], d[2], d[1], d[0], d[3], d[2], d[3]];
            return [new o(u.texture,p,u.textureCoord,[1, 1, 1, 1, 0, 0, 0, 0])]
        }
        for (var m = [], f = u.children, g = f.length - 1; g >= 0; g -= 1) {
            var _ = f[g];
            if (_.frames[0] <= t && t <= _.frames[1]) {
                if (_.maskEnd) {
                    m.push(new r(_.id));
                    continue
                }
                var v = this.createSprites(_, t - _.frames[0], h.symbols[_.id], i, n, l, c);
                _.maskStart ? (m.push(new s(_.id)),
                Array.prototype.push.apply(m, v),
                m.push(new a(_.id))) : Array.prototype.push.apply(m, v)
            }
        }
        return m
    }
}
, function(e, t) {
    function i(e) {
        this.id = e,
        this.name = "t" + n++,
        this.exposedSymbols = {},
        this.texture = null ,
        this.animationHandle = null ,
        this.symbols = {},
        this.parentTemplates = {},
        this.isEmpty = !0
    }
    var n = 0;
    e.exports = i,
    i.prototype.getFullId = function() {
        return this.id
    }
    ,
    i.prototype.clear = function() {
        this.texture && this.texture.release(),
        this.animationHandle && this.animationHandle.release()
    }
    ,
    i.prototype.merge = function() {}
    ,
    i.prototype.unmerge = function() {}
    ,
    i.prototype.generateTemplate = function() {}
    ,
    i.prototype.getSymbol = function(e) {
        var t = this.exposedSymbols[e];
        return t ? t : null
    }
    ,
    i.prototype.hasAnimation = function(e) {
        return !!this.getSymbol(e)
    }
    ,
    i.prototype.getAnimationNbFrames = function(e) {
        var t = this.getSymbol(e);
        return t ? t.nbFrames : (console.warn("Symbol " + e + " not registered in character's template"),
        0)
    }
    ,
    i.prototype.getAnimationDuration = function(e) {
        var t = this.getSymbol(e);
        return t ? t.duration : (console.warn("Symbol " + e + " not registered in character's template"),
        0)
    }
    ,
    i.prototype.getAnimationFrameSound = function(e, t) {
        var i = this.getSymbol(e);
        return i ? i.sounds ? i.sounds[t] : null : (console.warn("Symbol " + e + " not registered in character's template"),
        null )
    }
    ,
    i.prototype.getAnimationSounds = function(e) {
        var t = "string" == typeof e ? e.split("/").shift() : e
          , i = {};
        for (var n in this.exposedSymbols) {
            var o = this.exposedSymbols[n]
              , s = o.sounds;
            if (s)
                for (var a in s)
                    i[t + "/" + n + ":" + a] = s[a]
        }
        return i
    }
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e)
    }
    function o(e, t, i, n) {
        this.color = n,
        this.texture = e,
        this.vertexPos = t,
        this.textureCoord = i
    }
    var s = i(258)
      , a = i(26).inherits;
    a(n, s),
    e.exports = n,
    n.prototype.merge = function() {
        console.error(new Error("[AtlasAnimationTemplate.merge]It is not possible to merge a template with an atlas template"))
    }
    ,
    n.prototype.unmerge = function() {
        console.error(new Error("[AtlasAnimationTemplate.merge]It is not impossible to merge a template with an atlas template and therefore to unmerge"))
    }
    ,
    n.prototype.generateTemplate = function(e, t) {
        this.animationHandle = t,
        this.texture = e,
        this.symbols = t.element;
        for (var i = Object.keys(this.symbols), n = 0; n < i.length; n += 1) {
            var o = this.symbols[i[n]];
            o.className && (this.exposedSymbols[o.className] = o)
        }
        this.isEmpty = 0 === i.length
    }
    ,
    n.prototype.prepareAnimationFrame = function(e, t, i, n, s) {
        var a = this.getSymbol(e);
        if (!a)
            return console.warn("Symbol " + e + " not registered in character's template"),
            [];
        if (a.isAnim) {
            var r = a.frames;
            t >= 0 && t <= r.length && (a = r[t])
        }
        var l = a.vertexPos
          , c = l[0] * n
          , u = l[1] * s
          , h = l[2] * n
          , d = l[3] * s
          , p = [1, 1, 1, 1, 0, 0, 0, 0]
          , m = [c, u, h, u, c, d, h, d]
          , f = new o(a.texture,m,a.textureCoord,p);
        return [f]
    }
}
, function(e, t, i) {
    function n() {
        this.id = "",
        this.sounds = null
    }
    function o(e, t, i, o, s) {
        h.call(this, e),
        this.animationId = null ,
        this.animationName = "",
        this.template = t,
        this.bonesId = o,
        this.audioVol = 1,
        this.scaleX = i || 1,
        this.scaleY = i || 1,
        this.mirrored = !1,
        this._frame = -1,
        this._prevFrame = -1,
        this.nbFrames = 0,
        this.frameData = new n,
        this.tints = [],
        this.tintsString = "",
        this._setTints(s),
        this.loadedAnimations = {};
        var a = t.exposedSymbols;
        this.only4Directions = a && !(a.AnimStatique_0 || a.AnimStatique_4),
        this.isFx = this.sprite.isFx,
        this.tween = new r(this,["frame"]),
        this.tween.from({
            frame: 0
        }),
        this._cleared = !1
    }
    function s(e) {
        for (var t = 0, i = [], n = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)], o = 0; o < e.length; o += 1) {
            var s = e[o];
            if (s.isMaskTag) {
                if (s.isMaskDef && (i.push(n),
                n = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)]),
                s.isMaskUse && (i.push(n),
                n = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)]),
                s.isMaskStop) {
                    var a = n
                      , r = i.pop();
                    n = i.pop(),
                    n[0] = Math.min(n[0], Math.max(a[0], r[0])),
                    n[1] = Math.max(n[1], Math.min(a[1], r[1])),
                    n[2] = Math.min(n[2], Math.max(a[2], r[2])),
                    n[3] = Math.max(n[3], Math.min(a[3], r[3]))
                }
            } else {
                var l = s.vertexPos;
                n[0] = Math.min(n[0], l[0], l[2], l[4], l[6]),
                n[1] = Math.max(n[1], l[0], l[2], l[4], l[6]),
                n[2] = Math.min(n[2], l[1], l[3], l[5], l[7]),
                n[3] = Math.max(n[3], l[1], l[3], l[5], l[7]),
                t += 1
            }
        }
        return {
            bbox: n,
            nbSprites: t,
            spriteBatch: e
        }
    }
    var a = i(26).inherits
      , r = i(261).Tween
      , l = i(6)
      , c = i(84)
      , u = i(250)
      , h = i(246)
      , d = l.ANIM_SYMBOLS
      , p = l.ANIM_SYMETRY
      , m = l.MAP_SCENE_WIDTH / 2
      , f = [4, 3, 2, 3, 4, 7, 6, 7];
    a(o, h),
    e.exports = o,
    Object.defineProperty(o.prototype, "frame", {
        get: function() {
            return this._frame
        },
        set: function(e) {
            e = e < this.nbFrames ? Math.floor(e) : this.nbFrames - 1,
            this._frame !== e && (this._frame = e,
            this.sprite.forceRefresh())
        }
    }),
    o.prototype.switchAnimationManager = function() {}
    ,
    o.prototype.isTemporary = !1,
    o.prototype._computeSymbolDirection = function(e) {
        return e.direction === -1 ? -1 : this.isFx && 0 === e.direction ? 0 : this.only4Directions && 0 === (1 & e.direction) ? e.direction + 1 : e.direction
    }
    ,
    o.prototype._getSymbolId = function(e) {
        e = this.applyAnimationModifier(e);
        var t = e.type || 0 === e.type ? e.type : ""
          , i = e.param || 0 === e.param ? "_" + e.param : ""
          , n = e.base + t + i
          , o = this._computeSymbolDirection(e);
        return o !== -1 && (n += "_" + d[o]),
        n
    }
    ,
    o.prototype._getSymbolModelId = function(e) {
        return this.bonesId + "/" + this._getSymbolId(e)
    }
    ,
    o.prototype.addAnimation = function(e, t) {
        function i() {
            if (n += 1,
            n === o)
                return t && t()
        }
        var n = 0
          , o = 1;
        if (!this.hasSubentities)
            return this._addAnimation(this._getSymbolModelId(e), i);
        for (var s = this.subentities, a = !0, r = 0; r < s.length; r++) {
            var l = s[r]
              , c = l.symbolModifier(e);
            if (c.parent) {
                var u = c.parent;
                o += 1,
                a = a && this._addAnimation(this._getSymbolModelId(u), i)
            }
            c.child && (o += 1,
            a = a && l.animManager.addAnimation(c.child, i))
        }
        return i(),
        a
    }
    ,
    o.prototype._addAnimation = function(e, t) {
        if (!this.bonesId)
            return console.warn("Incorrect bones id:", this.bonesId),
            t(),
            !1;
        if (this.loadedAnimations[e])
            return t(),
            !0;
        var i = this;
        return u.loadTemplate("bone", e, "", function(n) {
            i.template.merge(n, !1),
            i.loadedAnimations[e] = n,
            t()
        }, this.sprite.renderer),
        !0
    }
    ,
    o.prototype.applyAnimationModifier = function(e) {
        var t = this.animationModifiers[e.base];
        if (!t)
            return e;
        switch (typeof t) {
        case "string":
            return {
                base: t,
                type: e.type,
                param: e.param,
                direction: e.direction
            };
        case "function":
            return t(e);
        default:
            return console.error("Wrong animation modifier type"),
            e
        }
    }
    ,
    o.prototype.cleanupAnimations = function() {
        var e = this.template;
        for (var t in this.loadedAnimations) {
            var i = this.loadedAnimations[t];
            e.unmerge(i)
        }
        this.loadedAnimations = {};
        for (var n = 0; n < this.subentities.length; n++)
            this.subentities[n].animManager.cleanupAnimations()
    }
    ,
    o.prototype.cleanupAnimationsAndRemoveSubentities = function() {
        var e = this.template;
        for (var t in this.loadedAnimations) {
            var i = this.loadedAnimations[t];
            e.unmerge(i)
        }
        this.loadedAnimations = {};
        for (var n = 0; n < this.subentities.length; n++)
            this.subentities[n].animManager.cleanupAnimations();
        this.subentities = [],
        this.hasSubentities = !1
    }
    ,
    o.prototype.clear = function(e) {
        return this._cleared ? void console.warn("[AnimationManager.clear] Trying to clear an already cleared animation manager") : (e ? this.tween.fastForwardToEnd() : this.stop(),
        this.cleanupAnimationsAndRemoveSubentities(),
        this.template.clear(),
        this.sprite.renderer.unlockBuffer(this.frameData.id),
        this.frameData.id = "",
        void (this._cleared = !0))
    }
    ,
    o.prototype._setTints = function(e) {
        e || (e = []);
        for (var t, i = [], n = this.tints.length !== e.length, o = 0; o < e.length; o += 1) {
            var s = e[o];
            if (t = s ? {
                r: s.r / 128,
                g: s.g / 128,
                b: s.b / 128
            } : {
                r: 1,
                g: 1,
                b: 1
            },
            i[o] = t,
            !n) {
                var a = this.tints[o];
                n = a.r !== t.r || a.g !== t.g || a.b !== t.b
            }
        }
        if (this.tints = i,
        n)
            for (this.tintsString = "#",
            o = 0; o < i.length; o += 1)
                t = i[o],
                this.tintsString += Math.round(255 * t.r).toString(16) + Math.round(255 * t.g).toString(16) + Math.round(255 * t.b).toString(16);
        return n
    }
    ,
    o.prototype.setTints = function(e) {
        this._setTints(e) && this.releaseBuffer()
    }
    ,
    o.prototype.prepareCurrentAnimationFrame = function() {
        return this.template.prepareAnimationFrame(this.animationName, this._frame, this.tints, this.scaleX, this.scaleY, this.subentityRefs)
    }
    ,
    o.prototype.getSymbolDuration = function(e) {
        var t = this.template.exposedSymbols[e];
        return t ? t.duration : 0
    }
    ,
    o.prototype.releaseBuffer = function() {
        this.sprite.renderer.releaseBuffer(this.frameData.id),
        this.frameData.id = "",
        this.sprite.forceRefresh()
    }
    ,
    o.prototype.generateCurrentFrameData = function() {
        if (null === this.animationId)
            return [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)];
        var e = this.sprite.renderer
          , t = this.frameData.id;
        this.frameData.id = "",
        this.frameData.sounds = [],
        this._generateCurrentFrameIdAndSounds(this.frameData);
        var i = e.getBufferData(this.frameData.id);
        void 0 === i && (i = s(this.prepareCurrentAnimationFrame()),
        e.prepareBatchFromSpriteList(this.frameData.id, i)),
        this.frameData.id !== t && (e.unlockBuffer(t),
        e.lockBuffer(this.frameData.id));
        for (var n = this.frameData.sounds, o = Math.max(-1, Math.min(1, this.sprite._x / m - 1)), a = 0; a < n.length; a++)
            c.playSoundGroup("sfx", n[a], this.audioVol, o);
        return i.bbox
    }
    ,
    o.prototype._generateCurrentFrameIdAndSounds = function(e) {
        var t = this._frame;
        if (e.id += this.animationId + t.toString(),
        this._prevFrame !== t) {
            this._prevFrame = t;
            var i = this.template.getAnimationFrameSound(this.animationName, t);
            i && e.sounds.push(this.bonesId + "/" + this.animationName + ":" + t)
        }
        for (var n = 0; n < this.subentities.length; n += 1)
            this.subentities[n].animManager._generateCurrentFrameIdAndSounds(e)
    }
    ,
    o.prototype.draw = function(e) {
        e.drawSpriteBatch(this.frameData.id)
    }
    ,
    o.prototype._setMirroring = function(e, t) {
        e !== -1 && p[e] ^ t ? this.scaleX > 0 && (this.mirrored = !0,
        this.scaleX *= -1) : this.scaleX < 0 && (this.mirrored = !1,
        this.scaleX *= -1)
    }
    ,
    o.prototype.assignSymbol = function(e, t, i) {
        if (this.subentityRefs = {},
        this.hasSubentities) {
            for (var n = null , o = {
                base: "AnimStatique",
                direction: e.direction
            }, s = 0; s < this.subentities.length; s++) {
                var a = this.subentities[s]
                  , r = a.animManager
                  , l = a.symbolModifier(e);
                n = l.parent || n,
                l.child ? (r.assignSymbol(l.child, t, i),
                i = null ) : r.assignSymbol(o, !1),
                this.subentityRefs[a.bindingPoint] = r,
                r.mirrored = !1
            }
            e = n || o
        }
        (this.tween.playing || this.tween.starting) && this.tween.stop();
        var c = this._getSymbolId(e)
          , u = this._computeSymbolDirection(e);
        if (this.template.hasAnimation(c))
            this._setMirroring(u);
        else {
            e = this.applyAnimationModifier(e);
            var h = e.type || 0 === e.type ? e.type : ""
              , d = e.param || 0 === e.param ? "_" + e.param : "";
            if (c = e.base + h + d + "_" + f[u],
            this.template.hasAnimation(c))
                this._setMirroring(u, !0);
            else {
                for (var p = !1, m = 0; m < 8; m++)
                    if (c = e.base + h + d + "_" + m,
                    this.template.hasAnimation(c)) {
                        this._setMirroring(m),
                        p = !0;
                        break
                    }
                if (!p)
                    return console.warn("Could not find any Animation " + e.base + " in template", this.template.id),
                    i && i()
            }
        }
        this.animationName = c;
        var g = this.template.id + "#" + c;
        return this.animationId = g + "#" + this.scaleY + this.tintsString + (this.mirrored ? "M#" : "#"),
        this.nbFrames = this.template.getAnimationNbFrames(c),
        this._prevFrame = -1,
        this._frame = -1,
        this.frame = 0,
        0 === this.nbFrames ? i && i() : (this.tween.reset().to({
            frame: this.nbFrames
        }, this.nbFrames).start(t),
        void (i && this.tween.onceFinish(i)))
    }
    ,
    o.prototype.stop = function() {
        (this.tween.playing || this.tween.starting) && this.tween.stop()
    }
}
, function(e, t, i) {
    "use strict";
    function n() {
        this._time = 0,
        this._duration = 0,
        this.playing = !1,
        this.stopping = !1,
        this.starting = !1,
        this._iterations = 0,
        this._onStart = null ,
        this._onStop = null ,
        this._onFinish = null ,
        this._onUpdate = null ,
        this._onceFinish = null ,
        this.reference = null
    }
    function o(e, t) {
        return this instanceof o == !1 ? new o(e,t) : (n.call(this),
        this._duration = e,
        void this.onFinish(t))
    }
    function s(e, t, i, n, o, s) {
        this.start = i,
        this.end = i + n,
        this.duration = n,
        this.fromObject = e,
        this.toObject = t,
        this.easing = o,
        this.easingParam = s
    }
    function a(e, t) {
        return this instanceof a == !1 ? new a(e,t) : (n.call(this),
        e || (console.error(new Error("Invalid tween element: " + e)),
        e = {}),
        this._element = e,
        this._properties = t,
        this._transitions = [],
        this._currentTransitionIndex = 0,
        this._duration = 0,
        void (this._from = null ))
    }
    function r(e, t) {
        if (this instanceof r == !1)
            return new r(e,t);
        n.call(this),
        e || (console.error(new Error("Invalid tween element: " + e)),
        e = {}),
        this._element = e,
        this._properties = t,
        this._previousValues = {};
        for (var i = 0; i < this._properties.length; i += 1)
            this._previousValues[this._properties[i]] = 0;
        this._transitions = [],
        this._currentTransitionIndex = 0,
        this._duration = 0,
        this._from = null
    }
    var l = i(26).inherits
      , c = i(6)
      , u = i(262)
      , h = i(252)
      , d = window.performance ? window.performance : Date
      , p = {
        tups: c.TIME_UNITS_PER_SECOND,
        easing: u,
        _startingTime: d.now(),
        _previousTime: d.now(),
        _playables: new h,
        _addList: [],
        _removeList: [],
        _silent: !0,
        _debug: !1,
        restart: function() {
            this._startingTime = d.now(),
            this._previousTime = d.now()
        },
        getFramesSinceStart: function() {
            return Math.floor((d.now() - this._startingTime) * this.tups / 1e3)
        },
        update: function() {
            var e = d.now()
              , t = (e - this._previousTime) * this.tups / 1e3;
            for (this._previousTime = e; this._addList.length > 0; ) {
                var i = this._addList.pop();
                i.reference = this._playables.add(i)
            }
            for (var n = this._playables.first; null !== n; n = n.next)
                n.object.update(t);
            for (; this._removeList.length > 0; )
                this._playables.removeByReference(this._removeList.pop().reference)
        },
        start: function(e) {
            e.start(this)
        },
        _add: function(e) {
            var t = this._addList.indexOf(e);
            t === -1 && (t = this._removeList.indexOf(e),
            t !== -1 ? this._removeList.splice(t, 1) : this._addList.push(e))
        },
        _remove: function(e) {
            var t = this._removeList.indexOf(e);
            t === -1 && (t = this._addList.indexOf(e),
            t !== -1 ? this._addList.splice(t, 1) : this._removeList.push(e))
        },
        stop: function() {
            for (var e = this._playables.first; null !== e; e = e.next)
                e.object._stopped();
            this._playables.clear()
        },
        silent: function(e) {
            this._silent = e || !1
        },
        debug: function(e) {
            this._debug = e || !1
        },
        _warn: function(e) {
            this._silent === !1 && console.warn(e)
        }
    };
    e.exports = p,
    n.prototype.start = function(e) {
        return this._iterations = e === !0 ? 1 / 0 : e ? e : 1,
        0 === this._iterations ? (p._warn("[Playable.start] playable is required to run 0 times"),
        this) : this.starting ? (p._warn("[Playable.start] playable is already starting"),
        this) : this.playing && !this.stopping ? (p._warn("[Playable.start] playable is already playing"),
        this) : (this.starting = !0,
        p._add(this),
        this)
    }
    ,
    n.prototype.stop = function() {
        return this.stopping ? (p._warn("[Playable.stop] playable is already stopping"),
        this) : this.playing || this.starting ? (this.stopping = !0,
        this.starting = !1,
        p._remove(this),
        this) : (p._warn("[Playable.stop] playable is not playing"),
        this)
    }
    ,
    n.prototype.fastForwardToEnd = function() {
        this._time = this._duration
    }
    ,
    n.prototype._stopped = function() {
        this.stopping = !1,
        this.playing = !1,
        null !== this._onStop && this._onStop()
    }
    ,
    n.prototype._started = function() {
        this.starting = !1,
        this.playing = !0,
        null !== this._onStart && this._onStart()
    }
    ,
    n.prototype._finished = function() {
        if (this.playing = !1,
        p._remove(this),
        null !== this._onceFinish) {
            var e = this._onceFinish.slice();
            this._onceFinish = null ;
            for (var t = 0; t < e.length; t += 1)
                e[t]()
        }
        null !== this._onFinish && this._onFinish()
    }
    ,
    n.prototype._reset = function() {
        this._time = 0
    }
    ,
    n.prototype.update = function(e) {
        if (!this.stopping || (this._stopped(),
        this.starting))
            if (this.starting)
                this._time = 0,
                this._update(),
                this._started();
            else {
                var t = this._time + e;
                t >= this._duration ? 1 === this._iterations ? (this._time = this._duration,
                this._update(),
                null !== this._onUpdate && this._onUpdate(),
                this._finished()) : (this._time = t % this._duration,
                this._update(),
                null !== this._onUpdate && this._onUpdate(),
                this._iterations -= 1) : (this._time = t,
                this._update(),
                null !== this._onUpdate && this._onUpdate())
            }
    }
    ,
    n.prototype.onUpdate = function(e) {
        return this._onUpdate = e || null ,
        this
    }
    ,
    n.prototype.onStart = function(e) {
        return this._onStart = e || null ,
        this
    }
    ,
    n.prototype.onStop = function(e) {
        return this._onStop = e || null ,
        this
    }
    ,
    n.prototype.onFinish = function(e) {
        return this._onFinish = e || null ,
        this
    }
    ,
    n.prototype.onceFinish = function(e) {
        return null === this._onceFinish ? this._onceFinish = [e] : this._onceFinish.push(e),
        this
    }
    ,
    n.prototype.removeOnFinish = function() {
        return this._onFinish = null ,
        this._onceFinish = null ,
        this
    }
    ,
    n.prototype.removeOnUpdate = function() {
        return this._onUpdate = null ,
        this
    }
    ,
    n.prototype.removeOnStart = function() {
        return this._onStart = null ,
        this
    }
    ,
    n.prototype.removeOnStop = function() {
        return this._onStop = null ,
        this
    }
    ,
    n.prototype.getElapsedTime = function() {
        return this._time
    }
    ,
    n.prototype.getRemainingTime = function() {
        return this._duration - this._time
    }
    ,
    l(o, n),
    p.Delay = o,
    o.prototype.reset = function(e, t) {
        this._duration = e,
        this.removeOnFinish(),
        this.onFinish(t)
    }
    ,
    o.prototype._update = function() {}
    ,
    l(a, n),
    p.Tween = a,
    a.prototype.reset = function() {
        return this._from = null ,
        this._duration = 0,
        this._currentTransitionIndex = 0,
        this._transitions = [],
        this._reset(),
        this
    }
    ,
    a.prototype.from = function(e) {
        return this._from = e,
        this._transitions.length > 0 && (this._transitions[0].from = e),
        this
    }
    ,
    a.prototype._setFrom = function() {
        this._from = {};
        for (var e = 0; e < this._properties.length; e += 1) {
            var t = this._properties[e];
            this._from[t] = this._element[t]
        }
        return this._from
    }
    ,
    a.prototype._getLastTransitionEnding = function() {
        return this._transitions.length > 0 ? this._transitions[this._transitions.length - 1].toObject : null === this._from ? this._setFrom() : this._from
    }
    ,
    a.prototype.to = function(e, t, i, n) {
        void 0 === i && (i = u.linear);
        var o = this._getLastTransitionEnding();
        return this._transitions.push(new s(o,e,this._duration,t,i,n)),
        this._duration += t,
        this
    }
    ,
    a.prototype.wait = function(e) {
        if (0 === e)
            return this;
        var t = this._getLastTransitionEnding();
        return this._transitions.push(new s(t,t,this._duration,e,u.linear,null )),
        this._duration += e,
        this
    }
    ,
    a.prototype._update = function() {
        for (; this._time < this._transitions[this._currentTransitionIndex].start; )
            this._currentTransitionIndex--;
        for (; this._time > this._transitions[this._currentTransitionIndex].end; )
            this._currentTransitionIndex++;
        for (var e = this._transitions[this._currentTransitionIndex], t = e.easing((this._time - e.start) / e.duration, e.easingParam), i = e.fromObject, n = e.toObject, o = 0; o < this._properties.length; o++) {
            var s = this._properties[o];
            this._element[s] = i[s] * (1 - t) + n[s] * t
        }
    }
    ,
    l(r, n),
    p.RelativeTween = r,
    r.prototype.reset = function() {
        this._from = null ,
        this._duration = 0,
        this._currentTransitionIndex = 0,
        this._transitions = [],
        this._reset(),
        this._previousValues = {};
        for (var e = 0; e < this._properties.length; e += 1)
            this._previousValues[this._properties[e]] = 0;
        return this
    }
    ,
    r.prototype.from = function(e) {
        return this._from = e,
        this._transitions.length > 0 && (this._transitions[0].from = e),
        this
    }
    ,
    r.prototype._setFrom = function() {
        this._from = {};
        for (var e = 0; e < this._properties.length; e += 1)
            this._from[this._properties[e]] = 0;
        return this._from
    }
    ,
    r.prototype._getLastTransitionEnding = function() {
        return this._transitions.length > 0 ? this._setFrom() : null === this._from ? this._setFrom() : this._from
    }
    ,
    r.prototype.to = function(e, t, i, n) {
        void 0 === i && (i = u.linear);
        var o = this._getLastTransitionEnding();
        return this._transitions.push(new s(o,e,this._duration,t,i,n)),
        this._duration += t,
        this
    }
    ,
    r.prototype.wait = function(e) {
        if (0 === e)
            return this;
        var t = this._getLastTransitionEnding();
        return this._transitions.push(new s(t,t,this._duration,e,u.linear,null )),
        this._duration += e,
        this
    }
    ,
    r.prototype._update = function() {
        for (; this._time < this._transitions[this._currentTransitionIndex].start; )
            this._currentTransitionIndex--;
        for (; this._time > this._transitions[this._currentTransitionIndex].end; )
            this._currentTransitionIndex++;
        for (var e = this._transitions[this._currentTransitionIndex], t = e.easing((this._time - e.start) / e.duration, e.easingParam), i = e.fromObject, n = e.toObject, o = 0; o < this._properties.length; o++) {
            var s = this._properties[o]
              , a = i[s] * (1 - t) + n[s] * t;
            this._element[s] += a - this._previousValues[s],
            this._previousValues[s] = a
        }
    }
}
, function(e, t) {
    var i = Math.PI
      , n = Math.PI / 2
      , o = 2 * Math.PI
      , s = 2.718281828;
    t.none = function() {
        return 1
    }
    ,
    t.linear = function(e) {
        return e
    }
    ,
    t.flash = function(e, t) {
        return e + e * t - e * e * t
    }
    ,
    t.parabolic = function(e) {
        var t = 2 * e - 1;
        return 1 - t * t
    }
    ,
    t.trigo = function(e, t) {
        return .5 * (1 - Math.cos(o * e * t))
    }
    ,
    t.elastic = function(e, t) {
        if (1 === e)
            return 1;
        t /= t + 1;
        var i = (1 + t) * Math.log(1 - e) / Math.log(t);
        return Math.cos(i - n) * Math.pow(t, i)
    }
    ,
    t.quadIn = function(e) {
        return e * e
    }
    ,
    t.quadOut = function(e) {
        return 2 * e - e * e
    }
    ,
    t.quadInOut = function(e) {
        return e < .5 ? 2 * e * e : 2 * (2 * e - e * e) - 1
    }
    ,
    t.cubicIn = function(e) {
        return e * e * e
    }
    ,
    t.cubicOut = function(e) {
        return 3 * e - 3 * e * e + e * e * e
    }
    ,
    t.cubicInOut = function(e) {
        return e < .5 ? 4 * e * e * e : 4 * (3 * e - 3 * e * e + e * e * e) - 3
    }
    ,
    t.quarticIn = function(e) {
        return e * e * e * e
    }
    ,
    t.quarticOut = function(e) {
        var t = e * e;
        return 4 * e - 6 * t + 4 * t * e - t * t
    }
    ,
    t.quarticInOut = function(e) {
        if (e < .5)
            return 8 * e * e * e * e;
        var t = e * e;
        return 8 * (4 * e - 6 * t + 4 * t * e - t * t) - 7
    }
    ,
    t.polyIn = function(e, t) {
        return Math.pow(e, t)
    }
    ,
    t.polyOut = function(e, t) {
        return 1 - Math.pow(1 - e, t)
    }
    ,
    t.polyInOut = function(e, t) {
        return e < .5 ? Math.pow(2 * e, t) / 2 : (2 - Math.pow(2 * (1 - e), t)) / 2
    }
    ,
    t.sineIn = function(e) {
        return 1 - Math.cos(n * e)
    }
    ,
    t.sineOut = function(e) {
        return Math.sin(n * e)
    }
    ,
    t.sineInOut = function(e) {
        return e < .5 ? (1 - Math.cos(i * e)) / 2 : (1 + Math.sin(i * (e - .5))) / 2
    }
    ,
    t.expIn = function(e, t) {
        return (1 - Math.pow(s, t * e)) / (1 - Math.pow(s, t))
    }
    ,
    t.expOut = function(e, t) {
        return (1 - Math.pow(s, -t * e)) / (1 - Math.pow(s, -t))
    }
    ,
    t.expInOut = function(e, t) {
        return e < .5 ? (1 - Math.pow(s, 2 * t * e)) / (1 - Math.pow(s, t)) / 2 : .5 + (1 - Math.pow(s, t - 2 * t * e)) / (1 - Math.pow(s, -t)) / 2
    }
    ,
    t.circIn = function(e) {
        return 1 - Math.sqrt(1 - Math.pow(e, 2))
    }
    ,
    t.circOut = function(e) {
        return Math.sqrt(1 - Math.pow(1 - e, 2))
    }
    ,
    t.circInOut = function(e) {
        return e < .5 ? (1 - Math.sqrt(1 - 4 * e * e)) / 2 : (1 + Math.sqrt(-3 + 8 * e - 4 * e * e)) / 2
    }
    ,
    t.elasticIn = function(e, t) {
        if (0 === e)
            return 0;
        t /= t + 1;
        var i = (1 + t) * Math.log(e) / Math.log(t);
        return Math.cos(i) * Math.pow(t, i)
    }
    ,
    t.elasticOut = function(e, t) {
        if (1 === e)
            return 1;
        t /= t + 1;
        var i = (1 + t) * Math.log(1 - e) / Math.log(t);
        return 1 - Math.cos(i) * Math.pow(t, i)
    }
    ,
    t.elasticInOut = function(e, t) {
        var i;
        return e < .5 ? 0 === e ? 0 : (t /= t + 1,
        i = (1 + t) * Math.log(2 * e) / Math.log(t),
        .5 * Math.cos(i) * Math.pow(t, i)) : 1 === e ? 1 : (t /= t + 1,
        i = (1 + t) * Math.log(2 - 2 * e) / Math.log(t),
        .5 + .5 * (1 - Math.cos(i) * Math.pow(t, i)))
    }
    ,
    t.bounceIn = function(e, t) {
        if (0 === e)
            return 0;
        t /= t + 1;
        var i = (1 + t) * Math.log(e) / Math.log(t);
        return Math.abs(Math.cos(i) * Math.pow(t, i))
    }
    ,
    t.bounceOut = function(e, t) {
        if (1 === e)
            return 1;
        t /= t + 1;
        var i = (1 + t) * Math.log(1 - e) / Math.log(t);
        return 1 - Math.abs(Math.cos(i) * Math.pow(t, i))
    }
    ,
    t.bounceInOut = function(e, t) {
        var i;
        return e < .5 ? 0 === e ? 0 : (t /= t + 1,
        i = (1 + t) * Math.log(2 * e) / Math.log(t),
        Math.abs(.5 * Math.cos(i) * Math.pow(t, i))) : 1 === e ? 1 : (t /= t + 1,
        i = (1 + t) * Math.log(2 - 2 * e) / Math.log(t),
        .5 + .5 * (1 - Math.abs(Math.cos(i) * Math.pow(t, i))))
    }
    ,
    t.backIn = function(e, t) {
        return e * e * ((t + 1) * e - t)
    }
    ,
    t.backOut = function(e, t) {
        return e -= 1,
        e * e * ((t + 1) * e + t) + 1
    }
    ,
    t.backInOut = function(e, t) {
        return e < .5 ? (e *= 2,
        .5 * (e * e * ((t + 1) * e - t))) : (e = 2 * e - 2,
        .5 * (e * e * ((t + 1) * e + t)) + 1)
    }
}
, function(e, t, i) {
    function n(e) {
        return {
            parent: e,
            child: null
        }
    }
    var o = i(264)
      , s = i(265)
      , a = [n, s, o, n, n, n, n];
    e.exports = a
}
, function(e, t, i) {
    function n(e) {
        return 0 === e.type ? {
            parent: e,
            child: null
        } : {
            parent: null ,
            child: e
        }
    }
    function o(e) {
        var t = e;
        return e.type && (t = {
            id: e.base + "0_" + c[e.direction],
            type: 0,
            base: e.base,
            direction: e.direction
        }),
        {
            parent: null ,
            child: t
        }
    }
    function s(e) {
        return u[e.type] ? {
            parent: e,
            child: null
        } : h[e.type] ? {
            parent: e,
            child: e
        } : {
            parent: null ,
            child: e
        }
    }
    function a(e) {
        var t = {
            base: "AnimCueillirSol0",
            direction: e.direction
        };
        return {
            parent: null ,
            child: t
        }
    }
    function r(e) {
        var t = e.base
          , i = d[t];
        if (!i)
            return console.error("No modifier for symbol base " + t),
            {
                parent: null ,
                child: null
            };
        if ("function" == typeof i)
            return i(e);
        var n = {
            parent: null ,
            child: null
        };
        return i.parent && (n.parent = e),
        i.child && (n.child = e),
        n
    }
    var l = i(6)
      , c = l.ANIM_SYMBOLS
      , u = {
        Rest_0: !0,
        Sit_0: !0,
        Oups_0: !0,
        Shit_0: !0
    }
      , h = {
        Appl_0: !0,
        Bye_0: !0,
        Champ_0: !0,
        Cross_0: !0,
        Drink_0: !0,
        Eat_0: !0,
        Fear_0: !0,
        Hi_0: !0,
        Kiss_0: !0,
        Mad_0: !0,
        Pfc1_0: !0,
        Pfc2_0: !0,
        Pfc3_0: !0,
        Pipo_0: !0,
        Point_0: !0
    }
      , d = {
        AnimArme: n,
        AnimAttaque: o,
        AnimEmote: s,
        AnimCueillirSol1: a,
        AnimConsulter: {
            parent: null ,
            child: !0
        },
        AnimCueillir0: {
            parent: null ,
            child: !0
        },
        AnimCueillirSol0: {
            parent: null ,
            child: !0
        },
        AnimDrop: {
            parent: null ,
            child: !0
        },
        AnimFaucher: {
            parent: null ,
            child: !0
        },
        AnimHache: {
            parent: null ,
            child: !0
        },
        AnimPeche: {
            parent: null ,
            child: !0
        },
        AnimPickup: {
            parent: null ,
            child: !0
        },
        AnimPioche: {
            parent: null ,
            child: !0
        },
        AnimPuiser: {
            parent: null ,
            child: !0
        },
        AnimThrow: {
            parent: null ,
            child: !0
        },
        carrying: {
            parent: null ,
            child: !0
        },
        AnimCourse: {
            parent: !0,
            child: null
        },
        AnimMarche: {
            parent: !0,
            child: null
        },
        AnimTacle: {
            parent: !0,
            child: null
        },
        AnimStatique: {
            parent: !0,
            child: !0
        },
        AnimMort: {
            parent: !0,
            child: !0
        },
        AnimHit: {
            parent: !0,
            child: !0
        },
        AnimVanish: {
            parent: !0,
            child: !0
        }
    };
    e.exports = r
}
, function(e, t) {
    function i(e) {
        var t = e.base;
        return {
            parent: e,
            child: "AnimMarche" === t || "AnimCourse" === t ? e : null
        }
    }
    e.exports = i
}
, function(e, t) {
    e.exports = {
        HOOK_POINT_CATEGORY_UNUSED: 0,
        HOOK_POINT_CATEGORY_PET: 1,
        HOOK_POINT_CATEGORY_MOUNT_DRIVER: 2,
        HOOK_POINT_CATEGORY_LIFTED_ENTITY: 3,
        HOOK_POINT_CATEGORY_BASE_BACKGROUND: 4,
        HOOK_POINT_CATEGORY_MERCHANT_BAG: 5,
        HOOK_POINT_CATEGORY_BASE_FOREGROUND: 6
    }
}
, function(e, t, i) {
    i(268),
    i(273),
    i(274),
    i(275),
    i(276),
    i(277),
    i(278),
    e.exports = i(269)
}
, function(e, t, i) {
    var n = i(269);
    n.shadersData = {
        vertexLine: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying   vec4 vColor;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvec4 colorMul = aColorMul * cm * 2.0;\tvec4 colorAdd = aColorAdd * cm + ca;\tvColor = colorMul + colorAdd;\tvColor.rgb *= colorMul.a;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z,\t\t0.0, 1.0\t);}"
        },
        fragmentLine: {
            type: "fragment",
            script: "varying mediump vec4 vColor;void main() {\tgl_FragColor = vColor;}"
        },
        vertexBox: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying mediump vec4 vColor;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvec4 colorMul = aColorMul * cm * 2.0;\tvec4 colorAdd = aColorAdd * cm + ca;\tvColor = colorMul + colorAdd;\tvColor.rgb *= colorMul.a;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z,\t\t0.0, 1.0\t);}"
        },
        fragmentBox: {
            type: "fragment",
            script: "varying mediump vec4 vColor;void main() {\tgl_FragColor = vColor;}"
        },
        vertexRegular: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec2 aTexCoord;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying   vec2 vTexCoord;varying   vec4 vColorMul;varying   vec4 vColorAdd;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvTexCoord = aTexCoord;\tvColorMul = aColorMul * cm * 2.0;\tvColorAdd = aColorAdd * cm + ca;\tvColorMul.rgb *= vColorMul.a;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z,\t\t0.0, 1.0\t);}"
        },
        fragmentRegular: {
            type: "fragment",
            script: "varying mediump vec2 vTexCoord;varying mediump vec4 vColorMul;varying mediump vec4 vColorAdd;uniform sampler2D uTexture;void main() {\tmediump vec4 color = texture2D(uTexture, vTexCoord);\tmediump float colorAddAlpha = vColorAdd.a * color.a;\tcolor *= vColorMul;\tcolor.rgb /= color.a;\tcolor.rgb += vColorAdd.rgb;\tcolor.a += colorAddAlpha;\tcolor.rgb *= color.a;\tif (color.a <= 0.05) { discard; }\tgl_FragColor = color;}"
        },
        vertexRelativeScale: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec2 aTexCoord;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying   vec2 vTexCoord;varying   vec4 vColorMul;varying   vec4 vColorAdd;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvTexCoord = aTexCoord;\tvColorMul = aColorMul * cm * 2.0;\tvColorAdd = ca;\tvColorMul.rgb *= vColorMul.a;\tfloat x = aPosition.x + tx.w * (aColorAdd.r * 127.0 + aColorAdd.g);\tfloat y = aPosition.y + ty.w * (aColorAdd.b * 127.0 + aColorAdd.a);\tgl_Position = vec4(\t\tx * tx.x + y * tx.y + tx.z,\t\tx * ty.x + y * ty.y + ty.z,\t\t0.0, 1.0\t);}"
        },
        vertexAbsoluteScale: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec2 aTexCoord;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying   vec2 vTexCoord;varying   vec4 vColorMul;varying   vec4 vColorAdd;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvTexCoord = aTexCoord;\tvColorMul = aColorMul * cm * 2.0;\tvColorAdd = ca;\tvColorMul.rgb *= vColorMul.a;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z + tx.w * 127.0 * aColorAdd.r * aColorAdd.b,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z - ty.w * 127.0 * aColorAdd.g * aColorAdd.a,\t\t0.0, 1.0\t);}"
        },
        vertexMask: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec2 aTexCoord;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;uniform   vec4 uBbox;varying   vec2 vPosition;varying   vec2 vTexCoord;varying   vec4 vColorMul;varying   vec4 vColorAdd;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvec4 cm = uMatrix[2];\tvec4 ca = uMatrix[3];\tvTexCoord = aTexCoord;\tvColorMul = aColorMul * cm * 2.0;\tvColorAdd = aColorAdd * cm + ca;\tvColorMul.rgb *= vColorMul.a;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z,\t\t0.0, 1.0\t);\tvPosition = (aPosition - vec2(uBbox.x, uBbox.z)) / vec2(uBbox.y - uBbox.x, uBbox.w - uBbox.z);}"
        },
        fragmentMask: {
            type: "fragment",
            script: "varying mediump vec2 vPosition;varying mediump vec2 vTexCoord;varying mediump vec4 vColorMul;varying mediump vec4 vColorAdd;uniform sampler2D uTexture;uniform sampler2D uMask;void main() {\tmediump vec4 color = texture2D(uTexture, vTexCoord);\tmediump float colorAddAlpha = vColorAdd.a * color.a;\tcolor *= vColorMul;\tcolor.rgb /= color.a;\tcolor.rgb += vColorAdd.rgb;\tcolor.a += colorAddAlpha;\tcolor.rgb *= color.a;\tif (color.a <= 0.05) { discard; }\tmediump float mask = texture2D(uMask, vPosition).a;\tif (mask == 0.0) { discard; }\tif (mask <= 0.2) {\t\tcolor *= mask * 5.0;\t}\tgl_FragColor = color;}"
        },
        vertexOutline: {
            type: "vertex",
            script: "attribute vec2 aPosition;attribute vec2 aTexCoord;attribute vec4 aColorMul;attribute vec4 aColorAdd;uniform   mat4 uMatrix;varying   vec2 vTexCoord;varying   vec4 vColorOutline;void main() {\tvec4 tx = uMatrix[0];\tvec4 ty = uMatrix[1];\tvColorOutline = uMatrix[2] * aColorMul + aColorAdd;\tvTexCoord = aTexCoord;\tgl_Position = vec4(\t\taPosition.x * tx.x + aPosition.y * tx.y + tx.z,\t\taPosition.x * ty.x + aPosition.y * ty.y + ty.z,\t\t0.0, 1.0\t);}"
        },
        fragmentOutline: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;varying mediump vec4 vColorOutline;uniform sampler2D uTexture;void main() {\tvec4 color = texture2D(uTexture, vTexCoord);\tif (color.a == 1.0) {\t\tdiscard;\t} else {\t\tfloat gradX = texture2D(uTexture, vTexCoord + vec2(0.05, 0.0)).a - texture2D(uTexture, vTexCoord - vec2(0.05, 0.0)).a;\t\tfloat gradY = texture2D(uTexture, vTexCoord + vec2(0.0, 0.05)).a - texture2D(uTexture, vTexCoord - vec2(0.0, 0.05)).a;\t\tvec4 outlineColor = 0.5 * vColorOutline * (abs(gradX) + abs(gradY));\t\tgl_FragColor = outlineColor * outlineColor.a;\t}}"
        },
        fragmentFiltering: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;uniform float uRatio;uniform sampler2D uTexture;void main() {\tvec2 res = vec2(1267.0, 865.5);\tvec4 color  = texture2D(uTexture, vTexCoord);\tvec4 color1 = texture2D(uTexture, vTexCoord + vec2(-0.7, -0.7) / res);\tvec4 color2 = texture2D(uTexture, vTexCoord + vec2(-0.7,  0.7) / res);\tvec4 color3 = texture2D(uTexture, vTexCoord + vec2( 0.7, -0.7) / res);\tvec4 color4 = texture2D(uTexture, vTexCoord + vec2( 0.7,  0.7) / res);\tgl_FragColor = color * (1.0 + 4.0 * uRatio) - uRatio * (color1 + color2 + color3 + color4);}"
        },
        fragmentMapTransition: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;varying mediump vec4 vColorMul;uniform float uRatio;uniform sampler2D uTexture;void main() {\tvec2 offsetToCenter = vTexCoord - 0.5;\tfloat distToCenter = length(offsetToCenter);\tfloat c1 = 2.0 * (0.5 - distToCenter * pow(uRatio, 2.0) * 0.02);\tvec2 textureCoord = vec2(0.5 + c1 * offsetToCenter.x, 0.5 + c1 * offsetToCenter.y);\tvec4 color = texture2D(uTexture, textureCoord);\tfloat avg = (color.r + color.g + color.b) / 3.0;\tfloat greyRatio = uRatio * 1.0;\tvec4 greyedColor = color * (1.0 - greyRatio) + vec4(avg) * greyRatio;\tfloat blackRatio = uRatio * 0.2;\tgl_FragColor = vec4((greyedColor * (1.0 - blackRatio)).rgb, 1.0) * vColorMul;}"
        },
        fragmentPixelArt: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;uniform float uResolution;uniform sampler2D uTexture;void main() {\tvec4 color = texture2D(uTexture, floor(vTexCoord * uResolution) / uResolution);\tcolor.rgb = floor(color.rgb * 8.0) / 8.0;\tgl_FragColor = color;}"
        },
        fragmentEnteringFight: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;uniform float uRatio;uniform sampler2D uTexture;void main() {\tfloat u = 2.0 * (vTexCoord.x - 0.5);\tfloat v = 2.0 * (vTexCoord.y - 0.5);\tfloat r = uRatio * (pow(1.0 - max(abs(u), abs(v)), 2.0));\tvec2 uv = vTexCoord + vec2(u, v) * r;\tvec4 color = texture2D(uTexture, uv) + 0.8 * vec4(1.0, 1.0, 1.0, 0.0) * r;\tgl_FragColor = color;}"
        },
        fragmentColorSplit: {
            type: "fragment",
            script: "precision mediump float;varying mediump vec2 vTexCoord;uniform sampler2D uTexture;void main() {\tvec4 color = vec4(0.0, 0.0, 0.0, 1.0);\tcolor.r = texture2D(uTexture, vTexCoord + vec2(-0.007, - 0.007)).r;\tcolor.g = texture2D(uTexture, vTexCoord + vec2(0.007, - 0.007)).g;\tcolor.b = texture2D(uTexture, vTexCoord + vec2(0.0, 0.01)).b;\tgl_FragColor = color;}"
        }
    }
}
, function(e, t, i) {
    function n(e, t, i, s, r, l, c) {
        this.canvas = e;
        var u = this.gl = n.getWebGlContext(this.canvas, !1, c);
        u.blendFunc(u.ONE, u.ONE_MINUS_SRC_ALPHA),
        u.enable(u.BLEND),
        u.activeTexture(u.TEXTURE0),
        this.resetClearColor();
        var h = 4
          , d = 2
          , p = 1
          , m = 2
          , f = 2
          , g = 8;
        this._vertexSize = h * m + d * f + p * g,
        this._spriteSize = 6 * this._vertexSize,
        this._lineSize = 2 * this._vertexSize,
        this._boxSize = 6 * this._vertexSize,
        this._initPrograms(),
        this.initBuffer(s),
        this.sFMPartitioner = new a(this._spriteSize,s * this._spriteSize),
        this._initTextureCache(r),
        this._programs = [],
        this.useProgram(this._programRegular);
        var _ = u.getParameter(u.FRAMEBUFFER_BINDING);
        this._renderTarget = this._createRenderTarget(null , _, 1, 1),
        this._renderTargetStack = [this._renderTarget],
        this._matrixStack = this._renderTarget.matrixStack,
        this._width = 1,
        this._height = 1,
        this.resetDimension(t || 0, i || 0),
        this._maxTextureSize = u.getParameter(u.MAX_TEXTURE_SIZE),
        this.prerenderRatio = l,
        this.maskQuality = .5,
        this._drawModes = {
            lines: u.LINES,
            triangles: u.TRIANGLES
        },
        this.emptyTexture = this.createTexture(o.EMPTY_IMAGE, "empty_texture", "linear", "permanent")
    }
    var o = i(6)
      , s = i(251)
      , a = i(270)
      , r = null ;
    e.exports = n,
    n.prototype.resetClearColor = function() {
        this.gl.clearColor(0, 0, 0, 0)
    }
    ,
    n.prototype.setClearColor = function(e, t, i, n) {
        this.gl.clearColor(e, t, i, n)
    }
    ,
    n.prototype._initTextureCache = function(e) {
        function t(e) {
            i.deleteTexture(e.binder)
        }
        var i = this.gl;
        this.textureCache = new s(e,t)
    }
    ,
    n.prototype.resetDimension = function(e, t) {
        var i = this._width
          , n = this._height;
        this._width = e,
        this._height = t,
        this.gl.viewport(0, 0, e, t);
        var o = this._renderTargetStack[0];
        o.width = e,
        o.height = t;
        for (var s = i / this._width, a = n / this._height, r = o.matrixStack, l = 0; l < r.length; l += 1) {
            var c = r[l];
            c[0] *= s,
            c[1] *= s,
            c[2] = (c[2] + 1) * s - 1,
            c[4] *= a,
            c[5] *= a,
            c[6] = (c[6] - 1) * a + 1
        }
    }
    ,
    n.prototype.getNbBytesPerSprite = function() {
        return this._spriteSize
    }
    ,
    n.prototype.getNbBytesPerLine = function() {
        return this._lineSize
    }
    ,
    n.prototype.getNbBytesPerBox = function() {
        return this._boxSize
    }
    ,
    n.prototype.getNbBytesPerVertex = function() {
        return this._vertexSize
    }
    ,
    n.prototype.enableBlending = function() {
        var e = this.gl;
        e.enable(e.BLEND)
    }
    ,
    n.prototype.disableBlending = function() {
        var e = this.gl;
        e.disable(e.BLEND)
    }
    ,
    n.prototype.drawImage = function(e, t, i, n, o) {
        if (e) {
            var s = this._matrixStack[0]
              , a = s[0]
              , r = s[4]
              , l = s[1]
              , c = s[5]
              , u = s[2]
              , h = s[6];
            s[2] += a * t + l * i,
            s[6] += r * t + c * i,
            s[0] *= n,
            s[4] *= n,
            s[1] *= o,
            s[5] *= o,
            this.gl.uniformMatrix4fv(this._currentProgram.uniforms.uMatrix, !1, s);
            var d = this.textureCache.useElement(e.id).element.binder;
            this.gl.bindTexture(this.gl.TEXTURE_2D, d),
            this.gl.drawArrays(this.gl.TRIANGLES, 0, 6),
            s[0] = a,
            s[4] = r,
            s[1] = l,
            s[5] = c,
            s[2] = u,
            s[6] = h
        }
    }
    ,
    n.prototype.clear = function() {
        this.gl.clear(this.gl.COLOR_BUFFER_BIT)
    }
    ,
    n.isWebGlSupported = function() {
        if (null !== r)
            return r;
        var e = document.createElement("canvas");
        return r = !!n.getWebGlContext(e, !0)
    }
    ,
    n.getWebGlContext = function(e, t, i) {
        var n = null ;
        try {
            var o = {
                alpha: i,
                depth: !1,
                stencil: !1,
                antialias: !1
            };
            n = e.getContext("webgl", o) || e.getContext("experimental-webgl", o)
        } catch (s) {
            if (!t)
                throw new Error("Could not initialise WebGL (" + s.message + ")");
            return null
        }
        if (!n) {
            if (!t)
                throw new Error("Could not initialise WebGL, sorry :-(");
            return null
        }
        return n
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.start = e,
        this.nBytes = t,
        this.update = 0,
        this.prevChunk = null ,
        this.nextChunk = null ,
        this.id = null ,
        this.obj = null ,
        this.ref = null ,
        this.nLocks = 0
    }
    function o(e, t) {
        this.memoryChunksFree = new s(function(e, t) {
            return e.nBytes - t.nBytes
        }
        ),
        this.memoryChunksUsed = new a(function(e, t) {
            return e.update - t.update
        }
        ),
        this.memoryChunksLocked = new a(function() {
            return 1
        }
        );
        var i = t - e
          , o = new n(e,i);
        o.ref = this.memoryChunksFree.add(o),
        this.firstByte = e,
        this.nBytes = i,
        this.update = 0,
        this.chunksById = {}
    }
    var s = i(271)
      , a = i(272);
    n.prototype.set = function(e, t, i) {
        this.start = e,
        this.nBytes = t,
        this.update = i
    }
    ,
    e.exports = o,
    o.prototype.touch = function(e) {
        var t = this.chunksById[e];
        if (void 0 !== t)
            return 0 === t.nLocks && (t.update = this.update++,
            this.memoryChunksUsed.moveToTheEnd(t.ref)),
            t.obj
    }
    ,
    o.prototype.getChunk = function(e) {
        return this.chunksById[e]
    }
    ,
    o.prototype.addLock = function(e) {
        var t = this.chunksById[e];
        if (void 0 !== t)
            return 0 === t.nLocks && (this.memoryChunksUsed.removeByRef(t.ref) || console.warn("[SuperFastMemoryPartitioner.lock] Trying to lock an already locked chunk", e),
            t.ref = this.memoryChunksLocked.add(t),
            t.update = 1 / 0),
            t.nLocks += 1,
            t.obj
    }
    ,
    o.prototype.removeLock = function(e) {
        var t = this.chunksById[e];
        void 0 !== t && (t.nLocks -= 1,
        0 === t.nLocks && (this.memoryChunksLocked.removeByRef(t.ref),
        t.ref = this.memoryChunksUsed.add(t),
        t.update = this.update++),
        t.nLocks < 0 && console.warn("[SuperFastMemoryPartitioner.unlock] Trying to unlock a non-locked chunk", e))
    }
    ,
    o.prototype.possess = function(e) {
        return !!this.chunksById[e]
    }
    ,
    o.prototype.release = function(e) {
        var t = this.chunksById[e];
        if (void 0 !== t) {
            if (t.ref.container === this.memoryChunksLocked ? this.memoryChunksLocked.removeByRef(t.ref) : this.memoryChunksUsed.removeByRef(t.ref),
            t.prevChunk && t.prevChunk.ref.container === this.memoryChunksFree) {
                var i = t.prevChunk;
                t.start = i.start,
                t.nBytes += i.nBytes,
                t.prevChunk = i.prevChunk,
                i.prevChunk && (i.prevChunk.nextChunk = t),
                this.memoryChunksFree.removeByRef(i.ref)
            }
            if (t.nextChunk && t.nextChunk.ref.container === this.memoryChunksFree) {
                var n = t.nextChunk;
                t.nBytes += n.nBytes,
                t.nextChunk = n.nextChunk,
                n.nextChunk && (n.nextChunk.prevChunk = t),
                this.memoryChunksFree.removeByRef(n.ref)
            }
            t.ref = this.memoryChunksFree.add(t),
            t.nLocks = 0,
            t.update = 0,
            delete this.chunksById[e]
        }
    }
    ,
    o.prototype.bindObject = function(e, t) {
        var i = this.chunksById[e];
        return void 0 !== i && (i.obj = t,
        !0)
    }
    ,
    o.prototype._selectChunks = function(e) {
        var t = this.memoryChunksFree.getSmallestAbove({
            nBytes: e
        });
        if (t)
            return [t];
        if (0 === this.memoryChunksUsed.count)
            throw new Error("No available chunk can hold " + e + " Bytes.Make sure that enough space is allocated (currently " + this.nBytes + ") or that locked chunks are correctly unlocked.");
        var i = this.memoryChunksUsed.first;
        if (i.object.nBytes >= e)
            return [i.object];
        for (var n, o = 0, s = 7, a = 1 / 0; (o < s || a === 1 / 0) && null !== i; ) {
            for (var r = i.object, l = [r], c = r.nBytes, u = r.prevChunk, h = r.nextChunk, d = r.update; c < e; )
                null === u || null !== h && h.update <= u.update ? (d < h.update && (d = h.update),
                l.push(h),
                c += h.nBytes,
                h = h.nextChunk) : (d < u.update && (d = u.update),
                l.unshift(u),
                c += u.nBytes,
                u = u.prevChunk);
            d < a && (a = d,
            n = l),
            i = i.next,
            o += 1
        }
        if (a === 1 / 0)
            throw new Error("No available chunk can hold " + e + " Bytes.Make sure that enough space is allocated (currently " + this.nBytes + ") or that locked chunks are correctly unlocked.");
        return n
    }
    ,
    o.prototype.reserve = function(e, t) {
        for (var i = this._selectChunks(t), o = 0; o < i.length; o += 1) {
            var s = i[o];
            s.ref.container === this.memoryChunksUsed ? (this.memoryChunksUsed.removeByRef(s.ref),
            delete this.chunksById[s.id]) : this.memoryChunksFree.removeByRef(s.ref)
        }
        var a = i[0]
          , r = i[i.length - 1]
          , l = a.start
          , c = r.start + r.nBytes;
        a.set(l, t, this.update),
        a.ref = this.memoryChunksUsed.add(a),
        a.id = e,
        this.chunksById[e] = a;
        var u = c - l;
        if (u === t)
            a.nextChunk = r.nextChunk,
            null !== a.nextChunk && (a.nextChunk.prevChunk = a);
        else {
            var h;
            if (a === r ? (h = new n(l + t,u - t),
            h.nextChunk = r.nextChunk,
            null !== h.nextChunk && (h.nextChunk.prevChunk = h)) : (h = r,
            h.set(l + t, u - t, 0)),
            h.prevChunk = a,
            a.nextChunk = h,
            h.nextChunk && h.nextChunk.ref.container === this.memoryChunksFree) {
                var d = h.nextChunk;
                h.nBytes += d.nBytes,
                h.nextChunk = d.nextChunk,
                d.nextChunk && (d.nextChunk.prevChunk = h),
                this.memoryChunksFree.removeByRef(d.ref)
            }
            h.ref = this.memoryChunksFree.add(h)
        }
        return this.update += 1,
        a
    }
    ,
    o.prototype.debug = function() {
        console.log("***** SFMP *****"),
        console.log(" FREE CHUNKS"),
        this.memoryChunksFree.forEach(function(e) {
            console.log(e)
        }),
        console.log(" USED CHUNKS"),
        this.memoryChunksUsed.forEach(function(e) {
            console.log(e)
        }),
        console.log(" LOCKED CHUNKS"),
        this.memoryChunksLocked.forEach(function(e) {
            console.log(e)
        })
    }
}
, function(e, t) {
    function i(e) {
        this.count = 0,
        this.root = null ,
        this.cmpFunc = e
    }
    function n(e, t) {
        this.object = e,
        this.height = 1,
        this.left = null ,
        this.right = null ,
        this.parent = null ,
        this.container = t
    }
    i.prototype._addLeft = function(e, t) {
        e.parent = t,
        t.left = e
    }
    ,
    i.prototype._addRight = function(e, t) {
        e.parent = t,
        t.right = e
    }
    ,
    i.prototype.add = function(e) {
        this.count += 1;
        var t = new n(e,this);
        if (null === this.root)
            return this.root = t,
            t;
        for (var i = this.root; ; ) {
            var o = this.cmpFunc(e, i.object);
            if (o < 0) {
                if (null === i.left) {
                    this._addLeft(t, i);
                    break
                }
                i = i.left
            } else if (o > 0) {
                if (null === i.right) {
                    this._addRight(t, i);
                    break
                }
                i = i.right
            } else {
                if (null === i.left) {
                    this._addLeft(t, i);
                    break
                }
                if (null === i.right) {
                    this._addRight(t, i);
                    break
                }
                i = i.right.height < i.left.height ? i.right : i.left
            }
        }
        return this._balance(t.parent),
        t
    }
    ,
    i.prototype._balanceLeftRight = function(e) {
        var t = e.left
          , i = t.left
          , n = t.right.left;
        t.right.left = t,
        e.left = t.right,
        t = e.left,
        t.parent = e;
        var o = t.left;
        o.parent = t,
        o.left = i,
        o.right = n,
        null !== i && (i.parent = o),
        null !== n && (n.parent = o),
        t.height = o.height + 1
    }
    ,
    i.prototype._balanceLeftLeft = function(e) {
        var t = e.left
          , i = t.right;
        e === this.root ? this.root = t : e.parent.right === e ? e.parent.right = t : e.parent.left = t,
        t.right = e,
        t.parent = e.parent,
        e.parent = t,
        e.left = i,
        null !== i && (i.parent = e),
        e.height = e.height - 1
    }
    ,
    i.prototype._balanceRightLeft = function(e) {
        var t = e.right
          , i = t.right
          , n = t.left.right;
        t.left.right = t,
        e.right = t.left,
        t = e.right,
        t.parent = e;
        var o = t.right;
        o.parent = t,
        o.right = i,
        o.left = n,
        null !== i && (i.parent = o),
        null !== n && (n.parent = o),
        e.right.height = o.height + 1
    }
    ,
    i.prototype._balanceRightRight = function(e) {
        var t = e.right
          , i = t.left;
        e === this.root ? this.root = t : e.parent.left === e ? e.parent.left = t : e.parent.right = t,
        t.left = e,
        t.parent = e.parent,
        e.parent = t,
        e.right = i,
        null !== i && (i.parent = e),
        e.height = e.height - 1;
    }
    ,
    i.prototype._balance = function(e) {
        for (var t = e; null !== t; ) {
            var i = null === t.left ? 0 : t.left.height
              , n = null === t.right ? 0 : t.right.height
              , o = 1 + Math.max(i, n);
            if (!(o > t.height))
                break;
            if (t.height = o,
            i - n > 1) {
                null !== t.left.right && (null === t.left.left || t.left.left.height < t.left.right.height) && this._balanceLeftRight(t),
                this._balanceLeftLeft(t);
                break
            }
            if (n - i > 1) {
                null !== t.right.left && (null === t.right.right || t.right.right.height < t.right.left.height) && this._balanceRightLeft(t),
                this._balanceRightRight(t);
                break
            }
            t = t.parent
        }
    }
    ,
    i.prototype.removeByRef = function(e) {
        this.count -= 1;
        var t = e.parent
          , i = e.left
          , n = e.right;
        if (null === e.right)
            return null === t ? this.root = i : t.right === e ? t.right = i : t.left = i,
            null !== i && (i.parent = t),
            this._balance(t),
            !0;
        var o, s = e.right;
        if (null === s.left)
            return o = s,
            null !== i && (i.parent = s),
            s.left = i,
            null === t ? this.root = s : t.right === e ? t.right = s : t.left = s,
            s.parent = t,
            this._balance(o),
            !0;
        for (s = s.left; null !== s.left; )
            s = s.left;
        return null !== s.right && (s.right.parent = s.parent),
        s.parent.left = s.right,
        null !== n && (n.parent = s),
        s.right = n,
        o = s.parent,
        null !== i && (i.parent = s),
        s.left = i,
        null === t ? this.root = s : t.right === e ? t.right = s : t.left = s,
        s.parent = t,
        this._balance(o),
        !0
    }
    ,
    i.prototype.getSmallestAbove = function(e) {
        if (null === this.root)
            return null ;
        for (var t = null , i = this.root; null !== i; ) {
            var n = this.cmpFunc(e, i.object);
            if (n < 0)
                t = i.object,
                i = i.left;
            else {
                if (!(n > 0))
                    return i.object;
                i = i.right
            }
        }
        return t
    }
    ,
    i.prototype.getHeight = function() {
        return this.root.height
    }
    ,
    i.prototype.getRoot = function() {
        return this.root.object
    }
    ,
    i.prototype.getCount = function() {
        return this.count
    }
    ,
    i.prototype._forEach = function(e, t, i) {
        null !== e && (t(e.object, i),
        this._forEach(e.left, t, i),
        this._forEach(e.right, t, i))
    }
    ,
    i.prototype.forEach = function(e, t) {
        this._forEach(this.root, e, t)
    }
    ,
    i.prototype.clear = function() {
        this.count = 0,
        this.root = null
    }
    ,
    e.exports = i
}
, function(e, t) {
    function i(e) {
        this.count = 0,
        this.first = null ,
        this.last = null ,
        this.cmpFunc = e
    }
    function n(e, t, i, n) {
        this.object = e,
        this.previous = t,
        this.next = i,
        this.container = n
    }
    i.prototype.add = function(e) {
        var t = new n(e,null ,null ,this);
        if (this.count += 1,
        null === this.first)
            return this.first = t,
            this.last = t,
            t;
        var i = this.cmpFunc(e, this.first.object);
        if (i < 0)
            return t.next = this.first,
            this.first.previous = t,
            this.first = t,
            t;
        var o = this.cmpFunc(e, this.last.object);
        if (o >= 0)
            return t.previous = this.last,
            this.last.next = t,
            this.last = t,
            t;
        var s;
        if (i + o < 0) {
            for (s = this.first.next; this.cmpFunc(e, s.object) >= 0; )
                s = s.next;
            t.next = s,
            t.previous = s.previous,
            t.previous.next = t,
            s.previous = t
        } else {
            for (s = this.last.previous; this.cmpFunc(e, s.object) < 0; )
                s = s.previous;
            t.previous = s,
            t.next = s.next,
            t.next.previous = t,
            s.next = t
        }
        return t
    }
    ,
    i.prototype.removeByRef = function(e) {
        return !(!e || e.container !== this) && (this.count -= 1,
        null === e.previous ? this.first = e.next : e.previous.next = e.next,
        null === e.next ? this.last = e.previous : e.next.previous = e.previous,
        e.previous = null ,
        e.next = null ,
        e.container = null ,
        !0)
    }
    ,
    i.prototype.moveToTheBeginning = function(e) {
        return !(!e || e.container !== this) && (null === e.previous || (e.previous.next = e.next,
        this.last === e ? this.last = e.previous : e.next.previous = e.previous,
        e.previous = null ,
        e.next = this.first,
        e.next.previous = e,
        this.first = e,
        !0))
    }
    ,
    i.prototype.moveToTheEnd = function(e) {
        return !(!e || e.container !== this) && (null === e.next || (e.next.previous = e.previous,
        this.first === e ? this.first = e.next : e.previous.next = e.next,
        e.next = null ,
        e.previous = this.last,
        e.previous.next = e,
        this.last = e,
        !0))
    }
    ,
    i.prototype.possess = function(e) {
        return e && e.container === this
    }
    ,
    i.prototype.popFirst = function() {
        var e = this.first;
        if (!e)
            return null ;
        this.count -= 1;
        var t = e.object;
        return this.first = e.next,
        null !== this.first && (this.first.previous = null ),
        e.next = null ,
        e.container = null ,
        t
    }
    ,
    i.prototype.popLast = function() {
        var e = this.last;
        if (!e)
            return null ;
        this.count -= 1;
        var t = e.object;
        return this.last = e.previous,
        null !== this.last && (this.last.next = null ),
        e.previous = null ,
        e.container = null ,
        t
    }
    ,
    i.prototype.getFirst = function() {
        return this.first && this.first.object
    }
    ,
    i.prototype.getLast = function() {
        return this.last && this.last.object
    }
    ,
    i.prototype.clear = function() {
        for (var e = this.first; e; e = e.next)
            e.container = null ;
        this.count = 0,
        this.first = null ,
        this.last = null
    }
    ,
    i.prototype.getCount = function() {
        return this.count
    }
    ,
    i.prototype.toArray = function() {
        for (var e = [], t = this.first; t; t = t.next)
            e.push(t.object);
        return e
    }
    ,
    i.prototype.forEach = function(e, t) {
        for (var i = this.first; i; i = i.next)
            e(i.object, t)
    }
    ,
    i.prototype.forEachReverse = function(e, t) {
        for (var i = this.last; i; i = i.previous)
            e(i.object, t)
    }
    ,
    i.prototype.reposition = function(e) {
        if (e.container !== this)
            return this.add(e.object);
        var t = e.previous
          , i = e.next
          , n = e.object;
        for (null === i ? this.last = t : i.previous = t,
        null === t ? this.first = i : t.next = i; null !== t && this.cmpFunc(n, t.object) < 0; )
            i = t,
            t = t.previous;
        for (; null !== i && this.cmpFunc(n, i.object) >= 0; )
            t = i,
            i = i.next;
        return e.next = i,
        null === i ? this.last = e : i.previous = e,
        e.previous = t,
        null === t ? this.first = e : t.next = e,
        e
    }
    ,
    e.exports = i
}
, function(e, t, i) {
    function n(e, t) {
        this.program = e,
        this.data = t || null
    }
    function o(e, t, i, n, o) {
        this.binder = null ,
        this.vertexShaderId = t,
        this.fragmentShaderId = i,
        this.uniformIds = n,
        this.attributeIds = o,
        this.uniforms = {},
        this.attributes = {},
        this.lastAttributeIndex = o.length - 1,
        this.vertexSize = e._vertexSize,
        this.gl = e.gl
    }
    function s(e, t, i, n, s) {
        o.call(this, e, t, i, n, s)
    }
    var a = i(269)
      , r = {
        uTexture: 0,
        uMask: 1
    };
    o.prototype.setAttributes = function() {
        var e = 4
          , t = 2
          , i = 1;
        this.gl.vertexAttribPointer(this.attributes.aPosition, 2, this.gl.FLOAT, !1, this.vertexSize, 0),
        this.gl.vertexAttribPointer(this.attributes.aColorMul, 4, this.gl.BYTE, !0, this.vertexSize, 2 * e + 2 * t),
        this.gl.vertexAttribPointer(this.attributes.aColorAdd, 4, this.gl.BYTE, !0, this.vertexSize, 2 * e + 2 * t + 4 * i)
    }
    ,
    s.prototype.setAttributes = function() {
        var e = 4
          , t = 2
          , i = 1;
        this.gl.vertexAttribPointer(this.attributes.aPosition, 2, this.gl.FLOAT, !1, this.vertexSize, 0),
        this.gl.vertexAttribPointer(this.attributes.aTexCoord, 2, this.gl.UNSIGNED_SHORT, !0, this.vertexSize, 2 * e),
        this.gl.vertexAttribPointer(this.attributes.aColorMul, 4, this.gl.BYTE, !0, this.vertexSize, 2 * e + 2 * t),
        this.gl.vertexAttribPointer(this.attributes.aColorAdd, 4, this.gl.BYTE, !0, this.vertexSize, 2 * e + 2 * t + 4 * i)
    }
    ,
    a.prototype._initPrograms = function() {
        this._shaders = {};
        var e = ["uMatrix"]
          , t = ["uMatrix"]
          , i = ["uMatrix", "uTexture"]
          , n = ["uMatrix", "uTexture", "uRatio"]
          , a = ["uMatrix", "uTexture", "uMask", "uBbox"]
          , r = ["aPosition", "aColorMul", "aColorAdd"];
        this._programLine = new o(this,"vertexLine","fragmentLine",e,r),
        this._programBox = new o(this,"vertexBox","fragmentBox",t,r);
        var l = ["aPosition", "aTexCoord", "aColorMul", "aColorAdd"];
        this._programMask = new s(this,"vertexMask","fragmentMask",a,l),
        this._programAbsoluteScale = new s(this,"vertexAbsoluteScale","fragmentRegular",i,l),
        this._programPixelArt = new s(this,"vertexRegular","fragmentPixelArt",n,l),
        this._programFiltering = new s(this,"vertexRegular","fragmentFiltering",n,l),
        this._programMapTransition = new s(this,"vertexRegular","fragmentMapTransition",n,l),
        this._programRegular = new s(this,"vertexRegular","fragmentRegular",i,l),
        this._currentProgram = {
            lastAttributeIndex: -1
        }
    }
    ,
    a.prototype._getShader = function(e) {
        if (this._shaders[e])
            return this._shaders[e];
        var t, i = this.gl, n = a.shadersData[e];
        if ("fragment" === n.type)
            t = i.createShader(i.FRAGMENT_SHADER);
        else {
            if ("vertex" !== n.type)
                return null ;
            t = i.createShader(i.VERTEX_SHADER)
        }
        if (i.shaderSource(t, n.script),
        i.compileShader(t),
        !i.getShaderParameter(t, i.COMPILE_STATUS))
            throw new Error(i.getShaderInfoLog(t));
        return this._shaders[e] = t,
        t
    }
    ,
    a.prototype._buildProgram = function(e) {
        var t = this.gl
          , i = t.createProgram();
        if (t.attachShader(i, this._getShader(e.vertexShaderId)),
        t.attachShader(i, this._getShader(e.fragmentShaderId)),
        t.linkProgram(i),
        !t.getProgramParameter(i, t.LINK_STATUS)) {
            var n = t.getProgramInfoLog(i);
            throw t.deleteProgram(i),
            new Error("Error linking the program:" + n)
        }
        t.useProgram(i);
        for (var o = e.attributeIds, s = e.attributes, a = 0; a < o.length; a += 1) {
            var l = o[a];
            s[l] = t.getAttribLocation(i, l)
        }
        for (var c = e.uniformIds, u = e.uniforms, h = 0; h < c.length; h += 1) {
            var d = c[h]
              , p = t.getUniformLocation(i, d);
            r[d] && t.uniform1i(p, r[d]),
            u[d] = p
        }
        e.binder = i
    }
    ,
    a.prototype._useProgram = function(e) {
        var t = e.program;
        if (t !== this._currentProgram) {
            var i, n = this._currentProgram.lastAttributeIndex, o = t.lastAttributeIndex;
            if (n > o)
                for (i = n; i > o; i -= 1)
                    this.gl.disableVertexAttribArray(i);
            else if (n < o)
                for (i = n + 1; i <= o; i += 1)
                    this.gl.enableVertexAttribArray(i);
            var s = t.binder;
            null === s ? this._buildProgram(t) : this.gl.useProgram(t.binder),
            t.setAttributes(),
            this._currentProgram = t
        }
        var a = e.data;
        if (null !== a) {
            var r = this.gl;
            void 0 !== a.mask && (r.activeTexture(r.TEXTURE1),
            r.bindTexture(r.TEXTURE_2D, a.mask),
            r.activeTexture(r.TEXTURE0)),
            void 0 !== a.ratio && r.uniform1f(this._currentProgram.uniforms.uRatio, a.ratio),
            void 0 !== a.resolution && r.uniform1f(this._currentProgram.uniforms.uResolution, a.resolution)
        }
    }
    ,
    a.prototype.useProgram = function(e, t) {
        var i = new n(e,t);
        this._programs.push(i),
        this._useProgram(i)
    }
    ,
    a.prototype.stopProgram = function() {
        this._programs.pop(),
        this._useProgram(this._programs[this._programs.length - 1])
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        this.textureBinder = e,
        this.frameBufferBinder = t,
        this.width = i,
        this.height = n,
        this.matrixStack = [[2, 0, -1, 0, 0, -2, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0]],
        this.scissor = null ,
        this.texture = null
    }
    var o = i(269);
    o.prototype._createRenderTarget = function(e, t, i, o) {
        return new n(e,t,i,o)
    }
    ,
    o.prototype._setScissor = function(e) {
        var t = this.gl;
        null === e ? t.disable(t.SCISSOR_TEST) : (t.enable(t.SCISSOR_TEST),
        t.scissor(e[0], e[1], e[2], e[3]))
    }
    ,
    o.prototype.enableScissor = function(e, t, i, n) {
        var o = [e, t, i, n];
        this._renderTarget.scissor = o,
        this._setScissor(o)
    }
    ,
    o.prototype.disableScissor = function() {
        var e = null ;
        this._renderTarget.scissor = e,
        this._setScissor(e)
    }
    ,
    o.prototype.startTextureUsage = function(e, t, i, o, s) {
        var a = this.gl;
        i = i || this.prerenderRatio,
        e = Math.min(Math.ceil(e * i), this._maxTextureSize),
        t = Math.min(Math.ceil(t * i), this._maxTextureSize);
        var r = a.createTexture()
          , l = a.createFramebuffer()
          , c = new n(r,l,e,t);
        a.bindTexture(a.TEXTURE_2D, r),
        a.texImage2D(a.TEXTURE_2D, 0, a.RGBA, e, t, 0, a.RGBA, a.UNSIGNED_BYTE, null ),
        this._setFiltering(c, s),
        a.bindFramebuffer(a.FRAMEBUFFER, l),
        a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, r, 0),
        a.bindFramebuffer(a.FRAMEBUFFER, this._renderTarget.frameBufferBinder);
        var u = {
            binder: r,
            width: e,
            height: t
        };
        return c.texture = this.textureCache.addAndHoldElement(u, 4 * e * t, o),
        c
    }
    ,
    o.prototype._setRenderTarget = function(e, t) {
        var i = this.gl;
        this._renderTarget = e,
        i.bindFramebuffer(i.FRAMEBUFFER, e.frameBufferBinder),
        i.viewport(0, 0, e.width, e.height),
        this._setScissor(e.scissor),
        t && i.clear(i.COLOR_BUFFER_BIT),
        this._matrixStack = e.matrixStack
    }
    ,
    o.prototype.startTextureRendering = function(e, t, i, n, o, s) {
        this._renderTargetStack.push(e),
        this._setRenderTarget(e, s);
        var a = 2 / Math.max(i - t, 1)
          , r = 2 / Math.max(o - n, 1)
          , l = this._matrixStack[0];
        l[0] = a,
        l[4] = 0,
        l[1] = 0,
        l[5] = r,
        l[2] = -t * a - 1,
        l[6] = -n * r - 1,
        l[8] = 1,
        l[9] = 1,
        l[10] = 1,
        l[11] = 1,
        l[12] = 0,
        l[13] = 0,
        l[14] = 0,
        l[15] = 0
    }
    ,
    o.prototype.stopTextureRendering = function(e) {
        var t = this._renderTargetStack.pop();
        this._setRenderTarget(this._renderTargetStack[this._renderTargetStack.length - 1]),
        e && this.gl.deleteFramebuffer(t.frameBufferBinder)
    }
    ,
    o.prototype._debugRenderTarget = function() {
        var e = this._renderTargetStack[this._renderTargetStack.length - 1]
          , t = e.width
          , i = e.height
          , n = this.gl
          , o = new Uint8Array(t * i * 4);
        n.readPixels(0, 0, t, i, n.RGBA, n.UNSIGNED_BYTE, o);
        for (var s = o.length, a = 0, r = 3; r < s; r += 4)
            a += o[r];
        var l = document.createElement("canvas")
          , c = l.getContext("2d");
        l.width = t,
        l.height = i,
        document.body.appendChild(l),
        l.style.position = "absolute",
        l.style.left = "100px",
        l.style.top = "100px";
        var u = c.getImageData(0, 0, t, i)
          , h = u.data;
        for (r = 3; r < s; r += 4)
            h[r - 3] = o[r - 3],
            h[r - 2] = o[r - 2],
            h[r - 1] = o[r - 1],
            h[r - 0] = o[r - 0];
        c.putImageData(u, 0, 0),
        c.fillRect(t / 2 - 5, i / 2 - 5, 10, 10)
    }
}
, function(e, t, i) {
    var n = i(269);
    n.prototype.initBuffer = function(e) {
        var t = this.gl
          , i = t.createBuffer();
        t.bindBuffer(t.ARRAY_BUFFER, i);
        var n = new ArrayBuffer(e * this._spriteSize)
          , o = new Float32Array(n)
          , s = new Uint32Array(n);
        o[0] = 0,
        o[1] = 0,
        s[2] = 0,
        o[5] = 0,
        o[6] = 1,
        s[7] = 4294901760,
        o[10] = 1,
        o[11] = 1,
        s[12] = 4294967295,
        o[15] = 0,
        o[16] = 0,
        s[17] = 0,
        o[20] = 1,
        o[21] = 1,
        s[22] = 4294967295,
        o[25] = 1,
        o[26] = 0,
        s[27] = 65535,
        s[3] = s[8] = s[13] = s[18] = s[23] = s[28] = 1077952576,
        s[4] = s[9] = s[14] = s[19] = s[24] = s[29] = 0,
        t.bufferData(t.ARRAY_BUFFER, n, t.STATIC_DRAW)
    }
    ,
    n.prototype.updateGPUBuffer = function(e, t) {
        var i = this.gl;
        i.bufferSubData(i.ARRAY_BUFFER, e, t)
    }
    ,
    n.prototype.isInBuffer = function(e) {
        return this.sFMPartitioner.possess(e)
    }
    ,
    n.prototype.getBufferData = function(e) {
        return this.sFMPartitioner.touch(e)
    }
    ,
    n.prototype.lockBuffer = function(e) {
        return this.sFMPartitioner.addLock(e)
    }
    ,
    n.prototype.releaseBuffer = function(e) {
        return this.sFMPartitioner.release(e)
    }
    ,
    n.prototype.unlockBuffer = function(e) {
        this.sFMPartitioner.removeLock(e)
    }
}
, function(e, t, i) {
    function n(e) {
        return 0 === (e & e - 1)
    }
    var o = i(269);
    o.prototype._setFiltering = function(e, t, i) {
        var o = this.gl
          , s = o.LINEAR
          , a = o.LINEAR;
        switch (t) {
        case "nearest":
            a = o.NEAREST;
            break;
        case "mipmap":
            n(e.width) && n(e.height) ? (s = o.LINEAR_MIPMAP_LINEAR,
            o.generateMipmap(o.TEXTURE_2D)) : console.warn("[WebGLRenderer._setFiltering]", "Cannot build mipmap from image", i, " because its dimensions are not a power of 2.")
        }
        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, s),
        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, a),
        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE),
        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE)
    }
    ,
    o.prototype.holdTexture = function(e) {
        return this.textureCache.holdElement(e)
    }
    ,
    o.prototype.useTexture = function(e) {
        return this.textureCache.useElement(e)
    }
    ,
    o.prototype.createTexture = function(e, t, i, n) {
        var o = this.textureCache.holdElement(t);
        if (o)
            return o;
        var s = this.gl
          , a = s.createTexture();
        s.bindTexture(s.TEXTURE_2D, a),
        s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !0),
        s.texImage2D(s.TEXTURE_2D, 0, s.RGBA, s.RGBA, s.UNSIGNED_BYTE, e),
        this._setFiltering(e, i, t);
        var r = {
            binder: a,
            width: e.width,
            height: e.height
        };
        return this.textureCache.addAndHoldElement(r, 4 * e.width * e.height, t, n)
    }
    ,
    o.prototype.getEmptyTexture = function() {
        return this.emptyTexture
    }
}
, function(e, t, i) {
    var n = i(269);
    n.prototype.save = function() {
        this._matrixStack.unshift(this._matrixStack[0].slice())
    }
    ,
    n.prototype.restore = function() {
        this._matrixStack.shift()
    }
    ,
    n.prototype.setTransform = function(e, t, i, n, o, s, a, r) {
        var l = this._matrixStack[0];
        a = 2 / (a || this._width),
        r = -2 / (r || this._height),
        l[0] = e * a,
        l[4] = t * r,
        l[1] = i * a,
        l[5] = n * r,
        l[2] = o * a - 1,
        l[6] = s * r + 1
    }
    ,
    n.prototype.rotate = function(e) {
        if (0 !== e) {
            var t = this._matrixStack[0]
              , i = Math.cos(e)
              , n = Math.sin(e)
              , o = t[0]
              , s = t[4]
              , a = t[1]
              , r = t[5];
            t[0] = o * i + a * n,
            t[4] = s * i + r * n,
            t[1] = a * i - o * n,
            t[5] = r * i - s * n
        }
    }
    ,
    n.prototype.translate = function(e, t) {
        var i = this._matrixStack[0];
        i[2] += i[0] * e + i[1] * t,
        i[6] += i[4] * e + i[5] * t
    }
    ,
    n.prototype.scale = function(e, t) {
        var i = this._matrixStack[0];
        i[0] *= e,
        i[4] *= e,
        i[1] *= t,
        i[5] *= t
    }
    ,
    n.prototype.transform = function(e, t, i, n, o, s) {
        var a = this._matrixStack[0]
          , r = a[0]
          , l = a[4]
          , c = a[1]
          , u = a[5]
          , h = a[2]
          , d = a[6];
        a[0] = r * e + c * t,
        a[4] = l * e + u * t,
        a[1] = r * i + c * n,
        a[5] = l * i + u * n,
        a[2] = r * o + c * s + h,
        a[6] = l * o + u * s + d
    }
    ,
    n.prototype.getTransform = function() {
        var e = this._matrixStack[0];
        return [e[0], e[4], e[1], e[5], e[2], e[6]]
    }
    ,
    n.prototype.setTint = function(e, t, i, n, o, s, a, r) {
        var l = this._matrixStack[0];
        l[8] = e,
        l[9] = t,
        l[10] = i,
        l[11] = n,
        l[12] = o / 255,
        l[13] = s / 255,
        l[14] = a / 255,
        l[15] = r / 255
    }
    ,
    n.prototype.tint = function(e, t, i, n, o, s, a, r) {
        var l = this._matrixStack[0]
          , c = l[8]
          , u = l[9]
          , h = l[10]
          , d = l[11];
        l[8] = e * c,
        l[9] = t * u,
        l[10] = i * h,
        l[11] = n * d,
        l[12] = o / 255 + l[12] * e,
        l[13] = s / 255 + l[13] * t,
        l[14] = a / 255 + l[14] * i,
        l[15] = r / 255 + l[15] * n
    }
    ,
    n.prototype.setTintMult = function(e, t, i, n) {
        var o = this._matrixStack[0];
        o[8] = e,
        o[9] = t,
        o[10] = i,
        o[11] = n
    }
    ,
    n.prototype.setTintAdd = function(e, t, i, n) {
        var o = this._matrixStack[0];
        o[12] = e / 255,
        o[13] = t / 255,
        o[14] = i / 255,
        o[15] = n / 255
    }
    ,
    n.prototype.multiplyColor = function(e, t, i, n) {
        var o = this._matrixStack[0];
        o[8] *= e,
        o[9] *= t,
        o[10] *= i,
        o[11] *= n
    }
    ,
    n.prototype.addColor = function(e, t, i, n) {
        var o = this._matrixStack[0];
        o[12] += e * o[8] / 255,
        o[13] += t * o[9] / 255,
        o[14] += i * o[10] / 255,
        o[15] += n * o[11] / 255
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var o = n.vertexPos
          , s = n.textureCoord
          , a = n.color;
        e[i + 0] = o[0],
        e[i + 1] = o[1],
        t[i + 2] = (65535 * s[0] & 65535) + (4294901760 * s[1] & 4294901760),
        e[i + 5] = o[4],
        e[i + 6] = o[5],
        t[i + 7] = (65535 * s[0] & 65535) + (4294901760 * s[3] & 4294901760),
        e[i + 10] = o[6],
        e[i + 11] = o[7],
        t[i + 12] = (65535 * s[2] & 65535) + (4294901760 * s[3] & 4294901760),
        e[i + 15] = o[0],
        e[i + 16] = o[1],
        t[i + 17] = (65535 * s[0] & 65535) + (4294901760 * s[1] & 4294901760),
        e[i + 20] = o[6],
        e[i + 21] = o[7],
        t[i + 22] = (65535 * s[2] & 65535) + (4294901760 * s[3] & 4294901760),
        e[i + 25] = o[2],
        e[i + 26] = o[3],
        t[i + 27] = (65535 * s[2] & 65535) + (4294901760 * s[1] & 4294901760);
        var r = Math.max(-128, Math.min(127, 64 * a[0]))
          , l = Math.max(-128, Math.min(127, 64 * a[1]))
          , c = Math.max(-128, Math.min(127, 64 * a[2]))
          , u = Math.max(-128, Math.min(127, 64 * a[3]))
          , h = Math.max(-128, Math.min(127, 128 * a[4]))
          , d = Math.max(-128, Math.min(127, 128 * a[5]))
          , p = Math.max(-128, Math.min(127, 128 * a[6]))
          , m = Math.max(-128, Math.min(127, 128 * a[7]))
          , f = (u << 24 & 4278190080) + (c << 16 & 16711680) + (l << 8 & 65280) + (255 & r)
          , g = (m << 24 & 4278190080) + (p << 16 & 16711680) + (d << 8 & 65280) + (255 & h);
        t[i + 3] = t[i + 8] = t[i + 13] = f,
        t[i + 18] = t[i + 23] = t[i + 28] = f,
        t[i + 4] = t[i + 9] = t[i + 14] = g,
        t[i + 19] = t[i + 24] = t[i + 29] = g
    }
    function o(e, t, i, n) {
        this.nBytes = t,
        this.drawMode = i,
        this.texture = n || null ,
        this.startingByte = e
    }
    function s(e, t, i) {
        this.bbox = t,
        this.prerender = i,
        this.spriteBatches = e
    }
    var a = i(269);
    a.prototype.prepareBatchFromSpriteList = function(e, t, i) {
        i = !!i;
        for (var a = t.spriteBatch, r = a.length - 1, l = t.nbSprites * this._spriteSize, c = this.sFMPartitioner.reserve(e, l), u = c.start, h = u, d = u, p = new ArrayBuffer(l), m = new Float32Array(p), f = new Uint32Array(p), g = this._spriteSize / 4, _ = 0, v = [], y = 0; y <= r; y += 1) {
            var w = a[y];
            if (w.isMaskTag)
                i = !0,
                v.push(w);
            else {
                n(m, f, _ * g, w),
                d += this._spriteSize,
                _ += 1;
                var b = a[y + 1];
                (y === r || w.texture !== b.texture || b.isMaskTag) && (v.push(new o(h,d - h,this._drawModes.triangles,w.texture)),
                h = d)
            }
        }
        this.updateGPUBuffer(u, m),
        c.obj = new s(v,t.bbox,i)
    }
    ,
    a.prototype.loadSpriteBuffer = function(e, t, i, n, o) {
        this._loadVertexBuffer(e, t, i, n, this._drawModes.triangles, o)
    }
    ,
    a.prototype.loadLineBuffer = function(e, t, i, n) {
        this._loadVertexBuffer(e, t, null , i, this._drawModes.lines, n)
    }
    ,
    a.prototype._loadVertexBuffer = function(e, t, i, n, a, r) {
        var l = t.byteLength
          , c = this.sFMPartitioner.reserve(e, l)
          , u = c.start
          , h = new o(u,l,a,i);
        c.obj = new s([h],n,r),
        this.updateGPUBuffer(u, t)
    }
    ,
    a.prototype.updateVertexBuffer = function(e, t, i, n) {
        var o = this.sFMPartitioner.getChunk(e);
        if (void 0 === o)
            return void console.warn("[WebGLRenderer.updateVertexBuffer] No buffer loaded for", e);
        var s = o.start;
        this.updateGPUBuffer(s + i, t, n)
    }
    ,
    a.prototype.drawLineBatch = function(e, t) {
        this.useProgram(this._programLine),
        this.gl.lineWidth(t);
        var i = this.sFMPartitioner.touch(e);
        return void 0 === i ? (console.warn("[WebGLRenderer.drawLineBatch] No buffer loaded for", e),
        void this.stopProgram()) : (this._drawBatch(i),
        void this.stopProgram())
    }
    ,
    a.prototype.drawBoxBatch = function(e) {
        this.useProgram(this._programBox);
        var t = this.sFMPartitioner.touch(e);
        return void 0 === t ? (console.warn("[WebGLRenderer.drawBoxBatch] No buffer loaded for", e),
        void this.stopProgram()) : (this._drawBatch(t),
        void this.stopProgram())
    }
    ,
    a.prototype.drawSpriteBatchAbsoluteScale = function(e, t) {
        this.useProgram(this._programAbsoluteScale);
        var i = this._matrixStack[0];
        i[3] = t / this._renderTarget.width,
        i[7] = t / this._renderTarget.height,
        this.drawSpriteBatch(e),
        this.stopProgram()
    }
    ,
    a.prototype.drawSpriteBatch = function(e) {
        var t = this.sFMPartitioner.touch(e);
        if (void 0 === t)
            return void console.warn("[WebGLRenderer.drawSpriteBatch] No buffer loaded for", e);
        if (t.prerender) {
            var i = this.textureCache.holdElement(e)
              , n = t.bbox;
            if (void 0 === i) {
                var o = n[0]
                  , s = n[1]
                  , a = n[2]
                  , r = n[3]
                  , l = this._matrixStack[0]
                  , c = this._renderTarget.width * l[0] / 2
                  , u = this._renderTarget.width * l[4] / 2
                  , h = this._renderTarget.height * l[1] / 2
                  , d = this._renderTarget.height * l[5] / 2
                  , p = Math.sqrt(Math.max(c * c + u * u, h * h + d * d)) * this.prerenderRatio
                  , m = this.startTextureUsage(s - o, r - a, p, e, "nearest");
                this.startTextureRendering(m, o, s, a, r),
                this._drawBatch(t),
                this.stopTextureRendering(!0, !0),
                i = m.texture
            }
            this.drawImage(i, n[0], n[2], n[1] - n[0], n[3] - n[2]),
            i.release()
        } else
            this._drawBatch(t)
    }
    ,
    a.prototype.handleMaskTag = function(e, t, i) {
        if (e.isMaskDef) {
            var n = t[0]
              , o = t[1]
              , s = t[2]
              , a = t[3]
              , r = this.startTextureUsage(o - n, a - s, this.maskQuality);
            return this.startTextureRendering(r, n, o, s, a),
            void i.push(r)
        }
        var l = this.gl;
        return e.isMaskUse ? (this.useProgram(this._programMask, {
            mask: this._renderTarget.textureBinder
        }),
        l.uniform4fv(this._currentProgram.uniforms.uBbox, t),
        void this.stopTextureRendering(!0, !0)) : e.isMaskStop ? (i.pop().texture.release(),
        void this.stopProgram()) : void 0
    }
    ,
    a.prototype._drawBatch = function(e) {
        for (var t = e.spriteBatches, i = null , n = 0; n < t.length; n += 1) {
            var o = t[n];
            if (o.isMaskTag)
                null === i && (i = []),
                this.handleMaskTag(o, e.bbox, i);
            else {
                var s = o.startingByte / this._vertexSize
                  , a = o.nBytes / this._vertexSize;
                this._drawSubBatch(s, a, o.texture, o.drawMode)
            }
        }
    }
    ,
    a.prototype.drawSpriteSubBatch = function(e, t, i) {
        var n = this.sFMPartitioner.touch(e);
        if (void 0 === n)
            return void console.warn("[WebGLRenderer.drawSpriteSubBatch] No buffer loaded for", e);
        var o = n.spriteBatches[0]
          , s = o.startingByte / this._vertexSize + t
          , a = i - t;
        this._drawSubBatch(s, a, o.texture, o.drawMode)
    }
    ,
    a.prototype._drawSubBatch = function(e, t, i, n) {
        if (!(t <= 0)) {
            var o = this.gl;
            if (null !== i) {
                var s = this.textureCache.useElement(i.id);
                if (void 0 === s)
                    return void console.warn("[WebGLRenderer._drawSubBatch] Texture not loaded:", i.id);
                o.bindTexture(o.TEXTURE_2D, s.element.binder)
            }
            o.uniformMatrix4fv(this._currentProgram.uniforms.uMatrix, !1, this._matrixStack[0]),
            o.drawArrays(n, e, t)
        }
    }
}
, function(e, t) {
    e.exports = {
        DIRECTION_EAST: 0,
        DIRECTION_SOUTH_EAST: 1,
        DIRECTION_SOUTH: 2,
        DIRECTION_SOUTH_WEST: 3,
        DIRECTION_WEST: 4,
        DIRECTION_NORTH_WEST: 5,
        DIRECTION_NORTH: 6,
        DIRECTION_NORTH_EAST: 7
    }
}
, function(e, t) {
    function i() {
        this._type = null ,
        this.alive = !0,
        this.teamId = 0,
        this.isCarryied = !1,
        this.disposition = {
            cellId: -1,
            direction: 0,
            carryingCharacterId: 0
        },
        this.look = null ,
        this.stats = {
            actionPoints: 0,
            airElementReduction: 0,
            airElementResistPercent: 0,
            baseMaxLifePoints: 0,
            criticalDamageFixedResist: 0,
            dodgePALostProbability: 0,
            dodgePMLostProbability: 0,
            earthElementReduction: 0,
            earthElementResistPercent: 0,
            fireElementReduction: 0,
            fireElementResistPercent: 0,
            invisibilityState: 0,
            initiative: 0,
            lifePoints: 0,
            maxActionPoints: 0,
            maxLifePoints: 0,
            maxMovementPoints: 0,
            movementPoints: 0,
            neutralElementReduction: 0,
            neutralElementResistPercent: 0,
            permanentDamagePercent: 0,
            pushDamageFixedResist: 0,
            shieldPoints: 0,
            summoned: !1,
            summoner: 0,
            tackleBlock: 0,
            tackleEvade: 0,
            waterElementReduction: 0,
            waterElementResistPercent: 0
        }
    }
    function n(e, t) {
        for (var i in e)
            void 0 !== t[i] && (e[i] = t[i])
    }
    e.exports = i,
    i.prototype.updateData = function(e) {
        void 0 !== e._type && (this._type = e._type),
        void 0 !== e.alive && (this.alive = e.alive),
        void 0 !== e.teamId && (this.teamId = e.teamId),
        e.disposition && n(this.disposition, e.disposition),
        e.look && (this.look = e.look),
        e.stats && n(this.stats, e.stats)
    }
    ,
    i.prototype.pointVariation = function(e, t) {
        this.stats[e] += t,
        this.stats[e] < 0 && (this.stats[e] = 0)
    }
}
, function(e, t, i) {
    function n(e) {
        I.preloadImage("ui/SpellPlaceholder.png", function(e) {
            t.placeHolder = e
        }),
        E([A], null , function(t, i) {
            return t ? e(t) : (_ = i,
            void e())
        })
    }
    function o(e, t) {
        return e ? console.error(e) : void console.log("data:", t)
    }
    function s() {
        return ++R
    }
    function a() {
        this._uid = s()
    }
    function r(e, t, i) {
        var n = this;
        this.id = parseInt(e, 10),
        this.ownerId = null ,
        this.position = null ,
        this.isItem = !1,
        this.level = null ,
        this.isLoaded = !1,
        this.spell = null ,
        this._tables = {},
        E(e, t, function(e, t) {
            return e ? i(e) : (n.effectInstances = t.effectInstances,
            delete t.effectInstances,
            n._tables = t,
            n.spell = t.spells[n.id],
            n.setLevel(n.level || 1),
            n.isLoaded = !0,
            void i())
        })
    }
    function l(e) {
        this.id = A,
        this.ownerId = null ,
        this.position = null ,
        this.isItem = !0,
        this.level = 1,
        this._item = e,
        this.effectInstances = {};
        for (var t = 0; t < this._item.effects.length; t++)
            this.effectInstances[this.getSpellLevelId() + "-effects-" + t] = this._item.effects[t];
        if (!e.isInitialised) {
            var i = this;
            return e.once("initialised", function() {
                l.call(i, e)
            })
        }
        this.isLoaded = !0
    }
    function c() {
        this.castingData = {
            lastCastTurn: 0,
            targetsThisTurn: {},
            castThisTurn: 0,
            lastInitialCooldownReset: 0
        }
    }
    function u(e, t) {
        e instanceof Array || (e = [e]),
        E(e, function(i, n) {
            if (i)
                return t(i);
            var o = {};
            v.each(e, function(e, t) {
                if (o[e] = new a,
                ~~e === A) {
                    var i = window.gui.playerData.inventory.getCurrentWeapon();
                    if (i)
                        return l.call(o[e], i),
                        t()
                }
                r.call(o[e], e, n, t)
            }, function(e) {
                return e ? t(e) : void t(null , o)
            })
        })
    }
    function h(e, t, i) {
        return t && t.spells ? i(null , b.extractElementsFrom(e, t.spells, !0)) : void C.getData("Spells", e, function(t, n) {
            return t ? i(t) : void i(null , b.extractElementsFrom(e, n, !0))
        })
    }
    function d(e, t, i) {
        var n = {};
        for (var o in e.spells)
            for (var s = e.spells[o], a = 0; a < s.spellLevels.length; a++)
                n[s.spellLevels[a]] = !0;
        return n = Object.keys(n),
        0 === n.length ? i(null , {}) : t && t.spellLevels ? i(null , b.extractElementsFrom(n, t.spellLevels, !0)) : void C.getData("SpellLevels", n, function(e, t) {
            return e ? i(e) : void i(null , b.extractElementsFrom(n, t, !0))
        })
    }
    function p(e, t, i) {
        var n = {};
        for (var o in e.spellLevels) {
            var s, a = e.spellLevels[o];
            for (s = 0; s < a.statesRequired.length; s++)
                n[a.statesRequired[s]] = !0;
            for (s = 0; s < a.statesForbidden.length; s++)
                n[a.statesForbidden[s]] = !0
        }
        return n = Object.keys(n),
        0 === n.length ? i(null , {}) : t && t.spellStates ? i(null , b.extractElementsFrom(n, t.spellStates, !0)) : void C.getData("SpellStates", n, function(e, t) {
            return e ? i(e) : void i(null , b.extractElementsFrom(n, t, !0))
        })
    }
    function m(e, t, i) {
        var n, o, s = {}, a = {}, r = ["effects", "criticalEffect"];
        for (var l in e.spellLevels)
            if (e.spellLevels.hasOwnProperty(l))
                for (var c = e.spellLevels[l], u = 0; u < r.length; u++) {
                    var h = r[u];
                    for (o = 0; o < c[h].length; o++)
                        n = l + "-" + h + "-" + o,
                        t && t.effectInstances && t.effectInstances[n] ? a[n] = t.effectInstances[n] : s[n] = c[h][o]
                }
        return 0 === Object.keys(s).length ? i(null , a) : void y.createEffectInstancesIndexed(s, function(e, t) {
            if (e)
                return i(e);
            if (0 === Object.keys(a).length)
                return i(null , t);
            for (var n in a)
                a.hasOwnProperty(n) && (t[n] = a[n]);
            i(null , t)
        })
    }
    function f(e, t, i) {
        function n(e, i) {
            var n = e.getProperty(t)
              , o = i.getProperty(t);
            return n > o ? -a : n < o ? a : e.id > i.id ? -a : void 0
        }
        var o = Array.isArray(e) ? e : [];
        if (!o.length)
            for (var s in e)
                o.push(e[s]);
        var a = i ? 1 : -1;
        return o.sort(n)
    }
    function g(e, t) {
        for (var i in t)
            if (t.hasOwnProperty(i)) {
                e[i] || (e[i] = {});
                for (var n in t[i])
                    t[i].hasOwnProperty(n) && (e[i][n] = t[i][n])
            }
    }
    var _, v = i(12), y = i(224), w = i(227), b = i(210), C = i(36), I = i(5), T = i(6), S = i(282), A = t.WEAPON_SPELL_ID = 0;
    t.placeHolder = T.MISSING_TEXTURE_IMAGE_SRC;
    var E, x, M, N, R = 0;
    a.prototype.setLevel = function(e) {
        return this.isItem ? void (1 !== e && console.warn("Spell#setLevel called on item with level != 1", e)) : (this.level = e,
        !e || e < 1 || e > this.spell.spellLevels.length ? console.error(new Error("invalid level " + e + " for spell #" + this.id)) : void (this.spellLevel = this._getSpellLevelByLevel(this.level)))
    }
    ,
    a.prototype.setPosition = function(e) {
        this.position = e
    }
    ,
    a.prototype._getSpellLevelByLevel = function(e) {
        return this.isItem ? console.error(new Error("Spell#_getSpellLevelByLevel called on item for Spell id " + this.id)) : this._tables.spellLevels[this.spell.spellLevels[e - 1]]
    }
    ,
    a.prototype.getSpellLevelId = function(e) {
        return this.isItem ? "weapon" : (e = void 0 !== e ? e : this.level,
        this._getSpellLevelByLevel(e).id)
    }
    ,
    a.prototype.getZoneEffect = function() {
        for (var e, t = 63, i = this.id === A && window.gui.playerData.inventory.getCurrentWeapon(), n = i ? this._item.effects : this.spellLevel.effects, o = 0; o < n.length; o++) {
            var s = this.effectInstances[this.getSpellLevelId() + "-effects-" + o].getZoneEffect();
            s.zoneShape && s.zoneSize > 0 && s.zoneSize < t && (t = s.zoneSize,
            e = s)
        }
        return e || y.parseZone("P")
    }
    ,
    a.prototype.getZoneEffectWhenCasting = function() {
        for (var e, t = this.id === A && window.gui.playerData.inventory.getCurrentWeapon(), i = t ? this._item.effects : this.spellLevel.effects, n = 0; n < i.length; n++) {
            var o = this.effectInstances[this.getSpellLevelId() + "-effects-" + n].getZoneEffect();
            o.zoneShape && o.zoneSize > 0 && (e = o)
        }
        return e || y.parseZone("P")
    }
    ,
    a.prototype.getHumanReadableZoneInfo = function() {
        return y.getHumanReadableZoneInfo(this.getZoneEffect())
    }
    ,
    a.prototype.getMaxLevel = function() {
        return this.isItem || this.id === A ? 1 : this.spell.spellLevels.length
    }
    ,
    a.prototype.getHumanReadableSpellType = function() {
        return window.gui.databases.SpellTypes[this.getProperty("typeId")].longNameId
    }
    ,
    a.prototype.getEffectsIds = function(e) {
        return this.isItem ? Object.keys(this.effectInstances) : this._getSpellLevelByLevel(e || this.level).effects
    }
    ,
    a.prototype.getCriticalEffectsIds = function(e) {
        return this.isItem ? [] : this._getSpellLevelByLevel(e || this.level).criticalEffect
    }
    ,
    a.prototype.getUpgradeCost = function(e, t) {
        if (this.isItem)
            return null ;
        void 0 === t && void 0 === e ? (e = this.level,
        t = e + 1) : void 0 === t && (t = e,
        e = this.level);
        for (var i = 0, n = 0, o = 1; o <= e; o += 1)
            n += o - 1,
            i += o - 1;
        for (; o <= t; o += 1)
            i += o - 1;
        return i - n
    }
    ,
    a.prototype.getName = function() {
        return this.getProperty("nameId")
    }
    ,
    a.prototype.getProperty = function(e, t) {
        t = t || this.level;
        var i = this.isItem ? M.call(this, e) : N.call(this, e, t);
        if ("range" === e) {
            var n = window.gui.playerData.characters.getControlledCharacter().characteristics;
            if (!n)
                return i;
            var o = n.range
              , s = this.isItem ? M.call(this, "rangeCanBeBoosted") : N.call(this, "rangeCanBeBoosted", t);
            if (s) {
                var a = this.isItem ? M.call(this, "minRange") : N.call(this, "minRange", t)
                  , r = o.base + o.objectsAndMountBonus + o.alignGiftBonus + o.contextModif;
                i + r < a ? i = a : i += r
            }
        }
        return i
    }
    ,
    N = function(e, t) {
        var i, n, o = this._getSpellLevelByLevel(t), s = window.gui.playerData.characters.getSpellModifications;
        switch (e) {
        case "id":
        case "nameId":
        case "descriptionId":
        case "typeId":
        case "iconId":
        case "scriptParams":
        case "scriptParamsCritical":
        case "scriptId":
        case "scriptIdCritical":
        case "spellLevels":
        case "useParamCache":
            return this.spell[e];
        case "minCastInterval":
            if (i = s(this.ownerId, this.id, w.CAST_INTERVAL),
            !i)
                return o[e];
            n = i.value;
            var a = n.contextModif + n.objectsAndMountBonus + n.base + n.alignGiftBonus;
            return o[e] - a;
        case "apCost":
            if (i = s(this.ownerId, this.id, w.AP_COST),
            !i)
                return o[e];
            n = i.value;
            var r = n.contextModif + n.objectsAndMountBonus + n.base + n.alignGiftBonus;
            return o[e] - r;
        case "maxCastPerTurn":
            return i = s(this.ownerId, this.id, w.MAX_CAST_PER_TURN),
            i ? o[e] + i.value.contextModif + i.value.objectsAndMountBonus : o[e];
        case "range":
            return i = s(this.ownerId, this.id, w.RANGE),
            i ? o[e] + i.value.contextModif + i.value.objectsAndMountBonus : o[e];
        case "maxCastPerTarget":
            return i = s(this.ownerId, this.id, w.MAX_CAST_PER_TARGET),
            i ? o[e] + i.value.contextModif + i.value.objectsAndMountBonus : o[e];
        case "castInLine":
            return (i = s(this.ownerId, this.id, w.CAST_LINE)) ? !!o[e] && (n = i.value,
            n.contextModif + n.objectsAndMountBonus + n.base + n.alignGiftBonus === 0) : o[e];
        case "castTestLos":
            return (i = s(this.ownerId, this.id, w.LOS)) ? !!o[e] && (n = i.value,
            n.contextModif + n.objectsAndMountBonus + n.base + n.alignGiftBonus === 0) : o[e];
        case "rangeCanBeBoosted":
            return i = s(this.ownerId, this.id, w.RANGEABLE),
            !i || o[e] ? o[e] : (n = i.value,
            n.contextModif + n.objectsAndMountBonus + n.base + n.alignGiftBonus > 0);
        case "maxStack":
        case "castInDiagonal":
        case "criticalFailureProbability":
        case "spellBreed":
        case "needFreeCell":
        case "needTakenCell":
        case "criticalFailureEndsTurn":
        case "globalCooldown":
        case "statesRequired":
        case "statesForbidden":
        case "minRange":
        case "minPlayerLevel":
        case "canSummon":
        case "canBomb":
            return o[e];
        case "spellLevel":
            return o;
        case "grade":
            return o[e] || t;
        case "isSpellWeapon":
            return this.id === A;
        case "isDefaultSpellWeapon":
            return this.id === A && !window.gui.playerData.inventory.getCurrentWeapon();
        case "criticalHitProbability":
            return x.call(this);
        default:
            return null
        }
    }
    ,
    M = function(e) {
        var t = this._item.item;
        switch (e) {
        case "nameId":
        case "descriptionId":
        case "apCost":
        case "iconId":
        case "criticalFailureProbability":
        case "criticalHitProbability":
        case "range":
        case "castInLine":
        case "castInDiagonal":
        case "castTestLos":
        case "minRange":
        case "maxCastPerTurn":
            return t[e];
        case "id":
        case "minCastInterval":
        case "minPlayerLevel":
        case "maxStack":
        case "maxCastPerTarget":
        case "scriptId":
        case "scriptIdCritical":
        case "spellBreed":
            return 0;
        case "grade":
            return 1;
        case "typeId":
            return 24;
        case "useParamCache":
        case "needTakenCell":
        case "rangeCanBeBoosted":
        case "isDefaultSpellWeapon":
        case "needFreeCell":
            return !1;
        case "criticalFailureEndsTurn":
        case "isSpellWeapon":
            return !0;
        case "scriptParams":
        case "scriptParamsCritical":
        case "spellLevels":
            return null ;
        default:
            return null
        }
    }
    ,
    x = function() {
        var e = window.gui.playerData.characters.getSpellModifications
          , t = e(this.ownerId, this.id, w.CRITICAL_HIT_BONUS);
        if (!t)
            return this.spellLevel.criticalHitProbability;
        var i = t.value;
        return i.contextModif + i.objectsAndMountBonus + i.alignGiftBonus + i.base
    }
    ,
    a.prototype.getIconUri = function() {
        var e = this.isItem ? "/gfx/items/" : "/gfx/spells/sort_";
        return e + this.getProperty("iconId") + ".png"
    }
    ,
    a.prototype.getIconUrl = function() {
        return this.isItem ? this._item.item && this._item.item.image : this.spell && this.spell.image
    }
    ,
    a.prototype.update = function(e) {
        if (this.id !== A)
            return e();
        var t = window.gui.playerData.inventory.getCurrentWeapon();
        t ? (l.call(this, t),
        e()) : r.call(this, 0, null , e)
    }
    ,
    a.prototype.clone = function() {
        var e = new a;
        for (var t in this)
            this.hasOwnProperty(t) && "_uid" !== t && "castingData" !== t && (e[t] = this[t]);
        return e.setLevel(1),
        e
    }
    ,
    a.prototype.cast = function(e, t, i) {
        t = t || [],
        c.call(this),
        i = i !== !1,
        this.castingData.lastCastTurn = e;
        for (var n = 0; n < t.length; n++) {
            var o = t[n];
            this.castingData.targetsThisTurn[o] || (this.castingData.targetsThisTurn[o] = 0),
            this.castingData.targetsThisTurn[o]++
        }
        i && this.castingData.castThisTurn++,
        window.gui.shortcutBar.updateSpellAvailability(this.id)
    }
    ,
    a.prototype.newTurn = function() {
        this.castingData || (console.warn('You should not call "newTurn" on a spell that has not been casted'),
        c.call(this)),
        this.castingData.castThisTurn = 0,
        this.castingData.targetsThisTurn = {}
    }
    ,
    a.prototype.getModifiedInterval = function() {
        if (this.isItem)
            return 0;
        for (var e = new S, t = window.gui.playerData.characters.mainCharacter.characteristics.spellModifications, i = 0; i < t.length; i++) {
            var n = t[i];
            if (n.spellId === this.id) {
                var o = n.modificationType;
                o === w.CAST_INTERVAL ? e.castInterval = n.value : o === w.CAST_INTERVAL_SET && (e.castIntervalSet = n.value)
            }
        }
        var s, a = e.getTotalBonus(e.castInterval), r = e.getTotalBonus(e.castIntervalSet);
        return s = r ? r - a : this.spellLevel.minCastInterval - a
    }
    ,
    a.prototype.getCooldown = function() {
        if (!this.castingData || this.isItem)
            return 0;
        var e = this.getModifiedInterval();
        if (63 === e)
            return 63;
        var t;
        return t = 0 === this.spellLevel.initialCooldown || this.castingData.lastCastTurn >= this.castingData.lastInitialCooldownReset + this.spellLevel.initialCooldown ? e + this.castingData.lastCastTurn - window.gui.fightManager.turnCount : this.castingData.lastInitialCooldownReset + this.spellLevel.initialCooldown - window.gui.fightManager.turnCount,
        t = Math.max(0, t)
    }
    ,
    a.prototype.resetInitialCooldown = function(e) {
        this.castingData || c.call(this),
        this.castingData.lastInitialCooldownReset = e
    }
    ,
    a.prototype.forceCooldown = function(e) {
        this.castingData || (console.warn('You should not call "forceCooldown" on a spell that has not been casted'),
        c.call(this));
        var t = this.isItem ? 0 : this.spellLevel.minCastInterval;
        this.castingData.lastCastTurn = e + window.gui.fightManager.turnCount - t
    }
    ,
    a.prototype.forceLastCastTurn = function(e) {
        this.castingData || (console.warn('You should not call "forceLastCastTurn" on a spell that has not been casted'),
        c.call(this)),
        this.castingData.lastCastTurn = e
    }
    ,
    a.prototype.hasBeenCast = function() {
        return !!this.castingData
    }
    ,
    E = function(e, t, i) {
        if ("function" != typeof t || i || (i = t,
        t = null ),
        i = i || o,
        e instanceof Array || (e = [e]),
        e = e.filter(function(e) {
            return !isNaN(e)
        }),
        0 === e.length)
            return i(new Error("No valid spell id"));
        e.indexOf(A) !== -1 && (t || (t = {}),
        g(t, _));
        var n = {};
        h(e, t, function(e, o) {
            return e ? i(e) : (n.spells = o,
            void d(n, t, function(e, o) {
                return e ? i(e) : (n.spellLevels = o,
                void p(n, t, function(e, o) {
                    return e ? i(e) : (n.spellStates = o,
                    void m(n, t, function(e, t) {
                        return e ? i(e) : (n.effectInstances = t,
                        void i(null , n))
                    }))
                }))
            }))
        })
    }
    ,
    t.initialize = n,
    t.createSpells = u,
    t.sortSpells = f
}
, function(e, t, i) {
    function n() {
        this._type = "SpellModificator",
        this.apCost = new o,
        this.castInterval = new o,
        this.castIntervalSet = new o,
        this.maxCastPerTurn = new o,
        this.maxCastPerTarget = new o
    }
    var o = i(229);
    e.exports = n,
    n.prototype.getTotalBonus = function(e) {
        return e ? e.alignGiftBonus + e.base + e.contextModif + e.objectsAndMountBonus : 0
    }
}
, function(e, t, i) {
    function n(e, t) {
        e.apply(null , t)
    }
    function o(e, t, i, n, o, s) {
        void 0 === o && (o = !0),
        void 0 === s && (s = !0);
        var a = window.gui.fightManager.getFighter(t);
        if (!a)
            return console.error("Movement points variation step failed, fighter does not exist");
        if (o && (a.data.stats.movementPoints += i,
        window.gui.playerData.characters.controlledCharacterId === t)) {
            var r = window.gui.playerData.characters.getControlledCharacter();
            r.setCharacteristic("movementPointsCurrent", a.data.stats.movementPoints)
        }
        s && (i > 0 ? U.push(k.FIGHTER_MP_GAINED, [t, i], t, e, !1, 2) : i < 0 && (n ? U.push(k.FIGHTER_MP_USED, [t, Math.abs(i)], t, e, !1, 2) : U.push(k.FIGHTER_MP_LOST, [t, Math.abs(i)], t, e, !1, 2)))
    }
    function s(e, t, i, n, o, s) {
        void 0 === o && (o = !0),
        void 0 === s && (s = !0);
        var a = window.gui.fightManager.getFighter(t);
        if (!a)
            return console.error("Action points variation step failed, fighter does not exist");
        if (o && (a.data.stats.actionPoints += i,
        window.gui.playerData.characters.controlledCharacterId === t && !n)) {
            var r = window.gui.playerData.characters.getControlledCharacter();
            r.setCharacteristic("actionPointsCurrent", r.characteristics.actionPointsCurrent + i)
        }
        s && (i > 0 ? U.push(k.FIGHTER_AP_GAINED, [t, i], t, e, !1, 2) : i < 0 && (n ? U.push(k.FIGHTER_AP_USED, [t, Math.abs(i)], t, e, !1, 2) : U.push(k.FIGHTER_AP_LOST, [t, Math.abs(i)], t, e, !1, 2)))
    }
    function a(e, t, i) {
        U.push(k.FIGHTER_LEAVING_STATE, [t, i], t, -1)
    }
    function r(e, t, i, n) {
        U.push(k.FIGHTER_ENTERING_STATE, [t, i, n], t, -1)
    }
    function l(e, t, i, n, o) {
        U.push(k.FIGHTER_TEMPORARY_BOOSTED, [t, i, n, o], t, e, !1, 2)
    }
    function c(e, t) {
        var i = window.gui.fightManager.getFighter(t.targetId);
        return i ? t.actionId === H.ACTION_CHARACTER_UPDATE_BOOST ? i.updateBuff(t) : (i.addBuff(t),
        void (t instanceof G.StatBuff && ("movementPoints" === t.statName ? o(e, t.targetId, t.getDelta(), !1, !1, !1) : "actionPoints" === t.statName && s(e, t.targetId, t.getDelta(), !1, !1, !1)))) : console.error("Display buff step failed, fighter does not exist")
    }
    function u(e, t, i) {
        var n = window.gui.fightManager;
        n.emit("updateSpellsAvailability");
        var o = i.contextualId
          , s = n.deadTurnsList.indexOf(o);
        s !== -1 && n.deadTurnsList.splice(s, 1);
        var a = window.gui.playerData;
        if (o === a.id) {
            var r = a.characters.mainCharacter;
            n.prepareSpellsWithInitialCooldown(r),
            r.setCharacteristic("lifePoints", i.stats.lifePoints)
        }
        n.emit(k.FIGHTER_SUMMONED, [t, o], o, e)
    }
    function h(e, t, i, n) {
        var o = window.gui.fightManager
          , s = window.gui.playerData;
        t === s.characters.controlledCharacterId && o.getFighterSpell(i, t, function(e, t) {
            return e ? console.error(e) : (t.castingData || t.cast(o.turnCount, [], !1),
            t.forceCooldown(n),
            void window.gui.shortcutBar.updateSpellAvailability(i))
        })
    }
    function d(e, t, i, n) {
        var o = window.gui.fightManager;
        o.incrementDuration(i, n, !0, o.INCREMENT_MODE_TARGET),
        U.push(k.FIGHTER_EFFECTS_MODIFY_DURATION, [i, t, n], i, e)
    }
    function p(e, t, i, n, o) {
        var s = window.gui.fightManager
          , a = s.getFighter(t)
          , r = s.getFighter(n);
        return a && r ? (a.data.disposition.cellId = i,
        r.data.disposition.cellId = o,
        void s.emit(k.FIGHTERS_POSITION_EXCHANGE, [t, n], 0, e)) : console.error("Exchange position step failed, fighters do not exist")
    }
    function m(e, t, i) {
        var n = window.gui.fightManager
          , o = n.getFighter(t);
        return o ? (o.data.disposition.cellId = i,
        void n.emit(k.FIGHTER_SLIDE, [t], t, e)) : console.error("Slide step failed, fighter does not exist")
    }
    function f(e, t, i) {
        var n = window.gui.fightManager
          , o = n.getFighter(t);
        return o ? (o.data.disposition.cellId = i,
        void n.emit(k.FIGHTER_TELEPORTED, [t], 0, e)) : console.error("Teleport step failed, fighter does not exist")
    }
    function g(e, t, i) {
        var n = window.gui.fightManager.getFighter(t);
        return n ? void (n.data.disposition.cellId = i) : console.error("Map movement step failed, fighter does not exist")
    }
    function _(e, t, i) {
        window.gui.fightManager.emit(k.FIGHTER_CARRY, [t, i], 0, e)
    }
    function v(e, t, i, n) {
        var o = window.gui.fightManager;
        if (n !== -1) {
            var s = o.getFighter(i);
            if (!s)
                return console.error("Throw character step failed, fighter does not exist");
            s.data.disposition.cellId = n
        }
        o.emit(k.FIGHTER_THROW, [t, i, n], 0, e)
    }
    function y(e, t, i, n) {
        var o = window.gui.fightManager.getFighter(t);
        if (!o)
            return console.error("Fighter " + t + " does not exist.");
        var s = o.data.stats.shieldPoints + i;
        o.setShield(s),
        i < 0 ? U.push(k.FIGHTER_SHIELD_LOSS, [t, Math.abs(i), n], t, e) : i > 0 ? U.push(k.FIGHTER_SHIELD_GAIN, [t, i], t, e) : U.push(k.FIGHTER_NO_CHANGE, [t], t, e)
    }
    function w(e, t, i, n, o) {
        var s = window.gui.fightManager
          , a = s.getFighter(t);
        if (!a)
            return console.error("Fighter " + t + " does not exist.");
        var r = a.data.stats;
        r.maxLifePoints = Math.max(1, r.maxLifePoints + n);
        var l = Math.min(Math.max(0, r.lifePoints + i), r.maxLifePoints);
        a.setHP(l),
        i <= 0 ? U.push(k.FIGHTER_LIFE_LOSS, [t, Math.abs(i), o], t, e, !1, 2) : i > 0 && U.push(k.FIGHTER_LIFE_GAIN, [t, i, o], t, e, !1, 2)
    }
    function b(e, t, i) {
        U.push(k.FIGHTER_REDUCED_DAMAGES, [t, i], t, e)
    }
    function C(e, t, i) {
        U.push(k.FIGHTER_AP_LOSS_DODGED, [t, i], t, e)
    }
    function I(e, t, i) {
        U.push(k.FIGHTER_MP_LOSS_DODGED, [t, i], t, e)
    }
    function T(e, t) {
        U.push(k.FIGHTER_SPELL_IMMUNITY, [t], 0, e)
    }
    function S(e, t, i) {
        var n = window.gui.fightManager.getFighter(t);
        if (!n)
            return console.error("Fighter " + t + " does not exist.");
        var o = n.getBuff(i);
        o && o instanceof G.StateBuff && (952 === o.actionId ? r(-1, o.targetId, o.stateId, o.effect.getDurationString()) : a(-1, o.targetId, o.stateId)),
        n.dispelUniqueBuff(i, !0, !1, !0)
    }
    function A(e, t, i) {
        var n = window.gui.fightManager.getFighter(t);
        return n ? (n.dispelSpell(i, !0),
        void U.push(k.FIGHTER_SPELL_DISPELLED, [t, i], t, e)) : console.error("Fighter " + t + " does not exist.")
    }
    function E(e, t) {
        var i = window.gui.fightManager.getFighter(t);
        return i ? (i.dispel(),
        void U.push(k.FIGHTER_GOT_DISPELLED, [t], t, e)) : console.error("Fighter " + t + " does not exist.")
    }
    function x(e, t) {
        U.push(k.FIGHTER_REFLECTED_SPELL, [t], t, e)
    }
    function M(e, t) {
        U.push(k.FIGHTER_REFLECTED_DAMAGES, [t], t, e)
    }
    function N(e, t) {
        U.push(k.FIGHTER_GOT_TACKLED, [t], 0, e)
    }
    function R(e, t, i) {
        U.push(k.FIGHTER_GOT_KILLED, [i, t], t, e)
    }
    function O(e, t, i) {
        var n = window.gui.fightManager.getFighter(t);
        if (!n)
            return console.error("Fighter " + t + " does not exist.");
        var o, s = n.data.stats.invisibilityState;
        i !== F.VISIBLE && s === F.VISIBLE ? o = F.INVISIBLE : i === F.VISIBLE && s !== F.VISIBLE && (o = F.VISIBLE),
        o && U.push(k.FIGHTER_VISIBILITY_CHANGED, [t, o], t, e),
        n.data.stats.invisibilityState = i
    }
    function P(e, t, i, n) {
        U.push(k.FIGHTER_TRIGGERED_GLYPH, [t, i, n], 0, e)
    }
    function D(e, t, i, n) {
        U.send(k.FIGHTER_CLOSE_COMBAT, [t, i, n], t, e)
    }
    function L(e, t, i, n) {
        U.push(k.FIGHTER_CASTED_SPELL, [t, i, n], 0, e)
    }
    function B(e, t, i) {
        void 0 === i && (i = !0);
        var n = window.gui.fightManager
          , o = n.getFighter(t);
        return o ? (n.deadTurnsList.push(t),
        o.dispel(!1, !1, !0),
        n.removeLinkedBuff(t, !1, !0),
        n.reaffectBuffs(t),
        o.setAlive(!1),
        void U.push(i ? k.FIGHTER_DEATH : k.FIGHTER_LEAVE, [t], t, e)) : console.error("Fighter " + t + " does not exist.")
    }
    var k = i(218)
      , F = i(233)
      , H = i(222)
      , G = i(220)
      , U = i(232);
    t.pushStep = n,
    t.fightMovementPointsVariationStep = o,
    t.fightActionPointsVariationStep = s,
    t.fightLeavingStateStep = a,
    t.fightEnteringStateStep = r,
    t.fightTemporaryBoostStep = l,
    t.fightDisplayBuffStep = c,
    t.fightSummonStep = u,
    t.fightSpellCooldownVariationStep = h,
    t.fightModifyEffectsDurationStep = d,
    t.fightExchangePositionsStep = p,
    t.fightSlideStep = m,
    t.fightTeleportOnSameMapStep = f,
    t.mapMovementStep = g,
    t.fightCarryCharacterStep = _,
    t.fightThrowCharacterStep = v,
    t.fightShieldPointsVariationStep = y,
    t.fightLifePointsVariationStep = w,
    t.fightReduceDamages = b,
    t.fightActionPointsLossDodge = C,
    t.fightMovementPointsLossDodge = I,
    t.fightSpellImmunity = T,
    t.fightDispelEffectStep = S,
    t.fightDispelSpellStep = A,
    t.fightDispelStep = E,
    t.fightReflectSpellStep = x,
    t.fightReflectDamagesStep = M,
    t.fightTackledStep = N,
    t.fightKillStep = R,
    t.fightInvisibilityStep = O,
    t.fightTriggerGlyphTrapStep = P,
    t.fightCloseCombatStep = D,
    t.fightSpellCastStep = L,
    t.fightDeathStep = B
}
, function(e, t, i) {
    function n(e) {
        var t = this;
        s.call(this, "div", {
            className: "StarCounter"
        }),
        this.stars = [];
        for (var i = 0; i < l; i++) {
            var n = this.createChild("div", {
                className: "star"
            });
            this.stars[i] = n
        }
        this.bonusContainer = this.createChild("div", {
            className: "bonusContainer"
        }),
        this.bonusContainer.createChild("div", {
            className: "bonusContainerPlus",
            text: "+"
        });
        for (var o = 0; o < 3; o++) {
            var c = this.bonusContainer.createChild("div", {
                className: "bonusStar"
            });
            c.addClassNames("star" + (o + 1))
        }
        this.linkToShop = this.bonusContainer.appendChild(new a({
            className: "linkToShop",
            scaleOnPress: !1
        })),
        this.linkToShop.on("tap", function() {
            r.open("market", {
                tabId: "shop",
                tabParams: {
                    category: "bonuspack"
                }
            }),
            t.emit("shopOpened")
        }),
        void 0 !== e && this.setValue(e)
    }
    i(285);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(22)
      , l = 5;
    o(n, s),
    e.exports = n,
    n.prototype.setValue = function(e) {
        var t = "level1"
          , i = "";
        e > 100 && (t = "level2",
        i = "level1",
        e -= 100),
        e /= 20,
        e -= .5;
        for (var n = 0; n < l; n++)
            this.stars[n].delClassNames(["level1", "level2"]),
            this.stars[n].addClassNames(n <= e ? t : i);
        window.gui.playerData.isSubscriber() ? this.bonusContainer.addClassNames("bonusPackActive") : this.bonusContainer.delClassNames("bonusPackActive")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        function i(e, t) {
            return Math.sqrt(Math.pow(t.x - e.x, 2) + Math.pow(t.y - e.y, 2))
        }
        function n(e, t) {
            var n = f[0];
            if (!w) {
                var o = i(e, n)
                  , s = Date.now() - g;
                if (o / l + s / c >= b)
                    return !0
            }
            if (!t)
                return !1;
            var a = f[1];
            a || (a = f[1] = t);
            var r = Math.abs(i(n, a) - i(e, t));
            return r > u
        }
        function h(t) {
            var a = o(t)
              , r = a.touches[0]
              , l = a.touches[1];
            if (!y) {
                if (!n(r, l))
                    return;
                return void (s.requestInteractionHandle(e) ? (y = !0,
                e.isTransforming = !0,
                e.emit("transformStart", a, f)) : e.cancelTransform())
            }
            var c = r
              , u = 1;
            if (l) {
                c = {
                    x: (r.x + l.x) / 2,
                    y: (r.y + l.y) / 2
                };
                var h = i(r, l);
                m && (u = h / m),
                m = h
            }
            c.x -= d.left,
            c.y -= d.top,
            p = p || c;
            var g = w ? 0 : c.x - p.x
              , _ = w ? 0 : c.y - p.y;
            e.emit("transform", c.x, c.y, g, _, u, a),
            p = c
        }
        if (!e._transformBehavior) {
            e._transformBehavior = !0,
            e.allowDomEvents();
            var d, p, m, f, g, _ = !1, v = !1, y = !1;
            a || e.on("dom.wheel", function(t) {
                if (s.requestInteractionHandle(e)) {
                    d = e.rootElement.getBoundingClientRect();
                    var i = t.wheelDeltaY > 0 ? r : 1 / r;
                    e.emit("transform", t.x - d.left, t.y - d.top, 0, 0, i)
                }
            }),
            e.isTransforming = !1;
            var w = !1;
            e.setTranslationEnable = function(e) {
                w = !e
            }
            ;
            var b = 2 / ("HIGH" === t ? 3 : 1);
            e.cancelTransform = function() {
                v && (_ = !0,
                p = m = null ,
                v = !1,
                e.removeListener("dom.touchmove", h),
                e.isTransforming = !1,
                y && e.emit("transformEnd"))
            }
            ,
            e.on("dom.touchstart", function(t) {
                if (p = m = null ,
                !v && !_) {
                    var i = o(t);
                    w && 2 !== i.touchCount || i.touchCount > 2 || (d = e.rootElement.getBoundingClientRect(),
                    v = !0,
                    y = !1,
                    f = i.touches,
                    g = Date.now(),
                    e.on("dom.touchmove", h))
                }
            }),
            e.on("dom.touchend", function(t) {
                p = m = null ;
                var i = o(t);
                return _ || 0 !== i.touchCount ? void (_ = !1) : (e.removeListener("dom.touchmove", h),
                v = !1,
                void (y && (e.isTransforming = !1,
                e.emit("transformEnd", i))))
            })
        }
    }
    var o = i(33).getPosition
      , s = i(47)
      , a = i(7).isDevice
      , r = 1.2
      , l = 40
      , c = 100
      , u = 10;
    e.exports = n
}
, function(e, t, i) {
    function n(e, t) {
        t = t || {},
        u.call(this, "div", e),
        this.addClassNames("Ornament"),
        this._charName = null ,
        this._title = null ,
        this._titleId = null ,
        this._ornamentId = null ,
        this._ornamentAssetId = null ,
        this._guild = null ,
        this._gender = null ,
        this._alliance = null ,
        this._alignment = null ,
        this._scaleFactor = t.scaleFactor || 1;
        var i = this.createChild("div", {
            className: "alignmentWingsWrapper"
        });
        this._alignmentWingsContainer = i.createChild("div", {
            className: "alignmentWingsContainer"
        });
        var n = this.createChild("div", {
            className: "alignmentTailWrapper"
        });
        this._alignmentTailContainer = n.createChild("div", {
            className: "alignmentTailContainer"
        }),
        this._canvas = this.appendChild(new s),
        this._ctx = this._canvas.getContext(),
        this._width = this._canvas.width = 400,
        this._height = this._canvas.height = 400,
        this._guildEmblem = new a({
            width: 40,
            height: 40
        }),
        this._allianceEmblem = new a({
            width: 40,
            height: 40
        })
    }
    i(288);
    var o = i(12)
      , s = i(240)
      , a = i(289)
      , r = i(26).inherits
      , l = i(291)
      , c = i(36)
      , u = i(190)
      , h = i(292)
      , d = 160
      , p = 40
      , m = 16
      , f = 16
      , g = 19
      , _ = m + "px Arial"
      , v = f + "px Arial"
      , y = g + "px Arial"
      , w = 10
      , b = 5
      , C = 40
      , I = 10
      , T = C + I;
    r(n, u),
    e.exports = n,
    n.prototype.setAttributes = function(e) {
        e = e || {},
        this._charName = e.hasOwnProperty("charName") ? e.charName : null ,
        this._guild = e.hasOwnProperty("guild") ? e.guild : null ,
        this._alliance = e.hasOwnProperty("alliance") ? e.alliance : null ,
        this._alignment = e.hasOwnProperty("alignmentInfos") ? e.alignmentInfos : null ,
        this._ornamentId = e.hasOwnProperty("ornamentId") ? e.ornamentId : null ,
        this._ornamentAssetId = e.hasOwnProperty("ornamentAssetId") ? e.ornamentAssetId : null ,
        this._title = e.hasOwnProperty("title") ? e.title : null ,
        this._titleId = e.hasOwnProperty("titleId") ? e.titleId : null ,
        this._gender = e.hasOwnProperty("gender") ? e.gender : null
    }
    ,
    n.prototype.changeAttributes = function(e) {
        e = e || {};
        for (var t in e)
            this.hasOwnProperty("_" + t) && (this["_" + t] = e[t])
    }
    ,
    n.prototype.display = function() {
        var e = this
          , t = this._ctx;
        t.clearRect(0, 0, this._width, this._height),
        this._preload(function(t) {
            return t ? console.error(t) : (e._calculateDimension(),
            !e._ornamentAssetId || e._alignment && 0 !== e._alignment.alignmentGrade ? (e._resizeCanvas(e._textWidth, e._textHeight, 0, 0),
            e._displayText(),
            void e.emit("rendered")) : (e._displayTextAndOrnament(),
            void e.emit("rendered")))
        })
    }
    ,
    n.prototype._loadOrnament = function(e) {
        var t = this;
        o.series([function(e) {
            return t._ornamentId ? void c.getData("Ornaments", t._ornamentId, function(i, n) {
                return i ? e(i) : (t._ornamentAssetId = n.assetId,
                void e())
            }) : e()
        }
        , function(e) {
            return t._ornamentAssetId ? void l.loadModel("ornaments", "ornament_" + t._ornamentAssetId, function(i, n) {
                t._jsonObj = i,
                t._image = n,
                e()
            }) : e()
        }
        ], e)
    }
    ,
    n.prototype._preload = function(e) {
        var t = this;
        o.parallel([function(e) {
            t._loadOrnament(e)
        }
        , function(e) {
            return t._titleId ? void c.getData("Titles", t._titleId, function(i, n) {
                return i ? e(i) : (t._title = t._gender ? n.nameFemaleId : n.nameMaleId,
                void e())
            }) : e()
        }
        , function(e) {
            return t._guild && t._guild.guildEmblem ? void t._guildEmblem.setValue(t._guild.guildEmblem, !0, e) : e()
        }
        , function(e) {
            return t._alliance && t._alliance.allianceEmblem ? void t._allianceEmblem.setValue(t._alliance.allianceEmblem, !0, e) : e()
        }
        ], e)
    }
    ,
    n.prototype._calculateDimension = function() {
        var e = this._ctx
          , t = []
          , i = 0
          , n = 0;
        if (e.font = v,
        this._nameWidth = e.measureText(this._charName).width,
        t.push(this._nameWidth),
        n = f,
        this._guild) {
            var o = this._guild.guildName;
            e.font = _,
            this._guildNameWidth = e.measureText(o).width,
            t.push(this._guildNameWidth + T),
            t.push(this._nameWidth + T),
            n += b + m
        }
        if (this._alliance && (t.push(this._guildNameWidth + 2 * T),
        t.push(this._nameWidth + 2 * T)),
        this._title) {
            e.font = y;
            var s = "<< " + this._title + " >>"
              , a = e.measureText(s).width;
            t.push(a),
            n += b + g
        }
        i = Math.max.apply(null , t) + 2 * w,
        n += 2 * w,
        i = Math.round(i),
        n = Math.round(n),
        this._textWidth = Math.max(i, d),
        this._textHeight = Math.max(n, p),
        this._diffWidth = this._textWidth - d,
        this._diffHeight = this._textHeight - p
    }
    ,
    n.prototype._displayText = function() {
        var e = this
          , t = this._ctx
          , i = this._textWidth
          , n = this._textHeight;
        t.fillStyle = "rgba(0, 0, 0, 0.8)";
        var o = 5;
        t.beginPath(),
        t.moveTo(o, 0),
        t.lineTo(i - o, 0),
        t.quadraticCurveTo(i, 0, i, o),
        t.lineTo(i, n - o),
        t.quadraticCurveTo(i, n, i - o, n),
        t.lineTo(o, n),
        t.quadraticCurveTo(0, n, 0, n - o),
        t.lineTo(0, o),
        t.quadraticCurveTo(0, 0, o, 0),
        t.closePath(),
        t.fill(),
        t.textAlign = "center";
        var s = Math.max(this._guildNameWidth || 0, this._nameWidth)
          , a = s + (this._guild ? T : 0) + (this._alliance ? T : 0)
          , r = Math.round(s / 2)
          , l = Math.round((i - a) / 2) + (this._guild ? T : 0)
          , c = w;
        if (this._guild) {
            var u = this._guild.guildName;
            t.font = _,
            t.fillStyle = "#ffffff",
            c += m,
            t.fillText(u, l + r, c),
            c += b
        }
        if (this._charName && (t.font = v,
        t.fillStyle = "#ffffff",
        c += f,
        t.fillText(this._charName, l + r, c),
        c += b),
        this._title) {
            t.font = y,
            t.fillStyle = "#00B346";
            var d = "<< " + this._title + " >>";
            c += g,
            t.fillText(d, Math.round(i / 2), c)
        }
        if (this._guild && t.drawImage(this._guildEmblem.getContext().canvas, l - T, w, 40, 40),
        this._alliance && t.drawImage(this._allianceEmblem.getContext().canvas, l + s + I, w, 40, 40),
        this._alignment && this._alignment.alignmentSide !== h.ALIGNMENT_NEUTRAL && 0 !== this._alignment.alignmentGrade) {
            var p = window.gui.playerData.alignment;
            p.getTopWings(this._alignment, function(t) {
                e._alignmentWingsContainer.setStyles({
                    backgroundImage: t.backgroundImage,
                    left: t.left,
                    top: t.top,
                    width: t.width,
                    height: t.height
                })
            }),
            p.getBottomWings(this._alignment, function(t) {
                t ? e._alignmentTailContainer.setStyles({
                    backgroundImage: t.backgroundImage,
                    left: t.left,
                    top: t.top,
                    width: t.width,
                    height: t.height
                }) : e._alignmentTailContainer.setStyle("backgroundImage", "none")
            })
        } else
            e._alignmentWingsContainer.setStyle("backgroundImage", "none"),
            e._alignmentTailContainer.setStyle("backgroundImage", "none")
    }
    ,
    n.prototype._displayTextAndOrnament = function() {
        var e = this._ctx
          , t = this._diffWidth
          , i = this._diffHeight
          , n = this._jsonObj
          , o = this._image
          , s = Math.round(t / 2)
          , a = Math.round(i / 2);
        for (var r in n.symbols) {
            var l = n.symbols[r];
            if (l.isAnim) {
                this._resizeOrnament(l);
                for (var c = l.children.length - 1; c >= 0; c--) {
                    var u = l.children[c]
                      , h = u.id
                      , m = n.symbols[h]
                      , f = u.matrices[0]
                      , g = n.matrices[f]
                      , _ = g[0]
                      , v = g[1]
                      , y = g[2]
                      , w = g[3]
                      , b = g[4]
                      , C = g[5];
                    switch (u.name) {
                    case "left":
                        C += a;
                        break;
                    case "right":
                        b += t,
                        C += a;
                        break;
                    case "picto":
                        b += s;
                        break;
                    case "top":
                        b += s;
                        break;
                    case "bottom":
                        b += s,
                        C += i
                    }
                    if (e.save(),
                    e.transform(_, v, y, w, b, C),
                    "bg" === u.name) {
                        this._displayText();
                        var I = m.sw / m.w
                          , T = m.sh / m.h
                          , S = .5 * d - m.x
                          , A = .5 * p - m.y
                          , E = m.w + m.x - .5 * d
                          , x = m.h + m.y - .5 * p;
                        e.drawImage(o, m.sx, m.sy, S * I, A * T, m.x, m.y, S, A),
                        e.drawImage(o, m.sx + S * I, m.sy, E * I, A * T, m.x + S + t, m.y, E, A),
                        e.drawImage(o, m.sx, m.sy + A * T, S * I, x * T, m.x, m.y + A + i, S, x),
                        e.drawImage(o, m.sx + S * I, m.sy + A * T, E * I, x * T, m.x + S + t, m.y + A + i, E, x),
                        e.drawImage(o, m.sx + S * I, m.sy, 1 * I, A * T, m.x + S, m.y, t, A),
                        e.drawImage(o, m.sx + S * I, m.sy + A * T, 1 * I, x * T, m.x + S, m.y + A + i, t, x),
                        e.drawImage(o, m.sx, m.sy + A * T, S * I, 1 * T, m.x, m.y + A, S, i),
                        e.drawImage(o, m.sx + S * I, m.sy + A * T, S * I, 1 * T, m.x + S + t, m.y + A, S, i)
                    } else
                        e.drawImage(o, m.sx, m.sy, m.sw, m.sh, m.x, m.y, m.w, m.h);
                    e.restore()
                }
            }
        }
    }
    ,
    n.prototype._resizeCanvas = function(e, t, i, n) {
        var o = this._ctx;
        this._width = e * this._scaleFactor,
        this._height = t * this._scaleFactor,
        this._canvas.width = this._width,
        this._canvas.height = this._height,
        o.clearRect(0, 0, this._width, this._height),
        o.scale(this._scaleFactor, this._scaleFactor),
        o.translate(i, n),
        this.emit("sizeChanged")
    }
    ,
    n.prototype._resizeOrnament = function(e) {
        for (var t = 1 / 0, i = 1 / 0, n = -(1 / 0), o = -(1 / 0), s = e.children.length - 1; s >= 0; s--) {
            var a = e.children[s]
              , r = a.id
              , l = this._jsonObj.symbols[r]
              , c = a.matrices[0]
              , u = this._jsonObj.matrices[c]
              , h = u[4] + l.x
              , d = u[5] + l.y;
            t = Math.min(t, d),
            i = Math.min(i, h),
            n = Math.max(n, h + l.w),
            o = Math.max(o, d + l.h)
        }
        var p = Math.round(n - i + this._diffWidth)
          , m = Math.round(o - t + this._diffHeight);
        this._resizeCanvas(p, m, -i, -t)
    }
    ,
    n.prototype.getHeight = function() {
        return this._height
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        a.call(this, {
            className: "EmblemLogo"
        }),
        this.addClassNames(e.className);
        var t = this;
        this.width = e.width || 100,
        this.height = e.height || 100,
        this.images = {
            crownImage: null ,
            backgroundShape: null ,
            symbolShape: null
        },
        this.symbolWidth = Math.round(this.width * p),
        this.symbolHeight = Math.round(this.height * p),
        this.symbolPosX = Math.round((this.width - this.symbolWidth) / 2),
        this.symbolPosY = Math.round((this.height - this.symbolHeight) / 2),
        this.crownWidth = Math.round(this.width * m),
        this.crownHeight = Math.round(this.height * m),
        this.crownPosX = 0,
        this.crownPosY = 0;
        var i = new a;
        i.width = this.width,
        i.height = this.height,
        this.tempCtx = i.getContext(),
        o(this, function() {
            if (t.isLeader)
                return r("ui.guild.right.leader")
        })
    }
    i(290);
    var o = i(206).addTooltip
      , s = i(5)
      , a = i(240)
      , r = i(35).getText
      , l = i(210)
      , c = i(26).inherits
      , u = 227
      , h = 223
      , d = 189
      , p = .5
      , m = .35;
    c(n, a),
    e.exports = n,
    n.prototype._generateEmblem = function() {
        var e = this.images;
        if (e.backgroundShape && e.symbolShape) {
            var t = this.getContext()
              , i = this.tempCtx;
            t.clearRect(0, 0, this.width, this.height),
            t.drawImage(e.backgroundShape, 0, 0, this.width, this.height);
            var n, o = this.backgroundColor;
            if (o) {
                var s = t.getImageData(0, 0, this.width, this.height)
                  , a = s.data
                  , r = o[0] / u
                  , l = o[1] / h
                  , c = o[2] / d;
                for (n = 0; n < a.length; n += 4)
                    a[n] *= r,
                    a[n + 1] *= l,
                    a[n + 2] *= c;
                t.putImageData(s, 0, 0)
            }
            i.clearRect(0, 0, this.width, this.height),
            i.drawImage(e.symbolShape, this.symbolPosX, this.symbolPosY, this.symbolWidth, this.symbolHeight);
            var p = this.symbolColor;
            if (p) {
                var m = i.getImageData(0, 0, this.width, this.height)
                  , f = m.data;
                for (n = 0; n < f.length; n += 4)
                    0 !== f[n + 3] && (f[n] = p[0],
                    f[n + 1] = p[1],
                    f[n + 2] = p[2]);
                i.putImageData(m, 0, 0)
            }
            t.drawImage(i.canvas, 0, 0, this.width, this.height),
            this.isLeader && t.drawImage(e.crownImage, this.crownPosX, this.crownPosY, this.crownWidth, this.crownHeight)
        }
    }
    ,
    n.prototype.setValue = function(e, t, i) {
        var n = this
          , o = []
          , a = [];
        if (t = t || e.dec2rgb,
        e.hasOwnProperty("guild") && (t = !0,
        this.isLeader = e.guild.allianceLeader,
        e = e.guild.guildEmblem),
        e.hasOwnProperty("backgroundColor") && (this.backgroundColor = t ? l.hexToRgb((+e.backgroundColor).toString(16)) : e.backgroundColor),
        e.hasOwnProperty("symbolColor") && (this.symbolColor = t ? l.hexToRgb((+e.symbolColor).toString(16)) : e.symbolColor),
        e.hasOwnProperty("backgroundShape")) {
            var r = "gfx/emblems/icons/" + (e.isAlliance ? "backalliance" : "back") + "/" + e.backgroundShape + ".png";
            o.push(r),
            a.push("backgroundShape")
        }
        if (e.hasOwnProperty("symbolShape")) {
            var c = "gfx/emblems/icons/up/" + e.symbolShape + ".png";
            o.push(c),
            a.push("symbolShape")
        }
        this.isLeader && !this.images.crownImage && (o.push("ui/tx_crown.png"),
        a.push("crownImage")),
        s.loadImages(o, null , function(e) {
            if (!n || !n.rootElement)
                return void ("function" == typeof i && i());
            for (var t = 0; t < a.length; t += 1)
                n.images[a[t]] = e[t];
            n._generateEmblem(),
            "function" == typeof i && i()
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(6)
      , o = i(5)
      , s = {
        skin: n.SKIN_PATH,
        bone: n.BONE_PATH,
        icon: n.ICON_PATH,
        bitmapFonts: n.BITMAP_FONTS,
        ornaments: n.ORNAMENT_PATH,
        embedded: n.EMBEDDED_PATH
    };
    t.loadModel = function(e, t, i, n, a, r) {
        function l(e) {
            if (h = e,
            g += 1,
            g === _)
                return i && i(h, u)
        }
        function c(e) {
            if (u = n ? n.createTexture(e, m, a, r) : e,
            g += 1,
            g === _)
                return i && i(h, u)
        }
        var u, h, d, p = s[e] + t, m = p + ".png", f = p + ".json", g = 0, _ = 1;
        n ? (u = n.holdTexture(m),
        u ? d = !1 : (d = !0,
        _ += 1)) : (d = !0,
        _ += 1),
        o.loadJson(f, l),
        d !== !1 && o.loadImage(m, c)
    }
}
, function(e, t) {
    e.exports = {
        ALIGNMENT_UNKNOWN: -2,
        ALIGNMENT_WITHOUT: -1,
        ALIGNMENT_NEUTRAL: 0,
        ALIGNMENT_ANGEL: 1,
        ALIGNMENT_EVIL: 2,
        ALIGNMENT_MERCENARY: 3
    }
}
, function(e, t, i) {
    var n = i(185);
    n.prototype._setupBorderArrow = function() {
        this._borderArrow = this.createChild("div", {
            className: "BorderArrow"
        })
    }
    ,
    n.prototype.showBorderArrow = function(e, t, i) {
        switch (e) {
        case "top":
        case "bottom":
            this._borderArrow.setStyles({
                left: t + "px",
                top: ""
            });
            break;
        case "left":
        case "right":
            this._borderArrow.setStyles({
                top: i + "px",
                left: ""
            })
        }
        this._borderArrow.setClassNames(["BorderArrow", e]),
        this._borderArrow.show()
    }
    ,
    n.prototype.hideBorderArrow = function() {
        this._borderArrow.hide()
    }
}
, function(e, t, i) {
    function n() {
        a.call(this),
        this.windowsContainer = null ,
        this.gameContext = l.ROLE_PLAY,
        this.playerData = new Y,
        this.serversData = new $,
        this.boxArranger = new g,
        this.isConnected = !1,
        this.wBody = Ae,
        Ae.allowDomEvents();
        var e = this;
        this.on("CharacterSelectedSuccessMessage", this.onConnect),
        this.on("IdentificationSuccessMessage", this.onIdentificationSuccess),
        this.on("IdentificationSuccessWithLoginTokenMessage", this.onIdentificationSuccess),
        this.on("ServersListMessage", this.onServerListReceived),
        this.on("CurrentMapMessage", this.onCurrentMapMessage),
        this.on("GameContextCreateMessage", this.gameContextCreate),
        L.initialize(this),
        p.isIOSApp ? (document.addEventListener("pause", function() {
            e.emit("appOnBackground")
        }, !1),
        document.addEventListener("resume", function() {
            window.setTimeout(function() {
                e.emit("appBackFromBackground")
            }, 1e3)
        }, !1)) : document.addEventListener("visibilitychange", function(t) {
            t.target.hidden ? e.emit("appOnBackground") : window.setTimeout(function() {
                e.emit("appBackFromBackground")
            }, 1e3)
        }, !1)
    }
    i(295);
    var o = i(12)
      , s = i(26).inherits
      , a = i(16).EventEmitter
      , r = i(190)
      , l = i(85)
      , c = i(189)
      , u = i(32)
      , h = i(211)
      , d = i(296)
      , p = (i(435),
    i(7))
      , m = i(24)
      , f = i(423)
      , g = i(436)
      , _ = i(437)
      , v = i(442)
      , y = i(443)
      , w = i(461)
      , b = i(463)
      , C = i(466)
      , I = i(468)
      , T = i(186)
      , S = i(217)
      , A = i(469)
      , E = i(336)
      , x = i(25)
      , M = i(35)
      , N = M.getText
      , R = i(471)
      , O = i(339)
      , P = (i(210),
    i(477))
      , D = i(323)
      , L = i(34)
      , B = i(281)
      , k = i(479)
      , F = i(50)
      , H = i(488)
      , G = i(490)
      , U = i(496)
      , j = i(503)
      , q = i(506)
      , W = i(507)
      , V = i(511)
      , z = i(513)
      , Y = (i(515),
    i(519))
      , X = i(548)
      , Q = i(549)
      , K = i(551)
      , J = i(553)
      , Z = i(562)
      , $ = i(481)
      , ee = i(563)
      , te = i(578)
      , ie = i(580)
      , ne = i(589)
      , oe = i(591)
      , se = i(594)
      , ae = i(206)
      , re = i(30)
      , le = i(596)
      , ce = i(601)
      , ue = i(603)
      , he = i(22)
      , de = i(301)
      , pe = i(607)
      , me = i(630)
      , fe = i(632)
      , ge = i(633)
      , _e = i(636)
      , ve = i(979)
      , ye = i(981)
      , we = i(1e3)
      , be = i(1002)
      , Ce = i(1005)
      , Ie = i(1007)
      , Te = i(1009)
      , Se = i(641)
      , Ae = new r(document.getElementById("dofusBody"));
    u.initialize(Ae),
    p.isIOS && !p.isPhoneGap && i(1011),
    s(n, a),
    e.exports = n,
    n.prototype.transmitMessage = function(e) {
        this.emit(e._messageType, e)
    }
    ,
    n.prototype.transmitFightSequenceMessage = function(e) {
        this.fightManager.processFightSequenceMessage(e)
    }
    ,
    n.prototype.initialize = function(e) {
        this.loginScreen || this._createUiForLogin(),
        e && console.debug("Gui.initialize:", e)
    }
    ,
    n.prototype.initializeAfterLogin = function(e) {
        if (this.initialized)
            return e();
        this.fightManager = new S,
        this.tutorialManager = new le,
        this.playerData.initialize(this),
        this.serversData.initialize(this),
        this.fightManager.initialize(this),
        this.tutorialManager.initialize(this),
        this.boxArranger.initialize(),
        this.GPS = new R,
        this.pingSystem = new J,
        this.gifts = new Z,
        this.npcDialogHandler = new q,
        this.uiLocker = new fe,
        O.initialize(this),
        f.initialize(this),
        h.initialize(this),
        E.initialize(this),
        ce.initialize(this),
        c.initialize(Ae),
        b.initialize(this),
        v.initialize(this),
        pe.initialize(),
        X.initialize(),
        me.initialize(),
        ge.initialize(this);
        var t = this;
        o.series([I.load, B.initialize, D.initialize], function(i) {
            return i ? e(i) : (t._initUserInterface(),
            t._initAutoResize(),
            t.initialized = !0,
            t.emit("initialized"),
            void e())
        })
    }
    ,
    n.prototype.onServerListReceived = function(e) {
        this.initialized ? this.serversData.onServerList(e) : this.once("initialized", function() {
            this.serversData.onServerList(e)
        })
    }
    ,
    n.prototype._createUiForLogin = function() {
        he.initialize(this),
        Ae.setStyles({
            width: m.dimensions.screenWidth + "px",
            height: m.dimensions.screenHeight + "px"
        }),
        this.loginScreen = Ae.appendChild(new ye),
        this.splashScreen = Ae.appendChild(new we),
        this.connectionSplashScreen = Ae.appendChild(new ve),
        this.windowsContainer = new r("div",{
            className: "windowsContainer"
        }),
        Ae.appendChild(this.windowsContainer),
        he.addWindow("connectionQueue", new Ie, {
            fixed: !0
        }),
        he.addWindow("popup", new Te),
        he.addWindow("confirm", new Se),
        he.addWindow("nickname", new be, {
            fixed: !0
        }),
        he.addWindow("register", new Ce, {
            fixed: !0
        }),
        this.dropDown = Ae.appendChild(new ne)
    }
    ,
    n.prototype._addWindows = function() {
        _e()
    }
    ,
    n.prototype._initUserInterface = function() {
        this.gameGuiContainer = new r("div",{
            className: "gameGuiContainer",
            hidden: !0
        }),
        Ae.appendChild(this.gameGuiContainer),
        this.sidebarBackground = this.gameGuiContainer.createChild("div", {
            className: "blackStripe"
        }),
        this.mapBorder1 = this.gameGuiContainer.createChild("div", {
            className: "mapBorder"
        }),
        this.mapBorder2 = this.gameGuiContainer.createChild("div", {
            className: ["mapBorder", "flipped"]
        }),
        this.screenLeftover = this.gameGuiContainer.createChild("div", {
            className: "blackStripe"
        }),
        this.gameGuiContainer.appendChild(window.foreground),
        d.initialize(this.gameGuiContainer, Ae),
        this.tooltipBox = Ae.appendChild(ae.initialiseTooltipBehavior(Ae)),
        this.numberInputPad = this.gameGuiContainer.appendChild(new V),
        this._addWindows(),
        this.chat = this.gameGuiContainer.appendChild(new y),
        this.gameGuiContainer.appendChild(new w),
        this.mainControls = this.gameGuiContainer.appendChild(new U),
        this.shortcutBar = this.gameGuiContainer.appendChild(new ee),
        this.menuBar = this.gameGuiContainer.appendChild(new G),
        this.textNotification = this.gameGuiContainer.appendChild(new C),
        this.roleplayBuffs = this.gameGuiContainer.appendChild(new ue(this.playerData.inventory)),
        this.timeline = this.gameGuiContainer.appendChild(new ie),
        this.progressGauge = this.shortcutBar.appendChild(new Q),
        this.compass = this.gameGuiContainer.appendChild(new oe),
        this.hintArrow = this.gameGuiContainer.appendChild(new se),
        this.kohBox = this.windowsContainer.appendChild(new k),
        this.party = this.gameGuiContainer.appendChild(new z),
        this.challengeIndicator = this.gameGuiContainer.appendChild(new _),
        this.rewardsIndicator = this.gameGuiContainer.appendChild(new K),
        this.npcDialogUi = this.gameGuiContainer.appendChild(new W),
        this.notificationBar = this.gameGuiContainer.appendChild(new j),
        this.mapCoordinates = this.gameGuiContainer.appendChild(new H),
        this.houseMenuButton = this.gameGuiContainer.appendChild(new P),
        this.shopFloatingToolbar = this.gameGuiContainer.appendChild(new A),
        T.init(this.gameGuiContainer)
    }
    ,
    n.prototype.gameContextCreate = function(e) {
        var t = e.context;
        this.gameContext = t,
        window.foreground.changeGameContext(t),
        t !== l.ROLE_PLAY && window.foreground.hideBorderArrow()
    }
    ,
    n.prototype.onCurrentMapMessage = function() {
        window.foreground.hideBorderArrow()
    }
    ,
    n.prototype.openContextualMenu = function(e, t, i) {
        i = i || {};
        var n = i.x
          , o = i.y;
        if (i.isCanvasCoordinate) {
            var s = window.foreground.convertCanvasToScreenCoordinate(n, o);
            n = s.x,
            o = s.y
        }
        d.openAt(e, n, o, t)
    }
    ,
    n.prototype.openContextualMenuAround = function(e, t, i) {
        d.openAround(e, t, i)
    }
    ,
    n.prototype.closeContextualMenu = function(e) {
        d.close(e)
    }
    ,
    n.prototype.showHintArrow = function(e, t) {
        this.hintArrow.showArrow(e, t)
    }
    ,
    n.prototype.hideHintArrow = function() {
        this.hintArrow.hideArrow()
    }
    ,
    n.prototype.newSpeechBubble = function(e) {
        return new te(e)
    }
    ,
    n.prototype.disconnect = function(e) {
        this.isConnected = !1,
        "SOCKET_LOST" !== e && "ASSET_MISSING" !== e || this.expectedDisconnectionReason || (console.warn("[Gui] disconnected:", e),
        this.openSimplePopup(N("ui.popup.connectionFailed.text"))),
        this._shutDownUI(),
        this.emit("disconnect", e)
    }
    ,
    n.prototype.connectionGonnaBeClosed = function(e) {
        this.expectedDisconnectionReason = e;
        var t = this;
        window.setTimeout(function() {
            t.expectedDisconnectionReason = null
        }, 6e4)
    }
    ,
    n.prototype._shutDownUI = function() {
        F.backToLogin(),
        re.close(),
        he.closeAll(),
        this.gameGuiContainer && this.gameGuiContainer.hide(),
        this.houseMenuButton && this.houseMenuButton.hide(),
        this.tooltipBox && this.tooltipBox.close(),
        this.kohBox && this.kohBox.hide()
    }
    ,
    n.prototype.onIdentificationSuccess = function() {
        this.loginScreen.hide(),
        this.splashScreen.show()
    }
    ,
    n.prototype.onConnect = function() {
        this.isConnected = !0,
        x.initialize(this),
        this.gameGuiContainer.show(),
        this._resizeUi(),
        window.gui.emit("connected", this.fightManager.isInReconnection)
    }
    ,
    n.prototype.openPopup = function(e) {
        he.getWindow("popup").addContent(e),
        he.open("popup")
    }
    ,
    n.prototype.openSimplePopup = function(e, t) {
        this.openPopup({
            title: t || N("ui.common.error"),
            message: e
        })
    }
    ,
    n.prototype.openConfirmPopup = function(e, t) {
        he.getWindow("confirm").update(e),
        he.open("confirm", t)
    }
    ,
    n.prototype.openCancelPopup = function(e) {
        he.getWindow("cancel").update(e),
        he.open("cancel")
    }
    ,
    n.prototype._resizeUi = function(e) {
        void 0 === e && (e = window.gui.playerData.isFighting),
        p.isDevice ? Ae.replaceClassNames(["no-touch"], ["touch"]) : Ae.replaceClassNames(["touch"], ["no-touch"]),
        m.updateScreen();
        var t = m.dimensions;
        Ae.setStyles({
            width: t.screenWidth + "px",
            height: t.screenHeight + "px"
        });
        var i = t.screenWidth / t.screenHeight;
        i <= 1.5 ? (this.ipadRatio = !0,
        Ae.replaceClassNames(["largeRatio"], ["ipadRatio"]),
        m.resizeNarrowScreen(e),
        this.sidebarBackground.setStyles({
            left: 0,
            top: t.mapBottom - 1 + "px",
            width: t.screenWidth + "px",
            height: t.screenHeight - t.mapBottom + 1 + "px"
        }),
        this.mapBorder1.addClassNames("vertical"),
        this.mapBorder1.setStyles({
            left: 0,
            top: 0,
            width: t.mapLeft + "px",
            height: t.mapHeight + "px"
        }),
        this.mapBorder2.addClassNames("vertical"),
        this.mapBorder2.setStyles({
            left: t.mapRight + "px",
            top: 0,
            width: t.screenWidth - t.mapRight + "px",
            height: t.mapHeight + "px"
        }),
        this.screenLeftover.setStyles({
            left: 0,
            top: 0,
            width: t.screenWidth + "px",
            height: t.mapTop + "px"
        })) : (this.ipadRatio = !1,
        Ae.replaceClassNames(["ipadRatio"], ["largeRatio"]),
        m.resizeWideScreen(e),
        this.sidebarBackground.setStyles({
            left: t.mapRight + "px",
            top: 0,
            width: t.screenWidth - t.mapRight + "px",
            height: t.screenHeight + "px"
        }),
        this.mapBorder1.delClassNames("vertical"),
        this.mapBorder1.setStyles({
            left: t.mapLeft + "px",
            top: 0,
            width: t.mapWidth + "px",
            height: t.mapTop + "px"
        }),
        this.mapBorder2.delClassNames("vertical"),
        this.mapBorder2.setStyles({
            left: t.mapLeft + "px",
            top: t.mapBottom - 1 + "px",
            width: t.mapWidth + "px",
            height: t.screenHeight - t.mapBottom + 1 + "px"
        }),
        this.screenLeftover.setStyles({
            left: 0,
            top: 0,
            width: t.mapLeft + "px",
            height: t.screenHeight + "px"
        })),
        window.isoEngine.updateDimensions(t),
        this.emit("resize", t)
    }
    ,
    n.prototype._initAutoResize = function() {
        function e() {
            clearTimeout(t),
            t = setTimeout(function() {
                i._resizeUi()
            }, 250)
        }
        de.hide(),
        this._resizeUi();
        var t, i = this;
        p.isDevice || (window.addEventListener("scroll", e),
        window.addEventListener("resize", e)),
        this.fightManager.on("fightEnterPreparation", function() {
            i._resizeUi()
        }),
        this.fightManager.on("fightEnterBattle", function(e) {
            "PREPARATION_SKIPPED" === e && i._resizeUi()
        }),
        this.fightManager.on("fightEnd", function() {
            i._resizeUi()
        }),
        x.on("menubarSize", this.resizeToolbar.bind(this, !1)),
        x.on("menubarSizeInFight", this.resizeToolbar.bind(this, !0)),
        x.on("toolbarThicknessInFight", this.resizeToolbar.bind(this, !0))
    }
    ,
    n.prototype.resizeToolbar = function(e) {
        var t = window.gui.playerData.isFighting;
        e === t && this._resizeUi(t)
    }
    ,
    n.prototype.showFightingToolbar = function(e) {
        this._resizeUi(e)
    }
    ,
    n.prototype.getBuildVersion = function() {
        var e = window.Config;
        if (e) {
            var t = window.appInfo
              , i = "";
            return t && t.version && (i = "Client v" + t.version + " / Server "),
            i + "v" + e.buildVersion
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a = !0
    }
    function o(e) {
        p = null ,
        u = "clickAway" === e
    }
    function s(e, t) {
        e = e || "generic";
        var i = d[e];
        return i ? t && u ? (r = null ,
        l = c = -1,
        !1) : (p = i,
        !0) : (console.error('Contextual menu "' + e + '" does not exist.'),
        !1)
    }
    var a, r, l, c, u, h = i(33).getPosition, d = {
        fightTeam: i(297),
        generic: i(305),
        interactive: i(306),
        item: i(310),
        map: i(407),
        monster: i(410),
        npc: i(413),
        offlinePlayer: i(414),
        partyOptions: i(415),
        player: i(416),
        preset: i(421),
        prism: i(422),
        storage: i(425),
        spell: i(426),
        spellUpgrade: i(427),
        taxCollector: i(429),
        userStatus: i(430),
        paddockObject: i(433),
        admin: i(434)
    }, p = null , m = {
        x: 0,
        y: 0
    };
    t.getContextMenu = function(e) {
        return d[e]
    }
    ,
    t.initialize = function(e, t) {
        t.on("dom.touchstart", function(e) {
            return m = h(e),
            p ? void (a ? a = !1 : p.close("clickAway")) : void (u = !1)
        });
        for (var i in d) {
            var s = d[i]
              , r = d[i] = e.appendChild(new s);
            r.allowDomEvents(),
            r.on("dom.touchstart", n),
            r.on("close", o)
        }
    }
    ,
    t.openAt = function(e, t, i, n) {
        s(e, Math.abs(l - t) < 5 && Math.abs(c - i) < 5) && (l = t,
        c = i,
        t = void 0 === t ? m.x : t,
        i = void 0 === i ? m.y : i,
        p.openAt(t, i, n))
    }
    ,
    t.openAround = function(e, t, i) {
        s(e, t === r) && (r = t,
        p.openAround(t, i))
    }
    ,
    t.close = function(e) {
        p && p.close(e)
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "ContextualMenuFightTeam"
        }),
        this.leaderId = 0,
        this.fightId = 0,
        this.once("open", this._setupDom),
        this.on("open", this._setContent)
    }
    i(298);
    var o = i(26).inherits
      , s = i(299)
      , a = i(36)
      , r = i(35).getText
      , l = i(22);
    o(n, s),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this
          , t = this.entryList.createChild("div");
        this.teamMemberList = t.createChild("div", {
            className: "teamMemberList"
        }),
        this.actionsContainer = t.createChild("div"),
        this.buttonJoin = this._addEntry(r("ui.common.join"), function() {
            return e.isAlliancePrismFight ? void l.open("social", {
                tabId: "alliance",
                tabParams: {
                    tabId: "attacks"
                }
            }) : e.isTaxCollectorFight ? void l.open("social", {
                tabId: "guild",
                tabParams: {
                    tabId: "perceptors"
                }
            }) : void window.dofus.sendMessage("GameFightJoinRequestMessage", {
                fighterId: e.leaderId,
                fightId: e.fightId
            })
        }),
        this._addCancel()
    }
    ,
    n.prototype._setContent = function(e, t) {
        var i = this;
        this.isAlliancePrismFight = !1,
        this.isTaxCollectorFight = !1,
        this.leaderId = e.leaderId,
        this.fightId = e.fightId,
        this.teamMemberList.clearContent();
        for (var n = e.teamMembers, o = [], s = 0; s < n.length; s++) {
            var l = n[s];
            switch (l._type) {
            case "FightTeamMemberMonsterInformations":
                o.push(l.monsterId);
                break;
            case "FightTeamMemberCharacterInformations":
            case "FightTeamMemberWithAllianceCharacterInformations":
            case "FightTeamMemberTaxCollectorInformations":
            }
        }
        a.getDataMap("Monsters", o, function(e, o) {
            if (e)
                return console.error(e);
            for (var s = 0, a = r("ui.common.short.level") + " ", l = 0; l < n.length; l++) {
                var c = n[l]
                  , u = i.teamMemberList.createChild("div", {
                    className: "teamMember"
                });
                switch (c._type) {
                case "FightTeamMemberMonsterInformations":
                    var h = c.grade
                      , d = o[c.monsterId]
                      , p = d.grades[h - 1].level;
                    s += p,
                    u.setText(d.nameId + " (" + a + p + ")"),
                    3451 === d.id && (i.isAlliancePrismFight = !0);
                    break;
                case "FightTeamMemberCharacterInformations":
                case "FightTeamMemberWithAllianceCharacterInformations":
                    s += c.level,
                    u.setText(c.name + " (" + a + c.level + ")");
                    break;
                case "FightTeamMemberTaxCollectorInformations":
                    i.isTaxCollectorFight = !0
                }
            }
            i.header.setText(r("ui.common.rank", s)),
            t()
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        p.call(this, "div", {
            className: "ContextualMenu",
            hidden: !0
        }),
        e = e || {},
        this.addClassNames(e.className),
        this._position = {},
        this.header = this.createChild("div", {
            className: "contextHeader"
        }),
        e.noHeader && this._displayHeader(!1),
        this.entryContainer = this.createChild("div", {
            className: "entryContainer"
        }),
        this.scroller = this.entryContainer.appendChild(new u({
            className: "entryList"
        },{
            showHintArrows: !0
        })),
        this.entryList = this.scroller.content,
        this.maxHeight = s.screenHeight - 2 * m - (e.noHeader ? 0 : f),
        this.requestedHeight = this.maxHeight,
        this.currentHeight = 0;
        var t = this;
        l.on("show", function(e) {
            t._refreshScroller(t.maxHeight - e)
        }),
        l.on("hide", function() {
            t._refreshScroller(t.maxHeight)
        })
    }
    i(300);
    var o = i(204)
      , s = i(24).dimensions
      , a = i(35).getText
      , r = i(203)
      , l = i(301)
      , c = i(26).inherits
      , u = i(302)
      , h = i(33).position
      , d = i(31)
      , p = i(190)
      , m = 10
      , f = 40;
    c(n, p),
    e.exports = n,
    n.prototype._refreshScroller = function(e) {
        if (void 0 !== e) {
            if (this.requestedHeight = e,
            !this.isOpen && !this.isOpening)
                return;
            if (this.requestedHeight === this.currentHeight)
                return
        }
        this.currentHeight = this.requestedHeight,
        this.scroller.setStyle("maxHeight", this.currentHeight + "px"),
        void 0 === e && this.scroller.goToTop(),
        this.scroller.refresh()
    }
    ,
    n.prototype._displayHeader = function(e) {
        this.toggleClassName("noHeader", !e),
        this.header.toggleDisplay(e)
    }
    ,
    n.prototype._setPosition = function(e, t) {
        this._position.x = h.x,
        this._position.y = h.y,
        this.setStyles({
            left: e + "px",
            top: t + 25 + "px"
        })
    }
    ,
    n.prototype._addEntry = function(e, t) {
        var i = this
          , n = this.entryList.appendChild(new o({
            text: e,
            className: "cmButton"
        },t));
        return n.on("tap", function() {
            i.close()
        }),
        n
    }
    ,
    n.prototype._addCancel = function() {
        return this._addSeparator(),
        this._addEntry(a("ui.common.cancel"), function() {})
    }
    ,
    n.prototype._addSeparator = function() {
        this.entryList.createChild("div", {
            className: "separator"
        })
    }
    ,
    n.prototype._openingAnimation = function(e, t) {
        function i() {
            n._tween1 = d.tween(n, {
                webkitTransform: "translate3d(0,-25px,0)",
                opacity: 1
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                n._tween1 = null
            }),
            n._tween2 = d.tween(n.entryList, {
                webkitTransform: "translate3d(0,0,0)"
            }, {
                time: 200,
                easing: "cubic-bezier(0,1,0.62,1)"
            }, function() {
                this.setStyle("webkitTransform", ""),
                n._tween2 = null ,
                n.isOpening = !1,
                n._tween = null ,
                n.isOpen = !0,
                n.closeRequest && (n.closeRequest = null ,
                n.close("reopen"))
            })
        }
        if (!this.isOpening) {
            if (this.isOpen)
                return this.close(),
                void (this.next = {
                    positioningMethod: e,
                    params: t
                });
            this.isOpening = !0,
            this._tween1 && this._tween1.cancel(),
            this._tween2 && this._tween2.cancel(),
            this.show(),
            this.entryContainer.setStyle("overflow", "visible"),
            this.entryList.setStyle("webkitTransform", "translate3d(0,-100%,0)");
            var n = this;
            this.emit("open", t, function() {
                n._refreshScroller();
                var t = e();
                n._setPosition(t.x, t.y),
                n.entryContainer.setStyle("overflow", "hidden"),
                window.setTimeout(i, 0)
            })
        }
    }
    ,
    n.prototype.openAt = function(e, t, i) {
        var n = this;
        this._openingAnimation(function() {
            return r.getElementPositionAt(n, e, t)
        }, i)
    }
    ,
    n.prototype.openAround = function(e, t) {
        var i = this;
        this._openingAnimation(function() {
            return r.getElementPositionAround(i, e)
        }, t)
    }
    ,
    n.prototype.close = function(e) {
        if (this.isOpening)
            return void (this.closeRequest = !0);
        if (!this.isClosing && this.isOpen) {
            this.isClosing = !0,
            this._tween1 && this._tween1.cancel(),
            this._tween2 && this._tween2.cancel();
            var t = this;
            this.emit("close", e),
            this._tween1 = d.tween(this.entryList, {
                webkitTransform: "translate3d(0,-100%,0)"
            }, {
                time: 200,
                easing: "ease-out"
            }, function() {
                t._tween1 = null ,
                t.isClosing = !1,
                t.isOpen = !1,
                t.next && (t._openingAnimation(t.next.positioningMethod, t.next.params),
                t.next = null )
            }),
            this._tween2 = d.tween(this, {
                webkitTransform: "translate3d(0,0,0)",
                opacity: 0
            }, {
                delay: 100,
                time: 100,
                easing: "ease-out"
            }, function() {
                t.hide(),
                t._tween2 = null
            })
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(7)
      , o = i(16)
      , s = window.cordova
      , a = i(33)
      , r = a.events
      , l = new o;
    e.exports = l;
    var c = !0;
    l.show = function() {
        n.isPhoneGap && s.plugins.Keyboard.show()
    }
    ,
    l.hide = function() {
        "INPUT" === document.activeElement.tagName && document.activeElement.blur(),
        n.isPhoneGap && s.plugins.Keyboard.close()
    }
    ,
    l.disableScroll = function(e) {
        n.isPhoneGap && s.plugins.Keyboard.disableScroll(e)
    }
    ,
    l.hideKeyboardAccessoryBar = function(e) {
        n.isPhoneGap && s.plugins.Keyboard.hideKeyboardAccessoryBar(e)
    }
    ,
    l.setAutomaticHide = function(e) {
        c = !!e
    }
    ,
    document.body.addEventListener(r.end, function(e) {
        "INPUT" === document.activeElement.tagName && "INPUT" !== e.target.tagName && c && l.hide()
    }, !1),
    n.isPhoneGap && (window.addEventListener("native.keyboardshow", function(e) {
        l.emit("show", e.keyboardHeight)
    }),
    window.addEventListener("native.keyboardhide", function() {
        var e = "INPUT" === document.activeElement.tagName && document.activeElement;
        setTimeout(function() {
            var t = "INPUT" === document.activeElement.tagName;
            t && e !== document.activeElement || (l.emit("hide"),
            e && document.activeElement.blur())
        }, 0)
    }))
}
, function(e, t, i) {
    function n(e, t) {
        p.call(this, "div", e),
        this.addClassNames("Scroller"),
        t = t || {};
        var i = !!t.isHorizontal
          , n = i ? ["scrollerContent", "horizontal"] : "scrollerContent";
        this.content = this.createChild("div", {
            className: n
        }),
        this.iScroll = new h(this.rootElement,{
            scrollbars: "custom",
            fadeScrollbars: !1,
            bounce: t.bounce,
            maxSpeed: t.maxSpeed,
            scrollX: i,
            scrollY: !i,
            mouseWheel: !0,
            preventDefault: !1,
            directionLockThreshold: m
        }),
        this.iScroll.myScroller = this,
        this.on("destroy", this._destroyHandler),
        t.showHintArrows && (this.scrollUpHint = this.createChild("div", {
            className: "scrollUpHint"
        }),
        this.scrollDownHint = this.createChild("div", {
            className: "scrollDownHint"
        }),
        this.notifyInterval = null ,
        this.notifyCount = 0),
        this.isEnable = !0,
        this._handleRegistered = !1;
        var o = this;
        window.setTimeout(function() {
            o.refresh()
        }, 200),
        this._setupEventListeners()
    }
    function o() {
        var e = this.myScroller;
        return u.requestInteractionHandle(e) ? (e.scrollUpHint && (e.scrollUpHint.hide(),
        e.scrollDownHint.hide()),
        void e.emit("scrollStart")) : e.cancel()
    }
    function s() {
        var e = this.myScroller;
        e._refreshHints(),
        e.emit("scrollEnd")
    }
    function a() {
        this.myScroller.emit("scrollCancel")
    }
    function r(e) {
        e !== this && this.cancel()
    }
    function l() {
        this.requestRefresh && this.refresh(!0),
        this._handleRegistered || (this._handleRegistered = !0,
        u.once("handleTaken", r.bind(this)))
    }
    function c() {
        u.removeListener("handleTaken", r.bind(this)),
        this.isEnable && this.iScroll.enable(),
        this._handleRegistered = !1
    }
    i(303);
    var u = i(47)
      , h = i(304)
      , d = i(26).inherits
      , p = i(190)
      , m = 10
      , f = 17
      , g = 200
      , _ = 8;
    d(n, p),
    n.ease = h.utils.ease,
    n.prototype._destroyHandler = function() {
        window.clearInterval(this.notifyInterval),
        this.iScroll.destroy()
    }
    ,
    n.prototype._setupEventListeners = function() {
        this.allowDomEvents(),
        this.on("dom.touchstart", l),
        this.on("dom.touchend", c),
        this.iScroll.on("scrollStart", o),
        this.iScroll.on("scrollEnd", s),
        this.iScroll.on("scrollCancel", a)
    }
    ,
    n.prototype._refreshHints = function() {
        this.scrollUpHint && (this.scrollUpHint.toggleDisplay(this.canScrollUp(f)),
        this.scrollDownHint.toggleDisplay(this.canScrollDown(f)))
    }
    ,
    n.prototype.cancel = function() {
        this.iScroll.disable()
    }
    ,
    n.prototype.refresh = function(e) {
        return e || 0 !== this.rootElement.clientHeight ? (this.iScroll.refresh(),
        this.toggleClassName("scrollBgVisible", this.iScroll.hasVerticalScroll || this.iScroll.hasHorizontalScroll),
        this._refreshHints(),
        void (this.requestRefresh = !1)) : void (this.requestRefresh = !0)
    }
    ,
    n.prototype.notify = function() {
        if (this.scrollUpHint && this.canScrollDown() && (this.notifyCount = _,
        !this.notifyInterval)) {
            var e = this;
            this.notifyInterval = window.setInterval(function() {
                e.scrollDownHint.toggleDisplay(),
                e.notifyCount--,
                e.notifyCount > 0 || (window.clearInterval(e.notifyInterval),
                e.notifyInterval = null ,
                e._refreshHints())
            }, g)
        }
    }
    ,
    n.prototype.scrollToElement = function(e, t, i, n, o) {
        this.iScroll.scrollToElement(e.rootElement, t, i, n, o),
        t || this._refreshHints()
    }
    ,
    n.prototype.showElement = function(e, t, i) {
        var n = this.iScroll
          , o = e.rootElement;
        o = o.nodeType ? o : n.scroller.querySelector(o);
        var s = h.utils.offset(o);
        s.left -= n.wrapperOffset.left,
        s.top -= n.wrapperOffset.top;
        var a = o.offsetHeight
          , r = o.offsetWidth;
        s.top < n.y && a <= n.wrapperHeight && (s.top = Math.min(s.top - a + n.wrapperHeight, n.y)),
        s.left < n.x && r <= n.wrapperWidth && (s.left = Math.min(s.left - r + n.wrapperWidth, n.x)),
        s.left = Math.min(0, Math.max(n.maxScrollX, s.left)),
        s.top = Math.min(0, Math.max(n.maxScrollY, s.top)),
        s.left === n.x && s.top === n.y || (t = void 0 === t || null === t || "auto" === t ? Math.max(Math.abs(n.x - s.left), Math.abs(n.y - s.top)) : t,
        this.scrollTo(s.left, s.top, t, i))
    }
    ,
    n.prototype.scrollTo = function(e, t, i, n) {
        this.iScroll.scrollTo(e, t, i, n),
        i || this._refreshHints()
    }
    ,
    n.prototype.scrollBy = function(e, t, i, n) {
        this.iScroll.scrollBy(e, t, i, n),
        i || this._refreshHints()
    }
    ,
    n.prototype.setEnable = function(e) {
        e ? this.iScroll.enable() : this.iScroll.disable(),
        this.isEnable = e
    }
    ,
    n.prototype.canScrollUp = function(e) {
        return e = e || 1,
        this.iScroll.options.scrollY ? this.iScroll.y <= -e : this.iScroll.x <= -e
    }
    ,
    n.prototype.canScrollDown = function(e) {
        return e = e || 1,
        this.iScroll.options.scrollY ? this.iScroll.maxScrollY - this.iScroll.y <= -e : this.iScroll.maxScrollX - this.iScroll.x <= -e
    }
    ,
    n.prototype.goToTop = function(e, t) {
        return this.iScroll.options.scrollY ? this.scrollTo(this.iScroll.x, 0, e, t) : void this.scrollTo(0, this.iScroll.y, e, t)
    }
    ,
    n.prototype.goToBottom = function(e, t) {
        return this.iScroll.options.scrollY ? this.scrollTo(this.iScroll.x, this.iScroll.maxScrollY, e, t) : void this.scrollTo(this.iScroll.maxScrollX, this.iScroll.y, e, t)
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    /*! iScroll v5.1.3 ~ (c) 2008-2014 Matteo Spinelli ~ http://cubiq.org/license */
    !function(t, i, n) {
        function o(e, t) {
            this.wrapper = "string" == typeof e ? i.querySelector(e) : e,
            this.scroller = this.wrapper.children[0],
            this.scrollerStyle = this.scroller.style,
            this.options = {
                resizeScrollbars: !0,
                mouseWheelSpeed: 20,
                snapThreshold: .334,
                startX: 0,
                startY: 0,
                scrollY: !0,
                directionLockThreshold: 5,
                momentum: !0,
                bounce: !0,
                bounceTime: 600,
                bounceEasing: "",
                preventDefault: !0,
                preventDefaultException: {
                    tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT)$/
                },
                HWCompositing: !0,
                useTransition: !0,
                useTransform: !0
            };
            for (var n in t)
                this.options[n] = t[n];
            this.translateZ = this.options.HWCompositing && l.hasPerspective ? " translateZ(0)" : "",
            this.options.useTransition = l.hasTransition && this.options.useTransition,
            this.options.useTransform = l.hasTransform && this.options.useTransform,
            this.options.eventPassthrough = this.options.eventPassthrough === !0 ? "vertical" : this.options.eventPassthrough,
            this.options.preventDefault = !this.options.eventPassthrough && this.options.preventDefault,
            this.options.scrollY = "vertical" != this.options.eventPassthrough && this.options.scrollY,
            this.options.scrollX = "horizontal" != this.options.eventPassthrough && this.options.scrollX,
            this.options.freeScroll = this.options.freeScroll && !this.options.eventPassthrough,
            this.options.directionLockThreshold = this.options.eventPassthrough ? 0 : this.options.directionLockThreshold,
            this.options.bounceEasing = "string" == typeof this.options.bounceEasing ? l.ease[this.options.bounceEasing] || l.ease.circular : this.options.bounceEasing,
            this.options.resizePolling = void 0 === this.options.resizePolling ? 60 : this.options.resizePolling,
            this.options.tap === !0 && (this.options.tap = "tap"),
            "scale" == this.options.shrinkScrollbars && (this.options.useTransition = !1),
            this.options.invertWheelDirection = this.options.invertWheelDirection ? -1 : 1,
            this.x = 0,
            this.y = 0,
            this.directionX = 0,
            this.directionY = 0,
            this._events = {},
            this._init(),
            this.refresh(),
            this.scrollTo(this.options.startX, this.options.startY),
            this.enable()
        }
        function s(e, t, n) {
            var o = i.createElement("div")
              , s = i.createElement("div");
            return n === !0 && (o.style.cssText = "position:absolute;z-index:9999",
            s.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),
            s.className = "iScrollIndicator",
            "h" == e ? (n === !0 && (o.style.cssText += ";height:7px;left:2px;right:2px;bottom:0",
            s.style.height = "100%"),
            o.className = "iScrollHorizontalScrollbar") : (n === !0 && (o.style.cssText += ";width:7px;bottom:2px;top:2px;right:1px",
            s.style.width = "100%"),
            o.className = "iScrollVerticalScrollbar"),
            o.style.cssText += ";overflow:hidden",
            t || (o.style.pointerEvents = "none"),
            o.appendChild(s),
            o
        }
        function a(e, n) {
            this.wrapper = "string" == typeof n.el ? i.querySelector(n.el) : n.el,
            this.wrapperStyle = this.wrapper.style,
            this.indicator = this.wrapper.children[0],
            this.indicatorStyle = this.indicator.style,
            this.scroller = e,
            this.options = {
                listenX: !0,
                listenY: !0,
                interactive: !1,
                resize: !0,
                defaultScrollbars: !1,
                shrink: !1,
                fade: !1,
                speedRatioX: 0,
                speedRatioY: 0
            };
            for (var o in n)
                this.options[o] = n[o];
            this.sizeRatioX = 1,
            this.sizeRatioY = 1,
            this.maxPosX = 0,
            this.maxPosY = 0,
            this.options.interactive && (this.options.disableTouch || (l.addEvent(this.indicator, "touchstart", this),
            l.addEvent(t, "touchend", this)),
            this.options.disablePointer || (l.addEvent(this.indicator, l.prefixPointerEvent("pointerdown"), this),
            l.addEvent(t, l.prefixPointerEvent("pointerup"), this)),
            this.options.disableMouse || (l.addEvent(this.indicator, "mousedown", this),
            l.addEvent(t, "mouseup", this))),
            this.options.fade && (this.wrapperStyle[l.style.transform] = this.scroller.translateZ,
            this.wrapperStyle[l.style.transitionDuration] = l.isBadAndroid ? "0.001s" : "0ms",
            this.wrapperStyle.opacity = "0")
        }
        var r = t.requestAnimationFrame || t.webkitRequestAnimationFrame || t.mozRequestAnimationFrame || t.oRequestAnimationFrame || t.msRequestAnimationFrame || function(e) {
            t.setTimeout(e, 1e3 / 60)
        }
          , l = function() {
            function e(e) {
                return a !== !1 && ("" === a ? e : a + e.charAt(0).toUpperCase() + e.substr(1))
            }
            var o = {}
              , s = i.createElement("div").style
              , a = function() {
                for (var e, t = ["t", "webkitT", "MozT", "msT", "OT"], i = 0, n = t.length; i < n; i++)
                    if (e = t[i] + "ransform",
                    e in s)
                        return t[i].substr(0, t[i].length - 1);
                return !1
            }();
            o.getTime = Date.now || function() {
                return (new Date).getTime()
            }
            ,
            o.extend = function(e, t) {
                for (var i in t)
                    e[i] = t[i]
            }
            ,
            o.addEvent = function(e, t, i, n) {
                e.addEventListener(t, i, !!n)
            }
            ,
            o.removeEvent = function(e, t, i, n) {
                e.removeEventListener(t, i, !!n)
            }
            ,
            o.prefixPointerEvent = function(e) {
                return t.MSPointerEvent ? "MSPointer" + e.charAt(9).toUpperCase() + e.substr(10) : e
            }
            ,
            o.momentum = function(e, t, i, o, s, a, r) {
                var l, c, u = e - t, h = n.abs(u) / i;
                return r && h > r && (h = r),
                a = void 0 === a ? 6e-4 : a,
                l = e + h * h / (2 * a) * (u < 0 ? -1 : 1),
                c = h / a,
                l < o ? (l = s ? o - s / 2.5 * (h / 8) : o,
                u = n.abs(l - e),
                c = u / h) : l > 0 && (l = s ? s / 2.5 * (h / 8) : 0,
                u = n.abs(e) + l,
                c = u / h),
                {
                    destination: n.round(l),
                    duration: c
                }
            }
            ;
            var r = e("transform");
            return o.extend(o, {
                hasTransform: r !== !1,
                hasPerspective: e("perspective")in s,
                hasTouch: "ontouchstart"in t,
                hasPointer: t.PointerEvent || t.MSPointerEvent,
                hasTransition: e("transition")in s
            }),
            o.isBadAndroid = /Android /.test(t.navigator.appVersion) && !/Chrome\/\d/.test(t.navigator.appVersion),
            o.extend(o.style = {}, {
                transform: r,
                transitionTimingFunction: e("transitionTimingFunction"),
                transitionDuration: e("transitionDuration"),
                transitionDelay: e("transitionDelay"),
                transformOrigin: e("transformOrigin")
            }),
            o.hasClass = function(e, t) {
                var i = new RegExp("(^|\\s)" + t + "(\\s|$)");
                return i.test(e.className)
            }
            ,
            o.addClass = function(e, t) {
                if (!o.hasClass(e, t)) {
                    var i = e.className.split(" ");
                    i.push(t),
                    e.className = i.join(" ")
                }
            }
            ,
            o.removeClass = function(e, t) {
                if (o.hasClass(e, t)) {
                    var i = new RegExp("(^|\\s)" + t + "(\\s|$)","g");
                    e.className = e.className.replace(i, " ")
                }
            }
            ,
            o.offset = function(e) {
                for (var t = -e.offsetLeft, i = -e.offsetTop; e = e.offsetParent; )
                    t -= e.offsetLeft,
                    i -= e.offsetTop;
                return {
                    left: t,
                    top: i
                }
            }
            ,
            o.preventDefaultException = function(e, t) {
                for (var i in t)
                    if (t[i].test(e[i]))
                        return !0;
                return !1
            }
            ,
            o.extend(o.eventType = {}, {
                touchstart: 1,
                touchmove: 1,
                touchend: 1,
                mousedown: 2,
                mousemove: 2,
                mouseup: 2,
                pointerdown: 3,
                pointermove: 3,
                pointerup: 3,
                MSPointerDown: 3,
                MSPointerMove: 3,
                MSPointerUp: 3
            }),
            o.extend(o.ease = {}, {
                quadratic: {
                    style: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
                    fn: function(e) {
                        return e * (2 - e)
                    }
                },
                circular: {
                    style: "cubic-bezier(0.1, 0.57, 0.1, 1)",
                    fn: function(e) {
                        return n.sqrt(1 - --e * e)
                    }
                },
                back: {
                    style: "cubic-bezier(0.175, 0.885, 0.32, 1.275)",
                    fn: function(e) {
                        var t = 4;
                        return (e -= 1) * e * ((t + 1) * e + t) + 1
                    }
                },
                bounce: {
                    style: "",
                    fn: function(e) {
                        return (e /= 1) < 1 / 2.75 ? 7.5625 * e * e : e < 2 / 2.75 ? 7.5625 * (e -= 1.5 / 2.75) * e + .75 : e < 2.5 / 2.75 ? 7.5625 * (e -= 2.25 / 2.75) * e + .9375 : 7.5625 * (e -= 2.625 / 2.75) * e + .984375
                    }
                },
                elastic: {
                    style: "",
                    fn: function(e) {
                        var t = .22
                          , i = .4;
                        return 0 === e ? 0 : 1 == e ? 1 : i * n.pow(2, -10 * e) * n.sin((e - t / 4) * (2 * n.PI) / t) + 1
                    }
                }
            }),
            o.tap = function(e, t) {
                var n = i.createEvent("Event");
                n.initEvent(t, !0, !0),
                n.pageX = e.pageX,
                n.pageY = e.pageY,
                e.target.dispatchEvent(n)
            }
            ,
            o.click = function(e) {
                var t, n = e.target;
                /(SELECT|INPUT|TEXTAREA)/i.test(n.tagName) || (t = i.createEvent("MouseEvents"),
                t.initMouseEvent("click", !0, !0, e.view, 1, n.screenX, n.screenY, n.clientX, n.clientY, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, 0, null ),
                t._constructed = !0,
                n.dispatchEvent(t))
            }
            ,
            o
        }();
        o.prototype = {
            version: "5.1.3",
            _init: function() {
                this._initEvents(),
                (this.options.scrollbars || this.options.indicators) && this._initIndicators(),
                this.options.mouseWheel && this._initWheel(),
                this.options.snap && this._initSnap(),
                this.options.keyBindings && this._initKeys()
            },
            destroy: function() {
                this._initEvents(!0),
                this._execEvent("destroy")
            },
            _transitionEnd: function(e) {
                e.target == this.scroller && this.isInTransition && (this._transitionTime(),
                this.resetPosition(this.options.bounceTime) || (this.isInTransition = !1,
                this._execEvent("scrollEnd")))
            },
            _start: function(e) {
                if ((1 == l.eventType[e.type] || 0 === e.button) && this.enabled && (!this.initiated || l.eventType[e.type] === this.initiated)) {
                    !this.options.preventDefault || l.isBadAndroid || l.preventDefaultException(e.target, this.options.preventDefaultException) || e.preventDefault();
                    var t, i = e.touches ? e.touches[0] : e;
                    this.initiated = l.eventType[e.type],
                    this.moved = !1,
                    this.distX = 0,
                    this.distY = 0,
                    this.directionX = 0,
                    this.directionY = 0,
                    this.directionLocked = 0,
                    this._transitionTime(),
                    this.startTime = l.getTime(),
                    this.options.useTransition && this.isInTransition ? (this.isInTransition = !1,
                    t = this.getComputedPosition(),
                    this._translate(n.round(t.x), n.round(t.y)),
                    this._execEvent("scrollEnd")) : !this.options.useTransition && this.isAnimating && (this.isAnimating = !1,
                    this._execEvent("scrollEnd")),
                    this.startX = this.x,
                    this.startY = this.y,
                    this.absStartX = this.x,
                    this.absStartY = this.y,
                    this.pointX = i.pageX,
                    this.pointY = i.pageY,
                    this._execEvent("beforeScrollStart")
                }
            },
            _move: function(e) {
                if (this.enabled && l.eventType[e.type] === this.initiated) {
                    this.options.preventDefault && e.preventDefault();
                    var t, i, o, s, a = e.touches ? e.touches[0] : e, r = a.pageX - this.pointX, c = a.pageY - this.pointY, u = l.getTime();
                    if (this.pointX = a.pageX,
                    this.pointY = a.pageY,
                    this.distX += r,
                    this.distY += c,
                    o = n.abs(this.distX),
                    s = n.abs(this.distY),
                    !(u - this.endTime > 300 && o < 10 && s < 10)) {
                        if (this.directionLocked || this.options.freeScroll || (o > s + this.options.directionLockThreshold ? this.directionLocked = "h" : s >= o + this.options.directionLockThreshold ? this.directionLocked = "v" : this.directionLocked = "n"),
                        "h" == this.directionLocked) {
                            if ("vertical" == this.options.eventPassthrough)
                                e.preventDefault();
                            else if ("horizontal" == this.options.eventPassthrough)
                                return void (this.initiated = !1);
                            c = 0
                        } else if ("v" == this.directionLocked) {
                            if ("horizontal" == this.options.eventPassthrough)
                                e.preventDefault();
                            else if ("vertical" == this.options.eventPassthrough)
                                return void (this.initiated = !1);
                            r = 0
                        }
                        r = this.hasHorizontalScroll ? r : 0,
                        c = this.hasVerticalScroll ? c : 0,
                        t = this.x + r,
                        i = this.y + c,
                        (t > 0 || t < this.maxScrollX) && (t = this.options.bounce ? this.x + r / 3 : t > 0 ? 0 : this.maxScrollX),
                        (i > 0 || i < this.maxScrollY) && (i = this.options.bounce ? this.y + c / 3 : i > 0 ? 0 : this.maxScrollY),
                        this.directionX = r > 0 ? -1 : r < 0 ? 1 : 0,
                        this.directionY = c > 0 ? -1 : c < 0 ? 1 : 0,
                        this.moved || this._execEvent("scrollStart"),
                        this.moved = !0,
                        this._translate(t, i),
                        u - this.startTime > 300 && (this.startTime = u,
                        this.startX = this.x,
                        this.startY = this.y)
                    }
                }
            },
            _end: function(e) {
                if (this.enabled && l.eventType[e.type] === this.initiated) {
                    this.options.preventDefault && !l.preventDefaultException(e.target, this.options.preventDefaultException) && e.preventDefault();
                    var t, i, o = (e.changedTouches ? e.changedTouches[0] : e,
                    l.getTime() - this.startTime), s = n.round(this.x), a = n.round(this.y), r = n.abs(s - this.startX), c = n.abs(a - this.startY), u = 0, h = "";
                    if (this.isInTransition = 0,
                    this.initiated = 0,
                    this.endTime = l.getTime(),
                    !this.resetPosition(this.options.bounceTime)) {
                        if (this.scrollTo(s, a),
                        !this.moved)
                            return this.options.tap && l.tap(e, this.options.tap),
                            this.options.click && l.click(e),
                            void this._execEvent("scrollCancel");
                        if (this._events.flick && o < 200 && r < 100 && c < 100)
                            return void this._execEvent("flick");
                        if (this.options.momentum && o < 300 && (t = this.hasHorizontalScroll ? l.momentum(this.x, this.startX, o, this.maxScrollX, this.options.bounce ? this.wrapperWidth : 0, this.options.deceleration, this.options.maxSpeed) : {
                            destination: s,
                            duration: 0
                        },
                        i = this.hasVerticalScroll ? l.momentum(this.y, this.startY, o, this.maxScrollY, this.options.bounce ? this.wrapperHeight : 0, this.options.deceleration, this.options.maxSpeed) : {
                            destination: a,
                            duration: 0
                        },
                        s = t.destination,
                        a = i.destination,
                        u = n.max(t.duration, i.duration),
                        this.isInTransition = 1),
                        this.options.snap) {
                            var d = this._nearestSnap(s, a);
                            this.currentPage = d,
                            u = this.options.snapSpeed || n.max(n.max(n.min(n.abs(s - d.x), 1e3), n.min(n.abs(a - d.y), 1e3)), 300),
                            s = d.x,
                            a = d.y,
                            this.directionX = 0,
                            this.directionY = 0,
                            h = this.options.bounceEasing
                        }
                        return s != this.x || a != this.y ? ((s > 0 || s < this.maxScrollX || a > 0 || a < this.maxScrollY) && (h = l.ease.quadratic),
                        void this.scrollTo(s, a, u, h)) : void this._execEvent("scrollEnd")
                    }
                }
            },
            _resize: function() {
                var e = this;
                clearTimeout(this.resizeTimeout),
                this.resizeTimeout = setTimeout(function() {
                    e.refresh()
                }, this.options.resizePolling)
            },
            resetPosition: function(e) {
                var t = this.x
                  , i = this.y;
                return e = e || 0,
                !this.hasHorizontalScroll || this.x > 0 ? t = 0 : this.x < this.maxScrollX && (t = this.maxScrollX),
                !this.hasVerticalScroll || this.y > 0 ? i = 0 : this.y < this.maxScrollY && (i = this.maxScrollY),
                (t != this.x || i != this.y) && (this.scrollTo(t, i, e, this.options.bounceEasing),
                !0)
            },
            disable: function() {
                this.enabled = !1
            },
            enable: function() {
                this.enabled = !0
            },
            refresh: function() {
                this.wrapper.offsetHeight;
                this.wrapperWidth = this.wrapper.clientWidth,
                this.wrapperHeight = this.wrapper.clientHeight,
                this.scrollerWidth = this.scroller.offsetWidth,
                this.scrollerHeight = this.scroller.offsetHeight,
                this.maxScrollX = this.wrapperWidth - this.scrollerWidth,
                this.maxScrollY = this.wrapperHeight - this.scrollerHeight,
                this.hasHorizontalScroll = this.options.scrollX && this.maxScrollX < 0,
                this.hasVerticalScroll = this.options.scrollY && this.maxScrollY < 0,
                this.hasHorizontalScroll || (this.maxScrollX = 0,
                this.scrollerWidth = this.wrapperWidth),
                this.hasVerticalScroll || (this.maxScrollY = 0,
                this.scrollerHeight = this.wrapperHeight),
                this.endTime = 0,
                this.directionX = 0,
                this.directionY = 0,
                this.wrapperOffset = l.offset(this.wrapper),
                this._execEvent("refresh"),
                this.resetPosition()
            },
            on: function(e, t) {
                this._events[e] || (this._events[e] = []),
                this._events[e].push(t)
            },
            off: function(e, t) {
                if (this._events[e]) {
                    var i = this._events[e].indexOf(t);
                    i > -1 && this._events[e].splice(i, 1)
                }
            },
            _execEvent: function(e) {
                if (this._events[e]) {
                    var t = 0
                      , i = this._events[e].length;
                    if (i)
                        for (; t < i; t++)
                            this._events[e][t].apply(this, [].slice.call(arguments, 1))
                }
            },
            scrollBy: function(e, t, i, n) {
                e = this.x + e,
                t = this.y + t,
                i = i || 0,
                this.scrollTo(e, t, i, n)
            },
            scrollTo: function(e, t, i, n) {
                n = n || l.ease.circular,
                this.isInTransition = this.options.useTransition && i > 0,
                !i || this.options.useTransition && n.style ? (this._transitionTimingFunction(n.style),
                this._transitionTime(i),
                this._translate(e, t)) : this._animate(e, t, i, n.fn)
            },
            scrollToElement: function(e, t, i, o, s) {
                if (e = e.nodeType ? e : this.scroller.querySelector(e)) {
                    var a = l.offset(e);
                    a.left -= this.wrapperOffset.left,
                    a.top -= this.wrapperOffset.top,
                    i === !0 && (i = n.round(e.offsetWidth / 2 - this.wrapper.offsetWidth / 2)),
                    o === !0 && (o = n.round(e.offsetHeight / 2 - this.wrapper.offsetHeight / 2)),
                    a.left -= i || 0,
                    a.top -= o || 0,
                    a.left = a.left > 0 ? 0 : a.left < this.maxScrollX ? this.maxScrollX : a.left,
                    a.top = a.top > 0 ? 0 : a.top < this.maxScrollY ? this.maxScrollY : a.top,
                    t = void 0 === t || null === t || "auto" === t ? n.max(n.abs(this.x - a.left), n.abs(this.y - a.top)) : t,
                    this.scrollTo(a.left, a.top, t, s)
                }
            },
            _transitionTime: function(e) {
                if (e = e || 0,
                this.scrollerStyle[l.style.transitionDuration] = e + "ms",
                !e && l.isBadAndroid && (this.scrollerStyle[l.style.transitionDuration] = "0.001s"),
                this.indicators)
                    for (var t = this.indicators.length; t--; )
                        this.indicators[t].transitionTime(e)
            },
            _transitionTimingFunction: function(e) {
                if (this.scrollerStyle[l.style.transitionTimingFunction] = e,
                this.indicators)
                    for (var t = this.indicators.length; t--; )
                        this.indicators[t].transitionTimingFunction(e)
            },
            _translate: function(e, t) {
                if (this.options.useTransform ? this.scrollerStyle[l.style.transform] = "translate(" + e + "px," + t + "px)" + this.translateZ : (e = n.round(e),
                t = n.round(t),
                this.scrollerStyle.left = e + "px",
                this.scrollerStyle.top = t + "px"),
                this.x = e,
                this.y = t,
                this.indicators)
                    for (var i = this.indicators.length; i--; )
                        this.indicators[i].updatePosition()
            },
            _initEvents: function(e) {
                var i = e ? l.removeEvent : l.addEvent
                  , n = this.options.bindToWrapper ? this.wrapper : t;
                i(t, "orientationchange", this),
                i(t, "resize", this),
                this.options.click && i(this.wrapper, "click", this, !0),
                this.options.disableMouse || (i(this.wrapper, "mousedown", this),
                i(n, "mousemove", this),
                i(n, "mousecancel", this),
                i(n, "mouseup", this)),
                l.hasPointer && !this.options.disablePointer && (i(this.wrapper, l.prefixPointerEvent("pointerdown"), this),
                i(n, l.prefixPointerEvent("pointermove"), this),
                i(n, l.prefixPointerEvent("pointercancel"), this),
                i(n, l.prefixPointerEvent("pointerup"), this)),
                l.hasTouch && !this.options.disableTouch && (i(this.wrapper, "touchstart", this),
                i(n, "touchmove", this),
                i(n, "touchcancel", this),
                i(n, "touchend", this)),
                i(this.scroller, "transitionend", this),
                i(this.scroller, "webkitTransitionEnd", this),
                i(this.scroller, "oTransitionEnd", this),
                i(this.scroller, "MSTransitionEnd", this)
            },
            getComputedPosition: function() {
                var e, i, n = t.getComputedStyle(this.scroller, null );
                return this.options.useTransform ? (n = n[l.style.transform].split(")")[0].split(", "),
                e = +(n[12] || n[4]),
                i = +(n[13] || n[5])) : (e = +n.left.replace(/[^-\d.]/g, ""),
                i = +n.top.replace(/[^-\d.]/g, "")),
                {
                    x: e,
                    y: i
                }
            },
            _initIndicators: function() {
                function e(e) {
                    for (var t = r.indicators.length; t--; )
                        e.call(r.indicators[t])
                }
                var t, i = this.options.interactiveScrollbars, n = "string" != typeof this.options.scrollbars, o = [], r = this;
                this.indicators = [],
                this.options.scrollbars && (this.options.scrollY && (t = {
                    el: s("v", i, this.options.scrollbars),
                    interactive: i,
                    defaultScrollbars: !0,
                    customStyle: n,
                    resize: this.options.resizeScrollbars,
                    shrink: this.options.shrinkScrollbars,
                    fade: this.options.fadeScrollbars,
                    listenX: !1
                },
                this.wrapper.appendChild(t.el),
                o.push(t)),
                this.options.scrollX && (t = {
                    el: s("h", i, this.options.scrollbars),
                    interactive: i,
                    defaultScrollbars: !0,
                    customStyle: n,
                    resize: this.options.resizeScrollbars,
                    shrink: this.options.shrinkScrollbars,
                    fade: this.options.fadeScrollbars,
                    listenY: !1
                },
                this.wrapper.appendChild(t.el),
                o.push(t))),
                this.options.indicators && (o = o.concat(this.options.indicators));
                for (var l = o.length; l--; )
                    this.indicators.push(new a(this,o[l]));
                this.options.fadeScrollbars && (this.on("scrollEnd", function() {
                    e(function() {
                        this.fade()
                    })
                }),
                this.on("scrollCancel", function() {
                    e(function() {
                        this.fade()
                    })
                }),
                this.on("scrollStart", function() {
                    e(function() {
                        this.fade(1)
                    })
                }),
                this.on("beforeScrollStart", function() {
                    e(function() {
                        this.fade(1, !0)
                    })
                })),
                this.on("refresh", function() {
                    e(function() {
                        this.refresh()
                    })
                }),
                this.on("destroy", function() {
                    e(function() {
                        this.destroy()
                    }),
                    delete this.indicators
                })
            },
            _initWheel: function() {
                l.addEvent(this.wrapper, "wheel", this),
                l.addEvent(this.wrapper, "mousewheel", this),
                l.addEvent(this.wrapper, "DOMMouseScroll", this),
                this.on("destroy", function() {
                    l.removeEvent(this.wrapper, "wheel", this),
                    l.removeEvent(this.wrapper, "mousewheel", this),
                    l.removeEvent(this.wrapper, "DOMMouseScroll", this)
                })
            },
            _wheel: function(e) {
                if (this.enabled) {
                    e.preventDefault(),
                    e.stopPropagation();
                    var t, i, o, s, a = this;
                    if (void 0 === this.wheelTimeout && a._execEvent("scrollStart"),
                    clearTimeout(this.wheelTimeout),
                    this.wheelTimeout = setTimeout(function() {
                        a._execEvent("scrollEnd"),
                        a.wheelTimeout = void 0
                    }, 400),
                    "deltaX"in e)
                        1 === e.deltaMode ? (t = -e.deltaX * this.options.mouseWheelSpeed,
                        i = -e.deltaY * this.options.mouseWheelSpeed) : (t = -e.deltaX,
                        i = -e.deltaY);
                    else if ("wheelDeltaX"in e)
                        t = e.wheelDeltaX / 120 * this.options.mouseWheelSpeed,
                        i = e.wheelDeltaY / 120 * this.options.mouseWheelSpeed;
                    else if ("wheelDelta"in e)
                        t = i = e.wheelDelta / 120 * this.options.mouseWheelSpeed;
                    else {
                        if (!("detail"in e))
                            return;
                        t = i = -e.detail / 3 * this.options.mouseWheelSpeed
                    }
                    if (t *= this.options.invertWheelDirection,
                    i *= this.options.invertWheelDirection,
                    this.hasVerticalScroll || (t = i,
                    i = 0),
                    this.options.snap)
                        return o = this.currentPage.pageX,
                        s = this.currentPage.pageY,
                        t > 0 ? o-- : t < 0 && o++,
                        i > 0 ? s-- : i < 0 && s++,
                        void this.goToPage(o, s);
                    o = this.x + n.round(this.hasHorizontalScroll ? t : 0),
                    s = this.y + n.round(this.hasVerticalScroll ? i : 0),
                    o > 0 ? o = 0 : o < this.maxScrollX && (o = this.maxScrollX),
                    s > 0 ? s = 0 : s < this.maxScrollY && (s = this.maxScrollY),
                    this.scrollTo(o, s, 0)
                }
            },
            _initSnap: function() {
                this.currentPage = {},
                "string" == typeof this.options.snap && (this.options.snap = this.scroller.querySelectorAll(this.options.snap)),
                this.on("refresh", function() {
                    var e, t, i, o, s, a, r = 0, l = 0, c = 0, u = this.options.snapStepX || this.wrapperWidth, h = this.options.snapStepY || this.wrapperHeight;
                    if (this.pages = [],
                    this.wrapperWidth && this.wrapperHeight && this.scrollerWidth && this.scrollerHeight) {
                        if (this.options.snap === !0)
                            for (i = n.round(u / 2),
                            o = n.round(h / 2); c > -this.scrollerWidth; ) {
                                for (this.pages[r] = [],
                                e = 0,
                                s = 0; s > -this.scrollerHeight; )
                                    this.pages[r][e] = {
                                        x: n.max(c, this.maxScrollX),
                                        y: n.max(s, this.maxScrollY),
                                        width: u,
                                        height: h,
                                        cx: c - i,
                                        cy: s - o
                                    },
                                    s -= h,
                                    e++;
                                c -= u,
                                r++
                            }
                        else
                            for (a = this.options.snap,
                            e = a.length,
                            t = -1; r < e; r++)
                                (0 === r || a[r].offsetLeft <= a[r - 1].offsetLeft) && (l = 0,
                                t++),
                                this.pages[l] || (this.pages[l] = []),
                                c = n.max(-a[r].offsetLeft, this.maxScrollX),
                                s = n.max(-a[r].offsetTop, this.maxScrollY),
                                i = c - n.round(a[r].offsetWidth / 2),
                                o = s - n.round(a[r].offsetHeight / 2),
                                this.pages[l][t] = {
                                    x: c,
                                    y: s,
                                    width: a[r].offsetWidth,
                                    height: a[r].offsetHeight,
                                    cx: i,
                                    cy: o
                                },
                                c > this.maxScrollX && l++;
                        this.goToPage(this.currentPage.pageX || 0, this.currentPage.pageY || 0, 0),
                        this.options.snapThreshold % 1 === 0 ? (this.snapThresholdX = this.options.snapThreshold,
                        this.snapThresholdY = this.options.snapThreshold) : (this.snapThresholdX = n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width * this.options.snapThreshold),
                        this.snapThresholdY = n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height * this.options.snapThreshold))
                    }
                }),
                this.on("flick", function() {
                    var e = this.options.snapSpeed || n.max(n.max(n.min(n.abs(this.x - this.startX), 1e3), n.min(n.abs(this.y - this.startY), 1e3)), 300);
                    this.goToPage(this.currentPage.pageX + this.directionX, this.currentPage.pageY + this.directionY, e)
                })
            },
            _nearestSnap: function(e, t) {
                if (!this.pages.length)
                    return {
                        x: 0,
                        y: 0,
                        pageX: 0,
                        pageY: 0
                    };
                var i = 0
                  , o = this.pages.length
                  , s = 0;
                if (n.abs(e - this.absStartX) < this.snapThresholdX && n.abs(t - this.absStartY) < this.snapThresholdY)
                    return this.currentPage;
                for (e > 0 ? e = 0 : e < this.maxScrollX && (e = this.maxScrollX),
                t > 0 ? t = 0 : t < this.maxScrollY && (t = this.maxScrollY); i < o; i++)
                    if (e >= this.pages[i][0].cx) {
                        e = this.pages[i][0].x;
                        break
                    }
                for (o = this.pages[i].length; s < o; s++)
                    if (t >= this.pages[0][s].cy) {
                        t = this.pages[0][s].y;
                        break
                    }
                return i == this.currentPage.pageX && (i += this.directionX,
                i < 0 ? i = 0 : i >= this.pages.length && (i = this.pages.length - 1),
                e = this.pages[i][0].x),
                s == this.currentPage.pageY && (s += this.directionY,
                s < 0 ? s = 0 : s >= this.pages[0].length && (s = this.pages[0].length - 1),
                t = this.pages[0][s].y),
                {
                    x: e,
                    y: t,
                    pageX: i,
                    pageY: s
                }
            },
            goToPage: function(e, t, i, o) {
                o = o || this.options.bounceEasing,
                e >= this.pages.length ? e = this.pages.length - 1 : e < 0 && (e = 0),
                t >= this.pages[e].length ? t = this.pages[e].length - 1 : t < 0 && (t = 0);
                var s = this.pages[e][t].x
                  , a = this.pages[e][t].y;
                i = void 0 === i ? this.options.snapSpeed || n.max(n.max(n.min(n.abs(s - this.x), 1e3), n.min(n.abs(a - this.y), 1e3)), 300) : i,
                this.currentPage = {
                    x: s,
                    y: a,
                    pageX: e,
                    pageY: t
                },
                this.scrollTo(s, a, i, o)
            },
            next: function(e, t) {
                var i = this.currentPage.pageX
                  , n = this.currentPage.pageY;
                i++,
                i >= this.pages.length && this.hasVerticalScroll && (i = 0,
                n++),
                this.goToPage(i, n, e, t)
            },
            prev: function(e, t) {
                var i = this.currentPage.pageX
                  , n = this.currentPage.pageY;
                i--,
                i < 0 && this.hasVerticalScroll && (i = 0,
                n--),
                this.goToPage(i, n, e, t)
            },
            _initKeys: function(e) {
                var i, n = {
                    pageUp: 33,
                    pageDown: 34,
                    end: 35,
                    home: 36,
                    left: 37,
                    up: 38,
                    right: 39,
                    down: 40
                };
                if ("object" == typeof this.options.keyBindings)
                    for (i in this.options.keyBindings)
                        "string" == typeof this.options.keyBindings[i] && (this.options.keyBindings[i] = this.options.keyBindings[i].toUpperCase().charCodeAt(0));
                else
                    this.options.keyBindings = {};
                for (i in n)
                    this.options.keyBindings[i] = this.options.keyBindings[i] || n[i];
                l.addEvent(t, "keydown", this),
                this.on("destroy", function() {
                    l.removeEvent(t, "keydown", this)
                })
            },
            _key: function(e) {
                if (this.enabled) {
                    var t, i = this.options.snap, o = i ? this.currentPage.pageX : this.x, s = i ? this.currentPage.pageY : this.y, a = l.getTime(), r = this.keyTime || 0, c = .25;
                    switch (this.options.useTransition && this.isInTransition && (t = this.getComputedPosition(),
                    this._translate(n.round(t.x), n.round(t.y)),
                    this.isInTransition = !1),
                    this.keyAcceleration = a - r < 200 ? n.min(this.keyAcceleration + c, 50) : 0,
                    e.keyCode) {
                    case this.options.keyBindings.pageUp:
                        this.hasHorizontalScroll && !this.hasVerticalScroll ? o += i ? 1 : this.wrapperWidth : s += i ? 1 : this.wrapperHeight;
                        break;
                    case this.options.keyBindings.pageDown:
                        this.hasHorizontalScroll && !this.hasVerticalScroll ? o -= i ? 1 : this.wrapperWidth : s -= i ? 1 : this.wrapperHeight;
                        break;
                    case this.options.keyBindings.end:
                        o = i ? this.pages.length - 1 : this.maxScrollX,
                        s = i ? this.pages[0].length - 1 : this.maxScrollY;
                        break;
                    case this.options.keyBindings.home:
                        o = 0,
                        s = 0;
                        break;
                    case this.options.keyBindings.left:
                        o += i ? -1 : 5 + this.keyAcceleration >> 0;
                        break;
                    case this.options.keyBindings.up:
                        s += i ? 1 : 5 + this.keyAcceleration >> 0;
                        break;
                    case this.options.keyBindings.right:
                        o -= i ? -1 : 5 + this.keyAcceleration >> 0;
                        break;
                    case this.options.keyBindings.down:
                        s -= i ? 1 : 5 + this.keyAcceleration >> 0;
                        break;
                    default:
                        return
                    }
                    if (i)
                        return void this.goToPage(o, s);
                    o > 0 ? (o = 0,
                    this.keyAcceleration = 0) : o < this.maxScrollX && (o = this.maxScrollX,
                    this.keyAcceleration = 0),
                    s > 0 ? (s = 0,
                    this.keyAcceleration = 0) : s < this.maxScrollY && (s = this.maxScrollY,
                    this.keyAcceleration = 0),
                    this.scrollTo(o, s, 0),
                    this.keyTime = a
                }
            },
            _animate: function(e, t, i, n) {
                function o() {
                    var d, p, m, f = l.getTime();
                    return f >= h ? (s.isAnimating = !1,
                    s._translate(e, t),
                    void (s.resetPosition(s.options.bounceTime) || s._execEvent("scrollEnd"))) : (f = (f - u) / i,
                    m = n(f),
                    d = (e - a) * m + a,
                    p = (t - c) * m + c,
                    s._translate(d, p),
                    void (s.isAnimating && r(o)))
                }
                var s = this
                  , a = this.x
                  , c = this.y
                  , u = l.getTime()
                  , h = u + i;
                this.isAnimating = !0,
                o()
            },
            handleEvent: function(e) {
                switch (e.type) {
                case "touchstart":
                case "pointerdown":
                case "MSPointerDown":
                case "mousedown":
                    this._start(e);
                    break;
                case "touchmove":
                case "pointermove":
                case "MSPointerMove":
                case "mousemove":
                    this._move(e);
                    break;
                case "touchend":
                case "pointerup":
                case "MSPointerUp":
                case "mouseup":
                case "touchcancel":
                case "pointercancel":
                case "MSPointerCancel":
                case "mousecancel":
                    this._end(e);
                    break;
                case "orientationchange":
                case "resize":
                    this._resize();
                    break;
                case "transitionend":
                case "webkitTransitionEnd":
                case "oTransitionEnd":
                case "MSTransitionEnd":
                    this._transitionEnd(e);
                    break;
                case "wheel":
                case "DOMMouseScroll":
                case "mousewheel":
                    this._wheel(e);
                    break;
                case "keydown":
                    this._key(e);
                    break;
                case "click":
                    e._constructed || (e.preventDefault(),
                    e.stopPropagation())
                }
            }
        },
        a.prototype = {
            handleEvent: function(e) {
                switch (e.type) {
                case "touchstart":
                case "pointerdown":
                case "MSPointerDown":
                case "mousedown":
                    this._start(e);
                    break;
                case "touchmove":
                case "pointermove":
                case "MSPointerMove":
                case "mousemove":
                    this._move(e);
                    break;
                case "touchend":
                case "pointerup":
                case "MSPointerUp":
                case "mouseup":
                case "touchcancel":
                case "pointercancel":
                case "MSPointerCancel":
                case "mousecancel":
                    this._end(e)
                }
            },
            destroy: function() {
                this.options.interactive && (l.removeEvent(this.indicator, "touchstart", this),
                l.removeEvent(this.indicator, l.prefixPointerEvent("pointerdown"), this),
                l.removeEvent(this.indicator, "mousedown", this),
                l.removeEvent(t, "touchmove", this),
                l.removeEvent(t, l.prefixPointerEvent("pointermove"), this),
                l.removeEvent(t, "mousemove", this),
                l.removeEvent(t, "touchend", this),
                l.removeEvent(t, l.prefixPointerEvent("pointerup"), this),
                l.removeEvent(t, "mouseup", this)),
                this.options.defaultScrollbars && this.wrapper.parentNode.removeChild(this.wrapper)
            },
            _start: function(e) {
                var i = e.touches ? e.touches[0] : e;
                e.preventDefault(),
                e.stopPropagation(),
                this.transitionTime(),
                this.initiated = !0,
                this.moved = !1,
                this.lastPointX = i.pageX,
                this.lastPointY = i.pageY,
                this.startTime = l.getTime(),
                this.options.disableTouch || l.addEvent(t, "touchmove", this),
                this.options.disablePointer || l.addEvent(t, l.prefixPointerEvent("pointermove"), this),
                this.options.disableMouse || l.addEvent(t, "mousemove", this),
                this.scroller._execEvent("beforeScrollStart")
            },
            _move: function(e) {
                var t, i, n, o, s = e.touches ? e.touches[0] : e;
                l.getTime();
                this.moved || this.scroller._execEvent("scrollStart"),
                this.moved = !0,
                t = s.pageX - this.lastPointX,
                this.lastPointX = s.pageX,
                i = s.pageY - this.lastPointY,
                this.lastPointY = s.pageY,
                n = this.x + t,
                o = this.y + i,
                this._pos(n, o),
                e.preventDefault(),
                e.stopPropagation()
            },
            _end: function(e) {
                if (this.initiated) {
                    if (this.initiated = !1,
                    e.preventDefault(),
                    e.stopPropagation(),
                    l.removeEvent(t, "touchmove", this),
                    l.removeEvent(t, l.prefixPointerEvent("pointermove"), this),
                    l.removeEvent(t, "mousemove", this),
                    this.scroller.options.snap) {
                        var i = this.scroller._nearestSnap(this.scroller.x, this.scroller.y)
                          , o = this.options.snapSpeed || n.max(n.max(n.min(n.abs(this.scroller.x - i.x), 1e3), n.min(n.abs(this.scroller.y - i.y), 1e3)), 300);
                        this.scroller.x == i.x && this.scroller.y == i.y || (this.scroller.directionX = 0,
                        this.scroller.directionY = 0,
                        this.scroller.currentPage = i,
                        this.scroller.scrollTo(i.x, i.y, o, this.scroller.options.bounceEasing))
                    }
                    this.moved && this.scroller._execEvent("scrollEnd")
                }
            },
            transitionTime: function(e) {
                e = e || 0,
                this.indicatorStyle[l.style.transitionDuration] = e + "ms",
                !e && l.isBadAndroid && (this.indicatorStyle[l.style.transitionDuration] = "0.001s")
            },
            transitionTimingFunction: function(e) {
                this.indicatorStyle[l.style.transitionTimingFunction] = e
            },
            refresh: function() {
                this.transitionTime(),
                this.options.listenX && !this.options.listenY ? this.indicatorStyle.display = this.scroller.hasHorizontalScroll ? "block" : "none" : this.options.listenY && !this.options.listenX ? this.indicatorStyle.display = this.scroller.hasVerticalScroll ? "block" : "none" : this.indicatorStyle.display = this.scroller.hasHorizontalScroll || this.scroller.hasVerticalScroll ? "block" : "none",
                this.scroller.hasHorizontalScroll && this.scroller.hasVerticalScroll ? (l.addClass(this.wrapper, "iScrollBothScrollbars"),
                l.removeClass(this.wrapper, "iScrollLoneScrollbar"),
                this.options.defaultScrollbars && this.options.customStyle && (this.options.listenX ? this.wrapper.style.right = "8px" : this.wrapper.style.bottom = "8px")) : (l.removeClass(this.wrapper, "iScrollBothScrollbars"),
                l.addClass(this.wrapper, "iScrollLoneScrollbar"),
                this.options.defaultScrollbars && this.options.customStyle && (this.options.listenX ? this.wrapper.style.right = "2px" : this.wrapper.style.bottom = "2px"));
                this.wrapper.offsetHeight;
                this.options.listenX && (this.wrapperWidth = this.wrapper.clientWidth,
                this.options.resize ? (this.indicatorWidth = n.max(n.round(this.wrapperWidth * this.wrapperWidth / (this.scroller.scrollerWidth || this.wrapperWidth || 1)), 8),
                this.indicatorStyle.width = this.indicatorWidth + "px") : this.indicatorWidth = this.indicator.clientWidth,
                this.maxPosX = this.wrapperWidth - this.indicatorWidth,
                "clip" == this.options.shrink ? (this.minBoundaryX = -this.indicatorWidth + 8,
                this.maxBoundaryX = this.wrapperWidth - 8) : (this.minBoundaryX = 0,
                this.maxBoundaryX = this.maxPosX),
                this.sizeRatioX = this.options.speedRatioX || this.scroller.maxScrollX && this.maxPosX / this.scroller.maxScrollX),
                this.options.listenY && (this.wrapperHeight = this.wrapper.clientHeight,
                this.options.resize ? (this.indicatorHeight = n.max(n.round(this.wrapperHeight * this.wrapperHeight / (this.scroller.scrollerHeight || this.wrapperHeight || 1)), 8),
                this.indicatorStyle.height = this.indicatorHeight + "px") : this.indicatorHeight = this.indicator.clientHeight,
                this.maxPosY = this.wrapperHeight - this.indicatorHeight,
                "clip" == this.options.shrink ? (this.minBoundaryY = -this.indicatorHeight + 8,
                this.maxBoundaryY = this.wrapperHeight - 8) : (this.minBoundaryY = 0,
                this.maxBoundaryY = this.maxPosY),
                this.maxPosY = this.wrapperHeight - this.indicatorHeight,
                this.sizeRatioY = this.options.speedRatioY || this.scroller.maxScrollY && this.maxPosY / this.scroller.maxScrollY),
                this.updatePosition()
            },
            updatePosition: function() {
                var e = this.options.listenX && n.round(this.sizeRatioX * this.scroller.x) || 0
                  , t = this.options.listenY && n.round(this.sizeRatioY * this.scroller.y) || 0;
                this.options.ignoreBoundaries || (e < this.minBoundaryX ? ("scale" == this.options.shrink && (this.width = n.max(this.indicatorWidth + e, 8),
                this.indicatorStyle.width = this.width + "px"),
                e = this.minBoundaryX) : e > this.maxBoundaryX ? "scale" == this.options.shrink ? (this.width = n.max(this.indicatorWidth - (e - this.maxPosX), 8),
                this.indicatorStyle.width = this.width + "px",
                e = this.maxPosX + this.indicatorWidth - this.width) : e = this.maxBoundaryX : "scale" == this.options.shrink && this.width != this.indicatorWidth && (this.width = this.indicatorWidth,
                this.indicatorStyle.width = this.width + "px"),
                t < this.minBoundaryY ? ("scale" == this.options.shrink && (this.height = n.max(this.indicatorHeight + 3 * t, 8),
                this.indicatorStyle.height = this.height + "px"),
                t = this.minBoundaryY) : t > this.maxBoundaryY ? "scale" == this.options.shrink ? (this.height = n.max(this.indicatorHeight - 3 * (t - this.maxPosY), 8),
                this.indicatorStyle.height = this.height + "px",
                t = this.maxPosY + this.indicatorHeight - this.height) : t = this.maxBoundaryY : "scale" == this.options.shrink && this.height != this.indicatorHeight && (this.height = this.indicatorHeight,
                this.indicatorStyle.height = this.height + "px")),
                this.x = e,
                this.y = t,
                this.scroller.options.useTransform ? this.indicatorStyle[l.style.transform] = "translate(" + e + "px," + t + "px)" + this.scroller.translateZ : (this.indicatorStyle.left = e + "px",
                this.indicatorStyle.top = t + "px")
            },
            _pos: function(e, t) {
                e < 0 ? e = 0 : e > this.maxPosX && (e = this.maxPosX),
                t < 0 ? t = 0 : t > this.maxPosY && (t = this.maxPosY),
                e = this.options.listenX ? n.round(e / this.sizeRatioX) : this.scroller.x,
                t = this.options.listenY ? n.round(t / this.sizeRatioY) : this.scroller.y,
                this.scroller.scrollTo(e, t)
            },
            fade: function(e, t) {
                if (!t || this.visible) {
                    clearTimeout(this.fadeTimeout),
                    this.fadeTimeout = null ;
                    var i = e ? 250 : 500
                      , n = e ? 0 : 300;
                    e = e ? "1" : "0",
                    this.wrapperStyle[l.style.transitionDuration] = i + "ms",
                    this.fadeTimeout = setTimeout(function(e) {
                        this.wrapperStyle.opacity = e,
                        this.visible = +e
                    }
                    .bind(this, e), n)
                }
            }
        },
        o.utils = l,
        "undefined" != typeof e && e.exports ? e.exports = o : t.IScroll = o;
    }(window, document, Math)
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.once("open", function() {
            this.buttonsContainer = this.entryList.createChild("div"),
            this._addCancel()
        }),
        this.on("open", function(e, t) {
            this._update(e),
            t()
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(204);
    o(n, s),
    e.exports = n,
    n.prototype._update = function(e) {
        function t() {
            i.close();
            var e = this.action;
            e.cb && e.cb();
            var t = window[e.target];
            t && t[e.action] && t[e.action].apply(t, e.params),
            i.emit("action", e)
        }
        var i = this;
        e = e || {};
        var n = e.actions || [];
        this.header.setText(e.title || ""),
        this._displayHeader(!!e.title),
        this.buttonsContainer.clearContent();
        for (var o = 0, s = n.length; o < s; o++) {
            var r = n[o];
            if (!r.hidden) {
                var l = this.buttonsContainer.appendChild(new a({
                    className: "cmButton"
                },t));
                if (r.caption && l.setText(r.caption),
                r.wuiDomChild && l.appendChild(r.wuiDomChild),
                r.line)
                    l.addClassNames("line");
                else {
                    var c = "";
                    r.isTitle && (c = "title"),
                    r.disabled ? l.addClassNames(c, "disabled") : (r.ticked && l.addClassNames(c, "ticked"),
                    r.addClassNames && l.addClassNames(r.addClassNames),
                    l.addClassNames(c),
                    l.action = r)
                }
            }
        }
    }
}
, function(e, t, i) {
    function n() {
        function e() {
            window.isoEngine.useInteractive(this.elementId, this.skillId),
            t.close()
        }
        s.call(this);
        var t = this;
        this.once("open", function() {
            this._setupDom()
        }),
        this.on("open", function(t, i) {
            function n(t, i) {
                var n = t._name || "skill " + t.skillId
                  , a = o.actionsContainer.appendChild(new l({
                    text: n,
                    className: "cmButton"
                },e));
                return i ? void a.disable() : (a.elementId = s.elementId,
                void (a.skillId = t.skillInstanceUid))
            }
            var o = this
              , s = t || {};
            if (s.ageBonus ? (this.starCounter.setValue(s.ageBonus),
            this.starCounter.show()) : this.starCounter.hide(),
            s._houseData) {
                u.getWindow("houseBuySell").prepareDialog(s._houseData);
                var a = s._houseData.houseId
                  , c = window.gui.playerData.position.getHousePropertiesById(a);
                if (c) {
                    var d;
                    d = "?" === c.ownerName ? r("ui.common.houseWithNoOwner") : c.ownerName !== window.gui.playerData.identification.nickname ? r("ui.house.homeOf", c.ownerName) : r("ui.common.myHouse"),
                    this.banner.setContent({
                        house: {
                            houseOwner: d,
                            houseName: c._name,
                            houseId: c.houseId,
                            forSale: c.isOnSale
                        },
                        guild: c.guildInfo
                    }),
                    this._displayHeader(!0)
                } else
                    this._displayHeader(!1)
            } else
                s._name ? (this.banner.setContent({
                    name: s._name
                }),
                this._displayHeader(!0)) : this._displayHeader(!1);
            this.actionsContainer.clearContent();
            var p, m;
            for (p = 0,
            m = s.enabledSkills.length; p < m; p++)
                n(s.enabledSkills[p]);
            for (p = 0,
            m = s.disabledSkills.length; p < m; p++)
                n(s.disabledSkills[p], !0);
            0 === s.enabledSkills.length && s.disabledSkills.length > 0 && h(s.elementTypeId, s.disabledSkills),
            i()
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(307)
      , r = i(35).getText
      , l = i(204)
      , c = i(284)
      , u = i(22)
      , h = i(309).displayNotification;
    o(n, s),
    e.exports = n,
    n.prototype._setupDom = function() {
        this.banner = this.header.appendChild(new a);
        var e = this.entryList;
        this.starCounter = e.appendChild(new c),
        this.actionsContainer = e.createChild("div"),
        this._addCancel()
    }
}
, function(e, t, i) {
    function n() {
        o.call(this, "div", {
            className: "EntityBanner"
        }),
        this._guildEmblem = this.appendChild(new s({
            width: 40,
            height: 40
        }));
        var e = this.createChild("div", {
            className: "nameBox"
        });
        this._allianceEmblem = this.appendChild(new s({
            width: 40,
            height: 40
        })),
        this._guildName = e.createChild("div", {
            className: "guildName"
        }),
        this._name = e.createChild("div", {
            className: "name"
        }),
        this._houseName = e.createChild("div", {
            className: "houseName"
        }),
        this._houseOwner = e.createChild("div", {
            className: "houseOwner"
        }),
        this._forSale = e.createChild("div", {
            className: "forSale",
            text: a("ui.common.forSale")
        })
    }
    i(308);
    var o = i(190)
      , s = i(289)
      , a = i(35).getText
      , r = i(26).inherits;
    r(n, o),
    n.prototype.setContent = function(e) {
        e = e || {},
        this._name.setText(e.name || ""),
        this._name.toggleDisplay(!!e.name);
        var t, i = e.guild;
        i ? (this._guildName.setText(i.guildName),
        this._guildName.show(),
        t = i.guildEmblem,
        t && this._guildEmblem.setValue(t, !0),
        this._guildEmblem.show()) : (this._guildName.hide(),
        this._guildEmblem.hide());
        var n = e.alliance;
        n ? (this.addClassNames("alliance"),
        i ? this._guildName.setText(i.guildName + " - [" + n.allianceTag + "]") : (this._guildName.setText(n.allianceName),
        this._guildName.show()),
        t = n.allianceEmblem,
        t && (t.isAlliance = !0,
        this._allianceEmblem.setValue(t, !0),
        this._allianceEmblem.show())) : (this.delClassNames("alliance"),
        this._allianceEmblem.hide());
        var o = e.house || {};
        this._houseOwner.setText(o.houseOwner || ""),
        this._houseOwner.toggleDisplay(!!o.houseOwner),
        o.houseName && (o.houseName += window.gui.playerData.isModeratorOrMore() ? " (" + o.houseId + ")" : "",
        this._houseName.setText(o.houseName)),
        this._houseName.toggleDisplay(!!o.houseName),
        this._forSale.toggleDisplay(!!o.forSale)
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        for (var t = "<ul>", i = 0; i < e.length; i += 1) {
            var n = e[i];
            t += "<li>" + n + "</li>"
        }
        return t + "</ul>"
    }
    function o(e) {
        var t = window.gui.playerData.position.isInIncarnam()
          , i = t ? m : f
          , o = t ? g : _
          , s = window.gui.playerData.jobs.getJobNpcNameById(i)
          , a = h("ui.skill.jobNotKnown", n(e.jobNameList)) + "\n";
        return a += h("ui.npc.learnJobs", s, o[0], o[1])
    }
    function s(e) {
        for (var t, i = e.jobNameList, n = e.jobLevelList, o = e.levelMinList, s = "<ul>", a = 0; a < i.length; a += 1)
            t = h("ui.skill.levelLowJob", i[a], o[a], n[a]),
            s += "<li>" + t + "</li>";
        return s += "</ul>",
        h("ui.skill.levelLow", s)
    }
    function a(e) {
        var t = h("ui.common.colon") + n(e.jobNameList);
        return h("ui.skill.toolNeeded", t)
    }
    function r(e) {
        var t = [];
        for (var i in e) {
            var n = e[i]
              , o = v[n.type](n);
            t.push(o)
        }
        return t.join("\n")
    }
    function l(e, t) {
        if (!e)
            return "jobNotKnown";
        if (e.experience.jobLevel < t._levelMin)
            return "levelLow";
        var i = window.gui.playerData.inventory.getCurrentWeapon() || {};
        return i.item && e.info.toolIds.indexOf(i.item.id) !== -1 ? void 0 : "toolNeeded"
    }
    function c(e, t) {
        var i = {
            type: "",
            jobNameList: [],
            jobLevelList: [],
            levelMinList: []
        };
        return i.type = l(e, t),
        i.type && (i.jobNameList.push(t._parentJobName),
        "levelLow" === i.type && (i.jobLevelList.push(e.experience.jobLevel),
        i.levelMinList.push(t._levelMin))),
        i
    }
    function u(e) {
        for (var t = window.gui.playerData.jobs.list, i = {}, n = [], o = 0; o < e.length; o += 1) {
            var s = e[o]
              , a = s._parentJobId
              , r = c(t[a], s)
              , l = r.type;
            if (l && n.indexOf(a) === -1) {
                if (i[l]) {
                    var u = i[l];
                    u.jobNameList = u.jobNameList.concat(r.jobNameList),
                    u.jobLevelList = u.jobLevelList.concat(r.jobLevelList),
                    u.levelMinList = u.levelMinList.concat(r.levelMinList)
                } else
                    i[l] = r;
                n.push(a)
            }
        }
        return i
    }
    var h = i(35).getText
      , d = i(22)
      , p = i(190)
      , m = 849
      , f = 601
      , g = [4, 3]
      , _ = [1, -20]
      , v = {
        jobNotKnown: o,
        levelLow: s,
        toolNeeded: a
    };
    t.displayNotification = function(e, i) {
        var n = window.gui.notificationBar
          , o = "jobNotification" + e;
        if (n.isNotificationOpen(o))
            return n.removeNotification(o),
            void setTimeout(function() {
                t.displayNotification(e, i)
            }, 0);
        var s = i.filter(function(e) {
            return e._parentJobId && 1 !== e._parentJobId
        })
          , a = u(s)
          , l = Object.keys(a).length;
        if (0 !== l) {
            l > 1 && a.jobNotKnown && delete a.jobNotKnown;
            var c = r(a)
              , m = new p("div");
            m.setHtml(c);
            var f = {
                type: n.notificationType.INFORMATION,
                title: h("ui.skill.disabled"),
                wuidom: m,
                iconId: 27,
                iconColor: "yellow",
                timer: 3e4
            };
            if (!a.jobNotKnown)
                return n.newNotification(o, f);
            var v = window.gui.playerData.position.isInIncarnam()
              , y = v ? g : _
              , w = y[0]
              , b = y[1];
            f.buttons = [{
                label: h("ui.npc.location"),
                action: function() {
                    window.gui.emit("CompassUpdateMessage", {
                        type: -1,
                        worldX: w,
                        worldY: b
                    }),
                    d.open("worldMap", {
                        x: w,
                        y: b
                    })
                }
            }],
            n.newNotification(o, f)
        }
    }
}
, function(e, t, i) {
    function n() {
        c.call(this);
        var e, t = {}, i = {};
        this.once("open", function() {
            this._setupDom(t, i)
        }),
        this.on("open", function(n, o) {
            this._params = n;
            var s = this._item = n.item;
            this._action = null ,
            e = n.onClose;
            var a = s.objectUID ? s : null
              , c = this._dbItem = a ? a.item : s;
            this.header.setText(c.nameId || (c.mountLocation ? u("ui.common.ride") : "")),
            i.backgroundImage = c.image;
            for (var h in t)
                t[h].hide();
            var d = window.gui.tutorialManager.inTutorial
              , f = !n.hasOwnProperty("enableSet") || n.enableSet
              , g = !n.hasOwnProperty("enableRecipe") || n.enableRecipe
              , _ = !n.hasOwnProperty("enableInsertRecipe") || n.enableInsertRecipe
              , v = !n.hasOwnProperty("enableDestroy") || n.enableDestroy
              , y = !!n.hasOwnProperty("enableSell") && n.enableSell
              , w = !n.hasOwnProperty("enableCertificate") || n.enableCertificate
              , b = !!c && !d && !c.mountLocation
              , C = !!s.getItemInstance() && s.getItem().typeId === m;
            if (t.itemSet.toggleDisplay(!!c.itemSetId && c.itemSetId !== -1 && !d && f),
            t.recipes.toggleDisplay(g && b),
            t.insertRecipe.toggleDisplay(_ && b),
            t.findInBestiary.toggleDisplay(!!s.getProperty("dropMonsterIds").length),
            t.bidHouseSell.toggleDisplay(!!a && y),
            t.dismount.toggleDisplay("equip" === c.mountLocation),
            t.remove.toggleDisplay(!!n.remove && !d),
            t.mount.toggleDisplay(w && C),
            a && n.enableActions) {
                var I = window.gui.gameContext === p.FIGHT
                  , T = r(c.type && c.type.superTypeId) && !l(s.position);
                t.feed.toggleDisplay(!!c.isPet && !d),
                t.multiUse.toggleDisplay(!!c.usable && s.quantity > 1 && !!s.isOkForMultiUse && !d),
                t.use.toggleDisplay(!!c.usable),
                t.target.toggleDisplay(!(I || !c.targetable || c.nonUsableOnAnother || d)),
                t.equip.toggleDisplay(T),
                t.unequip.toggleDisplay(l(s.position)),
                t.mount.toggleDisplay(C),
                t.destroy.toggleDisplay(s.quantity > 0 && !d && v),
                t.manage.toggleDisplay(!!s.livingObjectCategory && !d)
            }
            o()
        }),
        this.on("close", function() {
            e && e(this._action)
        })
    }
    var o = i(311)
      , s = i(186)
      , a = i(26).inherits
      , r = i(323).isEquippable
      , l = i(323).isEquipped
      , c = i(299)
      , u = i(35).getText
      , h = i(201)
      , d = i(22)
      , p = i(85)
      , m = 97
      , f = 40;
    a(n, c),
    e.exports = n,
    n.prototype._setupDom = function(e, t) {
        function i(e, t, i) {
            n = e,
            l.open({
                min: t,
                max: i,
                x: a._position.x,
                y: a._position.y
            })
        }
        var n, a = this, r = window.gui.playerData.inventory, l = this._minMaxSelector = window.gui.windowsContainer.appendChild(new h);
        e.equip = this._addEntry(u("ui.common.equip"), function() {
            r.equipItem(a._item.objectUID)
        }),
        e.unequip = this._addEntry(u("tablet.common.unequip"), function() {
            r.unEquipItem(a._item.objectUID)
        });
        var c = e.target = this._addEntry(u("ui.common.target"), function() {
            return window.gui.openSimplePopup(u("tablet.ui.item.targetInfo"))
        });
        s.setDraggable(c, t, "itemContextMenu", null , {
            containerWidth: f,
            containerHeight: f
        }),
        c.on("dragStart", function() {
            this.item = a._item,
            d.closeAll(),
            a.close()
        }),
        e.feed = this._addEntry(u("ui.common.feed"), function() {
            var e = a._item.item
              , t = d.getWindow("feed");
            return t.possessFeedItemForPet(a._item) ? void d.open("feed", {
                mode: "pet",
                item: a._item
            }) : window.gui.openSimplePopup(u("ui.item.errorNoFoodLivingItem", e.nameId))
        }),
        e.use = this._addEntry(u("ui.common.use"), function() {
            var e = a._item;
            return e.item.type.needUseConfirm ? void window.gui.openConfirmPopup({
                title: u("ui.common.confirm"),
                message: u("ui.common.confirmationUseItem", e.item.nameId),
                cb: function(t) {
                    t && window.dofus.sendMessage("ObjectUseMessage", {
                        objectUID: e.objectUID
                    })
                }
            }) : void window.dofus.sendMessage("ObjectUseMessage", {
                objectUID: e.objectUID
            })
        }),
        e.multiUse = this._addEntry(u("ui.common.multipleUse"), function() {
            i("use", 1, a._item.quantity)
        }),
        e.recipes = this._addEntry(u("ui.craft.associateReceipts"), function() {
            d.open("itemRecipes", {
                itemData: a._item || a._dbItem
            })
        }),
        e.insertRecipe = this._addEntry(u("ui.craft.displayChatRecipe"), function() {
            window.gui.chat.insertLink("recipe", a._item)
        }),
        e.findInBestiary = this._addEntry(u("ui.common.bestiary"), function() {
            var e = a._item.getRawName();
            d.open("grimoire", {
                tabId: "bestiary",
                tabParams: {
                    search: e
                }
            })
        }),
        e.bidHouseSell = this._addEntry(u("tablet.itemSellInBidHouse"), function() {
            o.openBidHouse(!0, null , a._item)
        }),
        e.itemSet = this._addEntry(u("ui.common.set"), function() {
            d.open("itemSets", a._item)
        }),
        e.manage = this._addEntry(u("ui.item.manageItem"), function() {
            d.open("itemManage", {
                itemInstance: a._item
            })
        }),
        e.mount = this._addEntry(u("ui.mount.viewMountDetails"), function() {
            d.getWindow("mount").showCertificateMount(a._item)
        }),
        e.dismount = this._addEntry(u("ui.shortcuts.toggleRide"), function() {
            window.dofus.sendMessage("MountToggleRidingRequestMessage")
        }),
        e.destroy = this._addEntry(u("ui.common.destroyThisItem"), function() {
            var e = a._item;
            return 1 === e.quantity ? void window.gui.playerData.inventory.confirmDestroyItem(e, 1) : void i("destroy", 1, e.quantity)
        }),
        e.remove = this._addEntry(u("ui.common.remove"), function() {
            a._action = "remove"
        }),
        l.on("confirm", function(e) {
            var t = a._item;
            switch (n) {
            case "use":
                window.dofus.sendMessage("ObjectUseMultipleMessage", {
                    objectUID: t.objectUID,
                    quantity: e
                });
                break;
            case "destroy":
                window.gui.playerData.inventory.confirmDestroyItem(t, e);
                break;
            default:
                console.warn("[ContextualMenuItem] unknow mode.")
            }
        }),
        this._addCancel()
    }
}
, function(e, t, i) {
    function n() {
        I.call(this, {
            className: "BidHouseShopWindow",
            freeContentDelay: N,
            positionInfo: {
                left: "0",
                bottom: "0",
                width: P,
                height: "100%"
            },
            title: v("ui.bidhouse.bigStoreItemList")
        }),
        this.openOnItem = null ,
        this.backBtn = null ,
        this.searchBox = null ,
        this.isListening = !1,
        this.sortedAllowedTypes = {},
        this.currentSearchText = null ,
        this.currentSearchItemTypeMap = null ,
        this.currentItemTypeElt = null ,
        this.liveItemTypeId = null ,
        this.liveItems = null ,
        this._categoryToDisplay = null ,
        this._categoryToDisplayItems = null ,
        this._requestedCategories = [],
        this.availableItemCache = {},
        this.on("open", this._onOpen),
        this.on("close", this._onClose)
    }
    function o(e, t, i) {
        var n = T.getWindow(e);
        return n.openState ? i && i !== n.mode ? (n.openOnItem = t,
        !1) : (T.focusWindow(e),
        t && n.navigateToItem(t),
        !0) : (n.openOnItem = t,
        !1)
    }
    function s() {
        var e = this.myWindow
          , t = e.history;
        2 === t.length && e.backBtn.hide(),
        t.pop(),
        e._navigateTo(t[t.length - 1])
    }
    function a(e, t) {
        var i = this.myWindow;
        i._selectItemType(e, t)
    }
    function r(e) {
        var t = this.myWindow.currentSearchText ? "search" : "list";
        T.getWindow("tradeItem").displayItem(t, e),
        T.focusWindow("tradeItem")
    }
    function l() {
        var e = this.myWindow;
        e.shopViewer.refresh()
    }
    function c(e, t) {
        return e.text.localeCompare(t.text)
    }
    function u(e) {
        var t = this.myWindow;
        return t._sortAllowedTypes(e.info)
    }
    function h(e, t) {
        var i = e.myDrilldownList.myWindow
          , n = i._sortAllowedTypes(e.info);
        return !!i.currentSearchItemTypeMap[n[t].id]
    }
    function d(e) {
        for (var t = e.myDrilldownList.myWindow, i = t._sortAllowedTypes(e.info), n = 0; n < i.length; n++)
            if (t.currentSearchItemTypeMap[i[n].id])
                return !0;
        return !1
    }
    function p() {
        this.searchBox.setValue(""),
        this._cancelSearch()
    }
    i(312);
    var m = i(204)
      , f = i(49)
      , g = i(313)
      , _ = i(321)
      , v = i(35).getText
      , y = i(210)
      , w = i(26).inherits
      , b = i(323)
      , C = i(387)
      , I = i(402)
      , T = i(22)
      , S = i(190)
      , A = i(405)
      , E = i(36)
      , x = i(206)
      , M = -1
      , N = 5e3
      , R = 30
      , O = 3
      , P = 300;
    w(n, I),
    e.exports = n,
    n.minWidth = P,
    n.openBidHouse = function(e, t, i) {
        if (e) {
            if (o("tradeStorage", i, "modify-bidHouse"))
                return
        } else if (o("bidHouseShop", i))
            return;
        window.dofus.sendMessage("NpcGenericActionRequestMessage", {
            npcId: t || 0,
            npcActionId: e ? 5 : 6,
            npcMapId: window.gui.playerData.position.mapId
        })
    }
    ,
    n.switchBuySellMode = function(e, t, i) {
        var o = T.getWindow("tradeItem");
        if (!i) {
            var s = o.getCurrentItem();
            s && (i = s.getItemInstance() ? s : s.getProperty("id"))
        }
        T.close("tradeItem"),
        window.dofus.sendMessage("LeaveDialogRequestMessage"),
        window.gui.once("ExchangeLeaveMessage", function() {
            n.openBidHouse(e, t, i)
        })
    }
    ,
    n.prototype._onOpen = function(e) {
        T.arrangeOpeningWindowVertically(this.id, {
            below: "wallet",
            fullHeight: !0
        }),
        this.npcId = e.buyerDescriptor.npcContextualId,
        this.searchBox || (this._createContent(),
        this.isListening || this._setupEventListeners()),
        this.switchToSellModeBtn.enable(),
        this.openOnItem && this.navigateToItem(this.openOnItem)
    }
    ,
    n.prototype._onClose = function() {
        T.close("tradeItem"),
        this._reset(),
        this.liveItemTypeId = null ,
        this.liveItems = null
    }
    ,
    n.prototype._createContent = function() {
        this.history = [],
        this._pushHistory("blank"),
        this._createBackButton(),
        this._createSearchBox(),
        this._createSwitchToSellModeButton(),
        this._createBidHouseCatList(),
        this._createViewer(),
        this._resetSearch()
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this.searchBox = this.bidHouseCatList = this.shopViewer = null ,
        this.availableItemCache = {},
        this.sortedAllowedTypes = {},
        this.history = null ,
        this.backBtn.hide()
    }
    ,
    n.prototype._reset = function() {
        this.currentItemTypeElt = null ,
        this._categoryToDisplayItems = null ,
        this.bidHouseCatList.reset(),
        this._resetSearch()
    }
    ,
    n.prototype._sortAllowedTypes = function(e) {
        if (this.sortedAllowedTypes[e])
            return this.sortedAllowedTypes[e];
        for (var t = window.gui.databases.BidHouseCategories[e].allowedTypes, i = window.gui.databases.ItemTypes, n = [], o = 0; o < t.length; o++) {
            var s = t[o];
            n.push({
                text: i[s].nameId,
                id: s
            })
        }
        return n.sort(c),
        this.sortedAllowedTypes[e] = n,
        n
    }
    ,
    n.prototype._selectItemType = function(e, t) {
        t ? this.bidHouseCatList.selectAndShowSubitem(e) : e !== this.currentItemTypeElt && this._pushHistory("itemType", e),
        this.currentItemTypeElt = e,
        T.close("tradeItem"),
        this._requestAndDisplayItemAvailability(e.data.id)
    }
    ,
    n.prototype._createBackButton = function() {
        if (!this.backBtn) {
            var e = this.backBtn = new m({
                className: "backButton",
                hidden: !0
            },s);
            e.insertBefore(this.windowTitle),
            e.myWindow = this
        }
    }
    ,
    n.prototype._createSwitchToSellModeButton = function() {
        var e = this;
        this.switchToSellModeBtn = this.headerRow.appendChild(new m({
            addIcon: !0,
            className: ["sellModeBtn", "greenButton"],
            tooltip: v("ui.bidhouse.bigStoreModeSell")
        },function() {
            n.switchBuySellMode(!0, e.npcId),
            this.disable()
        }
        ))
    }
    ,
    n.prototype._createSearchBox = function() {
        this.headerRow = this.windowBody.createChild("div", {
            className: "headerRow"
        });
        var e = this.searchBox = this.headerRow.appendChild(new A({
            maxLength: R
        }));
        e.on("search", this._search.bind(this)),
        e.on("cancel", this._cancelSearch.bind(this))
    }
    ,
    n.prototype._createBidHouseCatList = function() {
        var e = this.bidHouseCatList = new g;
        e.myWindow = this,
        e.setSubitemsGetter(u),
        e.setFilter(d, h);
        var t = window.gui.databases.BidHouseCategories
          , i = [];
        for (var n in t)
            i.push({
                text: t[~~n].description,
                id: ~~n
            });
        i.sort(c);
        for (var o = 0; o < i.length; o++)
            e.addItem(i[o].text, i[o].id);
        e.getDom(this.windowBody).addClassNames("bidHouseCategories"),
        e.on("subitemSelected", a),
        e.on("resized", l)
    }
    ,
    n.prototype._searchAgainFromTop = function() {
        this.currentItemTypeElt = null ,
        this._categoryToDisplayItems = null ,
        this.bidHouseCatList.reset(),
        this._refreshDisplayedItems()
    }
    ,
    n.prototype._refreshFilter = function() {
        this._categoryToDisplayItems && this._refreshDisplayedItems();
        var e = this.bidHouseCatList.refreshFilter();
        0 === e.itemCount ? (this.bidHouseCatList.toggleBreadcrumb(!1),
        this.bidHouseCatList.setPlaceholder(v("tablet.bidHouse.noCatHasMatchingItem", this.currentSearchText)),
        this.shopViewer.setPlaceholder(v("tablet.bidHouse.noMatchingItem", this.currentSearchText))) : this.bidHouseCatList.setPlaceholder(null )
    }
    ,
    n.prototype._pushHistory = function(e, t) {
        var i = {
            type: e,
            value: t
        };
        "itemType" === e && (i.search = this.currentSearchText),
        this.history.push(i),
        2 === this.history.length && this.backBtn.show()
    }
    ,
    n.prototype._navigateTo = function(e) {
        switch (void 0 !== e.search && this._search(e.search, !0),
        e.type) {
        case "item":
            return this.navigateToItem(e.value, !0);
        case "itemType":
            return this._selectItemType(e.value, !0);
        case "search":
            return this._search(e.value, !0);
        case "blank":
            return this._reset();
        default:
            return console.error("Invalid history", e)
        }
    }
    ,
    n.prototype.navigateToItem = function(e, t) {
        this.openOnItem = null ;
        var i, n;
        "number" == typeof e ? (n = e,
        i = b.items[e]) : (n = e.getProperty("id"),
        i = e.getItem());
        var o = {};
        o[i.typeId] = !0,
        this.currentSearchItemTypeMap = o,
        this.currentSearchText = i.getNameForSearch(),
        this.searchBox.setValue(i.nameId),
        this._refreshFilter(),
        t || this._pushHistory("item", n)
    }
    ,
    n.prototype._search = function(e, t) {
        if (null === e || "" === e)
            return this._cancelSearch(t);
        if (e.length < O)
            return x.showNotification(v("ui.common.searchFilterTooltip"), this.searchBox);
        var i = y.simplifyString(e);
        i !== this.currentSearchText && (this.searchBox.searchInput.blur(),
        this.currentSearchText = i,
        this.bidHouseCatList.inBreadcrumbMode() || this._searchAgainFromTop(),
        t ? this.searchBox.setValue(e) : this._pushHistory("search", e),
        this._searchItemsByName())
    }
    ,
    n.prototype._cancelSearch = function(e) {
        this.searchBox.searchInput.blur(),
        this.currentSearchText && (this.currentSearchText = null ,
        this.bidHouseCatList.removeFilter(),
        this.bidHouseCatList.toggleBreadcrumb(!1),
        this.currentItemTypeElt && this.bidHouseCatList.selectAndShowSubitem(this.currentItemTypeElt),
        this._categoryToDisplayItems && this._refreshDisplayedItems(),
        e ? this.searchBox.clear() : this.currentItemTypeElt && this._pushHistory("itemType", this.currentItemTypeElt))
    }
    ,
    n.prototype._resetSearch = function() {
        this.searchBox.clear(),
        this.currentSearchText = null ,
        this._refreshDisplayedItems()
    }
    ,
    n.prototype._createViewer = function() {
        function e(e, t) {
            var i = e.level - t.level;
            return 0 !== i ? i : e.nameId.localeCompare(t.nameId)
        }
        var t = [{
            id: "icon",
            format: function(e) {
                var t = new S("div",{
                    className: "slot"
                })
                  , i = t.createChild("div", {
                    className: "icon"
                });
                return i.setStyle("backgroundImage", e.image),
                t
            },
            sort: e,
            defaultSorter: !0
        }, {
            id: "name",
            header: "",
            format: function(e) {
                var t = new S("div",{
                    className: "name",
                    text: e.nameId
                });
                return e.etheral ? t.addClassNames("etheral") : e.itemSetId && t.addClassNames("itemSet"),
                t
            },
            getContent: function(e) {
                return e.nameId
            },
            sort: !0
        }];
        this.shopViewer = this.windowBody.appendChild(new C(t,"id",{
            manualFiltering: !0,
            noAllCategory: !0
        })),
        this.shopViewer.on("itemSelected", r),
        this.shopViewer.myWindow = this;
        var i = new S("div",{
            className: "filterHeader"
        });
        this.shopViewerHeaderLabel = i.createChild("div", {
            className: "label",
            text: v("tablet.bidHouse.nowOnSale")
        }),
        this.shopViewerHeaderButton = i.appendChild(new _("",p.bind(this))),
        this.shopViewerHeaderButton.hide(),
        this.shopViewer.setHeader(i)
    }
    ,
    n.prototype._setupEventListeners = function() {
        this.isListening = !0;
        var e = this;
        f.on("ExchangeTypesExchangerDescriptionForUserMessage", function(t) {
            e._requestedCategories.shift(),
            e._storeItemAvailability(t.typeDescription, !0)
        }),
        f.on("ExchangeBidHouseGenericItemAddedMessage", function(t) {
            e._storeItemAvailability(t.objGenericId)
        }),
        f.on("ExchangeBidHouseGenericItemRemovedMessage", function(t) {
            e._storeNonAvailableItem(t.objGenericId)
        })
    }
    ,
    n.prototype._shouldItemBeDisplayed = function(e) {
        return e.typeId === this._categoryToDisplay && (!this.currentSearchText || e.getNameForSearch().indexOf(this.currentSearchText) >= 0)
    }
    ,
    n.prototype._refreshDisplayedItems = function() {
        var e = this._categoryToDisplayItems || []
          , t = !!e.length;
        if (e.length && this.currentSearchText) {
            for (var i = [], n = 0; n < e.length; n++) {
                var o = e[n];
                this._shouldItemBeDisplayed(o) && i.push(o)
            }
            e = i
        }
        if (e.length > 0 && this.bidHouseCatList.toggleBreadcrumb(!0),
        t && this.currentSearchText) {
            var s = v("tablet.common.filterHeader", this._categoryToDisplayItems.length - e.length);
            this.shopViewerHeaderLabel.setText(s),
            this.shopViewerHeaderButton.setLabel(this.currentSearchText),
            this.shopViewerHeaderButton.show(),
            this.shopViewer.table.setSortingHintVisible("name", !0)
        } else
            this.shopViewerHeaderLabel.setText(v("tablet.bidHouse.nowOnSale")),
            this.shopViewerHeaderButton.hide(),
            this.shopViewer.table.setSortingHintVisible("name", !1);
        if (!e.length) {
            this.shopViewer.clearContent();
            var a;
            if (this._categoryToDisplayItems) {
                var r = window.gui.databases.ItemTypes[this._categoryToDisplay].nameId;
                a = t ? v("tablet.bidHouse.noMatchInCat", this.currentSearchText, r) : v("tablet.bidHouse.nothingInCat", r)
            } else
                a = v("tablet.bidHouse.searchOrSelect");
            this.shopViewer.setPlaceholder(a)
        }
        this.shopViewer.setItemList(e)
    }
    ,
    n.prototype._requestAndDisplayItemAvailability = function(e) {
        return e === this.liveItemTypeId ? (this._categoryToDisplayItems = this.liveItems,
        this._refreshDisplayedItems()) : (this._categoryToDisplay = e,
        void (this._requestedCategories.indexOf(e) === -1 && (this._requestedCategories.push(e),
        this.liveItemTypeId = e,
        this.liveItems = null ,
        this.shopViewer.setPlaceholder(" "),
        this.shopViewer.table.placeholder.frame.addClassNames("spinner"),
        window.dofus.sendMessage("ExchangeBidHouseTypeMessage", {
            type: e
        }))))
    }
    ,
    n.prototype._searchItemsByName = function() {
        this.searchBox.showAsSearching(!0);
        var e = this;
        E.searchDataMap("Items", {
            match: this.currentSearchText
        }, function(t, i) {
            if (t)
                return console.error(t),
                e.shopViewer.setPlaceholder(v("tablet.bidHouse.searchError"));
            var n = {};
            for (var o in i) {
                var s = i[~~o];
                n[s.typeId] = !0
            }
            e.currentSearchItemTypeMap = n,
            e._refreshFilter(),
            e.searchBox.showAsSearching(!1)
        })
    }
    ,
    n.prototype._storeItemAvailability = function(e, t) {
        var i = e instanceof Array
          , n = i ? e : [e]
          , o = this;
        b.getItems(n, function(e, i) {
            if (e)
                return console.error(e);
            for (var n = 0; n < i.length; n++) {
                var s = i[n];
                o.availableItemCache[s.id] = [M, Date.now()]
            }
            if (o.openState && (t || o.liveItems)) {
                o.shopViewer.table.placeholder.frame.delClassNames("spinner");
                var a = o._categoryToDisplayItems === o.liveItems;
                o.liveItems = t ? i : o.liveItems.concat(i),
                (a || t) && (o._categoryToDisplayItems = o.liveItems,
                o._refreshDisplayedItems())
            }
        })
    }
    ,
    n.prototype._storeNonAvailableItem = function(e) {
        if (this.openState && this.liveItems) {
            this.availableItemCache[e] = [0, Date.now()];
            for (var t = this.liveItems.length - 1; t >= 0; t--)
                if (this.liveItems[t].id === e) {
                    this.liveItems.splice(t, 1);
                    break
                }
            var i = this._categoryToDisplayItems === this.liveItems;
            i && this.shopViewer.removeItems([e])
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this),
        this._init()
    }
    function o(e) {
        var t = this.myDrilldownList;
        e.isSelected = !1;
        var i = e === t.currentDeployedItem;
        t.deployItem(e, !i)
    }
    function s() {
        var e = this.myTopItem.myDrilldownList;
        return this === e.currentSubitem ? e.toggleBreadcrumb(!0) : void e._selectSubitem(this)
    }
    function a() {
        var e = this.myDrilldownList;
        e.toggleBreadcrumb(!1)
    }
    function r(e, t) {
        e.toggleClassName("selected", t),
        e.subitemList.toggleDisplay(t)
    }
    i(314);
    var l = i(204)
      , c = i(29).EventEmitter
      , u = i(26).inherits
      , h = i(315)
      , d = i(190);
    u(n, c),
    e.exports = n,
    n.prototype._init = function() {
        this.parentElt = null ,
        this.elt = null ,
        this.items = [],
        this.infos = [],
        this.breadcrumb = null ,
        this.list = null ,
        this.currentDeployedItem = null ,
        this.currentSubitem = null ,
        this.isFilterOn = !1,
        this.itemFilterFunc = null ,
        this.subitemFilterFunc = null ,
        this.singleItem = null ,
        this.singleSubitem = null
    }
    ,
    n.prototype.clearContent = function() {
        this.elt && (this.elt.clearContent(),
        this._init())
    }
    ,
    n.prototype.reset = function() {
        if (this.elt) {
            var e = this.currentDeployedItem;
            e && this.deployItem(e, !1),
            this.refresh(!0),
            this._selectSubitem(null ),
            this.removeFilter()
        }
    }
    ,
    n.prototype.setBreadcrumbText = function(e) {
        this.breadcrumbText.setText(e)
    }
    ,
    n.prototype.inBreadcrumbMode = function() {
        return this.breadcrumb.isVisible()
    }
    ,
    n.prototype.toggleBreadcrumb = function(e) {
        this.elt.toggleClassName("onlyBreadcrumb", e),
        this.breadcrumb.toggleDisplay(e),
        this.list.toggleDisplay(!e),
        this.emit("resized"),
        e || (this.list.refresh(),
        this.currentSubitem && this.list.showElement(this.currentSubitem))
    }
    ,
    n.prototype.setSubitemsGetter = function(e) {
        this.getSubitemsFunc = e
    }
    ,
    n.prototype.colorItems = function() {
        for (var e = !0, t = 0; t < this.items.length; t++) {
            var i = this.list.getItem(t);
            i.isVisible() && (i.toggleClassName("odd", e),
            e = !e)
        }
    }
    ,
    n.prototype.getDom = function(e) {
        if (this.elt)
            return this.elt;
        if (!this.items.length)
            return console.warn("Empty DrillDownList");
        this.parentElt = e;
        var t = this.elt = e.createChild("div", {
            className: "drillDownList"
        })
          , i = this.breadcrumb = t.appendChild(new l({
            className: "breadcrumb",
            hidden: !0,
            addIcon: "before",
            text: "_"
        },a));
        i.myDrilldownList = this,
        this.breadcrumbText = i.getChildren()[1],
        this.list = t.appendChild(new h({
            className: "tree"
        })),
        this.list.myDrilldownList = this;
        for (var n = 0; n < this.items.length; n++) {
            var s = new d("div",{
                className: "sublistHeader"
            });
            s.createChild("div", {
                className: "arrow"
            }),
            s.createChild("div", {
                className: "text",
                text: this.items[n]
            });
            var r = this.list.addItem({
                id: n,
                element: s
            }, {
                noRefresh: !0
            });
            r.info = this.infos[n],
            r.myDrilldownList = this
        }
        return this.colorItems(),
        this.list.setStyle("max-height", e.rootElement.clientHeight + "px"),
        this.list.refresh(),
        this.list.on("selected", o),
        this.elt = t,
        t
    }
    ,
    n.prototype._createSubitemList = function(e) {
        for (var t = this.getSubitemsFunc(e), i = e.subitemList = e.appendChild(new d("div",{
            className: "subitemList",
            hidden: !0
        })), n = 0; n < t.length; n++) {
            var o = t[n]
              , a = i.appendChild(new l({
                text: o.text,
                className: "subitem"
            },s));
            a.data = o,
            a.myTopItem = e
        }
    }
    ,
    n.prototype.addItem = function(e, t) {
        this.items.push(e),
        this.infos.push(void 0 !== t ? t : this.infos.length)
    }
    ,
    n.prototype.getItemCount = function() {
        return this.list.getItemCount()
    }
    ,
    n.prototype.getItem = function(e) {
        return this.items[e]
    }
    ,
    n.prototype.getItemElt = function(e) {
        return this.list.getItem(e)
    }
    ,
    n.prototype.selectAndShowSubitem = function(e) {
        this._selectSubitem(e, !1, !0),
        this.list.isVisible() && (this.deployItem(e.myTopItem, !0),
        this.list.showElement(e))
    }
    ,
    n.prototype._selectSubitem = function(e, t, i) {
        var n = this.currentSubitem;
        return n && n.delClassNames("selected"),
        this.currentSubitem = e,
        e ? (this.setBreadcrumbText(this.items[e.myTopItem.id] + " > " + e.data.text),
        e.addClassNames("selected"),
        void (i || this.emit("subitemSelected", e, t))) : this.toggleBreadcrumb(!1)
    }
    ,
    n.prototype.getSelectedSubitem = function() {
        return this.currentSubitem
    }
    ,
    n.prototype.setPlaceholder = function(e) {
        this.list.setPlaceholderText(e)
    }
    ,
    n.prototype.refresh = function(e) {
        this.colorItems(),
        this.list.refresh(),
        e && this.list.goToTop()
    }
    ,
    n.prototype.setFilter = function(e, t) {
        this.itemFilterFunc = e,
        this.subitemFilterFunc = t
    }
    ,
    n.prototype._filterOneItemSubitems = function(e) {
        if (!this.isFilterOn)
            return this._resetFilterOnSubitems(e);
        for (var t, i = 0, n = e.subitemList.getChildren(), o = 0; o < n.length; o++) {
            var s = n[o];
            this.subitemFilterFunc(e, o, s) ? (i++,
            1 === i && (t = s),
            s.show()) : s.hide()
        }
        return 1 === i && (this.singleSubitem = t),
        i
    }
    ,
    n.prototype.isItemDeployed = function(e) {
        return e.subitemList && e.subitemList.isVisible()
    }
    ,
    n.prototype.deployItem = function(e, t) {
        if (t === this.isItemDeployed(e))
            return 0;
        t && !e.subitemList && this._createSubitemList(e);
        var i = this.currentDeployedItem;
        i && e !== i && r(i, !1),
        r(e, t),
        this.currentDeployedItem = t ? e : null ;
        var n = 0;
        return t && (this.subitemFilterFunc ? n = this._filterOneItemSubitems(e) : (n = e.subitemList.getChildCount(),
        1 === n && (this.singleSubitem = e.subitemList.getChildren()[0]))),
        this.list.refresh(),
        this.list.showElement(e),
        n
    }
    ,
    n.prototype.refreshFilter = function() {
        this.isFilterOn = !0;
        for (var e, t = 0, i = this.list.getItems(), n = i.length - 1; n >= 0; n--) {
            var o = i[n];
            this.itemFilterFunc(o) ? (t++,
            1 === t && (e = o),
            this.isItemDeployed(o) && this.subitemFilterFunc && this._filterOneItemSubitems(o),
            o.show()) : o.hide()
        }
        var s = 0;
        return 1 === t && (this.singleItem = e,
        s = this.deployItem(e, !0),
        1 === s && this._selectSubitem(this.singleSubitem, !0)),
        this.refresh(),
        {
            itemCount: t,
            subitemCount: s
        }
    }
    ,
    n.prototype._resetFilterOnSubitems = function(e) {
        if (e.subitemList)
            for (var t = e.subitemList.getChildren(), i = 0; i < t.length; i++)
                t[i].show()
    }
    ,
    n.prototype.removeFilter = function() {
        if (this.isFilterOn) {
            this.isFilterOn = !1;
            for (var e = this.list.getItems(), t = e.length - 1; t >= 0; t--) {
                var i = e[t];
                i.show(),
                this._resetFilterOnSubitems(i)
            }
            this.refresh(),
            this.currentSubitem && (this.list.showElement(this.currentSubitem),
            this.emit("subitemSelected", this.currentSubitem, !0))
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    i(316);
    var n = i(317)
      , o = i(320);
    n.SingleSelectionList = o,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        r.call(this, e),
        this.addClassNames("ListV2"),
        this.options = t || {},
        this.placeholder = null
    }
    var o = i(26).inherits
      , s = i(318)
      , a = i(84).playUiSound
      , r = i(302)
      , l = i(32);
    o(n, r),
    e.exports = n,
    n.prototype._createItem = function(e) {
        e = e || {};
        var t = e.id
          , i = e.element;
        if (!t && 0 !== t)
            return console.error("List: Invalid Id");
        var n = this.content.createChild("div", {
            name: t,
            className: "listItem"
        });
        return n.myList = this,
        n.id = t,
        n.data = e.data,
        "object" == typeof i ? n.appendChild(i) : n.setText(i),
        l(n),
        n.on("tap", this._tapHandler),
        n
    }
    ,
    n.prototype.addItem = function(e, t) {
        t = t || {};
        var i = this._createItem(e);
        return t.noRefresh || this.refresh(),
        i
    }
    ,
    n.prototype.addItems = function(e, t) {
        t = t || {};
        for (var i, n = 0; n < e.length; n += 1)
            i = e[n],
            this._createItem(i);
        return t.noRefresh || this.refresh(),
        this.getItems()
    }
    ,
    n.prototype.removeItem = function(e) {
        var t = this.getItem(e);
        t && t.destroy()
    }
    ,
    n.prototype.selectItem = function(e, t) {
        t = t || {};
        var i = this.getItem(e);
        i && (i.isSelected = !0,
        i.addClassNames("selected"),
        t.noEvent || this.emit("selected", i),
        t.noSound || a("GEN_BUTTON"),
        t.scrollToElement && this.scrollToElement(i))
    }
    ,
    n.prototype.deselectItem = function(e, t) {
        t = t || {};
        var i = this.getItem(e);
        i && (i.isSelected = !1,
        i.delClassNames("selected"),
        t.noEvent || this.emit("deselected", i),
        t.noSound || a("GEN_BUTTON"))
    }
    ,
    n.prototype.deselectAll = function() {
        for (var e = this.getItems(), t = 0; t < e.length; t += 1) {
            var i = e[t];
            i.isSelected && this.deselectItem(i.getWuiName(), {
                noSound: !0
            })
        }
    }
    ,
    n.prototype.getItemCount = function() {
        return this.content.getChildCount()
    }
    ,
    n.prototype.getItem = function(e) {
        return this.content.getChild(e)
    }
    ,
    n.prototype.getItems = function() {
        return this.content.getChildren()
    }
    ,
    n.prototype.getContentElement = function() {
        return this.content
    }
    ,
    n.prototype.clearContent = function() {
        this.content.clearContent()
    }
    ,
    n.prototype.setPlaceholderText = function(e) {
        this.placeholder || (this.placeholder = new s(this)),
        this.placeholder.setText(e)
    }
    ,
    n.prototype._tapHandler = function() {
        var e = this.myList
          , t = this.getWuiName();
        return this.isSelected ? void (e.options.disableSelectionToggle || e.deselectItem(t)) : e.selectItem(t)
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.parent = e,
        this.options = t || {},
        this.frame = null ,
        this.text = null
    }
    i(319);
    var o = i(302);
    e.exports = n,
    n.prototype.setText = function(e) {
        if (!e)
            return this.frame && this.frame.hide();
        var t = this.parent;
        this.frame || (this.frame = t.createChild("div", {
            className: "placeholderFrame"
        }),
        this.options.headerElement && this.frame.addClassNames("withHeader"),
        this.text = this.frame.createChild("div", {
            className: "placeholderText"
        })),
        t instanceof o && (t = t.getParent());
        var i = t.rootElement.offsetHeight;
        this.options.headerElement && (i -= this.options.headerElement.rootElement.offsetHeight),
        this.frame.setStyle("minHeight", i + "px"),
        this.text.setText(e),
        this.frame.show()
    }
    ,
    n.prototype.toggleDisplay = function(e) {
        this.frame && this.frame.toggleDisplay(!!e)
    }
    ,
    n.prototype.refresh = function() {
        this.frame && this.frame.isVisible() && this.setText(this.text.getText())
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, e, t),
        this.addClassNames("SingleSelectionList"),
        this.currentSelected = null
    }
    var o = i(26).inherits
      , s = i(317);
    o(n, s),
    e.exports = n,
    n.prototype.removeItem = function(e) {
        var t = this.getItem(e);
        t && (this.currentSelected = null ),
        s.prototype.removeItem.call(this, e)
    }
    ,
    n.prototype.selectItem = function(e, t) {
        this.currentSelected && this.deselectItem(this.currentSelected.getWuiName(), {
            noSound: !0
        }),
        s.prototype.selectItem.call(this, e, t);
        var i = this.getItem(e);
        i && (this.currentSelected = i)
    }
    ,
    n.prototype.deselectItem = function(e, t) {
        var i = this.getItem(e);
        i && i.isSelected && (s.prototype.deselectItem.call(this, e, t),
        this.currentSelected = null )
    }
    ,
    n.prototype.deselectAll = function() {
        this.currentSelected && this.deselectItem(this.currentSelected.getWuiName(), {
            noSound: !0
        })
    }
    ,
    n.prototype._tapHandler = function() {
        var e = this.myList;
        e.currentSelected && e.currentSelected !== this && e.deselectItem(e.currentSelected.getWuiName(), {
            noSound: !0
        }),
        s.prototype._tapHandler.call(this)
    }
}
, function(e, t, i) {
    function n(e, t) {
        o.call(this, {
            className: "filterTagButton"
        }, t),
        this._labelElement = this.createChild("div", {
            className: "btnText",
            label: e
        }),
        this.createChild("div", {
            className: "cross",
            text: "x"
        })
    }
    i(322);
    var o = i(204)
      , s = i(26).inherits;
    s(n, o),
    e.exports = n,
    n.prototype.setLabel = function(e) {
        this._labelElement.setText(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        this.price = e,
        this.timestamp = t
    }
    function o(e) {
        var t = I[e];
        return t ? t.price : -1
    }
    function s(e) {
        var t = I[e];
        return !!t && Date.now() - t.timestamp < 6e4 * T
    }
    function a(e, t) {
        I[e] = new n(t,Date.now()),
        y[e] && (y[e].averagePrice = t)
    }
    function r(e) {
        a(e.genericId, e.averagePrice),
        e.genericId === S && A(e.averagePrice)
    }
    function l(e, t) {
        function i() {
            for (var t = [], i = 0, n = e.length; i < n; i++) {
                var o = y[e[i]];
                o && t.push(o)
            }
            return t
        }
        function n(e) {
            f.getDataMap("Items", l, function(t, i) {
                if (t)
                    return e(t);
                for (var n = 0, s = l.length; n < s; n++) {
                    var a = l[n]
                      , r = i[a];
                    if (r) {
                        var u = new p(r);
                        u.type = w[u.typeId],
                        u.averagePrice = o(u.id),
                        h.push(u),
                        c.push("gfx/items/" + r.iconId + ".png")
                    } else {
                        var d = b[a];
                        delete b[a],
                        d.emit("loaded")
                    }
                }
                return e()
            })
        }
        function s(e) {
            g.preloadImages(c, function(t) {
                for (var i = 0, n = t.length; i < n; i++) {
                    var o = h[i];
                    y[o.id] = o,
                    o.image = t[i];
                    var s = b[o.id];
                    delete b[o.id],
                    s.loaded = !0,
                    s.emit("loaded")
                }
                return e()
            })
        }
        function a(e) {
            return d.length ? void u.each(d, function(e, t) {
                e.loaded ? t() : e.once("loaded", t)
            }, e) : e()
        }
        function r(e) {
            return l.length ? void u.series([n, s], function(t) {
                return t ? e(t) : void p.initializeList(h, e)
            }) : e()
        }
        for (var l = [], c = [], h = [], d = [], m = 0, v = e.length; m < v; m++) {
            var C = e[m];
            if (!y[C])
                if (b[C])
                    d.push(b[C]);
                else {
                    l.push(C);
                    var I = b[C] = new _;
                    I.loaded = !1
                }
        }
        return d.length || l.length ? void u.parallel([r, a], function(e) {
            return e ? t(e) : t(null , i())
        }) : t(null , i())
    }
    function c(e, t) {
        Array.isArray(e) || (e = [e]);
        var i, n, o = {}, s = [];
        for (i = 0,
        n = e.length; i < n; i += 1) {
            var a = e[i];
            o[a.objectGID] = !0,
            s.push(new m(a))
        }
        return l(Object.keys(o), function(e) {
            if (e)
                return console.warn(e),
                t(e);
            var o = {};
            for (i = 0,
            n = s.length; i < n; i += 1) {
                var a = s[i];
                a.setItem(y[a.objectGID] || y[C]),
                o[a.objectUID] = a
            }
            m.initializeList(s, function(e) {
                t(e, {
                    map: o,
                    array: s
                })
            })
        }),
        s
    }
    var u = i(12)
      , h = i(324)
      , d = i(325)
      , p = i(326)
      , m = i(386)
      , f = i(36)
      , g = i(5)
      , _ = i(16).EventEmitter
      , v = i(85);
    t.Item = p,
    t.ItemInstance = m;
    var y = t.items = {}
      , w = null
      , b = {}
      , C = 666
      , I = {}
      , T = 60
      , S = -1
      , A = null ;
    t.getAveragePrice = o,
    t.getFreshAveragePrice = function(e, t) {
        var i = o(e);
        return s(e) ? t(i) : (S = e,
        A = t,
        window.dofus.sendMessage("ExchangeBidHousePriceMessage", {
            genId: e
        }),
        void (I[e] = new n(i,Date.now())))
    }
    ,
    t.getItems = l,
    t.initialize = function(e) {
        var t = window.dofus.connectionManager;
        w = window.gui.databases.ItemTypes;
        for (var i in w) {
            var n = w[i];
            n.category = d.getCategory(n.superTypeId),
            n.possiblePositions = d.getTypePositions(n.superTypeId)
        }
        l([C], e);
        var o = function() {
            window.gui.gameContext === v.ROLE_PLAY && (window.gui.removeListener("GameContextCreateMessage", o),
            window.dofus.sendMessage("ObjectAveragePricesGetMessage"))
        };
        window.gui.on("GameContextCreateMessage", o),
        window.gui.on("ObjectAveragePricesMessage", function(e) {
            for (var t = 0, i = e.ids.length; t < i; t += 1)
                a(e.ids[t], e.avgPrices[t])
        }),
        t.on("ExchangeBidPriceMessage", r)
    }
    ,
    t.getItemTypeMap = function() {
        return w ? w : void console.error(new Error("Fatal error: item types not loaded"))
    }
    ,
    t.createItemInstances = c,
    t.getCategoryName = d.getCategoryName,
    t.isEquippable = d.isEquippable,
    t.isEquipped = d.isEquipped,
    t.unlinkedItemsFilter = d.unlinkedItemsFilter,
    t.positions = h.positions,
    t.categories = h.categories
}
, function(e, t) {
    var i = {
        amulet: 0,
        weapon: 1,
        ringLeft: 2,
        belt: 3,
        ringRight: 4,
        boots: 5,
        hat: 6,
        cape: 7,
        pets: 8,
        dofus1: 9,
        dofus2: 10,
        dofus3: 11,
        dofus4: 12,
        dofus5: 13,
        dofus6: 14,
        shield: 15,
        mount: 16,
        mutation: 20,
        boostFood: 21,
        firstBonus: 22,
        secondBonus: 23,
        firstMalus: 24,
        secondMalus: 25,
        roleplayBuffer: 26,
        follower: 27,
        companion: 28,
        notEquipped: 63
    };
    e.exports.positions = i;
    var n = [9, 14, 15, 16, 17, 18, 6, 19, 21, 20, 8, 22];
    e.exports.superTypeNotEquippable = n;
    var o = [!1, !0, !0, !0, !0, !0, !1, !0, !0, !1, !0, !0, !0, !0, !1, !1, !1, !1, !1, !1, !1, !1, !0, !0];
    e.exports.filterEquipment = o;
    var s = [!1, !1, !1, !1, !1, !1, !0, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1];
    e.exports.filterConsumables = s;
    var a = [!1, !1, !1, !1, !1, !1, !1, !1, !1, !0, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1];
    e.exports.filterRessources = a;
    var r = [!1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !0, !1, !1, !1, !1, !1, !1, !1, !1, !1];
    e.exports.filterQuest = r;
    var l = {
        inventoryFull: 1,
        cannotEquipTwice: 2,
        notTradable: 3,
        cannotDrop: 4,
        cannotDropNoPlace: 5,
        cannotDestroy: 6,
        levelTooLow: 7,
        livingObjectRefusedFood: 8,
        cannotUnequip: 9,
        cannotEquipHere: 10,
        criterions: 11,
        mimicryObjectError: 12
    };
    e.exports.objectErrors = l;
    var c = {
        equipment: 0,
        consumables: 1,
        resources: 2,
        quest: 3,
        preset: 4
    };
    e.exports.categories = c;
    var u = [[], [i.amulet], [i.weapon], [i.ringLeft, i.ringRight], [i.belt], [i.boots], [], [i.shield], [i.weapon], [], [i.hat], [i.cape], [i.pets], [i.dofus1, i.dofus2, i.dofus3, i.dofus4, i.dofus5, i.dofus6], [], [i.mutation], [i.boostFood], [i.firstBonus, i.secondBonus], [i.firstMalus, i.secondMalus], [i.roleplayBuffer], [i.follower], [i.mount], [], [i.companion]];
    e.exports.itemTypePositions = u
}
, function(e, t, i) {
    function n(e) {
        return c.itemTypePositions[e] || []
    }
    function o(e) {
        var t = c.categories;
        switch (e) {
        case t.equipment:
            return "equipment";
        case t.consumables:
            return "consumables";
        case t.resources:
            return "resources";
        case t.quest:
            return "quest";
        case t.preset:
            return "preset";
        default:
            return null
        }
    }
    function s(e) {
        var t = c.categories;
        return c.filterEquipment[e] ? t.equipment : c.filterConsumables[e] ? t.consumables : c.filterRessources[e] ? t.resources : c.filterQuest[e] ? t.quest : t.preset
    }
    function a(e) {
        return c.superTypeNotEquippable.indexOf(e) === -1
    }
    function r(e) {
        return e !== c.positions.notEquipped
    }
    function l(e) {
        return !e.isLinkedCharacter()
    }
    var c = i(324);
    e.exports.getTypePositions = n,
    e.exports.getCategoryName = o,
    e.exports.getCategory = s,
    e.exports.isEquippable = a,
    e.exports.isEquipped = r,
    e.exports.unlinkedItemsFilter = l
}
, function(e, t, i) {
    function n(e) {
        for (var t in e)
            e[t] !== h[t] && null !== e[t] && (this[t] = e[t]);
        this.isWeapon = "Weapon" === e._type,
        this.averagePrice = -1,
        this.etheral && (this.descriptionId = l("ui.common.etherealWeaponDescription"))
    }
    function o(e, t) {
        var i = [];
        if (!e || !e.criterions.length)
            return i;
        t = t || "";
        for (var n = e.criterions, o = 0; o < n.length; o++) {
            var s, r = n[o];
            if (r.criterions) {
                s = [];
                for (var l = r.criterions, c = l.length, u = 0; u < c; u++) {
                    var h = l[u]
                      , d = t + (0 === u ? "(" : r.getOperatorText() + " ") + h.getText() + (u === c - 1 ? ")" : "");
                    s.push(d)
                }
            } else
                s = t + (0 !== o && r.operator === a.groupOperators.or ? r.getOperatorText() + " " : "") + r.getText();
            i.push({
                text: s,
                isMalus: !r.isRespected()
            })
        }
        return i
    }
    var s = i(12)
      , a = i(327)
      , r = i(224)
      , l = i(35).getText
      , c = i(210)
      , u = i(36)
      , h = {
        id: null ,
        nameId: null ,
        typeId: null ,
        descriptionId: null ,
        iconId: null ,
        level: null ,
        realWeight: null ,
        cursed: !1,
        useAnimationId: -1,
        usable: !1,
        targetable: !1,
        exchangeable: !1,
        price: null ,
        twoHanded: !1,
        etheral: !1,
        itemSetId: -1,
        criteria: "null",
        criteriaTarget: "null",
        enhanceable: !1,
        nonUsableOnAnother: !1,
        appearanceId: null ,
        secretRecipe: !1,
        recipeSlots: null ,
        recipeIds: null ,
        dropMonsterIds: null ,
        bonusIsSecret: !1,
        hideEffects: !1,
        possibleEffects: null ,
        favoriteSubAreas: null ,
        favoriteSubAreasBonus: null
    };
    e.exports = n,
    n.initializeList = function(e, t) {
        s.parallel([function(t) {
            s.each(e, function(e, t) {
                return e.criteria ? (e.conditions = a.createGroupCriterion(e.criteria, e),
                void e.conditions.initialize(t)) : t()
            }, t)
        }
        , function(t) {
            s.each(e, function(e, t) {
                return e.criteriaTarget ? (e.targetConditions = a.createGroupCriterion(e.criteriaTarget, e),
                void e.targetConditions.initialize(t)) : t()
            }, t)
        }
        , function(t) {
            for (var i = [], n = 0; n < e.length; n++)
                e[n].possibleEffects && (i = i.concat(e[n].possibleEffects));
            r.createEffectInstances(i, function(i, n) {
                if (i)
                    return t(i);
                for (var o = 0; o < e.length; o++) {
                    var s = e[o];
                    if (s.possibleEffects) {
                        var a = s.possibleEffects.length
                          , r = a > 0 ? n.splice(0, a) : [];
                        r = r.filter(function(e) {
                            return e && e.effect
                        }),
                        s.possibleEffectsMap = {},
                        s.possibleEffects = r;
                        for (var l = 0; l < r.length; l++)
                            s.possibleEffectsMap[r[l].effectId] = r[l]
                    }
                }
                t()
            })
        }
        , function(t) {
            s.each(e, function(e, t) {
                return 12 !== e.type.superTypeId ? t() : (e.isPet = !0,
                e.foodItems = [],
                e.foodTypes = [],
                void u.getData("Pets", e.id, function(i, n) {
                    return i || !n ? t() : (e.foodItems = n.foodItems,
                    e.foodTypes = n.foodTypes,
                    t())
                }))
            }, t)
        }
        , function(t) {
            for (var i = [], n = [], o = 0; o < e.length; o++) {
                var s = e[o]
                  , a = s.itemSetId;
                a && (i.push(a),
                n.push(s))
            }
            return i.length ? void u.getDataMap("ItemSets", i, function(e, i) {
                if (e)
                    return t(e);
                for (var o = 0; o < n.length; o++) {
                    var s = n[o]
                      , a = i[s.itemSetId];
                    a ? s.itemSetName = a.nameId : (console.error(new Error("ItemSet id " + s.itemSetId + " for item id " + s.id + " does not exist.")),
                    s.itemSetName = null )
                }
                return t()
            }) : t()
        }
        ], t)
    }
    ,
    n.prototype.initialize = function(e) {
        n.initializeList([this], e)
    }
    ,
    n.prototype.getRawName = function() {
        return this.nameId
    }
    ,
    n.prototype.getName = function() {
        var e = window.gui.playerData.isModeratorOrMore()
          , t = this.getRawName();
        return e && (t += " (" + this.id + ")"),
        t
    }
    ,
    n.prototype.getNameForSearch = function() {
        return this._simplifiedName ? this._simplifiedName : (this._simplifiedName = c.simplifyString(this.nameId),
        this._simplifiedName)
    }
    ,
    n.prototype._getStatsFormatted = function() {
        var e = [];
        if (!this.isWeapon)
            return console.error(new Error("getProperty('statsFormatted') should never be called on non-weapon Item")),
            e;
        var t = l("ui.stats.shortAP") + l("ui.common.colon") + this.apCost;
        this.maxCastPerTurn && (t += " (" + l("ui.item.usePerTurn", this.maxCastPerTurn) + ")"),
        e.push(t);
        var i = l("ui.common.range") + l("ui.common.colon");
        if (i += this.range === this.minRange ? this.range : this.minRange + " - " + this.range,
        e.push(i),
        this.criticalFailureProbability || this.criticalHitProbability) {
            var n = "";
            if (this.criticalHitProbability) {
                0 !== this.criticalHitBonus && e.push(l("ui.item.critical.bonus", this.criticalHitBonus)),
                n += l("ui.common.short.CriticalHit") + l("ui.common.colon") + "1/" + this.criticalHitProbability;
                var o = window.gui.playerData.characters.mainCharacter.characteristics;
                if (o) {
                    var s = o.criticalHit
                      , a = o.agility
                      , r = s.alignGiftBonus + s.base + s.contextModif + s.objectsAndMountBonus
                      , c = a.alignGiftBonus + a.base + a.contextModif + a.objectsAndMountBonus;
                    c < 0 && (c = 0);
                    var u = this.criticalHitProbability - r
                      , h = parseInt(u * Math.E * 1.1 / Math.log(c + 12), 10)
                      , d = Math.min(u, h);
                    d < 2 && (d = 2),
                    e.push(l("ui.itemtooltip.itemCriticalReal", "1/" + d))
                }
            }
            this.criticalFailureProbability && (n += (this.criticalHitProbability ? " - " : "") + l("ui.common.short.CriticalFailure") + l("ui.common.colon") + "1/" + this.criticalFailureProbability),
            e.push(n)
        }
        return this.castInLine && this.range > 1 && e.push(l("ui.spellInfo.castInLine")),
        !this.castTestLos && this.range > 1 && e.push(l("ui.spellInfo.castWithoutLos")),
        e
    }
    ,
    n.prototype._getConditionsFormatted = function() {
        return o(this.conditions)
    }
    ,
    n.prototype._getTargetConditionsFormatted = function() {
        var e = "(" + l("ui.item.target") + ") ";
        return o(this.targetConditions, e)
    }
    ,
    n.prototype.getItem = function() {
        return this
    }
    ,
    n.prototype.getItemInstance = function() {
        return null
    }
    ,
    n.prototype.getProperty = function(e) {
        return "nameId" === e ? this.getName() : "conditionsFormatted" === e ? this._getConditionsFormatted() : "targetConditionsFormatted" === e ? this._getTargetConditionsFormatted() : "statsFormatted" === e ? this._getStatsFormatted() : ("weight" === e && (e = "realWeight"),
        this.hasOwnProperty(e) ? this[e] : h[e])
    }
}
, function(e, t, i) {
    function n(e, t) {
        var i = e.substring(0, 2);
        return Q[i] ? new Q[i](e,t) : void console.warn("unknown criterion: " + i)
    }
    function o(e, t) {
        return e = e.replace(/[\s+]/g, ""),
        new s(e,this,t)
    }
    var s = i(328)
      , a = i(329)
      , r = i(331)
      , l = i(332)
      , c = i(333)
      , u = i(334)
      , h = i(347)
      , d = i(348)
      , p = i(350)
      , m = i(351)
      , f = i(352)
      , g = i(353)
      , _ = i(354)
      , v = i(355)
      , y = i(356)
      , w = i(357)
      , b = i(358)
      , C = i(359)
      , I = i(360)
      , T = i(361)
      , S = i(362)
      , A = i(363)
      , E = i(364)
      , x = i(365)
      , M = i(366)
      , N = i(367)
      , R = i(368)
      , O = i(369)
      , P = i(370)
      , D = i(371)
      , L = i(372)
      , B = i(373)
      , k = i(374)
      , F = i(375)
      , H = i(376)
      , G = i(377)
      , U = i(378)
      , j = i(379)
      , q = i(380)
      , W = i(381)
      , V = i(382)
      , z = i(383)
      , Y = i(384)
      , X = i(385)
      , Q = {
        Ca: P,
        CA: P,
        Cc: P,
        CC: P,
        Ce: P,
        CE: P,
        CD: P,
        CH: P,
        Ci: P,
        CI: P,
        CL: P,
        CM: P,
        CP: P,
        Cs: P,
        CS: P,
        Cv: P,
        CV: P,
        Cw: P,
        CW: P,
        Ct: P,
        CT: P,
        OA: r,
        PX: a,
        Ps: l,
        Pa: c,
        Oz: u,
        Ow: h,
        Ox: d,
        Po: p,
        PU: m,
        PG: f,
        Sy: g,
        Sd: _,
        PE: v,
        Pb: y,
        Pg: w,
        Pw: b,
        Py: C,
        Px: I,
        PJ: T,
        Pj: T,
        PK: S,
        PL: A,
        MK: E,
        PR: x,
        PQ: M,
        SG: N,
        PN: R,
        PO: O,
        Pp: D,
        PP: D,
        Qa: L,
        Qc: L,
        Qf: L,
        Pq: B,
        Pz: k,
        Pf: F,
        SI: H,
        PS: G,
        PA: U,
        Pr: j,
        PB: V,
        PT: q,
        Sc: W,
        PZ: z,
        BI: Y,
        PW: X
    };
    e.exports.createCriterion = n,
    e.exports.createGroupCriterion = o,
    e.exports.groupOperators = s.operators
}
, function(e, t, i) {
    function n() {
        c.or = {
            token: "|",
            isRespectedFn: function(e) {
                for (var t = 0, i = e.length; t < i; t += 1)
                    if (e[t].isRespected())
                        return !0;
                return !1
            },
            text: l("ui.common.or")
        },
        c.and = {
            token: "&",
            isRespectedFn: function(e) {
                for (var t = 0, i = e.length; t < i; t += 1)
                    if (!e[t].isRespected())
                        return !1;
                return !0
            },
            text: l("ui.common.and")
        }
    }
    function o(e, t, i) {
        c.or || n(),
        this.criterions = [];
        for (var o = "", s = !1, r = -1, l = !1, u = 0, h = e.length; u < h; u += 1) {
            var d = e[u];
            u === h - 1 ? (o += d,
            a(this.criterions, l, o, t, i)) : s ? ")" === d ? 0 === r ? s = !1 : (r -= 1,
            o += d) : o += d : "(" === d ? (r += 1,
            s = !0,
            l = !0) : "&" === d || "|" === d ? (a(this.criterions, l, o, t, i),
            r = -1,
            l = !1,
            this.operator = "&" === d ? c.and : c.or,
            o = "") : o += d
        }
    }
    function s(e, t) {
        e.initialize(t)
    }
    var a, r = i(12), l = i(35).getText, c = {};
    a = function(e, t, i, n, s) {
        if (t)
            e.push(new o(i,n,s));
        else {
            var a = n.createCriterion(i, s);
            a && e.push(a)
        }
    }
    ,
    o.prototype.initialize = function(e) {
        r.each(this.criterions, s, e)
    }
    ,
    o.prototype.isRespected = function() {
        return !this.criterions.length || (1 === this.criterions.length ? this.criterions[0].isRespected() : this.operator.isRespectedFn(this.criterions))
    }
    ,
    o.prototype.getOperatorText = function() {
        return this.operator ? this.operator.text : ""
    }
    ,
    o.prototype.getText = function() {
        for (var e = [], t = 0, i = this.criterions.length; t < i; t += 1) {
            var n = this.criterions[t];
            n.criterions ? e.push("(" + n.getText() + ")") : e.push(n.getText())
        }
        return e.join(" " + this.operator.text + " ")
    }
    ,
    e.exports = o,
    e.exports.operators = c
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        window.gui.playerData.identification.hasRights ? this._text = s("ui.social.guildHouseRights") + " " + this.getOperatorText() + " " + this.getValueText() : this._text = ""
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    e.exports = n
}
, function(e, t) {
    function i(e) {
        for (var t in n) {
            var i = n[t].token;
            if (e.indexOf(i) !== -1) {
                this.operator = n[t];
                var o = e.split(i);
                return this.key = o[0],
                this.rawValue = o[1],
                void (this.value = parseInt(this.rawValue, 10))
            }
        }
        this.key = e.substring(0, 2);
        var s = e.substring(2, 3);
        this.operator = {
            token: s,
            text: s,
            compareFn: function() {
                return !0
            }
        },
        this.rawValue = e.substring(3),
        this.value = parseInt(this.rawValue, 10)
    }
    var n = {
        superior: {
            token: ">",
            compareFn: function(e, t) {
                return e > t
            },
            text: " > "
        },
        inferior: {
            token: "<",
            compareFn: function(e, t) {
                return e < t
            },
            text: " < "
        },
        equal: {
            token: "=",
            compareFn: function(e, t) {
                return e === t
            },
            text: ": "
        },
        different: {
            token: "!",
            compareFn: function(e, t) {
                return e !== t
            },
            text: "! "
        }
    };
    i.prototype.initialize = function(e) {
        e()
    }
    ,
    i.prototype.getOperatorText = function() {
        return this.operator ? this.operator.text : ""
    }
    ,
    i.prototype.getKeyText = function() {
        return this.key
    }
    ,
    i.prototype.getValueText = function() {
        return this.value
    }
    ,
    i.prototype.isRespected = function() {
        if (!this.operator)
            return !0;
        var e = this.operator.compareFn;
        return !!e && e(this.getCriterion(), this.value)
    }
    ,
    i.prototype.getText = function() {
        return this.getKeyText() + " " + this.getOperatorText() + " " + this.getValueText()
    }
    ,
    i.prototype.getCriterion = function() {
        return 0
    }
    ,
    e.exports = i,
    e.exports.operators = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(36)
      , r = i(26).inherits;
    r(n, o),
    n.prototype.initialize = function(e) {
        var t = this;
        a.getData("Achievements", this.value, function(i, n) {
            return i ? e(i) : (t._valueText = " '" + n.nameId + "'",
            t._keyText = s("ui.tooltip.unlockAchievement", [t._valueText]),
            void e())
        })
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.achievements.finishedAchievementsIds;
        return e.indexOf(this.value) !== -1
    }
    ,
    n.prototype.getKeyText = function() {
        return this._keyText
    }
    ,
    n.prototype.getOperatorText = function() {
        return this.operator === o.operators.different ? s("ui.tooltip.dontUnlockAchievement", [this._valueText]) : o.prototype.getOperatorText.call(this)
    }
    ,
    n.prototype.getValueText = function() {
        return this._valueText
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.alignment")
    }
    ,
    n.prototype.getOperatorText = function() {
        return this.operator === o.operators.different ? " " + s("ui.common.differentFrom") + s("ui.common.colon") : o.prototype.getOperatorText.call(this)
    }
    ,
    n.prototype.getValueText = function() {
        return window.gui.databases.AlignmentSides[this.value].nameId
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characters.mainCharacter.characteristics.alignmentInfos.alignmentSide
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        this._text = s("ui.tooltip.AlignmentLevel") + " " + this.getOperatorText() + " " + this.value
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    n.prototype.getCriterion = function() {
        var e = window.gui.playerData;
        return e.characters.mainCharacter.characteristics.alignmentInfos.characterPower - e.id
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        a.call(this, e),
        this.operator === a.operators.equal ? this._text = r("ui.criterion.allianceAvA") : this._text = ""
    }
    var o = i(335)
      , s = i(336)
      , a = i(330)
      , r = i(35).getText
      , l = i(346)
      , c = i(26).inherits;
    c(n, a),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    n.prototype.isRespected = function() {
        if (this.operator !== a.operators.equal)
            return !1;
        var e = window.gui.playerData
          , t = e.characters.mainCharacter.characteristics.alignmentInfos.aggressable;
        if (t !== o.AvA_ENABLED_AGGRESSABLE && t !== o.AvA_PREQUALIFIED_AGGRESSABLE)
            return !1;
        var i = s.entities.prism[e.position.subAreaId];
        return !(!i || i.mapId === -1) && i.state === l.PRISM_STATE_VULNERABLE
    }
    ,
    e.exports = n
}
, function(e, t) {
    e.exports = {
        NON_AGGRESSABLE: 0,
        PvP_ENABLED_AGGRESSABLE: 10,
        PvP_ENABLED_NON_AGGRESSABLE: 11,
        AvA_ENABLED_AGGRESSABLE: 20,
        AvA_ENABLED_NON_AGGRESSABLE: 21,
        AvA_DISQUALIFIED: 22,
        AvA_PREQUALIFIED_AGGRESSABLE: 23
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        i = i || {};
        var n = s[e][t] || {}
          , a = o[e][t] = {
            id: t,
            type: e,
            fighters: {},
            state: n.fightState,
            waitingForHelpInfo: n.waitingForHelpInfo
        };
        return a.fighters[f.allies] = i.allyCharactersInformations || [],
        a.fighters[f.enemies] = i.enemyCharactersInformations || [],
        d.emit("fightStarted", e, a),
        i.state === m.fighting && d.emit("fighting", e, a),
        a
    }
    var o, s, a = i(16).EventEmitter, r = i(35).getText, l = i(337), c = l.TaxCollector, u = i(345), h = u.Prism, d = e.exports = new a, p = i(338), m = d.fightState = p.fightState, f = d.fightingSide = p.fightingSide, g = d.entityType = p.entityType;
    d._reset = function() {
        o = d.fights = {},
        o[g.taxCollector] = {},
        o[g.prism] = {},
        s = d.entities = {},
        s[g.taxCollector] = {},
        s[g.prism] = {}
    }
    ,
    d.isPlayerDefending = function(e, t) {
        if (!g[e])
            return console.log("unknown entity type", e);
        var i = d.fights[e];
        for (var n in i) {
            var o = i[n];
            if (o.state === m.waitingForHelp && d.isPlayerFightingFor(t, e, n, f.allies))
                return parseInt(n, 10)
        }
        return null
    }
    ,
    d.getAttackedEntity = function(e) {
        return e.type && e.hasOwnProperty("id") && g[e.type] ? d.entities[e.type][e.id] : console.log("wrong fight object")
    }
    ,
    d.isPlayerFightingFor = function(e, t, i, n) {
        if (!g[t])
            return console.log("unknown entity type", t);
        var s = o[t][i];
        if (!s)
            return !1;
        for (var a = s.fighters[n], r = 0, l = a.length; r < l; r += 1)
            if (a[r].id === e)
                return !0;
        return !1
    }
    ;
    var _ = null ;
    d.playerAutoKick = function(e, t) {
        if (!g[e])
            return console.log("unknown entity type", e);
        var i = window.gui.playerData.id;
        e === g.taxCollector ? window.dofus.sendMessage("GuildFightLeaveRequestMessage", {
            taxCollectorId: t,
            characterId: i
        }) : window.dofus.sendMessage("PrismFightJoinLeaveRequestMessage", {
            subAreaId: t,
            join: !1
        }),
        _ = {
            type: e,
            fightId: t,
            playerId: i
        }
    }
    ,
    d.initialize = function(e) {
        function t(e, t) {
            o[e][t] && (delete o[e][t],
            d.emit("fightEnded", e, t))
        }
        function i(e, t, i, n) {
            var s = o[e][t];
            if (s) {
                var a = s.fighters[i];
                a.push(n),
                d.emit("fighterJoined", e, t, i, n, a.length - 1)
            }
        }
        function a(e, t, i, s) {
            var a = o[e][t];
            a || (a = n(e, t)),
            a.fighters[i] = s,
            d.emit("fighterList", e, t, i, s)
        }
        function u(e, t, i, n) {
            var s = o[e][t];
            if (s) {
                for (var a = s.fighters[i], r = 0, l = a.length; r < l; r += 1) {
                    var c = a[r].id;
                    if (c === n)
                        return a.splice(r, 1),
                        void d.emit("fighterLeft", e, t, i, n, r)
                }
                return console.error("unknown fighter id", n)
            }
        }
        d._reset(),
        e.on("disconnect", function() {
            d._reset()
        }),
        l.setupEvents(),
        e.on("TaxCollectorListMessage", function(e) {
            var t, i = e.informations, o = s.taxCollector;
            for (t = 0; t < i.length; t += 1) {
                var a = new c(i[t]);
                o[a.id] = a
            }
            d.emit("entityList", g.taxCollector, i, e.nbcollectorMax);
            var r = e.fightersInformations;
            for (t = 0; t < r.length; t += 1) {
                var l = r[t];
                n(g.taxCollector, l.collectorId, l)
            }
        }),
        e.on("TaxCollectorMovementAddMessage", function(e) {
            var i = new c(e.informations)
              , a = s.taxCollector
              , r = !a.hasOwnProperty(i.id);
            if (a[i.id] = i,
            r)
                return void d.emit("entityAdded", g.taxCollector, i);
            if (d.emit("entityUpdated", g.taxCollector, i),
            i.fightState === m.noFight)
                t(g.taxCollector, i.id);
            else {
                var l = o[g.taxCollector][i.id];
                if (!l)
                    return n(g.taxCollector, i.id);
                l.state = i.fightState,
                l.waitingForHelpInfo = i.waitingForHelpInfo,
                l.state === m.fighting && d.emit("fighting", g.taxCollector, l)
            }
        }),
        e.on("TaxCollectorMovementRemoveMessage", function(e) {
            var t = e.collectorId
              , i = s.taxCollector;
            i[t] && (delete i[t],
            d.emit("entityRemoved", g.taxCollector, t))
        }),
        e.on("PrismsListMessage", function(e) {
            for (var t = s.prism, i = e.prisms, n = 0, o = i.length; n < o; n += 1) {
                var a = new h(i[n]);
                t[a.id] = a
            }
            d.emit("entityList", g.prism, i)
        }),
        e.on("PrismsListUpdateMessage", function(e) {
            for (var t = s.prism, i = e.prisms, n = 0, o = i.length; n < o; n += 1) {
                var a = i[n]
                  , r = t[a.subAreaId];
                r ? (r.updateInfo(a),
                d.emit("entityUpdated", g.prism, r)) : (r = new h(a),
                t[r.id] = r,
                d.emit("entityAdded", g.prism, r))
            }
        }),
        e.on("PrismsInfoValidMessage", function(e) {
            for (var t = e.fights, i = s.prism, o = 0, a = t.length; o < a; o += 1) {
                var r = t[o]
                  , l = i[r.subAreaId];
                if (l) {
                    var c = r.allyCharactersInformations[0];
                    c && "3451" === c.name && (l.look = c.entityLook,
                    l.level = c.level,
                    r.allyCharactersInformations.splice(0, 1)),
                    l.fightState = m.waitingForHelp,
                    n(g.prism, r.subAreaId, r)
                } else
                    console.warning("unknown prism", r.subAreaId)
            }
        }),
        e.on("PrismFightAddedMessage", function(e) {
            var t = e.fight
              , i = s.prism[t.subAreaId];
            return i ? void n(g.prism, t.subAreaId, t) : console.warning("unknown prism", t.subAreaId)
        }),
        e.on("PrismFightRemovedMessage", function(e) {
            t(g.prism, e.subAreaId)
        }),
        e.on("GuildFightPlayersHelpersJoinMessage", function(e) {
            i(g.taxCollector, e.fightId, f.allies, e.playerInfo)
        }),
        e.on("PrismFightDefenderAddMessage", function(e) {
            var t = e.defender;
            if ("3451" === t.name) {
                var n = s.prism[e.subAreaId];
                n.look = t.entityLook,
                n.level = t.level,
                d.emit("fightTarget", g.prism, e.subAreaId, n)
            } else
                i(g.prism, e.subAreaId, f.allies, t)
        }),
        e.on("PrismFightAttackerAddMessage", function(e) {
            i(g.prism, e.subAreaId, f.enemies, e.attacker)
        }),
        e.on("GuildFightPlayersEnemiesListMessage", function(e) {
            a(g.taxCollector, e.fightId, f.enemies, e.playerInfo)
        }),
        e.on("GuildFightPlayersEnemyRemoveMessage", function(e) {
            u(g.taxCollector, e.fightId, f.enemies, e.playerId)
        }),
        e.on("GuildFightPlayersHelpersLeaveMessage", function(e) {
            _ && _.type === g.taxCollector && _.fightId === e.fightId && _.playerId === e.playerId && (window.gui.chat.logMsg(r("ui.social.guild.autoFightLeave")),
            _ = null ),
            u(g.taxCollector, e.fightId, f.allies, e.playerId)
        }),
        e.on("PrismFightDefenderLeaveMessage", function(e) {
            _ && _.type === g.prism && _.fightId === e.subAreaId && _.playerId === e.fighterToRemoveId && (window.gui.chat.logMsg(r("ui.prism.AutoDisjoin")),
            _ = null ),
            u(g.prism, e.subAreaId, f.allies, e.fighterToRemoveId)
        }),
        e.on("PrismFightAttackerRemoveMessage", function(e) {
            u(g.prism, e.subAreaId, f.enemies, e.fighterToRemoveId)
        })
    }
}
, function(e, t, i) {
    function n(e) {
        switch (e) {
        case u.WAITING_FOR_HELP:
            return r.waitingForHelp;
        case u.FIGHTING:
            return r.fighting;
        default:
            return r.noFight
        }
    }
    function o(e) {
        this.id = e.uniqueId,
        this.level = 0,
        this.updateInfo(e)
    }
    var s = i(338)
      , a = i(339)
      , r = s.fightState
      , l = i(35).getText
      , c = i(210)
      , u = {
        NORMAL: 0,
        WAITING_FOR_HELP: 1,
        FIGHTING: 2
    }
      , h = i(344)
      , d = i(235);
    t.TaxCollector = o,
    o.prototype.updateInfo = function(e) {
        for (var t in e)
            this[t] = e[t];
        this.fightState = n(e.state);
        var i = c.getObjectInArrayById(e.complements, "_type", "TaxCollectorWaitingForHelpInformations");
        i && (this.waitingForHelpInfo = i.waitingForHelpInfo);
        var o = c.getObjectInArrayById(e.complements, "_type", "TaxCollectorGuildInformations");
        o && (this.guildId = o.guild.guildId,
        this.level = a.guilds[this.guildId].guildLevel)
    }
    ,
    o.prototype.getGuild = function() {
        return a.guilds[this.guildId]
    }
    ,
    o.prototype.getName = function() {
        return this.enrichData.firstName + " " + this.enrichData.lastName
    }
    ,
    o.prototype.getPosition = function() {
        return this.worldX + "," + this.worldY
    }
    ,
    t.setupEvents = function() {
        var e = window.gui;
        e.on("TaxCollectorMovementMessage", function(e) {
            var t = e.basicInfos
              , i = t.enrichData || {}
              , n = i.firstName + " " + i.lastName
              , o = t.worldX + "," + t.worldY
              , s = "";
            s = e.hireOrFire ? l("ui.social.TaxCollectorAdded", n, o, e.playerName) : l("ui.social.TaxCollectorRemoved", n, o, e.playerName),
            window.gui.chat.logMsg(s, d.CHANNEL_GUILD)
        }),
        e.on("TaxCollectorAttackedMessage", function(e) {
            var t = e.enrichData
              , i = t.firstName + " " + t.lastName
              , n = e.worldX + "," + e.worldY;
            window.gui.chat.logMsg(l("ui.social.TaxCollectorAttacked", i, n), d.CHANNEL_GUILD)
        }),
        e.on("TaxCollectorErrorMessage", function(e) {
            var t;
            switch (e.reason) {
            case h.TAX_COLLECTOR_ALREADY_ONE:
                t = l("ui.social.alreadyTaxCollectorOnMap");
                break;
            case h.TAX_COLLECTOR_CANT_HIRE_HERE:
                t = l("ui.social.cantHireTaxCollecotrHere");
                break;
            case h.TAX_COLLECTOR_CANT_HIRE_YET:
                t = l("ui.social.cantHireTaxcollectorTooTired");
                break;
            case h.TAX_COLLECTOR_ERROR_UNKNOWN:
                t = l("ui.social.unknownErrorTaxCollector");
                break;
            case h.TAX_COLLECTOR_MAX_REACHED:
                t = l("ui.social.cantHireMaxTaxCollector");
                break;
            case h.TAX_COLLECTOR_NO_RIGHTS:
                t = l("ui.social.taxCollectorNoRights");
                break;
            case h.TAX_COLLECTOR_NOT_ENOUGH_KAMAS:
                t = l("ui.social.notEnougthRichToHireTaxCollector");
                break;
            case h.TAX_COLLECTOR_NOT_OWNED:
                t = l("ui.social.notYourTaxcollector")
            }
            if (t) {
                var i = window.gui.chat;
                i.logError(t)
            }
        }),
        e.on("TaxCollectorAttackedResultMessage", function(e) {
            var t, i = e.basicInfos, n = i.enrichData || {}, o = n.firstName + " " + n.lastName, s = i.worldX + "," + i.worldY;
            t = e.deadOrAlive ? l("ui.social.TaxCollectorDied", o, s) : l("ui.social.TaxCollectorSurvived", o, s),
            window.gui.chat.logMsg(t, d.CHANNEL_GUILD)
        }),
        e.on("ExchangeGuildTaxCollectorGetMessage", function(e) {
            for (var t = e.objectsInfos || [], i = "", n = 0; n < t.length; n += 1) {
                i && (i += ", ");
                var o = t[n]
                  , s = o.enrichData || {};
                i += o.quantity + "x" + s.itemName
            }
            var a = "";
            a = i ? l("ui.social.thingsTaxCollectorGet", i, e.experience) : l("ui.social.xpTaxCollectorGet", e.experience);
            var r = e.enrichData || {}
              , c = l("ui.social.taxcollectorRecolted", r.firstName + " " + r.lastName, "(" + e.worldX + ", " + e.worldY + ")", e.userName, a);
            window.gui.chat.logMsg(c, d.CHANNEL_GUILD)
        })
    }
}
, function(e, t) {
    t.fightState = {
        noFight: 0,
        waitingForHelp: 1,
        fighting: 2
    },
    t.fightingSide = {
        allies: "allies",
        enemies: "enemies"
    },
    t.entityType = {
        taxCollector: "taxCollector",
        prism: "prism"
    }
}
, function(e, t, i) {
    var n = i(35).getText
      , o = i(340)
      , s = i(342)
      , a = i(22);
    t.Emblem = i(341),
    t.GuildRightsBitEnum = i(343);
    var r = t.guilds = {};
    t.createGuild = function(e) {
        var t = new o(e);
        return r[t.guildId] = t,
        t
    }
    ,
    t.initialize = function(e) {
        function t(e) {
            a.getWindow("guildCard").display(e)
        }
        e.on("GuildCreationResultMessage", function(e) {
            switch (e.result) {
            case s.SOCIAL_GROUP_CREATE_ERROR_ALREADY_IN_GROUP:
                return window.gui.openSimplePopup(n("ui.guild.alreadyInGuild"));
            case s.SOCIAL_GROUP_CREATE_ERROR_EMBLEM_ALREADY_EXISTS:
                return window.gui.openSimplePopup(n("ui.guild.AlreadyUseEmblem"));
            case s.SOCIAL_GROUP_CREATE_ERROR_NAME_ALREADY_EXISTS:
                return window.gui.openSimplePopup(n("ui.guild.AlreadyUseName"));
            case s.SOCIAL_GROUP_CREATE_ERROR_NAME_INVALID:
                return window.gui.openSimplePopup(n("ui.guild.invalidName"));
            case s.SOCIAL_GROUP_CREATE_ERROR_REQUIREMENT_UNMET:
                return window.gui.openSimplePopup(n("ui.guild.requirementUnmet"));
            case s.SOCIAL_GROUP_CREATE_OK:
                return a.close("socialGroupCreation");
            case s.SOCIAL_GROUP_CREATE_ERROR_EMBLEM_INVALID:
            case s.SOCIAL_GROUP_CREATE_ERROR_UNKNOWN:
                return window.gui.openSimplePopup(n("ui.common.unknownFail"))
            }
        }),
        e.on("GuildInAllianceFactsMessage", t),
        e.on("GuildFactsMessage", t),
        window.dofus.connectionManager.on("GuildFactsErrorMessage", function() {
            e.chat.logMsg(n("ui.guild.doesntExistAnymore"))
        })
    }
    ,
    t.openGuildCard = function(e) {
        window.dofus.sendMessage("GuildFactsRequestMessage", {
            guildId: e
        })
    }
}
, function(e, t, i) {
    function n(e) {
        a.call(this),
        this.guildId = 0,
        this.guildName = "",
        this.guildEmblem = new s,
        this.guildLevel = 0,
        this.creationDate = 0,
        this.leaderId = 0,
        this.leaderName = "",
        this.nbMembers = 0,
        this.nbConnectedMembers = 0,
        this.nbTaxCollectors = 0,
        this.averageMemberLevel = 0,
        this.lastActivity = 0,
        this.enabled = !1,
        this.allianceId = 0,
        this.allianceName = "",
        this.allianceLeader = !1,
        this.experiencePercentage = 0,
        this.members = [],
        this.update(e)
    }
    function o(e, t, i) {
        i.hasOwnProperty(t) && void 0 !== i[t] && e.hasOwnProperty(t) && (e[t] = i[t])
    }
    var s = i(341)
      , a = i(16).EventEmitter
      , r = i(35).getText
      , l = i(26).inherits
      , c = i(210);
    l(n, a),
    n.prototype.update = function(e) {
        for (var t in e)
            o(this, t, e);
        "#NONAME#" === this.guildName && (this.guildName = r("ui.guild.noName")),
        "#NONAME#" === this.allianceName && (this.allianceName = r("ui.guild.noName"))
    }
    ,
    n.prototype.getHoursSinceLastConnection = function() {
        if (!this.lastActivity)
            return 0;
        var e = new Date;
        return Math.floor((e.time - 1e3 * this.lastActivity) / 36e5)
    }
    ,
    n.prototype.getMembersByRank = function() {
        var e = window.gui.databases.RankNames
          , t = this.members
          , i = [];
        for (var n in t) {
            var o = t[n];
            o.rankOrder = e[o.rank].order,
            i.push(o)
        }
        return c.sortObjectInArray(i, "rankOrder"),
        i
    }
    ,
    e.exports = n
}
, function(e, t) {
    function i(e) {
        e = e || {},
        this.symbolShape = e.symbolShape || 0,
        this.symbolColor = e.symbolColor || 0,
        this.backgroundShape = e.backgroundShape || 0,
        this.backgroundColor = e.backgroundColor || 0
    }
    e.exports = i
}
, function(e, t) {
    e.exports = {
        SOCIAL_GROUP_CREATE_OK: 1,
        SOCIAL_GROUP_CREATE_ERROR_NAME_INVALID: 2,
        SOCIAL_GROUP_CREATE_ERROR_ALREADY_IN_GROUP: 3,
        SOCIAL_GROUP_CREATE_ERROR_NAME_ALREADY_EXISTS: 4,
        SOCIAL_GROUP_CREATE_ERROR_EMBLEM_ALREADY_EXISTS: 5,
        SOCIAL_GROUP_CREATE_ERROR_LEAVE: 6,
        SOCIAL_GROUP_CREATE_ERROR_CANCEL: 7,
        SOCIAL_GROUP_CREATE_ERROR_REQUIREMENT_UNMET: 8,
        SOCIAL_GROUP_CREATE_ERROR_EMBLEM_INVALID: 9,
        SOCIAL_GROUP_CREATE_ERROR_TAG_INVALID: 10,
        SOCIAL_GROUP_CREATE_ERROR_TAG_ALREADY_EXISTS: 11,
        SOCIAL_GROUP_CREATE_ERROR_NEEDS_SUBGROUP: 12,
        SOCIAL_GROUP_CREATE_ERROR_UNKNOWN: 99
    }
}
, function(e, t) {
    e.exports = {
        GUILD_RIGHT_NONE: 0,
        GUILD_RIGHT_BOSS: 4,
        GUILD_RIGHT_MANAGE_GUILD_BOOSTS: 2,
        GUILD_RIGHT_MANAGE_RIGHTS: 1024,
        GUILD_RIGHT_INVITE_NEW_MEMBERS: 8,
        GUILD_RIGHT_BAN_MEMBERS: 16,
        GUILD_RIGHT_MANAGE_XP_CONTRIBUTION: 32,
        GUILD_RIGHT_MANAGE_RANKS: 64,
        GUILD_RIGHT_HIRE_TAX_COLLECTOR: 128,
        GUILD_RIGHT_MANAGE_MY_XP_CONTRIBUTION: 256,
        GUILD_RIGHT_COLLECT: 512,
        GUILD_RIGHT_USE_PADDOCKS: 4096,
        GUILD_RIGHT_ORGANIZE_PADDOCKS: 8192,
        GUILD_RIGHT_TAKE_OTHERS_MOUNTS_IN_PADDOCKS: 16384,
        GUILD_RIGHT_DEFENSE_PRIORITY: 32768,
        GUILD_RIGHT_COLLECT_MY_TAX_COLLECTOR: 65536,
        GUILD_RIGHT_SET_ALLIANCE_PRISM: 131072,
        GUILD_RIGHT_TALK_IN_ALLIANCE_CHAN: 262144
    }
}
, function(e, t) {
    e.exports = {
        TAX_COLLECTOR_ERROR_UNKNOWN: 0,
        TAX_COLLECTOR_NOT_FOUND: 1,
        TAX_COLLECTOR_NOT_OWNED: 2,
        TAX_COLLECTOR_NO_RIGHTS: 3,
        TAX_COLLECTOR_MAX_REACHED: 4,
        TAX_COLLECTOR_ALREADY_ONE: 5,
        TAX_COLLECTOR_CANT_HIRE_YET: 6,
        TAX_COLLECTOR_CANT_HIRE_HERE: 7,
        TAX_COLLECTOR_NOT_ENOUGH_KAMAS: 8
    }
}
, function(e, t, i) {
    function n(e) {
        switch (e) {
        case l.PRISM_STATE_ATTACKED:
            return a.waitingForHelp;
        case l.PRISM_STATE_FIGHTING:
            return a.fighting;
        default:
            return a.noFight
        }
    }
    function o(e) {
        for (var t in e)
            this[t] = e[t];
        this.id = e.subAreaId,
        this.fightState = e.prism ? n(e.prism.state) : a.noFight
    }
    var s = i(338)
      , a = s.fightState
      , r = i(35).getText
      , l = i(346)
      , c = i(235)
      , u = i(211);
    t.Prism = o,
    o.prototype.updateInfo = function(e) {
        for (var t in e)
            this[t] = e[t];
        if (!e.prism)
            return void delete this.prism;
        var i = n(e.prism.state);
        if (i === a.waitingForHelp && this.fightState !== a.waitingForHelp) {
            var o = e.enrichData.subAreaName + " (" + e.enrichData.areaName + ")";
            window.gui.chat.logMsg(r("ui.prism.attacked", o, this.getPosition()), c.CHANNEL_ALLIANCE)
        }
        var s = this.getAlliance();
        s.allianceEmblem.isAlliance = !0,
        this.fightState = i
    }
    ,
    o.prototype.getPlacementDate = function() {
        return new u.DofusDate(this.prism.placementDate).getServerDate().toString().date
    }
    ,
    o.prototype.getName = function() {
        var e = window.gui.playerData.alliance.current;
        return r("ui.zaap.prism") + " " + e.allianceName
    }
    ,
    o.prototype.getPosition = function() {
        return this.worldX + "," + this.worldY
    }
    ,
    o.prototype.getAlliance = function() {
        if (this.prism)
            return "AllianceInsiderPrismInformation" === this.prism._type ? window.gui.playerData.alliance.current : this.prism.alliance
    }
}
, function(e, t) {
    e.exports = {
        PRISM_STATE_INVULNERABLE: 0,
        PRISM_STATE_NORMAL: 1,
        PRISM_STATE_ATTACKED: 2,
        PRISM_STATE_FIGHTING: 3,
        PRISM_STATE_WEAKENED: 4,
        PRISM_STATE_VULNERABLE: 5,
        PRISM_STATE_DEFEATED: 6
    }
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        0 === this.value ? this._text = s("ui.criterion.noAlliance") : 1 === this.value ? this._text = s("ui.criterion.hasAlliance") : this._text = s("ui.criterion.hasValidAlliance")
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    n.prototype.getCriterion = function() {
        var e = window.gui.playerData.alliance;
        return e.hasAlliance() ? e.current.enabled ? 2 : 1 : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        switch (e) {
        case r.ALLIANCE_RIGHT_BOSS:
            return a("ui.guild.right.leader");
        case r.ALLIANCE_RIGHT_KICK_GUILDS:
            return a("ui.social.guildRightsBann");
        case r.ALLIANCE_RIGHT_MANAGE_PRISMS:
            return a("ui.social.guildRightsSetAlliancePrism");
        case r.ALLIANCE_RIGHT_MANAGE_RIGHTS:
            return a("ui.social.guildManageRights");
        case r.ALLIANCE_RIGHT_RECRUIT_GUILDS:
            return a("ui.social.guildRightsInvit");
        case r.ALLIANCE_RIGHT_TALK_IN_CHAN:
            return a("ui.social.guildRightsTalkInAllianceChannel");
        default:
            return ""
        }
    }
    function o(e) {
        s.call(this, e);
        var t = n(this.value);
        this.operator === s.operators.equal ? this._text = a("ui.criterion.allianceRights", [t]) : this._text = a("ui.criterion.notAllianceRights", [t])
    }
    var s = i(330)
      , a = i(35).getText
      , r = i(349)
      , l = i(26).inherits;
    r.ALLIANCE_RIGHT_MANAGE_PRISMS = 2,
    r.ALLIANCE_RIGHT_TALK_IN_CHAN = 4,
    r.ALLIANCE_RIGHT_RECRUIT_GUILDS = 8,
    r.ALLIANCE_RIGHT_KICK_GUILDS = 16,
    r.ALLIANCE_RIGHT_MANAGE_RIGHTS = 32,
    l(o, s),
    o.prototype.getText = function() {
        return this._text
    }
    ,
    o.prototype.isRespected = function() {
        var e = window.gui.playerData.alliance;
        if (!e.hasAlliance())
            return this.operator === s.operators.equal;
        var t = this.value !== r.ALLIANCE_RIGHT_BOSS || e.isBoss();
        return this.operator === s.operators.equal ? t : this.operator === s.operators.equal && !t
    }
    ,
    e.exports = o
}
, function(e, t) {
    e.exports = {
        ALLIANCE_RIGHT_NONE: 0,
        ALLIANCE_RIGHT_BOSS: 1
    }
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        var e = window.gui.playerData.position.area.nameId;
        return this.operator === o.operators.equal ? s("ui.tooltip.beInArea", [e]) : s("ui.tooltip.dontBeInArea", [e])
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.position.area.id
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        0 === this.value && "B" === this.key ? this._text = s("ui.criterion.initialBones") : this._text = s("ui.criterion.bones") + " " + this.getOperatorText() + " " + this.value
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.entityLook.bonesId
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e);
        var t = window.gui.databases.Breeds[this.value].shortNameId;
        this.operator === o.operators.equal ? this._text = s("ui.tooltip.beABreed", [t]) : this._text = s("ui.tooltip.dontBeABreed", [t])
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this._text
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.breed
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        this._communityId = window.gui.playerData.identification.communityId
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.initialize = function(e) {
        var t = this
          , i = window.gui.serversData;
        i.syncServerStaticData(function(n) {
            return n ? (console.error("ServerDetails setServer error", n),
            e(n)) : (t._communityName = i.staticContent.communities[t._communityId],
            void e())
        })
    }
    ,
    n.prototype.getText = function() {
        return this.operator === o.operators.equal ? s("ui.criterion.community", [this._communityName]) : s("ui.criterion.notCommunity", [this._communityName])
    }
    ,
    n.prototype.getCriterion = function() {
        return this._communityId
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.time.days", 1)
    }
    ,
    n.prototype.getCriterion = function() {
        var e = new Date;
        return e.getDate()
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(36)
      , r = i(26).inherits
      , l = {};
    r(n, o),
    n.prototype.initialize = function(e) {
        var t = this.value
          , i = l[t];
        if (i)
            return this._emoticonData = i,
            e();
        if (i = window.gui.playerData.emoteData.list[t])
            return this._emoticonData = i,
            e();
        var n = this;
        a.getData("Emoticons", this.value, function(t, i) {
            return t ? e(t) : (l[i.id] = i,
            n._emoticonData = i,
            void e())
        })
    }
    ,
    n.prototype.isRespected = function() {
        return window.gui.playerData.emoteData.list.hasOwnProperty(this.value)
    }
    ,
    n.prototype.getText = function() {
        var e = s(this.operator === o.operators.different ? "ui.tooltip.dontPossessEmote" : "ui.tooltip.possessEmote");
        return e + " '" + this._emoticonData.nameId + "'"
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.tooltip.playerInFriendlist")
    }
    ,
    n.prototype.getCriterion = function() {
        return Object.keys(window.gui.playerData.socialData.friendsList).length
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e);
        var t = this.key.split(",");
        t.length > 1 ? (this._giftId = parseInt(t[0], 10),
        this._giftLevel = parseInt(t[1], 10)) : (this._giftId = parseInt(this.value, 10),
        this._giftLevel = -1)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getText = function() {
        var e = window.gui.databases.AlignmentGift
          , t = e[this._giftId] ? e[this._giftId].nameId : "";
        return this.operator === o.operators.superior ? s("ui.pvp.giftRequired", [t + " > " + this._giftLevel]) : s("ui.pvp.giftRequired", [t])
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.alignmentRank
          , t = window.gui.databases.AlignmentRankJntGift[e];
        if (!t || !t.gifts)
            return !1;
        for (var i = 0, n = t.gifts.length; i < n; i += 1)
            if (t.gifts[i] === this._giftId)
                return !this._giftLevel || t.levels[i] > this._giftLevel;
        return !1
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return s(0 === this.value ? "ui.criterion.noguild" : 1 === this.value ? "ui.criterion.hasGuild" : "ui.criterion.hasValidGuild")
    }
    ,
    n.prototype.getCriterion = function() {
        var e = window.gui.playerData.guild;
        return e.hasGuild() ? e.current.enabled ? 2 : 1 : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.guild.guildLevel")
    }
    ,
    n.prototype.getCriterion = function() {
        var e = window.gui.playerData.guild;
        return e.hasGuild() ? e.current.guildLevel : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(339).GuildRightsBitEnum
      , r = i(26).inherits;
    r(n, o),
    n.prototype.getText = function() {
        var e;
        switch (this.value) {
        case a.GUILD_RIGHT_BOSS:
            e = s("ui.guild.right.leader");
            break;
        case a.GUILD_RIGHT_BAN_MEMBERS:
            e = s("ui.social.guildRightsBann");
            break;
        case a.GUILD_RIGHT_COLLECT:
            e = s("ui.social.guildRightsCollect");
            break;
        case a.GUILD_RIGHT_COLLECT_MY_TAX_COLLECTOR:
            e = s("ui.social.guildRightsCollectMy");
            break;
        case a.GUILD_RIGHT_DEFENSE_PRIORITY:
            e = s("ui.social.guildRightsPrioritizeMe");
            break;
        case a.GUILD_RIGHT_HIRE_TAX_COLLECTOR:
            e = s("ui.social.guildRightsHiretax");
            break;
        case a.GUILD_RIGHT_INVITE_NEW_MEMBERS:
            e = s("ui.social.guildRightsInvit");
            break;
        case a.GUILD_RIGHT_MANAGE_GUILD_BOOSTS:
            e = s("ui.social.guildRightsBoost");
            break;
        case a.GUILD_RIGHT_MANAGE_MY_XP_CONTRIBUTION:
            e = s("ui.social.guildRightManageOwnXP");
            break;
        case a.GUILD_RIGHT_MANAGE_RANKS:
            e = s("ui.social.guildRightsRank");
            break;
        case a.GUILD_RIGHT_MANAGE_RIGHTS:
            e = s("ui.social.guildManageRights");
            break;
        case a.GUILD_RIGHT_MANAGE_XP_CONTRIBUTION:
            e = s("ui.social.guildRightsPercentXP");
            break;
        case a.GUILD_RIGHT_ORGANIZE_PADDOCKS:
            e = s("ui.social.guildRightsMountParkArrange");
            break;
        case a.GUILD_RIGHT_SET_ALLIANCE_PRISM:
            e = s("ui.social.guildRightsSetAlliancePrism");
            break;
        case a.GUILD_RIGHT_TALK_IN_ALLIANCE_CHAN:
            e = s("ui.social.guildRightsTalkInAllianceChannel");
            break;
        case a.GUILD_RIGHT_TAKE_OTHERS_MOUNTS_IN_PADDOCKS:
            e = s("ui.social.guildRightsManageOtherMount");
            break;
        case a.GUILD_RIGHT_USE_PADDOCKS:
            e = s("ui.social.guildRightsMountParkUse");
            break;
        default:
            e = ""
        }
        return this.operator === o.operators.equal ? s("ui.criterion.guildRights", [e]) : s("ui.criterion.notGuildRights", [e])
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.guild;
        if (!e.hasGuild())
            return this.operator === o.operators.different;
        var t = e.hasRight(this.value);
        return this.operator === o.operators.equal ? t : !t
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e);
        var t = this.rawValue.split(",");
        t.length > 1 ? (this._jobId = parseInt(t[0], 10),
        this._jobLevel = parseInt(t[1], 10)) : (this._jobId = parseInt(this.value, 10),
        this._jobLevel = -1)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(36)
      , r = i(26);
    r.inherits(n, o),
    n.prototype.initialize = function(e) {
        var t = this;
        a.getData("Jobs", this._jobId, function(i, n) {
            return i ? e(i) : (t._jobName = n && n.nameId,
            void e())
        })
    }
    ,
    n.prototype.getText = function() {
        if (!this._jobName)
            return "";
        var e = this._jobName
          , t = "";
        switch (this._jobLevel >= 0 && (t = " " + s("ui.common.short.level") + " " + this._jobLevel),
        this.operator) {
        case o.operators.equal:
            return e + t;
        case o.operators.different:
            return s("ui.common.dontBe") + e + t;
        case o.operators.superior:
            return e + " >" + t;
        case o.operators.inferior:
            return e + " <" + t;
        default:
            return ""
        }
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.jobs.list;
        if (this._jobLevel === -1)
            return e.hasOwnProperty(this._jobId);
        var t = e[this._jobId];
        if (!t || !t.experience)
            return !1;
        var i = this.operator.compareFn;
        return !!i && i(t.experience.jobLevel, this._jobLevel)
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.kamas")
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.inventory.kamas
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.level")
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.level
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e);
        var t = this.rawValue.split(",");
        t.length > 1 ? (this._mapId = parseInt(t[0], 10),
        this.value = parseInt(t[1], 10)) : this._mapId = window.gui.playerData.position.mapId
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.criterion.MK", [this._mapId])
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.level
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return s(this.operator === o.operators.equal && 1 === this.value || this.operator === o.operators.different && 2 === this.value ? "ui.tooltip.beMaried" : "ui.tooltip.beSingle")
    }
    ,
    n.prototype.getCriterion = function() {
        return null !== window.gui.playerData.socialData.spouse ? 1 : 2
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getCriterion = function() {
        return window.gui.playerData.partyData.arenaStats.bestDailyRank
    }
    ,
    n.prototype.getText = function() {
        var e;
        return e = this.operator === o.operators.different ? s("ui.common.differentFrom") + " >" : ">",
        s("ui.common.pvpMaxRank") + " " + e + " " + this.value
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.time.months")
    }
    ,
    n.prototype.getCriterion = function() {
        var e = new Date;
        return e.getMonth()
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getText = function() {
        var e;
        switch (this.operator.token) {
        case "!":
        case "=":
            e = this.operator.token + " " + this.rawValue;
            break;
        case "~":
            e = "= " + this.rawValue;
            break;
        case "S":
        case "s":
            e = s("ui.criterion.startWith", [this.rawValue]);
            break;
        case "E":
        case "e":
            e = s("ui.criterion.endWith", [this.rawValue]);
            break;
        case "v":
            e = s("ui.criterion.valid");
            break;
        case "i":
            e = s("ui.criterion.invalid");
            break;
        default:
            e = ""
        }
        return s("ui.common.name") + " " + e
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.characterBaseInformations.name;
        switch (this.operator.token) {
        case "=":
            return e === this.rawValue;
        case "!":
            return e !== this.rawValue;
        case "~":
            return e.toLowerCase() === this.rawValue.toLowerCase();
        case "S":
            return 0 === e.toLowerCase().indexOf(this.rawValue.toLowerCase());
        case "s":
            return 0 === e.indexOf(this.rawValue);
        case "E":
            return e.toLowerCase().indexOf(this.rawValue.toLowerCase()) === e.length - this.rawValue.length;
        case "e":
            return e.indexOf(this.rawValue) === e.length - this.rawValue.length;
        default:
        case "v":
        case "i":
            return !1
        }
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e, t) {
        o.call(this, e),
        this._objectName = t.nameId
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.inventory.objects
          , t = this.operator === o.operators.equal;
        for (var i in e) {
            var n = e[i];
            if (n.objectGID === this.value)
                return t
        }
        return !t
    }
    ,
    n.prototype.getText = function() {
        return this.operator === o.operators.different ? s("ui.common.doNotPossess", [this._objectName]) : s("ui.common.doPossess", [this._objectName])
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n() {
        c = {
            CM: d("ui.stats.shortMP"),
            CP: d("ui.stats.shortAP"),
            CH: d("ui.pvp.honourPoints"),
            CD: d("ui.pvp.disgracePoints"),
            CT: d("ui.stats.takleBlock"),
            Ct: d("ui.stats.takleEvade")
        },
        u = d("ui.item.characteristics").split(",")
    }
    function o(e, t, i) {
        for (var n = i.length, o = e, s = 0, a = t.length; s < a; s += 1)
            o = o.split(t[s]).join(i[s % n]);
        return o
    }
    function s(e) {
        return c[e] ? c[e] : o(e, ["CS", "Cs", "CV", "Cv", "CA", "Ca", "CI", "Ci", "CW", "Cw", "CC", "Cc", "CA", "PG", "PJ", "Pj", "PM", "PA", "PN", "PE", "<NO>", "PS", "PR", "PL", "PK", "Pg", "Pr", "Ps", "Pa", "PP", "PZ", "CM", "Qa"], u)
    }
    function a(e) {
        h.call(this, e),
        c || n(),
        this._keyText = s(this.key)
    }
    function r(e) {
        return function(t) {
            return t[e].base
        }
    }
    function l(e) {
        return function(t) {
            var i = t[e];
            return i.base + i.alignGiftBonus + i.contextModif + i.objectsAndMountBonus
        }
    }
    var c, u, h = i(330), d = i(35).getText, p = i(26).inherits;
    p(a, h),
    a.prototype.getKeyText = function() {
        return this._keyText
    }
    ;
    var m = {
        Ca: r("agility"),
        CA: l("agility"),
        Cc: r("chance"),
        CC: l("chance"),
        Ce: function(e) {
            return e.energyPoints
        },
        CE: function(e) {
            return e.maxEnergyPoints
        },
        CH: function(e) {
            return e.alignmentInfos.honor
        },
        Ci: r("intelligence"),
        CI: l("intelligence"),
        CL: function(e) {
            return e.lifePoints
        },
        CM: l("movementPoints"),
        CP: l("actionPoints"),
        Cs: r("strength"),
        CS: l("strength"),
        Cv: r("vitality"),
        CV: l("vitality"),
        Cw: r("wisdom"),
        CW: l("wisdom"),
        Ct: l("tackleEvade"),
        CT: l("tackleBlock")
    };
    a.prototype.getCriterion = function() {
        var e = window.gui.playerData.characters.mainCharacter.characteristics;
        return m[this.key] ? parseInt(m[this.key](e), 10) : (console.error("unknown criterion key: " + this.key),
        0)
    }
    ,
    e.exports = a
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.pvp.rank")
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26);
    a.inherits(n, o),
    n.prototype.getText = function() {
        var e = window.gui.playerData.quests.all[this.value];
        if (!e)
            return "";
        switch (this.key) {
        case "Qa":
            return s("ui.grimoire.quest.active", [e.nameId]);
        case "Qc":
            return s("ui.grimoire.quest.startable", [e.nameId]);
        case "Qf":
            return s("ui.grimoire.quest.done", [e.nameId]);
        default:
            return ""
        }
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.quests.all[this.value];
        if (!e)
            return "";
        switch (this.key) {
        case "Qa":
            return window.gui.playerData.quests.active.hasOwnProperty(this.value);
        case "Qc":
            return !0;
        case "Qf":
            return window.gui.playerData.quests.finished.hasOwnProperty(this.value);
        default:
            return ""
        }
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.pvpRank")
    }
    ,
    n.prototype.getOperatorText = function() {
        return this.operator === o.operators.different ? s("ui.common.differentFrom") + " >" : ">"
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.partyData.arenaStats.rank
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.level")
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.level
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return this.operator === o.operators.equal && 1 === this.value || this.operator === o.operators.different && 0 === this.value ? s("ui.tooltip.mountEquiped") : this.operator === o.operators.equal && 1 === this.value || this.operator === o.operators.different && 0 === this.value ? s("ui.tooltip.mountNonEquiped") : ""
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.isRiding ? 1 : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        this._keyText = s("ui.header.server")
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(36);
    a(n, o),
    n.prototype.initialize = function(e) {
        var t = this;
        this._serverName = "",
        r.getData("Servers", this.value, function(i, n) {
            return i ? e(i) : (t._serverName = n.nameId,
            void e())
        })
    }
    ,
    n.prototype.getKeyText = function() {
        return this._keyText
    }
    ,
    n.prototype.getValueText = function() {
        return this._serverName
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.serversData.connectedServerId
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return s(1 === this.value ? "ui.tooltip.beFemale" : "ui.tooltip.beMale")
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characterBaseInformations.sex ? 1 : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(36)
      , l = [7010, 10417, 10418];
    a(n, o),
    n.prototype.initialize = function(e) {
        var t, i = this.key.split(",");
        i.length > 1 ? (t = parseInt(i[0], 10),
        this._quantityMonster = parseInt(i[1], 10)) : (t = parseInt(this.value, 10),
        this._quantityMonster = 1),
        this._monsterName = "";
        var n = this;
        r.getData("Monsters", t, function(t, i) {
            return t ? e(t) : (n._monsterName = i.nameId,
            void e())
        })
    }
    ,
    n.prototype.isRespected = function() {
        for (var e = window.gui.playerData.inventory, t = 0; t < l.length; t += 1)
            if (e.quantityList[[l]])
                return !0;
        return !1
    }
    ,
    n.prototype.getText = function() {
        return s("ui.tooltip.possessSoulStone", [this._quantityMonster, this._monsterName])
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(26).inherits;
    s(n, o),
    n.prototype.getCriterion = function() {
        return window.gui.playerData.characters.mainCharacter.characteristics.alignmentInfos.alignmentGrade
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e);
        var t = this.rawValue.split(",");
        t.length > 1 ? console.error(new Error("SpellItemCriterion: too much parameters: " + t)) : this._spellId = this.value
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        var e = window.gui.playerData.characters.mainCharacter.spellData.spells[this._spellId];
        if (!e)
            return "";
        switch (this.operator) {
        case o.operators.equal:
            return s("ui.criterion.gotSpell", [e.nameId]);
        case o.operators.different:
            return s("ui.criterion.doesntGotSpell", [e.nameId]);
        default:
            return ""
        }
    }
    ,
    n.prototype.isRespected = function() {
        var e = window.gui.playerData.characters.mainCharacter.spellData.spells.hasOwnProperty(this._spellId);
        return e && this.operator === o.operators.equal || !e && this.operator === o.operators.different
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(26).inherits;
    s(n, o),
    n.prototype.isRespected = function() {
        return !0
    }
    ,
    n.prototype.getText = function() {
        return ""
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(36);
    a(n, o),
    n.prototype.initialize = function(e) {
        var t = this;
        this._name = "",
        r.getData("SubAreas", this.value, function(i, n) {
            return i ? e(i) : (t._name = n.nameId,
            void e())
        })
    }
    ,
    n.prototype.getText = function() {
        if (!this._name)
            return "";
        switch (this.operator) {
        case o.operators.equal:
            return s("ui.tooltip.beInSubarea", [this._name]);
        case o.operators.different:
            return s("ui.tooltip.dontBeInSubarea", [this._name]);
        default:
            return ""
        }
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.position.subAreaId
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getText = function() {
        return s(this.operator === o.operators.equal && 1 === this.value || this.operator === o.operators.different && 0 === this.value ? "ui.tooltip.beSubscirber" : "ui.tooltip.dontBeSubscriber")
    }
    ,
    n.prototype.getCriterion = function() {
        var e = window.gui.playerData.identification;
        return e.subscriptionEndDate > 0 || e.hasRights ? 1 : 0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e),
        this._text = s("ui.criterion.unusableItem")
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.isRespected = function() {
        return !0
    }
    ,
    n.prototype.getText = function() {
        return this._text
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        o.call(this, e)
    }
    var o = i(330)
      , s = i(35).getText
      , a = i(26).inherits;
    a(n, o),
    n.prototype.getKeyText = function() {
        return s("ui.common.weight")
    }
    ,
    n.prototype.getCriterion = function() {
        return window.gui.playerData.inventory.weight
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        l.call(this),
        this.exchangeAllowed = !0,
        this.isInitialised = !1,
        this.shortName = null ,
        this.effectsMap = {};
        for (var t in e)
            this[t] = e[t]
    }
    function o(e) {
        for (var t = 0; t < m.length; t += 1)
            if (m[t] > e)
                return t;
        return m.length
    }
    function s(e, t, i) {
        if (e.effects = t,
        !e.effects.length)
            return i();
        t = t.filter(function(e) {
            return e && e.effect
        });
        var n = 0
          , s = 0
          , a = e.item;
        if (a && a.isWeapon)
            switch (a.typeId) {
            case 7:
                n = "X",
                s = 1;
                break;
            case 4:
                n = "T",
                s = 1;
                break;
            case 8:
                n = "L",
                s = 1
            }
        for (var r = 0; r < t.length; r += 1) {
            var l = t[r];
            switch (e.effectsMap[l.effectId] = l,
            n && l.isDamageEffect() && (l.zoneShape = n,
            l.zoneSize = s),
            l.effectId) {
            case f:
                e.livingObjectFoodDate = l.description;
                break;
            case g:
                e.livingObjectId = l.value,
                l.isLivingProperty = !0;
                break;
            case _:
                e.livingObjectMood = l.value,
                l.isLivingProperty = !0;
                break;
            case v:
                e.livingObjectSkin = l.value,
                l.isLivingProperty = !0;
                break;
            case y:
                e.livingObjectCategory = l.value,
                l.isLivingProperty = !0;
                break;
            case w:
                var c = o(l.value)
                  , u = l.value - m[c - 1]
                  , p = m[c] - m[c - 1] || 0;
                e.livingObjectLevel = c,
                e.livingObjectXp = u,
                e.livingObjectMaxXp = p,
                l.isLivingProperty = !0
            }
            139 !== l.effectId && 110 !== l.effectId || (e.isOkForMultiUse = !0),
            983 === l.effectId && (e.exchangeAllowed = !1),
            l.effectId !== T && l.effectId !== S || (e.exchangeable = !1)
        }
        if (!e.livingObjectCategory)
            return i();
        var b = e.livingObjectId || e.objectGID;
        h.getData("LivingObjectSkinJntMood", b, function(t, n) {
            return t ? i(t) : (e.iconId = n.moods[e.livingObjectMood][e.livingObjectSkin - 1],
            void d.preloadImage("gfx/items/" + e.iconId + ".png", function(t) {
                e.image = t,
                i()
            }))
        })
    }
    function a(e, t) {
        function i(i) {
            return i ? t(i) : (e.isInitialised = !0,
            e.emit("initialised"),
            t())
        }
        e.effectsMap && e.effectsMap[1081] && (e.weight += e.effectsMap[1081].getParams()[0]);
        var n, o, s = 0;
        switch (e.item.id) {
        case b:
            o = function(e, t) {
                var i = e.grades[t];
                i && i.level > s && (s = i.level,
                n = e.nameId)
            }
            ;
            break;
        case I:
            o = function(e) {
                e.isMiniBoss && (n ? n += ", " + e.nameId : n = e.nameId)
            }
            ;
            break;
        case C:
            o = function(e) {
                e.isBoss && (n ? n += ", " + e.nameId : n = e.nameId)
            }
        }
        if (!o)
            return e.shortName = e.item.getRawName(),
            i();
        for (var a = [], r = [], l = 0; l < e.effects.length; l++) {
            var c = e.effects[l].getParams();
            c[2] && (a.push(c[2]),
            r.push(c[0] - 1))
        }
        h.getData("Monsters", a, function(t, s) {
            if (t)
                return i(t);
            for (var a = 0; a < e.effects.length; a++)
                s[a] && o(s[a], r[a]);
            return e.shortName = n,
            i()
        })
    }
    var r = i(12)
      , l = i(16).EventEmitter
      , c = i(224)
      , u = i(26).inherits
      , h = i(36)
      , d = i(5)
      , p = i(35).getText
      , m = [0, 10, 21, 33, 46, 60, 75, 91, 108, 126, 145, 165, 186, 208, 231, 255, 280, 306, 333, 361]
      , f = 808
      , g = 970
      , _ = 971
      , v = 972
      , y = 973
      , w = 974
      , b = 7010
      , C = 10417
      , I = 10418
      , T = 981
      , S = 982;
    u(n, l),
    e.exports = n,
    n.prototype.setItem = function(e) {
        this.exchangeable = e.exchangeable,
        this.isOkForMultiUse = !1,
        this.weight = e.realWeight,
        this.item = e
    }
    ,
    n.prototype.isLinked = function() {
        return !this.exchangeable || !this.exchangeAllowed
    }
    ,
    n.prototype.isLinkedCharacter = function() {
        return !!this.effectsMap[T]
    }
    ,
    n.prototype.initialize = function(e) {
        n.initializeList([this], e)
    }
    ,
    n.initializeList = function(e, t) {
        for (var i = [], n = 0; n < e.length; n++)
            e[n].effects.length > 0 && (i = i.concat(e[n].effects));
        c.createEffectInstances(i, function(i, n) {
            return i ? t(i) : void r.eachSeries(e, function(e, t) {
                var i = e.effects.length
                  , o = i > 0 ? n.splice(0, i) : [];
                s(e, o, function(i) {
                    return i ? t(i) : void a(e, t)
                })
            }, function(e) {
                t(e)
            })
        })
    }
    ,
    n.prototype.getRawName = function() {
        if (!this.isInitialised)
            return "";
        var e;
        return e = this.objectGID === b ? p("ui.item.soul") + p("ui.common.colon") + this.shortName : this.objectGID === I ? p("ui.item.miniboss") + p("ui.common.colon") + this.shortName : this.objectGID === C ? p("ui.item.boss") + p("ui.common.colon") + this.shortName : this.shortName
    }
    ,
    n.prototype.getName = function() {
        if (!this.isInitialised)
            return "";
        var e = this.getRawName();
        return window.gui.playerData.isModeratorOrMore() && (e += " (" + this.objectGID + ")"),
        e
    }
    ,
    n.prototype.getItem = function() {
        return this.item
    }
    ,
    n.prototype.getItemInstance = function() {
        return this
    }
    ,
    n.prototype.getProperty = function(e) {
        return "weight" === e ? this.weight : "nameId" === e ? this.getName() : this.hasOwnProperty(e) ? this[e] : this.item.getProperty(e)
    }
}
, function(e, t, i) {
    function n() {
        return this.tooltipContent || (this.tooltipContent = new u(this.rowContent)),
        this.tooltipContent
    }
    function o(e, t, i) {
        p.call(this, "div", {
            className: "ShopViewer"
        }),
        i = i || {},
        this.itemTypes = {},
        this._createDom(e, t, i)
    }
    function s(e, t) {
        return e.objectGID === t
    }
    i(388);
    var a = i(206).addTooltip
      , r = i(210)
      , l = i(26).inherits
      , c = i(389)
      , u = i(395)
      , h = i(323)
      , d = i(400)
      , p = i(190);
    l(o, p),
    e.exports = o,
    o.prototype._createDom = function(e, t, i) {
        var o = this;
        i.manualFiltering || (this.itemFilter = this.appendChild(new c(i))),
        this.table = this.appendChild(new d(e,t,i.tableOption)),
        this.table.on("rowSlidedLeft", function(e, t) {
            o.emit("rowSlidedLeft", e, t)
        }),
        this.table.on("rowSlidedRight", function(e, t) {
            o.emit("rowSlidedRight", e, t)
        }),
        this.table.on("rowAdded", function(e, t, i) {
            i.tooltipContent = null ,
            a(i, n)
        }),
        this.table.on("rowTap", function(e, t) {
            o.emit("itemSelected", t)
        }),
        this.itemFilter && this._setupFiltering()
    }
    ,
    o.prototype.setHeader = function(e) {
        this.table.setColumnHeader("name", e)
    }
    ,
    o.prototype._setupFiltering = function() {
        var e, t, i, n, o, s = h.getItemTypeMap(), a = this;
        this.itemFilter.on("filter", function(s, l, u) {
            e = s,
            t = s !== c.filters.all,
            i = l,
            n = l !== c.subFilters.all,
            o = u ? r.simplifyString(u) : null ,
            a.table.filter()
        }),
        this.table.addFilter(function(a) {
            var r = a.getItem()
              , l = s[r.typeId].category;
            return (!t || l === e) && ((!n || r.typeId === i) && (!o || r.getNameForSearch().indexOf(o) !== -1))
        })
    }
    ,
    o.prototype.filter = function(e) {
        this.table.filter(e)
    }
    ,
    o.prototype._unregisterItemType = function(e) {
        var t = this.table.getRow(e);
        if (t) {
            var i = t.rowContent
              , n = i.getItem().typeId;
            this.itemTypes[n] && (this.itemTypes[n]--,
            0 === this.itemTypes[n] && delete this.itemTypes[n])
        }
    }
    ,
    o.prototype._registerItemType = function(e) {
        var t = e.getItem().typeId;
        return this.itemTypes[t] ? (this.itemTypes[t]++,
        !1) : (this.itemTypes[t] = 1,
        !0)
    }
    ,
    o.prototype._collectItemTypes = function(e) {
        if (this.itemFilter) {
            for (var t = !1, i = 0; i < e.length; i++) {
                var n = this.table.getIdFn(e[i]);
                this.table.hasRow(n) || (t |= this._registerItemType(e[i]))
            }
            t && this.itemFilter.updateSubFilters(Object.keys(this.itemTypes))
        }
    }
    ,
    o.prototype.removeItems = function(e) {
        for (var t = 0; t < e.length; t++)
            this._unregisterItemType(e[t]);
        this.table.delRows(e, !0)
    }
    ,
    o.prototype.getItemCount = function() {
        return this.table.getRowCount()
    }
    ,
    o.prototype.selectItem = function(e) {
        this.table.selectRow(e)
    }
    ,
    o.prototype.getItem = function(e) {
        var t = this.table.getRow(e);
        return t ? t.rowContent : null
    }
    ,
    o.prototype.findItemByGID = function(e) {
        return this.table.findRow(s, e)
    }
    ,
    o.prototype.selectFilter = function(e) {
        this.itemFilter.selectSubfilter(e)
    }
    ,
    o.prototype.clearContent = function() {
        this.itemTypes = {},
        this.table.clearContent()
    }
    ,
    o.prototype.setItemList = function(e) {
        this.clearContent(),
        this.itemFilter && (this._collectItemTypes(e),
        e.length || this.itemFilter.updateSubFilters([]),
        this.itemFilter.reset()),
        this.table.addList(e, !0)
    }
    ,
    o.prototype.addItems = function(e) {
        this._collectItemTypes(e),
        this.table.addList(e, !0, !0)
    }
    ,
    o.prototype.addItemsAndHighlightThem = function(e) {
        this._collectItemTypes(e),
        this.selectFilter(e[0].getProperty("typeId")),
        this.table.addList(e, !0, !0),
        this.selectItem(e[0].objectUID)
    }
    ,
    o.prototype.setPlaceholder = function(e) {
        this.table.setPlaceholderText(e)
    }
    ,
    o.prototype.refresh = function() {
        this.table.placeholder.refresh(),
        this.table.scroller.refresh()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e, t) {
            _.selectedFilter !== e ? (v[_.selectedFilter] && (v[_.selectedFilter].delClassNames("selected"),
            y[_.selectedFilter].wdSelect.hide()),
            _.selectedFilter = e,
            v[e].addClassNames("selected"),
            y[e].wdSelect.show(),
            _.selectedSubFilter = y[e].wdSelect.selectFirst(!0)) : _.selectedSubFilter = t,
            _.emit("filter", _.selectedFilter, _.selectedSubFilter)
        }
        function i(e) {
            _.emit("filter", _.selectedFilter, _.selectedSubFilter, e)
        }
        function n() {
            I.toggleDisplay(this.filter !== d.preset),
            T.hide(),
            S.setValue(""),
            t(this.filter, _.selectedSubFilter)
        }
        function a(e) {
            t(_.selectedFilter, parseInt(e, 10))
        }
        function p() {
            var e = !T.isVisible();
            I.toggleDisplay(!e),
            T.toggleDisplay(e),
            S.setValue("")
        }
        u.call(this, "div", {
            className: "ItemFilters"
        }),
        m || (m = [s("ui.common.all"), s("ui.common.equipement"), s("ui.common.usableItems"), s("ui.common.ressources"), s("ui.common.quest.objects"), s("ui.common.presets")]),
        e = e || {};
        var _ = this
          , v = {}
          , y = {}
          , w = []
          , b = this.createChild("div", {
            className: "filters"
        })
          , C = this.filterBtnMap = {}
          , I = this.subFiltersBox = this.createChild("div", {
            className: "subFiltersBox"
        })
          , T = this.createChild("div", {
            className: "searchBox"
        });
        o(T, s("ui.common.searchFilterTooltip"));
        var S;
        T.hide(),
        this.closeSearchBox = function() {
            I.toggleDisplay(_.selectedFilter !== d.preset),
            S.setValue(""),
            T.hide()
        }
        ,
        this.selectCategory = function(e) {
            t(e, _.selectedSubFilter)
        }
        ,
        this.selectSubfilter = function(e) {
            var i = _.selectedFilter
              , n = y[i].wdSelect;
            return !!n.hasValue(e) && (n.select(e, !0),
            t(i, e),
            !0)
        }
        ,
        this.reset = function() {
            for (var e = 0, i = w.length; e < i; e += 1) {
                var n = w[e];
                n.selectFirst(!0)
            }
            var o = d.all
              , s = y[o].wdSelect.selectFirst(!0);
            t(o, s)
        }
        ,
        this.updateSubFilters = function(t) {
            var i = l.getItemTypeMap()
              , n = t.sort(function(e, t) {
                return i[e].nameId.localeCompare(i[t].nameId)
            });
            for (var o in y)
                y[o].wdSelect.clearContent(),
                e.noAllCategory || y[o].wdSelect.addOption(s("ui.common.allTypesForObject"), f.all);
            for (var a = y[d.all], r = 0, c = n.length; r < c; r += 1) {
                var u = i[n[r]]
                  , h = y[u.category];
                h.wdSelect.addOption(u.nameId, u.id),
                a.wdSelect.addOption(u.nameId, u.id)
            }
        }
        ,
        this.toggleCategoryDisplay = function(e, t) {
            C[e].toggleDisplay(t)
        }
        ;
        for (var A = b.createChild("div", {
            className: "content"
        }), E = 0, x = g.length; E < x; E++) {
            var M = g[E]
              , N = ["filter", l.getCategoryName(M) || "all"]
              , R = A.appendChild(new c({
                className: N
            },n));
            C[M] = R,
            o(R, m[E]),
            R.filter = M,
            R.on("tap", n),
            v[M] = R,
            R.createChild("div", {
                className: "icon"
            });
            var O = I.appendChild(new h({
                className: "subFilterSelect"
            }));
            w.push(O),
            O.on("change", a),
            O.hide(),
            y[M] = {
                wdSelect: O
            }
        }
        var P = I.appendChild(new c({
            className: "searchBtn"
        },p));
        o(P, s("ui.common.sortOrSearch")),
        this.searchInput = S = T.appendChild(new r),
        S.on("change", i);
        var D = T.appendChild(new c({
            className: "closeBtn"
        },p));
        o(D, s("ui.common.sortOrSearch")),
        T.on("show", function() {
            _.emit("searchOpen")
        }),
        T.on("hide", function() {
            _.emit("searchClose")
        }),
        this.isSearchOpen = T.isVisible,
        this.selectedFilter = null ,
        this.selectedSubFilter = null
    }
    i(390);
    var o = i(206).addTooltip
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(391)
      , l = i(323)
      , c = i(204)
      , u = i(190)
      , h = i(393)
      , d = {
        all: -1
    };
    for (var p in l.categories)
        d[p] = l.categories[p];
    var m, f = {
        all: -1
    }, g = [d.all, d.equipment, d.consumables, d.resources, d.quest, d.preset];
    a(n, u),
    n.filters = d,
    n.subFilters = f,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        e = e || {};
        var i = {
            type: "text",
            spellcheck: "false",
            autocapitalize: "off",
            autocorrect: "off",
            autocomplete: "off"
        };
        for (var n in e.attr)
            i[n] = e.attr[n];
        e.attr = i,
        s.call(this, "input", e),
        this.addClassNames("InputBox", i.type),
        this.allowDomEvents(),
        this.on("dom.input", function() {
            this.emit("change", this.rootElement.value)
        }),
        this.on("dom.touchend", function() {
            r.isIOS ? document.activeElement !== this.rootElement && this.focus() : this.focus()
        }),
        this.on("dom.keypress", function(e) {
            13 === e.which && (t && t(this),
            this.emit("validate"))
        })
    }
    i(392);
    var o = i(26).inherits
      , s = i(190)
      , a = i(301)
      , r = i(7);
    o(n, s),
    e.exports = n,
    n.prototype.setValue = function(e, t) {
        this.rootElement.value = e,
        t && this.emit("change", e)
    }
    ,
    n.prototype.setPlaceholder = function(e) {
        this.rootElement.placeholder = e
    }
    ,
    n.prototype.getValue = function() {
        return this.rootElement.value
    }
    ,
    n.prototype.setReadonly = function(e) {
        e === !1 ? this.rootElement.removeAttribute("readonly") : this.rootElement.setAttribute("readonly", "readonly")
    }
    ,
    n.prototype.blur = function() {
        this.rootElement.blur(),
        a.hide()
    }
    ,
    n.prototype.focus = function() {
        this.rootElement.focus()
    }
    ,
    n.prototype.disable = function() {
        this.rootElement.disabled = !0
    }
    ,
    n.prototype.enable = function() {
        this.rootElement.disabled = !1
    }
    ,
    n.prototype.setEnable = function(e) {
        this.rootElement.disabled = !e
    }
    ,
    n.prototype.setCaretPosition = function(e) {
        this.rootElement.setSelectionRange(e, e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e, t) {
            i._lastSelectedIndex = t,
            i.emit("change", e, i._previousValue),
            i._dropDownSelector.setText(i._map[t].text),
            i._previousValue = e
        }
        e = e || {},
        s.call(this, "div", {
            className: "Selector"
        }),
        this.addClassNames(e.className);
        var i = this;
        this._map = [],
        this._valueIndexes = {},
        this._previousValue = null ,
        this._lastSelectedIndex = 0,
        this._dropDownSelector = this.appendChild(new a({
            className: ["selectorContent"],
            scaleOnPress: !1
        })),
        this._hasContent = !1,
        this._enabled = !0,
        this.buttonOpen = this.createChild("div", {
            className: "buttonOpen"
        }),
        this._dropDownSelector.on("tap", function() {
            window.gui.dropDown.setupDropDown(this, i._map, i._lastSelectedIndex, t)
        })
    }
    i(394);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204);
    o(n, s),
    e.exports = n,
    n.prototype.addOption = function(e, t) {
        t || 0 === t || (t = ""),
        null === this._previousValue && (this._previousValue = t,
        this._lastSelectedIndex = 0,
        this._dropDownSelector.setText(e)),
        this._valueIndexes[t] = this._map.length,
        this._map.push({
            text: e,
            value: t
        }),
        this._hasContent = !0,
        this._setEnable()
    }
    ,
    n.prototype.setEnable = function(e) {
        "undefined" === e && (e = !0),
        this._enabled = e,
        this._setEnable()
    }
    ,
    n.prototype._setEnable = function() {
        var e = this._enabled && this._hasContent;
        this._dropDownSelector.setEnable(e),
        this.toggleClassName("disabled", !e)
    }
    ,
    n.prototype.hasValue = function(e) {
        return void 0 !== this._valueIndexes[e]
    }
    ,
    n.prototype.select = function(e, t) {
        this.setValue(e) && (t || this.emit("change", e, this._previousValue),
        this._previousValue = e)
    }
    ,
    n.prototype.selectFirst = function(e) {
        if (this._map.length) {
            var t = this._map[0].value;
            return this.select(t, e),
            t
        }
    }
    ,
    n.prototype.setValue = function(e) {
        var t = this._valueIndexes[e];
        if (void 0 === t)
            return console.error("Selecting invalid value:", e);
        this._lastSelectedIndex = t,
        window.gui.dropDown.select(t);
        var i = this._map[t];
        return this._dropDownSelector.setText(i.text),
        this._previousValue = e,
        !0
    }
    ,
    n.prototype.clearContent = function() {
        this._map = [],
        this._previousValue = null ,
        this._lastSelectedIndex = 0,
        this._valueIndexes = {},
        this._dropDownSelector.setText(""),
        window.gui.dropDown.clearContent(),
        this._hasContent = !1,
        this._setEnable()
    }
    ,
    n.prototype.toggleOption = function(e, t) {
        if (e || 0 === e) {
            var i = this._map[e];
            i && (t = void 0 === t ? i.disabled : t,
            i.disabled = !t)
        }
    }
    ,
    n.prototype.setOptionHidden = function(e, t) {
        var i = this._map[e];
        return i ? void (i.hidden = !!t) : console.warn("Invalid selector option", e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        return e.setText(t.getProperty("descriptionId")),
        !0
    }
    function o(e, t) {
        if (!t.getProperty("exchangeable"))
            return !1;
        var i = w("ui.common.averagePrice") + w("ui.common.colon")
          , n = t.getProperty("averagePrice");
        return i += n === -1 ? w("ui.item.averageprice.unavailable") : f.kamasToString(n),
        e.setText(i),
        !0
    }
    function s(e, t) {
        return e.setEffectsFromItem(t),
        !0
    }
    function a(e, t) {
        for (var i = 0; i < e.length; i++) {
            var n = e[i]
              , o = n.text
              , s = t.createChild("div", {
                className: "singleTab"
            });
            if ("string" == typeof o)
                s.setHtml(C + " " + o);
            else
                for (var a = 0; a < o.length; a++) {
                    var r = o[a];
                    s.createChild("div", {
                        text: r
                    })
                }
            n.isMalus && s.addClassNames("malus")
        }
    }
    function r(e, t) {
        return !(!t.getProperty("targetConditions") && !t.getProperty("conditions")) && (e.clearContent(),
        e.createChild("div", {
            className: "conditionsTitle",
            text: w("ui.common.conditions") + w("ui.common.colon")
        }),
        a(t.getProperty("conditionsFormatted"), e),
        a(t.getProperty("targetConditionsFormatted"), e),
        !0)
    }
    function l(e, t) {
        var i, n = "", o = e.getProperty("criticalHitBonus");
        o > 0 ? i = "+" : o < 0 && (i = "-"),
        n += w("ui.common.short.CriticalHit") + w("ui.common.colon") + "1/";
        var s = e.getProperty("criticalHitProbability");
        if (t) {
            var a = t.criticalHit
              , r = t.agility
              , l = a.alignGiftBonus + a.base + a.contextModif + a.objectsAndMountBonus
              , c = r.alignGiftBonus + r.base + r.contextModif + r.objectsAndMountBonus;
            c < 0 && (c = 0);
            var u = s - l
              , h = parseInt(u * Math.E * 1.1 / Math.log(c + 12), 10)
              , d = Math.min(u, h);
            d < 2 && (d = 2),
            n += d
        } else
            n += s;
        return i && (n += " (" + i + o + w("ui.common.damageShort") + ")"),
        n
    }
    function c(e, t) {
        var i = e.getProperty("criticalFailureProbability");
        if (t) {
            var n = t.criticalMiss;
            i += n.alignGiftBonus - n.base - n.contextModif - n.objectsAndMountBonus
        }
        return (e.getProperty("criticalHitProbability") ? " - " : "") + w("ui.common.short.CriticalFailure") + w("ui.common.colon") + "1/" + i + " "
    }
    function u(e, t) {
        e.setText(t.getProperty("itemSetName"))
    }
    function h(e, t) {
        var i = t.getItemInstance();
        if (i) {
            var n = i.effectsMap[I];
            n && e.createChild("div", {
                className: "extra",
                text: n.description
            })
        }
    }
    function d(e, t, i) {
        if (e.name.setText(t.getProperty("nameId")),
        e.name.toggleClassName("etheral", !!t.getProperty("etheral")),
        i.showCategory === !1)
            e.category.hide();
        else {
            var n = t.getProperty("typeId")
              , o = _.getItemTypeMap();
            e.category.setText(w("ui.common.category") + w("ui.common.colon") + o[n].nameId),
            e.category.show()
        }
        i.showWeight === !1 ? e.weight.hide() : (e.weight.setText(w("ui.common.short.weight", t.getProperty("weight"))),
        e.weight.show()),
        e.level.setText(w("ui.common.short.level") + " " + t.getProperty("level"));
        var s = e.extra;
        s.clearContent();
        var a = t.getProperty("itemSetId");
        if (t.getProperty("isWeapon")) {
            e.points.ap.setText(w("ui.common.ap") + " : " + t.getProperty("apCost"));
            var r = t.getProperty("range")
              , d = t.getProperty("minRange");
            e.points.ra.setText(w("ui.common.ra") + " : " + d),
            e.points.range.setText(r !== d ? " - " + r : ""),
            e.points.show(),
            a && a !== -1 && u(s.createChild("div", {
                className: "extra"
            }), t),
            t.getProperty("twoHanded") && s.createChild("div", {
                className: "extra",
                text: w("ui.common.twoHandsWeapon")
            });
            var p = t.getProperty("maxCastPerTurn");
            if (p) {
                var m = w("ui.item.maxUsePerTurn") + w("ui.common.colon") + p;
                s.createChild("div", {
                    className: "extra",
                    text: m
                })
            }
            t.getProperty("castInLine") && r > 1 && s.createChild("div", {
                className: "extra",
                text: w("ui.spellInfo.castInLine")
            }),
            t.getProperty("castTestLos") && r > 1 && s.createChild("div", {
                className: "extra",
                text: w("ui.spellInfo.castWithoutLos")
            }),
            h(s, t);
            var f = t.getProperty("criticalFailureProbability")
              , g = t.getProperty("criticalHitProbability");
            if (i.showCritical && (f || g)) {
                var v = ""
                  , y = window.gui.playerData.characters.mainCharacter.characteristics;
                g && (v += l(t, y)),
                f && (v += c(t, y)),
                s.createChild("div", {
                    className: "extra",
                    text: v
                })
            }
        } else
            e.points.hide(),
            a && a !== -1 && u(s.createChild("div", {
                className: "extra"
            }), t),
            h(s, t);
        return !0
    }
    function p(e, t) {
        b.call(this, "div", {
            className: "ItemDescription"
        }),
        this._buildDomElements(t),
        e && this.updateUI(e, t)
    }
    i(396);
    var m = i(397)
      , f = i(210)
      , g = i(26).inherits
      , _ = i(323)
      , v = _.Item
      , y = _.ItemInstance
      , w = i(35).getText
      , b = i(190)
      , C = "&#149;"
      , I = 812
      , T = {
        description: n,
        averagePrice: o,
        effects: s,
        conditions: r,
        header: d
    };
    g(p, b),
    e.exports = p,
    p.prototype._buildDomElements = function(e) {
        var t = this._domElements = {};
        t.header = this.createChild("div", {
            className: "header"
        });
        var i = t.header.createChild("div", {
            className: "nameAndLevel"
        });
        t.header.name = i.createChild("div", {
            className: "name"
        }),
        t.header.level = i.createChild("div", {
            className: "right"
        });
        var n = t.header.createChild("div", {
            className: "categoryAndWeight"
        });
        t.header.category = n.createChild("div"),
        t.header.weight = n.createChild("div", {
            className: "right"
        });
        var o = t.header.points = t.header.createChild("div", {
            className: "pointsLine"
        });
        o.ap = o.createChild("span", {
            className: "ap"
        }),
        o.ra = o.createChild("span", {
            className: "ra"
        }),
        o.range = o.createChild("span"),
        t.header.extra = t.header.createChild("div", {
            className: "extra"
        }),
        t.effects = this.appendChild(new m(e)),
        t.conditions = this.createChild("div", {
            className: "topSpacing"
        }),
        t.description = this.createChild("div", {
            className: ["topSpacing", "description"]
        }),
        t.averagePrice = this.createChild("div", {
            className: "topSpacing"
        })
    }
    ,
    p.prototype.updateUI = function(e, t) {
        if (!(e instanceof v || e instanceof y))
            return console.error(new Error("ItemDescription: item is not Item or ItemInstance"));
        t = t || {};
        for (var i in T) {
            var n = this._domElements[i];
            t[i] !== !1 && T[i](n, e, t) ? n.show() : n.hide()
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        h.call(this, "div", e),
        this.addClassNames("EffectDescription")
    }
    function o(e) {
        return e.requiresGlyphDescription() || e.requiresTrapDescription() || e.requiresBombDescription()
    }
    function s(e) {
        if (!e.requiresInvocationDescription() || !e.subEffectDescription)
            return null ;
        for (var t, i, n = new h("div"), o = Math.ceil(e.subEffectDescription.length / 2), s = 0; s < o; s++)
            t = n.createChild("div", {
                className: "monsterLine"
            }),
            i = t.createChild("div", {
                className: "column1"
            }),
            i.setHtml(d + " " + e.subEffectDescription[s]),
            e.subEffectDescription[o + s] && (i = t.createChild("div", {
                className: "column2"
            }),
            i.setHtml(d + " " + e.subEffectDescription[o + s]));
        return n
    }
    function a(e) {
        if (!o(e) || !e.subEffectDescription)
            return null ;
        for (var t = new h("div"), i = 0; i < e.subEffectDescription.length; i++) {
            var n = t.createChild("div", {
                className: "singleTab"
            });
            n.setHtml(d + " " + e.subEffectDescription[i])
        }
        return t
    }
    function r(e, t) {
        for (var i = 0; i < t.length; i++) {
            var n = t[i]
              , o = e.createChild("div", {
                className: "singleTab"
            });
            n.dbEffect.bonusType === -1 ? o.addClassNames("malus") : 1 === n.dbEffect.bonusType && o.addClassNames("bonus"),
            "string" == typeof n.description ? o.setHtml(d + " " + n.description) : o.appendChild(n.description)
        }
    }
    i(398);
    var l = i(399)
      , c = i(35).getText
      , u = i(26).inherits
      , h = i(190)
      , d = "&#149;";
    u(n, h),
    e.exports = n,
    n.prototype._renderDamageAndEffects = function(e, t) {
        for (var i = [], n = [], l = 0, u = e.length; l < u; l++) {
            var h = e[l];
            if (h) {
                var d = h.description;
                if (d && !h.hidden) {
                    var p = h.getDurationString();
                    p && (d += " (" + p + ")");
                    var m = h.monsterCount;
                    m && (d += m);
                    var f = h.isDamageEffect() ? i : n;
                    f.push({
                        dbEffect: h.effect,
                        description: d
                    }),
                    h.requiresInvocationDescription() && h.subEffectDescription && f.push({
                        dbEffect: h.effect,
                        description: s(h)
                    }),
                    o(h) && h.subEffectDescription && f.push({
                        dbEffect: h.effect,
                        description: a(h)
                    })
                }
            }
        }
        var g;
        i.length > 0 && (g = t ? c("ui.common.criticalDamages", 1) : c("ui.stats.damagesBonus", i.length),
        this.createChild("div", {
            className: "effectTitle",
            text: g + c("ui.common.colon")
        }),
        r(this, i)),
        n.length > 0 && (g = t ? c("ui.common.criticalEffects", 1) : c("ui.common.effects", n.length),
        this.createChild("div", {
            className: "effectTitle",
            text: g + c("ui.common.colon")
        }),
        r(this, n))
    }
    ,
    n.prototype.setEffectsFromItem = function(e, t) {
        var i;
        t = t || {},
        this.clearContent();
        var n, o = e.getItemInstance();
        n = t.showPossibleEffects || !o ? e.getItem() : o,
        i = l.getSortedEffectInstances(n),
        this._renderDamageAndEffects(i)
    }
    ,
    n.prototype.setEffectsFromSpell = function(e, t) {
        this.clearContent();
        var i, n, o, s = e.getSpellLevelId();
        for (i = [],
        n = 0,
        o = e.getEffectsIds(t).length; n < o; n++)
            i.push(e.effectInstances[s + "-effects-" + n]);
        for (this._renderDamageAndEffects(i),
        i = [],
        n = 0,
        o = e.getCriticalEffectsIds(t).length; n < o; n++)
            i.push(e.effectInstances[s + "-criticalEffect-" + n]);
        this._renderDamageAndEffects(i, !0)
    }
    ,
    n.prototype.setEffects = function(e) {
        this.clearContent(),
        this._renderDamageAndEffects(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        this.exoticEffects = {}
    }
    var o = i(224)
      , s = i(323).ItemInstance;
    n.prototype._getEffectInstances = function(e, t) {
        var i = t && t.effects
          , n = e.possibleEffects
          , o = i && i.length > 0
          , s = n && n.length > 0;
        if (o || s) {
            var a, r;
            if (t)
                a = i,
                r = !t.objectUID;
            else {
                if (!s)
                    return;
                a = n,
                r = !0
            }
            if (a = a.filter(function(e) {
                return e && e.effect && !e.isLivingProperty
            }),
            this.exoticEffects = {},
            !r && !e.hideEffects && e.enhanceable)
                for (var l = 0; l < a.length; l += 1) {
                    var c = a[l].effect;
                    if (c && c.showInSet && n) {
                        for (var u = !0, h = 0; h < n.length; h += 1)
                            if (c.id === n[h].effectId) {
                                u = !1;
                                break
                            }
                        this.exoticEffects[c.id] = u
                    }
                }
            return a
        }
    }
    ,
    n.prototype.sortEffects = function(e) {
        function t(e, t) {
            var i = e.effect
              , n = t.effect;
            return a.exoticEffects[i.id] ? -1 : a.exoticEffects[n.id] ? 1 : i.effectPriority - n.effectPriority
        }
        var i, n, s, a = this, r = e.sort(t), l = o.category, c = [l.damage, l.miscellaneous, l.resistance, l.special], u = {};
        for (i = 0; i < r.length; i += 1)
            if (s = r[i].effect,
            s.category !== l.undefined && 812 !== s.id) {
                var h = s.showInSet ? s.category : l.special;
                u[h] || (u[h] = []),
                u[h].push(r[i])
            }
        var d = [];
        for (i = 0; i < c.length; i += 1) {
            var p = u[c[i]];
            if (p)
                for (n = 0; n < p.length; n += 1) {
                    var m = p[n];
                    d.push(m)
                }
        }
        return d
    }
    ,
    n.prototype.getSortedEffectInstances = function(e) {
        var t = e instanceof s ? e : null
          , i = t && t.item || e
          , n = this._getEffectInstances(i, t);
        return n ? this.sortEffects(n) : []
    }
    ,
    e.exports = new n
}
, function(e, t, i) {
    function n(e, t) {
        return e > t ? 1 : t > e ? -1 : 0
    }
    function o(e) {
        return e[this.id]
    }
    function s(e) {
        return e
    }
    function a(e, t, i) {
        if (h.call(this, "div", {
            className: "TableV2"
        }),
        i = i || {},
        t)
            "function" == typeof t ? this.getIdFn = t : this.getIdFn = function(e) {
                return e[t]
            }
            ;
        else {
            var a = 0;
            this.getIdFn = function() {
                return a++
            }
        }
        this.cols = e,
        this._selectedRow = null ,
        this.colIndex = {};
        for (var r = 0, l = e.length; r < l; r += 1) {
            var c = e[r];
            this.colIndex[c.id] = r,
            c.format = c.format || c.getContent || o,
            c.sort && ("function" == typeof c.sort ? c.getContent = c.getContent || s : (c.sort = n,
            c.getContent = c.getContent || o),
            c.order = c.order || "ascending",
            c.defaultSorter && (this.defaultSorter = c,
            this.defaultOrder = c.order,
            this.sortBy = c))
        }
        this._clickable = i.clickable !== !1,
        i.noHeader || this._addHeader(),
        i.sorter && this.setSorter(i.sorter),
        this._onRowCreation = i.onRowCreation,
        this.scroller = this.appendChild(new f({
            className: "tableScroller"
        })),
        this.rows = this.scroller.content,
        this.rows.addClassNames("tableContent"),
        this._slidable = i.slidable,
        this._slidable && this._createSlideBackElement(),
        this.filters = [],
        this.placeholder = null
    }
    function r() {
        this.myTable._sortByColumn(this)
    }
    function l(e) {
        this.toggleClassName("disabled", !e)
    }
    i(401);
    var c = i(204)
      , u = i(318)
      , h = i(190)
      , d = i(32)
      , p = i(48)
      , m = i(26).inherits
      , f = i(302)
      , g = i(31)
      , _ = 26
      , v = 40
      , y = 100;
    m(a, h),
    e.exports = a,
    a.prototype._createSlideBackElement = function() {
        var e = this._slideBack = new h("div",{
            className: "slideBackElement"
        });
        e.setStyle("opacity", 0),
        e.appendChild(this._slidable),
        e.rowId = null ,
        e.side = "left",
        this.scroller.appendChild(e)
    }
    ,
    a.prototype.setColumnHeader = function(e, t) {
        var i = this.header.row.getChild(e);
        return i ? ("string" == typeof t ? i.content.setText(t) : (i.content.clearContent(),
        i.content.appendChild(t)),
        void i.sorter.toggleClassName("noText", !t)) : console.error("setColumnHeader: invalid colId:", e)
    }
    ,
    a.prototype.setSortingHintVisible = function(e, t) {
        var i = this.header.row.getChild(e);
        return i ? void i.sorter.toggleClassName("noTriangle", !!t) : console.error("setSortingHintVisible: invalid colId:", e)
    }
    ,
    a.prototype._addHeader = function() {
        this.header = this.createChild("div", {
            className: "tableHeader"
        });
        for (var e = this.header.row = this.header.createChild("div", {
            className: "row"
        }), t = 0, i = this.cols.length; t < i; t += 1) {
            var n, o = this.cols[t];
            o.sort ? (n = e.appendChild(new c({
                className: ["col", o.id],
                name: o.id
            },r)),
            n.myTable = this) : n = e.createChild("div", {
                className: ["col", o.id]
            }),
            e[o.id] = n,
            (o.header || o.sort) && (n.content = n.createChild("div", {
                className: "headerContent"
            }),
            o.header instanceof h ? n.content.appendChild(o.header) : n.content.setText(o.header || ""),
            o.sort && (n.addClassNames(o.order),
            n.sorter = n.createChild("div", {
                className: "sortBtn"
            }),
            this._toggleTriangle(n, !!o.defaultSorter),
            n.sortBy = o,
            o.header || n.sorter.addClassNames("noText")))
        }
    }
    ,
    a.prototype.setContentLoading = function(e) {
        this.scroller.toggleClassName("spinner", e)
    }
    ,
    a.prototype.setPlaceholderText = function(e) {
        if (!this.placeholder) {
            if (!e)
                return;
            this.placeholder = new u(this,{
                headerElement: this.header
            })
        }
        this.placeholder.setText(e)
    }
    ,
    a.prototype._toggleTriangle = function(e, t) {
        e.toggleClassName("showingTriangle", t)
    }
    ,
    a.prototype._hideCurrentTriangle = function() {
        var e = this.sortBy;
        e && e.id && this._toggleTriangle(this.header.row[e.id], !1)
    }
    ,
    a.prototype.setSorter = function(e, t) {
        this._hideCurrentTriangle(),
        this.sortBy = {
            order: t || "ascending",
            sort: e,
            getContent: s
        }
    }
    ,
    a.prototype._sortByColumn = function(e, t) {
        this.sortBy !== e.sortBy || t ? (this._hideCurrentTriangle(),
        this.sortBy = e.sortBy,
        this._toggleTriangle(e, !0)) : t = "ascending" === e.sortBy.order ? "descending" : "ascending",
        t && (e.sortBy.order = t,
        e.toggleClassName("descending", "descending" === t)),
        this.scroller.removeChild(this.rows),
        this.sort(),
        this.scroller.appendChild(this.rows)
    }
    ,
    a.prototype.resetSort = function() {
        if (this.defaultSorter) {
            var e = this.header.row[this.defaultSorter.id];
            this._sortByColumn(e, this.defaultOrder)
        }
    }
    ,
    a.prototype.sort = function(e, t) {
        if (e && this.setSorter(e, t),
        this.sortBy) {
            var i = this.sortBy
              , n = "ascending" === i.order ? 1 : -1;
            e = function(e, t) {
                return i.sort(i.getContent(e.rowContent), i.getContent(t.rowContent)) * n
            }
        }
        var o = this.rows.getChildren();
        e && o.sort(e);
        for (var s = !0, a = 0, r = o.length; a < r; a += 1) {
            var l = o[a];
            e && this.rows.appendChild(l),
            l.isVisible() && (l.toggleClassName("odd", s),
            s = !s)
        }
    }
    ,
    a.prototype._insertRowInRightPosition = function(e) {
        var t, i, n, o = this.sortBy;
        o && (t = o.sort,
        i = "ascending" === o.order ? 1 : -1),
        t && (n = o.getContent(e.rowContent));
        for (var s = !1, a = !1, r = !0, l = this.rows.getChildren(), c = 0, u = l.length; c < u; c += 1) {
            var h = l[c];
            if (h === e) {
                if (t)
                    continue;
                s = !0
            }
            !a && t && t(n, o.getContent(h.rowContent)) * i < 0 && (e.insertBefore(h),
            a = !0,
            e.isVisible() && (e.toggleClassName("odd", r),
            r = !r)),
            h.isVisible() && (h.toggleClassName("odd", r),
            r = !r)
        }
        a || s || (this.rows.appendChild(e),
        e.toggleClassName("odd", r))
    }
    ,
    a.prototype.findRow = function(e, t) {
        for (var i = this.rows.getChildren(), n = 0, o = i.length; n < o; n += 1) {
            var s = i[n];
            if (e.call(this, s.rowContent, t))
                return s.rowId
        }
        return null
    }
    ,
    a.prototype.filter = function(e) {
        var t = this.rows.getChildren()
          , i = !0;
        e = e || this._shouldDisplayRow;
        for (var n = 0, o = t.length; n < o; n += 1) {
            var s = t[n]
              , a = e.call(this, s.rowContent);
            s.toggleDisplay(a),
            a && (g.cancelTween(s) && s.setStyle("webkitTransform", null ),
            s.toggleClassName("odd", i),
            i = !i)
        }
        this.scroller.refresh()
    }
    ,
    a.prototype.addFilter = function(e) {
        this.filters.push(e)
    }
    ,
    a.prototype.removeFilter = function(e) {
        var t = this.filters.indexOf(e);
        t !== -1 && this.filters.splice(t, 1)
    }
    ,
    a.prototype._shouldDisplayRow = function(e) {
        for (var t = 0, i = this.filters.length; t < i; t += 1)
            if (!this.filters[t](e))
                return !1;
        return !0
    }
    ,
    a.prototype.hasRow = function(e) {
        return !!this.rows.getChild(e)
    }
    ,
    a.prototype.unSelectRow = function() {
        this._selectedRow && this._selectedRow.delClassNames("selected"),
        this._selectedRow = null
    }
    ,
    a.prototype.selectRow = function(e, t) {
        var i = this.rows.getChild(e);
        return this._selectedRow !== i && (this.unSelectRow(),
        i.addClassNames("selected"),
        this._selectedRow = i),
        t || this.emit("rowTap", i, i.rowContent),
        i
    }
    ,
    a.prototype.scrollToSelectedRow = function() {
        this._selectedRow && this.scroller.scrollToElement(this._selectedRow)
    }
    ,
    a.prototype.selectFirstRow = function(e) {
        var t = this.rows.getChildren()[0];
        t && this.selectRow(t.rowId, e)
    }
    ,
    a.prototype.endSlide = function(e) {
        this._slideBack.rowId === e && (this._slideBack.setStyle("opacity", 0),
        this._slideBack.row.slideBack())
    }
    ,
    a.prototype.setSlideEnable = function(e) {
        this._slideLock = !e
    }
    ,
    a.prototype._addSlideBehavior = function(e) {
        p(e, "x");
        var t, i, n, o = this, s = this._slideBack, a = e.rootElement;
        e.on("slideStart", function(i, r) {
            o._slideLock || (null !== s.rowId && o.endSlide(s.rowId),
            s.rowId = e.rowId,
            s.row = e,
            s.setStyles({
                height: r.height + "px",
                webkitTransform: "translate3d(0," + (a.offsetTop + o.scroller.iScroll.y) + "px,0)"
            }),
            t = i.x,
            n = r.width / 2)
        }),
        e.on("slide", function(e) {
            o._slideLock || (i = e.x - t,
            i > n ? i = n : i < -n && (i = -n),
            s.setStyle("opacity", Math.abs(i) / n),
            this.setStyle("webkitTransform", "translate3d(" + i + "px,0,0)"))
        }),
        e.slideBack = function(t) {
            s.rowId = null ,
            g.tween(e, {
                webkitTransform: "translate3d(0,0,0)"
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                s.setStyle("opacity", 0),
                s.delClassNames("spinner", s.side),
                t && t()
            })
        }
        ,
        e.on("slideEnd", function(t, a, r) {
            o._slideLock || (Math.abs(i) >= n || r ? i > 0 ? (s.side = "left",
            s.addClassNames("spinner", "left"),
            o.emit("rowSlidedLeft", e, e.rowContent)) : (s.side = "right",
            s.addClassNames("spinner", "right"),
            o.emit("rowSlidedRight", e, e.rowContent)) : e.slideBack())
        })
    }
    ,
    a.prototype._createRow = function(e, t, i) {
        t = void 0 !== t ? t : this.getIdFn(e);
        var n = this
          , o = this.rows.appendChild(new h("div",{
            className: "row",
            name: t
        }));
        this._slidable && this._addSlideBehavior(o),
        i && o.setStyle("webkitTransform", "translate3d(100%,0,0)"),
        o.rowId = t,
        o.rowContent = e;
        for (var s = 0, a = this.cols.length; s < a; s += 1) {
            var r = this.cols[s]
              , c = o[r.id] = o.createChild("div", {
                className: ["col", r.id]
            })
              , u = r.format(e, o);
            u instanceof h ? (c.content = u,
            c.appendChild(u)) : (c.content = c,
            c.setText(u))
        }
        return this._clickable && (d(o),
        o.on("enable", l),
        o.on("tap", function() {
            n.selectRow(t)
        })),
        this._onRowCreation && this._onRowCreation(o, e),
        o.toggleDisplay(this._shouldDisplayRow(e)),
        this.emit("rowAdded", t, e, o),
        o
    }
    ,
    a.prototype.addRow = function(e, t, i) {
        var n = this._createRow(e, t, i);
        return this._insertRowInRightPosition(n),
        this.scroller.refresh(),
        this.scroller.scrollToElement(n),
        i ? g.tween(n, {
            webkitTransform: "translate3d(0,0,0)"
        }, {
            time: y,
            easing: "ease-out"
        }) : n.setStyle("webkitTransform", null ),
        n
    }
    ,
    a.prototype._playAnimationForNewRows = function(e) {
        for (var t, i = this.rows.getChildren(), n = 0, o = _ / 2, s = 0; s < i.length; s++) {
            var a = i[s];
            if (e[a.rowId])
                if (n >= _ || !a.isVisible())
                    a.setStyle("webkitTransform", null );
                else {
                    0 === n && (t = a);
                    var r = (o - Math.abs(n - o)) * v;
                    n++,
                    g.tween(a, {
                        webkitTransform: "translate3d(0,0,0)"
                    }, {
                        time: y,
                        easing: "ease-out",
                        delay: r
                    })
                }
        }
        t && this.scroller.scrollToElement(t)
    }
    ,
    a.prototype.addList = function(e, t, i) {
        if (this.scroller.removeChild(this.rows),
        e.length && this.setPlaceholderText(""),
        i)
            for (var n = 0; n < e.length; n++) {
                var o = this.getIdFn(e[n]);
                this.hasRow(o) && this.delRow(o, !1)
            }
        var s, a, r, l = {};
        for (a = 0,
        r = e.length; a < r; a += 1)
            s = this._createRow(e[a], void 0, t),
            l[s.rowId] = s;
        this.sort(),
        this.scroller.appendChild(this.rows),
        this.scroller.refresh(),
        t && this._playAnimationForNewRows(l)
    }
    ,
    a.prototype.addMap = function(e, t) {
        this.scroller.removeChild(this.rows);
        var i = {};
        for (var n in e) {
            var o = this._createRow(e[n], n, t);
            i[o.rowId] = o
        }
        this.sort(),
        this.scroller.appendChild(this.rows),
        this.scroller.refresh(),
        t && this._playAnimationForNewRows(i)
    }
    ,
    a.prototype._updateRow = function(e, t) {
        t = void 0 !== t ? t : this.getIdFn(e);
        var i = this.rows.getChild(t);
        if (!i)
            return this.addRow(e, t);
        i.rowContent = e;
        for (var n = 0, o = this.cols.length; n < o; n += 1) {
            var s = this.cols[n]
              , a = i[s.id];
            a.clearContent();
            var r = s.format(e);
            r instanceof h ? (a.content = r,
            a.appendChild(r)) : (a.content = a,
            a.setText(r))
        }
        return i.toggleDisplay(this._shouldDisplayRow(e)),
        i
    }
    ,
    a.prototype.refreshRows = function() {
        for (var e = this.rows.getChildren(), t = 0; t < e.length; t++) {
            var i = e[t];
            this._updateRow(i.rowContent, i.rowId)
        }
    }
    ,
    a.prototype.updateRows = function(e) {
        for (var t = 0, i = e.length; t < i; t += 1)
            this._updateRow(e[t]);
        this.sort()
    }
    ,
    a.prototype.updateRow = function(e, t) {
        var i = this._updateRow(e, t);
        return this._insertRowInRightPosition(i),
        i
    }
    ,
    a.prototype.getRow = function(e) {
        return this.rows.getChild(e)
    }
    ,
    a.prototype.updateCell = function(e, t, i) {
        var n = this.rows.getChild(e);
        if (!n)
            return console.error(new Error("Row id unknown: " + e));
        var o = n[t];
        if (!o)
            return console.error(new Error("Column id unknown: " + t));
        var s = this.cols[this.colIndex[t]];
        n.rowContent = i,
        o.clearContent();
        var a = s.format(i);
        return a instanceof h ? o.appendChild(a) : o.setText(a),
        n.toggleDisplay(this._shouldDisplayRow(i)),
        this.sortBy === s && this._insertRowInRightPosition(n),
        n
    }
    ,
    a.prototype.getCell = function(e, t) {
        var i = this.rows.getChild(e);
        if (!i)
            return console.error(new Error("Row id unknown " + e));
        var n = i[t];
        return n ? n.content : console.error(new Error("Column id unknown " + t))
    }
    ,
    a.prototype._delRow = function(e) {
        var t = this.rows.getChild(e);
        t && (this._selectedRow === t && (this._selectedRow = null ),
        this.emit("rowDeleted", e, t.rowContent, t),
        t.destroy())
    }
    ,
    a.prototype.delRow = function(e, t) {
        function i() {
            o._delRow(e),
            o._updateRowColor(),
            o.scroller.refresh()
        }
        var n = this.rows.getChild(e);
        if (n) {
            var o = this;
            return t ? void g.tween(n, {
                webkitTransform: "translate3d(-100%,0,0)"
            }, {
                time: y,
                easing: "ease-out"
            }, i) : i()
        }
    }
    ,
    a.prototype.delRows = function(e, t, i) {
        function n() {
            for (var t = 0, n = e.length; t < n; t += 1)
                o._delRow(e[t]);
            o._updateRowColor(),
            o.scroller.refresh(),
            i && i.call(o)
        }
        var o = this;
        if (!e.length || !t)
            return n();
        for (var s = 0, a = e.length; s < a; s += 1) {
            var r = this.rows.getChild(e[s]);
            if (r) {
                var l = s === a - 1 ? n : null ;
                g.tween(r, {
                    webkitTransform: "translate3d(-100%,0,0)"
                }, {
                    time: y,
                    easing: "ease-out",
                    delay: s * v
                }, l)
            }
        }
    }
    ,
    a.prototype.clearContent = function() {
        this.rows.clearContent(),
        this._selectedRow = null ,
        this.scroller.refresh()
    }
    ,
    a.prototype.getRowCount = function() {
        return this.rows.getChildCount()
    }
    ,
    a.prototype._updateRowColor = function() {
        for (var e = !0, t = this.rows.getChildren(), i = 0, n = t.length; i < n; i += 1) {
            var o = t[i];
            o.isVisible() && (o.toggleClassName("odd", e),
            e = !e)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        d.close(this.myWindow.id)
    }
    function o() {
        window.clearTimeout(this.freeContentTimeout),
        this.openingSound && p(this.openingSound || "WINDOW_OPEN"),
        this.isReadyForUserInteraction = !0
    }
    function s() {
        this.isReadyForUserInteraction && this.emit("contentReady")
    }
    function a() {
        if ("number" == typeof this.freeContentDelay || "function" == typeof this.freeContent) {
            if ("function" != typeof this.freeContent)
                return console.error("missing freeContent method for", this.id);
            this.freeContentTimeout = window.setTimeout(this.freeContent.bind(this), this.freeContentDelay || 0)
        }
        this.closingSound && p(this.closingSound || "WINDOW_CLOSE")
    }
    function r(e) {
        e = e || {},
        c.call(this, "div", {
            className: "window",
            hidden: !0
        }),
        this.addClassNames(e.className),
        this.positionInfo = e.positionInfo,
        this.freeContentDelay = e.freeContentDelay,
        this.freeContentTimeout = null ,
        this.position = null ,
        this.openState = !1,
        this.isReadyForUserInteraction = !1,
        this.createChild("div", {
            className: "windowBorder"
        }),
        this.windowContent = this.createChild("div", {
            className: "windowContent"
        }),
        this.header = this.windowHeadWrapper = this.windowContent.createChild("div", {
            className: "windowHeadWrapper"
        }),
        e.plusButton && (this.plusButton = this.windowHeadWrapper.appendChild(new u({
            className: "plusButton",
            scaleOnPress: !0
        })),
        this.plusButton.myWindow = this),
        e.minusButton && (this.minusButton = this.windowHeadWrapper.appendChild(new u({
            className: "minusButton",
            scaleOnPress: !0
        })),
        this.minusButton.myWindow = this),
        e.noTitle || (this.windowTitle = this.windowHeadWrapper.createChild("div", {
            className: "windowTitle"
        }),
        this.windowTitle.setText(e.title || "")),
        e.noCloseButton || (this.closeButton = this.windowHeadWrapper.appendChild(new h({
            scaleOnPress: !0
        })),
        this.closeButton.myWindow = this,
        e.customClose || this.closeButton.on("tap", n)),
        this.openingSound = e.openingSound,
        this.closingSound = e.closingSound,
        this.windowBodyWrapper = this.windowContent.createChild("div", {
            className: "windowBodyWrapper"
        }),
        this.windowBody = this.windowBodyWrapper.createChild("div", {
            className: "windowBody"
        }),
        this.on("open", o),
        this.on("opened", s),
        this.on("close", a)
    }
    i(403);
    var l = i(26).inherits
      , c = i(190)
      , u = i(204)
      , h = i(404)
      , d = i(22)
      , p = i(84).playUiSound;
    l(r, c),
    e.exports = r,
    r.prototype.startWaitingForContent = function() {
        this.isReadyForUserInteraction = !1
    }
    ,
    r.prototype.finishedWaitingForContent = function() {
        this.isReadyForUserInteraction = !0,
        this.emit("contentReady")
    }
    ,
    r.prototype.setTitle = function(e) {
        this.windowTitle.setText(e)
    }
    ,
    r.prototype.localizeEvent = function(e) {
        var t = this;
        return function() {
            t.openState && e.apply(this, arguments)
        }
    }
    ,
    r.prototype.close = function(e) {
        d.close(this.id, e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        e = e || {};
        var i = {
            className: "closeButton",
            sound: "CANCEL_BUTTON"
        };
        for (var n in i)
            void 0 === e[n] && (e[n] = i[n]);
        s.call(this, e, t)
    }
    var o = i(26).inherits
      , s = i(204);
    o(n, s),
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        u.call(this, "div", {
            className: "searchBox"
        }),
        e = e || {},
        this.maxLength = e.maxLength || 50,
        this._createContent()
    }
    function o() {
        this.mySearchBox.cancelBtn.show()
    }
    function s() {
        var e = this.mySearchBox;
        e.emit("search", e.searchInput.getValue())
    }
    function a() {
        var e = this.mySearchBox;
        e.cancelBtn.hide(),
        e.clear(),
        e.searchInput.blur(),
        e.emit("cancel")
    }
    i(406);
    var r = i(204)
      , l = i(26).inherits
      , c = i(391)
      , u = i(190);
    l(n, u),
    e.exports = n,
    n.prototype.clear = function() {
        this.searchInput.setValue(""),
        this.cancelBtn.hide()
    }
    ,
    n.prototype.setValue = function(e) {
        this.searchInput.setValue(e),
        this.cancelBtn.toggleDisplay("string" == typeof e && "" !== e)
    }
    ,
    n.prototype._createContent = function() {
        var e = this.createChild("div", {
            className: "inputFrame"
        })
          , t = this.searchInput = e.appendChild(new c({
            attr: {
                maxLength: this.maxLength
            }
        }));
        t.mySearchBox = this,
        t.on("change", o),
        t.on("validate", s);
        var i = this.cancelBtn = e.appendChild(new r({
            className: "cancelBtn",
            addIcon: !0,
            hidden: !0
        },a));
        i.mySearchBox = this;
        var n = this.appendChild(new r({
            className: "searchBtn",
            addIcon: !0
        },s));
        n.mySearchBox = this
    }
    ,
    n.prototype.showAsSearching = function(e) {
        this.toggleClassName("spinner", e),
        this.searchInput.setEnable(!e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e, t, i, n, o, c, u;
        this.worldMapTooltip = new l,
        this.once("open", function() {
            this.header.setText(a("ui.cartography.title"));
            var s = r.getWindow("worldMap")
              , l = window.gui.GPS;
            this.worldMapTooltip.addClassNames("worldMapTooltip"),
            this.entryList.appendChild(this.worldMapTooltip),
            this._addSeparator(),
            e = this._addEntry(a("ui.common.teleport"), function() {
                window.dofus.sendMessage("AdminQuietCommandMessage", {
                    content: "move * " + u.i + "," + u.j
                }),
                s.isFullScreen && r.close("worldMap")
            }),
            o = this._addEntry(a("ui.map.flag"), function() {
                l.addCustomFlag(u.i, u.j)
            }),
            c = this._addEntry(a("ui.common.remove"), function() {
                l.removeCustomFlag(u.i, u.j)
            }),
            t = this._addEntry(a("ui.common.remove") + " [" + a("ui.zaap.zaap") + "]", function() {
                l.removePOI(this.flagId)
            }),
            i = this._addEntry(a("ui.common.remove") + " [" + a("ui.common.quests") + "]", function() {
                l.removePOI(this.flagId)
            }),
            n = this._addEntry(a("ui.common.remove") + " [" + a("ui.map.flagDefaultName") + "]", function() {
                l.removePOI(this.flagId)
            }),
            this._addCancel()
        }),
        this.on("open", function(s, a) {
            u = s,
            o.show(),
            c.hide(),
            i.hide(),
            t.hide(),
            n.hide();
            var r = s.icons;
            if (r)
                for (var l = 0, h = r.length; l < h; l += 1) {
                    var d = r[l];
                    "customFlag" === d.categoryId ? (c.show(),
                    o.hide()) : "questObjective" === d.categoryId ? (i.flagId = d.id,
                    i.show()) : "zaap" === d.categoryId ? (t.flagId = d.id,
                    t.show()) : "hint" === d.categoryId && (n.flagId = d.id,
                    n.show())
                }
            e.toggleDisplay(window.gui.playerData.isModeratorOrMore()),
            a()
        })
    }
    i(408);
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText
      , r = i(22)
      , l = i(409);
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        l.call(this, "div", {
            className: "WorldMapIcon"
        });
        var i = e.dimensions
          , n = Math.min(i.h, 30)
          , o = Math.floor(i.w * n / i.h)
          , s = this.createChild("canvas", {
            className: "icon"
        });
        s.rootElement.width = o,
        s.rootElement.height = n,
        s.setStyle("minWidth", o + "px");
        var a = s.rootElement.getContext("2d");
        a.drawImage(t, i.sx, i.sy, i.sw, i.sh, 0, 0, o, n),
        e.infoData.nameIdOverRideFunc ? this.createChild("div", {
            className: "description",
            text: e.infoData.nameIdOverRideFunc()
        }) : this.createChild("div", {
            className: "description",
            text: e.infoData.nameId.replace("\\n ", "\n")
        })
    }
    function o() {
        l.call(this, "div", {
            className: "WorldMapTooltip"
        }),
        this.coordinates = this.createChild("div"),
        this.subAreaName = this.createChild("div"),
        this.subArea = this.createChild("div", {
            className: "subArea"
        }),
        this.level = this.subArea.createChild("div"),
        this.alliance = this.subArea.createChild("div", {
            className: "alliance"
        }),
        this.allianceEmblem = this.alliance.appendChild(new s({
            width: 28,
            height: 28
        })),
        this.allianceName = this.alliance.createChild("div"),
        this.icons = this.createChild("div", {
            className: "icons"
        })
    }
    var s = i(289)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(190);
    r(n, l),
    r(o, l),
    e.exports = o,
    o.prototype.setCoordinates = function(e, t) {
        this.coordinates.setText(a("ui.common.coordinatesSmall") + " " + e + "," + t)
    }
    ,
    o.prototype.displayIcons = function() {
        this.icons.show(),
        this.subArea.hide()
    }
    ,
    o.prototype.setIcons = function(e, t) {
        this._icons = e,
        this.icons.clearContent();
        for (var i = 0, o = e.length; i < o; i += 1)
            this.icons.appendChild(new n(e[i],t))
    }
    ,
    o.prototype.unsetAlliance = function() {
        this.alliance.hide()
    }
    ,
    o.prototype.setAlliance = function(e) {
        this.allianceName.setText(e.allianceName + " [" + e.allianceTag + "]"),
        this.allianceEmblem.setValue(e.allianceEmblem, !0),
        this.alliance.show()
    }
    ,
    o.prototype.unsetSubArea = function() {
        this.subAreaName.hide()
    }
    ,
    o.prototype.displayCoordinates = function() {
        this.subAreaName.hide(),
        this.icons.hide(),
        this.subArea.hide()
    }
    ,
    o.prototype.setSubArea = function(e) {
        this.subAreaName.setText(e.nameId),
        this.level.setText(a("ui.common.averageLevel") + " " + e.level),
        this.subAreaName.show()
    }
    ,
    o.prototype.displaySubArea = function() {
        this.icons.hide(),
        this.subArea.show()
    }
}
, function(e, t, i) {
    function n() {
        var e = this;
        s.call(this, {
            className: "ContextualMenuMonster"
        }),
        this.monsterId = null ,
        this.attack = null ,
        this.once("open", function() {
            this._setupDom()
        }),
        this.on("open", function(t, i) {
            this.monsterId = t.contextualId,
            this.starCounter.setValue(t.ageBonus),
            this.monstersList.clearContent();
            var n, o = this.monstersList.createChild("div", {
                className: "willFightContainer"
            }), s = this.monstersList.createChild("div", {
                className: "willNotFightContainer"
            }), a = [t.staticInfos.mainCreatureLightInfos].concat(t.staticInfos.underlings), c = t.staticInfos.alternatives, u = null , h = [];
            if (c) {
                for (var d = window.gui.playerData.partyData, p = d.partyTypes[l.PARTY_TYPE_CLASSICAL].members, m = Object.keys(p).length + 1, f = 0; c[f] && c[f].playerCount <= m; )
                    u = c[f],
                    f += 1;
                for (n = 0; n < u.monsters.length; n += 1)
                    h.push(u.monsters[n].creatureGenericId)
            }
            var g = a.sort(function(e, t) {
                return t.staticInfos.level - e.staticInfos.level
            })
              , _ = 0;
            for (n = 0; n < g.length; n += 1) {
                var v = g[n]
                  , y = v.staticInfos
                  , w = v.creatureGenericId
                  , b = !0;
                if (c) {
                    b = !1;
                    var C = h.indexOf(w);
                    C !== -1 && (b = !0,
                    h.splice(C, 1))
                }
                b && (_ += y.level);
                var I = y.nameId + " (" + y.level + ")"
                  , T = b ? o : s
                  , S = y.isMiniBoss ? ["monsterName", "miniBoss"] : "monsterName";
                T.createChild("div", {
                    className: S,
                    text: I
                })
            }
            e.level.setText(r("ui.common.rank", _)),
            e.attack.setEnable(!window.gui.playerData.getRestrictions().cantAttackMonster),
            i()
        })
    }
    i(411);
    var o = i(26).inherits
      , s = i(299)
      , a = i(284)
      , r = i(35).getText
      , l = i(412);
    o(n, s),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this
          , t = this.header.createChild("div", {
            className: "monsterInfosContainer"
        });
        this.level = t.createChild("div", {
            className: "level"
        }),
        this.starCounter = t.appendChild(new a),
        this.starCounter.on("shopOpened", function() {
            e.close()
        }),
        this.xp = t.createChild("div", {
            className: "xp"
        }),
        this.monstersList = this.entryList.createChild("div", {
            className: "monstersList"
        }),
        this.attack = this._addEntry(r("ui.common.attack"), function() {
            e.monsterId && window.isoEngine.attackActor(e.monsterId),
            e.close()
        }),
        this._addCancel()
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        PARTY_TYPE_UNDEFINED: 0,
        PARTY_TYPE_CLASSICAL: 1,
        PARTY_TYPE_DUNGEON: 2,
        PARTY_TYPE_ARENA: 3
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        switch (n) {
        case 2:
        case 4:
            l.getWindow("tradeWithNPC").prepareExchange(e.nameId);
            break;
        case 3:
            window.gui.npcDialogHandler.prepareDialog(e)
        }
        if (window.foreground.lock("npcActionRequest"),
        window.dofus.sendMessage("NpcGenericActionRequestMessage", {
            npcId: t,
            npcActionId: n,
            npcMapId: i
        }),
        9 === n || 10 === n) {
            var o = window.foreground
              , s = window.gui
              , a = 9 === n ? "HouseToSellListMessage" : "PaddockToSellListMessage"
              , r = setTimeout(function() {
                console.error(new Error(a + " not received: timeout triggered to unlock the character")),
                o.unlock("npcActionRequest"),
                s.removeListener(a, c)
            }, 5e3)
              , c = function() {
                o.unlock("npcActionRequest"),
                clearTimeout(r)
            };
            window.gui.once(a, c)
        }
    }
    function o() {
        a.call(this);
        var e = this;
        this.once("open", function() {
            this._setupDom()
        }),
        this.on("open", function(t, i) {
            function o() {
                n(s, a, l, this.npcActionId),
                e.close()
            }
            var s = t.npcData
              , a = t.actorId
              , l = t.mapId;
            this.header.setText(s.nameId),
            this.actionsContainer.clearContent();
            for (var c = window.gui.playerData.isAlive(), u = 0, h = s.actions.length; u < h; u++) {
                var d = this.actionsContainer.appendChild(new r({
                    text: s.actionsName[u],
                    className: "cmButton",
                    disable: !c
                },o));
                d.npcActionId = s.actions[u]
            }
            i()
        })
    }
    var s = i(26).inherits
      , a = i(299)
      , r = i(204)
      , l = i(22);
    s(o, a),
    e.exports = o,
    o.npcActionRequest = n,
    o.prototype._setupDom = function() {
        var e = this.entryList.createChild("div");
        this.actionsContainer = e.createChild("div"),
        this._addCancel()
    }
}
, function(e, t, i) {
    function n() {
        o.call(this);
        var e;
        this.once("open", function() {
            e = this.header.appendChild(new s);
            var t = this._addEntry(a("ui.common.ankaboxMessage"), function() {});
            t.disable(),
            this._addCancel()
        }),
        this.on("open", function(t, i) {
            if (void 0 === t.hoursSinceLastConnection)
                e.setContent({
                    name: t.playerName
                });
            else {
                var n = Math.floor(t.hoursSinceLastConnection)
                  , o = Math.floor(n / 720)
                  , s = Math.floor((n - 720 * o) / 24)
                  , r = "";
                r = o > 0 ? s > 0 ? a("ui.social.monthsAndDaysSinceLastConnection", o, s) : a("ui.social.monthsSinceLastConnection", o) : s > 0 ? a("ui.social.daysSinceLastConnection", s) : n > 0 ? a("tablet.ui.social.hoursSinceLastConnection", n) : a("tablet.ui.social.lessThanOneHour"),
                e.setContent({
                    name: t.playerName + "\n" + a("ui.social.lastConnection", r)
                })
            }
            i()
        })
    }
    var o = i(299)
      , s = i(307)
      , a = i(35).getText
      , r = i(26).inherits;
    r(n, o),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.partyId = !1,
        this.isLoyal = !1,
        this.once("open", function() {
            this._setupDom()
        }),
        this.on("open", function(e, t) {
            this.partyId = e.partyId,
            this.isLoyal = e.isLoyal,
            this.loyalMsg.toggleClassName("ticked", e.isLoyal),
            e.partyType === r.PARTY_TYPE_ARENA ? this.restrictedMsg.hide() : (this.restrictedMsg.show(),
            this.restrictedMsg.setEnable(e.isLeader),
            this.restrictedMsg.toggleClassName("ticked", e.isRestricted)),
            t()
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText
      , r = i(412)
      , l = i(219);
    o(n, s),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this;
        this.header.setText(a("ui.common.options")),
        this.restrictedMsg = this._addEntry(a("ui.party.lockFight"), function() {
            window.dofus.sendMessage("GameFightOptionToggleMessage", {
                option: l.FIGHT_OPTION_SET_TO_PARTY_ONLY
            })
        }),
        this.loyalMsg = this._addEntry(a("ui.party.refuseOtherInvitations"), function() {
            window.dofus.sendMessage("PartyPledgeLoyaltyRequestMessage", {
                partyId: e.partyId,
                loyal: !e.isLoyal
            })
        }),
        this._addCancel()
    }
}
, function(e, t, i) {
    function n() {
        a.call(this);
        var e, t;
        this.once("open", function() {
            var i = this
              , n = this.header.appendChild(new o);
            e = this.entryList.appendChild(new r(n)),
            e.on("close", function() {
                i.close()
            }),
            t = this.entryList.appendChild(new l(n)),
            t.on("close", function() {
                i.close()
            }),
            this._addCancel()
        }),
        this.on("open", function(i, n) {
            var o = i.playerId === window.gui.playerData.id;
            o ? t.updateContent(i) : e.updateContent(i),
            t.toggleDisplay(o),
            e.toggleDisplay(!o),
            n()
        })
    }
    var o = i(307)
      , s = i(26).inherits
      , a = i(299)
      , r = i(417)
      , l = i(419);
    s(n, a),
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        T.call(this, "div", {
            className: "ContextualMenuPlayerContent"
        });
        var t = this.createChild("div");
        this.banner = e,
        this._setupGroup1(t),
        this._setupGroup2(t),
        this._setupGroup3(t),
        this._setupGroup4(t),
        this._setupGroup5(t),
        this._setupGroup6(t),
        this._setupAdmin(t)
    }
    function o(e) {
        return e === I.AvA_ENABLED_AGGRESSABLE || e === I.AvA_PREQUALIFIED_AGGRESSABLE
    }
    function s(e) {
        return e ? 0 !== (e.capabilities & D) : (console.warn("isAggressionAllowedOnMap called before we know mapPosition"),
        !1)
    }
    function a(e, t, i) {
        var n = window.gui.playerData;
        if (!s(n.position.mapPosition))
            return R;
        if (n.isMutant())
            return n.getRestrictions().cantAttack || i ? O : P;
        if (i)
            return P;
        var a = 1 === window.gui.serversData.settings.serverGameType
          , r = n.alliance.current
          , l = x.entities.prism[n.position.subAreaId]
          , c = l && l.prism
          , h = c && c.mapId !== -1
          , d = n.characters.mainCharacter.characteristics.alignmentInfos
          , p = o(d.aggressable)
          , f = !1;
        if (h) {
            var g = c.state === C.PRISM_STATE_VULNERABLE;
            if (a) {
                if (r && !p && (c.alliance.allianceId !== r.allianceId || d.aggressable !== I.AvA_ENABLED_NON_AGGRESSABLE))
                    return R
            } else if (g) {
                if (r && (!p || !t))
                    return R
            } else
                f = !0;
            if (!f) {
                if (!r)
                    return R;
                if (t && (a || g)) {
                    if (t.aggressable === I.AvA_DISQUALIFIED)
                        return O;
                    if (!o(t.aggressable) || r.allianceId === t.allianceInformations.allianceId || a && c.alliance.allianceId === t.allianceInformations.allianceId && !g)
                        return R
                }
            }
            m = !0
        }
        if (a) {
            if (!h) {
                if (r && t) {
                    if (r.allianceId === t.allianceInformations.allianceId || !p || !o(t.aggressable))
                        return R
                } else if (!r || p)
                    return R;
                m = !0
            }
        } else if (!h || f) {
            if (!d || !e || d.aggressable !== I.PvP_ENABLED_AGGRESSABLE || e.alignmentSide <= E.ALIGNMENT_NEUTRAL || 0 === e.alignmentGrade || d.alignmentSide !== E.ALIGNMENT_MERCENARY && d.alignmentSide === e.alignmentSide || d.alignmentSide === E.ALIGNMENT_NEUTRAL)
                return R;
            m = !1
        }
        var _ = n.characterBaseInformations.level;
        if (a && _ < 50)
            return O;
        var v = m ? 100 : 50;
        return _ + v < e.characterPower - u ? R : P
    }
    var r, l, c, u, h, d, p, m, f, g = i(26).inherits, _ = i(35).getText, v = i(204), y = i(412), w = i(339).GuildRightsBitEnum, b = i(418), C = i(346), I = i(335), T = i(190), S = i(22), A = i(85), E = i(292), x = i(336), M = i(217).FIGHT_STATES, N = !1, R = -1, O = 0, P = 1, D = 2;
    g(n, T),
    e.exports = n,
    n.prototype.updateContent = function(e) {
        function t(e) {
            switch (e._type) {
            case "HumanOptionAlliance":
                s = e;
                break;
            case "HumanOptionGuild":
                o = e.guildInformations
            }
        }
        p = e.interactiveElements,
        c = e.accountId,
        u = e.playerId,
        h = e.playerName,
        d = e.cellId;
        var i = e.humanoidInfoOptions
          , n = e.alignmentInfos;
        this.admin.hide();
        var o = null
          , s = null ;
        if (this.targetPlayer = {
            id: u,
            name: h
        },
        i)
            for (var a = 0, m = i.length; a < m; a += 1)
                t(i[a]);
        var g = {
            name: h,
            guild: o
        };
        null !== s && (g.alliance = s.allianceInformations),
        this.banner.setContent(g);
        var _ = window.gui.playerData.partyData
          , v = _.pendingInvitations;
        f = [];
        for (var w in v)
            v[w][u] && f.push(_.getPartyTypeFromId(w));
        r = _.partyTypes[y.PARTY_TYPE_CLASSICAL].id,
        l = _.partyTypes[y.PARTY_TYPE_ARENA].id,
        this.toggleButtonsAvailability(e, n, o, s),
        window.gui.playerData.isModeratorOrMore() && this.admin.show()
    }
    ,
    n.prototype.hideButtons = function() {
        this.kickFighter.hide(),
        this.challenge.hide(),
        this.assault.hide(),
        this.exchangeProp.hide(),
        this.inviteParty.hide(),
        this.inviteArena.hide(),
        this.inviteGuild.hide(),
        this.inviteAlliance.hide(),
        this.addFriend.hide(),
        this.addEnemy.hide(),
        this.ignoreSession.hide(),
        this.stopIgnoreSession.hide(),
        this.partyTitle.hide(),
        this.follow.hide(),
        this.stopFollowing.hide(),
        this.kickPlayer.hide(),
        this.appointLeader.hide(),
        this.kickArenaPlayer.hide(),
        this.appointArenaLeader.hide(),
        this.allFollow.hide(),
        this.allStopFollow.hide(),
        this.cancelPartyInvitation.hide(),
        this.leaveParty.hide(),
        this.arenaTitle.hide(),
        this.cancelArenaInvitation.hide(),
        this.leaveArena.hide(),
        this.kickOutFromHome.hide(),
        this.guildInformations.hide(),
        this.allianceInformations.hide()
    }
    ,
    n.prototype.toggleButtonsAvailability = function(e, t, i, n) {
        e = e || {};
        var o = window.gui.playerData
          , s = o.partyData
          , r = o.jobs
          , l = o.socialData
          , h = s.partyTypes[y.PARTY_TYPE_CLASSICAL]
          , d = s.partyTypes[y.PARTY_TYPE_ARENA]
          , p = !o.isAlive()
          , m = e.isMutant
          , g = window.gui.gameContext === A.FIGHT;
        if (this.hideButtons(),
        window.gui.fightManager.fightState === M.PREPARATION && o.isFightLeader && o.id !== u && this.kickFighter.show(),
        f.indexOf(y.PARTY_TYPE_CLASSICAL) === -1 ? h.members[u] || this.inviteParty.show() : (this.partyTitle.show(),
        this.cancelPartyInvitation.show()),
        f.indexOf(y.PARTY_TYPE_ARENA) === -1 ? d.members[u] || this.inviteArena.show() : (this.arenaTitle.show(),
        this.cancelArenaInvitation.show()),
        c && (l.friendsList[c] || l.enemiesList[c]) || (this.addFriend.show(),
        this.addEnemy.show()),
        l.isIgnored(c) ? this.stopIgnoreSession.show() : this.ignoreSession.show(),
        h.members[u] && (this.partyTitle.show(),
        s.followedId === u ? this.stopFollowing.show() : this.follow.show(),
        h.leaderId === o.id && (this.kickPlayer.show(),
        this.appointLeader.show(),
        N ? this.allStopFollow.show() : this.allFollow.show())),
        this.kickOutFromHome.toggleDisplay(!!window.gui.playerData.position.isInMyHouse),
        d.members[u] && d.leaderId === o.id && (this.arenaTitle.show(),
        this.kickArenaPlayer.show(),
        this.appointArenaLeader.show()),
        this.join.toggleDisplay(!g && o.position.isInIncarnam()),
        !g) {
            var _ = o.getRestrictions();
            if (_.cantExchange || (p ? this.exchangeProp.disable() : this.exchangeProp.enable(),
            this.exchangeProp.show()),
            t) {
                _.cantChallenge || (p ? this.challenge.disable() : this.challenge.enable(),
                this.challenge.show());
                var v = a(t, n, m, u);
                v !== O && v !== P || (v === O || p ? this.assault.disable() : this.assault.enable(),
                this.assault.show())
            }
        }
        var b = o.guild;
        !e.hasGuild && !i && b.current && b.hasRight(w.GUILD_RIGHT_INVITE_NEW_MEMBERS) && this.inviteGuild.show();
        var C = o.alliance;
        !e.hasGuild && u && i && !n && C.current && C.isBoss() && this.inviteAlliance.show(),
        i && (this.guildId = i.guildId,
        this.guildInformations.show()),
        n && (this.allianceId = n.allianceInformations.allianceId,
        this.allianceInformations.show()),
        this._updateMultiCraftMenu(o, r)
    }
    ,
    n.prototype._setupGroup1 = function(e) {
        var t = this
          , i = e.createChild("div", {
            className: "group"
        });
        this.kickFighter = i.appendChild(new v({
            text: _("ui.fight.kick"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("GameContextKickMessage", {
                targetId: u
            }),
            t.emit("close")
        }
        ))
    }
    ,
    n.prototype._setupGroup2 = function(e) {
        var t = this
          , i = e.createChild("div", {
            className: "group"
        });
        this.privateMessage = i.appendChild(new v({
            text: _("ui.common.wisperMessage"),
            className: "cmButton"
        },function() {
            window.gui.chat.startPrivateMessage(h),
            t.emit("close")
        }
        )),
        i.appendChild(new v({
            text: _("ui.common.ankaboxMessage"),
            className: ["cmButton", "disabled"]
        },function() {}
        )),
        this.challenge = i.appendChild(new v({
            text: _("ui.common.challenge"),
            className: "cmButton"
        },function() {
            window.gui.playerData.fightRequests.requestChallenge({
                targetId: u,
                targetName: h,
                targetCellId: d
            }),
            t.emit("close")
        }
        )),
        this.assault = i.appendChild(new v({
            text: _("ui.pvp.assault"),
            className: "cmButton"
        },function() {
            window.gui.playerData.fightRequests.requestAssault({
                targetId: u,
                targetName: h,
                targetCellId: d
            }, m),
            t.emit("close")
        }
        )),
        this.join = i.appendChild(new v({
            text: _("ui.common.join"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("FriendJoinRequestMessage", {
                name: h
            }),
            t.emit("close")
        }
        )),
        this.kickOutFromHome = i.appendChild(new v({
            text: _("ui.common.kickOff"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("HouseKickRequestMessage", {
                id: u
            }),
            t.emit("close")
        }
        )),
        i.appendChild(new v({
            text: _("ui.common.informations"),
            className: ["cmButton"]
        },function() {
            window.dofus.sendMessage("BasicWhoIsRequestMessage", {
                search: h,
                verbose: !0
            }),
            t.emit("close")
        }
        )),
        this.guildInformations = i.appendChild(new v({
            text: _("ui.guild.guildInformations"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("GuildFactsRequestMessage", {
                guildId: t.guildId
            }),
            t.emit("close")
        }
        )),
        this.allianceInformations = i.appendChild(new v({
            text: _("ui.alliance.allianceInformations"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("AllianceFactsRequestMessage", {
                allianceId: t.allianceId
            }),
            t.emit("close")
        }
        ))
    }
    ,
    n.prototype._setupGroup3 = function(e) {
        var t = this
          , i = e.createChild("div", {
            className: "group"
        });
        this.exchangeProp = i.appendChild(new v({
            text: _("ui.common.exchangeProp"),
            className: "cmButton"
        },function() {
            t.emit("close"),
            S.getWindow("tradeWithPlayer").prepareMakeExchange({
                targetId: u,
                targetName: h
            }),
            window.dofus.sendMessage("ExchangePlayerRequestMessage", {
                exchangeType: 1,
                target: u
            })
        }
        )),
        this.inviteParty = i.appendChild(new v({
            text: _("ui.party.addToParty"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyInvitationRequestMessage", {
                name: h
            }),
            t.emit("close")
        }
        )),
        this.inviteArena = i.appendChild(new v({
            text: _("ui.party.addToArena"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyInvitationArenaRequestMessage", {
                name: h
            }),
            t.emit("close")
        }
        )),
        this.inviteGuild = i.appendChild(new v({
            text: _("ui.social.inviteInGuild"),
            className: "cmButton"
        },function() {
            u ? window.dofus.sendMessage("GuildInvitationMessage", {
                targetId: u
            }) : window.dofus.sendMessage("GuildInvitationByNameMessage", {
                name: h
            }),
            t.emit("close")
        }
        )),
        this.inviteAlliance = i.appendChild(new v({
            text: _("ui.social.inviteInAlliance"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("AllianceInvitationMessage", {
                targetId: u
            }),
            t.emit("close")
        }
        )),
        this._multiCraftMenu = i.createChild("div", {
            className: "multiCraftMenu"
        })
    }
    ,
    n.prototype._setupGroup4 = function(e) {
        var t = this
          , i = e.createChild("div");
        this.addFriend = i.appendChild(new v({
            text: _("ui.social.addToFriends"),
            className: "cmButton"
        },function() {
            t.emit("close"),
            window.gui.openConfirmPopup({
                title: _("ui.popup.warning"),
                message: _("ui.social.confirmAddFriend", h),
                cb: function(e) {
                    e && window.dofus.sendMessage("FriendAddRequestMessage", {
                        name: h
                    })
                }
            })
        }
        )),
        this.addEnemy = i.appendChild(new v({
            text: _("ui.social.addToEnemy"),
            className: "cmButton"
        },function() {
            t.emit("close"),
            window.gui.openConfirmPopup({
                title: _("ui.popup.warning"),
                message: _("ui.social.confirmAddEnemy", h),
                cb: function(e) {
                    e && window.dofus.sendMessage("IgnoredAddRequestMessage", {
                        name: h,
                        session: !1
                    })
                }
            })
        }
        )),
        this.ignoreSession = i.appendChild(new v({
            text: _("ui.social.blackListTemporarly"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("IgnoredAddRequestMessage", {
                name: h,
                session: !0
            }),
            t.emit("close")
        }
        )),
        this.stopIgnoreSession = i.appendChild(new v({
            text: _("ui.social.blackListRemove"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("IgnoredDeleteRequestMessage", {
                accountId: c,
                session: !0
            }),
            t.emit("close")
        }
        ))
    }
    ,
    n.prototype._setupGroup5 = function(e) {
        var t = this
          , i = e.createChild("div");
        this.partyTitle = i.createChild("div", {
            text: _("ui.common.party"),
            className: "title"
        }),
        this.follow = i.appendChild(new v({
            text: _("ui.common.follow"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyFollowMemberRequestMessage", {
                partyId: r,
                playerId: u
            }),
            t.emit("close")
        }
        )),
        this.stopFollowing = i.appendChild(new v({
            text: _("ui.party.stopFollowing"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyStopFollowRequestMessage", {
                partyId: r
            }),
            t.emit("close")
        }
        )),
        this.kickPlayer = i.appendChild(new v({
            text: _("ui.party.kickPlayer"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyKickRequestMessage", {
                partyId: r,
                playerId: u
            }),
            t.emit("close")
        }
        )),
        this.appointLeader = i.appendChild(new v({
            text: _("ui.party.promotePartyLeader"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyAbdicateThroneMessage", {
                partyId: r,
                playerId: u
            }),
            t.emit("close")
        }
        )),
        this.allFollow = i.appendChild(new v({
            text: _("ui.party.followHimAll"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyFollowThisMemberRequestMessage", {
                partyId: r,
                playerId: u,
                enabled: !0
            }),
            N = !0,
            t.emit("close")
        }
        )),
        this.allStopFollow = i.appendChild(new v({
            text: _("ui.party.stopAllFollowingHim"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyFollowThisMemberRequestMessage", {
                partyId: r,
                playerId: u,
                enabled: !1
            }),
            N = !1,
            t.emit("close")
        }
        )),
        this.cancelPartyInvitation = i.appendChild(new v({
            text: _("ui.party.cancelInvitation"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyCancelInvitationMessage", {
                partyId: r,
                guestId: u
            }),
            t.emit("close")
        }
        )),
        this.leaveParty = i.appendChild(new v({
            text: _("ui.party.leaveParty"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyLeaveRequestMessage", {
                partyId: r
            }),
            t.emit("close")
        }
        ))
    }
    ,
    n.prototype._setupGroup6 = function(e) {
        var t = this
          , i = e.createChild("div", {
            className: "group"
        });
        this.arenaTitle = i.createChild("div", {
            text: _("ui.common.koliseum"),
            className: "title"
        }),
        this.cancelArenaInvitation = i.appendChild(new v({
            text: _("ui.party.cancelInvitation"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyCancelInvitationMessage", {
                partyId: l,
                guestId: u
            }),
            t.emit("close")
        }
        )),
        this.kickArenaPlayer = i.appendChild(new v({
            text: _("ui.party.kickPlayer"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyKickRequestMessage", {
                partyId: l,
                playerId: u
            }),
            t.emit("close")
        }
        )),
        this.appointArenaLeader = i.appendChild(new v({
            text: _("ui.party.promotePartyLeader"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyAbdicateThroneMessage", {
                partyId: l,
                playerId: u
            }),
            t.emit("close")
        }
        )),
        this.leaveArena = i.appendChild(new v({
            text: _("ui.party.arenaQuit"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("PartyLeaveRequestMessage", {
                partyId: l
            }),
            t.emit("close")
        }
        ))
    }
    ,
    n.prototype._updateMultiCraftMenu = function(e, t) {
        function i(e, t, i) {
            var o = n.appendChild(new v({
                text: e,
                className: "cmButton"
            },function() {
                window.dofus.sendMessage("ExchangePlayerMultiCraftRequestMessage", {
                    exchangeType: t,
                    target: u,
                    skillId: i
                }),
                s.emit("close")
            }
            ));
            r ? o.disable() : o.enable()
        }
        var n = this._multiCraftMenu;
        if (n.clearContent(),
        window.gui.gameContext === A.ROLE_PLAY) {
            var o, s = this, a = e.id, r = !e.isAlive(), l = t.getUsableSkillsInMap(a, p), c = _("ui.common.inviteTo");
            for (var h in l) {
                var d = l[h];
                o = c + " " + d.nameId,
                i(o, b.MULTICRAFT_CRAFTER, d.id)
            }
            var m = t.getUsableSkillsInMap(u, p)
              , f = _("ui.common.askTo");
            for (var g in m) {
                var y = m[g];
                o = f + " " + y.nameId,
                i(o, b.MULTICRAFT_CUSTOMER, y.id)
            }
        }
    }
    ,
    n.prototype._setupAdmin = function(e) {
        var t = this;
        t.admin = e.appendChild(new v({
            text: "Admin",
            className: "cmButton"
        },function() {
            window.gui.closeContextualMenu(),
            window.gui.openContextualMenuAround("admin", t.admin, t.targetPlayer),
            t.emit("close")
        }
        ))
    }
}
, function(e, t) {
    e.exports = {
        NPC_SHOP: 0,
        PLAYER_TRADE: 1,
        NPC_TRADE: 2,
        CRAFT: 3,
        DISCONNECTED_VENDOR: 4,
        STORAGE: 5,
        SHOP_STOCK: 6,
        TAXCOLLECTOR: 8,
        NPC_MODIFY_TRADE: 9,
        BIDHOUSE_SELL: 10,
        BIDHOUSE_BUY: 11,
        MULTICRAFT_CRAFTER: 12,
        MULTICRAFT_CUSTOMER: 13,
        JOB_INDEX: 14,
        MOUNT: 15,
        MOUNT_STABLE: 16,
        NPC_RESURECT_PET: 17,
        NPC_TRADE_MOUNT: 18,
        REALESTATE_HOUSE: 19,
        REALESTATE_FARM: 20
    }
}
, function(e, t, i) {
    function n(e) {
        u.call(this, "div", {
            className: "ContextualMenuUserContent"
        }),
        this.banner = e,
        this._createDom()
    }
    var o, s, a, r = i(26).inherits, l = i(35).getText, c = i(204), u = i(190), h = i(412), d = i(420), p = i(85);
    r(n, u),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div")
          , i = window.gui.playerData;
        this.freeSoul = t.appendChild(new c({
            text: l("ui.common.freeSoul"),
            className: "cmButton",
            hidden: !0
        },function() {
            window.dofus.sendMessage("GameRolePlayFreeSoulRequestMessage"),
            e.emit("close")
        }
        )),
        this.slapHimself = t.appendChild(new c({
            text: l("ui.dialog.slapHimself"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("ChatClientMultiMessage", {
                content: l("ui.dialog.slapSentence"),
                channel: 0
            }),
            e.emit("close")
        }
        )),
        this.organizeShop = t.appendChild(new c({
            text: l("ui.humanVendor.organizeShop"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("ExchangeRequestOnShopStockMessage"),
            e.emit("close")
        }
        )),
        this.switchToMerchantMode = t.appendChild(new c({
            text: l("ui.humanVendor.switchToMerchantMode"),
            className: "cmButton"
        },function() {
            window.dofus.sendMessage("ExchangeShowVendorTaxMessage"),
            e.emit("close")
        }
        )),
        this.orientCharacter = t.appendChild(new c({
            text: l("ui.orientCharacter"),
            className: ["cmButton", "disabled"]
        },function() {}
        )),
        this.partyTitle = t.createChild("div", {
            text: l("ui.common.party"),
            className: "title",
            hidden: !0
        }),
        this.leaveParty = t.appendChild(new c({
            text: l("ui.party.leaveParty"),
            className: "cmButton",
            hidden: !0
        },function() {
            window.dofus.sendMessage("PartyLeaveRequestMessage", {
                partyId: o
            }),
            e.emit("close")
        }
        )),
        this.followMe = t.appendChild(new c({
            text: l("ui.party.followMeAll"),
            className: "cmButton",
            hidden: !0
        },function() {
            window.dofus.sendMessage("PartyFollowThisMemberRequestMessage", {
                partyId: o,
                playerId: i.id,
                enabled: !0
            }),
            a = !0,
            e.emit("close")
        }
        )),
        this.stopFollowMe = t.appendChild(new c({
            text: l("ui.party.stopAllFollowingMe"),
            className: "cmButton",
            hidden: !0
        },function() {
            window.dofus.sendMessage("PartyFollowThisMemberRequestMessage", {
                partyId: o,
                playerId: i.id,
                enabled: !1
            }),
            a = !1,
            e.emit("close")
        }
        ));
        var n = t.createChild("div", {
            className: "group"
        });
        this.arenaTitle = n.createChild("div", {
            text: l("ui.common.koliseum"),
            className: "title",
            hidden: !0
        }),
        this.leaveArena = n.appendChild(new c({
            text: l("ui.party.arenaQuit"),
            className: "cmButton",
            hidden: !0
        },function() {
            window.dofus.sendMessage("PartyLeaveRequestMessage", {
                partyId: s
            }),
            e.emit("close")
        }
        )),
        this.fightReady = t.appendChild(new c({
            text: l("ui.banner.ready"),
            className: "cmButton"
        },function() {
            window.gui.timeline.fightControlButtons.toggleReadyForFight(),
            e.emit("close")
        }
        )),
        this.admin = t.appendChild(new c({
            text: "Admin",
            className: "cmButton"
        },function() {
            var t = {
                id: i.id,
                name: i.characterBaseInformations.name
            };
            window.gui.closeContextualMenu(),
            window.gui.openContextualMenuAround("admin", e.admin, t),
            e.emit("close")
        }
        ))
    }
    ,
    n.prototype.updateContent = function() {
        var e = window.gui.playerData
          , t = e.partyData.partyTypes;
        if (this.banner.setContent({
            name: e.characterBaseInformations.name
        }),
        o = t[h.PARTY_TYPE_CLASSICAL].id,
        s = t[h.PARTY_TYPE_ARENA].id,
        this.freeSoul.hide(),
        this.slapHimself.hide(),
        this.organizeShop.hide(),
        this.switchToMerchantMode.hide(),
        this.orientCharacter.hide(),
        this.partyTitle.hide(),
        this.leaveParty.hide(),
        this.arenaTitle.hide(),
        this.leaveArena.hide(),
        this.followMe.hide(),
        this.stopFollowMe.hide(),
        this.fightReady.hide(),
        this.admin.hide(),
        e.state === d.STATUS_TOMBSTONE ? this.freeSoul.show() : window.gui.gameContext === p.ROLE_PLAY && (this.slapHimself.show(),
        window.gui.uiLocker.isFeatureAvailable("myShop") && (this.organizeShop.show(),
        this.switchToMerchantMode.show()),
        this.orientCharacter.show()),
        o && (this.partyTitle.show(),
        this.leaveParty.show(),
        t[h.PARTY_TYPE_CLASSICAL].leaderId === e.id)) {
            if (a)
                return this.followMe.hide(),
                void this.stopFollowMe.show();
            this.followMe.show(),
            this.stopFollowMe.hide()
        }
        s && (this.arenaTitle.show(),
        this.leaveArena.show()),
        window.gui.timeline.fightControlButtons.isReadyForFightButtonVisible() && this.fightReady.show(),
        e.isModeratorOrMore() && this.admin.show()
    }
}
, function(e, t) {
    e.exports = {
        STATUS_ALIVE_AND_KICKING: 0,
        STATUS_TOMBSTONE: 1,
        STATUS_PHANTOM: 2
    }
}
, function(e, t, i) {
    function n() {
        function e() {
            i && (i.unset(),
            i.delClassNames("unavailable")),
            r = "remove"
        }
        function t() {
            window.dofus.sendMessage("InventoryPresetUseMessage", {
                presetId: n
            }),
            r = "equip"
        }
        s.call(this, {
            noHeader: !0
        });
        var i, n, o, r, l = {};
        this.once("open", function() {
            l.equipSet = this._addEntry(a("ui.common.equip"), t),
            l.remove = this._addEntry(a("ui.common.remove"), e),
            this._addCancel()
        }),
        this.on("open", function(e, t) {
            e = e || {},
            i = e.slot,
            o = e.onClose,
            n = e.presetId,
            r = "",
            l.remove.toggleDisplay(!!e.canRemove),
            l.equipSet.toggleDisplay(!!e.hasOwnProperty("presetId")),
            t()
        }),
        this.on("close", function() {
            o && o(r)
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText;
    o(n, s),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e, t, i, n, c, p, m, f;
        this.once("open", function() {
            e = this.header.appendChild(new a),
            this._addEntry(r("ui.common.talk"), function() {
                m.prepareDialog(c.npcData),
                window.dofus.sendMessage("NpcGenericActionRequestMessage", {
                    npcId: c.contextualId,
                    npcActionId: 3,
                    npcMapId: window.gui.playerData.position.mapId
                })
            }),
            p = this._addEntry(r("ui.common.teleport"), function() {
                window.dofus.sendMessage("PrismUseRequestMessage")
            }),
            i = this._addEntry(r("ui.common.attack"), function() {
                window.dofus.sendMessage("PrismAttackRequestMessage")
            }),
            n = this._addEntry(r("ui.common.modify"), function() {
                d.open("social", {
                    tabId: "alliance",
                    tabParams: {
                        tabId: "conquests"
                    }
                })
            }),
            this._addCancel(),
            window.gui.on("AlliancePrismDialogQuestionMessage", function() {
                var e = new h(t.nextVulnerabilityDate).getServerDate().toString()
                  , i = [f, o.prismState[t.state], e.date + " " + e.time, 0];
                m.nextQuestionAsync(15428, [], i)
            })
        }),
        this.on("open", function(o, s) {
            c = o,
            m = window.gui.npcDialogHandler;
            var a, r = window.gui.playerData;
            t = o.prism,
            "AlliancePrismInformation" === t._type ? (a = o.prism.alliance,
            f = a.allianceName,
            e.setContent({
                alliance: a
            }),
            r.alliance.hasAlliance() && r.alliance.current.allianceId === a.allianceId ? (i.hide(),
            n.toggleDisplay(r.guild.hasRight(l.GUILD_RIGHT_SET_ALLIANCE_PRISM))) : (i.show(),
            r.isAlive() && t.state === u.PRISM_STATE_NORMAL ? i.enable() : i.disable(),
            n.hide()),
            p.hide()) : (a = window.gui.playerData.alliance.current,
            f = a.allianceName,
            e.setContent({
                alliance: a
            }),
            i.hide(),
            p.toggleDisplay(t.hasTeleporterModule),
            r.guild.hasRight(l.GUILD_RIGHT_SET_ALLIANCE_PRISM) ? n.show() : n.hide()),
            s()
        })
    }
    var o = i(423)
      , s = i(299)
      , a = i(307)
      , r = i(35).getText
      , l = i(339).GuildRightsBitEnum
      , c = i(26).inherits
      , u = i(346)
      , h = i(211).DofusDate
      , d = i(22);
    c(n, s),
    e.exports = n
}
, function(e, t, i) {
    var n = i(424)
      , o = i(35).getText
      , s = i(342)
      , a = i(22);
    t.alliances = {},
    t.createAlliance = function(e) {
        var i = new n(e);
        return t.alliances[i.allianceId] = i,
        i
    }
    ,
    t.initialize = function(e) {
        e.on("disconnect", function() {
            t.alliances = {}
        }),
        e.on("PrismSettingsErrorMessage", function() {
            e.chat.logMsg(o("ui.error.cantModifiedPrismVulnerabiltyHour"))
        }),
        e.on("AllianceCreationResultMessage", function(e) {
            switch (e.result) {
            case s.SOCIAL_GROUP_CREATE_ERROR_ALREADY_IN_GROUP:
                return window.gui.openSimplePopup(o("ui.alliance.alreadyInAlliance"));
            case s.SOCIAL_GROUP_CREATE_OK:
                return a.close("socialGroupCreation");
            case s.SOCIAL_GROUP_CREATE_ERROR_NAME_ALREADY_EXISTS:
                return window.gui.openSimplePopup(o("ui.alliance.alreadyUseName"));
            case s.SOCIAL_GROUP_CREATE_ERROR_NAME_INVALID:
                return window.gui.openSimplePopup(o("ui.alliance.invalidName"));
            case s.SOCIAL_GROUP_CREATE_ERROR_TAG_ALREADY_EXISTS:
                return window.gui.openSimplePopup(o("ui.alliance.alreadyUseTag"));
            case s.SOCIAL_GROUP_CREATE_ERROR_TAG_INVALID:
                return window.gui.openSimplePopup(o("ui.alliance.invalidTag"));
            case s.SOCIAL_GROUP_CREATE_ERROR_EMBLEM_ALREADY_EXISTS:
                return window.gui.openSimplePopup(o("ui.guild.AlreadyUseEmblem"));
            case s.SOCIAL_GROUP_CREATE_ERROR_REQUIREMENT_UNMET:
                return window.gui.openSimplePopup(o("ui.guild.requirementUnmet"));
            case s.SOCIAL_GROUP_CREATE_ERROR_EMBLEM_INVALID:
            case s.SOCIAL_GROUP_CREATE_ERROR_UNKNOWN:
                return window.gui.openSimplePopup(o("ui.common.unknownFail"))
            }
        }),
        e.on("AllianceFactsMessage", function(e) {
            a.getWindow("allianceCard").display(e)
        }),
        e.on("AllianceFactsErrorMessage", function() {
            e.chat.logMsg(o("ui.alliance.doesntExistAnymore"))
        }),
        t.prismState = {
            0: o("ui.prism.state0"),
            1: o("ui.prism.state1"),
            2: o("ui.prism.state2"),
            3: o("ui.prism.state3"),
            4: o("ui.prism.state4"),
            5: o("ui.prism.state5"),
            6: o("ui.prism.state6")
        },
        t.getPrismStateInfo = function(e, t) {
            switch (e) {
            case 0:
                return o("ui.prism.stateInfos0");
            case 1:
                return o("ui.prism.stateInfos1");
            case 2:
                return o("ui.prism.stateInfos2");
            case 3:
                return o("ui.prism.stateInfos3");
            case 4:
                return o("ui.prism.stateInfos4", t);
            case 5:
                return o("ui.prism.stateInfos5");
            case 6:
                return o("ui.prism.stateInfos6")
            }
        }
    }
    ,
    t.openAllianceCard = function(e) {
        window.dofus.sendMessage("AllianceFactsRequestMessage", {
            allianceId: e
        })
    }
}
, function(e, t, i) {
    function n(e) {
        c.call(this),
        this.enabled = !1,
        this.allianceId = 0,
        this.allianceTag = "",
        this.allianceName = "",
        this.creationDate = 0,
        this.allianceEmblem = new l,
        this.nbMembers = 0,
        this.prisms = [],
        this.guilds = [],
        this.guildCount = 0,
        this.setInfo(e)
    }
    function o(e, t) {
        t.hasOwnProperty(e) && void 0 !== t[e] && this.hasOwnProperty(e) && (this[e] = t[e])
    }
    function s(e) {
        var t = 0
          , i = e.guilds.map(function(i) {
            var n = a.createGuild(i);
            return n.allianceId = e.allianceId,
            n.allianceName = e.allianceName,
            t += n.nbMembers,
            n
        });
        return i[0].allianceLeader = !0,
        {
            memberCount: t,
            guilds: i
        }
    }
    var a = i(339)
      , r = i(35).getText
      , l = a.Emblem
      , c = i(16).EventEmitter
      , u = i(26).inherits;
    u(n, c),
    n.prototype.setInfo = function(e) {
        for (var t in e)
            o.call(this, t, e);
        if (e.guilds) {
            var i = s(e);
            this.nbMembers = i.memberCount,
            this.guilds = i.guilds,
            this.guildCount = this.guilds.length
        }
        var n = e.prisms;
        if (n) {
            this.prisms = {};
            for (var a = 0, l = n.length; a < l; a += 1) {
                var c = n[a];
                this.prisms[c.subAreaId] = c
            }
        }
        "#NONAME#" === this.allianceName && (this.allianceName = r("ui.guild.noName")),
        "#TAG#" === this.allianceTag && (this.allianceTag = r("ui.alliance.noTag")),
        this.allianceEmblem.isAlliance = !0
    }
    ,
    e.exports = n
}
, function(e, t, i) {
    function n() {
        function e() {
            n ? l("ExchangeObjectTransfertAllToInvMessage", {}) : l("ExchangeObjectTransfertAllFromInvMessage", {})
        }
        function t() {
            var e = o.getDisplayedItemsUIDs();
            !e || e.length < r.MIN_OBJ_COUNT_BY_XFERT || (e.length > r.MAX_OBJ_COUNT_BY_XFERT && (e = e.splice(0, r.MAX_OBJ_COUNT_BY_XFERT),
            window.gui.chat.logMsg(a("ui.exchange.partialTransfert"))),
            n ? l("ExchangeObjectTransfertListToInvMessage", {
                ids: e
            }) : l("ExchangeObjectTransfertListFromInvMessage", {
                ids: e
            }))
        }
        function i() {
            n ? l("ExchangeObjectTransfertExistingToInvMessage", {}) : l("ExchangeObjectTransfertExistingFromInvMessage", {})
        }
        s.call(this, {
            noHeader: !0
        });
        var n, o, l = window.dofus.sendMessage;
        this.once("open", function() {
            this._addEntry(a("ui.storage.getAll"), e),
            this._addEntry(a("ui.storage.getVisible"), t),
            this._addEntry(a("ui.storage.getExisting"), i),
            this._addCancel()
        }),
        this.on("open", function(e, t) {
            n = e.toInventory,
            o = e.viewer,
            t()
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText
      , r = i(212);
    o(n, s),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        function e() {
            t && t.unset(),
            n = "remove"
        }
        s.call(this);
        var t, i, n, o = {};
        this.once("open", function() {
            o.remove = this._addEntry(a("ui.common.remove"), e),
            this._addCancel()
        }),
        this.on("open", function(e, s) {
            e = e || {},
            t = e.slot,
            i = e.onClose,
            this.header.setText(e.spell.getName()),
            n = "",
            o.remove.toggleDisplay(!!e.canRemove),
            s()
        }),
        this.on("close", function() {
            i && i(n)
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText;
    o(n, s),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        function e() {
            var e = this;
            this.menu.close(),
            window.gui.openConfirmPopup({
                title: s("ui.grimoire.spellLevel.increase"),
                message: s("ui.grimoire.popup.confirmation", this.upgradeCost, a, this.spellLevel),
                cb: function(t) {
                    t && window.dofus.sendMessage("SpellUpgradeRequestMessage", {
                        spellId: n,
                        spellLevel: e.spellLevel
                    })
                }
            })
        }
        function t(t) {
            var i = new r("li");
            return i.menu = t,
            l(i),
            i.on("tap", e),
            i
        }
        o.call(this, {
            className: "ContextualMenuSpellUpgrade"
        });
        var i, n, a, c = [];
        this.once("open", function() {
            this.header.setText(s("ui.grimoire.spellLevel.increase")),
            i = this.entryList.createChild("ul"),
            this._addCancel()
        }),
        this.on("open", function(e, o) {
            var r = e.spell;
            n = r.id,
            a = r.getName();
            for (var l = r.getProperty("spellLevels"), u = 0, h = Math.max(l.length, c.length); u < h; u += 1) {
                var d = u + 1
                  , p = c[u];
                if (p) {
                    if (!l[u]) {
                        p.hide();
                        break
                    }
                } else
                    p = c[u] = i.appendChild(t(this));
                p.show();
                var m = !1
                  , f = !1
                  , g = r.getUpgradeCost(d)
                  , _ = r.getProperty("minPlayerLevel", d)
                  , v = s("ui.common.level") + " " + d;
                d <= r.level ? f = !0 : window.gui.playerData.characterBaseInformations.level < _ ? v += " (" + s("ui.spell.requiredLevelShort", _) + ")" : e.remainingPoints < g ? v += " (" + s("ui.spell.requiredPoints", g) + ")" : (m = !0,
                v += " (" + g + " " + s("ui.common.points") + ")"),
                p.setText(v),
                p.toggleClassName("disabled", !m),
                p.toggleClassName("checked", f),
                p.setEnable(m),
                p.spellLevel = d,
                p.upgradeCost = g
            }
            o()
        })
    }
    i(428);
    var o = i(299)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(190)
      , l = i(32);
    a(n, o),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        var n = d[e]
          , o = n.cached[t];
        return o ? i(o) : void c.getData(n.dbName, t, function(e, s) {
            return e ? (console.warn("ContextualMenuTaxCollector", e),
            i("")) : (o = n.cached[t] = s[n.attribute],
            void i(o))
        })
    }
    function o() {
        function e() {
            3 === this.actionId && d.prepareDialog(s.npcData),
            window.dofus.sendMessage("NpcGenericActionRequestMessage", {
                npcId: s.contextualId,
                npcActionId: this.actionId,
                npcMapId: s.mapId
            })
        }
        a.call(this);
        var t, i, o, s, c, d, m = window.gui.playerData.guild;
        this.once("open", function(n) {
            function a(e) {
                var t = [e.guildInfo.guildName];
                e.maxPods && (t.push(e.maxPods),
                t.push(e.prospecting),
                t.push(e.wisdom),
                t.push(e.taxCollectorsCount),
                t.push(l(e.kamas)),
                t.push(l(e.experience)),
                t.push(l(e.pods)),
                t.push(l(e.itemsValue)));
                var i = e.alliance;
                return i && (t.push("#NONAME#" !== i.allianceName ? i.allianceName : r("ui.guild.noName")),
                t.push("[" + ("#TAG#" !== i.allianceTag ? i.allianceTag : r("ui.alliance.noTag")) + "]")),
                t
            }
            d = window.gui.npcDialogHandler,
            o = this.header.appendChild(new u);
            for (var c = n.npcData, h = 0, m = c.actions.length; h < m; h += 1) {
                var f = this._addEntry(c.actionsName[h], e);
                f.actionId = c.actions[h]
            }
            i = this._addEntry(r("ui.social.CollectTaxCollector"), function() {
                window.dofus.sendMessage("ExchangeRequestOnTaxCollectorMessage", {
                    taxCollectorId: s.contextualId
                })
            }),
            t = this._addEntry(r("ui.common.attack"), function() {
                window.dofus.sendMessage("GameRolePlayTaxCollectorFightRequestMessage", {
                    taxCollectorId: s.contextualId
                })
            }),
            this._addCancel(),
            window.gui.on("TaxCollectorDialogQuestionExtendedMessage", function(e) {
                d.nextQuestionAsync(p.guild, [], a(e))
            }),
            window.gui.on("TaxCollectorDialogQuestionBasicMessage", function(e) {
                d.nextQuestionAsync(p.basic, [], a(e))
            }),
            window.gui.on("AllianceTaxCollectorDialogQuestionExtendedMessage", function(e) {
                d.nextQuestionAsync(p.alliance, [], a(e))
            })
        }),
        this.on("open", function(e, a) {
            if (s = e,
            m.hasGuild() && e.guild.guildId === m.current.guildId) {
                i.show();
                var r = m.hasRight(h.GUILD_RIGHT_COLLECT)
                  , l = m.hasRight(h.GUILD_RIGHT_COLLECT_MY_TAX_COLLECTOR);
                r || l ? i.enable() : i.disable(),
                t.hide()
            } else
                i.hide(),
                t.show(),
                0 !== e.taxCollectorAttack ? t.disable() : t.enable();
            n("firstName", e.taxCollector.firstNameId, function(t) {
                n("lastName", e.taxCollector.lastNameId, function(i) {
                    c = t + " " + i,
                    s.npcData.nameId = c,
                    o.setContent({
                        name: c,
                        guild: e.guild
                    }),
                    a()
                })
            })
        })
    }
    var s = i(26).inherits
      , a = i(299)
      , r = i(35).getText
      , l = i(210).intToString
      , c = i(36)
      , u = i(307)
      , h = i(339).GuildRightsBitEnum
      , d = {
        firstName: {
            dbName: "TaxCollectorFirstnames",
            attribute: "firstnameId",
            cached: {}
        },
        lastName: {
            dbName: "TaxCollectorNames",
            attribute: "nameId",
            cached: {}
        }
    }
      , p = {
        guild: 1,
        basic: 2,
        alliance: 15427
    };
    s(o, a),
    e.exports = o
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var o = new l("li",{
            className: t,
            text: e
        });
        return u(o),
        o.on("tap", function() {
            window.dofus.sendMessage("PlayerStatusUpdateRequestMessage", {
                status: {
                    statusId: i
                }
            }),
            n.hide()
        }),
        o
    }
    function o() {
        s.call(this, {
            className: "ContextualMenuUserStatus"
        }),
        this.once("open", function() {
            this.header.setText(a("ui.chat.status.title"));
            for (var e = [{
                label: a("ui.chat.status.availiable"),
                className: "available",
                id: c.PLAYER_STATUS_AVAILABLE
            }, {
                label: a("ui.chat.status.away"),
                className: "away",
                id: c.PLAYER_STATUS_AFK
            }, {
                label: a("ui.chat.status.private"),
                className: "private",
                id: c.PLAYER_STATUS_PRIVATE
            }, {
                label: a("ui.chat.status.solo"),
                className: "solo",
                id: c.PLAYER_STATUS_SOLO
            }], t = this.entryList.createChild("ul"), i = 0, o = e.length; i < o; i += 1) {
                var s = e[i];
                t.appendChild(n(s.label, s.className, s.id, this))
            }
            this._addCancel()
        }),
        this.on("open", function(e, t) {
            t()
        })
    }
    i(431);
    var s = i(299)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(190)
      , c = i(432)
      , u = i(32);
    r(o, s),
    e.exports = o
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        PLAYER_STATUS_OFFLINE: 0,
        PLAYER_STATUS_UNKNOWN: 1,
        PLAYER_STATUS_AVAILABLE: 10,
        PLAYER_STATUS_IDLE: 20,
        PLAYER_STATUS_AFK: 21,
        PLAYER_STATUS_PRIVATE: 30,
        PLAYER_STATUS_SOLO: 40
    }
}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e = this;
        this.data = null ,
        this.on("open", function(e, t) {
            this.data = e,
            this.header.setText(e.paddockObjectName),
            t()
        }),
        this.once("open", function() {
            this._addEntry(a("ui.common.remove"), function() {
                window.dofus.sendMessage("PaddockRemoveItemRequestMessage", {
                    cellId: e.data.cellId
                })
            }),
            this._addCancel()
        })
    }
    var o = i(26).inherits
      , s = i(299)
      , a = i(35).getText;
    o(n, s),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        r.call(this);
        var e = this;
        e.targetPlayer = null ,
        e.adminData = null ,
        e.curItems = null ,
        e.prevItems = [],
        this.once("open", function() {
            e.container = e.entryList.appendChild(new l("div")),
            e._addCancel()
        }),
        this.on("open", function(t, i) {
            e.targetPlayer = t,
            e.updateContent(t, i)
        })
    }
    function o(e) {
        if (e.status < 400 || e.status > 599)
            return e;
        var t = new Error(e.statusText);
        throw t.response = e,
        t
    }
    function s(e) {
        return e.json().then(function(t) {
            if (t._statusCode || e.status > 599)
                throw t;
            return t
        })
    }
    var a = i(26).inherits
      , r = i(299)
      , l = i(190)
      , c = i(204)
      , u = i(22)
      , h = "http://dl.ak.ankama.com/games/dofus-tablette/adminMenu/adminMenu.json";
    a(n, r),
    e.exports = n,
    n.prototype.replaceSymbols = function(e) {
        var t = window.gui.playerData.characterBaseInformations.name
          , i = this.targetPlayer.name
          , n = e.replace("%n", t);
        return n = n.replace("%p", i)
    }
    ,
    n.prototype._addStartup = function(e) {
        console.debug(e)
    }
    ,
    n.prototype._addStatic = function(e) {
        var t = this.replaceSymbols(e.label);
        this.container.appendChild(new l("div",{
            text: t,
            className: "contextHeader"
        }))
    }
    ,
    n.prototype._addMenu = function(e) {
        function t() {
            e.label && i.prevItems.push(i.curItems),
            i._addItems(e.item)
        }
        var i = this
          , n = this.replaceSymbols(e.label || "");
        n += " >",
        this.container.appendChild(new c({
            text: n,
            className: "cmButton"
        },t))
    }
    ,
    n.prototype._addSendCommand = function(e) {
        function t() {
            var e = u.getWindow("adminConsole");
            u.open("adminConsole"),
            e._runCommand(o),
            i.close()
        }
        var i = this
          , n = this.replaceSymbols(e.label)
          , o = this.replaceSymbols(e.command);
        this.container.appendChild(new c({
            text: n,
            className: "cmButton"
        },t))
    }
    ,
    n.prototype._addPrepareCommand = function(e) {
        function t() {
            var e = u.getWindow("adminConsole");
            u.open("adminConsole"),
            e.cmdInput.setValue(o),
            i.close()
        }
        var i = this
          , n = this.replaceSymbols(e.label)
          , o = this.replaceSymbols(e.command);
        this.container.appendChild(new c({
            text: n,
            className: "cmButton"
        },t))
    }
    ,
    n.prototype._addBatch = function(e) {
        function t() {
            var t, n = u.getWindow("adminConsole"), o = e.item;
            u.open("adminConsole");
            for (var s = 0; s < o.length; s += 1)
                t = i.replaceSymbols(o[s].command),
                n._runCommand(t);
            i.close()
        }
        var i = this
          , n = e.label;
        this.container.appendChild(new c({
            text: n,
            className: "cmButton"
        },t))
    }
    ,
    n.prototype._addItem = function(e) {
        var t = e.type;
        switch (t) {
        case "startup":
            this._addStartup(e);
            break;
        case "static":
            this._addStatic(e);
            break;
        case "menu":
            this._addMenu(e);
            break;
        case "sendCommand":
            this._addSendCommand(e);
            break;
        case "prepareCommand":
            this._addPrepareCommand(e);
            break;
        case "batch":
            this._addBatch(e)
        }
    }
    ,
    n.prototype._addItems = function(e) {
        var t = this;
        t.curItems = e,
        this.container.clearContent();
        for (var i, n = 0; n < e.length; n += 1)
            i = e[n],
            this._addItem(i);
        this.prevItems.length && this.container.appendChild(new c({
            text: "< Back",
            className: "cmButton"
        },function() {
            var e = t.prevItems.pop();
            t._addItems(e)
        }
        )),
        this.scroller.refresh()
    }
    ,
    n.prototype.updateContent = function(e, t) {
        function i(e) {
            return n._addItems(e),
            t()
        }
        var n = this;
        return n.adminData ? i(n.adminData.menu.item) : void window.fetch(h).then(o).then(s).then(function(e) {
            return n.adminData = e,
            i(e.menu.item)
        })["catch"](console.error)
    }
}
, function(e, t) {}
, function(e, t) {
    function i() {
        this._setDimensions(0, 0, 0, 0),
        this.clear(),
        this.lastUpdateTime = 0
    }
    function n(e, t, i, n, o, s) {
        this.x = e,
        this.y = t,
        this.width = i,
        this.height = n,
        this.boxType = o,
        this.actorId = s,
        this.priority = d[o],
        this.angle = null
    }
    function o(e) {
        var t = e.bbox;
        if (t[0] <= t[1])
            return t;
        var i = window.isoEngine.mapRenderer.getCellSceneCoordinate(e.cellId);
        return [i.x - 20, i.x + 20, i.y - 90, i.y + 10]
    }
    var s = 5
      , a = 5
      , r = 0
      , l = 1
      , c = 2
      , u = 3
      , h = 4
      , d = {};
    d[r] = 1,
    d[l] = 10,
    d[c] = 20,
    d[u] = 30;
    var p = {};
    p[c] = 50,
    p[u] = 200,
    p[l] = 400,
    e.exports = i,
    i.prototype.initialize = function(e, t, i, n) {
        this._setDimensions(e, t, i, n),
        this.clear();
        var o = this;
        window.gui.on("resize", function(e) {
            o._setDimensions(e.mapLeft, e.mapTop, e.mapWidth, e.mapHeight)
        }),
        window.isoEngine.on("mapLoaded", function(e) {
            e && e.isReload || o.clear()
        })
    }
    ,
    i.prototype.clear = function() {
        this.boxes = []
    }
    ,
    i.prototype._setDimensions = function(e, t, i, n) {
        this.originX = e,
        this.originY = t,
        this.width = i,
        this.height = n
    }
    ,
    n.prototype.intersectingSurface = function(e) {
        if (e.x + e.width <= this.x || e.x >= this.x + this.width)
            return 0;
        if (e.y + e.height <= this.y || e.y >= this.y + this.height)
            return 0;
        var t = Math.min(this.x + this.width, e.x + e.width) - Math.max(this.x, e.x)
          , i = Math.min(this.y + this.height, e.y + e.height) - Math.max(this.y, e.y);
        return t * i
    }
    ,
    n.prototype.setAsSubboxOf = function(e) {
        this.priority = p[e.boxType];
        var t = this.x + this.width / 2
          , i = this.y + this.height / 2
          , n = e.x + e.width / 2
          , o = e.y + e.height / 2;
        this.angle = Math.atan2(o - i, n - t)
    }
    ,
    n.prototype.getCenter = function() {
        return [this.x + this.width / 2, this.y + this.height / 2]
    }
    ;
    var m = 4
      , f = 10;
    i.prototype._moveBoxAround = function(e, t, i) {
        var n, o;
        switch (i) {
        case 0:
            n = t.x + t.width - f,
            o = t.y - e.height;
            break;
        case 1:
            n = t.x - e.width + f,
            o = t.y - e.height;
            break;
        case 2:
            n = t.x - e.width + f,
            o = t.y + t.height;
            break;
        case 3:
            n = t.x + t.width - f,
            o = t.y + t.height;
            break;
        default:
            return console.error(new Error("invalid _moveBoxAround index" + i))
        }
        e.x = Math.round(n),
        e.y = Math.round(o)
    }
    ,
    i.prototype._computeWeight = function(e, t, i) {
        if (e.x < this.originX + s || e.y < this.originY + s)
            return 1 / 0;
        if (e.x + e.width > this.originX + this.width - s || e.y + e.height > this.originY + this.height - s)
            return 1 / 0;
        for (var n = 0, o = this.boxes.length - 1; o >= 0; o--) {
            var a = this.boxes[o];
            if (a !== t) {
                var r = e.intersectingSurface(a);
                if (r) {
                    if (!a.priority)
                        return 1 / 0;
                    if (n += r / a.priority,
                    n >= i)
                        return n
                }
            }
        }
        return n
    }
    ,
    i.prototype._addBoxNextToTarget = function(e, t, i) {
        for (var o = new n(0,0,t,i,h), s = 1 / 0, r = 0, l = 0; l < m; l++) {
            this._moveBoxAround(o, e, l);
            var c = this._computeWeight(o, e, s);
            if (c < s && (s = c,
            r = l,
            0 === c))
                break
        }
        return 0 !== s && this._moveBoxAround(o, e, r),
        o.x += 2 * a * (Math.random() - .5),
        o.y += 2 * a * (Math.random() - .5),
        o.setAsSubboxOf(e),
        this.boxes.push(o),
        o
    }
    ,
    i.prototype._newActorBox = function(e, t) {
        var i = window.foreground
          , s = o(e)
          , a = i.convertSceneToScreenCoordinate(s[0], s[2])
          , r = i.convertSceneToScreenCoordinate(s[1], s[3])
          , l = r.x - a.x
          , c = r.y - a.y
          , u = new n(a.x,a.y,l,c,t,e.actorId);
        return this.boxes.push(u),
        u
    }
    ,
    i.prototype.addBoxNextToActor = function(e, t) {
        this._updateActors();
        var i = this._getActorBox(e);
        i || (i = this._newActorBox(e, u));
        var n = t.rootElement;
        return this._addBoxNextToTarget(i, n.clientWidth, n.clientHeight)
    }
    ,
    i.prototype.addObstacle = function(e, t, i, o) {
        var s = new n(e,t,i,o,r);
        return this.boxes.push(s),
        s
    }
    ,
    i.prototype.removeBox = function(e) {
        var t = this.boxes.indexOf(e);
        t < 0 || this.boxes.splice(t, 1)
    }
    ,
    i.prototype._removeActors = function() {
        for (var e = [], t = this.boxes.length - 1; t >= 0; t--) {
            var i = this.boxes[t];
            i.actorId || e.push(i)
        }
        this.boxes = e
    }
    ,
    i.prototype._updateActors = function() {
        this.lastUpdateTime = Date.now(),
        this._removeActors(),
        this._newActorBox(window.actorManager.userActor, l);
        var e = window.actorManager.actors;
        for (var t in e) {
            var i = e[t]
              , n = i.data;
            n && !n.staticInfos && this._newActorBox(i, n.npcId ? c : u)
        }
    }
    ,
    i.prototype._getActorBox = function(e) {
        for (var t = e.actorId, i = this.boxes.length - 1; i >= 0; i--) {
            var n = this.boxes[i];
            if (n.actorId === t)
                return n
        }
        return null
    }
}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "ChallengeIndicator",
            hidden: !0
        }),
        r(this),
        this.neverShowedYet = !0,
        this.challengeSlot = this.createChild("div", {
            className: "challengeSlot"
        }),
        this.challenges = {},
        this.challengesResult = {},
        this._registerListeners(window.gui)
    }
    i(438);
    var o = i(24).dimensions
      , s = i(26).inherits
      , a = i(190)
      , r = i(439)
      , l = i(35).getText
      , c = i(206).addTooltip
      , u = i(5)
      , h = i(441).highlightCells
      , d = i(49);
    s(n, a),
    e.exports = n,
    n.prototype._registerListeners = function(e) {
        var t = this;
        e.on("ChallengeInfoMessage", function(e) {
            t.setChallenge(e)
        }),
        e.on("ChallengeResultMessage", function(e) {
            return t.challenges[e.challengeId] ? void t.setChallengeResult(e) : void (t.challengesResult[e.challengeId] = e)
        }),
        d.on("ChallengeTargetsListMessage", function(e) {
            h(e)
        }),
        e.on("GameFightEndMessage", function() {
            t.hide(),
            t.reset()
        }),
        e.on("GameFightJoinMessage", function() {}),
        e.on("disconnect", function() {
            t.hide(),
            t.reset()
        })
    }
    ,
    n.prototype.setChallenge = function(e) {
        var t = this
          , i = e
          , n = window.gui.fightManager.getFighter(i.targetId);
        if (n && (i._targetFighter = n,
        i._targetFighter)) {
            var s = i._targetFighter.name + " (" + l("ui.common.level") + " " + i._targetFighter.level + ")";
            i._description = i._description.replace("%1", s)
        }
        var r = this.challengeSlot.createChild("div", {
            className: "challengeIcon"
        });
        r.challengeState = r.createChild("div", {
            className: "challengeState"
        });
        var h = new a("div",{
            className: "challengeDetails",
            name: "challengeDetails"
        });
        h.challengeName = h.createChild("div", {
            className: "challengeName",
            text: i._name
        }),
        h.challengeDesc = h.createChild("div", {
            className: "challengeDesc",
            text: i._description
        }),
        h.challengeLoot = h.createChild("div", {
            className: "challengeLoot",
            text: l("ui.common.loot") + " +" + i.dropBonus + "%"
        }),
        h.challengeXp = h.createChild("div", {
            className: "challengeXp",
            text: l("ui.common.xp") + " +" + i.xpBonus + "%"
        }),
        h.challengeStatus = h.createChild("div", {
            className: "challengeStatus",
            text: l("ui.fight.challenge.inProgress")
        }),
        c(r, h);
        var d = e.challengeId;
        r.on("tap", function() {
            window.dofus.sendMessage("ChallengeTargetsListRequestMessage", {
                challengeId: d
            })
        }),
        this.challenges[d] = {
            icon: r,
            details: h,
            data: i
        },
        i.iconUrl = "none",
        u.preloadImage("gfx/challenges/" + d + ".png", function(e) {
            r.setStyle("backgroundImage", e),
            i.iconUrl = e,
            t.show()
        });
        var p = this.challengesResult[d];
        p && this.setChallengeResult(p),
        this.neverShowedYet && (this.neverShowedYet = !1,
        this.setStyle("left", o.mapLeft + "px"))
    }
    ,
    n.prototype.setChallengeResult = function(e) {
        var t = this.challenges[e.challengeId];
        e.success ? (t.icon.challengeState.addClassNames("success"),
        t.details.challengeStatus.addClassNames("success"),
        t.details.challengeStatus.setText(l("ui.fight.challenge.complete"))) : (t.icon.challengeState.addClassNames("fail"),
        t.details.challengeStatus.addClassNames("fail"),
        t.details.challengeStatus.setText(l("ui.fight.challenge.failed"))),
        t.data.success = e.success
    }
    ,
    n.prototype.reset = function() {
        for (var e in this.challenges)
            this.challenges[e].icon.destroy(),
            this.challenges[e].details.destroy(),
            delete this.challenges[e];
        this.challengesResult = {}
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        function i() {
            t.isFullScreen ? (d = 0,
            m = 0,
            p = o.screenWidth,
            f = o.screenHeight) : (d = o.mapLeft,
            m = o.mapTop,
            p = o.mapRight,
            f = o.mapBottom),
            h()
        }
        function n() {
            b = Math.max(d, Math.min(I, b)),
            C = Math.max(m, Math.min(T, C)),
            r()
        }
        function r() {
            S = b === d,
            A = C === m,
            E = b === I,
            x = C === T,
            e.toggleClassName("magnetLeft", S),
            e.toggleClassName("magnetTop", A),
            e.toggleClassName("magnetRight", E),
            e.toggleClassName("magnetBottom", x),
            e.toggleClassName("magnetFloating", !(S || A || E || x))
        }
        function l() {
            S && (b = d),
            A && (C = m),
            E && (b = I),
            x && (C = T)
        }
        function c() {
            e.setStyles({
                webkitTransform: "",
                left: b + "px",
                top: C + "px",
                right: "initial",
                bottom: "initial"
            }),
            r()
        }
        function u() {
            var t = e.rootElement.clientWidth
              , i = e.rootElement.clientHeight;
            return !(!t || !i) && (b = e.rootElement.offsetLeft,
            C = e.rootElement.offsetTop,
            I = p - t,
            T = f - i,
            !0)
        }
        function h() {
            M = !1,
            u() && (n(),
            l(),
            c())
        }
        t = t || {};
        var d, p, m, f, g = t.grip || e.createChild("div", {
            className: "gripHandler"
        });
        s(g);
        var _, v, y, w, b, C, I, T, S, A, E, x;
        g.on("slideStart", function(t) {
            _ = t.x,
            v = t.y,
            u(),
            y = b,
            w = C,
            e.addClassNames("dragging"),
            e.emit("dragStart")
        }),
        g.on("slide", function(t) {
            b = y + t.x - _,
            C = w + t.y - v,
            n();
            var i = b - y
              , o = C - w;
            e.setStyle("webkitTransform", "translate3d(" + i + "px, " + o + "px, 0)")
        }),
        g.on("slideEnd", function() {
            c(),
            e.delClassNames("dragging"),
            e.emit("dragEnd")
        });
        var M = !1;
        i(),
        window.gui.on("resize", i),
        t.isCollapsable && (g.createChild("div", {
            className: "collapseBtn"
        }),
        a(g),
        g.on("tap", function() {
            e.collapse(!e.isCollapsed)
        }),
        e.isCollapsed = !1,
        e.collapse = function(t, i) {
            e.isCollapsed = t,
            e.toggleClassName("collapsed", t),
            M = !0,
            i || e.emit("collapse", t),
            M && h()
        }
        ),
        e.on("resized", h)
    }
    i(440);
    var o = i(24).dimensions
      , s = i(48)
      , a = i(32);
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    t.highlightCells = function(e) {
        for (var t in window.gui.challengeIndicator.challenges) {
            var i = window.gui.challengeIndicator.challenges[t]
              , n = i.data.challengeId;
            switch (n) {
            case 3:
            case 4:
            case 32:
            case 34:
            case 35:
                if (i.data._targetFighter) {
                    var o = e.targetCells[0];
                    window.gui.pingSystem.addPingPicto(o, "attack")
                }
            }
        }
    }
}
, function(e, t, i) {
    function n(e) {
        for (var t = 0, i = 0; i < e.length; i++)
            t += e.charCodeAt(i) % 16;
        return (t % 16).toString(16).toUpperCase()
    }
    function o() {
        var e = Math.ceil(100 * Math.random());
        return e <= 40 ? String.fromCharCode(Math.floor(26 * Math.random()) + 65) : e <= 80 ? String.fromCharCode(Math.floor(26 * Math.random()) + 97) : String.fromCharCode(Math.floor(10 * Math.random()) + 48)
    }
    function s() {
        for (var e = "", t = 0; t < 20; t++)
            e += o();
        return e + n(e)
    }
    function a() {
        b = !0,
        window.gui.openSimplePopup(_("ui.common.cantSelectThisCharacter"), _("ui.popup.impossible_action")),
        window.dofus.sendMessage("CharactersListRequestMessage")
    }
    function r(e) {
        return m = e,
        C = e.characters,
        0 === C.length ? (y.closeAll(),
        y.open("characterCreation")) : w ? (w = !1,
        window.gui.playerData.accountCapabilities.tutorialAvailable ? void window.dofus.sendMessage("CharacterFirstSelectionMessage", {
            id: C[0].id,
            doTutorial: window.gui.tutorialManager.isTutorialRequired()
        }) : t.selectCharacter(C[0].id)) : b ? y.open("characterSelection", C) : "characterId" === v.connectMethod ? v.characterId ? t.selectCharacter(v.characterId) : (console.error(new Error("characterId is missing!")),
        void y.open("characterSelection", C)) : "lastCharacter" === v.connectMethod ? t.selectCharacter(C[0].id) : void y.open("characterSelection", C)
    }
    function l() {
        w = !1,
        b = !1,
        C = []
    }
    function c(e) {
        for (var t = 0; t < C.length; t++)
            if (C[t].id === e)
                return t;
        return -1
    }
    function u(e, t) {
        for (var i = 0; i < e.length; i++)
            if (e[i].id === t)
                return e[i];
        return null
    }
    function h(e) {
        if (f = null ,
        "CharactersListWithModificationsMessage" !== m._messageType)
            return !1;
        var t = {};
        if (m.charactersToRename.indexOf(e) >= 0)
            t.canRename = !0;
        else if (u(m.charactersToRecolor, e))
            t.canRecolor = !0;
        else {
            if (!u(m.charactersToRelook, e))
                return !1;
            t.canReface = !0
        }
        return t.characterToRelook = C[c(e)],
        y.getWindow("characterSelection").hide(),
        y.open("characterCreation", {
            relookingParams: t
        }),
        f = t,
        !0
    }
    function d(e) {
        f.canRename ? e.infos.name = g.name : f.canRecolor ? e.infos.entityLook.indexedColors = g.colors : f.canReface && (e.infos.entityLook.skins[1] = g.headSkin)
    }
    function p(e) {
        b = !1,
        y.close("characterSelection"),
        f && (y.close("characterCreation"),
        d(e)),
        window.gui.transmitMessage(e),
        window.actorManager.setUserCharacterData(e.infos),
        window.dofus.sendMessage("ClientKeyMessage", {
            key: I
        }),
        window.dofus.sendMessage("GameContextCreateRequestMessage");
    }
    var m, f, g, _ = i(35).getText, v = i(50), y = i(22), w = !1, b = !1, C = [], I = s();
    t.confirmNewCharacterCreation = function() {
        w = !0
    }
    ,
    t.confirmCharacterRelooking = function(e) {
        var t = f.characterToRelook.id;
        g = e,
        f.canRename ? window.dofus.sendMessage("CharacterSelectionWithRenameMessage", {
            id: t,
            name: e.name
        }) : f.canRecolor ? window.dofus.sendMessage("CharacterSelectionWithRecolorMessage", {
            id: t,
            indexedColor: e.colors
        }) : f.canReface && window.dofus.sendMessage("CharacterSelectionWithRelookMessage", {
            id: t,
            cosmeticId: e.cosmeticId
        })
    }
    ,
    t.selectCharacter = function(e) {
        h(e) || window.dofus.sendMessage("CharacterSelectionMessage", {
            id: e
        })
    }
    ,
    t.backToSelection = function() {
        return y.closeAll(),
        0 === C.length ? y.open("serverSelection") : void y.open("characterSelection", C)
    }
    ,
    t.initialize = function(e) {
        var t = window.dofus.connectionManager;
        t.on("CharacterSelectedForceMessage", function() {
            window.dofus.sendMessage("CharacterSelectedForceReadyMessage")
        }),
        t.on("CharactersListMessage", r),
        t.on("CharactersListWithModificationsMessage", r),
        t.on("CharacterSelectedSuccessMessage", p),
        t.on("CharacterSelectedErrorMessage", a),
        e.on("disconnect", l)
    }
    ,
    t.getCharacterList = function() {
        return C
    }
}
, function(e, t, i) {
    function n() {
        R.call(this, "div", {
            className: "chat"
        }),
        this.displayMode = V.ROLEPLAY,
        this.keyboardHeight = .6 * p.screenHeight,
        this.previousInput = "",
        this.linksToReplace = [],
        this.enabledChannels = null ,
        this.disallowedChannelMap = null ,
        this.presets = null ,
        this.channelMap = window.gui.databases.ChatChannels,
        this.numPresetsListeningToChannel = null ,
        this.outgoingChannel = B,
        this.outgoingChannelMenu = null ,
        this.previousPrivateReceiver = "",
        this.historyBuffers = {},
        this.historyBuffers[F] = new v(Q);
        for (var e in this.channelMap)
            this.historyBuffers[~~e] = new v(Q);
        this.initializeElements(),
        this.setMessageHandlers()
    }
    function o(e, t) {
        var i = e.getValue()
          , n = i.substr(0, t.length);
        n === t && e.setValue(i.substr(t.length))
    }
    function s(e, t) {
        var i = e.getValue();
        i.substr(0, t.length) !== t && e.setValue(t + i)
    }
    function a(e) {
        var t = this.chat;
        t._toggleChannel(t.activePreset, ~~this.id, e)
    }
    function r() {
        var e = this.chat
          , t = this.presetId;
        t === e.activePreset ? e._togglePresetChannels(t) : e._setActivePreset(t)
    }
    i(444);
    var l = i(204)
      , c = i(235)
      , u = i(445)
      , h = i(448)
      , d = i(7)
      , p = i(24).dimensions
      , m = l.DofusButton
      , f = i(218)
      , g = i(203).getElementPositionAround
      , _ = i(35).getText
      , v = i(450)
      , y = i(451)
      , w = i(26).inherits
      , b = i(391)
      , C = i(301)
      , I = i(212)
      , T = i(302)
      , S = i(454)
      , A = i(32)
      , E = i(206)
      , x = i(31)
      , M = i(30)
      , N = i(404)
      , R = i(190)
      , O = i(455)
      , P = i(456)
      , D = i(459)
      , L = i(25)
      , B = c.CHANNEL_GLOBAL
      , k = c.PSEUDO_CHANNEL_PRIVATE
      , F = 666
      , H = 0
      , G = 1
      , U = 2
      , j = 3
      , q = [c.CHANNEL_GLOBAL, c.CHANNEL_TEAM, c.CHANNEL_GUILD, c.CHANNEL_ALLIANCE, c.CHANNEL_PARTY, c.CHANNEL_NOOB, c.CHANNEL_ADMIN, c.PSEUDO_CHANNEL_PRIVATE, c.CHANNEL_ARENA, c.CHANNEL_SALES, c.CHANNEL_SEEK]
      , W = {};
    W[c.PSEUDO_CHANNEL_FIGHT_LOG] = !0;
    var V = {
        ROLEPLAY: "roleplay",
        FIGHT: "fight"
    }
      , z = /^\/([A-Za-z]+)/
      , Y = {
        s: B,
        w: k,
        t: c.CHANNEL_TEAM,
        g: c.CHANNEL_GUILD,
        a: c.CHANNEL_ALLIANCE,
        p: c.CHANNEL_PARTY,
        i: c.CHANNEL_NOOB,
        q: c.CHANNEL_ADMIN,
        k: c.CHANNEL_ARENA,
        b: c.CHANNEL_SALES,
        r: c.CHANNEL_SEEK
    }
      , X = "chatIncomingPreset_"
      , Q = 50;
    w(n, R),
    e.exports = n,
    n.prototype._initialize = function(e, t) {
        this.setDisplayMode(V.ROLEPLAY),
        this.statusIndicator.initialize(),
        this.previousInput = "",
        this.previousPrivateReceiver = "",
        this._selectOutgoingChannel(B, !0),
        this.enabledChannels = e,
        this._initOutgoingChannelMenu(),
        this.disallowedChannelMap = {};
        for (var i = 0; i < t.length; i++)
            this.disallowedChannelMap[t[i]] = !0;
        this._loadPresetConfig(),
        this._setActivePreset(H),
        this._clearChatHistory()
    }
    ,
    n.prototype._clearChatHistory = function() {
        this._logChat.clearContent();
        for (var e in this.historyBuffers)
            this.historyBuffers[~~e].clear()
    }
    ,
    n.prototype.initializeElements = function() {
        var e = this;
        this.savedWidth = null ,
        this.savedHeight = null ,
        this.logWrapper = this.createChild("div", {
            className: "logWrapper"
        }),
        this.fightControls = this.logWrapper.createChild("div", {
            className: "fightControls"
        }),
        this.timelineBox = this.fightControls.createChild("div", {
            className: "timelineBox"
        });
        var t = this.fightControls.createChild("div", {
            className: "fightButtons"
        })
          , i = new m("",{
            className: "yourTurnButton",
            hidden: !0
        },function() {
            e.deactivate()
        }
        )
          , n = this.createChild("div", {
            className: "yourTurnText"
        });
        n.setText(_("tablet.chat.yourTurnButton")),
        i.appendChild(n),
        this.yourTurnButton = t.appendChild(i),
        this.logScroller = this.logWrapper.appendChild(new T({
            className: "log"
        },{
            showHintArrows: !0
        })),
        this._logChat = this.logScroller.content,
        this._logChat.addClassNames("showChannel666");
        var o = this.logWrapper.createChild("div", {
            className: "formChat"
        });
        this._createChannelSelector(o),
        this.inputChat = o.appendChild(new b({
            className: "inputChat",
            attr: {
                maxlength: 4 + I.MAX_NICK_LEN + I.USER_MAX_CHAT_LEN
            }
        })),
        this.inputChat.on("validate", function() {
            e.submit()
        }),
        this.statusIndicator = new S(o);
        var s = new u;
        o.appendChild(s),
        s.on("activated", function() {
            s.positionPanel()
        }),
        this.logWrapper.appendChild(new N({
            className: ["simpleButton", "chatCloseButton"]
        },function() {
            e.deactivate()
        }
        )),
        D(this.logWrapper, {
            minWidth: 450,
            minHeight: 275
        }),
        this.logWrapper.on("resize", function() {
            e._refreshScroller()
        })
    }
    ,
    n.prototype._createChannelSelector = function(e) {
        function t() {
            i._selectOutgoingChannel(this.id),
            i.inputChat.focus()
        }
        for (var i = this, n = this.outgoingChannelMenu = [], o = 0; o < q.length; o++) {
            var s = this.channelMap[q[o]];
            n.push({
                id: s.id,
                caption: s.nameId + " (" + s.shortcut + ")",
                cb: t,
                ticked: s.id === this.outgoingChannel
            })
        }
        this.outgoingChannelButtonBg = e.createChild("div", {
            className: "buttonBackground"
        }),
        e.createChild("div", {
            className: "outgoingChannelButton"
        });
        var a = e.createChild("div", {
            className: "buttonTouchZone"
        });
        E.addTooltip(a, _("ui.option.chat")),
        a.on("tap", function() {
            var e = this.rootElement.getBoundingClientRect();
            window.gui.openContextualMenu("generic", {
                title: _("ui.option.currentChannel"),
                actions: i.outgoingChannelMenu
            }, {
                x: e.left + e.width,
                y: e.top
            })
        })
    }
    ,
    n.prototype._showNotification = function(e) {
        E.showNotification(e, this.outgoingChannelButtonBg)
    }
    ,
    n.prototype._initOutgoingChannelMenu = function() {
        for (var e = this.outgoingChannelMenu, t = 0; t < e.length; t++) {
            var i = e[t];
            i.hidden = this.enabledChannels.indexOf(i.id) < 0,
            i.ticked = i.id === this.outgoingChannel
        }
    }
    ,
    n.prototype._getOutgoingChannelMenuOption = function(e) {
        for (var t = this.outgoingChannelMenu, i = 0; i < t.length; i++)
            if (t[i].id === e)
                return t[i]
    }
    ,
    n.prototype._selectOutgoingChannel = function(e, t) {
        var i = this.outgoingChannel;
        (e !== i || t) && (t && e !== k && this.inputChat.setValue(""),
        i === k && o(this.inputChat, this.previousPrivateReceiver + " "),
        e === k && this.previousPrivateReceiver && s(this.inputChat, this.previousPrivateReceiver + " "),
        this.inputChat.setClassNames(["inputChat", "inputBox", "channel" + e]),
        this.outgoingChannelButtonBg.setClassNames(["buttonBackground", "outgoingChannel" + e]),
        e === k && (this.previousPrivateReceiver ? this._showNotification(_("tablet.chat.enteringPrivateChannel", this.previousPrivateReceiver)) : this._showNotification(_("tablet.chat.privateReceiverHelp"))),
        this._getOutgoingChannelMenuOption(i).ticked = !1,
        this._getOutgoingChannelMenuOption(e).ticked = !0,
        this.outgoingChannel = e)
    }
    ,
    n.prototype._setChannelEnabled = function(e, t) {
        var i = this._getOutgoingChannelMenuOption(e);
        i && (i.hidden = !t);
        var n = this.channelMap[e].nameId
          , o = this.enabledChannels
          , s = o.indexOf(e);
        if (s !== -1) {
            if (this._showNotification(_("tablet.chat.disablingChannel", n)),
            t)
                return console.warn("Chat channel already enabled");
            o.splice(s, 1)
        } else {
            if (this._showNotification(_("tablet.chat.enablingChannel", n)),
            !t)
                return console.warn("Chat channel already disabled");
            o.push(e)
        }
    }
    ,
    n.prototype._updateChannelListenerCount = function(e, t) {
        var i = this.numPresetsListeningToChannel[e]
          , n = Math.max(i + t, 0);
        this.numPresetsListeningToChannel[e] = n,
        W[e] || (0 === i && n > 0 ? window.dofus.sendMessage("ChannelEnablingMessage", {
            channel: e,
            enable: !0
        }) : i > 0 && 0 === n && window.dofus.sendMessage("ChannelEnablingMessage", {
            channel: e,
            enable: !1
        }))
    }
    ,
    n.prototype._toggleChannel = function(e, t, i) {
        this._setChannelInPreset(e, t, i),
        this._updateChannelListenerCount(t, i ? 1 : -1)
    }
    ,
    n.prototype._addPreset = function(e) {
        var t = this.presetButtons.createChild("div", {
            className: "presetButton"
        });
        t.createChild("div", {
            className: ["presetIcon", e.className]
        }),
        t.chat = this,
        t.presetId = this.presets.length,
        A(t),
        t.on("tap", r);
        for (var i, n = [], o = 0; o < e.channels.length; o++)
            i = e.channels[o],
            n.push(i);
        var s = {
            element: t,
            channels: n,
            channelsList: this.channelsLists.createChild("div", {
                className: "channelsList"
            })
        };
        this.presets.push(s);
        for (var l in this.channelMap) {
            i = ~~l;
            var c = s.channelsList.appendChild(new h(this.channelMap[i].nameId));
            c.id = i,
            c.chat = this,
            c.addClassNames("channel" + c.id),
            c.on("change", a)
        }
    }
    ,
    n.prototype._createPresets = function(e) {
        this.presets = [],
        this.activePreset = null ,
        this.presetButtons = this.logWrapper.createChild("div", {
            className: "presetButtons"
        }),
        this.channelsLists = this.logWrapper.createChild("div", {
            className: "channelsLists"
        });
        for (var t = 0; t < e.length; t++)
            this._addPreset(e[t])
    }
    ,
    n.prototype._setChannelInPreset = function(e, t, i) {
        var n = this.presets[e].channels
          , o = !1
          , s = n.indexOf(t);
        s === -1 || i ? s === -1 && i && (n.push(t),
        o = !0) : (n.splice(s, 1),
        o = !0),
        o && (e === this.activePreset && this._updateLogFilter(),
        M.setValue(X + e, n))
    }
    ,
    n.prototype._updatePresets = function(e) {
        var t = this.numPresetsListeningToChannel = {};
        for (var i in this.channelMap)
            t[~~i] = 0;
        for (var n, o, s = e.length - 1; s >= 0; s--) {
            var a = this.presets[s];
            o = a.channelsList.getChildren();
            var r = 0;
            for (i in this.channelMap) {
                n = ~~i;
                var l = this.enabledChannels.indexOf(n) >= 0
                  , c = a.channels.indexOf(n) >= 0
                  , u = o[r];
                r++,
                this.disallowedChannelMap[n] ? u.hide() : (W[n] || (!l || c || 0 !== s || t[n] || (this._setChannelInPreset(s, n, !0),
                c = !0),
                !l && c && (this._setChannelInPreset(s, n, !1),
                c = !1)),
                c ? (u.activate(!0),
                t[n]++) : u.deactivate(!0))
            }
        }
    }
    ,
    n.prototype._loadPresetConfig = function() {
        var e = [];
        e.push({
            className: "preset1",
            channels: M.getValue(X + H, [c.CHANNEL_GLOBAL, c.CHANNEL_TEAM, c.CHANNEL_GUILD, c.CHANNEL_ALLIANCE, c.CHANNEL_PARTY, c.CHANNEL_NOOB, c.PSEUDO_CHANNEL_PRIVATE, c.PSEUDO_CHANNEL_INFO, c.PSEUDO_CHANNEL_FIGHT_LOG, c.CHANNEL_ADS, c.CHANNEL_ARENA])
        }),
        e.push({
            className: "preset2",
            channels: M.getValue(X + G, [c.PSEUDO_CHANNEL_FIGHT_LOG])
        }),
        e.push({
            className: "preset3",
            channels: M.getValue(X + U, [c.PSEUDO_CHANNEL_PRIVATE])
        }),
        e.push({
            className: "preset4",
            channels: M.getValue(X + j, [c.CHANNEL_GUILD, c.CHANNEL_SALES, c.CHANNEL_SEEK])
        }),
        this.presets || this._createPresets(e),
        this._updatePresets(e)
    }
    ,
    n.prototype._showMsgAsBubble = function(e) {
        if (e.channel === k)
            return !1;
        if (!window.gui.playerData.isFighting || L.showSpeechBubbleInFight) {
            var t = window.actorManager.getActor(e.senderId);
            return !!t && (window.gui.newSpeechBubble({
                actor: t,
                msg: e.content,
                channel: e.channel
            }),
            !0)
        }
    }
    ,
    n.prototype._createMessageContent = function(e, t) {
        var i = new R("div",{
            className: "message"
        });
        if (i.addClassNames("channel" + e.channel),
        e.channel !== B && e.channel !== k && i.createChild("span", {
            text: "(" + this.channelMap[e.channel].nameId + ") "
        }),
        e.channel === k) {
            var n = _(t ? "ui.chat.to" : "ui.chat.from");
            i.createChild("span", {
                text: n + " "
            })
        }
        var o = y.process("{player," + (t ? e.receiverName : e.senderName) + "," + (t ? e.receiverId : e.senderId) + "}: ");
        return i.appendChild(o),
        i.appendChild(y.process(e.content)),
        i
    }
    ,
    n.prototype._createMessageContentFromText = function(e, t) {
        var i = new R("div",{
            className: "message"
        });
        return i.addClassNames("channel" + t),
        i.appendChild(y.process(e)),
        i
    }
    ,
    n.prototype._addMsgToChat = function(e, t) {
        var i = this._logChat.appendChild(e)
          , n = this.historyBuffers[t].push(i);
        n && this._logChat.removeChild(n),
        this._refreshScroller(!0)
    }
    ,
    n.prototype._logNewMessage = function(e, t) {
        e.content = this._getUriDecodedString(e.content);
        var i = this._createMessageContent(e, t);
        if (this._addMsgToChat(i, e.channel),
        this.isChannelEnabledInPreset(e.channel) && !this._showMsgAsBubble(e)) {
            var n = this._createMessageContent(e, t);
            window.gui.textNotification.add(n, {
                channel: e.channel
            })
        }
    }
    ,
    n.prototype._logServerText = function(e, t) {
        t = t || {};
        var i = void 0 !== t.channel ? t.channel : c.PSEUDO_CHANNEL_INFO
          , n = this._createMessageContentFromText(e, i)
          , o = this._createMessageContentFromText(e, i);
        this._addMsgToChat(n, i),
        window.gui.textNotification.add(o, {
            channel: i
        })
    }
    ,
    n.prototype.logMsg = function(e, t) {
        if (void 0 === t && (t = c.PSEUDO_CHANNEL_INFO),
        !this.isChannelEnabledInPreset(t)) {
            var i = this._createMessageContentFromText(e, t);
            return this._addMsgToChat(i, t)
        }
        this._logServerText(e, {
            channel: t
        })
    }
    ,
    n.prototype.logError = function(e) {
        this._logServerText(e, {
            channel: F
        })
    }
    ,
    n.prototype.insertLink = function(e, t) {
        var i, n;
        switch (e) {
        case "recipe":
            i = "[" + _("ui.common.recipes", 1) + _("ui.common.colon") + t.getName() + "]",
            n = "{recipe," + t.getProperty("id") + "}";
            break;
        default:
            return console.error(new Error("Invalid link type: " + e))
        }
        this.inputChat.setValue(this.inputChat.getValue() + " " + i + " "),
        this.linksToReplace.push([i, n])
    }
    ,
    n.prototype._refreshScroller = function(e) {
        var t = !this.logScroller.canScrollDown();
        return this.logScroller.refresh(),
        e && !t ? this.logScroller.notify() : void this.logScroller.goToBottom()
    }
    ,
    n.prototype._togglePresetChannels = function(e) {
        if (this.channelsLists.toggleDisplay(),
        !this.channelsLists.isVisible())
            return this._refreshScroller();
        var t = this.presets[e]
          , i = g(t.channelsList, t.element);
        t.channelsList.setStyles({
            left: i.x + "px",
            top: i.y + "px"
        })
    }
    ,
    n.prototype._setActivePreset = function(e) {
        this.activePreset = e,
        this.channelsLists.hide();
        for (var t = 0; t < this.presets.length; t++) {
            var i = this.presets[t];
            i.element.toggleClassName("on", t === e),
            i.channelsList.toggleDisplay(t === e)
        }
        this._updateLogFilter(),
        this._refreshScroller()
    }
    ,
    n.prototype.isChannelEnabledInPreset = function(e) {
        var t = this.presets[this.activePreset].channels;
        return t.indexOf(e) !== -1
    }
    ,
    n.prototype._updateLogFilter = function() {
        for (var e = this.presets[this.activePreset].channels, t = Object.keys(c).length, i = 0; i <= t; i++)
            this._logChat.toggleClassName("showChannel" + i, e.indexOf(i) !== -1)
    }
    ,
    n.prototype.setMessageHandlers = function() {
        function e(e) {
            var t = n.playerData.characters.canControlCharacterId(e.id);
            i.yourTurnButton.toggleDisplay(t)
        }
        function t() {
            i.yourTurnButton.hide()
        }
        var i = this
          , n = window.gui
          , o = window.dofus.connectionManager;
        o.on("EnabledChannelsMessage", function(e) {
            i._initialize(e.channels, e.disallowed)
        }),
        o.on("ChannelEnablingChangeMessage", function(e) {
            i._setChannelEnabled(e.channel, e.enable)
        }),
        o.on("ChatServerWithObjectMessage", function(e) {
            i._logNewMessage(e, !1)
        }),
        o.on("ChatServerCopyWithObjectMessage", function(e) {
            i._logNewMessage(e, !0)
        }),
        o.on("ChatServerMessage", function(e) {
            i._logNewMessage(e, !1)
        }),
        o.on("EntityTalkMessage", function(e) {
            var t = window.actorManager.getActorFromNpcId(e.entityId);
            window.gui.newSpeechBubble({
                actor: t,
                msg: e.text
            })
        }),
        o.on("ChatAdminServerMessage", function(e) {
            i._logServerText(e.content, {
                channel: c.CHANNEL_ADMIN
            })
        }),
        o.on("ChatServerCopyMessage", function(e) {
            i._logNewMessage(e, !0)
        }),
        o.on("ChatErrorMessage", function(e) {
            i._showNotification(e.reason),
            i._setInput(i.previousInput, !0)
        }),
        o.on("BasicWhoIsMessage", function(e) {
            e.verbose && i._logServerText(P(e))
        }),
        o.on("BasicWhoIsNoMatchMessage", function(e) {
            i._logServerText(_("ui.common.playerNotFound", e.search))
        }),
        o.on("CharacterExperienceGainMessage", function(e) {
            e.experienceCharacter && i.logMsg(_("ui.stats.xpgain.mine", e.experienceCharacter)),
            e.experienceGuild && i.logMsg(_("ui.stats.xpgain.guild", e.experienceGuild)),
            e.experienceIncarnation && i.logMsg(_("ui.stats.xpgain.incarnation", e.experienceIncarnation)),
            e.experienceMount && i.logMsg(_("ui.stats.xpgain.mount", e.experienceMount))
        }),
        n.fightManager.on("fightEnterPreparation", function() {
            i.deactivate()
        }),
        n.fightManager.on("fightStart", function() {
            i.yourTurnButton.hide(),
            i.setDisplayMode(V.FIGHT)
        }),
        n.fightManager.on(f.FIGHT_END, function() {
            t(),
            i.setDisplayMode(V.ROLEPLAY)
        }),
        n.on("GameFightTurnStartMessage", e),
        n.on("GameFightTurnResumeMessage", e),
        n.on("GameFightTurnStartSlaveMessage", e),
        n.on("GameFightTurnEndMessage", t),
        n.on("resize", function() {
            i._resize()
        }),
        n.on("disconnect", function() {
            i.deactivate()
        }),
        C.on("show", function(e) {
            i.keyboardHeight = e,
            i.setDimensions()
        }),
        C.on("hide", function() {
            n.playerData.isFighting && i.deactivate()
        })
    }
    ,
    n.prototype.setDisplayMode = function(e) {
        if (this.displayMode !== e) {
            if (!this.active)
                return void (this.displayMode = e);
            this.removeDisplayMode(),
            this.displayMode = e,
            this.addDisplayMode(),
            this.setDimensions()
        }
    }
    ,
    n.prototype.removeDisplayMode = function() {
        switch (this.displayMode) {
        case V.FIGHT:
            window.gui.timeline.restoreFighterList(),
            this.delClassNames("fightMode")
        }
    }
    ,
    n.prototype.addDisplayMode = function() {
        this.displayMode === V.FIGHT && (this.addClassNames("fightMode"),
        window.gui.timeline.appendFighterListTo(this.timelineBox))
    }
    ,
    n.prototype.setDimensions = function() {
        switch (this.displayMode) {
        case V.FIGHT:
            this.logWrapper.windowWidth = p.screenWidth;
            var e = p.physicalScreenHeight - this.keyboardHeight;
            this.logWrapper.windowHeight = e * p.physicalToViewportRatio,
            this.logWrapper.resizeHandle.hide();
            break;
        default:
            this.logWrapper.windowWidth = this.savedWidth || Math.round(.45 * p.mapWidth),
            this.logWrapper.windowHeight = this.savedHeight || Math.round(.45 * p.mapHeight),
            this.logWrapper.resizeHandle.show()
        }
        this.logWrapper.setStyles({
            width: this.logWrapper.windowWidth + "px",
            height: this.logWrapper.windowHeight + "px"
        }),
        this._refreshScroller()
    }
    ,
    n.prototype.sendChatMessage = function(e, t, i) {
        i ? window.dofus.sendMessage("ChatClientPrivateMessage", {
            content: this._getUriEncodedString(e),
            receiver: i
        }) : window.dofus.sendMessage("ChatClientMultiMessage", {
            content: this._getUriEncodedString(e),
            channel: t
        })
    }
    ,
    n.prototype._getUriEncodedString = function(e) {
        for (var t = "", i = 0; i < e.length; i++) {
            var n = e.charCodeAt(i);
            if (n > 255) {
                var o = escape(e[i]);
                t += o
            } else
                t += e[i]
        }
        return t
    }
    ,
    n.prototype._getUriDecodedString = function(e) {
        return unescape(e)
    }
    ,
    n.prototype.submit = function() {
        this.logScroller.goToBottom();
        var e = this.inputChat.getValue().trim()
          , t = this.outgoingChannel
          , i = null
          , n = z.exec(e);
        if (n) {
            n = n[1].toLowerCase();
            var o = e.split(" ").slice(1)
              , s = O(n, o);
            if (s)
                return void this._setInput("");
            if (t = Y[n],
            void 0 === t)
                return this._showNotification(_("ui.console.notfound", e.substr(1).split(" ")[0]));
            e = e.substr(n.length + 2)
        }
        if (t === k) {
            var a = e.indexOf(" ");
            if (i = e.substr(0, a),
            e = e.substr(a),
            !i || !e || i.length < I.MIN_NICK_LEN || i.length > I.MAX_NICK_LEN)
                return this._showNotification(_("tablet.chat.privateReceiverHelp"));
            this.previousPrivateReceiver = i
        }
        if (e = e.trim()) {
            var r = e.length - I.USER_MAX_CHAT_LEN;
            if (r > 0)
                return this._showNotification(_("tablet.chat.messageTooLong", r));
            this.previousInput = e;
            for (var l = 0; l < this.linksToReplace.length; l++) {
                var c = this.linksToReplace[l];
                e = e.replace(c[0], c[1])
            }
            this.previousLinks = this.linksToReplace,
            this.linksToReplace = [],
            this.sendChatMessage(e, t, i),
            this._setInput("")
        }
    }
    ,
    n.prototype._setInput = function(e, t) {
        this.outgoingChannel === k && this.previousPrivateReceiver ? (this.inputChat.setValue(this.previousPrivateReceiver + " " + e),
        t && this.inputChat.setCaretPosition(this.previousPrivateReceiver.length)) : this.inputChat.setValue(e),
        t && (this.linksToReplace = this.previousLinks)
    }
    ,
    n.prototype.startPrivateMessage = function(e, t) {
        t && (e = "*" + e),
        this.outgoingChannel === k && e !== this.previousPrivateReceiver && o(this.inputChat, this.previousPrivateReceiver + " "),
        this.previousPrivateReceiver = e,
        this._selectOutgoingChannel(k, !0),
        this.activate()
    }
    ,
    n.prototype.activate = function() {
        var e = this;
        C.disableScroll(!0),
        this.addClassNames("open"),
        this.active = !0,
        d.isPhoneGap || this.setDimensions(),
        this.addDisplayMode(),
        this._refreshScroller(),
        window.gui.textNotification && window.gui.textNotification.hide(),
        x.tween(this, {
            webkitTransform: "translate3d(0, 0, 0)"
        }, {
            time: 200,
            delay: 0,
            easing: "ease-out"
        }, function() {
            e.inputChat.focus()
        }),
        C.setAutomaticHide(!1)
    }
    ,
    n.prototype.deactivate = function() {
        if (this.active) {
            this.active = !1,
            this.inputChat.blur(),
            C.disableScroll(!1),
            this.savedWidth = this.logWrapper.windowWidth,
            this.savedHeight = this.logWrapper.windowHeight;
            var e = this;
            x.tween(this, {
                webkitTransform: "translate3d(0, -" + this.logWrapper.windowHeight + "px, 0)"
            }, {
                time: 200,
                delay: 0,
                easing: "ease-out"
            }, function() {
                e.removeDisplayMode(),
                e.delClassNames("open")
            }),
            window.gui.textNotification && window.gui.textNotification.show(),
            this.channelsLists && this.channelsLists.hide(),
            C.setAutomaticHide(!0)
        }
    }
    ,
    n.prototype._resize = function() {
        var e = !this.logWrapper.windowHeight;
        this.setDimensions(),
        e && this.deactivate()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        var e = this;
        r.call(this, "div", {
            className: "ChatIcons"
        }),
        this.openPanel = null ;
        var t = this.createChild("div", {
            className: "buttons"
        });
        this.smileysButton = t.createChild("div", {
            className: "smileysButton",
            tooltip: s("ui.chat.smilies")
        }),
        this.attitudesButton = t.createChild("div", {
            className: "attitudesButton",
            tooltip: s("ui.common.emotes")
        }),
        o(this.smileysButton, s("ui.chat.smilies")),
        o(this.attitudesButton, s("ui.common.emotes"));
        var i = this.createChild("div");
        this.smileysPanel = i.createChild("div", {
            className: "smileysPanel"
        }),
        this.attitudesPanel = i.createChild("div", {
            className: "attitudesPanel"
        }),
        this.smileysPanel.hide(),
        this.attitudesPanel.hide(),
        this.smileysButton.on("tap", function() {
            h.hide(),
            "smileys" === e.openPanel ? e.closePanels() : (e.openSmileys(),
            e.emit("activated"))
        }),
        this.attitudesButton.on("tap", function() {
            h.hide(),
            "attitudes" === e.openPanel ? e.closePanels() : (e.openAttitudes(),
            e.emit("activated"))
        }),
        h.on("show", function() {
            "smileys" !== e.openPanel && "attitudes" !== e.openPanel || e.closePanels()
        }),
        this.once("open", this.loadIcons),
        this.attitudeList = {},
        this.currentMood = null ,
        this.previousMood = -1,
        this.setMessageHandlers()
    }
    i(446);
    var o = i(206).addTooltip
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(190)
      , l = i(32)
      , c = i(5)
      , u = i(203).getElementPositionAround
      , h = i(301)
      , d = i(447);
    a(n, r),
    e.exports = n,
    n.prototype.setMessageHandlers = function() {
        var e = this
          , t = window.gui;
        t.on("MoodSmileyResultMessage", function(i) {
            var n = i.resultCode;
            return n === d.MOOD_ERROR_UNKNOWN ? (e.setCurrentMood(e.previousMood),
            t.openSimplePopup(s("ui.smiley.errorMood"))) : n === d.MOOD_ERROR_FLOOD ? (e.setCurrentMood(e.previousMood),
            t.openSimplePopup(s("ui.smiley.errorFloodMood"))) : (e.setCurrentMood(i.smileyId),
            void (e.previousMood = i.smileyId))
        }),
        t.on("disconnect", function() {
            e.setCurrentMood(-1),
            e.previousMood = -1
        })
    }
    ,
    n.prototype.bindToPlayerEmoteData = function() {
        var e = this
          , t = window.gui.playerData.emoteData;
        t.on("emoteAdded", function(t) {
            c.preloadImage("gfx/emotes/" + t.id + ".png", function(i) {
                e.addAttitudeIcon(t, i)
            })
        }),
        t.on("emoteRemoved", function(t) {
            e.removeAttitudeIcon(t)
        }),
        t.on("emoteListUpdated", function(t) {
            e.loadEmotes(t)
        })
    }
    ,
    n.prototype.loadIcons = function() {
        var e = this;
        this.loadEmotes(window.gui.playerData.emoteData.list),
        this.smileysPanel.addClassNames("spinner");
        for (var t = window.gui.databases.Smileys, i = Object.keys(t), n = [], o = 0; o < i.length; o++)
            n.push("gfx/smilies/" + t[i[o]].gfxId + ".png");
        c.preloadImages(n, function(n) {
            for (var o = 0; o < n.length; o++)
                e.addSmileyIcon(t[i[o]], n[o]);
            e.smileysPanel.delClassNames("spinner")
        }),
        this.bindToPlayerEmoteData()
    }
    ,
    n.prototype.loadEmotes = function(e) {
        var t = this;
        this.attitudesPanel.clearContent(),
        this.attitudeList = {},
        this.attitudesPanel.addClassNames("spinner");
        var i = Object.keys(e);
        i = i.map(function(e) {
            return parseInt(e, 10)
        }),
        i = i.sort(function(e, t) {
            return e - t
        });
        for (var n = [], o = 0; o < i.length; o++)
            n.push("gfx/emotes/" + i[o] + ".png");
        c.preloadImages(n, function(n) {
            for (var o = 0; o < n.length; o++)
                t.addAttitudeIcon(e[i[o]], n[o]);
            t.attitudesPanel.delClassNames("spinner")
        })
    }
    ,
    n.prototype.addAttitudeIcon = function(e, t) {
        function i() {
            window.dofus.sendMessage("EmotePlayRequestMessage", {
                emoteId: this.id
            }),
            n.closePanels()
        }
        var n = this
          , o = this.attitudesPanel.createChild("div", {
            className: ["chatIcon", "attitudeIcon"]
        });
        o.id = e.id,
        o.setStyle("backgroundImage", t),
        this.attitudeList[e.id] = o,
        l(o),
        o.on("tap", i)
    }
    ,
    n.prototype.removeAttitudeIcon = function(e) {
        var t = this.attitudeList[e];
        t && (t.destroy(),
        delete this.attitudeList[e])
    }
    ,
    n.prototype.setCurrentMood = function(e) {
        var t = this.smileysPanel.getChild(e);
        this.currentMood !== t && (this.currentMood && this.currentMood.delClassNames("mood"),
        t && t.addClassNames("mood"),
        this.currentMood = t)
    }
    ,
    n.prototype.addSmileyIcon = function(e, t) {
        function i() {
            window.dofus.sendMessage("ChatSmileyRequestMessage", {
                smileyId: this.id
            }),
            o.closePanels()
        }
        function n() {
            var e = o.currentMood === this ? -1 : this.id;
            o.setCurrentMood(e),
            window.dofus.sendMessage("MoodSmileyRequestMessage", {
                smileyId: e
            })
        }
        if (e.forPlayers) {
            var o = this
              , s = new r("div",{
                name: e.id,
                className: ["chatIcon", "smileyIcon"]
            });
            s.id = e.id,
            s.setStyle("backgroundImage", t),
            l(s),
            s.on("tap", i),
            s.on("longtap", n),
            this.smileysPanel.appendChild(s)
        }
    }
    ,
    n.prototype.openSmileys = function() {
        this.emit("open"),
        this.attitudesPanel.hide(),
        this.smileysPanel.show(),
        this.openPanel = "smileys"
    }
    ,
    n.prototype.openAttitudes = function() {
        this.emit("open"),
        this.smileysPanel.hide(),
        this.attitudesPanel.show(),
        this.openPanel = "attitudes"
    }
    ,
    n.prototype.closePanels = function() {
        this.emit("closing"),
        this.smileysPanel.hide(),
        this.attitudesPanel.hide(),
        this.openPanel = null
    }
    ,
    n.prototype.setPanelsStyle = function(e, t) {
        this.smileysPanel.setStyle(e, t),
        this.attitudesPanel.setStyle(e, t)
    }
    ,
    n.prototype.positionPanel = function() {
        function e(e, t) {
            var i = u(e, t);
            e.setStyles({
                left: i.x + "px",
                top: i.y + "px"
            })
        }
        e(this.smileysPanel, this.smileysButton),
        e(this.attitudesPanel, this.attitudesButton)
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        MOOD_OK: 0,
        MOOD_ERROR_UNKNOWN: 1,
        MOOD_ERROR_FLOOD: 2
    }
}
, function(e, t, i) {
    function n(e, t) {
        var i = this;
        s.call(this, "div", {
            className: "CheckboxLabel",
            text: e
        }),
        t ? (this._active = !0,
        this.addClassNames("on")) : this._active = !1,
        a(this),
        this.on("tap", function() {
            this._active ? (this.deactivate(),
            r("CHECKBOX_UNCHECKED")) : (this.activate(),
            r("CHECKBOX_CHECKED"))
        }),
        this.on("enable", function(e) {
            i.toggleClassName("disabled", !e)
        })
    }
    i(449);
    var o = i(26).inherits
      , s = i(190)
      , a = i(32)
      , r = i(84).playUiSound;
    o(n, s),
    e.exports = n,
    n.prototype.activate = function(e) {
        this._active = !0,
        this.addClassNames("on"),
        e || (this.emit("activate"),
        this.emit("change", !0))
    }
    ,
    n.prototype.deactivate = function(e) {
        this._active = !1,
        this.delClassNames("on"),
        e || (this.emit("deactivate"),
        this.emit("change", !1))
    }
    ,
    n.prototype.toggleActivation = function(e, t) {
        void 0 === e && (e = !this._active),
        e ? this.activate(t) : this.deactivate(t)
    }
    ,
    n.prototype.isActivate = function() {
        return this._active
    }
}
, function(e, t) {}
, function(e, t) {
    function i(e) {
        this.maxSize = e,
        this.clear()
    }
    e.exports = i,
    i.prototype.clear = function() {
        this.buf = [],
        this.posNext = 0,
        this.posLast = 0,
        this.curSize = 0
    }
    ,
    i.prototype.isEmpty = function() {
        return 0 === this.curSize
    }
    ,
    i.prototype.isFull = function() {
        return this.curSize === this.maxSize
    }
    ,
    i.prototype.getCurrentSize = function() {
        return this.curSize
    }
    ,
    i.prototype.push = function(e) {
        var t, i = (this.posNext + 1) % this.maxSize;
        return this.curSize === this.maxSize ? (t = this.buf[this.posLast],
        this.posLast = i) : this.curSize++,
        this.buf[this.posNext] = e,
        this.posNext = i,
        t
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        i = i || {};
        var n = t || ""
          , o = new f("span",{
            className: "externalLink",
            text: n
        });
        return o.addClassNames(i.className || "link"),
        i.html && o.setHtml(i.html),
        g(o),
        o.on("tap", function() {
            v.openUrlInAppBrowser(e)
        }),
        o
    }
    function o(e, t, i) {
        I.indexOf(e) === -1 && I.push(e),
        T.push(i),
        S.push(new RegExp(t))
    }
    function s(e, t, i, n) {
        var o = n && n.className || "link";
        if (!i)
            return t = t || e,
            void 0 === i && console.warn("Skipped not handled hyperlink: " + e),
            new f("span",{
                text: t,
                className: "deadLink"
            });
        var s = new f("span",{
            text: t,
            className: o
        });
        return g(s),
        s.on("tap", i),
        s
    }
    function a(e, t, i, n) {
        var o = n && n.className || "link"
          , s = new f("span",{
            className: o
        });
        return p.getData(e, t, function(n, a) {
            if (s.rootElement) {
                if (n)
                    return s.replaceClassNames([o], ["deadLink"]),
                    s.setText("[" + e + " " + t + "?]"),
                    console.error("Failed getting link data: " + e + " #" + t, n);
                var r = i(a);
                if (s.setText(r[0]),
                !r[1])
                    return void s.replaceClassNames([o], ["deadLink"]);
                g(s),
                s.on("tap", r[1])
            }
        }),
        s
    }
    function r(e, t, i) {
        return function() {
            m.open(e, {
                tabId: t,
                tabParams: i
            })
        }
    }
    function l(e) {
        return a("Items", e.objectGID, function(t) {
            return [t.nameId, function() {
                m.open("itemBox", e)
            }
            ]
        })
    }
    var c = i(452)
      , u = i(35).getText
      , h = i(453)
      , d = i(323)
      , p = i(36)
      , m = i(22)
      , f = i(190)
      , g = i(32)
      , _ = i(311)
      , v = i(210)
      , y = 5e3
      , w = "\\$[a-zA-Z]+[0-9]+"
      , b = "\\{[a-zA-Z]+[^\\}]*\\}"
      , C = "<a href=[^>]+>.+</a>"
      , I = []
      , T = []
      , S = [];
    t.newExternalLink = n,
    o(b, "\\{player,([^,]+),([0-9]+)\\}", function(e) {
        var t = e[1];
        return s(e[0], t, function() {
            window.gui.openContextualMenu("player", {
                playerId: e[2],
                playerName: t
            })
        })
    }),
    o(b, "\\{item,([0-9]+),([0-9]+)\\}", function(e) {
        return l({
            objectGID: parseInt(e[1], 10),
            objectUID: parseInt(e[2], 10)
        })
    }),
    o(b, "\\{recipe,([0-9]+)\\}", function(e) {
        return a("Items", parseInt(e[1], 10), function(e) {
            var t = "[" + u("ui.common.recipes", 1) + u("ui.common.colon") + e.nameId + "]";
            return [t, function() {
                d.getItems([e.id], function(t, i) {
                    return t ? console.error("Broken link item:", e) : void m.open("itemRecipes", {
                        itemData: i[0]
                    })
                })
            }
            ]
        }, {
            className: "insertedLink"
        })
    }),
    o(b, "\\{npc,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], function() {
            window.isoEngine.addArrowOnNpc(parseInt(e[1], 10), y)
        })
    }),
    o(b, "\\{monster,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], function() {
            window.isoEngine.addArrowOnMonster(parseInt(e[1], 10), y)
        })
    }),
    o(b, "\\{chattitle,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], r("grimoire", "ornaments", {
            titleId: e[1]
        }))
    }),
    o(b, "\\{chatachievement,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], r("grimoire", "achievements", {
            achievementId: e[1]
        }))
    }),
    o(b, "\\{guild,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], function() {
            window.dofus.sendMessage("GuildFactsRequestMessage", {
                guildId: e[1]
            })
        })
    }),
    o(b, "\\{alliance,([-0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], function() {
            window.dofus.sendMessage("AllianceFactsRequestMessage", {
                allianceId: e[1]
            })
        })
    }),
    o(b, "\\{pingsystem,([0-9]+),([^:]*)::([^\\}]*)\\}", function(e) {
        var t = window.gui.pingSystem
          , i = e[0]
          , n = e[1]
          , o = e[2] || ""
          , a = e[3] || "";
        return a = u("tablet.pingsystem.pingsystem") + u("ui.common.colon") + a,
        t.addPingPicto(n, o),
        s(i, a, function() {
            t.addPingPicto(n, o)
        })
    });
    var A = {
        "banner,btn_items,1": function() {
            h.pointToMenuIcon("Bag")
        },
        "storage,slot_2,2": function() {
            h.pointToCharacterItem(2)
        },
        "storage,grid": function() {
            h.pointToStorageFirstSlotBox()
        }
    };
    o(b, "\\{ui,([a-zA-Z_,0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], A[e[1]])
    }),
    o(b, "\\{openSocial,([0-9]+),([0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[3], r("social", parseInt(e[1], 10), {
            tabId: parseInt(e[2], 10)
        }))
    }),
    o(w, "\\$item([0-9]+)", function(e) {
        return l({
            objectGID: parseInt(e[1], 10)
        })
    }),
    o(w, "\\$job([0-9]+)", function(e) {
        return a("Jobs", e[1], function(e) {
            return [e.nameId, r("grimoire", "jobs", {
                jobId: e.id
            })]
        })
    }),
    o(w, "\\$quest([0-9]+)", function(e) {
        return a("Quests", e[1], function(e) {
            return [e.nameId, r("grimoire", "quests", {
                questId: e.id,
                categoryId: e.categoryId
            })]
        })
    }),
    o(w, "\\$area([0-9]+)", function(e) {
        return a("Areas", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$subarea([0-9]+)", function(e) {
        return a("SubAreas", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$map([0-9]+)", function(e) {
        return a("MapPositions", e[1], function(e) {
            return [e.nameId || "[" + e.posX + "," + e.posY + "]", function() {
                window.gui.emit("CompassUpdateMessage", {
                    type: c.COMPASS_TYPE_SIMPLE,
                    worldX: e.posX,
                    worldY: e.posY
                })
            }
            ]
        })
    }),
    o(b, "\\{map,(-?[0-9]+),(-?[0-9]+)::([^\\}]*)\\}", function(e) {
        var t = parseInt(e[1], 10)
          , i = parseInt(e[2], 10)
          , n = e[3] || "[" + t + "," + i + "]";
        return s(e[0], n, function() {
            m.open("worldMap", {
                x: t,
                y: i
            })
        })
    }),
    o(w, "\\$itemType([0-9]+)", function(e) {
        return a("ItemTypes", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$achievement([0-9]+)", function(e) {
        return a("Achievements", e[1], function(t) {
            return [t.nameId, r("grimoire", "achievements", {
                achievementId: e[1]
            })]
        })
    }),
    o(w, "\\$title([0-9]+)", function(e) {
        return a("Titles", e[1], function(t) {
            var i = window.gui.playerData.characterBaseInformations.sex ? t.nameFemaleId : t.nameMaleId;
            return [i, r("grimoire", "ornaments", {
                titleId: e[1]
            })]
        })
    }),
    o(w, "\\$ornament([0-9]+)", function(e) {
        return a("Ornaments", e[1], function(t) {
            return [t.nameId, r("grimoire", "ornaments", {
                ornamentId: e[1]
            })]
        })
    }),
    o(w, "\\$spell([0-9]+)", function(e) {
        return a("Spells", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$spellState([0-9]+)", function(e) {
        return a("SpellStates", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$breed([0-9]+)", function(e) {
        return a("Breeds", e[1], function(e) {
            return [e.shortNameId, null ]
        })
    }),
    o(w, "\\$emote([0-9]+)", function(e) {
        return a("Emoticons", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$monster([0-9]+)", function(e) {
        return a("Monsters", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$monsterRace([0-9]+)", function(e) {
        return a("MonsterRaces", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$monsterSuperRace([0-9]+)", function(e) {
        return a("MonsterSuperRaces", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$alignment([0-9]+)", function(e) {
        return a("AlignmentSides", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$stat([0-9]+)", function(e) {
        var t = u("ui.item.characteristics").split(",");
        return s(e[0], t[e[1]], null )
    }),
    o(w, "\\$dungeon([0-9]+)", function(e) {
        return a("Dungeons", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(w, "\\$challenge([0-9]+)", function(e) {
        return a("Challenge", e[1], function(e) {
            return [e.nameId, null ]
        })
    }),
    o(C, "<a href=([^>]+)>(.+)</a>", function(e) {
        var t = e[1]
          , i = e[2];
        return '"' !== t[0] && "'" !== t[0] || (t = t.slice(1, -1)),
        n(t, null , {
            html: i
        })
    }),
    o(b, "\\{style:([a-zA-Z]+),([^\\}]*)\\}", function(e) {
        return new f("span",{
            text: e[2],
            className: e[1]
        })
    }),
    o(b, "\\{myShop::([^\\}]*)\\}", function(e) {
        return s(e[0], e[1], function() {
            window.dofus.sendMessage("ExchangeRequestOnShopStockMessage")
        })
    }),
    o(b, "\\{windowTab,([a-zA-Z_,0-9]+),([a-zA-Z_,0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[3], function() {
            m.open(e[1], {
                tabId: e[2]
            })
        })
    }),
    o(b, "\\{window,([a-zA-Z_,0-9]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2], function() {
            return "bidHouseShop" === e[1] ? _.openBidHouse(!1) : void m.open(e[1])
        })
    }),
    o(b, "\\{([a-zA-Z_,0-9\\-]+)::([^\\}]*)\\}", function(e) {
        return s(e[0], e[2])
    });
    var E = new RegExp(I.join("|"));
    t.process = function(e) {
        for (var t = new f("span"); ; ) {
            var i = E.exec(e);
            if (!i)
                break;
            for (var n, o = i[0], a = e.indexOf(o), r = e.substr(0, a), l = e.substr(a + o.length), c = null , u = 0; u < T.length; u++)
                if (c = S[u].exec(o)) {
                    n = T[u](c);
                    break
                }
            c || (n = s(o)),
            t.createChild("span").setHtml(r),
            t.appendChild(n),
            e = l
        }
        return t.createChild("span").setHtml(e),
        t
    }
}
, function(e, t) {
    e.exports = {
        COMPASS_TYPE_SIMPLE: 0,
        COMPASS_TYPE_SPOUSE: 1,
        COMPASS_TYPE_PARTY: 2,
        COMPASS_TYPE_PVP_SEEK: 3,
        COMPASS_TYPE_QUEST: 4
    }
}
, function(e, t, i) {
    var n = i(22);
    t.pointToWindowCloseButton = function(e) {
        var t = n.getWindow(e);
        if (t.openState) {
            var i, o, s = t.closeButton.rootElement, a = s.getBoundingClientRect();
            i = a.left + a.width / 2,
            o = a.top + a.height / 2,
            window.gui.hintArrow.showArrow(i, o, "upRight")
        }
    }
    ,
    t.pointToMenuIcon = function(e) {
        var t = window.gui.menuBar.getIcon(e)
          , i = t.rootElement
          , n = i.getBoundingClientRect()
          , o = n.left + 10
          , s = n.top + 10;
        window.gui.hintArrow.showArrow(o, s, "downRight")
    }
    ,
    t.pointToNpcAnswer = function(e) {
        var t = window.gui.npcDialogUi;
        if (t.isVisible()) {
            var i = t.replyElts[e];
            if (i) {
                var n = i.rootElement
                  , o = n.getBoundingClientRect()
                  , s = o.left + Math.round(.3 * o.width)
                  , a = o.top + Math.round(.3 * o.height);
                window.gui.hintArrow.showArrow(s, a, "downRight")
            }
        }
    }
    ,
    t.pointToTimelineButton = function(e) {
        var t = window.gui.timeline.fightControlButtons
          , i = t.getButtonRectForTuto(e);
        if (i) {
            var n = i.left + Math.round(.5 * i.width)
              , o = i.top + Math.round(.3 * i.height);
            window.gui.hintArrow.showArrow(n, o, "upLeft")
        }
    }
    ,
    t.pointToFirstSkillShortcut = function() {
        var e = window.gui.shortcutBar;
        e.openPanel("spell");
        var t = e.getSlot("spell", 0)
          , i = t.rootElement
          , n = i.getBoundingClientRect()
          , o = n.left + 25
          , s = n.top + 25;
        window.gui.hintArrow.showArrow(o, s, "downRight")
    }
    ;
    var o = 0;
    t.pointToEquipFilterIcon = function() {
        var e = n.getWindow("equipment");
        if (e.openState) {
            var t = e.storageView
              , i = t.filter
              , s = i.filterBtnMap
              , a = s[o]
              , r = a.rootElement
              , l = r.getBoundingClientRect()
              , c = l.left + Math.round(.5 * l.width)
              , u = l.top + Math.round(.5 * l.height);
            window.gui.hintArrow.showArrow(c, u, "upLeft")
        }
    }
    ,
    t.pointToCharacterItem = function(e) {
        var t = n.getWindow("equipment");
        if (t.openState) {
            var i = t.getEquipmentSlots()
              , o = i[e]
              , s = o.rootElement
              , a = s.getBoundingClientRect()
              , r = a.left + a.width / 2
              , l = a.top + a.height / 2;
            window.gui.hintArrow.showArrow(r, l, "upLeft")
        }
    }
    ,
    t.pointToStorageFirstSlotBox = function() {
        var e = n.getWindow("equipment");
        if (e.openState) {
            var t = e.storageView
              , i = t.slotsContainer.rootElement
              , o = i.getBoundingClientRect()
              , s = o.left + 10
              , a = o.top + 10;
            window.gui.hintArrow.showArrow(s, a, "downRight")
        }
    }
}
, function(e, t, i) {
    function n(e) {
        this.currentStatus = l.PLAYER_STATUS_AVAILABLE,
        this._createContent(e),
        this._setListeners()
    }
    function o(e) {
        switch (e) {
        case l.PLAYER_STATUS_AVAILABLE:
            return "available";
        case l.PLAYER_STATUS_IDLE:
            return "away";
        case l.PLAYER_STATUS_AFK:
            return "away";
        case l.PLAYER_STATUS_PRIVATE:
            return "private";
        case l.PLAYER_STATUS_SOLO:
            return "solo";
        default:
            return console.error("getClassNameFromStatus got invalid state", e),
            "available"
        }
    }
    var s = i(49)
      , a = i(35).getText
      , r = i(34)
      , l = i(432)
      , c = i(206)
      , u = {};
    u[l.PLAYER_STATUS_AFK] = "ui.chat.status.away",
    u[l.PLAYER_STATUS_IDLE] = "ui.chat.status.idle",
    u[l.PLAYER_STATUS_PRIVATE] = "ui.chat.status.private",
    u[l.PLAYER_STATUS_SOLO] = "ui.chat.status.solo",
    u[l.PLAYER_STATUS_AVAILABLE] = "ui.chat.status.availiable",
    e.exports = n,
    n.prototype.initialize = function() {
        this.currentStatus = l.PLAYER_STATUS_AVAILABLE
    }
    ,
    n.prototype._createContent = function(e) {
        this.statusButton = e.createChild("div", {
            className: ["statusButton", "available"]
        });
        var t = this;
        c.addTooltip(this.statusButton, function() {
            return a(u[t.currentStatus])
        }),
        this.statusButton.on("tap", function() {
            var e = this.rootElement.getBoundingClientRect();
            window.gui.openContextualMenu("userStatus", null , {
                x: e.left + e.width,
                y: e.top
            })
        })
    }
    ,
    n.prototype._setCurrentStatus = function(e) {
        e !== l.PLAYER_STATUS_IDLE && (this.currentStatus = e),
        this.statusButton.replaceClassNames(["available", "away", "private", "solo"], [o(e)])
    }
    ,
    n.prototype._setListeners = function() {
        var e = this;
        s.on("PlayerStatusUpdateMessage", function(t) {
            t.playerId === window.gui.playerData.characterBaseInformations.id && e._setCurrentStatus(t.status.statusId)
        }),
        r.on("inactive", function(t) {
            var i = t ? l.PLAYER_STATUS_IDLE : e.currentStatus;
            window.dofus.sendMessage("PlayerStatusUpdateRequestMessage", {
                status: {
                    statusId: i
                }
            })
        })
    }
}
, function(e, t, i) {
    var n = i(212)
      , o = i(35).getText
      , s = i(211).DofusDate;
    e.exports = function(e, t) {
        function i() {
            if (t = t || [],
            !(0 === t.length || t[0].length > n.MAX_PLAYER_OR_ACCOUNT_NAME_LEN))
                return window.dofus.sendMessage("BasicWhoIsRequestMessage", {
                    search: t[0],
                    verbose: !0
                }),
                !0
        }
        if (e = e.toLowerCase(),
        "whois" === e)
            return i();
        if ("whoami" === e)
            return window.dofus.sendMessage("BasicWhoAmIRequestMessage", {
                verbose: !0
            }),
            !0;
        if ("mapid" === e) {
            var a = window.isoEngine.mapRenderer.mapId
              , r = o("ui.chat.console.currentMap", null , a);
            return window.gui.chat.logMsg(r),
            !0
        }
        if ("time" === e) {
            var l = new s(Date.now() / 1e3).getServerDate().toString(!0)
              , c = o("ui.time.dateLetters", l.day, l.monthName, l.year) + " - " + l.time;
            return window.gui.chat.logMsg(c),
            !0
        }
        return !1
    }
}
, function(e, t, i) {
    var n = i(35).getText
      , o = i(457)
      , s = i(458);
    e.exports = function(e) {
        var t;
        t = e.areaId !== -1 ? e._areaName : n("ui.common.unknowArea");
        var i = "{player," + e.playerName + "," + e.playerId + "}";
        e.position === o.MODERATOR ? i += "(" + n("ui.common.moderator") + ")" : e.position === o.GAMEMASTER_PADAWAN ? i += "(" + n("ui.common.gameMasterAssistant") + ")" : e.position === o.GAMEMASTER ? i += "(" + n("ui.common.gameMaster") + ")" : e.position === o.ADMIN && (i += "(" + n("ui.common.administrator") + ")");
        var a = n("ui.common.whois", e.accountNickname, i, t);
        if (e.socialGroups && e.socialGroups.length > 0)
            for (var r = 0, l = e.socialGroups.length; r < l; r += 1) {
                var c = e.socialGroups[r];
                "GuildInformations" === c._type && (a += " " + n("ui.common.guild") + " {guild," + c.guildId + "::" + c.guildName + "}"),
                "AllianceInformations" === c._type && (a += " " + n("ui.common.alliance") + " {alliance," + c.allianceId + "::[" + c.allianceTag + "]}")
            }
        return e.playerState === s.NOT_CONNECTED && (a += " (" + n("tablet.common.disconnected") + ")"),
        a
    }
}
, function(e, t) {
    e.exports = {
        UNAVAILABLE: -1,
        PLAYER: 0,
        MODERATOR: 10,
        GAMEMASTER_PADAWAN: 20,
        GAMEMASTER: 30,
        ADMIN: 40
    }
}
, function(e, t) {
    e.exports = {
        NOT_CONNECTED: 0,
        GAME_TYPE_ROLEPLAY: 1,
        GAME_TYPE_FIGHT: 2,
        UNKNOWN_STATE: 99
    }
}
, function(e, t, i) {
    function n(e, t) {
        function i(t) {
            if (!d && r(e)) {
                d = !0,
                p.w = f.w = e.rootElement.clientWidth,
                p.h = f.h = e.rootElement.clientHeight;
                var i = a(t);
                m.x = i.x,
                m.y = i.y,
                e.emit("resizeStart"),
                window.gui.wBody.once("dom.touchend", s),
                window.gui.wBody.on("dom.touchmove", n),
                n(t)
            }
        }
        function n(t) {
            var i = a(t)
              , n = i.x - m.x
              , s = i.y - m.y;
            f.w = p.w + n,
            f.h = p.h + s,
            f.w = Math.min(Math.max(f.w, u), o.windowFullScreenWidth),
            f.h = Math.min(Math.max(f.h, h), o.windowFullScreenHeight),
            e.setStyles({
                width: f.w + "px",
                height: f.h + "px"
            })
        }
        function s() {
            window.gui.wBody.removeListener("dom.touchmove", n),
            d = !1,
            e.windowWidth = f.w,
            e.windowHeight = f.h,
            e.emit("resize")
        }
        t = t || {};
        var u = t.minWidth || l
          , h = t.minHeight || c;
        e.resizeHandle = e.createChild("div", {
            className: "resizeHandle"
        }),
        e.resizeHandle.allowDomEvents();
        var d = !1
          , p = {
            w: null ,
            h: null
        }
          , m = {
            x: null ,
            y: null
        }
          , f = {
            w: null ,
            h: null
        };
        e.resizeHandle.on("dom.touchstart", i)
    }
    i(460);
    var o = i(24).dimensions
      , s = i(33)
      , a = s.getPosition
      , r = i(47).requestInteractionHandle
      , l = 300
      , c = 300;
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, "div", {
            className: "ChatButton"
        });
        var e = this.createChild("div", {
            className: "buttonChatPicto"
        });
        e.appendChild(new l({
            className: "buttonChatTouchZone"
        },function() {
            window.gui.chat.active ? window.gui.chat.deactivate() : window.gui.chat.activate()
        }
        ));
        var t = this;
        window.gui.on("resize", function() {
            if (this.ipadRatio)
                t.setStyles({
                    left: s.posChatBtn + "px",
                    right: "auto",
                    top: "auto",
                    bottom: 0,
                    width: o.CHAT_BTN_MIN_WIDTH + "px",
                    height: s.bottomBarHeight + "px"
                });
            else {
                var e, i;
                e = s.sideBarWidth - o.PING_EMOTE_BTN_WIDE_MIN_WIDTH,
                i = o.PING_EMOTE_BTN_WIDE_MIN_WIDTH,
                t.setStyles({
                    left: "auto",
                    right: i + "px",
                    top: s.posChatBtn + "px",
                    bottom: "auto",
                    width: e + "px",
                    height: o.CHAT_BTN_MIN_HEIGHT + "px"
                })
            }
        })
    }
    i(462);
    var o = i(6)
      , s = i(24).dimensions
      , a = i(26).inherits
      , r = i(190)
      , l = i(204);
    a(n, r),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        var t = e.role
          , i = c.setupNames(e.otherId, e.initiatorId);
        return i ? (h = i.sourceName,
        d = i.targetName,
        c.setupCancelPopupTexts({
            title: l("ui.common.exchange"),
            message: l("ui.craft.waitForCraftClient", d)
        }),
        t === r.MULTICRAFT_CUSTOMER ? c.setupConfirmPopupTexts({
            title: l("ui.common.exchange"),
            message: l("ui.craft.CrafterAskCustomer", h)
        }) : t === r.MULTICRAFT_CRAFTER && c.setupConfirmPopupTexts({
            title: l("ui.common.exchange"),
            message: l("ui.craft.CustomerAskCrafter", h)
        }),
        void c.askingExchangePopup()) : console.error("MultiCraft: setupNames")
    }
    function o(e) {
        var t = e.skillId;
        window.gui.playerData.jobs.prepareSkillRecipes(t, function(i) {
            if (i)
                return console.error("Craft: prepareSkillRecipes", t, i);
            var n = window.gui.playerData.jobs
              , o = n.getSkill(t);
            o.isForgemagus || o.modifiableItemType !== -1 ? u.openDialog(["craftMagus", "craftInventory"], {
                type: "craftMagus",
                msg: e
            }) : t === n.SKILLID_DECRAFT ? u.openDialog(["crafting", "craftInventory"], {
                type: "decrafting",
                msg: e
            }) : t === n.SKILLID_WRAP_GIFT ? u.openDialog(["crafting", "craftInventory"], {
                type: "wrapping",
                msg: e
            }) : u.openDialog(["crafting", "craftInventory"], {
                type: "crafting",
                msg: e
            })
        })
    }
    function s(e, t) {
        var i = e.skillId;
        window.gui.playerData.jobs.prepareSkillRecipes(i, function(n) {
            if (n)
                return console.error("MultiCraft: prepareSkillRecipes", i, n);
            var o = window.gui.playerData.jobs.getSkill(i);
            return o.isForgemagus || o.modifiableItemType !== -1 ? u.continueDialog(["craftMagusMulti", "craftInventory"], {
                type: "craftMagus",
                isCrafter: t.isCrafter,
                sourceName: h,
                targetName: d,
                msg: e
            }) : void u.continueDialog(["craftingMulti", "craftInventory"], {
                type: "crafting",
                isCrafter: t.isCrafter,
                sourceName: h,
                targetName: d,
                msg: e
            })
        })
    }
    var a = i(464)
      , r = i(418)
      , l = i(35).getText
      , c = i(465)
      , u = i(22);
    t.SMITHMAGIC_RUNE_ID = 78,
    t.SMITHMAGIC_POTION_ID = 26,
    t.SIGNATURE_RUNE_ID = 7508,
    t.SIGNATURE_AVAILABLE_LEVEL = 100;
    var h = ""
      , d = "";
    t.initialize = function(e) {
        e.on("ExchangeOkMultiCraftMessage", n),
        e.on("ExchangeStartOkCraftWithInformationMessage", o),
        e.on("ExchangeStartOkMulticraftCrafterMessage", function(e) {
            s(e, {
                isCrafter: !0
            })
        }),
        e.on("ExchangeStartOkMulticraftCustomerMessage", function(e) {
            s(e, {
                isCrafter: !1
            })
        })
    }
    ,
    t.displayAutoCraftStopReasonMessage = function(e) {
        var t = ""
          , i = !0;
        switch (e) {
        case a.STOPPED_REASON_OK:
            t = l("ui.craft.autoCraftStopedOk");
            break;
        case a.STOPPED_REASON_USER:
            t = l("ui.craft.autoCraftStoped"),
            i = !1;
            break;
        case a.STOPPED_REASON_MISSING_RESSOURCE:
            t = l("ui.craft.autoCraftStopedNoRessource");
            break;
        case a.STOPPED_REASON_IMPOSSIBLE_CRAFT:
            t = l("ui.craft.autoCraftStopedInvalidRecipe")
        }
        var n = window.gui;
        i && n.openSimplePopup(t, l("ui.popup.information")),
        t && n.chat.logMsg(t)
    }
}
, function(e, t) {
    e.exports = {
        STOPPED_REASON_OK: 1,
        STOPPED_REASON_USER: 2,
        STOPPED_REASON_MISSING_RESSOURCE: 3,
        STOPPED_REASON_IMPOSSIBLE_CRAFT: 4
    }
}
, function(e, t, i) {
    function n(e) {
        function t() {
            var t = {
                title: s.title,
                message: s.message,
                cb: function() {
                    r && r()
                }
            };
            d.getWindow("cancel").update(t, {
                keepDialog: e
            }),
            d.openDialog(["cancel"])
        }
        function i() {
            var t = {
                title: o.title,
                message: o.message,
                cb: function(e) {
                    e === n.NO ? a.refuse && a.refuse() : e === n.IGNORE ? a.ignore && a.ignore() : a.confirm && a.confirm()
                }
            };
            d.getWindow("confirm").update(t, {
                ignoreEnable: !0,
                keepDialog: e
            }),
            d.openDialog(["confirm"])
        }
        var n = d.getWindow("confirm").actionsEnum;
        h ? t() : i()
    }
    var o, s, a, r, l, c, u, h, d = i(22);
    t.askingExchangePopup = function() {
        a = {
            confirm: function() {
                window.dofus.sendMessage("ExchangeAcceptMessage")
            },
            refuse: void 0,
            ignore: function() {
                window.dofus.sendMessage("IgnoredAddRequestMessage", {
                    name: l,
                    session: !0
                })
            }
        },
        r = void 0,
        n(!0)
    }
    ,
    t.askingChallengePopup = function(e) {
        function t() {
            window.dofus.sendMessage("GameRolePlayPlayerFightFriendlyAnswerMessage", {
                fightId: e,
                accept: !0
            })
        }
        function i() {
            window.dofus.sendMessage("GameRolePlayPlayerFightFriendlyAnswerMessage", {
                fightId: e,
                accept: !1
            })
        }
        function o() {
            i(),
            window.dofus.sendMessage("IgnoredAddRequestMessage", {
                name: l,
                session: !0
            })
        }
        a = {
            confirm: t,
            refuse: i,
            ignore: o
        },
        r = i,
        n(!1)
    }
    ,
    t.closingChallengePopup = function(e) {
        var t = e ? "cancel" : "confirm"
          , i = d.getWindow(t);
        d.close(i.id)
    }
    ,
    t.setupCancelPopupTexts = function(e) {
        s = e
    }
    ,
    t.setupConfirmPopupTexts = function(e) {
        o = e
    }
    ,
    t.setupNames = function(e, t) {
        var i = window.gui.playerData;
        c = i.id,
        u = i.characterBaseInformations.name,
        h = t === c;
        var n = window.actorManager.getActor(h ? e : t);
        if (!n)
            return null ;
        var o = n.data.name;
        l = h ? u : o;
        var s = h ? o : u;
        return {
            sourceName: l,
            targetName: s
        }
    }
}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "TextNotification"
        });
        var e = this;
        window.gui.on("resize", function() {
            e.setStyles({
                left: o.mapLeft + l + "px",
                bottom: o.screenHeight - o.mapBottom + l + "px"
            })
        }),
        this.mutedChannelsId = {};
        for (var t in c)
            this.mutedChannelsId[r[t]] = !0
    }
    i(467);
    var o = i(24).dimensions
      , s = i(26).inherits
      , a = i(190)
      , r = i(235)
      , l = 10
      , c = {
        PSEUDO_CHANNEL_FIGHT_LOG: !0
    };
    s(n, a),
    e.exports = n,
    n.prototype.add = function(e, t) {
        function i(e) {
            e.delClassNames("on"),
            setTimeout(function() {
                e.destroy()
            }, 300)
        }
        t = t || {};
        var n = this.createChild("div", {
            className: "bubble"
        })
          , o = n.createChild("div", {
            className: "bubbleText"
        });
        n.addClassNames(t.className);
        var s = t.channel;
        void 0 === s && (s = r.PSEUDO_CHANNEL_INFO),
        n.addClassNames("channel" + s),
        "object" == typeof e ? o.appendChild(e) : o.setHtml(e.toString()),
        setTimeout(function() {
            n.addClassNames("on")
        }, 50),
        setTimeout(function() {
            n.rootElement && i(n)
        }, 7e3)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        o.getAllDataMap(s, function(t, i) {
            return t ? e(t) : (window.gui.databases = i,
            void e())
        })
    }
    var o = i(36)
      , s = ["AlignmentGift", "AlignmentRankJntGift", "AlignmentSides", "AlmanaxCalendars", "Areas", "BidHouseCategories", "Breeds", "ChatChannels", "IncarnationLevels", "ItemTypes", "Months", "MountBehaviors", "OptionalFeatures", "QuestObjectiveTypes", "RankNames", "Smileys", "SpellStates", "SpellTypes", "SuperAreas", "TypeActions", "WorldMaps"];
    e.exports.load = n
}
, function(e, t, i) {
    function n() {
        h.call(this, "div", {
            className: "shopFloatingToolbar"
        }),
        r(this, {
            grip: this
        }),
        this.appendChild(new s({
            className: "shopBtn"
        },o));
        var e = this
          , t = window.gui;
        t.once("resize", function() {
            t.ipadRatio ? e.setStyles({
                left: a.mapRight + "px",
                top: "30px"
            }) : e.setStyles({
                left: a.mapRight - 80 + "px",
                top: "0px"
            })
        }),
        t.on("connected", function() {
            e.show()
        }),
        t.on("disconnect", function() {
            e.hide()
        }),
        t.fightManager.on("fightStart", function() {
            e.hide()
        }),
        t.fightManager.on("fightEnd", function() {
            e.show()
        })
    }
    function o() {
        c.open("market", {
            tabId: "shop"
        });
        var e = this.rootElement.getBoundingClientRect();
        u.log("HUD.Click_on_button", {
            interface_id: "ShopFloatingToolbar",
            button_id: "BTN_IG_SHOP",
            clic_parameter_key: "position",
            clic_parameter_value: ~~e.left + "," + ~~e.top,
            clic_type: "Simple_court"
        })
    }
    i(470);
    var s = i(204)
      , a = i(24).dimensions
      , r = i(439)
      , l = i(26).inherits
      , c = i(22)
      , u = i(158)
      , h = i(190);
    l(n, h),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        var e = this
          , t = window.gui;
        s.call(this),
        this._POIMap = {},
        this._lastPhoenixes = [],
        a.init(this),
        c.init(),
        t.on("disconnect", this._sweep.bind(this)),
        t.playerData.position.on("worldMapUpdate", function() {
            e.changeMap(this.worldmapId)
        })
    }
    function o(e, t) {
        u.getData("MapPositions", e, function(i, n) {
            return i ? console.error("GPS getObjectiveCoords: cannot load MapPositions from mapId " + e, i) : n.subAreaId ? void u.getData("SubAreas", n.subAreaId, function(i, o) {
                if (i)
                    return console.error("GPS getObjectiveCoords: cannot load SubAreas " + n.subAreaId, i);
                var s, a = o.entranceMapIds || [], r = o.exitMapIds || [], l = window.gui.databases, c = l.Areas[o.areaId], h = l.SuperAreas[c.superAreaId], d = o.customWorldMap[0] || h.worldmapId, p = window.gui.playerData.position.worldmapId;
                return p !== d && (s = p === m ? a[0] : r[0]),
                void 0 === s ? t({
                    x: n.posX,
                    y: n.posY,
                    mapId: e
                }) : void u.getData("MapPositions", s, function(e, i) {
                    return e ? console.error("GPS getObjectiveCoords: cannot load MapPositions from mapId " + s, e) : void t({
                        x: i.posX,
                        y: i.posY,
                        mapId: s
                    })
                })
            }) : t({
                x: n.posX,
                y: n.posY,
                mapId: e
            })
        })
    }
    var s = i(16).EventEmitter
      , a = i(472)
      , r = i(26).inherits
      , l = i(474)
      , c = i(475)
      , u = i(36)
      , h = i(25)
      , d = i(35).getText
      , p = i(476)
      , m = 1
      , f = 2
      , g = 12
      , _ = "fixed";
    r(n, s),
    n.prototype._requestUpdatePOI = function(e, t, i, n, o) {
        e.x === i && e.y === n || (e.x = i,
        e.y = n,
        o && (e.nameId = o),
        this.emit("updatePOI", e, t))
    }
    ,
    n.prototype._updatePOI = function(e) {
        e = e || {};
        var t = this
          , i = e.id
          , n = e.x
          , o = e.y
          , s = e.nameId
          , a = window.gui.playerData.position.worldmapId
          , r = this.getPOI(i, a);
        r ? this._requestUpdatePOI(r, a, n, o, s) : void 0 === n && void 0 === o ? t.removePOI(i, a) : (delete e.mapId,
        this.addPOI(e))
    }
    ,
    n.prototype._validateWorldMapId = function(e) {
        var t = window.gui.databases.WorldMaps[e];
        return t || e === _ ? (this._POIMap[e] || (this._POIMap[e] = {}),
        t ? t.id : e) : void console.warn("World map", e, "does not exist.")
    }
    ,
    n.prototype._redrawCompass = function() {
        window.gui.compass.updateMarkersPositions()
    }
    ,
    n.prototype._enableTracking = function(e, t, i) {
        i = void 0 === i || i;
        var n = this.getPOI(e, t)
          , o = window.gui.compass;
        i ? o.addMarker({
            type: e,
            x: n.x,
            y: n.y,
            arrowType: n.categoryId,
            tooltip: n.nameId
        }) : o.removeMarker(e)
    }
    ,
    n.prototype._getMapPosition = function(e, t) {
        return void 0 === e ? t() : void u.getData("MapPositions", e, function(e, i) {
            return e ? t(e) : void t(null , i)
        })
    }
    ,
    n.prototype._requestGuildInfo = function() {
        if (window.gui.playerData.guild.hasGuild())
            for (var e in p) {
                var t = p[e];
                window.dofus.sendMessage("GuildGetInformationsMessage", {
                    infoType: t
                })
            }
    }
    ,
    n.prototype._sweep = function() {
        for (var e in this._POIMap) {
            var t = this._POIMap[e];
            for (var i in t)
                this.removePOI(i, e)
        }
    }
    ,
    n.prototype._isDungeonMap = function(e) {
        return e !== f && e !== m && e !== g
    }
    ,
    n.prototype.addPOI = function(e) {
        function t(t) {
            if (t || void 0 !== e.x && void 0 !== e.y) {
                t = t || {};
                var n = void 0 !== t.posX ? t.posX : e.x
                  , o = void 0 !== t.posY ? t.posY : e.y
                  , s = new l(e);
                s.x = n,
                s.y = o;
                var a = window.gui.playerData.position.worldmapId
                  , r = t.worldMap !== -1 ? t.worldMap || a : a;
                i._validateWorldMapId(r);
                var c = i._POIMap[r][s.id];
                if (c)
                    return i._requestUpdatePOI(c, r, n, o);
                i._POIMap[r][s.id] = s,
                s.isDestination && i.addDestination(s.id, r),
                i.emit("addPOI", s, r)
            }
        }
        var i = this;
        if (e = e || {},
        0 === window.gui.playerData.position.worldmapId)
            return window.gui.playerData.position.once("mapUpdate", function() {
                i.addPOI(e)
            });
        var n = e.mapId;
        if (n)
            this._getMapPosition(n, function(e, i) {
                return e ? console.error(e) : void t(i)
            });
        else if ("questObjective" === e.categoryId)
            t({
                worldMap: m
            });
        else {
            var o = window.gui.playerData.position.worldmapId;
            t({
                worldMap: o
            })
        }
    }
    ,
    n.prototype.removePOI = function(e, t) {
        if (void 0 !== t) {
            if (t = this._validateWorldMapId(t),
            void 0 === t || !this.getPOI(e, t))
                return;
            this.removeDestination(e, t),
            delete this._POIMap[t][e],
            this.emit("removePOI", e, t)
        } else
            for (var i in this._POIMap)
                this.removePOI(e, i);
        this._POIMap[_] && this._POIMap[_][e] && delete this._POIMap[_][e]
    }
    ,
    n.prototype.changeMap = function(e) {
        function t(e) {
            var t = s._POIMap[e];
            if (t)
                for (var i in t)
                    o = t[i],
                    o.isDestination && s._enableTracking(i, s._lastWorldMapId, !1)
        }
        function i(e) {
            for (var t in s._POIMap[e])
                o = s._POIMap[e][t],
                o.isDestination && (s._enableTracking(t, e),
                a.push(o.id))
        }
        if (void 0 !== e) {
            var n, o, s = this;
            this._isDungeonMap(e) || this._requestGuildInfo();
            for (n in this._POIMap[_])
                o = this._POIMap[_][n],
                this.removePOI(n, this._lastWorldMapId),
                o.mapId = 0,
                this.addPOI(o);
            t(this._lastWorldMapId);
            var a = [];
            i(e);
            var r = window.gui.compass;
            for (n in r.markers)
                a.indexOf(n) === -1 && r.removeMarker(n);
            this._redrawCompass(),
            this.emit("changedMap", e),
            this._lastWorldMapId = e
        }
    }
    ,
    n.prototype.getPOI = function(e, t) {
        if (void 0 !== t && this._validateWorldMapId(t))
            return this._POIMap[t][e];
        var i, n, o;
        for (n in this._POIMap) {
            var s = this._POIMap[n];
            for (i in s)
                i === e && (o = o || {},
                o[n] = o[n] || {},
                o[n][i] = s[i])
        }
        return o
    }
    ,
    n.prototype.getPOIs = function(e) {
        var t = {};
        e = e || window.gui.playerData.position.worldmapId,
        t = this._POIMap[this._validateWorldMapId(e)];
        for (var i in this._fixedPOIMap)
            t[i] = this._fixedPOIMap[i];
        return t
    }
    ,
    n.prototype.addDestination = function(e, t) {
        if (t = this._validateWorldMapId(t),
        void 0 !== t) {
            var i = this.getPOI(e, t);
            i.isDestination = !0,
            t === window.gui.playerData.position.worldmapId && (this._enableTracking(e, t),
            this._redrawCompass()),
            this.emit("addDestination", i, t)
        }
    }
    ,
    n.prototype.removeDestination = function(e, t) {
        if (t = this._validateWorldMapId(t),
        void 0 !== t) {
            var i = this.getPOI(e, t);
            i.isDestination = !1,
            t === window.gui.playerData.position.worldmapId && (this._enableTracking(e, t, !1),
            this._redrawCompass()),
            this.emit("removeDestination", e, t)
        }
    }
    ,
    n.prototype.getQuestObjectivePoiId = function(e) {
        return "quest_" + e
    }
    ,
    n.prototype.addQuestObjectiveFromObjective = function(e) {
        e = e || {};
        var t = e.objectiveDb
          , i = e.objectiveId
          , n = e.questId
          , s = e.coords || null
          , a = this
          , r = this.getQuestObjectivePoiId(i);
        if (!this.getPOI(r)) {
            var l = t.mapId;
            if (!s) {
                if (l)
                    return o(l, function(e) {
                        e = e || t.coords,
                        a.addQuestObjectiveFromObjective({
                            objectiveDb: t,
                            objectiveId: i,
                            coords: e,
                            questId: n
                        })
                    });
                s = t.coords
            }
            if (s && void 0 !== s.x && void 0 !== s.y) {
                for (var c = window.gui.playerData.quests.all[n], u = c.dbQuest.nameId, h = "", d = 0; d < c.objectives.length; d++) {
                    var p = c.objectives[d];
                    if (p.objectiveId === i) {
                        h = p.text;
                        break
                    }
                }
                var m = {
                    id: r,
                    x: s.x,
                    y: s.y,
                    mapId: l,
                    nameId: u + "\n\n" + h + "\n\n(" + s.x + "," + s.y + ")",
                    categoryId: "questObjective",
                    color: {
                        r: 102,
                        g: 204,
                        b: 0,
                        a: 1
                    },
                    isDestination: !0
                };
                this.addPOI(m)
            }
        }
    }
    ,
    n.prototype.addQuestObjective = function(e, t) {
        if (!window.gui.playerData.isFighting) {
            var i = window.gui.playerData.quests;
            if (!i[e])
                return console.warn("GPS.addQuestObjective: quest id" + e + " is not active.");
            var n = i[e].dbObjectives[t];
            this.addQuestObjectiveFromObjective({
                objectiveDb: n,
                objectiveId: t,
                questId: e
            })
        }
    }
    ,
    n.prototype.addQuestNextObjective = function(e) {
        if (!window.gui.playerData.isFighting) {
            var t = window.gui.playerData.quests;
            if (!t.active[e])
                return console.warn("GPS.addQuestNextObjective: quest id" + e + " is not active.");
            for (var i = t.active[e], n = 0; n < i.objectives.length; n++) {
                var o = i.objectives[n];
                if (o.objectiveStatus) {
                    var s = o.objectiveId
                      , a = i.dbObjectives[s];
                    this.addQuestObjectiveFromObjective({
                        objectiveDb: a,
                        objectiveId: s,
                        questId: e
                    })
                }
            }
        }
    }
    ,
    n.prototype.removeQuestObjectives = function(e) {
        var t = window.gui.playerData.quests.all[e];
        if (!t)
            return console.warn("GPS.removeQuestObjectives: quest id" + e + " not found.");
        for (var i = 0; i < t.objectives.length; i++) {
            var n = t.objectives[i];
            if (n.objectiveStatus) {
                var o = n.objectiveId
                  , s = this.getQuestObjectivePoiId(o);
                this.removePOI(s)
            }
        }
    }
    ,
    n.prototype.addAllQuestsObjectives = function() {
        var e = window.gui.playerData.quests;
        for (var t in e.active)
            this.addQuestNextObjective(t)
    }
    ,
    n.prototype.addAllFollowedQuestsObjectives = function() {
        var e = window.gui.playerData.quests;
        for (var t in e.active)
            this.questFollower.isQuestFollowed(t) && this.addQuestNextObjective(t)
    }
    ,
    n.prototype.isAtLeastOneQuestObjectiveFollowed = function(e) {
        var t = window.gui.playerData.quests.active[e];
        if (!t)
            return console.warn("GPS.isAtLeastOneQuestObjectiveFollowed: quest id" + e + " not active."),
            !1;
        for (var i = 0; i < t.objectives.length; i++) {
            var n = t.objectives[i];
            if (n.objectiveStatus) {
                var o = n.objectiveId
                  , s = this.getQuestObjectivePoiId(o);
                if (this.getPOI(s))
                    return !0
            }
        }
        return !1
    }
    ,
    n.prototype.addCustomFlag = function(e, t) {
        this.addPOI({
            id: "customFlag_" + e + "_" + t,
            x: e,
            y: t,
            categoryId: "customFlag",
            nameId: d("ui.cartography.customFlag") + "\n\n(" + e + "," + t + ")",
            color: {
                r: 255,
                g: 221,
                b: 0,
                a: 1
            },
            isDestination: !0
        })
    }
    ,
    n.prototype.removeCustomFlag = function(e, t) {
        this.removePOI("customFlag_" + e + "_" + t)
    }
    ,
    n.prototype.autoGpsFlagOptionUpdate = function() {
        h.autoGpsFlags ? this.addAllFollowedQuestsObjectives() : this._sweep()
    }
    ,
    n.prototype.questFollower = c,
    e.exports = n
}
, function(e, t, i) {
    function n(e) {
        function t(t) {
            var i = {
                id: "house_" + t.houseId,
                mapId: t.mapId,
                categoryId: _,
                nameId: l("ui.common.myHouse"),
                iconId: p
            };
            e.addPOI(i)
        }
        function i(t) {
            c.getData("Houses", t.modelId, function(i, n) {
                if (i)
                    return console.error(i);
                var o = {
                    id: "guild_house_" + t.houseId,
                    mapId: t.mapId,
                    categoryId: _,
                    nameId: l("ui.common.guildHouse") + l("ui.common.colon") + n.nameId,
                    iconId: m
                };
                e.addPOI(o)
            })
        }
        function n(t) {
            var i = {
                id: "guild_paddock_" + t.paddockId,
                mapId: t.mapId,
                categoryId: _,
                nameId: l("ui.guild.paddock", t.maxOutdoorMount),
                iconId: f
            };
            e.addPOI(i)
        }
        var o = window.gui;
        o.on("AccountHouseMessage", function(e) {
            e.houses.forEach(function(e) {
                t(e)
            })
        }),
        o.on("GuildHousesInformationMessage", function(e) {
            e.housesInformations.forEach(function(e) {
                i(e)
            })
        }),
        o.on("GuildHouseUpdateInformationMessage", function(e) {
            i(e.housesInformations)
        }),
        o.on("GuildHouseRemoveMessage", function(t) {
            e.removePOI("guild_house_" + t.houseId)
        }),
        o.on("GuildInformationsPaddocksMessage", function(e) {
            e.paddocksInformations.forEach(function(e) {
                n(e)
            })
        }),
        o.on("GuildPaddockBoughtMessage", function(e) {
            n(e.paddockInfo)
        }),
        o.on("GuildPaddockRemovedMessage", function(t) {
            e.removePOI("guild_paddock_" + t.paddockId)
        })
    }
    function o(e) {
        var t = window.gui;
        t.on("AtlasPointInformationsMessage", function(i) {
            if (i.type.type === h.ATLAS_INFOS_PHOENIX) {
                var n;
                if (this.playerData.isAlive())
                    for (n = 0; n < e._lastPhoenixes.length; n += 1)
                        e.removePOI("phoenix_" + e._lastPhoenixes[n].mapId);
                else {
                    var o = i.type.coords;
                    for (n = 0; n < o.length; n += 1) {
                        var s = o[n]
                          , a = {
                            id: "phoenix_" + s.mapId,
                            mapId: s.mapId,
                            categoryId: "phoenix",
                            x: s.worldX,
                            y: s.worldY,
                            nameId: l("ui.common.phoenix"),
                            iconId: g,
                            isDestination: !0
                        };
                        e.addPOI(a)
                    }
                    e._lastPhoenixes = o
                }
                t.compass.updateMarkersPositions()
            }
        })
    }
    function s(e) {
        var t = window.gui
          , i = t.playerData.quests;
        i.on("objectiveValidated", function(t, i) {
            e.removePOI(e.getQuestObjectivePoiId(i))
        }),
        i.on("stepValidated", function(t, i) {
            for (var n = t.dbSteps[i], o = 0; o < n.objectiveIds.length; o += 1)
                e.removePOI(e.getQuestObjectivePoiId(n.objectiveIds[o]))
        }),
        i.on("questFinished", function(t) {
            for (var i = t.dbSteps[t.stepId], n = 0; n < i.objectiveIds.length; n += 1)
                e.removePOI(e.getQuestObjectivePoiId(i.objectiveIds[n]))
        }),
        i.on("questUpdate", function(t) {
            e.questFollower.isQuestFollowed(t) && e.addQuestNextObjective(t)
        }),
        i.on("questStarted", function(t) {
            u.autoGpsFlags && e.questFollower.followQuest(t, !0)
        }),
        i.on("listUpdated", function() {
            e.addAllFollowedQuestsObjectives()
        })
    }
    function a(e) {
        function t(t) {
            var i = {
                id: "spouse_" + t.spouseId,
                mapId: t.mapId,
                categoryId: v,
                nameId: l("ui.cartography.positionof", t.spouseName),
                color: {
                    r: 255,
                    g: 0,
                    b: 137,
                    a: 1
                },
                isDestination: !0
            };
            e.addPOI(i),
            e._lastSpouseId = t.spouseId
        }
        var i = window.gui;
        i.on("SpouseStatusMessage", function(n) {
            function o(e) {
                e.followingSpouse && t(e)
            }
            if (n.hasSpouse) {
                var s = i.playerData.socialData.spouse;
                s ? o(s) : i.once("SpouseInformationsMessage", function(e) {
                    o(e.spouse)
                })
            } else {
                if (!e._lastSpouseId)
                    return;
                e.removePOI("spouse_" + e._lastSpouseId),
                delete e._lastSpouseId
            }
        })
    }
    function r(e) {
        function t(t) {
            var n;
            switch (t.type) {
            case d.COMPASS_TYPE_SPOUSE:
                var o = i.playerData.socialData.spouse;
                if (!o)
                    return void console.warn("Spouse does not exist");
                n = {
                    id: "spouse_" + o.spouseId,
                    x: t.worldX,
                    y: t.worldY,
                    categoryId: v,
                    nameId: l("ui.cartography.positionof", o.spouseName),
                    color: {
                        r: 255,
                        g: 0,
                        b: 137,
                        a: 1
                    },
                    mapId: o.mapId,
                    isDestination: !0
                };
                break;
            case d.COMPASS_TYPE_PARTY:
                var s = i.party.getMemberById(i.party.currentParty.partyId, t.memberId);
                if (!s)
                    return void console.warn("Party member", t.memberId, "does not exist.");
                n = {
                    id: "party_" + s.id,
                    x: t.worldX,
                    y: t.worldY,
                    categoryId: v,
                    nameId: l("ui.cartography.positionof", s.name) + "\n\n(" + t.worldX + ", " + t.worldY + ")",
                    color: [1, 1.1, 2, 1],
                    mapId: s.mapId,
                    isDestination: !0
                },
                e._lastPartyMemberId = s.id;
                break;
            case d.COMPASS_TYPE_QUEST:
                n = {
                    id: "flag_srv" + t.type,
                    x: t.worldX,
                    y: t.worldY,
                    categoryId: v,
                    nameId: t.worldX + "," + t.worldY,
                    color: {
                        r: 85,
                        g: 136,
                        b: 0,
                        a: 1
                    },
                    mapId: window.gui.playerData.position.worldmapId,
                    isDestination: !0
                },
                window.gui.chat.logMsg(l("tablet.cartography.flagUpdated", t.worldX, t.worldY));
                break;
            case "zaap":
                n = {
                    id: "zaap",
                    x: t.worldX,
                    y: t.worldY,
                    categoryId: "zaap",
                    nameId: t.worldX + "," + t.worldY,
                    color: {
                        r: 150,
                        g: 199,
                        b: 221,
                        a: 1
                    },
                    mapId: window.gui.playerData.position.worldmapId,
                    isDestination: !0
                };
                break;
            default:
                console.error("Unhandled CompassTypeEnum value:", t.type);
            case d.COMPASS_TYPE_SIMPLE:
                var a = i.compass.addMarker({
                    type: t.type,
                    x: t.worldX,
                    y: t.worldY
                });
                window.gui.chat.logMsg(l("tablet.cartography.compassUpdated", a))
            }
            n && e._updatePOI(n),
            i.compass.updateMarkersPositions()
        }
        var i = window.gui;
        i.on("CompassUpdateMessage", t),
        i.on("CompassUpdatePartyMemberMessage", t),
        i.on("CompassResetMessage", function(t) {
            switch (t.type) {
            case d.COMPASS_TYPE_SPOUSE:
                var n = i.playerData.socialData.spouse;
                e.removePOI("spouse_" + n.spouseId);
                break;
            case d.COMPASS_TYPE_PARTY:
                e.removePOI("party_" + e._lastPartyMemberId);
                break;
            case d.COMPASS_TYPE_QUEST:
                e.removePOI("flag_srv" + t.type);
                break;
            default:
                i.compass.removeMarker({
                    type: t.type
                })
            }
            i.compass.updateMarkersPositions()
        }),
        i.playerData.position.on("mapUpdate", function() {
            i.playerData.isFighting || i.tutorialManager.inTutorial ? i.compass.clearContent() : i.compass.updateMarkersPositions()
        }),
        e.on("updatePOI", function(e) {
            if (e.isDestination) {
                var t = i.compass.markers[e.id];
                t.x = e.x,
                t.y = e.y,
                e.nameId && (t.tooltip = e.nameId),
                i.compass.updateMarkersPositions()
            }
        }),
        i.fightManager.on("fightStart", function() {
            i.compass.clearContent()
        })
    }
    var l = i(35).getText
      , c = i(36)
      , u = i(25)
      , h = i(473)
      , d = i(452)
      , p = "icon_1000"
      , m = "icon_1001"
      , f = "icon_1002"
      , g = "flag1"
      , _ = 7
      , v = "hint";
    e.exports.init = function(e) {
        o(e),
        n(e),
        s(e),
        a(e),
        r(e)
    }
}
, function(e, t) {
    e.exports = {
        ATLAS_INFOS_RESET: 0,
        ATLAS_INFOS_UNKNOWN: 1,
        ATLAS_INFOS_FLAG: 2,
        ATLAS_INFOS_PHOENIX: 3
    }
}
, function(e, t) {
    function i(e) {
        e = e || {},
        this.id = e.id,
        this.categoryId = e.categoryId || "custom",
        this.x = e.x,
        this.y = e.y,
        this.nameId = e.nameId || "",
        this.color = e.color,
        this.color && !Array.isArray(this.color) && (this.color = [this.color.r / 124, this.color.g / 124, this.color.b / 124, this.color.a]),
        this.data = e.data,
        this.isDestination = e.isDestination,
        this.iconId = e.iconId || n
    }
    var n = "flag0";
    e.exports = i
}
, function(e, t, i) {
    var n = i(16).EventEmitter
      , o = i(26).inherits
      , s = i(30)
      , a = function() {
        this.userPrefKey = null ,
        this.followedQuests = {}
    };
    o(a, n),
    a.prototype.init = function() {
        var e = this
          , t = window.gui;
        t.playerData.on("characterSelectedSuccess", function() {
            e.userPrefKey = t.playerData.id + "-followedQuests",
            e.followedQuests = s.getValue(e.userPrefKey, {})
        }),
        t.on("disconnect", this._clear)
    }
    ,
    a.prototype._clear = function() {
        this.userPrefKey = null ,
        this.followedQuests = {}
    }
    ,
    a.prototype._save = function() {
        s.setValue(this.userPrefKey, this.followedQuests)
    }
    ,
    a.prototype.followQuest = function(e, t) {
        var i = window.gui
          , n = i.playerData.quests.active[e];
        return n ? (this.followedQuests[e] = !0,
        this._save(),
        n.objectives ? void (t && i.GPS.addQuestNextObjective(e)) : console.warn("followQuest: quest id " + e + " has no objectives")) : console.warn("followQuest: quest id " + e + " is not active")
    }
    ,
    a.prototype.unfollowQuest = function(e, t) {
        delete this.followedQuests[e],
        this._save(),
        t && window.gui.GPS.removeQuestObjectives(e)
    }
    ,
    a.prototype.unfollowAllQuests = function() {
        var e = window.gui
          , t = e.playerData.quests.active;
        for (var i in t)
            e.GPS.removeQuestObjectives(i);
        this.followedQuests = {},
        this._save()
    }
    ,
    a.prototype.isQuestFollowed = function(e) {
        return !!this.followedQuests[e]
    }
    ,
    e.exports = new a
}
, function(e, t) {
    e.exports = {
        INFO_GENERAL: 1,
        INFO_MEMBERS: 2,
        INFO_BOOSTS: 3,
        INFO_PADDOCKS: 4,
        INFO_HOUSES: 5,
        INFO_TAX_COLLECTOR_GUILD_ONLY: 6,
        INFO_TAX_COLLECTOR_ALLIANCE: 7,
        INFO_TAX_COLLECTOR_LEAVE: 8
    }
}
, function(e, t, i) {
    function n() {
        r.call(this, "", {
            className: "HouseMenuButton",
            hidden: !0
        });
        var e = this;
        this._reset(),
        this._icon = this.createChild("div", {
            className: "icon"
        }),
        this.on("tap", function() {
            e._updateToolTip(),
            window.gui.openContextualMenu("generic", e._tooltipParams)
        }),
        this._registerListeners()
    }
    function o() {
        c.open("guildHouseSetting"),
        window.dofus.sendMessage("HouseGuildRightsViewMessage")
    }
    function s() {
        c.open("padlock", {
            fromInside: !0
        })
    }
    i(478);
    var a = i(26).inherits
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(22);
    a(n, r),
    e.exports = n,
    n.prototype._reset = function() {
        this._locked = !1,
        this._myHouse = null ,
        this._onSale = !1,
        this._tooltipParams = null
    }
    ,
    n.prototype._registerListeners = function() {
        var e = this
          , t = window.gui
          , i = t.playerData
          , n = i.position;
        t.on("disconnect", function() {
            e._reset()
        }),
        n.on("myHouseNotification", function(t) {
            t = t || {};
            var i = t.isInMyHouse
              , n = t.msg;
            return i ? (e._myHouse = n.currentHouse,
            e._onSale = !!n.currentHouse.price,
            e._locked = n.currentHouse.isLocked,
            e._updateIcon(),
            void e.show()) : (e.hide(),
            void e._reset())
        }),
        t.on("HousePropertiesMessage", function(t) {
            var i = t.properties;
            e._tooltipParams && e._myHouse && e._myHouse.houseId === i.houseId && (e._onSale = i.isOnSale,
            e._updateIcon())
        }),
        t.on("LockableStateUpdateHouseDoorMessage", function(t) {
            e._tooltipParams && e._myHouse && e._myHouse.houseId === t.houseId && (e._locked = t.locked,
            e._updateIcon())
        }),
        t.on("HouseSoldMessage", function(t) {
            var n = t.buyerName;
            e._tooltipParams && e._myHouse && n === i.identification.nickname && (e._myHouse.price = t.realPrice)
        })
    }
    ,
    n.prototype._updateIcon = function() {
        var e = this._locked ? "locked" : "";
        e = this._onSale ? "onSale" : e,
        this._icon.replaceClassNames(["onSale", "locked"], e ? [e] : [])
    }
    ,
    n.prototype._updateToolTip = function() {
        var e = this;
        this._tooltipParams = {
            title: l("ui.house.homeOf", this._myHouse.ownerName),
            actions: []
        };
        var t = l(this._onSale ? "ui.common.changeHousePrice" : "ui.common.sell");
        this._tooltipParams.actions.push({
            caption: t,
            cb: function() {
                var t = c.getWindow("houseBuySell");
                t.prepareDialog(e._myHouse),
                c.open("houseBuySell", {
                    fromInside: !0,
                    myHouse: e._myHouse
                })
            }
        });
        var i = l(this._locked ? "ui.common.unlock" : "ui.common.lock");
        this._tooltipParams.actions.push({
            caption: i,
            cb: s
        });
        var n = window.gui.playerData.guild;
        n.hasGuild() && this._tooltipParams.actions.push({
            caption: l("ui.common.guildHouseConfiguration"),
            cb: o
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        v.call(this, "div", {
            className: "KohBox",
            hidden: !0
        }),
        m(this),
        this.on("tap", function() {
            window.gui.windowsContainer.appendChild(this)
        }),
        this.once("show", function() {
            this._createDom()
        });
        var e = this;
        window.gui.on("KohUpdateMessage", function(t) {
            e.show(),
            e._setCurrentState(t)
        }),
        this.isInProbation = !1,
        window.gui.on("UpdateSelfAgressableStatusMessage", function(t) {
            switch (t.status) {
            case r.AvA_ENABLED_AGGRESSABLE:
                e.isInProbation = !1;
                break;
            case r.AvA_PREQUALIFIED_AGGRESSABLE:
                e.isInProbation = !0
            }
        })
    }
    function o(e, t, i, n, o, s) {
        var a = new v("div",{
            className: ["side", t]
        });
        l(a, i);
        var r = new h({
            width: 25,
            height: 25
        });
        r.setValue(e.allianceEmblem, !0),
        l(r, e.allianceName + " [" + e.allianceTag + "]");
        var u = new v("div",{
            text: e.allianceTag
        });
        return m(u),
        u.on("tap", function() {
            c.openAllianceCard(e.allianceId)
        }),
        {
            side: a,
            emblem: r,
            tag: u,
            characters: s,
            maps: o,
            time: n
        }
    }
    i(480);
    var s, a, r = i(335), l = i(206).addTooltip, c = i(423), u = i(24).dimensions, h = i(289), d = i(35).getText, p = i(26).inherits, m = i(32), f = i(481).serverConstants, g = i(336), _ = i(485), v = i(190), y = i(487);
    p(n, v),
    n.prototype._createDom = function() {
        function e() {
            b.replaceClassNames(["full"], ["open"]),
            w = "open"
        }
        var t = window.gui.serversData;
        s = t.sessionConstants[f.SERVER_CONST_KOH_WINNING_SCORE],
        a = Math.floor(t.sessionConstants[f.SERVER_CONST_KOH_DURATION]),
        this.setStyle("left", u.mapLeft + Math.floor(u.mapWidth / 2) + "px");
        var i = this.createChild("div", {
            className: "displaySwitch"
        });
        i.createChild("div", {
            className: "arrow"
        });
        var n = this.createChild("div", {
            className: "mainBox"
        })
          , o = n.createChild("div", {
            className: "topBox"
        })
          , r = n.createChild("div", {
            className: "secondaryBox"
        });
        this.gauge = o.appendChild(new y(["green", "blue", "red"],380));
        var c = Math.floor(a / 1e3 / 60)
          , h = Math.floor(c / 60) + ":" + c % 60
          , p = o.createChild("div", {
            className: "kohInfo"
        });
        l(p, d("ui.koh.tooltip.rules", s, h), {
            openOnTap: !0
        });
        var g = r.createChild("div", {
            className: "allianceBox"
        });
        this.table = g.appendChild(new _({
            colIds: ["side", "emblem", "tag", "characters", "maps", "time"],
            headerContent: ["", "", d("ui.common.alliance"), d("ui.short.characters"), d("ui.common.maps"), d("ui.common.time")]
        })),
        l(this.table.getHeaderCol("characters"), d("ui.koh.tooltip.members")),
        l(this.table.getHeaderCol("maps"), d("ui.koh.tooltip.maps")),
        l(this.table.getHeaderCol("time"), d("ui.koh.tooltip.time")),
        this.winnerInfo = g.createChild("div", {
            className: "info"
        });
        var v = r.createChild("div", {
            className: "statsBox"
        });
        this.winnerStats = v.createChild("div", {
            className: "winnerStats"
        }),
        l(this.winnerStats, d("ui.koh.tooltip.mapConquest")),
        this.myStats = v.createChild("div", {
            className: "myStats"
        }),
        l(this.myStats, d("ui.koh.tooltip.mapConquestForMyAlliance"));
        var w;
        m(i);
        var b = this;
        i.on("tap", function() {
            switch (w) {
            case "open":
                b.replaceClassNames(["open"], ["full"]),
                w = "full";
                break;
            case "full":
                b.delClassNames("open", "full"),
                w = "close";
                break;
            case "close":
                e()
            }
        }),
        this.on("hide", e),
        e()
    }
    ,
    n.prototype._setCurrentState = function(e) {
        var t = this;
        this.table.clearContent();
        for (var i = window.gui.playerData, n = i.alliance.current, a = i.position, r = g.entities.prism[a.subAreaId], l = r && r.prism && r.prism.alliance || n, u = 0, h = 0, p = {
            mine: {
                weight: 0,
                type: d("ui.alliance.myAlliance"),
                tooltip: ""
            },
            defense: {
                weight: 0,
                type: d("ui.alliance.allianceInDefense"),
                tooltip: ""
            },
            attack: {
                weight: 0,
                type: d("ui.alliance.allianceInAttack"),
                tooltip: ""
            }
        }, f = 0, _ = e.alliances.length; f < _; f += 1) {
            var y = e.alliances[f]
              , w = e.allianceNbMembers[f]
              , b = e.allianceMatchScore[f]
              , C = e.allianceRoundWeigth[f];
            u += C;
            var I;
            I = y.allianceId === n.allianceId ? "mine" : y.allianceId === l.allianceId ? "defense" : "attack";
            var T = b + "/" + s
              , S = p[I];
            S.weight += C,
            S.tooltip += y.allianceName + " [" + y.allianceTag + "] (" + C + ") : " + T + "\n",
            this.table.addRow(o(y, I, S.type, T, C, w), {
                weight: C
            }),
            e.allianceMatchScore[h] < b && (h = f)
        }
        this.table.sort(function(e, t) {
            return t.weight - e.weight
        }),
        u = u || 1,
        p.mine.weight /= u,
        p.mine.tooltip += p.mine.type,
        p.defense.weight /= u,
        p.defense.tooltip += p.defense.type,
        p.attack.weight /= u,
        p.attack.tooltip += p.attack.type,
        this.gauge.setValues([p.mine, p.defense, p.attack]);
        var A = e.alliances[h]
          , E = e.allianceMatchScore[h];
        if (A && E >= s)
            return this.winnerInfo.setText(d("ui.koh.win", A.allianceName)),
            this.winnerInfo.show(),
            void setTimeout(function() {
                t.winnerInfo.setText(""),
                t.hide()
            }, 6e4);
        var x = e.allianceMapWinner
          , M = e.allianceMapWinnerScore;
        this.winnerStats.clearContent();
        var N = a.coordinates;
        if (this.winnerStats.createChild("span", {
            text: d("ui.option.worldOption") + " [" + N.posX + ", " + N.posY + "]" + d("ui.common.colon")
        }),
        0 === M || this.isInProbation)
            this.winnerStats.createChild("span", {
                text: d("ui.common.neutral")
            });
        else if ("" === x.allianceTag)
            this.winnerStats.createChild("span", {
                text: d("ui.koh.draw", M)
            });
        else {
            var R = this.winnerStats.createChild("span", {
                text: x.allianceTag,
                className: "link"
            });
            m(R),
            R.on("tap", function() {
                c.openAllianceCard(x.allianceId)
            }),
            this.winnerStats.appendChild(new v("span",{
                text: " " + M + " " + d("ui.short.points")
            }))
        }
        if (x.allianceId !== n.allianceId && M > 0 && !this.isInProbation) {
            this.myStats.clearContent(),
            this.myStats.createChild("span", {
                text: "("
            });
            var O = this.myStats.createChild("span", {
                text: n.allianceTag,
                className: "link"
            });
            m(O),
            O.on("tap", function() {
                c.openAllianceCard(n.allianceId)
            }),
            this.myStats.appendChild(new v("span",{
                text: " " + e.allianceMapMyAllianceScore + " " + d("ui.short.points") + ")"
            })),
            this.myStats.show()
        } else
            this.myStats.hide()
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return !!f[e]
    }
    function o() {
        this.serversRawData = [],
        this.serversWithMyCharacter = [],
        this.optionalFeatures = {},
        this.connectedServerId = null ,
        this.connectedServerData = null ,
        this.sessionConstants = {},
        this.settings = {}
    }
    var s = i(36)
      , a = i(22)
      , r = i(35).getText
      , l = i(50)
      , c = i(482)
      , u = i(483)
      , h = i(484)
      , d = i(5)
      , p = 6e4
      , m = !1
      , f = {
        401: !0,
        402: !0,
        407: !0,
        403: !0,
        404: !0,
        405: !0,
        406: !0,
        408: !0,
        409: !0
    };
    e.exports = o,
    o.serverConstants = {
        SERVER_CONST_TIME_BEFORE_DISCONNECTION: 1,
        SERVER_CONST_KOH_DURATION: 2,
        SERVER_CONST_KOH_WINNING_SCORE: 3,
        SERVER_CONST_MINIMAL_TIME_BEFORE_KOH: 4,
        SERVER_CONST_TIME_BEFORE_WEIGH_IN_KOH: 5
    },
    o.prototype.selectServer = function(e) {
        if (!e)
            return console.error(new Error("ServersData.selectServer: serverId is null")),
            void this._onSelectedServerRefused({});
        l.selectServer(e),
        this.connectedServerId = e,
        this.connectedServerData = this._findServerById(e),
        window.dofus.accessGameServer(e, function(e) {
            if (e)
                return console.error("accessGameServer", e)
        }),
        this.failTimeout && (console.warn("Clearing previous connection timeout from ServersData.selectServer"),
        window.clearTimeout(this.failTimeout));
        var t = this;
        this.failTimeout = window.setTimeout(function() {
            t._onSelectedServerRefused({
                serverId: e,
                serverStatus: c.STATUS_UNKNOWN,
                error: h.SERVER_CONNECTION_ERROR_NO_REASON
            })
        }, p),
        window.gui.once("AuthenticationTicketAcceptedMessage", function() {
            window.clearTimeout(t.failTimeout),
            t.failTimeout = null
        })
    }
    ,
    o.prototype.showServerSelectionUi = function() {
        this.serversWithMyCharacter.length > 0 ? a.open("serverSelection", this.serversWithMyCharacter) : a.open("serverSimpleSelection", this.serversRawData)
    }
    ,
    o.prototype._filterMyServersList = function() {
        this.serversWithMyCharacter = this.serversRawData.filter(function(e) {
            return e && e.charactersCount > 0
        })
    }
    ,
    o.prototype.initialize = function(e) {
        var t = this;
        e.on("disconnect", function(e) {
            t.serversRawData = [],
            t.serversWithMyCharacter = [],
            t.optionalFeatures = {},
            t.connectedServerId = "disconnect" + e,
            t.connectedServerData = null ,
            t.sessionConstants = {},
            t.settings = {}
        }),
        e.on("ServerStatusUpdateMessage", function(i) {
            if (!i.server)
                return console.warn("WARN: ServerStatusUpdateMessage message have no server information");
            for (var n = i.server, o = !0, s = 0, a = t.serversRawData.length; s < a; s += 1)
                if (n.id === t.serversRawData[s].id) {
                    t.serversRawData[s] = n,
                    o = !1;
                    break
                }
            o && t.serversRawData.push(n),
            t._filterMyServersList(),
            e.emit("serversUpdate", n)
        }),
        e.on("SelectedServerRefusedMessage", function(e) {
            t._onSelectedServerRefused(e)
        }),
        e.on("ServerOptionalFeaturesMessage", function(e) {
            t.optionalFeatures = {};
            for (var i = window.gui.databases.OptionalFeatures, n = 0, o = e.features.length; n < o; n += 1) {
                var s = e.features[n];
                t.optionalFeatures[i[s].keyword] = s
            }
        }),
        e.on("ServerSessionConstantsMessage", function(e) {
            t.sessionConstants = {};
            for (var i = e.variables, n = 0, o = e.variables.length; n < o; n += 1)
                t.sessionConstants[i[n].id] = i[n].value
        }),
        e.on("ServerSettingsMessage", function(e) {
            t.settings.serverCommunityId = e.community,
            t.settings.serverLang = e.lang,
            t.settings.serverGameType = e.gameType
        }),
        e.on("CharacterSelectedSuccessMessage", function() {
            delete t.staticContent
        })
    }
    ,
    o.prototype.onServerList = function(e) {
        this.serversRawData = e.servers,
        this._filterMyServersList();
        var t = this.serversWithMyCharacter
          , i = l.connectMethod
          , n = l.lastServerId
          , o = "lastServer" === i || "lastCharacter" === i || "characterId" === i;
        if (n && o)
            for (var s = 0, a = t.length; s < a; s += 1) {
                var r = t[s];
                if (n === r.id && r.status === c.ONLINE)
                    return this.selectServer(n)
            }
        this.showServerSelectionUi()
    }
    ,
    o.prototype.isFeatureActive = function(e) {
        return this.optionalFeatures.hasOwnProperty(e)
    }
    ,
    o.prototype.syncServerStaticData = function(e) {
        var t = this;
        if (this.staticContent)
            return e();
        this.staticContent = {};
        var i = ["Servers", "ServerGameTypes", "ServerPopulations", "ServerCommunities"];
        s.getAllDataMap(i, function(i, n) {
            return i ? e(i) : (t.staticContent.data = n.Servers,
            t.staticContent.gameTypes = n.ServerGameTypes,
            t.staticContent.populations = n.ServerPopulations,
            t.staticContent.communities = n.ServerCommunities,
            e())
        })
    }
    ,
    o.prototype.getAutoChosenServers = function(e) {
        function t(e) {
            for (var t = -1, i = [], n = 0, o = e.length; n < o; n += 1) {
                var s = e[n]
                  , a = s.staticData.server;
                s.status === c.ONLINE && t === -1 && (t = s.completion),
                a.nameId = a.nameId || "n/a",
                t !== -1 && a.populationId === t && s.status === c.ONLINE && a.nameId.indexOf("Test") === -1 && i.push(s)
            }
            return i
        }
        var i, n, o = this, s = this.serversRawData, a = window.gui.playerData.identification, r = a.communityId, l = [], h = [], d = [];
        return this.syncServerStaticData(function(a) {
            if (a)
                return e(a);
            for (i = 0,
            n = s.length; i < n; i += 1) {
                var c = s[i];
                if (c) {
                    var p = o.staticContent.data[c.id];
                    if (p) {
                        switch (c.staticData || (c.staticData = {}),
                        c.staticData.server = p,
                        c.id) {
                        case 401:
                        case 406:
                        case 407:
                            c.completion = u.COMPLETION_AVERAGE,
                            p.populationId = u.COMPLETION_AVERAGE;
                            break;
                        case 403:
                            c.completion = u.COMPLETION_HIGH,
                            p.populationId = u.COMPLETION_HIGH;
                            break;
                        case 404:
                            c.completion = u.COMPLETION_HIGH,
                            p.populationId = u.COMPLETION_HIGH;
                            break;
                        case 405:
                            c.completion = u.COMPLETION_HIGH,
                            p.populationId = u.COMPLETION_HIGH;
                            break;
                        case 409:
                            c.completion = u.COMPLETION_AVERAGE,
                            p.populationId = u.COMPLETION_AVERAGE
                        }
                        var m = p.communityId;
                        r === m ? l.push(c) : (1 !== r && 2 !== r || 1 !== m && 2 !== m || l.push(c),
                        4 !== r && 6 !== r || 4 !== m && 6 !== m || l.push(c),
                        2 === m && h.push(c))
                    } else
                        console.warn("WARN: server", c.id, "has no staticContent")
                }
            }
            return 0 === l.length && (l = l.concat(h)),
            l.sort(function(e, t) {
                return e.completion - t.completion
            }),
            0 === l.length ? e("My community servers is empty, for userCommunity " + r) : (d = t(l),
            0 === d.length ? e("Available servers is empty, for userCommunity " + r) : e(null , d))
        })
    }
    ,
    o.prototype.pickUpOneServerForMe = function() {
        this.getAutoChosenServers(function(e, t) {
            if (e)
                return window.gui.openSimplePopup(r("tablet.server.noServersForYourCommunity")),
                void (m || (console.error("pickUpOneServerForMe:", e),
                m = !0));
            var i = t[Math.floor(Math.random() * t.length)];
            i && a.open("serverDetails", i)
        })
    }
    ,
    o.prototype._findServerById = function(e) {
        for (var t = 0; t < this.serversRawData.length; t++)
            if (e === this.serversRawData[t].id)
                return this.serversRawData[t];
        return null
    }
    ,
    o.prototype.getSelectableServerList = function() {
        for (var e = [], t = 0; t < this.serversRawData.length; t++) {
            var i = this.serversRawData[t];
            i.status === c.ONLINE && i.isSelectable && e.push(i)
        }
        return e
    }
    ,
    o.prototype.getSelectableServerNames = function() {
        var e = this.getSelectableServerList();
        if (0 === e.length)
            return r("ui.common.none").toLowerCase();
        for (var t = e[0]._name, i = 1; i < e.length; i++)
            t += ", " + e[i]._name;
        return t
    }
    ,
    o.prototype._onSelectedServerRefused = function(e) {
        this.failTimeout && window.clearTimeout(this.failTimeout);
        var t = this._findServerById(e.serverId);
        t && (t.status = e.serverStatus);
        var i;
        switch (e.error) {
        case h.SERVER_CONNECTION_ERROR_DUE_TO_STATUS:
            switch (i = "Status",
            e.serverStatus) {
            case c.OFFLINE:
                i += "Offline";
                break;
            case c.STARTING:
                i += "Starting";
                break;
            case c.NOJOIN:
                i += "Nojoin";
                break;
            case c.SAVING:
                i += "Saving";
                break;
            case c.STOPING:
                i += "Stoping";
                break;
            case c.FULL:
                i += "Full";
                break;
            default:
                i += "Unknown"
            }
            break;
        case h.SERVER_CONNECTION_ERROR_ACCOUNT_RESTRICTED:
            i = "AccountRestricted";
            break;
        case h.SERVER_CONNECTION_ERROR_COMMUNITY_RESTRICTED:
            i = "CommunityRestricted";
            break;
        case h.SERVER_CONNECTION_ERROR_LOCATION_RESTRICTED:
            i = "LocationRestricted";
            break;
        case h.SERVER_CONNECTION_ERROR_SUBSCRIBERS_ONLY:
            i = "SubscribersOnly";
            break;
        case h.SERVER_CONNECTION_ERROR_REGULAR_PLAYERS_ONLY:
            i = "RegularPlayersOnly";
            break;
        default:
            i = "NoReason"
        }
        var n;
        switch (i) {
        case "AccountRestricted":
            n = r("ui.server.cantChoose.serverForbidden");
            break;
        case "CommunityRestricted":
            n = r("ui.server.cantChoose.communityRestricted");
            break;
        case "LocationRestricted":
            n = r("ui.server.cantChoose.locationRestricted");
            break;
        case "SubscribersOnly":
            n = r("ui.server.cantChoose.communityNonSubscriberRestricted");
            break;
        case "RegularPlayersOnly":
            n = r("ui.server.cantChoose.regularPlayerRestricted");
            break;
        case "StatusOffline":
            n = r("ui.server.cantChoose.serverDown");
            break;
        case "StatusStarting":
            n = r("ui.server.cantChoose.serverDown");
            break;
        case "StatusNojoin":
            n = r("ui.server.cantChoose.serverForbidden");
            break;
        case "StatusSaving":
            n = r("ui.server.cantChoose.serverSaving");
            break;
        case "StatusStoping":
            n = r("ui.server.cantChoose.serverDown");
            break;
        case "StatusFull":
            n = r("ui.server.cantChoose.serverFull") + "\n\n" + r("ui.server.serversAccessibles", this.getSelectableServerNames());
            break;
        case "NoReason":
        case "StatusUnknown":
            n = r("ui.popup.connectionFailed.text")
        }
        this.showServerSelectionUi(),
        window.gui.openSimplePopup(n)
    }
    ,
    o.getServerImage = function(e, t) {
        var i = ["gfx/illus/illu_0.png"];
        n(e) && i.push("gfx/illus/illu_" + e + ".png"),
        d.preloadImages(i, function(e) {
            var i = e[0]
              , n = e[1];
            return n && "none" !== n ? t(null , n) : t(null , i)
        })
    }
}
, function(e, t) {
    e.exports = {
        STATUS_UNKNOWN: 0,
        OFFLINE: 1,
        STARTING: 2,
        ONLINE: 3,
        NOJOIN: 4,
        SAVING: 5,
        STOPING: 6,
        FULL: 7
    }
}
, function(e, t) {
    e.exports = {
        COMPLETION_RECOMANDATED: 0,
        COMPLETION_AVERAGE: 1,
        COMPLETION_HIGH: 2,
        COMPLETION_COMING_SOON: 3,
        COMPLETION_FULL: 4
    }
}
, function(e, t) {
    e.exports = {
        SERVER_CONNECTION_ERROR_DUE_TO_STATUS: 0,
        SERVER_CONNECTION_ERROR_NO_REASON: 1,
        SERVER_CONNECTION_ERROR_ACCOUNT_RESTRICTED: 2,
        SERVER_CONNECTION_ERROR_COMMUNITY_RESTRICTED: 3,
        SERVER_CONNECTION_ERROR_LOCATION_RESTRICTED: 4,
        SERVER_CONNECTION_ERROR_SUBSCRIBERS_ONLY: 5,
        SERVER_CONNECTION_ERROR_REGULAR_PLAYERS_ONLY: 6
    }
}
, function(e, t, i) {
    function n(e) {
        return e ? (o.call(this, "div", e),
        this.addClassNames(["Table", e.className]),
        this._rows = [],
        this._rowCount = 0,
        this._hiddenRowIds = [],
        this._clickable = !1,
        this._colIds = e.colIds,
        this._minRows = e.minRows || 0,
        this._colCount = this._colIds ? this._colIds.length : e.colCount || 1,
        this._defaultRowContent = e.defaultRowContent || [],
        this._highlightable = e.highlightable,
        this._disableAutoSelect = e.disableAutoSelect,
        this._autoUpdateRowColor = !e.disableRowColor,
        e.headerContent && (this.header = this.createChild("div", {
            className: ["container", "header"]
        }),
        this._addHeader(e.headerContent)),
        this.content = this.createChild("div", {
            className: ["container", "content"]
        }),
        e.footerContent && (this.footer = this.createChild("div", {
            className: ["container", "footer"]
        }),
        this._addFooter(e.footerContent)),
        e.onRowTap && (this._clickable = !0,
        this.on("selected", e.onRowTap)),
        void (e.minRows && this._setupDefaultRows())) : void console.error("Undefined Table 'options' parameter")
    }
    i(486);
    var o = i(190)
      , s = i(32)
      , a = i(26).inherits;
    a(n, o),
    e.exports = n,
    n.prototype.addRow = function(e, t) {
        var i;
        return this._rowCount < this._rows.length ? (this._rows[this._rowCount]._isEmpty = !1,
        i = this.updateRow(this._rowCount, e, t)) : i = this._addRow(e, null , t),
        this._rowCount++,
        this._updateRowColor(),
        i
    }
    ,
    n.prototype.insertRow = function(e, t, i) {
        if (e < 0 || e > this._rows.length)
            return console.warn("[Table.insertRow] the specified index (" + e + ") is out of range."),
            null ;
        var n = this._rows[e];
        if (n && n._isEmpty)
            n._isEmpty = !1,
            n = this.updateRow(e, t, i);
        else {
            n = this._createRow(t, "content");
            for (var o in i)
                n[o] = i[o];
            e === this._rows.length ? this.content.appendChild(n) : n.insertBefore(this._rows[e]),
            this._rows.splice(e, 0, n)
        }
        return this._rowCount++,
        this._updateRowColor(),
        n
    }
    ,
    n.prototype.sort = function(e) {
        var t = this._rows;
        t.sort(e);
        for (var i = 0, n = t.length; i < n; i += 1)
            this.content.appendChild(t[i]);
        this._updateRowColor()
    }
    ,
    n.prototype.delRow = function(e) {
        if (e > this._rowCount)
            return console.error("[Table.delRow] Row index " + e + " does not exist.");
        if (!this._isRowEmpty(e)) {
            var t = this._rows[e];
            this._lastSelected === t && (this._lastSelected = null ),
            t.destroy(),
            this._rowCount--,
            this._rows.splice(e, 1),
            this._rows.length < this._minRows && this._addRow(),
            this._highlightable && !this._disableAutoSelect && this.highlight(0),
            this._updateRowColor()
        }
    }
    ,
    n.prototype.updateRowContent = function(e, t, i) {
        if (!e._isEmpty) {
            for (var n in i)
                e[n] = i[n];
            if (this._highlightable && e.enable(),
            Array.isArray(t)) {
                for (var s = {}, a = this._colIds, r = 0; r < a.length; r++)
                    s[a[r]] = t[r];
                t = s
            }
            for (var l in t) {
                var c = e.getChild(l)
                  , u = t[l];
                c.clearContent(),
                u instanceof o ? c.appendChild(u) : (void 0 !== u && null !== u || (u = ""),
                c.setHtml(u.toString()))
            }
            return !this._highlightable || this._lastSelected || this._disableAutoSelect || this.highlight(0),
            e
        }
    }
    ,
    n.prototype.updateRow = function(e, t, i) {
        if (!this._isRowEmpty(e)) {
            var n = this._rows[e];
            return this.updateRowContent(n, t, i)
        }
    }
    ,
    n.prototype.getRows = function() {
        return this._rows
    }
    ,
    n.prototype.clearContent = function() {
        for (var e = 0; e < this._rows.length; e++)
            this._rows[e].destroy();
        this._rows = [],
        this._rowCount = 0,
        this._lastSelected = null ,
        this._hiddenRowIds = [],
        this._setupDefaultRows()
    }
    ,
    n.prototype.removeHightlight = function() {
        this._lastSelected && (this._lastSelected.delClassNames("highlight"),
        this._lastSelected = null )
    }
    ,
    n.prototype.highlightFirstRow = function() {
        for (var e = 0; e < this._rows.length; e++) {
            var t = this._rows[e];
            if (t.isVisible())
                return void this.highlightRow(t)
        }
    }
    ,
    n.prototype.highlightRow = function(e) {
        if (this._highlightable) {
            if (!e || e._isEmpty)
                return void console.warn("Invalid index, row does not exist or empty!");
            e !== this._lastSelected && (this._lastSelected && this._lastSelected.delClassNames("highlight"),
            this._lastSelected = e,
            this._lastSelected.addClassNames("highlight")),
            this.emit("selected", e)
        }
    }
    ,
    n.prototype.highlight = function(e) {
        this.highlightRow(this._rows[e])
    }
    ,
    n.prototype.getRowCount = function() {
        return this._rowCount
    }
    ,
    n.prototype.getRow = function(e) {
        return this._rows[e] && this._isRowEmpty(e) ? void console.warn("[Table.getRow] Row index " + e + " is empty.") : this._rows[e]
    }
    ,
    n.prototype.getCol = function(e, t) {
        var i = this.getRow(e);
        if (i)
            return i.getChild(t)
    }
    ,
    n.prototype.getHeaderCol = function(e) {
        return this.header.getChildren()[0].getChild(e)
    }
    ,
    n.prototype.hideRows = function(e) {
        if (e.length) {
            for (var t = 0, i = 0; i < e.length; i++) {
                var n = e[i]
                  , o = this.getRow(n);
                o && (o.hide(),
                this._hiddenRowIds.push(n),
                t++)
            }
            var s = this.getRowCount() - t;
            return this._disableAutoSelect || this.highlightFirstRow(),
            s < this._minRows ? (s = this._minRows - s,
            void this._addEmptyRows(s)) : void this._updateRowColor()
        }
    }
    ,
    n.prototype.showRows = function() {
        var e = this._hiddenRowIds;
        if (e.length) {
            for (var t = 0; t < e.length; t++) {
                var i = this.getRow(e[t]);
                i && i.show()
            }
            return this._disableAutoSelect || this.highlightFirstRow(),
            this._hiddenRowIds = [],
            this._rows.length > this._minRows ? void this._delEmptyRows(this._rows.length - this._minRows) : void this._updateRowColor()
        }
    }
    ,
    n.prototype._updateRowColor = function() {
        if (this._autoUpdateRowColor)
            for (var e = !0, t = 0; t < this._rows.length; t++) {
                var i = this._rows[t];
                i.isVisible() && (e ? (i.addClassNames("odd"),
                e = !1) : (i.delClassNames("odd", "even"),
                e = !0))
            }
    }
    ,
    n.prototype._isRowEmpty = function(e) {
        return this._rows[e]._isEmpty
    }
    ,
    n.prototype._createRow = function(e, t) {
        var i = this._colIds || []
          , n = new o("div",{
            className: "row"
        });
        e || (n._isEmpty = !0,
        e = this._defaultRowContent);
        for (var a, r = Array.isArray(e), l = 0; l < this._colCount; l++) {
            var c = i[l]
              , u = n.createChild("div", {
                className: "col",
                name: c || ""
            });
            r ? a = e[l] : (a = e[c],
            n[c] = a),
            (a || 0 === a) && (a instanceof o ? u.appendChild(a) : u.setHtml(a.toString()))
        }
        if ("content" !== t)
            return n;
        if (this._highlightable || this._clickable) {
            s(n),
            n.on("disabled", function() {
                n.addClassNames("disabled")
            }),
            n.on("enabled", function() {
                n.delClassNames("disabled")
            }),
            n._isEmpty && n.disable();
            var h = this;
            n.on("tap", function() {
                h.highlightRow(this)
            })
        }
        return n
    }
    ,
    n.prototype._addRow = function(e, t, i) {
        t = t || "content";
        var n = this._createRow(e, t);
        this[t].appendChild(n);
        for (var o in i)
            n[o] = i[o];
        return "content" !== t ? n : (this._rows.push(n),
        e ? (!this._highlightable || this._lastSelected || this._disableAutoSelect || this.highlight(0),
        n) : void 0)
    }
    ,
    n.prototype._addEmptyRows = function(e) {
        for (var t = 0; t < e; t++)
            this._addRow();
        this._updateRowColor()
    }
    ,
    n.prototype._addHeader = function(e) {
        this._addRow(e, "header")
    }
    ,
    n.prototype._addFooter = function(e) {
        this._addRow(e, "footer")
    }
    ,
    n.prototype._setupDefaultRows = function() {
        for (; this._rows.length < this._minRows; )
            this._addRow();
        this._updateRowColor()
    }
    ,
    n.prototype._delEmptyRows = function(e) {
        for (var t = this._rows.length - 1; t >= 0 && !(0 === e || this._rows.length <= this._minRows); t--)
            this._isRowEmpty(t) && (this._rows[t].destroy(),
            this._rows.splice(t, 1),
            e--);
        this._updateRowColor()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        a.call(this, "div", {
            className: "Gauge"
        }),
        this.createChild("div", {
            className: "barBg"
        });
        var i = this.createChild("div", {
            className: "barBox"
        });
        this.bars = [];
        for (var n = 0, s = e.length; n < s; n += 1) {
            var r = i.createChild("div", {
                className: "barContainer"
            });
            r.createChild("div", {
                className: ["bar", e[n]]
            }),
            r.tooltip = i.createChild("div", {
                className: "tooltip"
            }),
            r.tooltipContent = new a("div"),
            o(r.tooltip, r.tooltipContent, {
                openOnTap: !0
            }),
            this.bars.push(r)
        }
        this.width = t
    }
    var o = i(206).addTooltip
      , s = i(26).inherits
      , a = i(190);
    s(n, a),
    e.exports = n,
    n.prototype.setValues = function(e) {
        for (var t = 0, i = 0, n = this.bars.length; i < n; i += 1) {
            var o = e[i]
              , s = this.bars[i]
              , a = Math.floor(this.width * o.weight);
            s.setStyles({
                "-webkit-mask-position": t + "px 0",
                "-webkit-mask-size": a + "px 100%"
            }),
            s.tooltip.setStyles({
                left: t + "px",
                width: a + "px"
            }),
            t += a,
            s.tooltipContent.setText(o.tooltip)
        }
    }
}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "mapCoordinateDisplay",
            hidden: !0
        }),
        this.setupListeners(),
        this.createContent()
    }
    i(489);
    var o = i(24).dimensions
      , s = i(26).inherits
      , a = i(190)
      , r = i(423)
      , l = i(289)
      , c = i(32)
      , u = i(35).getText
      , h = i(336)
      , d = i(31)
      , p = 12;
    s(n, a),
    e.exports = n,
    n.prototype.createContent = function() {
        this.descriptionElement = this.createChild("div"),
        this.coordinatesElement = this.createChild("div"),
        this.allianceInfo = this.createChild("div", {
            className: "allianceInfo"
        }),
        c(this.allianceInfo),
        this.allianceInfo.on("tap", function() {
            r.openAllianceCard(this.allianceId)
        }),
        this.allianceTag = this.allianceInfo.createChild("div", {
            className: "tag"
        }),
        this.allianceEmblem = this.allianceInfo.appendChild(new l({
            width: 35,
            height: 35
        }))
    }
    ,
    n.prototype._updateMapInfo = function() {
        var e = window.gui.playerData.position;
        if (e.mapPosition) {
            var t = h.entities.prism
              , i = e.coordinates.posX + "," + e.coordinates.posY
              , n = e.mapPosition.nameId;
            n || (n = e.area.nameId + " (" + e.subArea.nameId + ")",
            i += ", " + u("ui.common.averageLevel") + " " + e.subArea.level),
            this.descriptionElement.setText(n),
            this.coordinatesElement.setText(i);
            var o = t[e.subArea.id];
            if (o && o.prism) {
                var s = o.getAlliance();
                this.allianceInfo.allianceId = s.allianceId,
                this.allianceTag.setText("[" + s.allianceTag + "]"),
                this.allianceEmblem.setValue(s.allianceEmblem, !0),
                this.allianceInfo.show()
            } else
                this.allianceInfo.hide()
        }
    }
    ,
    n.prototype.showMethod = function() {
        var e = this;
        a.prototype.showMethod.call(this),
        this._updateMapInfo(),
        window.setTimeout(function() {
            d.tween(e, {
                opacity: 1
            }, {
                time: 100,
                easing: "linear"
            })
        }, 100)
    }
    ,
    n.prototype.hideMethod = function() {
        var e = this;
        d.tween(this, {
            opacity: 0
        }, {
            time: 100,
            easing: "linear"
        }, function() {
            a.prototype.hideMethod.call(e)
        })
    }
    ,
    n.prototype.setupListeners = function() {
        var e = this
          , t = window.gui;
        t.on("disconnect", function() {
            e.hide()
        }),
        t.playerData.position.on("mapUpdate", function() {
            e.isVisible() && e._updateMapInfo()
        }),
        t.on("resize", function() {
            e.setStyles({
                left: o.mapLeft + p + "px",
                top: o.mapTop + p + "px"
            })
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        if (!t)
            return _["switch"](e);
        var i = _.getWindow(e)
          , n = i.getOpenedTabId();
        i.openState && t === n ? _.close(e) : _.open(e, {
            tabId: t
        })
    }
    function o() {
        _.getWindow("tradeInventory").isMyShopOpen() ? _.close("tradeInventory") : (window.dofus.sendMessage("LeaveDialogRequestMessage", null ),
        window.dofus.sendMessage("ExchangeRequestOnShopStockMessage"))
    }
    function s() {
        _.getWindow("bidHouseShop").openState ? _.close("bidHouseShop") : r.openBidHouse(!1)
    }
    function a() {
        g.call(this, {
            autoClose: !0
        }),
        this.addClassNames("MenuBar"),
        this._sizeInIcons = -1,
        this._iconOrder = [],
        this._plusIconList = [],
        this._manualMode = !1,
        this._createDom(),
        this._listenToServerEvents(),
        this._listenToInternalEvents()
    }
    i(491);
    var r = i(311)
      , l = i(6)
      , c = i(24).dimensions
      , u = i(186)
      , h = i(35).getText
      , d = i(26).inherits
      , p = i(204)
      , m = i(30)
      , f = i(31)
      , g = i(492)
      , _ = i(22)
      , v = i(158)
      , y = l.MENU_ICON_SIZE
      , w = {
        narrow: 8,
        wide: 4
    }
      , b = {
        narrow: 35,
        wide: 45
    }
      , C = {
        Carac: {
            tooltip: "ui.banner.character",
            windowId: "characteristics"
        },
        Spell: {
            tooltip: "ui.grimoire.mySpell",
            windowId: "grimoire",
            tabId: "spells"
        },
        Bag: {
            tooltip: "ui.banner.inventory",
            windowId: "equipment"
        },
        Book: {
            tooltip: "ui.common.quests",
            windowId: "grimoire",
            tabId: "quests"
        },
        Map: {
            tooltip: "ui.banner.map",
            windowId: "worldMap"
        },
        Friend: {
            tooltip: "ui.banner.friends",
            windowId: "social",
            tabId: "friends"
        },
        Guild: {
            tooltip: "ui.common.guild",
            windowId: "social",
            tabId: "guild"
        },
        BidHouse: {
            tooltip: "ui.bidhouse.bigStore",
            action: s
        },
        Conquest: {
            tooltip: "ui.common.koliseum",
            windowId: "arena"
        },
        Goultine: {
            tooltip: "tablet.window.shop.title",
            windowId: "market",
            tabId: "shop"
        },
        Job: {
            tooltip: "ui.common.myJobs",
            windowId: "grimoire",
            tabId: "jobs"
        },
        Alliance: {
            tooltip: "ui.common.alliance",
            windowId: "social",
            tabId: "alliance"
        },
        Mount: {
            tooltip: "ui.banner.mount",
            windowId: "mount"
        },
        Directory: {
            tooltip: "ui.common.directory",
            windowId: "social",
            tabId: "directory"
        },
        Alignment: {
            tooltip: "ui.common.alignment",
            windowId: "grimoire",
            tabId: "alignment"
        },
        Bestiary: {
            tooltip: "ui.common.bestiary",
            windowId: "grimoire",
            tabId: "bestiary"
        },
        Title: {
            tooltip: "ui.common.titles",
            windowId: "grimoire",
            tabId: "ornaments"
        },
        Achievement: {
            tooltip: "ui.achievement.achievement",
            windowId: "grimoire",
            tabId: "achievements"
        },
        Almanax: {
            tooltip: "ui.almanax.almanax",
            windowId: "grimoire",
            tabId: "almanax"
        },
        Spouse: {
            tooltip: "ui.common.spouse",
            windowId: "social",
            tabId: "spouse"
        },
        Shop: {
            tooltip: "ui.common.shop",
            action: o
        }
    }
      , I = ["Carac", "Spell", "Bag", "BidHouse", "Map", "Friend", "Book", "Guild", "Conquest", "Goultine", "Job", "Alliance", "Mount", "Directory", "Alignment", "Bestiary", "Title", "Achievement", "Almanax", "Spouse", "Shop"]
      , T = "menuBarOrder";
    d(a, g),
    e.exports = a,
    a.prototype._createDom = function() {
        this._iconsBox = this.content.createChild("div", {
            className: "iconsBoxContainer"
        }),
        this._icons = this.content.createChild("div", {
            className: "iconsContainer"
        });
        var e = this;
        this._unlock = !1,
        this._lockBtn = this.content.appendChild(new p({
            className: "lockBtn",
            scaleOnPress: !0
        },function() {
            e._toggleIconsDrag(!e._unlock)
        }
        ));
        for (var t = 0; t < I.length; t++)
            this._createIcon(t, I[t])
    }
    ,
    a.prototype.setIconAvailability = function(e, t) {
        void 0 === t && (console.error(new Error("setIconAvailability: enabled param should not be undefined")),
        t = !1);
        var i = this._icons.getChild(e);
        i.toggleClassName("disabled", !t),
        i.isDisabled = !t
    }
    ,
    a.prototype.enableDragButton = function(e) {
        this._lockBtn.setEnable(e)
    }
    ,
    a.prototype._toggleIconsDrag = function(e) {
        for (var t = this._icons.getChildren(), i = 0, n = t.length; i < n; i += 1)
            u.setDragEnable(t[i], e);
        this._lockBtn.toggleClassName("on", !e),
        this.toggleClassName("draggable", e),
        this._unlock = e
    }
    ,
    a.prototype._listenToServerEvents = function() {
        function e() {
            return i.tutorialManager.inTutorial || i.playerData.isFighting
        }
        var t = this
          , i = window.gui;
        i.uiLocker.on("updated", function(e) {
            if (e.menuButtonId) {
                if (!C[e.menuButtonId])
                    return console.error(new Error("Unknown button id `" + e.menuButtonId + "` in MenuBar."));
                if (t.setIconAvailability(e.menuButtonId, !e.locked),
                !e.locked) {
                    var i = t.getIcon(e.menuButtonId);
                    if (i) {
                        var n = t._plusIconList;
                        n.indexOf(e.menuButtonId) === -1 || i.hasClassName("plusIcon") || i.addClassNames("plusIcon")
                    }
                }
            }
        }),
        i.tutorialManager.on("inTutorialStateChanged", function(e) {
            return e ? (t._manualMode = !0,
            t._setButtonsOrder(I),
            t.enableDragButton(!1),
            i.uiLocker.lockAllFeatures("tutorial"),
            void t._clearPlusIconsStyle()) : (t._manualMode && t._setButtonsOrder(t._iconOrder),
            t._manualMode = !1,
            t.enableDragButton(!0),
            t._showPlusIcons(),
            void i.uiLocker.unlockAllFeatures("tutorial"))
        }),
        i.fightManager.on("fightStart", function() {
            t._clearPlusIconsStyle()
        }),
        i.fightManager.on("fightEnd", function() {
            t._showPlusIcons()
        }),
        i.playerData.characters.mainCharacter.on("newSpellLearned", function() {
            t._addPlusIcon("Spell", {
                doNotShow: e()
            })
        }),
        i.playerData.on("characterLevelUp", function() {
            t._addPlusIcon("Carac", {
                doNotShow: e()
            })
        });
        var n = _.getWindow("grimoire");
        n.tabs.on("openTab", function(i) {
            "spells" !== i || e() || t._removePlusIcon("Spell")
        });
        var o = _.getWindow("characteristics");
        o.on("open", function() {
            e() || t._removePlusIcon("Carac", !1)
        })
    }
    ,
    a.prototype._listenToInternalEvents = function() {
        var e = this
          , t = window.gui;
        t.on("connected", function() {
            e._loadButtonOrderFromAccountPref(),
            e._setButtonsOrder(e._iconOrder)
        }),
        t.on("disconnect", function() {
            e._manualMode = !1,
            e._clearPlusIconsStyle(),
            e._plusIconList = []
        }),
        this.on("close", function() {
            this._toggleIconsDrag(!1)
        })
    }
    ,
    a.prototype._onDrop = function(e, t) {
        if (e.id !== t.id) {
            e.delClassNames("vibrate");
            var i = e.index
              , n = t.index
              , o = this;
            f.tween(e, {
                webkitTransform: "translate3d(" + (t.x - e.x) + "px," + (t.y - e.y) + "px,0)"
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                o._positionIcon(e, n),
                o._iconOrder[e.index] = e.id,
                o._iconOrder[t.index] = t.id,
                m.setValue(T, o._iconOrder),
                e.addClassNames("vibrate")
            }),
            this._positionIcon(t, i)
        }
    }
    ,
    a.prototype._createIcon = function(e, t) {
        var i = this;
        this._iconsBox.createChild("div", {
            className: "iconBox"
        });
        var o = C[t]
          , s = this._icons.appendChild(new p({
            className: ["vibrate", "anim" + Math.floor(9 * Math.random()), "menuIcon" + t, "menuBarIcon"],
            tooltip: h(o.tooltip),
            name: t,
            scaleOnPress: !0
        },function() {
            i.close(),
            "Goultine" === t && v.log("HUD.Click_on_button", {
                interface_id: "MenuBar",
                button_id: "BTN_MENUBAR_SHOP",
                clic_parameter_key: "position",
                clic_parameter_value: s.index + 1,
                clic_type: "Simple_court"
            }),
            this.isDisabled || (o.action ? o.action() : n(o.windowId, o.tabId))
        }
        ));
        s.id = t,
        s.index = e,
        u.setDraggable(s, null , "menuBar", null , {
            dragElement: !0,
            dragOnTouchstart: !0
        }),
        u.setDroppable(s, ["menuBar"], {
            matchPositionOnDrop: !0
        }),
        u.disableDrag(s),
        s.on("drop", function(e) {
            i._onDrop(this, e)
        }),
        s.on("tooltipOn", function() {
            this.setStyle("webkitTransform", "scale(1.1)")
        }),
        s.on("tooltipOut", function() {
            this.setStyle("webkitTransform", "scale(1)")
        })
    }
    ,
    a.prototype.getIcon = function(e) {
        return this._icons.getChild(e)
    }
    ,
    a.prototype._reorderButtons = function() {
        for (var e = this._icons.getChildren(), t = this._iconsBox.getChildren(), i = 0, n = e.length; i < n; i += 1) {
            var o = e[i];
            this._positionIcon(o, o.index),
            this._positionIcon(t[i], o.index)
        }
    }
    ,
    a.prototype._setButtonsOrder = function(e) {
        for (var t = 0; t < e.length; t++) {
            var i = e[t]
              , n = this._icons.getChild(i);
            n.index = t,
            this._positionIcon(n, t)
        }
    }
    ,
    a.prototype._loadButtonOrderFromAccountPref = function() {
        if (this._iconOrder = m.getValue(T, null ),
        this._iconOrder)
            for (var e = 0; e < I.length; e++)
                this._iconOrder.indexOf(I[e]) === -1 && this._iconOrder.splice(e, 0, I[e]);
        else
            this._iconOrder = I.concat();
        for (var t = 0; t < this._iconOrder.length; t++) {
            var i = this._iconOrder[t]
              , n = this._icons.getChild(i);
            if (n) {
                var o = window.gui.uiLocker.isMenuButtonAvailable(i);
                this.setIconAvailability(i, o)
            } else
                this._iconOrder.splice(t, 1),
                t--
        }
    }
    ,
    a.prototype._positionIcon = function(e, t) {
        window.gui.ipadRatio ? (e.x = (y + 1) * (t % this._iconsPerLine),
        e.y = (y + 2) * Math.floor(t / this._iconsPerLine)) : (e.x = (y + 4) * Math.floor(t / this._iconsPerColumn),
        e.y = y * (t % this._iconsPerColumn)),
        e.index = t,
        e.setStyles({
            left: e.x + "px",
            top: e.y + "px",
            webkitTransform: ""
        })
    }
    ,
    a.prototype.computeMinimumSize = function(e, t) {
        return this._sizeInIcons = e,
        e * y + w[t]
    }
    ,
    a.prototype._resize = function() {
        var e, t = window.gui.ipadRatio ? "narrow" : "wide";
        window.gui.ipadRatio ? (this._iconsPerLine = this._sizeInIcons,
        this._iconsPerColumn = Math.ceil(I.length / this._iconsPerLine),
        this.setStyles({
            top: "",
            right: "",
            bottom: 0,
            left: c.posMenuBar + "px",
            width: c.menuBarSize + "px",
            height: c.bottomBarHeight + "px"
        }),
        this._icons.setStyle("height", y * this._iconsPerColumn + b[t] + "px"),
        this._icons.setStyle("width", y * this._iconsPerLine + "px"),
        e = "top") : (this._iconsPerColumn = this._sizeInIcons,
        this._iconsPerLine = Math.ceil(I.length / this._iconsPerColumn),
        this.setStyles({
            bottom: "",
            left: "",
            top: c.posMenuBar + "px",
            right: 0,
            width: c.sideBarWidth + "px",
            height: c.menuBarSize + "px"
        }),
        this._icons.setStyle("width", y * this._iconsPerLine + b[t] + "px"),
        e = "left"),
        this._reorderButtons(),
        this.setOpeningSide(e)
    }
    ,
    a.prototype._addPlusIcon = function(e, t) {
        t = t || {};
        var i = this.getIcon(e);
        if (i) {
            !t.doNotShow && window.gui.uiLocker.isMenuButtonAvailable(e) && i.addClassNames("plusIcon");
            var n = this._plusIconList;
            n.indexOf(e) === -1 && n.push(e)
        }
    }
    ,
    a.prototype._removePlusIcon = function(e) {
        var t = this.getIcon(e);
        if (t) {
            var i = this._plusIconList
              , n = i.indexOf(e);
            n >= 0 && (t.delClassNames("plusIcon"),
            i.splice(n, 1))
        }
    }
    ,
    a.prototype._clearPlusIconsStyle = function() {
        for (var e = this._icons.getChildren(), t = 0; t < e.length; t += 1) {
            var i = e[t];
            i.delClassNames("plusIcon")
        }
    }
    ,
    a.prototype._showPlusIcons = function() {
        for (var e = this._plusIconList, t = 0; t < e.length; t += 1) {
            var i = e[t]
              , n = this.getIcon(i);
            n.addClassNames("plusIcon")
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t() {
            var e = n.isOpen;
            n._resize(),
            window.setTimeout(function() {
                n.getCurrentDrawerSize() >= n.getCurrentContentSize() ? (n.setAsAlwaysOpen(!0),
                i.hide()) : (n.setAsAlwaysOpen(!1),
                i.show()),
                n.refresh(),
                e && n.shouldKeepOpen && n.open()
            }, 0)
        }
        e = e || {},
        s.call(this, {
            className: "MenuDrawer",
            background: !0,
            autoClose: e.autoClose,
            backDrawerSize: e.backDrawerSize
        }),
        this.shouldKeepOpen = !1;
        var i, n = this;
        window.gui.once("connected", function() {
            this.on("resize", function() {
                t()
            }),
            t()
        }),
        window.gui.on("disconnect", function() {
            n.close()
        }),
        this.content.createChild("div", {
            className: "topBorder"
        }),
        i = this.content.createChild("div", {
            className: "arrowBtnBg"
        }),
        i.appendChild(new a({
            className: "arrowBtn"
        },function() {
            n.isOpen ? n.close() : n.open()
        }
        ));
        var o = l.getValue("tablet.tutorial.canSwipeDrawer");
        o || i.once("tap", function() {
            var e = window.gui.notificationBar
              , t = {
                type: e.notificationType.PRIORITY_INVITATION,
                title: r("tablet.tutorial.tip"),
                text: r("tablet.tutorial.canSwipeDrawer")
            };
            e.newNotification("tip canSwipeDrawer", t),
            l.setValue("tablet.tutorial.canSwipeDrawer", !0)
        }),
        this.createChild("div", {
            className: "borderBox"
        })
    }
    i(493);
    var o = i(26).inherits
      , s = i(494)
      , a = i(204)
      , r = i(35).getText
      , l = i(30);
    o(n, s),
    e.exports = n,
    n.prototype._resize = function() {}
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            var t = e[this._axis] - l;
            t * this._direction <= 0 ? t = 0 : t * this._direction > this._contentSize - this._visibleSize && (t = (this._contentSize - this._visibleSize) * this._direction);
            var i = "translate" + this._axis + "(" + (this._currentPosition + t) + "px)";
            this.content.setStyle("webkitTransform", i),
            this.background && this.background.setStyle("webkitTransform", i)
        }
        function i(e) {
            var t = e[this._axis] - l;
            t * this._direction >= 0 ? t = 0 : t * this._direction < this._visibleSize - this._contentSize && (t = (this._visibleSize - this._contentSize) * this._direction);
            var i = "translate" + this._axis + "(" + (this._currentPosition + t) + "px)";
            this.content.setStyle("webkitTransform", i),
            this.background && this.background.setStyle("webkitTransform", i)
        }
        function n() {
            c = !0
        }
        function o() {
            c || u.close(),
            c = !1
        }
        r.call(this, "div", {
            className: "SwipingDrawer"
        }),
        e = e || {},
        this.addClassNames(e.className),
        e.background && (this.backgroundArea = this.createChild("div", {
            className: "drawerBackgroundArea"
        }),
        this.background = this.backgroundArea.createChild("div", {
            className: "drawerBackground"
        })),
        this.visibleArea = this.createChild("div", {
            className: "visibleArea"
        }),
        this.content = this.visibleArea.createChild("div", {
            className: "drawerContent"
        }),
        this._contentSize = 0,
        this._extraContentSize = e.backDrawerSize || 0,
        this.isOpen = !1,
        this._isAlwaysOpen = !1,
        s(this);
        var a, l;
        this.on("slideStart", function(e) {
            this.addClassNames("open"),
            this._tween1 && (this._tween1.cancel(),
            this._tween1 = null ),
            this._tween2 && (this._tween2.cancel(),
            this._tween2 = null ),
            l = e[this._axis],
            this.isOpen ? (a = (this._contentSize - this._visibleSize) / 3,
            this.on("slide", t)) : (a = (this._visibleSize - this._contentSize) / 3,
            this.on("slide", i))
        }),
        this.on("slideEnd", function(e, n, o) {
            var s = e[this._axis] - l;
            this._currentPosition += s,
            this.isOpen ? (s * this._direction > a || o && s * this._direction > 0 ? this._close(!0) : this._open(!0),
            this.removeListener("slide", t)) : (s * this._direction < a || o && s * this._direction > 0 ? this._open(!0) : this._close(!0),
            this.removeListener("slide", i))
        });
        var c = !1
          , u = this;
        e.autoClose && (this.on("open", function() {
            this.on("dom.touchstart", n),
            window.gui.wBody.on("dom.touchstart", o)
        }),
        this.on("close", function() {
            this.removeListener("dom.touchstart", n),
            window.gui.wBody.removeListener("dom.touchstart", o)
        })),
        e.openingSide && this.setOpeningSide(e.openingSide)
    }
    i(495);
    var o = i(26).inherits
      , s = i(48)
      , a = i(31)
      , r = i(190)
      , l = 1;
    o(n, r),
    e.exports = n,
    n.prototype.getCurrentDrawerSize = function() {
        return parseInt(this.getStyle(this._dimension), 10)
    }
    ,
    n.prototype.getCurrentContentSize = function() {
        return this.content.rootElement[this._clientProperty]
    }
    ,
    n.prototype.setAsAlwaysOpen = function(e) {
        this._isAlwaysOpen = e,
        this.lockDrawer(e)
    }
    ,
    n.prototype.lockDrawer = function(e) {
        e !== this.drawerLocked && (this.close(),
        this.drawerLocked = e,
        this.lockSlide(e))
    }
    ,
    n.prototype.setOpeningSide = function(e) {
        switch (this.side = e,
        this.replaceClassNames(["top", "bottom", "left", "right"], [e]),
        e) {
        case "top":
            this._axis = "y",
            this._dimension = "height",
            this._clientProperty = "clientHeight",
            this._direction = 1,
            this.setSlideDirection("vertical");
            break;
        case "bottom":
            this._axis = "y",
            this._dimension = "height",
            this._clientProperty = "clientHeight",
            this._direction = -1,
            this.setSlideDirection("vertical");
            break;
        case "left":
            this._axis = "x",
            this._dimension = "width",
            this._clientProperty = "clientWidth",
            this._direction = 1,
            this.setSlideDirection("horizontal");
            break;
        case "right":
            this._axis = "x",
            this._dimension = "width",
            this._clientProperty = "clientWidth",
            this._direction = -1,
            this.setSlideDirection("horizontal")
        }
    }
    ,
    n.prototype.refresh = function() {
        if (this._visibleSize = this.rootElement[this._clientProperty],
        this._contentSize = this.getCurrentContentSize(),
        this._contentSize) {
            this._isAlwaysOpen && (this._contentSize += this._extraContentSize);
            var e, t, i, n, o, s;
            switch (e = t = i = n = o = s = "",
            this.side) {
            case "top":
                t = this._visibleSize + "px";
                break;
            case "bottom":
                e = this._visibleSize + "px";
                break;
            case "left":
                n = this._visibleSize + "px";
                break;
            case "right":
                i = this._visibleSize + "px"
            }
            if (this.content.setStyles({
                top: e,
                bottom: t,
                left: i,
                right: n,
                width: o,
                height: s,
                webkitTransform: "translate" + this._axis + "(" + 100 * this._direction + "%)"
            }),
            this.setStyle(this._dimension, this._contentSize + "px"),
            this.background) {
                var a = {
                    top: e,
                    bottom: t,
                    left: i,
                    right: n,
                    width: "",
                    height: "",
                    webkitTransform: "translate" + this._axis + "(" + 100 * this._direction + "%)"
                };
                a[this._dimension] = this._contentSize + "px",
                this.background.setStyles(a)
            }
            this._currentPosition = this._contentSize * this._direction,
            this.isOpen = !1,
            this.delClassNames("open")
        }
    }
    ,
    n.prototype._open = function(e) {
        if (e || !(this._opening || this.isOpen || this.drawerLocked)) {
            this._opening = !0,
            this.addClassNames("open"),
            this._tween1 && this._tween1.cancel(),
            this._tween2 && this._tween2.cancel(),
            e || this.emit("opening");
            var t = Math.floor(Math.abs(this._visibleSize * this._direction - this._currentPosition) / l)
              , i = this;
            this._tween1 = a.tween(this.content, {
                webkitTransform: "translate" + this._axis + "(" + this._visibleSize * this._direction + "px)"
            }, {
                time: t,
                easing: "ease-out"
            }, function() {
                i._currentPosition = i._visibleSize * i._direction,
                i._tween1 = null ,
                i._opening = !1,
                i.isOpen || i.emit("open"),
                i.isOpen = !0
            }),
            this.background && (this._tween2 = a.tween(this.background, {
                webkitTransform: "translate" + this._axis + "(" + this._visibleSize * this._direction + "px)"
            }, {
                time: t,
                easing: "ease-out"
            }, function() {
                i._tween2 = null
            }))
        }
    }
    ,
    n.prototype.open = function() {
        this._open(!1)
    }
    ,
    n.prototype._close = function(e) {
        if (e || !this._closing && this.isOpen && !this.drawerLocked) {
            this._closing = !0,
            this._tween1 && this._tween1.cancel(),
            this._tween2 && this._tween2.cancel();
            var t = Math.floor(Math.abs(this._contentSize * this._direction - this._currentPosition) / l);
            e || this.emit("closing");
            var i = this;
            this._tween1 = a.tween(this.content, {
                webkitTransform: "translate" + this._axis + "(" + 100 * this._direction + "%)"
            }, {
                time: t,
                easing: "ease-out"
            }, function() {
                i._currentPosition = i._contentSize * i._direction,
                i._tween1 = null ,
                i._closing = !1,
                i.emit("close"),
                i.isOpen = !1,
                i.delClassNames("open")
            }),
            this.background && (this._tween2 = a.tween(this.background, {
                webkitTransform: "translate" + this._axis + "(" + 100 * this._direction + "%)"
            }, {
                time: t,
                easing: "ease-out"
            }, function() {
                i._tween2 = null
            }))
        }
    }
    ,
    n.prototype.close = function() {
        this._close(!1)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        u.call(this, {
            autoClose: !0
        }),
        this.addClassNames("MainControls"),
        this._createDom();
        var e = this;
        this._fightCount = 0,
        this.fightLocked = !1,
        this.fightHelpOn = !1;
        var t = window.gui;
        t.on("connected", function() {
            e._setPreferences(),
            e._setLayout("roleplay", !0),
            e._creatureModeButton.delClassNames("on")
        }),
        t.on("disconnect", function() {
            e._fightCount = 0,
            e.fightLocked = !1
        });
        var i = t.fightManager;
        i.on("fightEnterPreparation", function() {
            e._setLayout("battlePreparation")
        }),
        i.on("fightEnterBattle", function() {
            e._setLayout("battle")
        }),
        i.on("fightEnd", function() {
            e._setLayout("roleplay"),
            e._creatureModeButton.delClassNames("on")
        })
    }
    i(497);
    var o = i(206).addTooltip
      , s = i(204)
      , a = i(24).dimensions
      , r = i(35).getText
      , l = i(35).findText
      , c = i(26).inherits
      , u = i(492)
      , h = i(498)
      , d = i(30)
      , p = i(22)
      , m = i(502)
      , f = i(219);
    c(n, u),
    e.exports = n,
    n.prototype._resize = function() {
        var e;
        window.gui.ipadRatio ? (this.setStyles({
            bottom: 0,
            top: "",
            right: "",
            left: a.posMainControlBar + "px",
            width: a.mainControlBarSize + "px",
            height: a.bottomBarHeight + "px"
        }),
        e = "top") : (this.setStyles({
            bottom: "",
            top: a.posMainControlBar + "px",
            right: 0,
            left: "",
            width: a.sideBarWidth + "px",
            height: a.mainControlBarSize + "px"
        }),
        e = "left"),
        this.setOpeningSide(e)
    }
    ,
    n.prototype._createDom = function() {
        function e(e, t) {
            "function" == typeof e && (t = e),
            e = e || {};
            var n = e.className || [];
            return n.push("controlsButton"),
            i.appendChild(new s({
                disable: !!e.disable,
                tooltip: e.tooltip,
                className: n,
                scaleOnPress: !0
            },t))
        }
        var t = this
          , i = this.buttonBox = this.content.createChild("div", {
            className: "buttonBox"
        });
        this.playerPoints = i.appendChild(new h),
        this._fightListBtn = e({
            className: ["showFightsButton", "roleplayButton"],
            disable: !0
        }, function() {
            p.open("fightList")
        }),
        o(this._fightListBtn, function() {
            return r("ui.fightsOnMap", t._fightCount)
        }),
        window.gui.playerData.position.on("mapChanged", function(e) {
            var i = e.fights || [];
            t._fightCount = i.length,
            t._updateFightListButton()
        }),
        window.gui.on("MapFightCountMessage", function(e) {
            t._fightCount = e.fightCount || 0,
            t._updateFightListButton()
        }),
        this._tacticalModeBtn = e({
            className: ["tacticalModeButton", "battleButton", "battlePreparationButton"],
            tooltip: r("ui.fight.option.tacticMod")
        }, function() {
            var e = window.foreground.toggleTacticMode();
            t._tacticalModeBtn.toggleClassName("on", e),
            d.setValue("tacticModeEngaged", e)
        }),
        this._consoleButton = e({
            className: ["consoleButton", "alwaysShowButton"]
        }, function() {
            p["switch"]("adminConsole")
        }),
        this._mapInfoButton = e({
            className: ["mapInfoButton", "roleplayButton"],
            tooltip: r("ui.option.mapInfo")
        }, function() {
            var e = window.gui.mapCoordinates.toggleDisplay();
            t._mapInfoButton.toggleClassName("on", e),
            d.setValue("showMapCoordinates", e)
        }),
        this._fightLockButton = e({
            className: ["fightLockButton", "battlePreparationButton"],
            tooltip: r("ui.fight.option.blockJoiner")
        }, function() {
            t.fightLocked = !t.fightLocked,
            t._fightLockButton.toggleClassName("on", t.fightLocked),
            window.dofus.sendMessage("GameFightOptionToggleMessage", {
                option: f.FIGHT_OPTION_SET_CLOSED
            })
        }),
        this._helpButton = e({
            className: ["helpButton", "battlePreparationButton"],
            tooltip: r("ui.fight.option.help")
        }, function() {
            t.fightHelpOn = !t.fightHelpOn,
            t._helpButton.toggleClassName("on", t.fightHelpOn),
            window.dofus.sendMessage("GameFightOptionToggleMessage", {
                option: f.FIGHT_OPTION_ASK_FOR_HELP
            })
        }),
        this._leaveButton = e({
            className: ["leaveButton", "battleButton", "battlePreparationButton"],
            tooltip: r("ui.common.quit")
        }, function() {
            var e = window.gui
              , t = window.dofus.connectionManager;
            if (e.playerData.isSpectator)
                return t.sendMessage("GameContextQuitMessage");
            var i, n = 1 === e.serversData.settings.serverGameType;
            i = r(n && e.fightManager.fightType !== m.FIGHT_TYPE_CHALLENGE ? "ui.popup.hardcoreGiveup" : "ui.popup.giveup"),
            e.fightManager.fightType === m.FIGHT_TYPE_PVP_ARENA && (i += "\n" + r("ui.party.arenaLeaveWarning")),
            e.openConfirmPopup({
                title: r("ui.popup.warning"),
                message: i,
                cb: function(e) {
                    e && t.sendMessage("GameContextQuitMessage")
                }
            })
        }),
        this._creatureModeButton = e({
            className: ["creatureModeButton", "battleButton", "battlePreparationButton"],
            tooltip: r("ui.fight.option.invisible")
        }, function() {
            var e = window.isoEngine.actorManager
              , i = !e.isCreatureModeOn;
            t._creatureModeButton.toggleClassName("on", i),
            e.setCreatureMode(i)
        }),
        this._transparentModeButton = e({
            className: ["transparentModeButton", "alwaysShowButton"],
            tooltip: r("ui.option.transparentOverlayMode")
        }, function() {
            var e = window.isoEngine.actorManager
              , i = !e.isTransparentModeOn;
            t._transparentModeButton.toggleClassName("on", i),
            d.setValue("transparentMode", i),
            e.setTransparentMode(i)
        }),
        this._interactiveBlink = e({
            className: ["interactiveBlinkBtn", "roleplayButton"],
            tooltip: l("Toggle interactive halo")
        }, function() {
            var e = !window.isoEngine.interactiveBlink;
            window.isoEngine.setInteractiveBlink(e),
            e && window.isoEngine.highlightInteractivesWithDifferentType(),
            t._interactiveBlink.toggleClassName("on", e),
            d.setValue("interactiveBlink", e)
        }),
        e({
            className: ["globalMenu", "alwaysShowButton"],
            tooltip: r("ui.common.mainMenu")
        }, function() {
            p["switch"]("global")
        })
    }
    ,
    n.prototype._setLayout = function(e, t) {
        switch (e) {
        case "roleplay":
            this.replaceClassNames(["battlePreparation", "battle"], ["roleplay"]),
            this.playerPoints.actionAndMovement.hide();
            break;
        case "battlePreparation":
            this.replaceClassNames(["roleplay", "battle"], ["battlePreparation"]),
            this.fightHelpOn = !1,
            this._helpButton.delClassNames("on"),
            this.buttonBox.getChildren()[2] !== this._leaveButton && this._leaveButton.insertBefore(this._tacticalModeBtn);
            break;
        case "battle":
            this.replaceClassNames(["roleplay", "battlePreparation"], ["battle"]),
            this.buttonBox.getChildren()[3] !== this._leaveButton && this._leaveButton.insertBefore(this._consoleButton),
            window.gui.playerData.isSpectator || this.playerPoints.actionAndMovement.show()
        }
        this._consoleButton.toggleDisplay(window.gui.playerData.isModeratorOrMore()),
        t || (this._resize(),
        this.refresh())
    }
    ,
    n.prototype._setPreferences = function() {
        var e = d.getValue("showMapCoordinates", !1);
        this._mapInfoButton.toggleClassName("on", e),
        window.gui.mapCoordinates.toggleDisplay(e);
        var t = d.getValue("tacticModeEngaged", !1);
        this._tacticalModeBtn.toggleClassName("on", t),
        window.foreground.isTacticMode = t;
        var i = d.getValue("interactiveBlink", !0);
        this._interactiveBlink.toggleClassName("on", i),
        window.isoEngine.setInteractiveBlink(i);
        var n = d.getValue("transparentMode", !1);
        this._transparentModeButton.toggleClassName("on", n),
        window.isoEngine.actorManager.setTransparentMode(n)
    }
    ,
    n.prototype._updateFightListButton = function() {
        var e = this._fightCount > 0;
        this._fightListBtn.setEnable(e),
        this._fightListBtn.toggleClassName("on", e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            s._lifePoints = e,
            s.displayLifePoints()
        }
        function t(e) {
            s._maxLifePoints = e,
            s.displayLifePoints()
        }
        function i(e) {
            s.actionPointsNumber.setText(e)
        }
        function n(e) {
            s.movementPointsNumber.setText(e)
        }
        l.call(this, "div", {
            className: "playerPoints"
        });
        var s = this;
        this._lifePoints = 1,
        this._maxLifePoints = 1,
        window.gui.on("connected", function() {
            s.lifeDisplay = c.getValue("lifeDisplayMode", "simple")
        }),
        window.gui.on("disconnect", function() {
            s.lifeGauge.setStyle("height", "0%"),
            s.lifePointsNumber.clearContent()
        });
        var u = this.actionAndMovement = this.createChild("div", {
            className: "actionAndMovement"
        });
        this.actionPointsNumber = u.createChild("div", {
            className: ["number", "actionPoints"]
        }),
        this.movementPointsNumber = u.createChild("div", {
            className: ["number", "movementPoints"]
        }),
        o(this.actionPointsNumber, a("ui.common.ap")),
        o(this.movementPointsNumber, a("ui.common.mp"));
        var h = this.createChild("div", {
            className: "lifePointsWrapper"
        })
          , d = h.createChild("div", {
            className: "lifeHeart"
        });
        this.lifeGauge = d.createChild("div", {
            className: "lifeGauge"
        }),
        h.createChild("div", {
            className: "highlights"
        }),
        this.lifePointsNumberWrapper = h.createChild("div", {
            className: "numberWrapper"
        }),
        this.lifePointsNumber = this.lifePointsNumberWrapper.createChild("div", {
            className: "number"
        }),
        h.appendChild(new r),
        o(d, a("ui.common.lifePoints")),
        d.on("tap", function() {
            s.switchLifeDisplay()
        }),
        window.gui.playerData.on("lifePointsUpdated", function(t) {
            e(t)
        }),
        window.gui.playerData.on("maxLifePointsUpdated", function(e) {
            t(e)
        }),
        window.gui.playerData.on("actionPointsCurrentUpdated", function(e) {
            i(e)
        }),
        window.gui.playerData.on("movementPointsCurrentUpdated", function(e) {
            n(e)
        })
    }
    i(499);
    var o = i(206).addTooltip
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(500)
      , l = i(190)
      , c = i(30);
    s(n, l),
    n.prototype.switchLifeDisplay = function() {
        switch (this.lifeDisplay) {
        case "simple":
            this.lifeDisplay = "total";
            break;
        case "total":
            this.lifeDisplay = "percentage";
            break;
        case "percentage":
            this.lifeDisplay = "simple"
        }
        c.setValue("lifeDisplayMode", this.lifeDisplay),
        this.displayLifePoints()
    }
    ,
    n.prototype.displayLifePoints = function() {
        var e = this._lifePoints / this._maxLifePoints * 100;
        switch (this.lifeGauge.setStyle("height", e + "%"),
        this.lifeDisplay) {
        case "simple":
            this.lifePointsNumber.setHtml(this._lifePoints);
            break;
        case "total":
            this.lifePointsNumber.setHtml(this._lifePoints + "<br>" + this._maxLifePoints);
            break;
        case "percentage":
            this.lifePointsNumber.setHtml(Math.round(e) + "<br>%")
        }
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div"),
        this._currentServerLag(0);
        var e = this;
        window.gui.on("checkServerLag", function(t, i) {
            e.checkServerLag(t, i)
        })
    }
    i(501);
    var o = i(26).inherits
      , s = i(190)
      , a = 1500
      , r = 800;
    o(n, s),
    e.exports = n,
    n.prototype._currentServerLag = function(e) {
        e > a ? (this.setClassNames(["networkIndicator", "bad"]),
        console.debug("Current server lag is bad:", e)) : e > r ? this.setClassNames(["networkIndicator", "slow"]) : this.setClassNames(["networkIndicator", "good"])
    }
    ,
    n.prototype.checkServerLag = function(e, t) {
        if ("start" === t)
            this.serverLagEventName = e,
            this.serverLagStart = Date.now();
        else if ("stop" === t) {
            if (this.serverLagEventName !== e)
                return;
            this._currentServerLag(Date.now() - this.serverLagStart),
            this.serverLagEventName = null
        } else
            console.warn("Invalid action emitted to checkServerLag", e, ":", t)
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        FIGHT_TYPE_CHALLENGE: 0,
        FIGHT_TYPE_AGRESSION: 1,
        FIGHT_TYPE_PvMA: 2,
        FIGHT_TYPE_MXvM: 3,
        FIGHT_TYPE_PvM: 4,
        FIGHT_TYPE_PvT: 5,
        FIGHT_TYPE_PvMU: 6,
        FIGHT_TYPE_PVP_ARENA: 7,
        FIGHT_TYPE_Koh: 8
    }
}
, function(e, t, i) {
    function n() {
        u.call(this, "div", {
            className: "NotificationBar",
            hidden: !0
        }),
        this.notificationType = d.notificationType,
        a(this),
        this.currentOpenedId = null ,
        this.dialogs = {},
        this.container = this.createChild("div", {
            className: "container"
        }),
        this.counter = this.createChild("div", {
            className: "counter"
        });
        var e = this;
        this.on("dragStart", function() {
            e.hideDialog(e.currentOpenedId)
        }),
        window.gui.on("disconnect", function() {
            e.clearNotifications()
        })
    }
    i(504);
    var o = i(5)
      , s = i(26).inherits
      , a = i(439)
      , r = i(203)
      , l = i(31)
      , c = i(204)
      , u = i(190)
      , h = i(84).playUiSound
      , d = i(505)
      , p = d.notificationImageInfo
      , m = 12
      , f = "blue";
    s(n, u),
    e.exports = n,
    n.prototype._updateCounter = function() {
        var e = this.container.getChildren().length;
        this.counter.setText(e),
        this.toggleDisplay(e)
    }
    ,
    n.prototype._repositionDialog = function(e) {
        var t = this.dialogs[e]
          , i = this.container.getChild(e);
        r.positionNextTo(t, i)
    }
    ,
    n.prototype._destroyNotification = function(e, t) {
        if (this.dialogs[e]) {
            this.dialogs[e].destroy(),
            delete this.dialogs[e];
            var i = this.container.getChild(e)
              , n = i.getChild("icon");
            if ("function" == typeof n.cancelTween && n.cancelTween(),
            i.destroy(),
            this._updateCounter(),
            !t && this.currentOpenedId)
                if (e === this.currentOpenedId) {
                    this.currentOpenedId = null ;
                    var o = this.container.getChildren();
                    if (o.length) {
                        var s = o[o.length - 1].getWuiName();
                        this.showDialog(s, !0)
                    }
                } else
                    this._repositionDialog(this.currentOpenedId)
        }
    }
    ,
    n.prototype.clearNotifications = function() {
        for (var e in this.dialogs)
            this._destroyNotification(e, !0);
        this.currentOpenedId = null
    }
    ,
    n.prototype._notificationButtonAction = function(e) {
        return this.currentOpenedId === e ? this.hideDialog(e) : void this.showDialog(e)
    }
    ,
    n.prototype._createDialog = function(e, t) {
        function i() {
            o.removeNotification(e),
            t.onClose && t.onClose(-1)
        }
        function n() {
            var i = this.index
              , n = t.buttons[i].action(i);
            switch (n) {
            case "HIDE_DIALOG":
                o.hideDialog(e);
                break;
            default:
                o.removeNotification(e)
            }
        }
        var o = this
          , s = new u("div");
        s.createChild("div", {
            className: "dialogTitle",
            text: t.title
        }),
        s.appendChild(new c({
            className: "closeBtn"
        },i)),
        t.wuidom ? (s.createChild("div", {
            className: "dialogText"
        }),
        s.appendChild(t.wuidom)) : s.createChild("div", {
            className: "dialogText",
            text: t.text
        });
        var a = s.createChild("div", {
            className: "buttons"
        });
        if (t.buttons) {
            t.buttons.length > 1 && !t.onClose && console.warn("Notification needs an onClose function");
            for (var r = 0; r < t.buttons.length; r++) {
                var l = a.appendChild(new c({
                    className: "button",
                    text: t.buttons[r].label
                },n));
                l.index = r
            }
        }
        var h = window.gui.gameGuiContainer.createChild("div", {
            className: "NotificationDialog"
        });
        h.appendChild(s),
        this.dialogs[e] = h
    }
    ,
    n.prototype._createNotification = function(e, t) {
        var i = this
          , n = this.container.createChild("div", {
            className: "notificationButton",
            name: e
        })
          , s = n.appendChild(new c({
            className: ["icon", "spinner"],
            name: "icon"
        },function() {
            i._notificationButtonAction(this.notifId)
        }
        ));
        s.notifId = e;
        var a = ""
          , r = "";
        if (!isNaN(t.type)) {
            var u = p[t.type] || {};
            a = u.icon || a,
            r = u.color || r
        }
        a = t.iconId || a,
        r = t.iconColor || r;
        var h = ["gfx/notifications/" + (a || m) + ".png", "gfx/notifications/" + (r || f) + ".png"];
        o.preloadImages(h, function(o) {
            if (s && s.rootElement && (s.setStyle("backgroundImage", o[0] + ", " + o[1]),
            s.delClassNames("spinner"),
            t.timer)) {
                var a = parseInt(t.timer, 10)
                  , r = n.createChild("div", {
                    className: "timer"
                })
                  , c = l.tween(r, {
                    height: "100%"
                }, {
                    time: a,
                    easing: "linear"
                }, function() {
                    i.removeNotification(e)
                });
                s.cancelTween = c.cancel
            }
        })
    }
    ,
    n.prototype.showDialog = function(e, t) {
        this.hideDialog(this.currentOpenedId),
        this.currentOpenedId = e;
        var i = this.container.getChild(e);
        i.addClassNames("opened"),
        t && i.rootElement.scrollIntoView(!1),
        this._repositionDialog(e),
        h("NEW_TIPS")
    }
    ,
    n.prototype.hideDialog = function(e) {
        if (e && e === this.currentOpenedId) {
            var t = this.container.getChild(e);
            t.delClassNames("opened"),
            this.currentOpenedId = null ,
            this.dialogs[e].hide()
        }
    }
    ,
    n.prototype.removeNotification = function(e) {
        var t = this.dialogs[e];
        if (t) {
            var i = this;
            window.setTimeout(function() {
                i._destroyNotification(e)
            }, 0)
        }
    }
    ,
    n.prototype.newNotification = function(e, t) {
        this._createNotification(e, t),
        this._updateCounter(),
        this._createDialog(e, t),
        this.showDialog(e, !0)
    }
    ,
    n.prototype.isNotificationOpen = function(e) {
        return !!this.dialogs[e]
    }
}
, function(e, t) {}
, function(e, t) {
    var i = {
        TUTORIAL: 0,
        ERROR: 1,
        INVITATION: 2,
        PRIORITY_INVITATION: 3,
        INFORMATION: 4
    };
    t.notificationType = i,
    t.notificationPriority = [i.ERROR, i.PRIORITY_INVITATION, i.INVITATION, i.INFORMATION, i.TUTORIAL];
    var n = {};
    n[i.TUTORIAL] = {
        icon: 11,
        color: "green"
    },
    n[i.ERROR] = {
        icon: 11,
        color: "red"
    },
    n[i.INVITATION] = {
        icon: 12,
        color: "blue"
    },
    n[i.PRIORITY_INVITATION] = {
        icon: 10,
        color: "blue"
    },
    n[i.INFORMATION] = {
        icon: 27,
        color: "yellow"
    },
    t.notificationImageInfo = n
}
, function(e, t, i) {
    function n() {
        this.inDialog = !1,
        this.npcData = null ,
        this.npcActorId = null ,
        this.uiReplyHandler = this._uiReplyHandler.bind(this),
        this._setListeners()
    }
    function o(e, t) {
        for (var i = 0; i < t.length; i++)
            e = e.replace("#" + (i + 1), t[i]);
        return e
    }
    var s = i(36);
    e.exports = n,
    n.prototype._setListeners = function() {
        var e = window.dofus.connectionManager
          , t = this;
        e.on("NpcGenericActionFailureMessage", function() {
            window.foreground.unlock("npcActionRequest")
        }),
        e.on("NpcDialogCreationMessage", function(e) {
            t.npcActorId = e.npcId,
            window.foreground.lock("npcActionRequest")
        }),
        e.on("GameContextCreateMessage", function() {
            window.foreground.unlock("npcActionRequest")
        }),
        window.isoEngine.on("mapLoaded", function() {
            window.foreground.unlock("npcActionRequest")
        }),
        e.on("NpcDialogQuestionMessage", function(e) {
            if (!t.npcData) {
                var i = window.actorManager.getActor(t.npcActorId).data.npcData;
                t.prepareDialog(i)
            }
            t.nextQuestionAsync(e.messageId, e.visibleReplies, e.dialogParams)
        }),
        e.on("LeaveDialogMessage", function() {
            window.foreground.unlock("npcActionRequest"),
            t.inDialog && (window.gui.npcDialogUi.leaveDialog(),
            t.inDialog = !1)
        }),
        e.on("ExchangeLeaveMessage", function() {
            window.foreground.unlock("npcActionRequest")
        })
    }
    ,
    n.prototype.prepareDialog = function(e) {
        this.npcData = e;
        var t, i, n = this.msgTextIds = {};
        for (i = 0; i < e.dialogMessages.length; i++)
            t = e.dialogMessages[i],
            n[t[0]] = t[1];
        for (n = this.replyTextIds = {},
        i = 0; i < e.dialogReplies.length; i++)
            t = e.dialogReplies[i],
            n[t[0]] = t[1]
    }
    ,
    n.prototype.nextQuestionAsync = function(e, t, i) {
        this.inDialog = !0,
        this.replyIds = t,
        window.gui.npcDialogUi.prepareForNextQuestion(this.npcData, t.length);
        for (var n = this.msgTextIds[e], a = [n], r = 0; r < t.length; r++)
            a.push(this.replyTextIds[t[r]]);
        var l = this;
        s.getText(a, function(e, s) {
            if (e)
                return console.error("Failed to get texts for NPC. textIds:", a, "error:", e),
                l._closeDialog();
            var c = o(s[n], i)
              , u = [];
            for (r = 0; r < t.length; r++)
                u.push(s[l.replyTextIds[t[r]]]);
            l._showUi(c, u)
        })
    }
    ,
    n.prototype._uiReplyHandler = function(e) {
        null !== e ? window.dofus.sendMessage("NpcDialogReplyMessage", {
            replyId: this.replyIds[e]
        }) : this._closeDialog()
    }
    ,
    n.prototype._closeDialog = function() {
        window.dofus.sendMessage("LeaveDialogRequestMessage", null ),
        this.npcData = null
    }
    ,
    n.prototype._showUi = function(e, t) {
        var i = {
            npcData: this.npcData
        };
        window.gui.npcDialogUi.showNpcQuestion(e, t, this.uiReplyHandler, i)
    }
}
, function(e, t, i) {
    function n() {
        f.call(this, "div", {
            className: "npcDialogUi",
            hidden: !0
        }),
        this.inDialog = !1,
        this.replyHandler = null ,
        this.npcName = null ,
        this.currentMsg = null ,
        this.msgBubble = null ,
        this.singleMsgBubbles = {},
        this.isZoomed = !1,
        this.isChangingZoom = !1,
        this.uiBox = null ,
        window.gui.on("disconnect", this._closeDialog.bind(this)),
        this.highlightRepliesFunc = this._highlightReplies.bind(this)
    }
    function o() {
        this.myUi._sendReply(null )
    }
    function s() {
        this.myUi._sendReply(this.replyId)
    }
    function a() {
        var e = this.myUi.replyTabs;
        e.swipeNegative()
    }
    function r() {
        var e = this.myUi.replyTabs;
        e.swipePositive()
    }
    function l() {
        var e = this.myUi;
        e.leftBtn.setEnable(!!this.leftTab),
        e.rightBtn.setEnable(!!this.rightTab)
    }
    function c(e, t, i, n, o) {
        e.replyId = t,
        e.setText(i),
        e.enable(),
        e.setStyles({
            width: n,
            lineHeight: b + "px",
            minHeight: o + "px"
        }),
        e.show()
    }
    i(508);
    var u = i(204)
      , h = i(24).dimensions
      , d = i(210)
      , p = i(26).inherits
      , m = i(509)
      , f = i(190)
      , g = 150
      , _ = 10
      , v = 4
      , y = 10
      , w = 4
      , b = 22
      , C = 50
      , I = 70
      , T = {
        1: "100%",
        2: "50%",
        3: "33.3%",
        4: "25%"
    }
      , S = "25%"
      , A = {
        1: "40%",
        2: "60%"
    }
      , E = "100%";
    p(n, f),
    e.exports = n,
    n.prototype._closeDialog = function() {
        this.inDialog && (this.inDialog = !1,
        window.foreground.removeListener("dom.touchend", this.highlightRepliesFunc),
        this.replyHandler && this.replyHandler(null ),
        this.msgBubble && (this.msgBubble.close(),
        this.msgBubble = null ),
        this.hide(),
        this._restoreZoom(),
        window.gui.boxArranger.removeBox(this.uiBox),
        this.uiBox = null ,
        this.emit("closed"))
    }
    ,
    n.prototype._newButton = function(e, t, i) {
        var n = e.appendChild(new u({
            className: t,
            addIcon: !0
        },i));
        return n.myUi = this,
        n
    }
    ,
    n.prototype._createContent = function() {
        this.setStyles({
            left: h.mapLeft + y + "px",
            width: h.mapWidth - 2 * y + "px",
            bottom: h.screenHeight - h.screenExceptToolbar.height + v + "px"
        });
        var e = this.frame = this.createChild("div", {
            className: "frame"
        });
        this.leftBtn = this._newButton(e, "leftBtn", a);
        var t = this.replyTabs = e.appendChild(new m({
            noHeader: !0,
            noCycling: !0
        }));
        t.myUi = this,
        t.on("openTab", l),
        this.replyElts = [],
        this.replyBoxes = [],
        this.numReplyTabs = 0,
        this.numUsedReplyTabs = 0,
        this.rightBtn = this._newButton(e, "rightBtn", r),
        this.closeBtn = this._newButton(e, "closeBtn", o)
    }
    ,
    n.prototype._prepareReplyButtons = function() {
        for (var e = this.replies, t = e.length, i = Math.ceil(t / w), n = this.numReplyTabs; n < i; n++) {
            var o = this.replyBoxes[n] = new f("div",{
                className: "replyBox"
            });
            this.replyTabs.addTab("", o, n),
            this.numReplyTabs++;
            for (var a = 0; a < w; a++) {
                var r = o.appendChild(new u({
                    className: "reply"
                },s));
                r.myUi = this,
                this.replyElts.push(r)
            }
        }
        for (n = t; n < this.replyElts.length; n++)
            this.replyElts[n].hide();
        for (this.leftBtn.toggleDisplay(i > 1),
        this.rightBtn.toggleDisplay(i > 1),
        this.replyBoxes[0].setStyle("textAlign", i > 1 ? "left" : "center"),
        n = this.numUsedReplyTabs; n < this.numReplyTabs; n++)
            this.replyTabs.toggleTabAvailability(n, n < i);
        this.numUsedReplyTabs = i;
        var l = T[t] || S;
        for (n = 0; n < t; n++)
            c(this.replyElts[n], n, e[n], l, C)
    }
    ,
    n.prototype._setAllReplyBoxesVisibility = function(e) {
        for (var t = 0; t < this.numUsedReplyTabs; t++)
            this.replyBoxes[t].toggleDisplay(e)
    }
    ,
    n.prototype._resizeAndAppear = function(e) {
        this.replyTabs.setStyle("opacity", 0),
        this._setAllReplyBoxesVisibility(!1),
        this._prepareReplyButtons(),
        this._setAllReplyBoxesVisibility(!0),
        e && (this.setStyle("opacity", 0),
        this.show());
        var t = A[this.replies.length] || E;
        this.frame.setStyles({
            width: t
        });
        for (var i, n = I, o = this.replies, s = 0; s < o.length; s++)
            i = this.replyElts[s].rootElement.offsetHeight,
            n = Math.max(n, i);
        for (this.replyTabs.setStyle("min-height", n + "px"),
        s = 0; s < o.length; s++) {
            var a = this.replyElts[s];
            if (i = a.rootElement.offsetHeight,
            i !== n) {
                var r = 1 + (i - C) / b
                  , l = Math.round(b + (n - i) / r);
                a.setStyles({
                    "line-height": l + "px",
                    minHeight: n + "px"
                })
            }
        }
        if (this.replyTabs.reopen(),
        this.leftBtn.setEnable(!!this.replyTabs.leftTab),
        this.rightBtn.setEnable(!!this.replyTabs.rightTab),
        this.closeBtn.toggleDisplay(!window.gui.tutorialManager.inTutorial),
        this.replyTabs.setStyle("opacity", 1),
        e) {
            var c = this.rootElement;
            this.uiBox = window.gui.boxArranger.addObstacle(0, c.offsetTop - _, h.screenWidth, c.offsetHeight),
            this._waitZoomChange(this._appear)
        }
    }
    ,
    n.prototype._appear = function() {
        d.showProgressively(this, g)
    }
    ,
    n.prototype._waitZoomChange = function(e) {
        if (!this.isChangingZoom)
            return e && e.call(this);
        var t = this
          , i = window.isoEngine.mapScene.camera;
        i.once("reached", function() {
            return t.isChangingZoom && (t.isChangingZoom = !1,
            t.isZoomed && i.freeze()),
            e && e.call(t)
        })
    }
    ,
    n.prototype._zoomOnActor = function(e) {
        if (this.isZoomed)
            return this._waitZoomChange(e);
        this.isZoomed = !0,
        this.isChangingZoom = !0;
        var t = this.actor.bbox
          , i = window.isoEngine.mapScene.camera;
        this.previousZoom = i.zoom,
        this.previousCameraX = i.x,
        this.previousCameraY = i.y,
        i.zoom !== i.maxZoom && i.zoomTo(i.maxZoom),
        i.moveTo(t[1], t[2], !0),
        this._waitZoomChange(e)
    }
    ,
    n.prototype._restoreZoom = function(e) {
        if (!this.isZoomed)
            return this._waitZoomChange(e);
        this.isZoomed = !1,
        this.isChangingZoom = !0;
        var t = window.isoEngine.mapScene.camera;
        t.unfreeze(),
        t.zoom !== this.previousZoom && t.zoomTo(this.previousZoom),
        t.moveTo(this.previousCameraX, this.previousCameraY, !0),
        this._waitZoomChange(e)
    }
    ,
    n.prototype._sendReply = function(e) {
        var t = this.replyHandler;
        t && (this.replyHandler = null ,
        null !== e && this.replyElts[e].disable(),
        this.msgBubble && (this.msgBubble.close(),
        this.msgBubble = null ),
        t(e))
    }
    ,
    n.prototype._bubbleTapHandler = function() {
        return 1 === this.replies.length ? this._sendReply(0) : void this._highlightReplies()
    }
    ,
    n.prototype._showLockedBubble = function() {
        this.replyHandler && (this.bubbleTapHandler || (this.bubbleTapHandler = this._bubbleTapHandler.bind(this)),
        this.msgBubble = window.gui.newSpeechBubble({
            msg: this.currentMsg,
            title: this.npcName,
            actor: this.actor,
            isLocked: !0,
            action: this.bubbleTapHandler
        }))
    }
    ,
    n.prototype._showSingleMsgBubble = function() {
        var e = this
          , t = this.npcName;
        this.singleMsgBubbles[t] = window.gui.newSpeechBubble({
            msg: this.currentMsg,
            title: t,
            actor: this.actor,
            onClose: function() {
                delete e.singleMsgBubbles[t]
            }
        }),
        this.replyHandler(null )
    }
    ,
    n.prototype._closeSingleMsgBubbles = function() {
        for (var e in this.singleMsgBubbles)
            this.singleMsgBubbles[e].close()
    }
    ,
    n.prototype._highlightReplies = function() {
        var e = this.frame.createChild("div", {
            className: "highlight"
        });
        window.setTimeout(function() {
            e.destroy()
        }, 250)
    }
    ,
    n.prototype._showQuestion = function() {
        this.frame || this._createContent();
        var e = !this.inDialog;
        this.inDialog = !0,
        this._closeSingleMsgBubbles(),
        e ? this._zoomOnActor(this._showLockedBubble) : this._showLockedBubble(),
        this._resizeAndAppear(e),
        e && window.foreground.on("dom.touchend", this.highlightRepliesFunc),
        this.emit("opened")
    }
    ,
    n.prototype.prepareForNextQuestion = function(e, t) {
        t ? this.inDialog || (this.actor = window.actorManager.getActorFromNpcId(e.id),
        this._zoomOnActor()) : this._restoreZoom()
    }
    ,
    n.prototype.showNpcQuestion = function(e, t, i, n) {
        if (n = n || {},
        this.replies = t,
        this.replyHandler = i,
        this.actor = n.actor || window.actorManager.getActorFromNpcId(n.npcData.id),
        this.npcName = n.npcData && n.npcData.nameId,
        this.currentMsg = e,
        0 === t.length) {
            if (this.singleMsgBubbles[this.npcName])
                return i(null );
            this._restoreZoom(this._showSingleMsgBubble)
        } else
            this._showQuestion()
    }
    ,
    n.prototype.leaveDialog = function() {
        this._closeDialog()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        l.call(this, "div", {
            className: "SwipingTabs"
        }),
        e = e || {},
        e.className && this.addClassNames(e.className),
        this.tabClassName = e.tabClassName || "swipeTabBtn",
        this.tabList = [],
        this.tabMap = {},
        this.index = null ,
        this.currentTab = null ,
        this.leftTab = null ,
        this.rightTab = null ,
        this.isCyclingAllowed = !e.noCycling,
        e.noHeader || (this.header = this.createChild("div", {
            className: "swipeHeader"
        })),
        this.content = this.createChild("div", {
            className: "swipeContent"
        }),
        this.tabContainer = this.content.createChild("div", {
            className: "tabContainer"
        }),
        a(this.content),
        this.setSwipeDirection(e.direction || "horizontal");
        var t, i, n, o = this, s = !1;
        this.tabContainer.on("tweenCancelled", function() {
            s = !0
        }),
        this.content.on("slideStart", function(e, t) {
            s && (s = !0,
            o._positionTabs()),
            i = e[o._axis],
            n = "x" === o._axis ? t.width : t.height,
            o.tabContainer.setStyle("webkitTransition", ""),
            o.currentTab.content.emit("slideStart"),
            o.emit("slideStart")
        }),
        this.content.on("slideCancel", function() {
            o.currentTab.content.emit("slideEnd"),
            o.emit("slideEnd"),
            o.tabContainer.setStyles({
                webkitTransform: "translate" + o._axis + "(0)",
                webkitTransition: "-webkit-transform 200ms ease-out"
            })
        }),
        this.content.on("slide", function(e) {
            this.slideOut || (t = i - e[o._axis],
            (t > 0 && !o._canRightSlide || t < 0 && !o._canLeftSlide) && (t = 0,
            i = e[o._axis]),
            o.tabContainer.setStyle("webkitTransform", "translate" + o._axis + "(" + -t + "px)"))
        }),
        this.content.on("slideEnd", function(e, i, s) {
            o.currentTab.content.emit("slideEnd"),
            o.emit("slideEnd");
            var a = Math.abs(t);
            if (a > n / 3 || s) {
                var r = o.index;
                t > 0 && o._canRightSlide && (r = o.rightTab.index),
                t < 0 && o._canLeftSlide && (r = o.leftTab.index),
                o._openTabWithTransition(r)
            } else
                o.tabContainer.setStyles({
                    webkitTransform: "translate" + o._axis + "(0)",
                    webkitTransition: "-webkit-transform 200ms ease-out"
                })
        })
    }
    i(510);
    var o = i(204)
      , s = i(26).inherits
      , a = i(48)
      , r = i(31)
      , l = i(190);
    s(n, l),
    n.prototype.setSwipeDirection = function(e) {
        this._direction = e,
        this.content.setSlideDirection(e),
        this._axis = "vertical" === e ? "y" : "x",
        null !== this.index && this._positionTabs()
    }
    ,
    n.prototype.addTab = function(e, t, i) {
        var n = this
          , s = this.tabList.length;
        t.addClassNames("swipeTabContent");
        var a = this.tabMap[i] = {
            id: i,
            index: this.tabList.length,
            content: t,
            position: 0,
            enable: !0
        };
        return this.header && (a.tabBtn = this.header.appendChild(new o({
            className: this.tabClassName,
            text: e
        },function() {
            n.openTab(s)
        }
        )),
        a.tabBtn.addClassNames("tab" + s)),
        this.tabList.push(a),
        this.tabContainer.appendChild(t),
        t.hide(),
        s
    }
    ,
    n.prototype.getTabContent = function(e) {
        var t = isNaN(e) ? this.tabMap[e] : this.tabList[e];
        return t && t.content
    }
    ,
    n.prototype.swipeNegative = function() {
        this.leftTab && this._openTabWithTransition(this.leftTab.index)
    }
    ,
    n.prototype.swipePositive = function() {
        this.rightTab && this._openTabWithTransition(this.rightTab.index)
    }
    ,
    n.prototype._openTabWithTransition = function(e, t) {
        var i = this.tabList[e]
          , n = this.tabList[this.index];
        this.header && n.tabBtn.delClassNames("on"),
        n.content.emit("close"),
        i.content.emit("open", t);
        var o = this;
        r.tween(this.tabContainer, {
            webkitTransform: "translate" + this._axis + "(" + -i.position + "%)"
        }, {
            time: 200,
            easing: "ease-out"
        }, function() {
            o._positionTabs(),
            i.content.emit("opened", t),
            o.emit("openTab", i.id)
        }),
        this.index = i.index,
        this.header && i.tabBtn.addClassNames("on")
    }
    ,
    n.prototype.reopen = function() {
        var e = this.tabList[0];
        this.index = e.index,
        this.leftTab = null ,
        this.rightTab = null ;
        for (var t = this._getNextAvailableRightTab(), i = this._getNextAvailableLeftTab(), n = 0; n < this.tabList.length; n++) {
            var o = this.tabList[n]
              , s = o === e || o === i || o === t;
            o.content.toggleDisplay(s)
        }
        this._positionTabs()
    }
    ,
    n.prototype.openTab = function(e, t, i) {
        i = i || {};
        var n = isNaN(e) ? this.tabMap[e] : this.tabList[e];
        if (n && (i.forceOpen || this.index !== n.index)) {
            if (null !== this.index) {
                if (n === this.leftTab || n === this.rightTab)
                    return this._openTabWithTransition(n.index, t);
                var o = this.tabList[this.index];
                this.header && o.tabBtn.delClassNames("on"),
                o.content.emit("close"),
                o.content.hide()
            }
            n.content.emit("open", t),
            this.index = n.index,
            this.header && n.tabBtn.addClassNames("on"),
            n.content.show(),
            this._positionTabs(),
            n.content.emit("opened", t),
            this.emit("openTab", n.id)
        }
    }
    ,
    n.prototype.close = function() {
        this.tabList[this.index].content.emit("close")
    }
    ,
    n.prototype._getNextAvailableRightTab = function() {
        var e, t, i;
        for (e = this.index + 1,
        t = this.tabList.length; e < t; e += 1)
            if (i = this.tabList[e],
            i.enable)
                return i;
        if (!this.isCyclingAllowed)
            return null ;
        for (e = 0,
        t = this.index; e < t; e += 1)
            if (i = this.tabList[e],
            i.enable)
                return i;
        return null
    }
    ,
    n.prototype._getNextAvailableLeftTab = function() {
        var e, t;
        for (e = this.index - 1; e >= 0; e -= 1)
            if (t = this.tabList[e],
            t.enable)
                return t;
        if (!this.isCyclingAllowed)
            return null ;
        for (e = this.tabList.length - 1; e > this.index; e -= 1)
            if (t = this.tabList[e],
            t.enable)
                return t;
        return null
    }
    ,
    n.prototype._positionTabs = function() {
        var e = this.currentTab = this.tabList[this.index];
        e.content.setStyle("webkitTransform", "translate" + this._axis + "(0)"),
        e.position = 0,
        this.tabContainer.setStyles({
            webkitTransform: "translate" + this._axis + "(0)",
            webkitTransition: ""
        }),
        this.leftTab && this.leftTab !== e && this.leftTab.content.hide(),
        this.rightTab && this.rightTab !== e && this.rightTab.content.hide(),
        this.leftTab = this.rightTab = null ;
        var t = this._getNextAvailableRightTab()
          , i = this._getNextAvailableLeftTab();
        t && t === i ? this.index < i.index ? (this._canRightSlide = !0,
        this._canLeftSlide = !1,
        this.rightTab = t,
        t.position = 100,
        t.content.show(),
        t.content.setStyle("webkitTransform", "translate" + this._axis + "(100%)")) : (this._canRightSlide = !1,
        this._canLeftSlide = !0,
        this.leftTab = i,
        i.position = -100,
        i.content.show(),
        i.content.setStyle("webkitTransform", "translate" + this._axis + "(-100%)")) : (t ? (this._canRightSlide = !0,
        this.rightTab = t,
        t.position = 100,
        t.content.show(),
        t.content.setStyle("webkitTransform", "translate" + this._axis + "(100%)")) : this._canRightSlide = !1,
        i ? (this._canLeftSlide = !0,
        this.leftTab = i,
        i.position = -100,
        i.content.show(),
        i.content.setStyle("webkitTransform", "translate" + this._axis + "(-100%)")) : this._canLeftSlide = !1)
    }
    ,
    n.prototype.toggleTabAvailability = function(e, t) {
        var i = isNaN(e) ? this.tabMap[e] : this.tabList[e];
        i && (arguments.length < 2 && (console.error(new Error("toggleTabAvailability missing param")),
        t = !i.enable),
        t = !!t,
        t !== i.enable && (i.enable = t,
        this.header && (t ? i.tabBtn.enable() : i.tabBtn.disable()),
        null !== this.index && this._positionTabs()))
    }
    ,
    n.prototype.toggleTabNotification = function(e, t) {
        var i = isNaN(e) ? this.tabMap[e] : this.tabList[e];
        i && this.header && i.tabBtn.toggleClassName("notification", t)
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        _.call(this, "div", {
            className: "numberInputPad",
            hidden: !0
        }),
        this.digits = [],
        this.overlay = window.gui.gameGuiContainer.createChild("div", {
            className: "numberPadOverlay",
            hidden: !0
        })
    }
    function o() {
        this.numberInput._tapOnKey(this.id)
    }
    function s() {
        this.numberInput._tapOnDisplay(this.id)
    }
    i(512);
    var a, r = i(204), l = i(204).DofusButton, c = i(24).dimensions, u = i(35).getText, h = i(439), d = i(210), p = i(26).inherits, m = i(212), f = i(32), g = i(206), _ = i(190), v = m.MAX_NUMBER, y = v.toString().length, w = {
        DISPLAY: 0,
        INSERT: 1,
        EDIT: 2
    }, b = ["7", "8", "9", "4", "5", "6", "1", "2", "3", "BS", "0", "000", "CLR", "ENTER"], C = {
        BS: "@",
        ENTER: "@ENTER",
        CLR: "CLR"
    }, I = 10;
    p(n, _),
    e.exports = n,
    n.prototype.open = function(e, t, i, n) {
        this.keyboard || this._createContent(),
        this.inputBox = e,
        t && this.title.setText(t),
        this.minValue = void 0 !== i ? i : 0,
        this.maxValue = void 0 !== n ? n : v,
        this.setValue(e.getValue()),
        this._switchMode(w.DISPLAY),
        this._show()
    }
    ,
    n.prototype._show = function() {
        if (this.overlay.show(),
        this.setStyle("opacity", 0),
        this.show(),
        !a) {
            var e = this.digitBoxes[0].rootElement;
            a = e.offsetTop + e.offsetHeight / 2
        }
        var t = this.inputBox.rootElement.getBoundingClientRect()
          , i = this.rootElement.getBoundingClientRect()
          , n = t.right - i.width
          , o = t.top + t.height / 2 - a;
        n = Math.min(Math.max(n, I), c.screenWidth - I - i.width),
        o = Math.min(Math.max(o, I), c.screenHeight - I - i.height),
        this.setStyles({
            left: n + "px",
            top: o + "px"
        }),
        this.setStyle("opacity", 1),
        this.rootElement.focus()
    }
    ,
    n.prototype._createContent = function() {
        var e = this;
        window.gui.on("disconnect", function() {
            e.hide()
        }),
        this.on("hide", function() {
            e.overlay.hide()
        });
        var t = this.createChild("div", {
            className: "titleBar"
        });
        h(this, {
            grip: t,
            isFullScreen: !0
        }),
        this.title = t.createChild("div", {
            className: "title"
        });
        var i = t.appendChild(new r({
            className: "closeButton",
            scaleOnPress: !0
        }));
        i.on("tap", function() {
            e.hide()
        }),
        this.digitBoxes = [],
        this.digitElements = [],
        this.separators = [];
        for (var n = this.createChild("div", {
            className: "displayContainer"
        }), a = u("ui.common.numberSeparator") || ".", c = 0; c < y; c++) {
            var d = y - 1 - c
              , p = d % 3 === 2;
            p && (this.separators[d + 1] = n.createChild("div", {
                className: "separator",
                text: a
            }));
            var m = this.digitBoxes[d] = n.createChild("div", {
                className: "digitBox"
            });
            p && m.addClassNames("groupStart"),
            m.id = d,
            m.numberInput = this,
            f(m),
            m.on("tap", s),
            this.digitElements[d] = m.createChild("div", {
                className: "digit"
            })
        }
        this.keyMap = {};
        var g = this.createChild("div", {
            className: "keyboardContainer"
        })
          , _ = this.keyboard = g.createChild("div", {
            className: "keyboard"
        });
        for (c = 0; c < b.length; c++) {
            var v = b[c]
              , w = C[v] || v
              , I = this.keyMap[v] = new l(w,{
                className: ["keyboardKey", "key" + v]
            });
            "@" === w[0] && (w.length > 1 && I.createChild("div", {
                text: w.substr(1)
            }),
            I.createChild("div", {
                className: "keyIcon"
            })),
            _.appendChild(I),
            I.id = v,
            I.numberInput = this,
            I.on("tap", o)
        }
    }
    ;
    var T = /[^0-9]/g;
    n.prototype.setValue = function(e) {
        "string" == typeof e ? (e = e.replace(T, "").toString(),
        e || (e = "0")) : e = e.toFixed(),
        e.length >= y && (e = e.substr(0, y));
        for (var t = y - 1; t >= e.length; t--)
            this._setDigit(t, "");
        for (var i = 0; i < e.length; i++)
            this._setDigit(t, e[i]),
            t--;
        "0" === e && this._switchMode(w.DISPLAY)
    }
    ,
    n.prototype._getValue = function() {
        for (var e = "", t = y - 1; t >= 0; t--)
            e += this.digits[t];
        return parseInt(e, 10)
    }
    ,
    n.prototype._enableKey = function(e, t) {
        t ? this.keyMap[e].enable() : this.keyMap[e].disable()
    }
    ,
    n.prototype._switchMode = function(e) {
        e !== this.mode && (this.mode === w.EDIT && e !== w.EDIT && this._setCursor(-1),
        this.mode = e,
        this._enableKey("BS", this.mode === w.INSERT),
        this._enableKey("0", this.mode !== w.DISPLAY),
        this._enableKey("000", this.mode !== w.DISPLAY))
    }
    ,
    n.prototype._setCursor = function(e) {
        this.cursor >= 0 && this.digitBoxes[this.cursor].delClassNames("highlight"),
        this.cursor = e,
        this.cursor >= 0 && this.digitBoxes[e].addClassNames("highlight")
    }
    ,
    n.prototype._tapOnDisplay = function(e) {
        this.mode !== w.EDIT && this._switchMode(w.EDIT),
        this._setCursor(e)
    }
    ,
    n.prototype._tapOnKey = function(e) {
        switch (e) {
        case "ENTER":
            return this._doEnter();
        case "CLR":
            return this._doClear();
        case "000":
            return this._do000();
        case "BS":
            return this._doBackspace();
        default:
            return this._doDigit(e)
        }
    }
    ,
    n.prototype._doEnter = function() {
        this._switchMode(w.DISPLAY);
        var e = this._getValue();
        return e > this.maxValue ? g.showNotification(u("tablet.common.maxValue", d.intToString(this.maxValue)), this.keyMap.ENTER) : e < this.minValue ? g.showNotification(u("tablet.common.minValue", d.intToString(this.minValue)), this.keyMap.ENTER) : (this.inputBox.setValue(e, !0),
        void this.hide())
    }
    ,
    n.prototype._doClear = function() {
        this.setValue("0")
    }
    ,
    n.prototype._doBackspace = function() {
        if (this.mode === w.INSERT) {
            var e = Math.floor(this._getValue() / 10);
            this.setValue(e)
        }
    }
    ,
    n.prototype._do000 = function() {
        for (var e = 0; e < 3; e++)
            this._doDigit("0")
    }
    ,
    n.prototype._doDigit = function(e) {
        switch (this.mode) {
        case w.DISPLAY:
            if ("0" === e && 0 === this._getValue())
                return;
            return this.setValue(e),
            this._switchMode(w.INSERT);
        case w.INSERT:
            if ("" !== this.digits[y - 1])
                return;
            return this.setValue(10 * this._getValue() + ~~e);
        case w.EDIT:
            return this._setDigit(this.cursor, e),
            this._fixZeroes(this.cursor, e),
            0 === this.cursor ? this._switchMode(w.INSERT) : this._setCursor(this.cursor - 1)
        }
    }
    ,
    n.prototype._setDigit = function(e, t) {
        this.digitElements[e].setText(t),
        this.digits[e] = t,
        this.separators[e] && this.separators[e].toggleDisplay("" !== t)
    }
    ,
    n.prototype._fixZeroes = function(e, t) {
        if (0 !== e) {
            for (var i = y - 1; i >= e; i--) {
                var n = this.digits[i];
                if ("0" !== n && "" !== n)
                    break;
                "0" === n && this._setDigit(i, "")
            }
            if ("0" !== t)
                for (i = e - 1; i >= 0 && "" === this.digits[i]; i--)
                    this._setDigit(i, "0")
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this, "div", {
            className: "Party",
            hidden: !0
        }),
        h(this, {
            isCollapsable: !0
        }),
        this.numParties = 0,
        this.hasParty = {},
        this.currentPartyType = null ,
        this.currentParty = null ,
        this.invitedFrom = {},
        this.partyTypesById = {},
        this.setupEvents()
    }
    function o(e) {
        return e === f.PARTY_TYPE_ARENA ? f.PARTY_TYPE_CLASSICAL : f.PARTY_TYPE_ARENA
    }
    i(514);
    var s = i(206).addTooltip
      , a = i(24).dimensions
      , r = i(451)
      , l = i(26).inherits
      , c = i(190)
      , u = i(204)
      , h = i(439)
      , d = i(35)
      , p = d.getText
      , m = d.processTextWithModifier
      , f = i(412)
      , g = i(238)
      , _ = i(279)
      , v = i(235)
      , y = i(22);
    l(n, c),
    e.exports = n,
    n.prototype._reset = function() {
        this.hide(),
        this.cleanData(f.PARTY_TYPE_CLASSICAL, !0),
        this.cleanData(f.PARTY_TYPE_ARENA, !0)
    }
    ,
    n.prototype._selectPartyType = function(e) {
        var t = e === f.PARTY_TYPE_ARENA;
        this.toggleClassName("arena", t),
        this.currentPartyType = e,
        this.currentParty = t ? this.arenaParty : this.classicParty,
        this.classicParty.toggleDisplay(!t),
        this.arenaParty.toggleDisplay(t)
    }
    ,
    n.prototype._createContent = function() {
        var e = this;
        this.createChild("div", {
            className: "gripIcon"
        });
        var t = this.switchPartyButton = this.appendChild(new u({
            className: "switchPartyButton",
            hidden: !0
        }));
        t.createChild("div", {
            className: "iconGroup"
        }),
        t.createChild("div", {
            className: "separator"
        }),
        t.createChild("div", {
            className: "iconArena"
        }),
        t.on("tap", function() {
            e._selectPartyType(o(e.currentPartyType))
        });
        var i = this.appendChild(new u({
            className: ["optionsButton", "greenButton"]
        }));
        i.createChild("div", {
            className: "icon"
        }),
        i.on("tap", function() {
            var t = e.currentParty;
            window.gui.openContextualMenuAround("partyOptions", i, {
                partyType: e.currentPartyType,
                partyId: e.currentParty.partyId,
                isLoyal: t.isLoyal,
                isRestricted: t.isRestricted,
                isLeader: t.partyLeaderId === window.gui.playerData.id
            })
        }),
        this.partyBoxes = this.createChild("div", {
            className: "partyBoxes"
        }),
        this.classicParty = this.partyBoxes.createChild("div", {
            className: ["partyBox", "classic"],
            name: f.PARTY_TYPE_CLASSICAL
        }),
        this.arenaParty = this.partyBoxes.createChild("div", {
            className: ["partyBox", "arena"],
            name: f.PARTY_TYPE_ARENA,
            hidden: !0
        }),
        this.setStyles({
            left: a.mapRight - 90 + "px",
            top: "100px"
        })
    }
    ,
    n.prototype.addMember = function(e, t) {
        var i = this.partyBoxes.getChild(e)
          , n = t.id || t.guestId
          , o = i.createChild("div", {
            className: "member",
            name: n
        })
          , s = new g({
            scale: "fitin"
        })
          , a = t.entityLook || t.guestLook;
        s.setLook(a, {
            riderOnly: !0,
            direction: _.DIRECTION_SOUTH_WEST,
            animation: "AnimArtwork",
            boneType: "timeline/",
            skinType: "timeline/"
        }),
        o.appendChild(s),
        o.on("tap", function() {
            window.gui.openContextualMenuAround("player", o, {
                playerId: t.id || t.guestId,
                playerName: t.name
            })
        });
        var r = o.createChild("div", {
            className: "hpBar",
            name: "hpBar"
        });
        o.hp = r.createChild("div", {
            className: "hp",
            name: "hp"
        }),
        o.createChild("div", {
            className: "pendingIcon",
            name: "pendingIcon",
            text: "?"
        }),
        o.createChild("div", {
            className: "leaderIcon",
            name: "leaderIcon"
        });
        var l = o.createChild("div", {
            className: "followingBadge"
        });
        l.createChild("div", {
            className: "icon"
        }),
        this.updateMember(e, t),
        this.emit("resized")
    }
    ,
    n.prototype.updateMember = function(e, t) {
        var i = this.partyBoxes.getChild(e)
          , n = t.id || t.guestId
          , o = i.partyLeaderId === n
          , s = i.getChild(n);
        if (s) {
            s.memberData = t,
            this._updateMemberTooltip(s, o);
            var a = i.getChildren();
            o && a.length > 1 && a[0] !== s && i.insertAsFirstChild(s),
            s.hp.setStyle("height", t.lifePoints / t.maxLifePoints * 100 + "%"),
            s.toggleClassName("guest", !!t.guestId),
            s.toggleClassName("leader", o)
        }
    }
    ,
    n.prototype.addOrUpdateMember = function(e, t) {
        var i = this._getPartyById(e);
        if (i) {
            var n = i.getChild(t.id);
            n ? (n.memberData = t,
            this.updateMember(i.type, t)) : this.addMember(i.type, t)
        }
    }
    ,
    n.prototype.getMemberById = function(e, t) {
        var i = this._getPartyById(e);
        if (i) {
            var n = i.getChild(t);
            if (n)
                return n.memberData
        }
    }
    ,
    n.prototype._getPartyById = function(e) {
        var t = this.partyTypesById[e];
        return t ? this.partyBoxes.getChild(t) : null
    }
    ,
    n.prototype._joinParty = function(e, t, i, n, o) {
        this.partyBoxes || this._createContent(),
        this.hasParty[e] = !0,
        this.numParties++,
        this.partyTypesById[t] = e;
        var s = this.partyBoxes.getChild(e);
        s.type = e,
        s.partyLeaderId = i,
        s.partyId = t,
        s.isLoyal = !1,
        s.isRestricted = !0;
        for (var a = 0; a < n.length; a += 1)
            s.getChild(n[a].id) ? this.updateMember(e, n[a]) : this.addMember(e, n[a]);
        for (a = 0; a < o.length; a += 1)
            s.getChild(o[a].id) ? this.updateMember(e, o[a]) : this.addMember(e, o[a]);
        var r = s.getChild(i);
        s.getChildren()[0] !== r && s.insertAsFirstChild(r),
        this._selectPartyType(e),
        this.numParties >= 2 && this.switchPartyButton.show(),
        1 === this.numParties && this.show(),
        this.emit("resized")
    }
    ,
    n.prototype.cleanData = function(e, t) {
        if (e && this.hasParty[e]) {
            this.hasParty[e] = !1,
            this.numParties--;
            var i = this.partyBoxes.getChild(e);
            i.hide(),
            i.clearContent(),
            delete i.partyLeaderId;
            for (var n in this.partyTypesById)
                parseInt(this.partyTypesById[n], 10) === e && delete this.partyTypesById[n];
            this.switchPartyButton.hide(),
            this.numParties > 0 ? this._selectPartyType(o(e)) : this.hide(),
            e === f.PARTY_TYPE_ARENA && this.removeArenaFightQuestion(),
            t || this.emit("resized")
        }
    }
    ,
    n.prototype.removeMember = function(e) {
        var t = this._getPartyById(e.partyId);
        if (t) {
            var i = e.leavingPlayerId || e.guestId || e.cancelerId;
            t.getChild(i).destroy(),
            this.removeTeleportQuestion(i),
            this.emit("resized")
        }
    }
    ,
    n.prototype.setupEvents = function() {
        var e = this
          , t = window.gui
          , i = t.playerData.partyData
          , n = window.dofus.connectionManager;
        t.on("disconnect", function() {
            e._reset()
        }),
        t.on("PartyJoinMessage", function(t) {
            e._joinParty(t.partyType, t.partyId, t.partyLeaderId, t.members, t.guests)
        }),
        t.on("PartyLeaderUpdateMessage", function(t) {
            var i = e._getPartyById(t.partyId);
            if (i) {
                var n = i.getChild(i.partyLeaderId)
                  , o = i.getChild(t.partyLeaderId);
                i.partyLeaderId = t.partyLeaderId,
                e.updateMember(i.type, n.memberData),
                e.updateMember(i.type, o.memberData)
            }
        }),
        t.on("PartyNewGuestMessage", function(t) {
            var i = e._getPartyById(t.partyId);
            if (i) {
                var n = t.guest;
                n.hostName = i.getChild(n.hostId).memberData.name,
                e.addMember(i.type, n),
                i.partyId = t.partyId
            }
        }),
        t.on("PartyMemberRemoveMessage", function(t) {
            e.removeMember(t)
        }),
        t.on("PartyMemberEjectedMessage", function(t) {
            e.removeMember(t)
        }),
        i.on("partyNewMember", function(t, i) {
            e.addOrUpdateMember(t, i)
        }),
        i.on("partyUpdateMember", function(t, i) {
            e.addOrUpdateMember(t, i)
        }),
        t.on("PartyLeaveMessage", function(t) {
            e.cleanData(e.partyTypesById[t.partyId])
        }),
        t.on("PartyDeletedMessage", function(t) {
            e.cleanData(e.partyTypesById[t.partyId])
        }),
        t.on("PartyKickedByMessage", function(t) {
            e.cleanData(e.partyTypesById[t.partyId])
        }),
        t.on("PartyInvitationMessage", function(t) {
            e.showPartyInvitationQuestion(t.partyType, t.partyId, t.fromName)
        }),
        t.on("GameRolePlayArenaFightPropositionMessage", function(t) {
            e.showArenaFightQuestion(t.fightId)
        }),
        i.on("arenaLeft", function() {
            e.removeArenaFightQuestion()
        }),
        t.on("GameRolePlayArenaFighterStatusMessage", function(t) {
            t.accepted || e.removeArenaFightQuestion(t.fightId)
        }),
        t.on("PartyCancelInvitationNotificationMessage", function(t) {
            e.removeMember(t)
        }),
        t.on("PartyInvitationCancelledForGuestMessage", function(i) {
            t.playerData.id !== i.cancelerlId && e.removeMember(i),
            t.notificationBar.removeNotification("party" + i.partyId)
        }),
        t.on("PartyRefuseInvitationNotificationMessage", function(i) {
            e.removeMember(i);
            var n = e.invitedFrom[i.partyId];
            if (n) {
                var o = p("ui.party.invitationCancelledForGuest", n);
                t.chat.logMsg(o),
                t.notificationBar.removeNotification("party" + i.partyId)
            }
        }),
        t.on("PartyFollowStatusUpdateMessage", function(t) {
            if (t.success) {
                var i = e._getPartyById(t.partyId);
                i && (e.followedId && i.getChild(e.followedId).delClassNames("following"),
                e.followedId = t.followedId,
                e.followedId && i.getChild(e.followedId).addClassNames("following"))
            }
        }),
        t.on("PartyUpdateLightMessage", function(t) {
            var i = e._getPartyById(t.partyId);
            if (i) {
                var n = i.getChild(t.id).getChild("hpBar").getChild("hp");
                n.setStyle("height", t.lifePoints / t.maxLifePoints * 100 + "%")
            }
        }),
        n.on("TeleportBuddiesMessage", function() {
            t.openConfirmPopup({
                title: p("ui.common.confirm"),
                message: p("ui.party.teleportMembersProposition"),
                cb: function(e) {
                    n.sendMessage("TeleportBuddiesAnswerMessage", {
                        accept: e
                    })
                }
            })
        }),
        n.on("TeleportBuddiesRequestedMessage", function(e) {
            for (var n = i.getMemberName(f.PARTY_TYPE_CLASSICAL, e.inviterId), o = [], s = 0; s < e.invalidBuddiesIds.length; s++)
                o.push(i.getMemberName(f.PARTY_TYPE_CLASSICAL, e.invalidBuddiesIds[s]));
            var a = p("ui.party.teleportWish", n, e._dungeonName);
            o.length && (a += " " + m(p("ui.party.teleportCriterionFallenAngels"), o.length, o.join(", "))),
            t.chat.logMsg(a, v.CHANNEL_PARTY)
        }),
        n.on("TeleportToBuddyOfferMessage", function(t) {
            e.showTeleportQuestion(t.buddyId, t.dungeonId, t._dungeonName, 1e3 * t.timeLeft)
        }),
        n.on("TeleportToBuddyCloseMessage", function(t) {
            e.removeTeleportQuestion(t.buddyId)
        }),
        n.on("PartyRestrictedMessage", function(t) {
            var i = e._getPartyById(t.partyId);
            i && (i.isRestricted = t.restricted)
        }),
        n.on("PartyLoyaltyStatusMessage", function(t) {
            var i = e._getPartyById(t.partyId);
            i && (i.isLoyal = t.loyal)
        })
    }
    ,
    n.prototype.showTeleportQuestion = function(e, t, i, n) {
        function o(i) {
            var n = 1 === i;
            window.dofus.connectionManager.sendMessage("TeleportToBuddyAnswerMessage", {
                dungeonId: t,
                buddyId: e,
                accept: n
            })
        }
        var s = window.gui.playerData.partyData.getMemberName(f.PARTY_TYPE_CLASSICAL, e)
          , a = window.gui.notificationBar
          , r = {
            type: a.notificationType.PRIORITY_INVITATION,
            title: p("ui.common.invitation"),
            text: p("ui.party.teleportProposition", s, i),
            timer: n,
            buttons: [{
                label: p("ui.common.refuse"),
                action: o
            }, {
                label: p("ui.common.accept"),
                action: o
            }],
            onClose: o
        };
        a.newNotification("teleport" + e, r)
    }
    ,
    n.prototype.removeTeleportQuestion = function(e) {
        window.gui.notificationBar.removeNotification("teleport" + e)
    }
    ,
    n.prototype.showArenaFightQuestion = function(e) {
        function t(t) {
            var i = 1 === t;
            window.dofus.connectionManager.sendMessage("GameRolePlayArenaFightAnswerMessage", {
                fightId: e,
                accept: i
            })
        }
        this.arenaFightId = e;
        var i = "arena" + e
          , n = window.gui.notificationBar
          , o = {
            type: n.notificationType.PRIORITY_INVITATION,
            title: p("ui.common.koliseum"),
            text: p("ui.party.fightFound"),
            buttons: [{
                label: p("ui.common.refuse"),
                action: t
            }, {
                label: p("ui.common.accept"),
                action: t
            }],
            onClose: t
        };
        n.newNotification(i, o)
    }
    ,
    n.prototype.removeArenaFightQuestion = function(e) {
        e && e !== this.arenaFightId && console.error("removeArenaFightQuestion: bad fightId?"),
        this.arenaFightId && (window.gui.notificationBar.removeNotification("arena" + this.arenaFightId),
        this.arenaFightId = null )
    }
    ,
    n.prototype.showPartyInvitationQuestion = function(e, t, i) {
        function n() {
            return y.getWindow("partyInviteDetails").showPartyDetails(t),
            "HIDE_DIALOG"
        }
        function o(e) {
            var i = e === -1 ? "PartyRefuseInvitationMessage" : "PartyAcceptInvitationMessage";
            window.dofus.connectionManager.sendMessage(i, {
                partyId: t
            })
        }
        this.invitedFrom[t] = i;
        var s, a = "party" + t;
        if (e === f.PARTY_TYPE_CLASSICAL)
            s = p("ui.party.playerInvitation", i);
        else {
            if (e !== f.PARTY_TYPE_ARENA)
                return console.error("Unknown party type " + e);
            s = p("ui.party.playerInvitationArena", i)
        }
        var r = window.gui.notificationBar
          , l = {
            type: r.notificationType.INVITATION,
            title: p("ui.common.invitation"),
            text: s,
            buttons: [{
                label: p("ui.common.details"),
                action: n
            }, {
                label: p("ui.common.accept"),
                action: o
            }],
            onClose: o
        };
        r.newNotification(a, l)
    }
    ,
    n.prototype.showPartyFightQuestion = function(e, t, i, n, o) {
        function s() {
            window.dofus.connectionManager.sendMessage("GameFightJoinRequestMessage", {
                fightId: e,
                fighterId: t
            })
        }
        var a = window.gui.notificationBar
          , l = {
            type: a.notificationType.PRIORITY_INVITATION,
            title: p("ui.party.teamFightTitle"),
            wuidom: r.process(p("ui.party.joinTeamFightQuestion", n, i)),
            timer: o,
            buttons: [{
                label: p("ui.common.join"),
                action: s
            }]
        };
        a.newNotification("partyFight" + e, l)
    }
    ,
    n.prototype.removePartyFightQuestion = function(e) {
        window.gui.notificationBar.removeNotification("partyFight" + e)
    }
    ,
    n.prototype._updateMemberTooltip = function(e, t) {
        var i = e.memberData;
        s(e, function() {
            var n, o, s = e.getChild("tooltip");
            s || (s = new c("div",{
                className: "memberTooltip",
                name: "tooltip"
            }),
            s.createChild("div", {
                className: "stat",
                name: "leaderTitle",
                text: p("ui.party.leader")
            }),
            s.createChild("div", {
                className: "stat",
                name: "memberName"
            }),
            n = s.createChild("div", {
                className: "memberTips",
                name: "memberTips"
            }),
            o = s.createChild("div", {
                className: "guestTips",
                name: "guestTips"
            }),
            n.createChild("div", {
                className: "stat",
                name: "level"
            }),
            n.createChild("div", {
                className: "stat",
                name: "hp"
            }),
            n.createChild("div", {
                className: "stat",
                name: "prospecting"
            }),
            n.createChild("div", {
                className: "stat",
                name: "initiative"
            }),
            o.createChild("div", {
                className: "stat",
                name: "invitedBy"
            })),
            s.getChild("memberName").setText(i.name);
            var a = Boolean(i.guestId);
            n = s.getChild("memberTips"),
            o = s.getChild("guestTips"),
            n.toggleDisplay(!a),
            o.toggleDisplay(a);
            var r = p("ui.common.colon");
            if (a)
                o.getChild("invitedBy").setText(p("ui.party.invitedBy") + r + "\n" + i.hostName);
            else {
                var l = i.lifePoints + " / " + i.maxLifePoints;
                s.getChild("leaderTitle").toggleDisplay(t),
                n.getChild("level").setText(p("ui.common.level") + r + i.level),
                n.getChild("hp").setText(p("ui.short.lifePoints") + r + l),
                n.getChild("prospecting").setText(p("ui.stats.prospecting") + r + i.prospecting),
                n.getChild("initiative").setText(p("ui.stats.initiative") + r + i.initiative)
            }
            return s
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e, t) {
            this.deltaX = e.x - t.left - this.picker.x,
            this.deltaY = e.y - t.top - this.picker.y,
            this.box = t
        }
        function i() {
            p.emit("colorChanged", p.getCurrentColor())
        }
        function n(e) {
            var t = e.x - this.box.left
              , n = e.y - this.box.top;
            p._cursorMove({
                x: t,
                y: n
            }, this.box, this.panelType),
            i()
        }
        function o(e) {
            var t = e.x - this.box.left - this.deltaX
              , i = e.y - this.box.top - this.deltaY;
            p._cursorMove({
                x: t,
                y: i
            }, this.box, this.panelType)
        }
        function r() {
            m.open({
                x: 0,
                y: 0,
                defaultValue: ""
            })
        }
        var h = void 0 === e;
        e = e || {};
        var p = this;
        l.call(this, "div", {
            className: "ColorPicker"
        });
        var m = this.appendChild(new c);
        m.on("confirm", function(e) {
            var t = u.hexToRgb(e);
            t && (p.setCurrentColor([t.r, t.g, t.b]),
            i())
        }),
        this.params = {
            tintWidth: e.tintWidth || 162,
            tintHeight: e.tintHeight || 110,
            lumWidth: e.lumWidth || 16,
            lumHeight: e.lumHeight || 110
        },
        this.currentTint = [255, 0, 0],
        this.currentColor = [255, 0, 0],
        this.tintWrapper = this.createChild("div", {
            className: "tintWrapper"
        }),
        this.tintCanvas = this.tintWrapper.createChild("canvas", {
            className: "tintCanvas"
        }),
        this.tintCanvas.rootElement.width = this.params.tintWidth,
        this.tintCanvas.rootElement.height = this.params.tintHeight,
        s(this.tintCanvas),
        a(this.tintCanvas),
        this.tintCanvas.panelType = "tint",
        this.tintCanvas.on("slideStart", t),
        this.tintCanvas.on("slide", o),
        this.tintCanvas.on("slideEnd", i),
        this.tintCanvas.on("tapstart", t),
        this.tintCanvas.on("tap", n),
        this.tintCanvas.on("doubletap", r),
        this.tintPicker = this.tintWrapper.createChild("div", {
            className: "tintPicker"
        }),
        this.tintCanvas.picker = this.tintPicker,
        this.lumWrapper = this.createChild("div", {
            className: "lumWrapper"
        }),
        this.lumCanvas = this.lumWrapper.createChild("canvas", {
            className: "lumCanvas"
        }),
        this.lumCanvas.rootElement.width = 1,
        this.lumCanvas.rootElement.height = this.params.lumHeight,
        s(this.lumCanvas),
        a(this.lumCanvas),
        this.lumCanvas.panelType = "lum",
        this.lumCanvas.on("slideStart", t),
        this.lumCanvas.on("slide", o),
        this.lumCanvas.on("slideEnd", i),
        this.lumCanvas.on("tapstart", t),
        this.lumCanvas.on("tap", n);
        var f = this.lumPicker = this.lumWrapper.createChild("div", {
            className: "lumPicker"
        });
        this.lumCanvas.picker = f,
        f.dark = f.createChild("div", {
            className: ["triangle", "black"]
        }),
        f.bright = f.createChild("div", {
            className: ["triangle", "white"]
        }),
        h || this.updateDimensions(this.params.tintWidth + this.params.lumWidth + d, this.params.tintHeight, this.params.lumWidth)
    }
    i(516);
    var o = i(247)
      , s = i(48)
      , a = i(32)
      , r = i(26).inherits
      , l = i(190)
      , c = i(517)
      , u = i(247)
      , h = 40
      , d = 10
      , p = 1e-5
      , m = 127.5
      , f = [[255, 0, 0], [255, 255, 0], [0, 255, 0], [0, 255, 255], [0, 0, 255], [255, 0, 255], [255, 0, 0]];
    r(n, l),
    e.exports = n,
    n.prototype.updateDimensions = function(e, t, i) {
        this.params.lumWidth = i || Math.min(e / 5, h);
        var n = e - this.params.lumWidth - d;
        n = n > 0 ? n : this.params.tintWidth,
        this.params.tintWidth = n,
        this.params.tintHeight = t,
        this.tintCanvas.rootElement.width = n,
        this.tintCanvas.rootElement.height = t,
        this.tintCanvas.setStyles({
            width: n + "px",
            height: t + "px"
        }),
        this.params.lumHeight = t,
        this.lumCanvas.rootElement.height = t,
        this.lumCanvas.setStyles({
            width: this.params.lumWidth + "px",
            height: this.params.lumHeight + "px"
        }),
        this.fillTint(),
        this.updateLuminosity(),
        this._setPickerPosition(this.tintPicker, 0, 0),
        this._setPickerPosition(this.lumPicker, 0, t / 2)
    }
    ,
    n.prototype._lumCoordinatesToColor = function(e) {
        var t = e / (this.params.lumHeight / 2)
          , i = t < 1 ? [255, 255, 255] : this.currentTint
          , n = t < 1 ? this.currentTint : [0, 0, 0]
          , o = t % 1;
        return [i[0] * (1 - o) + n[0] * o, i[1] * (1 - o) + n[1] * o, i[2] * (1 - o) + n[2] * o]
    }
    ,
    n.prototype._tintCoordinatesToColor = function(e, t) {
        var i = this.params.tintWidth / (f.length - 1)
          , n = Math.floor(e / i)
          , o = e / i % 1
          , s = f[n][0]
          , a = f[n + 1][0]
          , r = f[n][1]
          , l = f[n + 1][1]
          , c = f[n][2]
          , u = f[n + 1][2]
          , h = s * (1 - o) + a * o
          , d = r * (1 - o) + l * o
          , p = c * (1 - o) + u * o
          , g = t / this.params.tintHeight
          , _ = h * (1 - g) + m * g
          , v = d * (1 - g) + m * g
          , y = p * (1 - g) + m * g;
        return [_, v, y]
    }
    ,
    n.prototype._colorToTintAndLum = function(e) {
        var t = this.params.tintWidth
          , i = this.params.tintHeight
          , n = i / 2
          , o = Math.min.apply(Math, e)
          , s = Math.max.apply(Math, e)
          , a = e.indexOf(o)
          , r = e.indexOf(s);
        if (a === r) {
            var l = (1 - o / 255) * i - p;
            return [0, i - p, l]
        }
        var c;
        c = 0 !== a && 0 !== r ? 0 : 1 !== a && 1 !== r ? 1 : 2;
        var u, h = e[r], d = e[c], g = e[a], _ = [[null , 3, 2], [4, null , 5], [1, 0, null ]], v = _[a][c], y = (d - g) / (h - g), w = v % 2 ? 1 - y : y, b = t / (f.length - 1), C = b * (v + w) % t, I = (g + h) / 255;
        u = I <= 1 ? 255 * g / m / (h + g) : (255 * h - 65025) / (m * (h + g) - 65025);
        var T = u * i
          , S = n + (1 - I) / 2 * i;
        return [C, T, S]
    }
    ,
    n.prototype.setCurrentColor = function(e) {
        var t = this._colorToTintAndLum(e);
        this.cursorMoveTo(t[0], t[1], "tint", !0),
        this.cursorMoveTo(0, t[2], "lum", !0)
    }
    ,
    n.prototype.updateLuminosity = function() {
        for (var e = this.lumCanvas.rootElement, t = e.getContext("2d"), i = t.getImageData(0, 0, e.width, e.height), n = 0; n < this.params.lumHeight; n++) {
            var o = this._lumCoordinatesToColor(n)
              , s = 4 * n;
            i.data[s] = Math.round(o[0]),
            i.data[s + 1] = Math.round(o[1]),
            i.data[s + 2] = Math.round(o[2]),
            i.data[s + 3] = 255
        }
        t.putImageData(i, 0, 0)
    }
    ,
    n.prototype.cursorMoveTo = function(e, t, i, n) {
        this._setPickerPosition(this[i + "Picker"], e, t),
        "tint" === i && (this.currentTint = this._tintCoordinatesToColor(e, t),
        this.updateLuminosity()),
        this.currentColor = this._lumCoordinatesToColor(this.lumPicker.y),
        n || this.emit("newColor", this.getCurrentColor())
    }
    ,
    n.prototype.randomize = function(e, t) {
        var i = this[e + "Canvas"].rootElement
          , n = Math.random() * i.width
          , o = Math.random() * i.height;
        this.cursorMoveTo(n, o, e, t)
    }
    ,
    n.prototype.generateRandomColor = function(e) {
        this.randomize("tint", e),
        this.randomize("lum", e)
    }
    ,
    n.prototype._cursorMove = function(e, t, i) {
        var n = this[i + "Canvas"].rootElement
          , o = e.x
          , s = e.y
          , a = n.width / t.width
          , r = n.height / t.height;
        o = Math.round(o * a),
        s = Math.round(s * r),
        o = Math.max(0, Math.min(o, n.width - 1)),
        s = Math.max(0, Math.min(s, n.height - 1)),
        this.cursorMoveTo(o, s, i)
    }
    ,
    n.prototype.fillTint = function() {
        for (var e = this.tintCanvas.rootElement, t = e.getContext("2d"), i = t.getImageData(0, 0, e.width, e.height), n = 0; n < this.params.tintWidth; n++)
            for (var o = 0; o < this.params.tintHeight; o++) {
                var s = this._tintCoordinatesToColor(n, o)
                  , a = 4 * (o * this.params.tintWidth + n);
                i.data[a] = Math.round(s[0]),
                i.data[a + 1] = Math.round(s[1]),
                i.data[a + 2] = Math.round(s[2]),
                i.data[a + 3] = 255
            }
        t.putImageData(i, 0, 0)
    }
    ,
    n.prototype.getCurrentColor = function() {
        var e = this.currentColor
          , t = [Math.round(e[0]), Math.round(e[1]), Math.round(e[2])];
        return {
            rgb: t,
            hex: o.colorArrayToHexa(t)
        }
    }
    ,
    n.prototype._setPickerPosition = function(e, t, i) {
        if (e.setStyle("webkitTransform", "translate3d(" + t + "px," + i + "px,0)"),
        e.x = t,
        e.y = i,
        e === this.lumPicker) {
            var n = i / this.params.lumHeight > .5 ? 1 : 0;
            e.bright.setStyle("opacity", n),
            e.dark.setStyle("opacity", 1 - n)
        }
    }
    ,
    n.prototype.reset = function() {
        this._setPickerPosition(this.tintPicker, 0, 0),
        this.currentTint = this._tintCoordinatesToColor(0, 0),
        this.updateLuminosity(),
        this._setPickerPosition(this.lumPicker, 0, this.params.lumHeight / 2),
        this.currentColor = this._lumCoordinatesToColor(this.lumPicker.y)
    }
    ,
    n.prototype.getCursorPosition = function(e) {
        var t = this[e + "Picker"];
        return {
            x: t.x,
            y: t.y
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            t.closeHex(),
            t.emit("confirm", t.currentValue)
        }
        var t = this;
        c.call(this, "div", {
            className: "HexSelector",
            hidden: !0
        }),
        this.close = this.appendChild(new a({
            className: ["simpleButton", "closeBtn"]
        })),
        this.createChild("div", {
            className: "hexLabel",
            text: "0x"
        }),
        this.inputBox = this.appendChild(new r({
            className: "hexInputBox",
            attr: {
                maxlength: 6
            }
        },e)),
        this.confirm = this.appendChild(new a({
            className: ["simpleButton", "confirmBtn"]
        })),
        this.currentValue = 0,
        this.confirm.on("tap", e),
        this.close.on("tap", function() {
            t.closeHex()
        }),
        this.inputBox.on("change", function(e) {
            t.currentValue = e
        })
    }
    i(518);
    var o = i(203).getElementPositionAt
      , s = i(26).inherits
      , a = i(204)
      , r = i(391)
      , l = i(31)
      , c = i(190)
      , u = {
        opacity: 0,
        webkitTransform: "scale(0.8)"
    }
      , h = {
        opacity: 1,
        webkitTransform: "scale(1)"
    };
    s(n, c),
    e.exports = n,
    n.prototype.position = function(e, t) {
        var i = o(this, e, t);
        this.setStyles({
            left: i.x + "px",
            top: i.y + "px"
        })
    }
    ,
    n.prototype.open = function(e) {
        function t() {
            delete i.openTweener,
            i.inputBox.focus(),
            i.emit("opened")
        }
        var i = this;
        return e = e || {},
        void 0 !== e.placeholder && void 0 === e.defaultValue ? (this.inputBox.setPlaceholder(e.placeholder),
        this.currentValue = "") : void 0 !== e.defaultValue && (this.currentValue = e.defaultValue),
        this.inputBox.setValue(this.currentValue),
        this.show(),
        e.hasOwnProperty("x") && e.hasOwnProperty("y") && this.position(e.x, e.y),
        this.setStyles(u),
        this.openTweener ? (this.openTweener.cancel(),
        t()) : void (this.openTweener = l.tween(this, h, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, t))
    }
    ,
    n.prototype.closeHex = function() {
        function e() {
            delete t.closeTweener,
            t.hide(),
            t.emit("closed"),
            t.inputBox.blur()
        }
        var t = this;
        return this.closeTweener ? (this.closeTweener.cancel(),
        e()) : void (this.closeTweener = l.tween(this, u, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, e))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            t.identification = {
                accountCreation: e.accountCreation,
                accountId: e.accountId,
                communityId: e.communityId,
                hasRights: e.hasRights,
                accountSessionUid: e.login,
                login: t.loginName,
                nickname: e.nickname,
                secretQuestion: e.secretQuestion,
                subscriptionEndDate: e.subscriptionEndDate,
                wasAlreadyConnected: e.wasAlreadyConnected
            }
        }
        o.call(this);
        var t = this;
        this.loginName = null ,
        this.identification = {},
        this.characterBaseInformations = {},
        this.accountCapabilities = {},
        this.achievements = {},
        this.lifePoints = 0,
        this.maxLifePoints = 0,
        this.movementPoints = 0,
        this.actionPoints = 0,
        this.isFightLeader = !1,
        this.isFighting = !1,
        this.isSpectator = !1,
        this.state = r.STATUS_ALIVE_AND_KICKING,
        this.experienceFactor = 0;
        for (var i in d) {
            var n = d[i];
            this[i] = new n
        }
        window.dofus.connectionManager.on("IdentificationSuccessMessage", e),
        window.dofus.connectionManager.on("IdentificationSuccessWithLoginTokenMessage", e)
    }
    var o = i(16).EventEmitter
      , s = i(210)
      , a = i(26).inherits
      , r = i(420)
      , l = i(457)
      , c = i(22)
      , u = i(35).getText
      , h = i(335)
      , d = {
        alliance: i(520),
        characters: i(522),
        emoteData: i(525),
        fightRequests: i(526),
        guild: i(528),
        inventory: i(529),
        jobs: i(535),
        achievements: i(536),
        position: i(537),
        partyData: i(538),
        quests: i(542),
        socialData: i(545),
        myShop: i(546),
        alignment: i(547)
    };
    a(n, o),
    e.exports = n,
    n.prototype.initialize = function(e) {
        function t() {
            delete i.equippedMount,
            i.isRiding = !1
        }
        var i = this
          , n = window.dofus.connectionManager;
        for (var o in d) {
            var a = this[o];
            a.initialize(e)
        }
        e.on("connected", function(e) {
            for (var t in d) {
                var n = i[t];
                "function" == typeof n.connect && n.connect(e)
            }
        }),
        e.on("disconnect", function() {
            for (var e in d) {
                var n = i[e];
                n.disconnect && n.disconnect()
            }
            i.experienceFactor = 0,
            i.accountCapabilities = {},
            i.loginName = null ,
            t()
        }),
        e.on("AccountCapabilitiesMessage", function(e) {
            i.accountCapabilities = e
        }),
        e.on("ServerExperienceModificatorMessage", function(e) {
            i.experienceFactor = e.experiencePercent - 100
        }),
        e.on("GameContextRefreshEntityLookMessage", function(e) {
            e.id === i.id && (i.characterBaseInformations.entityLook = e.look,
            i.emit("lookUpdate", e.look))
        }),
        e.on("CharacterSelectedSuccessMessage", function(e) {
            var t = e.infos;
            i.id = t.id,
            s.storeMapAndEmit(i, i.characterBaseInformations, t, "characterInfosUpdated"),
            i.emit("characterSelectedSuccess"),
            i.emit("lookUpdate", t.entityLook)
        }),
        e.on("CharacterLevelUpMessage", function(e) {
            var t = i.characterBaseInformations.level;
            i.characterBaseInformations.level = e.newLevel,
            i.emit("characterLevelUp", {
                newLevel: e.newLevel,
                previousLevel: t
            }),
            i.emit("characterInfosUpdated")
        }),
        n.on("MountUnSetMessage", function() {
            if (i.equippedMount) {
                var e = i.equippedMount.id;
                t(),
                i.emit("unsetMount", e)
            }
        }),
        n.on("MountRidingMessage", function(e) {
            i.isRiding = e.isRiding,
            i.emit("mountRiding", e.isRiding)
        }),
        n.on("MountSetMessage", function(e) {
            i.equippedMount = e.mountData,
            i.equippedMount.mountLocation = "equip",
            i.equippedMount.xpRatio = i.mountXpRatio,
            i.emit("setMount", e)
        }),
        n.on("MountXpRatioMessage", function(e) {
            i.equippedMount && (i.equippedMount.xpRatio = i.mountXpRatio = e.ratio,
            i.emit("setMountRatio", e.ratio))
        }),
        e.on("GameRolePlayPlayerLifeStatusMessage", function(e) {
            var t = e.state;
            if (i.state = t,
            t === r.STATUS_TOMBSTONE) {
                var n = {
                    title: u("ui.login.news"),
                    message: u("ui.gameuicore.playerDied") + "\n\n" + u("ui.gameuicore.freeSoul"),
                    cb: function(e) {
                        e && window.dofus.sendMessage("GameRolePlayFreeSoulRequestMessage")
                    }
                };
                c.getWindow("confirm").update(n),
                c.openDialog(["confirm"])
            } else
                t === r.STATUS_PHANTOM && window.gui.openSimplePopup(u("ui.gameuicore.soulsWorld"), u("ui.login.news"))
        }),
        e.on("GameRolePlayGameOverMessage", function() {
            c.openDialog(["hardcoreDeath"])
        })
    }
    ,
    n.prototype.setLoginName = function(e) {
        return e ? void (this.loginName = e) : console.error(new Error("PlayerData.setLoginName: login is emtpy"))
    }
    ,
    n.prototype.isAlive = function() {
        return this.state === r.STATUS_ALIVE_AND_KICKING
    }
    ,
    n.prototype.isAdmin = function() {
        return this.accountCapabilities.status >= l.ADMIN
    }
    ,
    n.prototype.isModeratorOrMore = function() {
        return this.accountCapabilities.status >= l.MODERATOR
    }
    ,
    n.prototype.isSubscriber = function() {
        return this.identification.subscriptionEndDate > Date.now()
    }
    ,
    n.prototype.isMutant = function() {
        return "GameRolePlayMutantInformations" === window.isoEngine.actorManager.userActor.data.type
    }
    ,
    n.prototype.getRestrictions = function() {
        return window.isoEngine.actorManager.userActor.data.humanoidInfo.restrictions
    }
    ,
    n.prototype.isPvpAggressable = function() {
        return this.alignment.alignmentInfos.aggressable === h.PvP_ENABLED_AGGRESSABLE || this.alignment.alignmentInfos.aggressable === h.PvP_ENABLED_NON_AGGRESSABLE
    }
    ,
    n.prototype.getLevelDiff = function(e) {
        var t, i, n = this.characterBaseInformations.level;
        return e < n ? (t = -1,
        i = n / e) : (t = 1,
        i = e / n),
        Math.abs(e - n) > 20 || i >= 1.2 ? t : 0
    }
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.current = null
    }
    var o = i(423)
      , s = i(16).EventEmitter
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(521)
      , c = i(22);
    r(n, s),
    e.exports = n,
    n.prototype.connect = function() {
        this.current = null
    }
    ,
    n.prototype.hasAlliance = function() {
        return null !== this.current
    }
    ,
    n.prototype.isBoss = function() {
        if (!this.current || !this.current.guilds.length)
            return !1;
        var e = this.current.guilds[0]
          , t = window.gui.playerData.guild;
        return e.guildId === t.current.guildId && t.isBoss()
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("AllianceMembershipMessage", function(e) {
            t.current ? t.current.setInfo(e.allianceInfo) : t.current = o.createAlliance(e.allianceInfo),
            t.current.enabled = e.enabled
        }),
        e.on("AllianceJoinedMessage", function(i) {
            t.current = o.createAlliance(i.allianceInfo),
            t.current.enabled = i.enabled,
            e.chat.logMsg(a("ui.alliance.joinAllianceMessage", [i.allianceInfo.allianceName])),
            t.emit("allianceJoined")
        }),
        e.on("AllianceGuildLeavingMessage", function(e) {
            for (var i = t.current.guilds, n = 0, o = i.length; n < o; n += 1)
                if (i[n].guildId === e.guildId)
                    return i.splice(n, 1),
                    void t.emit("guildLeft", e.guildId)
        }),
        e.on("AllianceLeftMessage", function() {
            t.current = null ,
            t.emit("allianceLeft")
        }),
        e.on("AllianceInsiderInfoMessage", function(e) {
            var i = e.allianceInfos;
            i.guilds = e.guilds,
            i.prisms = e.prisms,
            t.current ? t.current.setInfo(i) : t.current = o.createAlliance(i),
            t.emit("allianceUpdated", t.current)
        }),
        e.on("AllianceInvitationStateRecruterMessage", function(t) {
            return t.invitationState !== l.SOCIAL_GROUP_INVITATION_SENT ? c.close("cancel") : void e.openCancelPopup({
                title: a("ui.common.invitation"),
                message: a("ui.craft.waitForCraftClient", t.recrutedName),
                cb: function() {
                    window.dofus.sendMessage("AllianceInvitationAnswerMessage", {
                        accept: !1
                    })
                }
            })
        }),
        e.on("AllianceInvitationStateRecrutedMessage", function(e) {
            if (e.invitationState === l.SOCIAL_GROUP_INVITATION_CANCELED)
                return c.close("confirm")
        }),
        e.on("AllianceInvitedMessage", function(e) {
            window.gui.openConfirmPopup({
                title: a("ui.common.invitation"),
                message: a("ui.alliance.youAreInvited", e.recruterName, e.allianceInfo.allianceName),
                cb: function(e) {
                    window.dofus.sendMessage("GuildInvitationAnswerMessage", {
                        accept: e
                    })
                }
            })
        }),
        e.on("PrismsListUpdateMessage", function(e) {
            if (t.current) {
                for (var i = e.prisms, n = [], o = [], s = t.current.prisms, a = 0, r = i.length; a < r; a += 1) {
                    var l = i[a];
                    "PrismGeolocalizedInformation" === l._type && "AllianceInsiderPrismInformation" === l.prism._type ? (l.prism.alliance = t.current,
                    s[l.subAreaId] = l,
                    n.push(l)) : s[l.subAreaId] && (delete s[l.subAreaId],
                    o.push(l.subAreaId))
                }
                n.length && t.emit("prismUpdatedList", n),
                o.length && t.emit("prismDeletedList", o)
            }
        })
    }
}
, function(e, t) {
    e.exports = {
        SOCIAL_GROUP_INVITATION_FAILED: 0,
        SOCIAL_GROUP_INVITATION_SENT: 1,
        SOCIAL_GROUP_INVITATION_CANCELED: 2,
        SOCIAL_GROUP_INVITATION_OK: 3
    }
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.slaves = {},
        this.mainCharacter = new r,
        this.controlledCharacterId = 0,
        this.mainCharacterId = 0
    }
    function o(e, t, i) {
        if (!e)
            return null ;
        var n = window.gui.playerData.characters.getCharacterById(e);
        if (!n)
            return null ;
        var o = n.characteristics.spellModifications;
        if (!o)
            return null ;
        for (var s = 0; s < o.length; s++) {
            var a = o[s];
            if (a.spellId === t && a.modificationType === i)
                return a
        }
        return null
    }
    var s = i(16).EventEmitter
      , a = i(26).inherits
      , r = i(523)
      , l = 3;
    a(n, s),
    e.exports = n,
    n.prototype.disconnect = function() {
        this.clearSlaves(),
        this.mainCharacter.disconnect(),
        this.controlledCharacterId = 0,
        this.mainCharacterId = 0,
        this.stopRegen()
    }
    ,
    n.prototype.clearSlaves = function() {
        for (var e in this.slaves)
            this.slaves[e].disconnect();
        this.slaves = {}
    }
    ,
    n.prototype.assignMainCharacterInfos = function(e) {
        var t = window.gui.databases.Breeds[e.breed];
        window.gui.playerData.characterBreed = t,
        this.emit("setCharacterBreed"),
        this.mainCharacterId = e.id,
        this.mainCharacter.setCharacterId(e.id)
    }
    ,
    n.prototype.switchControlledCharacter = function(e) {
        if (e !== this.controlledCharacterId) {
            this.controlledCharacterId = e,
            window.actorManager.switchUserActor(e),
            this.emit("switchControlledCharacter");
            var t = this.getControlledCharacter();
            t.characteristics && t.emitCharacteristicsUpdate()
        }
    }
    ,
    n.prototype.canControlCharacterId = function(e) {
        return !(e !== this.mainCharacterId && !this.slaves[e])
    }
    ,
    n.prototype.getControlledCharacter = function() {
        return this.controlledCharacterId === this.mainCharacterId ? this.mainCharacter : this.slaves[this.controlledCharacterId]
    }
    ,
    n.prototype.isMainCharacterControlled = function() {
        return this.controlledCharacterId === this.mainCharacterId
    }
    ,
    n.prototype.getCharacterById = function(e) {
        return e === this.mainCharacterId ? this.mainCharacter : this.slaves[e]
    }
    ,
    n.prototype.setCharacteristic = function(e, t) {
        var i = this.getControlledCharacter();
        i.setCharacteristic(e, t)
    }
    ,
    n.prototype.addSummonedCreature = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        t.currentSummonedCreature += 1
    }
    ,
    n.prototype.removeSummonedCreature = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        t.currentSummonedCreature > 0 && (t.currentSummonedCreature -= 1)
    }
    ,
    n.prototype.canSummonCreature = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        return t.getMaxSummonedCreature() > t.currentSummonedCreature
    }
    ,
    n.prototype.addSummonedBomb = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        t.currentSummonedBomb += 1
    }
    ,
    n.prototype.removeSummonedBomb = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        t.currentSummonedBomb > 0 && (t.currentSummonedBomb -= 1)
    }
    ,
    n.prototype.canSummonBomb = function(e) {
        var t = e ? this.getCharacterById(e) : this.getControlledCharacter();
        return l > t.currentSummonedBomb
    }
    ,
    n.prototype.getSpellModifications = o,
    n.prototype.stopRegen = function() {
        window.clearInterval(this.regenTimer)
    }
    ,
    n.prototype.startRegen = function() {
        this.regenTimer = window.setInterval(this._autoRegenerateLife.bind(this), this.regenRate)
    }
    ,
    n.prototype._autoRegenerateLife = function() {
        return this.mainCharacter && this.mainCharacter.characteristics ? void (this.mainCharacter.characteristics.lifePoints >= this.mainCharacter.characteristics.maxLifePoints ? this.stopRegen() : this.mainCharacter.setCharacteristic("lifePoints", this.mainCharacter.characteristics.lifePoints + 1)) : void this.stopRegen()
    }
    ,
    n.prototype.initialize = function(e) {
        function t(e) {
            var t = i.mainCharacter.characteristics.alignmentInfos;
            t.aggressable = e,
            i.mainCharacter.setCharacteristic("alignmentInfos", t)
        }
        var i = this;
        e.on("CharacterSelectedSuccessMessage", function(e) {
            var t = e.infos;
            i.assignMainCharacterInfos(t),
            i.controlledCharacterId = t.id
        }),
        e.on("CharacterStatsListMessage", function(t) {
            if (i.mainCharacter.characteristics) {
                var n = i.mainCharacter.characteristics.energyPoints
                  , o = t.stats.energyPoints;
                n > o && e.playerData.emit("playerIsDead")
            }
            i.mainCharacter.setCharacteristics(t.stats)
        }),
        e.on("SlaveSwitchContextMessage", function(e) {
            var t = e.summonerId;
            if (t === i.mainCharacterId) {
                var n = e.slaveId
                  , o = i.slaves[n];
                o || (o = i.slaves[n] = new r,
                o.setCharacterId(n)),
                o.spellData.once("loaded", function() {
                    i.emit("spellList")
                }),
                o.spellData.addSpells(e.slaveSpells),
                i.switchControlledCharacter(n),
                o.setCharacteristics(e.slaveStats)
            }
        }),
        e.on("FighterStatsListMessage", function(e) {
            var t = i.getControlledCharacter();
            t.setCharacteristics(e.stats)
        }),
        e.on("LifePointsRegenBeginMessage", function(e) {
            i.regenRate = 100 * e.regenRate,
            i.stopRegen(),
            i.startRegen()
        }),
        e.on("LifePointsRegenEndMessage", function(e) {
            i.stopRegen(),
            i.mainCharacter.setCharacteristic("lifePoints", e.lifePoints),
            i.mainCharacter.setCharacteristic("maxLifePoints", e.maxLifePoints)
        }),
        e.on("SpellListMessage", function(e) {
            var t = i.mainCharacter.spellData;
            t.once("loaded", function() {
                i.emit("spellList")
            }),
            t.addSpells(e.spells);
            var n = window.gui.playerData.characterBreed;
            n ? t.addSpellsFromId(n.breedSpellsId) : i.once("setCharacterBreed", function() {
                t.addSpellsFromId(window.gui.playerData.characterBreed.breedSpellsId, function() {
                    i.mainCharacter.emit("spellsUpdate")
                })
            })
        }),
        e.on("SpellUpgradeSuccessMessage", function(e) {
            i.mainCharacter.spellData.upgradeSpell(e.spellId, e.spellLevel, function() {
                1 === e.spellLevel && i.mainCharacter.emit("newSpellLearned", e.spellId, e.spellLevel),
                i.mainCharacter.emit("spellUpgrade", e.spellId, e.spellLevel)
            })
        }),
        e.playerData.inventory.on("weaponChanged", function() {
            i.mainCharacter.spellData.weaponChanged(function() {
                i.mainCharacter.emit("weaponChanged")
            })
        }),
        e.on("UpdateSelfAgressableStatusMessage", function(e) {
            var n = e.status;
            t(n),
            window.actorManager.updateActorsAggressableStatus([i.mainCharacterId], [n])
        }),
        e.on("UpdateMapPlayersAgressableStatusMessage", function(e) {
            var n = e.playerIds
              , o = n.indexOf(i.mainCharacterId);
            o !== -1 && t(e.enable[o])
        })
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.characteristics = null ,
        this.spellShortcuts = null ,
        this.spellData = new a,
        this.currentSummonedCreature = 0,
        this.currentSummonedBomb = 0,
        this.timeStatsSynchronized = 0
    }
    var o = i(16).EventEmitter
      , s = i(26).inherits
      , a = i(524)
      , r = {
        actionPointsCurrent: !0,
        alignmentInfos: !0,
        lifePoints: !0,
        maxLifePoints: !0,
        movementPointsCurrent: !0,
        spellsPoints: !0
    };
    s(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this.characteristics = null ,
        this.spellShortcuts = null ,
        this.spellData.disconnect(),
        this.currentSummonedCreature = 0,
        this.currentSummonedBomb = 0
    }
    ,
    n.prototype.setCharacteristics = function(e) {
        this.characteristics = e;
        var t = window.gui.playerData.characters.getControlledCharacter() === this;
        t && this.emitCharacteristicsUpdate(),
        this.timeStatsSynchronized = Date.now()
    }
    ,
    n.prototype.emitCharacteristicsUpdate = function() {
        var e = window.gui.playerData;
        for (var t in r)
            void 0 !== this.characteristics[t] ? e.emit(t + "Updated", this.characteristics[t]) : console.error("No characteristic named: " + t)
    }
    ,
    n.prototype.setCharacteristic = function(e, t) {
        if (void 0 === this.characteristics[e])
            return void console.error("No characteristic named: " + e);
        this.characteristics[e] = t;
        var i = window.gui.playerData.characters.getControlledCharacter() === this;
        i && r[e] && window.gui.playerData.emit(e + "Updated", t)
    }
    ,
    n.prototype.setCharacterId = function(e) {
        this.spellData.characterId = e
    }
    ,
    n.prototype.getMaxSummonedCreature = function() {
        return this.characteristics.summonableCreaturesBoost.base + this.characteristics.summonableCreaturesBoost.objectsAndMountBonus + this.characteristics.summonableCreaturesBoost.alignGiftBonus + this.characteristics.summonableCreaturesBoost.contextModif
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.requestsPendingCount = 0,
        this.spells = {},
        this.characterId = null ,
        this.isLoaded = !1,
        this._learnedSpellList = []
    }
    var o = i(16).EventEmitter
      , s = i(26).inherits
      , a = i(281)
      , r = i(158);
    s(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this.isLoaded = !1,
        this.spells = {},
        this.characterId = null ,
        this.requestsPendingCount = 0,
        this._learnedSpellList = []
    }
    ,
    n.prototype.weaponChanged = function(e) {
        this.spells[a.WEAPON_SPELL_ID] && this.spells[a.WEAPON_SPELL_ID].update(e)
    }
    ,
    n.prototype._createSpells = function(e, t, i) {
        var n = this;
        t = t || {},
        this.requestsPendingCount++,
        this.isLoaded = !1,
        a.createSpells(e, function(e, o) {
            if (e)
                return console.error(e);
            for (var s in o) {
                o[s].ownerId = n.characterId,
                n.spells[s] = o[s];
                var a = t[s];
                a && (void 0 !== a.level && o[s].setLevel(a.level),
                void 0 !== a.position && o[s].setPosition(a.position))
            }
            n.requestsPendingCount--,
            0 === n.requestsPendingCount && (n.isLoaded = !0,
            n.emit("loaded")),
            i && i()
        })
    }
    ,
    n.prototype.addSpellsFromId = function(e, t) {
        for (var i = [], n = 0, o = e.length; n < o; n++) {
            var s = e[n];
            !this.spells[s] && this._learnedSpellList.indexOf(s) < 0 && i.push(s)
        }
        return i.length ? void this._createSpells(i, null , t) : t && t()
    }
    ,
    n.prototype.addSpells = function(e, t) {
        for (var i = {}, n = [], o = 0, s = e.length; o < s; o++) {
            var a = e[o]
              , r = a.spellId;
            n.push(r),
            this.spells[r] ? (this.spells[r].setLevel(a.spellLevel),
            this.spells[r].setPosition(a.position)) : (i[r] = {
                level: a.spellLevel,
                position: a.position
            },
            this._learnedSpellList.push(r))
        }
        var l = Object.keys(i);
        l.length > 0 ? this._createSpells(l, i, t) : t && t()
    }
    ,
    n.prototype.upgradeSpell = function(e, t, i) {
        var n = -1
          , o = this.spells[e];
        if (o)
            n = o.level,
            o.setLevel(t),
            i && i();
        else {
            var s = {};
            s[e] = {},
            s[e].level = t,
            this._createSpells([e], s, i)
        }
        r.log("character_progression.spell_level_change", {
            spell_level_before: n,
            spell_level_after: t,
            spell_id: e
        })
    }
    ,
    n.prototype.getSpellBySpellLevelId = function(e) {
        for (var t in this.spells) {
            var i = this.spells[t];
            if (!i.isItem && i.spellLevel.id === e)
                return i
        }
        return null
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.list = {}
    }
    var o = i(16).EventEmitter
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(36);
    a(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this.list = {}
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("EmoteListMessage", function(e) {
            r.getDataMap("Emoticons", e.emoteIds, function(e, i) {
                if (e)
                    return console.error("could not retrieve emotes data", e);
                for (var n in i)
                    i[n] && (t.list[n] = i[n]);
                t.emit("emoteListUpdated", t.list)
            })
        }),
        e.on("EmoteAddMessage", function(e) {
            r.getData("Emoticons", e.emoteId, function(e, i) {
                if (e)
                    return console.error("could not retrieve emotes data", e);
                var n = i.id;
                t.list[n] || (t.list[n] = i,
                window.gui.chat.logMsg(s("ui.common.emoteAdded", [i.nameId])),
                t.emit("emoteAdded", i))
            })
        }),
        e.on("EmoteRemoveMessage", function(e) {
            var i = t.list[e.emoteId];
            i && (window.gui.chat.logMsg(s("ui.common.emoteRemoved", [i.nameId])),
            delete t.list[e.emoteId],
            t.emit("emoteRemoved", e.emoteId))
        })
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this._targetInfo = {}
    }
    var o = i(16).EventEmitter
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(465)
      , l = i(527)
      , c = i(292);
    a(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this._targetInfo = {}
    }
    ,
    n.prototype.initialize = function(e) {
        function t(e) {
            var t = r.setupNames(i._targetInfo.targetId, e.sourceId);
            return t ? (r.setupCancelPopupTexts({
                title: s("ui.fight.challenge"),
                message: s("ui.fight.youChallenge", t.targetName)
            }),
            r.setupConfirmPopupTexts({
                title: s("ui.fight.challenge"),
                message: s("ui.fight.aChallengeYou", t.sourceName)
            }),
            void r.askingChallengePopup(e.fightId)) : console.error("FightRequestsData: setupNames")
        }
        var i = this;
        e.on("GameRolePlayPlayerFightFriendlyRequestedMessage", t),
        e.on("GameRolePlayPlayerFightFriendlyAnsweredMessage", function(e) {
            r.closingChallengePopup(e.sourceId === window.gui.playerData.id)
        }),
        e.on("ChallengeFightJoinRefusedMessage", function(e) {
            i.alertChallengeRefused(e.reason)
        }),
        e.on("GameRolePlayAggressionMessage", function(e) {
            i.alertAggression(e)
        })
    }
    ,
    n.prototype.requestChallenge = function(e) {
        this._targetInfo = e,
        this.sendRequest(e, !1, !0, !1)
    }
    ,
    n.prototype.requestAssault = function(e, t) {
        this._targetInfo = e,
        this.sendRequest(e, t, !1, !0)
    }
    ,
    n.prototype.sendRequest = function(e, t, i, n) {
        var o = e.targetId
          , s = e.targetCellId;
        if (n) {
            var a = window.isoEngine.actorManager
              , r = a.getActor(o).data;
            if ("GameRolePlayCharacterInformations" === r.type) {
                if (t)
                    return this.confirmAttackTarget(e, !0, null );
                var l = "GameRolePlayMutantInformations" === a.userActor.data.type;
                if (r.alignmentInfos.alignmentSide === c.ALIGNMENT_NEUTRAL && !l)
                    return this.confirmAttackTarget(e, !1, 2);
                var u = r.alignmentInfos.characterPower - o
                  , h = window.gui.playerData.getLevelDiff(u);
                if (h)
                    return this.confirmAttackTarget(e, !1, h)
            }
        }
        window.dofus.sendMessage("GameRolePlayPlayerFightRequestMessage", {
            targetId: o,
            targetCellId: s,
            friendly: i
        })
    }
    ,
    n.prototype.confirmAttackTarget = function(e, t, i) {
        var n, o = e.targetName;
        t || 0 === i ? n = s("ui.pvp.doUAttack", o) : 2 === i ? n = s("ui.pvp.doUAttackNeutral") : i === -1 ? n = s("ui.pvp.doUAttackNoGain", o) : 1 === i && (n = s("ui.pvp.doUAttackBonusGain", o));
        var a = this;
        window.gui.openConfirmPopup({
            title: s("ui.popup.warning"),
            message: n,
            cb: function(i) {
                1 === i && a.sendRequest(e, t, !1, !1)
            }
        })
    }
    ,
    n.prototype.alertAggression = function(e) {
        var t = window.isoEngine.actorManager
          , i = t.getActor(e.attackerId)
          , n = t.getActor(e.defenderId);
        if (!i || !n)
            return console.error("Could not find aggressed actors.");
        var o = s("ui.pvp.aAttackB", i.data.name, n.data.name);
        window.gui.chat.logMsg(o)
    }
    ,
    n.prototype.alertChallengeRefused = function(e) {
        var t;
        switch (e) {
        case l.CHALLENGE_FULL:
            t = s("ui.fight.challengeFull");
            break;
        case l.TEAM_FULL:
            t = s("ui.fight.teamFull");
            break;
        case l.WRONG_ALIGNMENT:
            t = s("ui.wrongAlignment");
            break;
        case l.WRONG_GUILD:
            t = s("ui.fight.wrongGuild");
            break;
        case l.TOO_LATE:
            t = s("ui.fight.tooLate");
            break;
        case l.MUTANT_REFUSED:
            t = s("ui.fight.mutantRefused");
            break;
        case l.WRONG_MAP:
            t = s("ui.fight.wrongMap");
            break;
        case l.JUST_RESPAWNED:
            t = s("ui.fight.justRespawned");
            break;
        case l.IM_OCCUPIED:
            t = s("ui.fight.imOccupied");
            break;
        case l.OPPONENT_OCCUPIED:
            t = s("ui.fight.opponentOccupied");
            break;
        case l.MULTIACCOUNT_NOT_ALLOWED:
            t = s("ui.fight.onlyOneAllowedAccount");
            break;
        case l.INSUFFICIENT_RIGHTS:
            t = s("ui.fight.insufficientRights");
            break;
        case l.MEMBER_ACCOUNT_NEEDED:
            t = s("ui.fight.MemberAccountNeeded");
            break;
        case l.OPPONENT_NOT_MEMBER:
            t = s("ui.fight.opponentNotMember");
            break;
        case l.TEAM_LIMITED_BY_MAINCHARACTER:
            t = s("ui.fight.teamLimitedByMainCharacter");
            break;
        case l.GHOST_REFUSED:
            t = s("ui.fight.ghostRefused");
            break;
        case l.AVA_ZONE:
            t = s("ui.fight.cantAttackAvAZone");
            break;
        default:
            return
        }
        window.gui.chat.logMsg(t)
    }
}
, function(e, t) {
    e.exports = {
        FIGHTER_REFUSED: -1,
        FIGHTER_ACCEPTED: 0,
        CHALLENGE_FULL: 1,
        TEAM_FULL: 2,
        WRONG_ALIGNMENT: 3,
        WRONG_GUILD: 4,
        TOO_LATE: 5,
        MUTANT_REFUSED: 6,
        WRONG_MAP: 7,
        JUST_RESPAWNED: 8,
        IM_OCCUPIED: 9,
        OPPONENT_OCCUPIED: 10,
        FIGHT_MYSELF: 11,
        INSUFFICIENT_RIGHTS: 12,
        MEMBER_ACCOUNT_NEEDED: 13,
        OPPONENT_NOT_MEMBER: 14,
        TEAM_LIMITED_BY_MAINCHARACTER: 15,
        MULTIACCOUNT_NOT_ALLOWED: 16,
        GHOST_REFUSED: 17,
        RESTRICTED_ACCOUNT: 19,
        WRONG_ALLIANCE: 20,
        AVA_ZONE: 21
    }
}
, function(e, t, i) {
    function n() {
        l.call(this),
        this.current = null
    }
    var o = i(49)
      , s = i(339)
      , a = s.GuildRightsBitEnum
      , r = i(476)
      , l = i(16).EventEmitter
      , c = i(35).getText
      , u = i(210)
      , h = i(26).inherits
      , d = i(521)
      , p = i(22)
      , m = i(432)
      , f = i(447)
      , g = 1;
    h(n, l),
    e.exports = n,
    n.prototype._reset = function() {
        this.current = null
    }
    ,
    n.prototype.disconnect = function() {
        this._reset()
    }
    ,
    n.prototype.hasGuild = function() {
        return null !== this.current
    }
    ,
    n.prototype.checkRight = function(e, t) {
        return (e & t) > 0
    }
    ,
    n.prototype.hasRight = function(e) {
        return !!this.isBoss() || this.checkRight(e, this.current.memberRights)
    }
    ,
    n.prototype.isBoss = function() {
        return this.current.leaderId === window.gui.playerData.id || this.checkRight(a.GUILD_RIGHT_BOSS, this.current.memberRights)
    }
    ,
    n.prototype.isAMember = function(e) {
        return this.current.members.hasOwnProperty(e)
    }
    ,
    n.prototype._initPerceptors = function() {
        return this.current.perceptors = {
            nbcollectorMax: 0,
            informationsOrderList: [],
            perceptorsMap: {}
        },
        this.current.perceptors
    }
    ,
    n.prototype.getPerceptors = function() {
        var e = this.current.perceptors;
        return e || (e = this._initPerceptors()),
        e
    }
    ,
    n.prototype.getPerceptor = function(e) {
        var t = this.getPerceptors();
        return t.perceptorsMap[e]
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("GuildMembershipMessage", function(e) {
            t.current && t.current.guildId === e.guildInfo.guildId || (t.current = s.createGuild(e.guildInfo)),
            t.current.enabled = e.enabled,
            t.current.memberRights = e.memberRights
        }),
        e.on("GuildJoinedMessage", function(i) {
            t.current = s.createGuild(i.guildInfo),
            t.current.enabled = i.enabled,
            t.current.memberRights = i.memberRights,
            e.chat.logMsg(c("ui.guild.JoinGuildMessage", [i.guildInfo.guildName]))
        }),
        e.on("GuildInformationsGeneralMessage", function(e) {
            var i = t.current;
            i.level = e.level,
            i.creationDate = e.creationDate,
            i.abandonnedPaddock = e.abandonnedPaddock,
            i.experience = e.experience,
            i.expNextLevelFloor = e.expNextLevelFloor,
            i.experiencePercentage = (e.experience - e.expLevelFloor) / (e.expNextLevelFloor - e.expLevelFloor),
            t.emit("GuildGeneralInformationUpdate")
        }),
        e.on("GuildInformationsMembersMessage", function(e) {
            for (var i = t.current, n = 0, o = {}, s = e.members.length, a = 0, r = 0; r < s; r++) {
                var l = e.members[r];
                a += l.level,
                l.rank === g && (i.leaderId = l.id),
                l.connected && (n += 1),
                o[l.id] = l
            }
            i.members = o,
            i.averageMemberLevel = Math.floor(a / s),
            i.nbMembers = s,
            i.nbConnectedMembers = n,
            t.emit("guildMemberCountUpdate"),
            t.emit("guildMember", i.getMembersByRank())
        }),
        e.on("GuildInformationsMemberUpdateMessage", function(e) {
            var i = t.current
              , n = e.member;
            i.members[n.id] = n,
            n.rank === g && (i.leaderId = n.id),
            t.emit("guildMember", i.getMembersByRank())
        }),
        e.on("GuildMemberLeavingMessage", function(e) {
            var i = t.current
              , n = i.members;
            delete n[e.memberId];
            var o = 0
              , s = 0;
            for (var a in n) {
                var r = n[a];
                r.connected && (o += 1),
                s += 1
            }
            i.nbMembers = s,
            i.nbConnectedMembers = o,
            t.emit("guildMemberCountUpdate"),
            t.emit("guildMember", t.current.getMembersByRank())
        }),
        e.on("GuildMemberOnlineStatusMessage", function(e) {
            var i = t.current
              , n = i.members[e.memberId];
            n && (e.online ? (n.connected = 1,
            n.status.statusId = m.PLAYER_STATUS_AVAILABLE,
            i.nbConnectedMembers++) : (n.connected = 0,
            n.status.statusId = m.PLAYER_STATUS_OFFLINE,
            i.nbConnectedMembers--),
            t.emit("guildMemberCountUpdate"),
            t.emit("guildMember", i.getMembersByRank()))
        }),
        o.on("PlayerStatusUpdateMessage", function(e) {
            if (t.current) {
                var i = t.current.members[e.playerId];
                i && (i.status = e.status,
                t.emit("guildMemberStatusUpdate", i))
            }
        }),
        e.on("GuildMemberWarnOnConnectionStateMessage", function(e) {
            t.current && (t.current.warnMemberOnConnectionState = e.enable)
        }),
        e.on("GuildLeftMessage", function() {
            t.current = null ,
            t.emit("guildLeft")
        }),
        e.on("GuildInvitationStateRecruterMessage", function(t) {
            return t.invitationState === d.SOCIAL_GROUP_INVITATION_OK && window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: r.INFO_MEMBERS
            }),
            t.invitationState !== d.SOCIAL_GROUP_INVITATION_SENT ? p.close("cancel") : void e.openCancelPopup({
                title: c("ui.common.invitation"),
                message: c("ui.craft.waitForCraftClient", t.recrutedName),
                cb: function() {
                    window.dofus.sendMessage("GuildInvitationAnswerMessage", {
                        accept: !1
                    })
                }
            })
        }),
        e.on("GuildInvitationStateRecrutedMessage", function(e) {
            if (e.invitationState === d.SOCIAL_GROUP_INVITATION_CANCELED)
                return p.close("confirm")
        }),
        e.on("GuildInvitedMessage", function(e) {
            window.gui.openConfirmPopup({
                title: c("ui.common.invitation"),
                message: c("ui.social.aInvitYouInGuild", e.recruterName, e.guildInfo.guildName),
                cb: function(e) {
                    window.dofus.sendMessage("GuildInvitationAnswerMessage", {
                        accept: e
                    })
                }
            })
        }),
        e.on("GuildInformationsPaddocksMessage", function(e) {
            t.current && (t.current.paddocks = e.paddocksInformations || [],
            t.emit("guildPaddockUpdate"))
        }),
        e.on("GuildPaddockBoughtMessage", function(e) {
            t.current && (t.current.paddocks || (t.current.paddocks = []),
            t.current.paddocks.push(e.paddockInfo),
            t.emit("guildPaddockBought", e.paddockInfo))
        }),
        e.on("GuildPaddockRemovedMessage", function(e) {
            if (t.current && t.current.paddocks) {
                var i = e.paddockId;
                u.removeObjectInArrayById(t.current.paddocks, "paddockId", i) && t.emit("guildPaddockRemoved", i)
            }
        }),
        e.on("GuildHousesInformationMessage", function(e) {
            t.current && (t.current.houses = e.housesInformations || [],
            t.emit("guildHouseUpdateAll"))
        }),
        e.on("GuildHouseUpdateInformationMessage", function(e) {
            t.current && (t.current.houses || (t.current.houses = []),
            t.current.houses.push(e.housesInformations),
            t.emit("guildHouseUpdateInfo", e.housesInformations))
        }),
        e.on("GuildHouseRemoveMessage", function(e) {
            if (t.current && t.current.houses) {
                var i = e.houseId;
                u.removeObjectInArrayById(t.current.houses, "houseId", i) && t.emit("guildHouseRemoved", i)
            }
        }),
        e.on("MoodSmileyUpdateMessage", function(e) {
            var i = t.current && t.current.members[e.playerId];
            i && (i.moodSmileyId = e.smileyId,
            t.emit("guildMember", t.current.getMembersByRank()))
        }),
        e.on("MoodSmileyResultMessage", function(e) {
            if (e.resultCode === f.MOOD_OK) {
                var i = t.current && t.current.members[window.gui.playerData.id];
                i && (i.moodSmileyId = e.smileyId,
                t.emit("guildMember", t.current.getMembersByRank()))
            }
        })
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.objects = {},
        this.isLoaded = !1,
        this.presets = {},
        this.kamas = 0,
        this.goultines = 0,
        this.weight = 0,
        this.maxWeight = 0,
        this.quantityList = {},
        this.equippedItems = {},
        this._lastUpdatedPosition = {}
    }
    var o = i(16).EventEmitter
      , s = i(210)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(530)
      , c = i(323)
      , u = i(84).playUiSound
      , h = c.positions
      , d = i(531)
      , p = i(532)
      , m = i(533)
      , f = i(534)
      , g = 113;
    r(n, o),
    e.exports = n,
    n.prototype.connect = function() {
        window.dofus.send("moneyGoultinesAmountRequest")
    }
    ,
    n.prototype.isOverloaded = function() {
        return this.weight > this.maxWeight
    }
    ,
    n.prototype.disconnect = function() {
        this.objects = {},
        this.isLoaded = !1,
        this.presets = {},
        this.weight = 0,
        this.maxWeight = 0,
        this.quantityList = {},
        this.equippedItems = {},
        this._lastUpdatedPosition = {},
        this.kamas = null ,
        this.goultines = null ,
        this.emit("unloaded")
    }
    ,
    n.prototype.initialize = function(e) {
        function t() {
            u.quantityList = {};
            for (var e in u.objects) {
                var t = u.objects[e];
                u.quantityList[t.objectGID] = t.quantity
            }
        }
        function i(e) {
            for (var i = 0, n = e.length; i < n; i += 1) {
                var o = e[i];
                u.objects[o.objectUID] = o,
                o.position !== h.notEquipped && (u.equippedItems[o.position] = o,
                o.position === h.weapon && u.emit("weaponChanged"))
            }
            t()
        }
        function n() {
            return u.isLoaded = !0,
            u.emit("loaded"),
            u.emit("listUpdate", u.objects)
        }
        function o(e) {
            u.kamas = e.kamas,
            u.emit("kamasUpdated", e.kamas);
            var t = c.createItemInstances(e.objects, function(t) {
                if (t)
                    return console.error(t);
                if (!e.presets)
                    return n();
                e.presets = e.presets || [],
                u.presets = {};
                for (var i = [], o = 0; o < e.presets.length; o += 1) {
                    var s = e.presets[o];
                    u.presets[s.presetId] = s;
                    for (var a = 0; a < s.objects.length; a += 1) {
                        var r = s.objects[a].objGid;
                        c.items[r] || i.push(r)
                    }
                }
                c.getItems(i, function(e) {
                    return e ? console.error(e) : void n()
                })
            });
            i(t)
        }
        function r(e) {
            var i = u.objects[e];
            return i ? (i.position !== h.notEquipped && (delete u.equippedItems[i.position],
            i.position === h.weapon && u.emit("weaponChanged")),
            i.emit("deleted"),
            delete u.objects[e],
            t(),
            i) : console.error("[ObjectDeletedMessage] unknown object UID")
        }
        var u = this
          , g = window.dofus.connectionManager;
        e.on("ObjectAddedMessage", function(e) {
            var t = c.createItemInstances(e.object, function(e, t) {
                return e ? console.error(e) : void u.emit("itemAdded", t.array[0])
            });
            i(t)
        }),
        e.on("ObjectsAddedMessage", function(e) {
            var t = c.createItemInstances(e.object, function(e, t) {
                return e ? console.error(e) : void u.emit("itemsAdded", t.map)
            });
            i(t)
        }),
        e.on("ObjectModifiedMessage", function(e) {
            var t = c.createItemInstances(e.object, function(t, i) {
                if (t)
                    return console.error(t);
                var n = i.array[0];
                return u.objects[e.object.objectUID] || n.livingObjectCategory ? void (n.isInitialised && (n.emit("modified"),
                u.emit("itemModified", n))) : console.error("[ObjectModifiedMessage] unknown object UID")
            });
            i(t)
        }),
        e.on("ObjectMovementMessage", function(e) {
            var t = u.objects[e.objectUID]
              , i = !1;
            if (t) {
                t.position !== h.weapon && e.position !== h.weapon || (i = !0);
                var n = t.position;
                t.position = e.position,
                u.equippedItems[n] && delete u.equippedItems[n],
                e.position !== h.notEquipped && (u.equippedItems[e.position] = t),
                t.isInitialised && (i && u.emit("weaponChanged"),
                t.emit("moved"),
                u.emit("itemMoved", t, n, e.position))
            }
        }),
        e.on("InventoryContentMessage", o),
        e.on("InventoryContentAndPresetMessage", o),
        e.on("InventoryPresetDeleteResultMessage", function(e) {
            switch (e.code) {
            case d.PRESET_DEL_OK:
                delete u.presets[e.presetId],
                u.emit("presetDeleted", e.presetId);
                break;
            case d.PRESET_DEL_ERR_TOO_MANY:
                u.emit("presetDeleted", e.presetId, "tooMany");
                break;
            case d.PRESET_DEL_ERR_UNKNOWN:
                u.emit("presetDeleted", e.presetId, "unknown");
                break;
            case d.PRESET_DEL_ERR_BAD_PRESET_ID:
                u.emit("presetDeleted", e.presetId, "badId")
            }
        }),
        e.on("InventoryPresetSaveResultMessage", function(e) {
            switch (e.code) {
            case p.PRESET_SAVE_OK:
                u.emit("presetSaved", e.presetId);
                break;
            case p.PRESET_SAVE_ERR_TOO_MANY:
                u.emit("presetSaved", e.presetId, "tooMany");
                break;
            case p.PRESET_SAVE_ERR_UNKNOWN:
                u.emit("presetSaved", e.presetId, "unknown")
            }
        }),
        e.on("InventoryPresetUseResultMessage", function(e) {
            switch (e.code) {
            case f.PRESET_USE_OK:
                u.emit("presetUsed", e.presetId);
                break;
            case f.PRESET_USE_OK_PARTIAL:
                u.emit("presetUsed", e.presetId, "usePartial");
                break;
            case f.PRESET_USE_ERR_UNKNOWN:
                u.emit("presetUsed", e.presetId, "unknown");
                break;
            case f.PRESET_USE_ERR_CRITERION:
                u.emit("presetUsed", e.presetId, "criterion");
                break;
            case f.PRESET_USE_ERR_BAD_PRESET_ID:
                u.emit("presetUsed", e.presetId, "badId")
            }
        }),
        e.on("InventoryPresetUpdateMessage", function(e) {
            u.presets[e.preset.presetId] = e.preset,
            u.emit("presetUpdated", e.preset.presetId)
        }),
        e.on("InventoryPresetItemUpdateMessage", function(e) {
            for (var t = u.presets[e.presetId], i = 0; i < t.objects.length; i += 1)
                if (t.objects[i].position === e.presetItem.position) {
                    t.objects[i] = e.presetItem;
                    break
                }
            u.emit("presetItemUpdated", e.presetId)
        }),
        e.on("InventoryPresetItemUpdateErrorMessage", function(e) {
            switch (e.code) {
            case m.PRESET_UPDATE_ERR_UNKNOWN:
                u.emit("presetItemUpdateError", "unknown");
                break;
            case m.PRESET_UPDATE_ERR_BAD_PRESET_ID:
                u.emit("presetItemUpdateError", "badId");
                break;
            case m.PRESET_UPDATE_ERR_BAD_POSITION:
                u.emit("presetItemUpdateError", "badPosition");
                break;
            case m.PRESET_UPDATE_ERR_BAD_OBJECT_ID:
                u.emit("presetItemUpdateError", "badObjectId")
            }
        }),
        e.on("InventoryWeightMessage", function(e) {
            u.weight = e.weight,
            u.maxWeight = e.weightMax,
            u.emit("weightUpdated", e.weight, e.weightMax)
        }),
        g.on("ObjectsQuantityMessage", function(e) {
            for (var i = {}, n = 0, o = e.objectsUIDAndQty.length; n < o; n += 1) {
                var s = e.objectsUIDAndQty[n]
                  , a = u.objects[s.objectUID];
                a.quantity = s.quantity,
                a.isInitialised && (i[s.objectUID] = s.quantity,
                a.emit("quantityUpdated"))
            }
            t(),
            u.emit("itemsQuantity", i)
        }),
        g.on("ObjectQuantityMessage", function(e) {
            var i = u.objects[e.objectUID];
            i.quantity = e.quantity,
            t(),
            i.isInitialised && (i.emit("quantityUpdated"),
            u.emit("itemQuantity", e.objectUID, e.quantity))
        }),
        g.on("ObjectsDeletedMessage", function(e) {
            for (var t = {}, i = 0, n = e.objectUID.length; i < n; i += 1) {
                var o = e.objectUID[i];
                t[o] = r(o)
            }
            u.emit("itemsDeleted", e.objectUID, t)
        }),
        g.on("ObjectDeletedMessage", function(e) {
            var t = r(e.objectUID);
            u.emit("itemDeleted", e.objectUID, t)
        }),
        g.on("ObjectErrorMessage", function(t) {
            var i;
            switch (t.reason) {
            case l.INVENTORY_FULL:
                i = a("ui.objectError.InventoryFull");
                break;
            case l.CANNOT_EQUIP_TWICE:
                i = a("ui.objectError.CannotEquipTwice");
                break;
            case l.CANNOT_DROP:
                i = a("ui.objectError.CannotDrop");
                break;
            case l.CANNOT_DROP_NO_PLACE:
                i = a("ui.objectError.CannotDropNoPlace");
                break;
            case l.CANNOT_DESTROY:
                i = a("ui.objectError.CannotDelete");
                break;
            case l.LEVEL_TOO_LOW:
                i = a("ui.objectError.levelTooLow");
                break;
            case l.LIVING_OBJECT_REFUSED_FOOD:
                i = a("ui.objectError.LivingObjectRefusedFood")
            }
            i && e.chat.logError(i)
        }),
        e.on("KamasUpdateMessage", function(e) {
            s.storeValueAndEmit(u, u, "kamas", e.kamasTotal, "kamasUpdated")
        }),
        e.on("CharacterStatsListMessage", function(e) {
            s.storeValueAndEmit(u, u, "kamas", e.stats.kamas, "kamasUpdated")
        }),
        g.on("moneyGoultinesAmountSuccess", function(e) {
            s.storeValueAndEmit(u, u, "goultines", e.goultinesAmount, "goultinesUpdated")
        })
    }
    ,
    n.prototype.getCurrentWeapon = function() {
        return this.equippedItems[h.weapon]
    }
    ;
    var _ = {
        0: "EQUIP_NECKLACE",
        1: "EQUIP_WEAPON",
        2: "EQUIP_WRISTBAND",
        3: "EQUIP_ACCESORIES",
        4: "EQUIP_WRISTBAND",
        5: "EQUIP_BOOTS",
        6: "EQUIP_CLOTH_2",
        7: "EQUIP_CLOTH_1",
        8: "EQUIP_PET",
        9: "EQUIP_DOFUS",
        10: "EQUIP_DOFUS",
        11: "EQUIP_DOFUS",
        12: "EQUIP_DOFUS",
        13: "EQUIP_DOFUS",
        14: "EQUIP_DOFUS",
        15: "EQUIP_HAND",
        16: "EQUIP_PET"
    };
    n.prototype._equip = function(e, t, i) {
        this._lastUpdatedPosition[i.superTypeId] = e,
        window.dofus.sendMessage("ObjectSetPositionMessage", {
            objectUID: t.objectUID,
            position: e,
            quantity: 1
        });
        var n = _[e];
        n && u(n)
    }
    ,
    n.prototype.equipItem = function(e, t) {
        var i = this.objects[e];
        if (i && i.position === h.notEquipped) {
            var n = i.item
              , o = n.type;
            if (o.category === c.categories.equipment) {
                if (n.typeId === g)
                    return this._equip(t, i, o);
                var s = o.possiblePositions;
                if (s.length) {
                    if (t && s.indexOf(t) !== -1)
                        return this._equip(t, i, o);
                    var a, r, l, u, d = this.equippedItems;
                    if (9 !== o.id || i.belongsToSet)
                        for (a = 0,
                        r = s.length; a < r; a += 1)
                            if (l = s[a],
                            u = d[l],
                            u && u.objectGID === i.objectGID)
                                return this._equip(l, i, o);
                    for (a = 0,
                    r = s.length; a < r; a += 1)
                        if (l = s[a],
                        !d[l])
                            return this._equip(l, i, o);
                    var p = this._lastUpdatedPosition[o.superTypeId] || 0
                      , m = p < s.length - 1 ? p + 1 : 0;
                    this._equip(s[m], i, o)
                }
            }
        }
    }
    ,
    n.prototype.unEquipItem = function(e) {
        var t = this.objects[e];
        t && t.position !== h.notEquipped && (window.isoEngine.actionQueue.isActive() || window.dofus.sendMessage("ObjectSetPositionMessage", {
            objectUID: e,
            position: h.notEquipped,
            quantity: 1
        }))
    }
    ,
    n.prototype.confirmDestroyItem = function(e, t) {
        window.gui.openConfirmPopup({
            title: a("ui.common.delete.item"),
            message: a("ui.common.doYouDestroy", t, e.item.nameId),
            cb: function(i) {
                i && window.dofus.sendMessage("ObjectDeleteMessage", {
                    objectUID: e.objectUID,
                    quantity: t
                })
            }
        })
    }
    ,
    n.prototype.getGenericItemCount = function(e) {
        var t = this.objects
          , i = 0;
        for (var n in t) {
            var o = t[n];
            o.objectGID === e && (i += o.quantity)
        }
        return i
    }
    ,
    n.prototype.isGenericItemEquipped = function(e) {
        var t = this.objects;
        for (var i in t) {
            var n = t[i];
            if (n.objectGID === e && n.position !== h.notEquipped)
                return !0
        }
        return !1
    }
}
, function(e, t) {
    e.exports = {
        INVENTORY_FULL: 1,
        CANNOT_EQUIP_TWICE: 2,
        NOT_TRADABLE: 3,
        CANNOT_DROP: 4,
        CANNOT_DROP_NO_PLACE: 5,
        CANNOT_DESTROY: 6,
        LEVEL_TOO_LOW: 7,
        LIVING_OBJECT_REFUSED_FOOD: 8,
        CANNOT_UNEQUIP: 9,
        CANNOT_EQUIP_HERE: 10,
        CRITERIONS: 11,
        MIMICRY_OBJECT_ERROR: 12
    }
}
, function(e, t) {
    e.exports = {
        PRESET_DEL_OK: 1,
        PRESET_DEL_ERR_UNKNOWN: 2,
        PRESET_DEL_ERR_BAD_PRESET_ID: 3
    }
}
, function(e, t) {
    e.exports = {
        PRESET_SAVE_OK: 1,
        PRESET_SAVE_ERR_UNKNOWN: 2,
        PRESET_SAVE_ERR_TOO_MANY: 3
    }
}
, function(e, t) {
    e.exports = {
        PRESET_UPDATE_ERR_UNKNOWN: 1,
        PRESET_UPDATE_ERR_BAD_PRESET_ID: 2,
        PRESET_UPDATE_ERR_BAD_POSITION: 3,
        PRESET_UPDATE_ERR_BAD_OBJECT_ID: 4
    }
}
, function(e, t) {
    e.exports = {
        PRESET_USE_OK: 1,
        PRESET_USE_OK_PARTIAL: 2,
        PRESET_USE_ERR_UNKNOWN: 3,
        PRESET_USE_ERR_CRITERION: 4,
        PRESET_USE_ERR_BAD_PRESET_ID: 5
    }
}
, function(e, t, i) {
    function n() {
        c = {},
        u = {},
        h = {},
        d = {
            Jobs: c,
            Skills: u,
            Recipes: h
        }
    }
    function o(e, t, i) {
        return t.length ? void g.getDataMap(e, t, function(t, n) {
            if (t)
                return i(t);
            var o = d[e];
            for (var s in n)
                o[s] = n[s];
            i()
        }) : i()
    }
    function s(e, t) {
        o("Skills", e, function(i) {
            if (i)
                return t(i);
            for (var n = {}, s = 0, a = e.length; s < a; s += 1) {
                var r = u[e[s]];
                if (r && r.craftableItemIds)
                    for (var l = 0, c = r.craftableItemIds.length; l < c; l += 1) {
                        var d = r.craftableItemIds[l];
                        h[d] || (n[d] = !0)
                    }
            }
            o("Recipes", Object.keys(n), function(i) {
                if (i)
                    return t(i);
                for (var n = 0, o = e.length; n < o; n += 1) {
                    var s = u[e[n]];
                    if (s && s.craftableItemIds) {
                        s.recipes = [];
                        for (var a = 0, r = s.craftableItemIds.length; a < r; a += 1) {
                            var l = s.craftableItemIds[a];
                            h[l] && s.recipes.push(h[l])
                        }
                    }
                }
                t()
            })
        })
    }
    function a() {
        g.getDataMap("Npcs", w, function(e, t) {
            if (e)
                return console.error("Failed to get the name of the job npcs", e);
            for (var i in t)
                b[i] = t[i].nameId
        })
    }
    function r(e, t, i) {
        for (var n = {}, a = {}, r = 0, l = e.length; r < l; r += 1) {
            var h = e[r]
              , d = h.jobId
              , p = t[d];
            p || (p = t[d] = {
                id: d
            }),
            p.description = h,
            c[d] || (n[d] = !0);
            for (var m = 0, f = h.skills.length; m < f; m += 1) {
                var g = h.skills[m].skillId;
                u[g] || (a[g] = !0)
            }
        }
        o("Jobs", Object.keys(n), function(e) {
            return e ? i(e) : void s(Object.keys(a), function(e) {
                if (e)
                    return i(e);
                for (var n in t) {
                    var o = t[n];
                    o.info = c[o.id];
                    for (var s = 0, a = o.description.skills.length; s < a; s += 1) {
                        var r = o.description.skills[s];
                        r.info = u[r.skillId]
                    }
                }
                i()
            })
        })
    }
    function l() {
        p.call(this),
        this.SKILLID_WRAP_GIFT = 209,
        this.SKILLID_DECRAFT = 181,
        this.ITEMID_MAGIC_FRAGMENT = 8378,
        this.RUNE_SIGNATURE_GID = 7508,
        this.MAX_CRAFT_SLOTS = 8,
        this.list = {},
        this._publicMode = !1,
        this._playersMultiCraftSkillById = {},
        this._availableSlots = 0,
        this._onCraftTable = {}
    }
    var c, u, h, d, p = i(16).EventEmitter, m = i(35).getText, f = i(26).inherits, g = i(36), _ = i(323), v = i(210), y = i(84).playUiSound, w = [601, 849], b = {};
    f(l, p),
    e.exports = l,
    l.prototype.disconnect = function() {
        n(),
        this.list = {},
        this._publicMode = !1,
        this._playersMultiCraftSkillById = {},
        this._availableSlots = 0,
        this._onCraftTable = {}
    }
    ,
    l.prototype.clearAfterCraft = function() {
        this._onCraftTable = {}
    }
    ,
    l.prototype.initialize = function(e) {
        function t(e, t) {
            var i;
            i = t ? m("ui.craft.referenceAdd", e.nameId) : m("ui.craft.referenceRemove", e.nameId),
            window.gui.chat.logMsg(i)
        }
        function i(e) {
            var t = o.list[e.jobId];
            t || (t = {},
            o.list[e.jobId] = t),
            t.experience = e
        }
        var o = this;
        n(),
        a();
        var s = v.createFifo();
        e.on("JobDescriptionMessage", function(e) {
            s.push(function(t) {
                r(e.jobsDescription, o.list, function(i) {
                    if (i)
                        return t(i);
                    o.jobOriginalOrder = [];
                    for (var n = 0; n < e.jobsDescription.length; n++)
                        o.jobOriginalOrder.push(e.jobsDescription[n].jobId);
                    o.emit("jobListUpdated"),
                    t()
                })
            })
        }),
        e.on("JobCrafterDirectorySettingsMessage", function(e) {
            s.push(function(t) {
                o.craftersSettings = e.craftersSettings,
                t()
            })
        }),
        e.on("JobListedUpdateMessage", function(e) {
            s.push(function(i) {
                var n = o.list[e.jobId];
                return n ? (t(n.info, e.addedOrDeleted),
                i()) : void g.getData("Jobs", e.jobId, function(n, o) {
                    return n ? i(n) : (t(o, e.addedOrDeleted),
                    void i())
                })
            })
        }),
        e.on("JobExperienceUpdateMessage", function(e) {
            s.push(function(t) {
                i(e.experiencesUpdate);
                var n = e.experiencesUpdate.jobId;
                o.emit("jobExperienceUpdate", o.getJobExperience(n)),
                t()
            })
        }),
        e.on("JobExperienceMultiUpdateMessage", function(e) {
            s.push(function(t) {
                for (var n = 0, s = e.experiencesUpdate.length; n < s; n += 1) {
                    i(e.experiencesUpdate[n]);
                    var a = e.experiencesUpdate[n].jobId;
                    o.emit("jobExperienceUpdate", o.getJobExperience(a))
                }
                t()
            })
        }),
        e.on("JobLevelUpMessage", function(e) {
            s.push(function(t) {
                r([e.jobsDescription], o.list, function(i) {
                    if (i)
                        return t(i);
                    var n = e.newLevel
                      , s = o.list[e.jobsDescription.jobId];
                    s.experience.jobLevel = n;
                    var a = m("ui.craft.newJobLevel", s.info.nameId, n);
                    window.gui.chat.logMsg(a),
                    window.gui.openSimplePopup(a, m("ui.common.informations")),
                    y("LEVEL_UP"),
                    o.emit("jobLevelUp", s, n),
                    t()
                })
            })
        }),
        e.on("JobUnlearntMessage", function(e) {
            s.push(function(t) {
                delete o.list[e.jobId],
                o.jobOriginalOrder.splice(o.jobOriginalOrder.indexOf(e.jobId), 1),
                o.emit("jobListUpdated"),
                t()
            })
        }),
        e.on("JobAllowMultiCraftRequestMessage", function(e) {
            s.push(function(t) {
                o._publicMode = e.enabled,
                delete o._playersMultiCraftSkillById[window.gui.playerData.id],
                o.emit("jobPublicMode", o._publicMode),
                t()
            })
        }),
        e.on("JobMultiCraftAvailableSkillsMessage", function(e) {
            s.push(function(t) {
                o._updateMultiCraftAvailableSkills(e),
                t()
            })
        }),
        e.on("CurrentMapMessage", function() {
            s.push(function(e) {
                o._playersMultiCraftSkillById = {},
                e()
            })
        })
    }
    ,
    l.prototype._isOnTheTable = function(e) {
        var t = this._onCraftTable;
        if (!e)
            return !1;
        if (e === this.RUNE_SIGNATURE_GID)
            return !0;
        for (var i in t)
            if (e === t[i].GID)
                return !0;
        return !1
    }
    ,
    l.prototype.addToCraft = function(e) {
        var t = this._onCraftTable
          , i = e.objectUID
          , n = e.objectGID
          , o = e.quantity
          , s = this._isOnTheTable(n);
        return t[i] || (t[i] = {
            GID: n,
            quantity: 0
        }),
        t[i].quantity = o,
        s
    }
    ,
    l.prototype.getCraftTable = function() {
        return this._onCraftTable
    }
    ,
    l.prototype.removeToCraft = function(e) {
        var t = this._onCraftTable[e]
          , i = t && t.GID;
        return delete this._onCraftTable[e],
        this._isOnTheTable(i)
    }
    ,
    l.prototype.moveItemBetweenCrafAndInventory = function(e, t, i, n) {
        function o() {
            return !a._isOnTheTable(t)
        }
        function s() {
            return t !== a.RUNE_SIGNATURE_GID && a._availableSlots <= 0
        }
        var a = this;
        o() && s() && n || a._onCraftTable[e] && t === this.RUNE_SIGNATURE_GID && n || window.dofus.sendMessage("ExchangeObjectMoveMessage", {
            objectUID: e,
            quantity: n ? i : -i
        })
    }
    ,
    l.prototype.setAvailableSlots = function(e) {
        e < 0 && (e = 0),
        e > this.MAX_CRAFT_SLOTS && (e = this.MAX_CRAFT_SLOTS),
        this._availableSlots = e
    }
    ,
    l.prototype.getAvailableSlots = function() {
        return this._availableSlots
    }
    ,
    l.prototype.getUsedSlots = function() {
        var e = this._onCraftTable || {}
          , t = {};
        for (var i in e) {
            var n = e[i];
            t[n.GID] = !0
        }
        return Object.keys(t).length
    }
    ,
    l.prototype.prepareSkillRecipes = function(e, t) {
        s([e], t)
    }
    ,
    l.prototype.getRecipesBySkill = function(e) {
        return u[e].recipes
    }
    ,
    l.prototype.getSkill = function(e) {
        return u[e]
    }
    ,
    l.prototype.getStorageCraftFilterMap = function(e, t) {
        for (var i = this._getRecipeByNbIngredient(e, 1, t), n = {}, o = 0, s = i.length; o < s; o += 1)
            for (var a = i[o].ingredientIds, r = 0, l = a.length; r < l; r += 1) {
                var c = a[r];
                n[c] = !0
            }
        return n[this.RUNE_SIGNATURE_GID] = !0,
        n
    }
    ,
    l.prototype._getRecipeByNbIngredient = function(e, t, i) {
        i = i || t;
        for (var n = this.getRecipesBySkill(e), o = [], s = 0, a = n.length; s < a; s += 1) {
            var r = n[s]
              , l = r.ingredientIds.length;
            l >= t && l <= i && o.push(r)
        }
        return o
    }
    ,
    l.prototype._getRecipesWithItemsOnCraftTable = function(e) {
        function t() {
            var e = {};
            for (var t in i._onCraftTable) {
                var n = i._onCraftTable[t]
                  , o = n.GID
                  , s = n.quantity;
                o !== i.RUNE_SIGNATURE_GID && (e[o] || (e[o] = 0),
                e[o] += s)
            }
            return e
        }
        for (var i = this, n = [], o = t(), s = Object.keys(o).length, a = this._getRecipeByNbIngredient(e, s), r = 0, l = a.length; r < l; r += 1) {
            var c = a[r]
              , u = !0;
            for (var h in o) {
                for (var d = parseInt(h, 10), p = o[d], m = !1, f = 0, g = c.ingredientIds.length; f < g; f += 1) {
                    var _ = c.ingredientIds[f]
                      , v = c.quantities[f];
                    if (d === _ && p === v) {
                        m = !0;
                        break
                    }
                }
                if (!m) {
                    u = !1;
                    break
                }
            }
            u && n.push(c)
        }
        return n
    }
    ,
    l.prototype.checkRecipe = function(e) {
        var t, i = !1, n = this._getRecipesWithItemsOnCraftTable(e);
        return 1 === n.length ? (t = n[0],
        i = !0) : e === this.SKILLID_DECRAFT && (i = !0,
        t = {
            resultId: this.ITEMID_MAGIC_FRAGMENT,
            resultLevel: 1,
            ingredientIds: [],
            quantities: []
        }),
        {
            isRecipeKnown: i,
            itemToCraft: t
        }
    }
    ,
    l.prototype._updateMultiCraftAvailableSkills = function(e) {
        var t = this
          , i = e.playerId
          , n = e.skills
          , s = {};
        if (!e.enabled)
            return void delete this._playersMultiCraftSkillById[i];
        for (var a = [], r = 0, l = n.length; r < l; r += 1) {
            var c = n[r];
            u[c] || a.push(c)
        }
        o("Skills", a, function(e) {
            if (e)
                return console.error("JobData: Cannot get missing skills for ids", a, e);
            for (var o = 0, r = n.length; o < r; o += 1) {
                var l = n[o]
                  , c = u[l];
                c ? s[l] = c : console.warn("JobsData: No data for skillId", l)
            }
            t._playersMultiCraftSkillById[i] = s
        })
    }
    ,
    l.prototype.playersMultiCraftSkillById = function(e) {
        return this._playersMultiCraftSkillById[e]
    }
    ,
    l.prototype.getToolFromJob = function(e, t) {
        var i = c[e];
        if (!i)
            return t(new Error("noJobForThatId " + e));
        var n = i.toolIds;
        if (!n || n.length <= 0)
            return t();
        var o = null ;
        _.getItems(n, function(e) {
            if (e)
                return t(e);
            for (var i = 0, s = n.length; i < s; i += 1) {
                var a = n[i]
                  , r = _.items[a];
                if (r) {
                    var l = r.nameId;
                    l.indexOf("WIP") === -1 && 0 !== r.iconId && (!o || o.level > r.level || o.level === r.level && o.objectGID > a) && (o = r,
                    o.objectGID = a)
                }
            }
            return t(null , o)
        })
    }
    ,
    l.prototype.getMaxSlotsByJobId = function(e) {
        var t = this.list[e]
          , i = 0;
        if (!t)
            return 0;
        for (var n = t.description.skills, o = 0, s = n.length; o < s; o += 1) {
            var a = n[o].maxSlots;
            a && a > i && (i = a)
        }
        return i
    }
    ,
    l.prototype.getUsableSkillsInMap = function(e, t) {
        var i = [];
        if (!t)
            return i;
        var n = this.playersMultiCraftSkillById(e);
        if (!n)
            return i;
        var o = {};
        for (var s in t)
            for (var a = t[s], r = a.enabledSkills, l = a.disabledSkills, c = r.concat(l), u = 0, h = c.length; u < h; u += 1) {
                var d = c[u].skillId;
                n[d] && !o[d] && (i.push(n[d]),
                o[d] = !0)
            }
        return i
    }
    ,
    l.prototype.getJobNpcNameById = function(e) {
        return b[e]
    }
    ,
    l.prototype.getJobExperience = function(e) {
        var t = this.list[e];
        if (!t)
            return null ;
        var i = t.experience || {}
          , n = {
            jobId: e
        };
        return n.currentLevel = i.jobLevel,
        n.currentExperience = i.jobXP,
        n.levelExperienceFloor = i.jobXpLevelFloor,
        n.levelExperienceCeil = i.jobXpNextLevelFloor,
        n.percentage = 100,
        n.levelExperienceCeil && (n.percentage = Math.floor((n.currentExperience - n.levelExperienceFloor) / (n.levelExperienceCeil - n.levelExperienceFloor) * 100)),
        n
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.finishedAchievementsIds = [],
        this.rewardableAchievements = {},
        this.points = 0
    }
    var o = i(29).EventEmitter
      , s = i(26).inherits
      , a = i(35).getText
      , r = 1.5
      , l = .7;
    s(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this.finishedAchievementsIds = [],
        this.rewardableAchievements = {},
        this.points = 0
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("AchievementListMessage", function(e) {
            var i = e.enrichData.points;
            t.finishedAchievementsIds = e.finishedAchievementsIds;
            for (var n = 0; n < e.rewardableAchievements.length; n++)
                t.finishedAchievementsIds.push(e.rewardableAchievements[n].id),
                t.rewardableAchievements[e.rewardableAchievements[n].id] = e.rewardableAchievements[n];
            t.points = i,
            t.emit("achievementListUpdated", e)
        }),
        e.on("AchievementFinishedMessage", function(e) {
            window.gui.chat.logMsg(a("ui.achievement.achievementUnlockWithLink", e.id));
            var i = e.enrichData.points;
            t.finishedAchievementsIds.push(e.id),
            t.rewardableAchievements[e.id] = e,
            t.points += i,
            t.emit("achievementFinished", e)
        }),
        e.on("AchievementRewardSuccessMessage", function(e) {
            delete t.rewardableAchievements[e.achievementId],
            t.emit("achievementRewardSuccess", e.achievementId)
        })
    }
    ,
    n.prototype.getAchievementKamasReward = function(e, t) {
        return t || (t = window.gui.playerData.characterBaseInformations.level),
        this._getKamasReward(e, t)
    }
    ,
    n.prototype.getAchievementExperienceReward = function(e, t) {
        return t || (t = t || window.gui.playerData.characterBaseInformations.level),
        this._getExperienceReward(e, t)
    }
    ,
    n.prototype._getKamasReward = function(e, t) {
        if (!e)
            return 0;
        var i = e.kamasScaleWithPlayerLevel ? t : e.level;
        return Math.floor((Math.pow(i, 2) + 20 * i - 20) * e.kamasRatio)
    }
    ,
    n.prototype._getExperienceReward = function(e, t) {
        function i(e, t) {
            return Math.floor(e * Math.pow(100 + 2 * e, 2) / 20 * t)
        }
        var n = window.gui.playerData.experienceFactor;
        if (!e)
            return 0;
        var o = 1 + n / 100
          , s = e.level
          , a = e.experienceRatio;
        if (t > s) {
            var c = Math.floor(Math.min(t, s * r))
              , u = i(s, a)
              , h = i(c, a)
              , d = (1 - l) * u
              , p = l * h;
            return Math.floor((d + p) * o)
        }
        var m = i(t, a);
        return Math.floor(m * o)
    }
    ,
    n.prototype.completedData = function(e) {
        var t = this.finishedAchievementsIds.indexOf(e) !== -1
          , i = this.rewardableAchievements[e]
          , n = {
            isCompleted: t && !i,
            finishedlevel: null
        };
        if (n.isCompleted)
            return n;
        var o = this.rewardableAchievements;
        for (var s in o) {
            var a = o[s];
            if (a.id === e) {
                n.isCompleted = !0,
                n.finishedlevel = a.finishedlevel;
                break
            }
        }
        return n
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this._reset()
    }
    var o = i(16).EventEmitter
      , s = i(26).inherits
      , a = i(36)
      , r = i(84)
      , l = 45;
    s(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this._reset()
    }
    ,
    n.prototype._reset = function() {
        this.mapId = 0,
        this.subAreaId = 0,
        this.worldmapId = 0,
        this.mapPosition = null ,
        this.subArea = null ,
        this.area = null ,
        this.superArea = null ,
        this.coordinates = {
            posX: 0,
            posY: 0
        },
        this.isInMyHouse = !1,
        this.currentMapHouses = {}
    }
    ,
    n.prototype.initialize = function(e) {
        function t(e) {
            o.currentMapHouses = {},
            o.emit("mapChanged", e)
        }
        function i(t, i) {
            o.mapId = t.mapId,
            a.getData("MapPositions", t.mapId, function(n, s) {
                if (n)
                    return console.warn("MapPositions error", n);
                o.mapPosition = s;
                var l = i ? i.worldX : s.posX
                  , c = i ? i.worldY : s.posY;
                return o.coordinates.posX = l,
                o.coordinates.posY = c,
                o.subArea && o.subArea.id === t.subAreaId && o.subAreaId === t.subAreaId ? (o.emit("mapUpdate"),
                void r.mapChange(o.subArea.ambientSounds, s.sounds)) : (o.subAreaId = t.subAreaId,
                void a.getData("SubAreas", o.subAreaId, function(t, i) {
                    if (t)
                        return console.warn("SubAreas error", t);
                    r.mapChange(i.ambientSounds, s.sounds),
                    o.subArea = i,
                    o.area = e.databases.Areas[i.areaId],
                    o.superArea = e.databases.SuperAreas[o.area.superAreaId];
                    var n = s.worldMap >= 0 ? s.worldMap : o.superArea.worldmapId;
                    o.worldmapId !== n && (o.worldmapId = n,
                    o.emit("worldMapUpdate")),
                    o.emit("mapUpdate")
                }))
            })
        }
        function n(e) {
            var t = e.currentHouse;
            if (t) {
                var i = window.gui.playerData;
                o.isInMyHouse = t.ownerId === i.identification.accountId,
                o.emit("myHouseNotification", {
                    isInMyHouse: o.isInMyHouse,
                    msg: e
                })
            } else
                !t && o.isInMyHouse && (o.isInMyHouse = !1,
                o.emit("myHouseNotification", {
                    isInMyHouse: o.isInMyHouse
                }))
        }
        var o = this;
        e.on("MapComplementaryInformationsDataMessage", function(e) {
            t(e),
            i(e),
            n(e)
        }),
        e.on("MapComplementaryInformationsWithCoordsMessage", function(e) {
            t(e),
            i(e, {
                worldX: e.worldX,
                worldY: e.worldY
            }),
            n(e)
        }),
        e.on("MapComplementaryInformationsDataInHouseMessage", function(e) {
            t(e),
            i(e, e.currentHouse),
            n(e)
        }),
        e.on("HousePropertiesMessage", function(e) {
            var t = e.properties;
            if (t) {
                var i = t.houseId;
                o.currentMapHouses[i] = t
            }
        })
    }
    ,
    n.prototype.getHousePropertiesById = function(e) {
        return this.currentMapHouses[e]
    }
    ,
    n.prototype.isInIncarnam = function() {
        return this.area ? this.area.id === l : (console.warn("isInIncarnam called before we know our area"),
        !1)
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this._reset()
    }
    var o = i(16).EventEmitter
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(539)
      , l = i(412)
      , c = i(502)
      , u = i(540)
      , h = i(541);
    s(n, o),
    e.exports = n,
    n.prototype.disconnect = function() {
        this._reset()
    }
    ,
    n.prototype._reset = function() {
        this.arenaStats = {},
        this.arenaRegistered = !1,
        this.arenaStep = u.ARENA_STEP_UNREGISTER,
        this.followedId = null ,
        this.pendingInvitations = {},
        this.partyList = {},
        this.partyTypes = {
            1: {
                id: null ,
                members: {},
                leaderId: null
            },
            3: {
                id: null ,
                members: {},
                leaderId: null
            }
        },
        this._partyFights = {}
    }
    ,
    n.prototype.getPartyTypeFromId = function(e) {
        return this.partyList[e] || 0
    }
    ,
    n.prototype.getMemberName = function(e, t) {
        var i = window.gui.playerData;
        if (t === i.id)
            return i.characterBaseInformations.name;
        var n = this.partyTypes[e];
        if (!n)
            return "?";
        var o = n.members[t];
        return o ? o.name : "?"
    }
    ,
    n.prototype._enrichGuestInfo = function(e) {
        e.isGuest = !0,
        e.level = "?",
        e.id = e.guestId,
        e.entityLook = e.guestLook
    }
    ,
    n.prototype.initialize = function(e) {
        function t(e) {
            var t = e.partyId;
            delete n.pendingInvitations[t];
            var i = n.getPartyTypeFromId(t)
              , o = n.partyTypes[i];
            o && (o.id = null ,
            o.leaderId = null ,
            o.members = {},
            delete n.partyList[t],
            i === l.PARTY_TYPE_ARENA && n.emit("arenaLeft"),
            n.emit("partyLeft", e.partyId))
        }
        function i(e) {
            n.emit("partyMemberLeft", e.partyId, e.leavingPlayerId);
            var t = n.getPartyTypeFromId(e.partyId)
              , i = n.partyTypes[t];
            i && (delete i.members[e.leavingPlayerId],
            t === l.PARTY_TYPE_ARENA && n.emit("arenaMemberLeft", e.leavingPlayerId))
        }
        var n = this;
        e.on("PartyInvitationDetailsMessage", function(e) {
            for (var t = 0; t < e.guests.length; t++)
                n._enrichGuestInfo(e.guests[t]);
            n.emit("partyInvitationDetails", e)
        }),
        e.on("PartyNewGuestMessage", function(e) {
            n._enrichGuestInfo(e.guest);
            var t = e.guest;
            n.pendingInvitations[e.partyId] || (n.pendingInvitations[e.partyId] = {}),
            n.pendingInvitations[e.partyId][t.guestId] = {
                hostId: t.hostId,
                guestName: t.name,
                guestId: t.guestId
            },
            n.emit("partyNewGuest", e.partyId, t)
        }),
        e.on("PartyNewMemberMessage", function(e) {
            var t = e.memberInformations
              , i = n.pendingInvitations[e.partyId];
            i && delete i[t.id];
            var o = n.getPartyTypeFromId(e.partyId)
              , s = n.partyTypes[o];
            s && (s.members[t.id] = {
                name: t.name
            },
            o === l.PARTY_TYPE_ARENA && n.emit("arenaNewMember", t)),
            n.emit("partyNewMember", e.partyId, t)
        }),
        e.on("PartyUpdateMessage", function(e) {
            n.emit("partyUpdateMember", e.partyId, e.memberInformations)
        }),
        e.on("PartyDeletedMessage", t),
        e.on("PartyLeaveMessage", t),
        e.on("PartyKickedByMessage", t),
        e.on("PartyCancelInvitationNotificationMessage", function(t) {
            n.emit("partyGuestLeft", t.partyId, t.guestId);
            var i = n.pendingInvitations[t.partyId];
            if (i) {
                var o = i[t.guestId]
                  , s = e.playerData.characterBaseInformations.name
                  , r = a("ui.party.invitationCancelled", s, o.guestName);
                e.chat.logMsg(r),
                delete n.pendingInvitations[t.partyId][t.guestId]
            }
        }),
        e.on("PartyInvitationCancelledForGuestMessage", function(e) {
            n.emit("partyInvitationCancelled", e.partyId)
        }),
        e.on("PartyJoinMessage", function(t) {
            var i = n.partyTypes[t.partyType];
            if (i) {
                for (var o = e.playerData, s = t.members, a = 0; a < s.length; a += 1) {
                    var r = s[a];
                    r.id !== o.id && (i.members[r.id] = {
                        name: r.name
                    })
                }
                var c = t.guests;
                for (!n.pendingInvitations[t.partyId] && c.length && (n.pendingInvitations[t.partyId] = {}),
                a = 0; a < c.length; a += 1) {
                    var u = c[a];
                    n.pendingInvitations[t.partyId][u.guestId] = {
                        hostId: u.hostId,
                        guestName: u.name,
                        guestId: u.guestId
                    }
                }
                i.id = t.partyId,
                i.leaderId = t.partyLeaderId,
                n.partyList[t.partyId] = t.partyType,
                t.partyType === l.PARTY_TYPE_ARENA && n.emit("arenaJoined")
            }
        }),
        e.on("PartyMemberRemoveMessage", i),
        e.on("PartyMemberEjectedMessage", i),
        e.on("PartyLeaderUpdateMessage", function(e) {
            n.emit("partyLeaderUpdated", e.partyId, e.partyLeaderId);
            var t = n.getPartyTypeFromId(e.partyId)
              , i = n.partyTypes[t];
            i && (i.leaderId = e.partyLeaderId,
            t === l.PARTY_TYPE_ARENA && n.emit("arenaLeaderUpdate", e.partyLeaderId))
        }),
        e.on("PartyRefuseInvitationNotificationMessage", function(e) {
            n.emit("partyGuestLeft", e.partyId, e.guestId),
            n.pendingInvitations[e.partyId] && delete n.pendingInvitations[e.partyId][e.guestId]
        }),
        e.on("PartyFollowStatusUpdateMessage", function(e) {
            e.success && (n.followedId = e.followedId)
        }),
        e.on("GameRolePlayArenaRegistrationStatusMessage", function(e) {
            n.arenaStep = e.step,
            n.arenaRegistered = e.registered,
            1 !== e.step || e.registered || (n.nbArenaFigthersReady = 0),
            n.emit("arenaRegistrationStatus")
        }),
        e.on("GameFightJoinMessage", function(e) {
            e.fightType !== c.FIGHT_TYPE_PVP_ARENA || e.isSpectator || (n.arenaStep = u.ARENA_STEP_STARTING_FIGHT,
            n.arenaRegistered = !1,
            n.emit("arenaRegistrationStatus")),
            n._cleanPartyFightNotifications()
        }),
        e.on("GameFightEndMessage", function() {
            n.arenaStep === u.ARENA_STEP_STARTING_FIGHT && (n.arenaStep = u.ARENA_STEP_UNREGISTER,
            n.emit("arenaRegistrationStatus"),
            n.emit("arenaFightEnd"))
        }),
        e.on("GameRolePlayArenaUpdatePlayerInfosMessage", function(e) {
            n.arenaStats = {
                rank: e.rank,
                bestDailyRank: e.bestDailyRank,
                bestRank: e.bestRank,
                victoryCount: e.victoryCount,
                arenaFightCount: e.arenaFightcount
            },
            n.emit("arenaStatsUpdated")
        }),
        e.on("GameRolePlayArenaFighterStatusMessage", function(e) {
            e.accepted ? (n.nbArenaFigthersReady++,
            n.emit("arenaFighterReady", n.nbArenaFigthersReady)) : n.emit("arenaFightDeclined", e.fightId, e.playerId)
        }),
        e.on("PartyCannotJoinErrorMessage", function(e) {
            var t;
            switch (e.reason) {
            case r.PARTY_JOIN_ERROR_UNKNOWN:
                t = a("ui.party.cantInvit");
                break;
            case r.PARTY_JOIN_ERROR_PLAYER_NOT_FOUND:
                break;
            case r.PARTY_JOIN_ERROR_PARTY_NOT_FOUND:
                t = a("ui.party.cantFindParty");
                break;
            case r.PARTY_JOIN_ERROR_PARTY_FULL:
                t = a("ui.party.partyFull");
                break;
            case r.PARTY_JOIN_ERROR_PLAYER_BUSY:
                t = a("ui.party.cantInvitPlayerBusy");
                break;
            case r.PARTY_JOIN_ERROR_PLAYER_ALREADY_INVITED:
                t = a("ui.party.playerAlreayBeingInvited");
                break;
            case r.PARTY_JOIN_ERROR_PLAYER_TOO_SOLLICITED:
                t = a("ui.party.playerTooSollicited");
                break;
            case r.PARTY_JOIN_ERROR_UNMODIFIABLE:
                t = a("ui.party.partyUnmodifiable");
                break;
            case r.PARTY_JOIN_ERROR_UNMET_CRITERION:
            case r.PARTY_JOIN_ERROR_PLAYER_LOYAL:
            }
            t && this.openSimplePopup(t)
        }),
        e.on("PartyMemberInFightMessage", function(t) {
            var i = e.playerData.isFighting && !e.playerData.isSpectator;
            if (!i) {
                var o, s = t.fightMap.mapId;
                switch (t.reason) {
                case h.FIGHT_REASON_MONSTER_ATTACK:
                    o = a("ui.party.memberStartFight.monsterAttack", t.memberName, t.memberId, s);
                    break;
                case h.FIGHT_REASON_PLAYER_ATTACK:
                    o = a("ui.party.memberStartFight.playerAttack", t.memberName, t.memberId, s);
                    break;
                case h.FIGHT_REASON_MEMBER_ATTACKED_PLAYERS:
                    o = a("ui.party.memberStartFight.attackPlayer", t.memberName, t.memberId, s);
                    break;
                default:
                    o = a("ui.party.memberStartFight.unknownReason", t.memberName, t.memberId, s)
                }
                e.chat.logMsg(o);
                var r = t.secondsBeforeFightStart;
                if (n._addFightInfo(s, t.fightId, t.memberId, t.memberName, r),
                e.playerData.position.mapId === s) {
                    var l = t.memberId;
                    e.party.showPartyFightQuestion(t.fightId, l, t.memberId, t.memberName, r)
                }
            }
        }),
        e.on("GameRolePlayRemoveChallengeMessage", function(t) {
            e.party.removePartyFightQuestion(t.fightId),
            n._deleteFightInfo(e.playerData.position.mapId, t.fightId)
        }),
        e.on("MapComplementaryInformationsDataMessage", function(t) {
            n._cleanPartyFightNotifications();
            var i = n._partyFights[t.mapId];
            if (i)
                for (var o = t.fights, s = 0; s < o.length; s++) {
                    var a = i[o[s].fightId];
                    if (a) {
                        var r = a.memberId;
                        e.party.showPartyFightQuestion(a.fightId, r, a.memberId, a.memberName, a.startTime - Date.now())
                    }
                }
        })
    }
    ,
    n.prototype._addFightInfo = function(e, t, i, n, o) {
        var s = this._partyFights[e];
        s || (s = this._partyFights[e] = {}),
        s[t] = {
            fightId: t,
            memberId: i,
            memberName: n,
            startTime: Date.now() + o
        };
        var a = this;
        window.setTimeout(function() {
            a._deleteFightInfo(e, t)
        }, o)
    }
    ,
    n.prototype._deleteFightInfo = function(e, t) {
        var i = this._partyFights[e];
        i && (delete i[t],
        0 === Object.keys(i).length && delete this._partyFights[e])
    }
    ,
    n.prototype._cleanPartyFightNotifications = function() {
        for (var e in this._partyFights) {
            var t = this._partyFights[e];
            for (var i in t)
                window.gui.party.removePartyFightQuestion(i)
        }
    }
}
, function(e, t) {
    e.exports = {
        PARTY_JOIN_ERROR_UNKNOWN: 0,
        PARTY_JOIN_ERROR_PLAYER_NOT_FOUND: 1,
        PARTY_JOIN_ERROR_PARTY_NOT_FOUND: 2,
        PARTY_JOIN_ERROR_PARTY_FULL: 3,
        PARTY_JOIN_ERROR_PLAYER_BUSY: 4,
        PARTY_JOIN_ERROR_PLAYER_ALREADY_INVITED: 6,
        PARTY_JOIN_ERROR_PLAYER_TOO_SOLLICITED: 7,
        PARTY_JOIN_ERROR_PLAYER_LOYAL: 8,
        PARTY_JOIN_ERROR_UNMODIFIABLE: 9,
        PARTY_JOIN_ERROR_UNMET_CRITERION: 10
    }
}
, function(e, t) {
    e.exports = {
        ARENA_STEP_REGISTRED: 0,
        ARENA_STEP_WAITING_FIGHT: 1,
        ARENA_STEP_STARTING_FIGHT: 2,
        ARENA_STEP_UNREGISTER: 3
    }
}
, function(e, t) {
    e.exports = {
        FIGHT_REASON_UNKNOWN: 0,
        FIGHT_REASON_MONSTER_ATTACK: 1,
        FIGHT_REASON_PLAYER_ATTACK: 2,
        FIGHT_REASON_MEMBER_ATTACKED_PLAYERS: 3
    }
}
, function(e, t, i) {
    function n() {
        s.call(this),
        this._reset()
    }
    var o = i(12)
      , s = i(16).EventEmitter
      , a = i(543)
      , r = i(26).inherits
      , l = i(210).createFifo();
    r(n, s),
    e.exports = n,
    n.prototype._reset = function() {
        this.finished = {},
        this.active = {},
        this.all = {},
        this.initialized = !1
    }
    ,
    n.prototype.connect = function(e) {
        return e ? window.gui.once("GameFightStartingMessage", function() {
            window.dofus.sendMessage("QuestListRequestMessage")
        }) : void window.dofus.sendMessage("QuestListRequestMessage")
    }
    ,
    n.prototype.disconnect = function() {
        this._reset()
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("QuestListMessage", function(e) {
            o.parallel([function(i) {
                a.createFinishedQuestsMap(e.finishedQuestsIds, e.finishedQuestsCounts, function(e, n) {
                    if (e)
                        return i(e);
                    for (var o in n)
                        t.finished[o] = t.all[o] = n[o];
                    i()
                })
            }
            , function(i) {
                a.initializeActiveQuests(e.activeQuests, function(e, n) {
                    if (e)
                        return i(e);
                    for (var o in n)
                        t.active[o] = t.all[o] = n[o];
                    i()
                })
            }
            ], function(e) {
                return e ? console.error(e) : (t.initialized = !0,
                void t.emit("listUpdated"))
            })
        }),
        e.on("QuestStartedMessage", function(e) {
            delete t.finished[e.questId],
            window.dofus.sendMessage("QuestStepInfoRequestMessage", {
                questId: e.questId
            })
        }),
        e.on("QuestObjectiveValidatedMessage", function(e) {
            var i = t.active[e.questId];
            window.dofus.sendMessage("QuestStepInfoRequestMessage", {
                questId: i.questId
            });
            for (var n = 0, o = i.objectives.length; n < o; n += 1) {
                var s = i.objectives[n];
                if (s.objectiveId === e.objectiveId)
                    return s.objectiveStatus = !1,
                    t.emit("objectiveValidated", i, e.objectiveId),
                    t.emit("questUpdate", e.questId)
            }
        }),
        e.on("QuestStepInfoMessage", function(e) {
            l.push(function(i) {
                if (!e.infos.objectives)
                    return i();
                var n = e.infos;
                if (!n)
                    return i();
                var o = n.questId
                  , s = t.active[o] || n;
                s.stepId = n.stepId,
                s.objectives = n.objectives,
                s.dbQuest ? a.updateQuestObjectives(s, function(e) {
                    return e ? i(e) : (t.emit("questUpdate", s.questId),
                    void i())
                }) : a.initializeActiveQuests([s], function(e, n) {
                    return e ? i(e) : (t.active[o] = t.all[o] = n[o],
                    t.emit("questStarted", o),
                    void i())
                })
            })
        }),
        e.on("QuestStepStartedMessage", function(e) {
            var i = t.active[e.questId];
            i && (i.stepId = e.stepId,
            window.dofus.sendMessage("QuestStepInfoRequestMessage", {
                questId: i.questId
            }))
        }),
        e.on("QuestStepValidatedMessage", function(e) {
            var i = t.active[e.questId];
            if (i) {
                var n = i.dbQuest.stepIds
                  , o = n.indexOf(e.stepId);
                i.stepId = n[o + 1],
                t.emit("stepValidated", i, e.stepId),
                window.dofus.sendMessage("QuestStepInfoRequestMessage", {
                    questId: i.questId
                })
            }
        }),
        e.on("QuestValidatedMessage", function(e) {
            var i = t.active[e.questId];
            delete t.active[e.questId],
            i.finishedCount = 1,
            t.finished[e.questId] = t.all[e.questId] = i,
            t.emit("questFinished", i)
        })
    }
}
, function(e, t, i) {
    function n(e, t, i, n, o) {
        e[n.id] || (e[n.id] = [],
        o[n.id] = n.type),
        e[n.id].push(t[i])
    }
    function o(e, t) {
        for (var i = window.gui.databases.QuestObjectiveTypes, o = {}, r = {}, l = 0, d = e.length; l < d; l += 1)
            for (var p = e[l], m = p.objectives, f = 0, g = m.length; f < g; f += 1)
                for (var _ = p.dbObjectives[m[f].objectiveId], v = c[_._type], y = 0, w = v.length; y < w; y += 1) {
                    var b = v[y];
                    n(o, _.parameters, y, b, r)
                }
        s.each(Object.keys(o), function(e, t) {
            return o[e].length ? void u[r[e]](o, e, t) : t()
        }, function(n) {
            if (n)
                return t(n);
            for (var s = 0, r = e.length; s < r; s += 1)
                for (var l = e[s], u = l.objectives, d = 0, p = u.length; d < p; d += 1) {
                    for (var m = u[d], f = l.dbObjectives[m.objectiveId], g = f.parameters.slice(0), _ = c[f._type], v = 0, y = _.length; v < y; v += 1) {
                        var w = _[v];
                        h[w.type](g, o, v, w)
                    }
                    var b = i[f.typeId].nameId;
                    g.unshift(b),
                    m.text = a.apply(null , g)
                }
            t()
        })
    }
    var s = i(12)
      , a = i(35).processText
      , r = i(36)
      , l = i(544)
      , c = {
        QuestObjectiveBringItemToNpc: [{
            type: "table",
            id: "Npcs"
        }, {
            type: "table",
            id: "Items"
        }],
        QuestObjectiveBringSoulToNpc: [{
            type: "table",
            id: "Npcs"
        }, {
            type: "table",
            id: "Monsters"
        }],
        QuestObjectiveDiscoverMap: [{
            type: "getText",
            id: "GetText"
        }],
        QuestObjectiveDiscoverSubArea: [{
            type: "table",
            id: "SubAreas"
        }],
        QuestObjectiveDuelSpecificPlayer: [{
            type: "getText",
            id: "GetText"
        }],
        QuestObjectiveFightMonster: [{
            type: "table",
            id: "Monsters"
        }],
        QuestObjectiveFightMonstersOnMap: [{
            type: "table",
            id: "Monsters"
        }],
        QuestObjectiveFreeForm: [{
            type: "getText",
            id: "GetText"
        }],
        QuestObjectiveGoToNpc: [{
            type: "table",
            id: "Npcs"
        }],
        QuestObjectiveMultiFightMonster: [{
            type: "table",
            id: "Monsters"
        }]
    }
      , u = {
        table: function(e, t, i) {
            r.getDataMap(t, e[t], function(n, o) {
                e[t] = o,
                i(n)
            })
        },
        getText: function(e, t, i) {
            r.getText(e[t], function(n, o) {
                e[t] = o,
                i(n)
            })
        }
    }
      , h = {
        table: function(e, t, i, n) {
            e[i] = t[n.id][e[i]].nameId
        },
        getText: function(e, t, i) {
            e[i] = t.GetText[e[i]]
        }
    };
    e.exports.updateQuestObjectives = function(e, t) {
        o([e], t)
    }
    ,
    e.exports.createFinishedQuestsMap = function(e, t, i) {
        var n = {};
        r.getDataMap("Quests", e, function(o, s) {
            if (o)
                return i(o);
            for (var a = 0, r = e.length; a < r; a += 1) {
                var l = e[a];
                n[l] = {
                    questId: l,
                    dbQuest: s[l],
                    finishedCount: t[a]
                }
            }
            i(null , n)
        })
    }
    ,
    e.exports.initializeActiveQuests = function(e, t) {
        for (var i = [], n = {}, a = 0, c = e.length; a < c; a += 1) {
            var u = e[a];
            n[u.questId] = u,
            i.push(u.questId)
        }
        r.getDataMap("Quests", i, function(i, a) {
            if (i)
                return t(i);
            var c = [];
            for (var u in a) {
                var h = n[u].dbQuest = a[u];
                c = c.concat(h.stepIds)
            }
            r.getDataMap("QuestSteps", c, function(i, c) {
                if (i)
                    return t(i);
                var u = []
                  , h = [];
                for (var d in a) {
                    var p = n[d]
                      , m = p.dbQuest.stepIds;
                    p.dbSteps = {};
                    var f, g;
                    for (f = 0,
                    g = m.length; f < g; f += 1) {
                        var _ = m[f]
                          , v = p.dbSteps[_] = c[_];
                        u = u.concat(v.rewardsIds),
                        h = h.concat(v.objectiveIds)
                    }
                }
                var y = [{
                    ids: h,
                    table: "QuestObjectives"
                }, {
                    ids: u,
                    table: "QuestStepRewards"
                }];
                s.each(y, function(e, t) {
                    r.getDataMap(e.table, e.ids, function(i, n) {
                        e.data = n,
                        t(i)
                    })
                }, function(i) {
                    if (i)
                        return t(i);
                    for (var s in a) {
                        var r = n[s];
                        r.dbObjectives = {},
                        r.dbRewards = {};
                        for (var c in r.dbSteps) {
                            var u, h, d, p = r.dbSteps[c];
                            for (u = 0,
                            h = p.objectiveIds.length; u < h; u += 1)
                                d = p.objectiveIds[u],
                                r.dbObjectives[d] = y[0].data[d],
                                0 === r.dbObjectives[d].mapId && (r.dbObjectives[d].mapId = l[d] || 0);
                            for (u = 0,
                            h = p.rewardsIds.length; u < h; u += 1)
                                d = p.rewardsIds[u],
                                r.dbRewards[d] = y[1].data[d]
                        }
                    }
                    o(e, function(e) {
                        t(e, n)
                    })
                })
            })
        })
    }
}
, function(e, t) {
    var i = {
        713: "80216068",
        4944: "80216068",
        4945: "80216068",
        5048: "80216068",
        5068: "80216068",
        5071: "80216068",
        5134: "80216068",
        720: "80216579",
        5051: "80216579",
        745: "80216580",
        5132: "80216580",
        5133: "80216580",
        4982: "80216833",
        757: "80217090",
        785: "80217090",
        4983: "80217098",
        748: "80217602",
        793: "80217605",
        794: "80217605",
        820: "80218116",
        5139: "80218116",
        5157: "80218116",
        5158: "80218116",
        5162: "80218116",
        5163: "80218116",
        5164: "80218116",
        5165: "80218116",
        5166: "80218116",
        5184: "80218116",
        787: "80218120",
        788: "80218120",
        789: "80218120",
        790: "80218120",
        791: "80218120",
        5073: "80218120",
        5074: "80218120",
        786: "80218624",
        5069: "80218624",
        5070: "80218624",
        751: "80218626",
        771: "80218626",
        4990: "80218627",
        5047: "80218631",
        810: "80219136",
        783: "80219143",
        784: "80219144",
        796: "80219144",
        4963: "80219144",
        4995: "80219653",
        808: "80219654",
        809: "80219654",
        749: "80219655",
        4991: "80220160",
        4993: "80220163",
        746: "80220164",
        753: "80220164",
        4992: "80220673",
        747: "80220676",
        4907: "80220676",
        4981: "80347648",
        4980: "80347651",
        4985: "80347653",
        5189: "80347656",
        4984: "80348167",
        5072: "80740865",
        4943: "81003522",
        4655: "81268739",
        4656: "81268739",
        4941: "81269763",
        4942: "81269763",
        758: "81270787",
        759: "81270787",
        4947: "81270787",
        4964: "81270787",
        4986: "81270787",
        4996: "81270787",
        5024: "81270787",
        5043: "81270787",
        4657: "81396739",
        729: "81527297",
        782: "81527297",
        822: "81527297",
        823: "81527297",
        724: "81527299",
        750: "81527299",
        755: "81527299",
        800: "81527299",
        806: "81527299",
        5067: "81527299",
        744: "81527301",
        752: "81527301",
        754: "81528321",
        824: "81528321",
        825: "81528321",
        4946: "81528321",
        5136: "81528321",
        5140: "81528321",
        5141: "81528321",
        5142: "81528321",
        5159: "81528321",
        5161: "81528321",
        804: "81528323",
        5058: "81528323",
        5135: "81528323",
        761: "81529345",
        795: "81529345",
        821: "81529345",
        5160: "81529345",
        4912: "84672515",
        4916: "84673538",
        4911: "84674048",
        4910: "84675586",
        5717: "84676097",
        4919: "84676101",
        4921: "84676103",
        4909: "84804101"
    };
    e.exports = i
}
, function(e, t, i) {
    function n() {
        a.call(this),
        this.friendsList = {},
        this.enemiesList = {},
        this.ignoredList = {},
        this.spouse = null ,
        this.onConnectNotification = !1
    }
    var o = i(49)
      , s = i(35).getText
      , a = i(16).EventEmitter
      , r = i(26).inherits;
    r(n, a),
    e.exports = n,
    n.prototype.connect = function() {
        window.dofus.sendMessage("FriendsGetListMessage"),
        window.dofus.sendMessage("IgnoredGetListMessage"),
        window.dofus.sendMessage("SpouseGetInformationsMessage")
    }
    ,
    n.prototype.disconnect = function() {
        this.friendsList = {},
        this.enemiesList = {},
        this.ignoredList = {},
        this.spouse = null ,
        this.onConnectNotification = !1
    }
    ,
    n.prototype.initialize = function(e) {
        var t = this
          , i = {
            0: s("ui.common.unknownFail"),
            1: s("ui.social.friend.addFailureListFull"),
            2: s("ui.social.friend.addFailureNotFound"),
            3: s("ui.social.friend.addFailureEgocentric"),
            4: s("ui.social.friend.addFailureAlreadyInList")
        };
        o.on("PlayerStatusUpdateMessage", function(e) {
            t.friendsList[e.accountId] && (t.friendsList[e.accountId].status = e.status,
            t.emit("friendUpdate", t.friendsList[e.accountId])),
            t.enemiesList[e.accountId] && (t.enemiesList[e.accountId].status = e.status,
            t.emit("enemyUpdate", t.enemiesList[e.accountId])),
            t.ignoredList[e.accountId] && (t.ignoredList[e.accountId].status = e.status,
            t.emit("ignoredUpdate", t.ignoredList[e.accountId]))
        }),
        e.on("FriendUpdateMessage", function(e) {
            var i = e.friendUpdated;
            t.friendsList[i.accountId] = i,
            t.emit("friendUpdate", i),
            t.emit("enemyUpdate", i),
            t.emit("ignoredUpdate", i)
        }),
        e.on("FriendsListMessage", function(e) {
            for (var i = {}, n = 0; n < e.friendsList.length; n++)
                i[e.friendsList[n].accountId] = e.friendsList[n];
            t.friendsList = i,
            t.emit("newFriendList")
        }),
        e.on("IgnoredListMessage", function(e) {
            for (var i = {}, n = 0; n < e.ignoredList.length; n++)
                i[e.ignoredList[n].accountId] = e.ignoredList[n];
            t.enemiesList = i,
            t.emit("newEnemyList")
        }),
        e.on("FriendAddedMessage", function(e) {
            t.friendsList[e.friendAdded.accountId] = e.friendAdded,
            t.emit("friendAdded", e.friendAdded)
        }),
        e.on("IgnoredAddedMessage", function(e) {
            var i = e.session ? t.ignoredList : t.enemiesList;
            i[e.ignoreAdded.accountId] = e.ignoreAdded,
            t.emit(e.session ? "ignoredAdded" : "enemyAdded", e.ignoreAdded)
        }),
        o.on("FriendDeleteResultMessage", function(i) {
            if (i.success) {
                e.chat.logError(s("ui.social.friend.delete"));
                for (var n in t.friendsList)
                    if (t.friendsList[n].accountName === i.name)
                        return delete t.friendsList[n],
                        t.emit("friendDeleted", n)
            }
        }),
        e.on("IgnoredDeleteResultMessage", function(e) {
            if (e.success) {
                var i = e.session ? t.ignoredList : t.enemiesList;
                for (var n in i)
                    if (i[n].accountName === e.name)
                        return delete i[n],
                        t.emit(e.session ? "ignoredDeleted" : "enemyDeleted", n)
            }
        }),
        o.on("FriendAddFailureMessage", function(t) {
            e.chat.logError(i[t.reason])
        }),
        o.on("IgnoredAddFailureMessage", function(t) {
            e.chat.logError(i[t.reason])
        }),
        e.on("FriendWarnOnConnectionStateMessage", function(e) {
            t.onConnectNotification = e.enable
        }),
        e.on("SpouseInformationsMessage", function(e) {
            var i = e.spouse;
            t.spouse = {
                spouseAccountId: i.spouseAccountId,
                spouseId: i.spouseId,
                spouseName: i.spouseName,
                spouseLevel: i.spouseLevel,
                breed: i.breed,
                sex: i.sex,
                spouseEntityLook: i.spouseEntityLook,
                guildInfo: i.guildInfo,
                alignmentSide: i.alignmentSide,
                mapId: i.mapId,
                subAreaId: i.subAreaId,
                inFight: i.inFight,
                followSpouse: i.followSpouse
            },
            t.emit("spouseUpdate", t.spouse)
        }),
        e.on("SpouseStatusMessage", function(e) {
            t.spouse && e.hasSpouse === !1 && (t.spouse = null ,
            t.emit("spouseLeft"))
        }),
        e.on("MoodSmileyUpdateMessage", function(e) {
            var i = t.friendsList[e.accountId];
            i && (i.moodSmileyId = e.smileyId,
            t.emit("friendUpdate", i),
            t.emit("enemyUpdate", i),
            t.emit("ignoredUpdate", i))
        })
    }
    ,
    n.prototype.isIgnored = function(e) {
        return !!this.ignoredList[e]
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this._itemList = {}
    }
    var o = i(29).EventEmitter
      , s = i(26).inherits;
    s(n, o),
    e.exports = n,
    n.prototype.initialize = function() {
        function e(e, t) {
            i._itemList[e] = t
        }
        var t = window.dofus.connectionManager
          , i = this;
        t.on("ExchangeShopStockMovementUpdatedMessage", function(t) {
            t.objectInfo && e(t.objectInfo.objectGID, t.objectInfo.quantity)
        }),
        t.on("ExchangeShopStockStartedMessage", function(t) {
            if (t.objectsInfos)
                for (var i = 0; i < t.objectsInfos.length; i++)
                    e(t.objectsInfos[i].objectGID, t.objectsInfos[i].quantity)
        })
    }
    ,
    n.prototype.getItemSellableAmount = function(e) {
        var t = this._itemList[e] || 0
          , i = window.gui.playerData.inventory.quantityList[e] || 0;
        return t + i
    }
    ,
    n.prototype.disconnect = function() {
        this._itemList = {}
    }
}
, function(e, t, i) {
    function n() {
        this.alignmentInfos = null ,
        this.playerRank = null ,
        this.alignmentRank = null ,
        this.alignmentTitles = null ,
        this.alignmentRanks = null ,
        this._imagePaths = ["gfx/alignments/Alignement_tx_IllusNeutre.png", "gfx/alignments/Alignement_tx_IllusBontarien.png", "gfx/alignments/Alignement_tx_IllusBrakmarien.png", "gfx/alignments/Alignement_tx_IllusMercenaire.png"],
        this._orderImagePaths = ["gfx/alignments/order_0.png", "gfx/alignments/order_1.png", "gfx/alignments/order_2.png", "gfx/alignments/order_3.png", "gfx/alignments/order_4.png", "gfx/alignments/order_5.png", "gfx/alignments/order_6.png", "gfx/alignments/order_7.png", "gfx/alignments/order_8.png", "gfx/alignments/order_9.png"],
        this._sideImagePaths = {
            1: "gfx/alignments/wings/tx_alignment1_frame0.png",
            2: "gfx/alignments/wings/tx_alignment2_frame0.png"
        }
    }
    var o = i(29).EventEmitter
      , s = i(26).inherits
      , a = i(36)
      , r = i(5)
      , l = 45
      , c = 63;
    s(n, o),
    e.exports = n,
    n.prototype.initialize = function(e) {
        var t = this;
        e.on("AlignmentRankUpdateMessage", function(e) {
            t.playerRank = e.alignmentRank,
            t.emit("alignmentChanged")
        }),
        e.on("initialized", function() {
            var i = ["AlignmentTitles", "AlignmentRank"];
            a.getAllDataTable(i, function(e, i) {
                return e ? console.error("Unable to load data for alignment window", e) : (t.alignmentTitles = i.AlignmentTitles,
                void (t.alignmentRanks = i.AlignmentRank))
            }),
            e.playerData.on("alignmentInfosUpdated", function() {
                var e = window.gui.databases.AlignmentSides;
                t.alignmentInfos = this.characters.mainCharacter.characteristics.alignmentInfos,
                t.alignmentSide = e[t.alignmentInfos.alignmentSide],
                t.emit("alignmentChanged")
            })
        });
        var i = "gfx/alignments/wings.json";
        r.loadJson(i, function(e) {
            t._wingsData = e
        })
    }
    ,
    n.prototype.getRank = function(e) {
        a.getData("AlignmentRank", this.playerRank, e)
    }
    ,
    n.prototype.getOrder = function(e, t) {
        a.getData("AlignmentOrder", e.orderId, t)
    }
    ,
    n.prototype.getAlignmentImageUrl = function(e) {
        this.alignmentInfos ? r.preloadImage(this._imagePaths[this.alignmentInfos.alignmentSide], e) : r.preloadImage(this._imagePaths[0], e)
    }
    ,
    n.prototype.getTopWings = function(e, t) {
        var i = this
          , n = e.alignmentSide
          , o = e.alignmentGrade
          , s = 10 * (n - 1) + o
          , a = "gfx/alignments/wings/demonAngel_frame" + s + ".png";
        r.preloadImage(a, function(e) {
            var n = i._wingsData[l].frames[s].position
              , o = {
                backgroundImage: e,
                left: n.x + "px",
                top: n.y + "px",
                width: n.w + "px",
                height: n.h + "px"
            };
            t(o)
        })
    }
    ,
    n.prototype.getBottomWings = function(e, t) {
        var i = this
          , n = e.alignmentSide
          , o = e.alignmentGrade
          , s = 10 * (n - 1) + o;
        if (i._wingsData[c].frames[s]) {
            var a = "gfx/alignments/wings/demonAngel2_frame" + s + ".png";
            r.preloadImage(a, function(e) {
                var n = i._wingsData[c].frames[s].position
                  , o = {
                    backgroundImage: e,
                    left: n.x + "px",
                    top: n.y + "px",
                    width: n.w + "px",
                    height: n.h + "px"
                };
                t(o)
            })
        } else
            t(null )
    }
    ,
    n.prototype.getSmallWingsUrl = function(e, t) {
        var i = this._sideImagePaths[e];
        r.preloadImage(i, t)
    }
    ,
    n.prototype.getOrderImageUrl = function(e, t) {
        var i = this._orderImagePaths[e];
        r.preloadImage(i, t)
    }
    ,
    n.prototype.getAlignmentGradeString = function() {
        var e = this.alignmentInfos
          , t = e.alignmentGrade
          , i = e.alignmentSide
          , n = this.alignmentTitles;
        return t + " (" + n[i].namesId[t] + ")"
    }
    ,
    n.prototype.getHonor = function() {
        var e = this.alignmentInfos
          , t = (e.honor - e.honorGradeFloor) / (e.honorNextGradeFloor - e.honorGradeFloor);
        return t
    }
    ,
    n.prototype.getNameId = function() {
        return this.alignmentInfos.alignmentSide.nameId
    }
}
, function(e, t, i) {
    function n() {
        window.dofus.connectionManager.send("bakSoftToHardCurrentRateRequest"),
        window.dofus.connectionManager.send("bakHardToSoftCurrentRateRequest")
    }
    function o() {
        var e = window.dofus.connectionManager
          , i = window.gui;
        i.on("connected", function() {
            n(),
            c = window.setInterval(n, l)
        }),
        i.on("disconnect", function() {
            c = window.clearInterval(c)
        }),
        i.on("appOnBackground", function() {
            c = window.clearInterval(c)
        }),
        e.on("sessionReconnected", function() {
            c || (n(),
            c = window.setInterval(n, l))
        }),
        e.on("bakSoftToHardCurrentRateSuccess", function(e) {
            null !== a && a === e.rate || (a = e.rate,
            t.emit("computedSoftPricesChange"))
        }),
        e.on("bakHardToSoftCurrentRateSuccess", function(e) {
            null !== r && r === e.rate || (r = e.rate,
            t.emit("computedHardPricesChange"))
        }),
        e.on("bakSoftToHardCurrentRateError", function() {
            a = null ,
            t.emit("canNotComputeSoftPrices")
        }),
        e.on("bakHardToSoftCurrentRateError", function() {
            r = null ,
            t.emit("canNotComputeHardPrices")
        })
    }
    var s = i(16).EventEmitter
      , a = null
      , r = null
      , t = e.exports = new s
      , l = 29e4
      , c = null ;
    t.initialize = function() {
        o()
    }
    ,
    t.isRateAvailable = function() {
        return null !== a && null !== r
    }
    ,
    t.computeHardPrice = function(e) {
        return r || 0 === r ? Math.ceil(e / r) : null
    }
    ,
    t.computeSoftPrice = function(e) {
        return a || 0 === a ? Math.ceil(e * a) : null
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "progressGauge"
        }),
        this.gaugeBg = this.createChild("div", {
            className: "gaugeBg"
        }),
        this.gaugeMask = this.createChild("div", {
            className: "gaugeMask"
        }),
        this.gaugeFill = this.gaugeMask.createChild("div", {
            className: "gaugeFill"
        }),
        this._resetAnimInfo(),
        this._setMode(l.PLAYER_EXPERIENCE, {
            percentage: 0
        }),
        this._initEvents()
    }
    i(550);
    var o = i(26).inherits
      , s = i(190)
      , a = i(24).dimensions
      , r = i(210)
      , l = {
        PLAYER_EXPERIENCE: "playerExperience",
        FIGHT_TIMER: "fightTimer"
    };
    o(n, s),
    e.exports = n,
    n.prototype._initEvents = function() {
        var e = this;
        window.gui.on("resize", function() {
            e._resize()
        }),
        window.gui.on("CharacterStatsListMessage", function(t) {
            if (e.gaugeMode === l.PLAYER_EXPERIENCE) {
                var i = t.stats;
                e._setExperienceValue(i.experience, i.experienceLevelFloor, i.experienceNextLevelFloor)
            }
        }),
        window.gui.fightManager.on("fightEnterPreparation", function(t) {
            t.isSpectator || e._setMode(l.FIGHT_TIMER, {
                duration: t.timeMaxBeforeFightStart
            })
        }),
        window.gui.fightManager.on("fightEnterBattle", function() {
            window.gui.playerData.isSpectator || (e.gaugeMode !== l.FIGHT_TIMER && e._setMode(l.FIGHT_TIMER),
            e._pauseAnimation())
        }),
        window.gui.timeline.on("setTurnOf", function(t, i) {
            if (e.gaugeMode === l.FIGHT_TIMER) {
                var n = window.gui.playerData.characters.controlledCharacterId;
                t.id === n ? e._animate(i) : (e._setStatic(),
                e._setPercentage(0))
            }
        }),
        window.gui.fightManager.on("fightEnd", function() {
            e._setMode(l.PLAYER_EXPERIENCE, {
                percentage: 0
            })
        })
    }
    ,
    n.prototype._setMode = function(e, t) {
        var i = t && "number" == typeof t.duration ? t.duration : null
          , n = t && "number" == typeof t.percentage ? t.percentage : 0;
        switch (e) {
        case l.FIGHT_TIMER:
            this.replaceClassNames(["playerXp"], ["fightTimer"]),
            this.gaugeMode = e,
            null !== i ? this._animate(i, n) : (this._setStatic(),
            this._setPercentage(n),
            this._resetAnimInfo());
            break;
        case l.PLAYER_EXPERIENCE:
        default:
            this.replaceClassNames(["fightTimer"], ["playerXp"]),
            this.gaugeMode = e,
            this._setStatic(),
            this._resetAnimInfo(),
            this._setPercentage(n)
        }
    }
    ,
    n.prototype._resetAnimInfo = function() {
        this.animationInfo = {
            startTime: 0,
            duration: 0,
            startFrom: 0
        }
    }
    ,
    n.prototype._setStatic = function() {
        this.gaugeFill.setStyles({
            webkitAnimation: "initial",
            webkitAnimationPlayState: "initial"
        })
    }
    ,
    n.prototype._setPercentage = function(e) {
        e = Math.max(0, Math.min(100, e)),
        this.gaugeFill.setStyle("webkitTransform", "translate3d(-" + (100 - e) / 2 + "%,0,0) scaleX(" + e / 100 + ")")
    }
    ,
    n.prototype._setExperienceValue = function(e, t, i) {
        if (this.gaugeMode !== l.PLAYER_EXPERIENCE)
            return console.error(new Error("ProgressGauge is not in experience mode"));
        var n = (e - t) / (i - t) * 100;
        this._setPercentage(n)
    }
    ,
    n.prototype._animate = function(e, t) {
        if (this.gaugeMode !== l.FIGHT_TIMER)
            return console.error(new Error("ProgressGauge._animate: ProgressGauge is not in timer mode"));
        t = t || 0,
        t = Math.max(0, Math.min(100, t));
        var i = e / 100 * t;
        this._setStatic(),
        this._setPercentage(100),
        r.forceReflow(this.gaugeFill),
        this.animationInfo = {
            startTime: Date.now(),
            duration: e,
            startFrom: t
        },
        this.gaugeFill.setStyles({
            webkitAnimation: "progressGaugeAnimation " + e + "ms linear -" + i + "ms",
            webkitAnimationPlayState: "running"
        })
    }
    ,
    n.prototype._pauseAnimation = function() {
        return this.gaugeMode !== l.FIGHT_TIMER ? console.error(new Error("ProgressGauge._pauseAnimation: ProgressGauge is not in timer mode")) : void this.gaugeFill.setStyle("webkitAnimationPlayState", "paused")
    }
    ,
    n.prototype._resize = function() {
        window.gui.ipadRatio ? this.setStyle("width", "100%") : this.setStyle("width", a.shortcutBarSize - 9 + "px");
        var e = this.animationInfo;
        if (this.gaugeMode === l.FIGHT_TIMER && 0 !== e.startTime) {
            var t = Date.now() - e.startTime;
            if (t < e.duration) {
                var i = t / e.duration * (100 - e.startFrom)
                  , n = e.startFrom + i;
                this._animate(e.duration - t, n)
            }
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, {
            scaleOnPress: !0,
            className: "RewardsIndicator",
            hidden: !0
        }, function() {
            r["switch"]("rewardsPending")
        });
        var e = this;
        window.gui.on("disconnect", function() {
            e.hide()
        }),
        window.gui.on("resize", function() {
            e._initPosition()
        }),
        this.on("show", function() {
            c("NEW_REWARD")
        })
    }
    i(552);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(22)
      , l = i(24).dimensions
      , c = i(84).playUiSound;
    o(n, s),
    e.exports = n,
    n.prototype._initPosition = function() {
        this.setStyle("left", l.mapLeft + l.mapWidth / 2 - 32 + "px"),
        this.setStyle("top", l.mapBottom - 64 + "px")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e = this
          , t = window.gui;
        this._isActive = !1,
        this._activePictoMap = {},
        t.once("initialized", function() {
            var i = window.gui.gameGuiContainer;
            e._pingBtn = i.appendChild(new r),
            e._pingBox = i.appendChild(new l),
            e._emoteBox = i.appendChild(new c),
            e._setupEvents(t),
            e._emoteBox.refreshPosition(),
            e._emoteBox.hide()
        }),
        t.on("disconnect", function() {
            e._reset(),
            e._resetPicto()
        }),
        t.fightManager.on("fightStart", function() {
            e._pingBtn.enterFightState()
        }),
        t.fightManager.on("fightEnd", function() {
            e._pingBtn.enterRolePlayState()
        })
    }
    var o = i(26).inherits
      , s = i(16).EventEmitter
      , a = i(33).position
      , r = i(554)
      , l = i(557)
      , c = i(560)
      , u = 4e3;
    o(n, s),
    e.exports = n,
    n.prototype.PING_CELL_COLOR = {
        r: 240,
        g: 160,
        b: 65,
        a: .75
    },
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui
          , i = this._pingBtn
          , n = this._pingBox;
        t.on("GameFightEndMessage", function() {
            e._reset(),
            e._resetPicto()
        }),
        i.on("pingBtnActivate", function(i) {
            t.playerData.isFighting && (e._isActive = i,
            i || e._pingBox.close())
        }),
        i.on("emoteBtnTap", function() {
            if (e._emoteBox.isOpen)
                e._emoteBox.hide();
            else {
                if (t.playerData.isFighting)
                    return;
                e._emoteBox.show(),
                e._emoteBox.refreshPosition()
            }
        }),
        n.on("actionSent", function() {
            e._reset()
        })
    }
    ,
    n.prototype.cancelPingBox = function() {
        this._pingBox.close()
    }
    ,
    n.prototype.openPingBox = function(e, t) {
        this._pingBox.open(a.x, a.y, e, t)
    }
    ,
    n.prototype.isPingBoxOpen = function() {
        return this._pingBox.isOpen()
    }
    ,
    n.prototype.addPingPicto = function(e, t) {
        function i(e) {
            return window.setTimeout(function() {
                window.isoEngine.mapRenderer.removePingPicto(e),
                delete n._activePictoMap[e]
            }, u)
        }
        if (window.gui.playerData.isFighting && e !== -1) {
            var n = this
              , o = t + "-cellId" + e;
            if (this._activePictoMap[o])
                return window.clearTimeout(this._activePictoMap[o]),
                void (this._activePictoMap[o] = i(o));
            window.isoEngine.mapRenderer.addPingPictoOnCell(o, e, t),
            this._activePictoMap[o] = i(o)
        }
    }
    ,
    n.prototype._removePingPicto = function() {
        for (var e in this._activePictoMap)
            this._activePictoMap.hasOwnProperty(e) && (window.clearTimeout(this._activePictoMap[e]),
            window.isoEngine.mapRenderer.removePingPicto(e),
            delete this._activePictoMap[e])
    }
    ,
    n.prototype._reset = function() {
        this._isActive = !1,
        this._pingBtn.setActivateMode(!1),
        this._pingBox.close()
    }
    ,
    n.prototype._resetPicto = function() {
        this._removePingPicto(),
        this._activePictoMap = {}
    }
    ,
    n.prototype.isActive = function() {
        return this._isActive
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "PingBtn"
        });
        var e = this;
        this._isActivated = !1;
        var t = this.createChild("div", {
            className: "borderBox"
        });
        this._pingBtn = t.appendChild(new o({
            className: "pingBtn",
            scaleOnPress: !0,
            tooltip: a("tablet.pingsystem.pingsystem"),
            hidden: !0
        },function() {
            window.gui.playerData.isFighting && (e.setActivateMode(!e._isActivated),
            e.emit("pingBtnActivate", e._isActivated))
        }
        )),
        this._emoteBtn = t.appendChild(new o({
            className: "emoteBtn",
            tooltip: a("tablet.common.emotesAndSmilies")
        },function() {
            window.gui.playerData.isFighting || (this._isActivated = !1,
            e.setActivateMode(!1),
            e.emit("emoteBtnTap"))
        }
        )),
        this._setupEvents(),
        this._resize(),
        this.exclusiveSelector = u("shortcutSlots"),
        this.exclusiveSelector.register(this)
    }
    i(555);
    var o = i(204)
      , s = i(190)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(24).dimensions
      , c = i(6)
      , u = i(556).getExclusiveSelectorByGroup;
    r(n, s),
    e.exports = n,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui;
        t.on("resize", function() {
            e._resize()
        })
    }
    ,
    n.prototype._resize = function() {
        var e = l.pingEmoteBtnSize;
        window.gui.ipadRatio ? this.setStyles({
            top: "",
            right: "",
            left: l.posPingEmoteBtn + "px",
            bottom: "0",
            width: e + "px",
            height: l.bottomBarHeight + "px"
        }) : this.setStyles({
            bottom: "",
            left: "",
            right: "0",
            top: l.posPingEmoteBtn + "px",
            width: c.PING_EMOTE_BTN_WIDE_MIN_WIDTH + "px",
            height: e + "px"
        })
    }
    ,
    n.prototype.setActivateMode = function(e) {
        var t = this._pingBtn;
        t.toggleClassName("on", e),
        this._isActivated = e,
        this.emit("selected", e),
        this.emit("pingBtnActivate", e)
    }
    ,
    n.prototype.select = function(e) {
        this.setActivateMode(e)
    }
    ,
    n.prototype.enterFightState = function() {
        this._pingBtn.show(),
        this._emoteBtn.hide(),
        this._resize()
    }
    ,
    n.prototype.enterRolePlayState = function() {
        this._emoteBtn.show(),
        this._pingBtn.hide(),
        this._resize()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this),
        this._currentSelection = null ;
        var e = this;
        this._onSelected = function(t) {
            e._changeSelection(this, t)
        }
    }
    var o = i(26)
      , s = i(29);
    o.inherits(n, s),
    t.ExclusiveSelector = n,
    n.prototype._changeSelection = function(e, t) {
        if (t) {
            if (this._currentSelection) {
                if (e === this._currentSelection)
                    return;
                this._currentSelection.select(!1)
            }
            this._currentSelection = e
        } else
            this._currentSelection = null ;
        this.emit("selectionChanged", this._currentSelection)
    }
    ,
    n.prototype.register = function(e) {
        if ("function" != typeof e.select)
            throw new Error(e,"Does not define a select method.");
        e.on("selected", this._onSelected)
    }
    ,
    n.prototype.unregister = function(e) {
        e.removeListener("selected", this._onSelected)
    }
    ;
    var a = {
        "default": new n
    };
    t.getExclusiveSelectorByGroup = function(e) {
        if (!e)
            return a["default"];
        if (e in a)
            return a[e];
        var t = new n;
        return a[e] = t,
        t
    }
    ,
    t.removeGroup = function(e) {
        delete a[e]
    }
}
, function(e, t, i) {
    function n() {
        function e(e) {
            e.toggleDisplay(!0)
        }
        function t(e, t) {
            e.toggleDisplay(t.isEmptyCell)
        }
        function i(e, t) {
            e.toggleDisplay(!t.isEmptyCell)
        }
        s.call(this, "div", {
            className: "PingBox",
            hidden: !0
        });
        var n = this
          , r = window.gui
          , c = "pingBoxShowBoxId"
          , u = r.pingSystem.PING_CELL_COLOR;
        this._MESSAGE_CHANNEL = l.CHANNEL_TEAM,
        this._position = {
            x: 0,
            y: 0
        },
        this._isOpen = !1,
        this._cellId = -1,
        this._talks = [],
        this._actions = [];
        var h = this.createChild("div", {
            className: "tabPanel"
        })
          , p = this.createChild("div", {
            className: "containers"
        });
        h.appendChild(new o({
            className: ["pingTalk", "tab"],
            scaleOnPress: !0
        },function() {
            g.hide(),
            f.hide(),
            p.getChildren()[0] !== m && p.insertAsFirstChild(m),
            m.show(),
            n.reposition()
        }
        )),
        h.appendChild(new o({
            className: ["pingSentence", "tab"],
            scaleOnPress: !0
        },function() {
            m.hide(),
            g.hide(),
            p.getChildren()[0] !== f && p.insertAsFirstChild(f),
            f.show(),
            n.reposition()
        }
        )),
        h.appendChild(new o({
            className: ["pingAction", "tab"],
            scaleOnPress: !0
        },function() {
            m.hide(),
            f.hide(),
            p.getChildren()[0] !== g && p.insertAsFirstChild(g),
            g.show(),
            n.reposition()
        }
        ));
        var m = this._talkContainer = p.createChild("div", {
            className: ["container", "talkContainer"]
        })
          , f = this._sentenceContainer = p.createChild("div", {
            className: ["container", "sentenceContainer"]
        })
          , g = this._actionContainer = p.createChild("div", {
            className: ["container", "actionContainer"]
        });
        m.hide(),
        g.hide(),
        f.hide(),
        this._addSmileys(),
        this._addSentence(a("tablet.pingsystem.hello"), d.hello, e),
        this._addSentence(a("tablet.pingsystem.thx"), d.thx, e),
        this._addSentence(a("tablet.pingsystem.great"), d.great, e),
        this._addSentence(a("tablet.pingsystem.goodJob"), d.goodJob, e),
        this._addSentence(a("tablet.pingsystem.yes"), d.yes, e),
        this._addSentence(a("tablet.pingsystem.no"), d.no, e),
        this._addSentence(a("tablet.pingsystem.ready"), d.ready, e),
        this._addSentence(a("tablet.pingsystem.tooFar"), d.tooFar, e),
        this._addSentence(a("tablet.pingsystem.outSight"), d.outSight, e),
        this._addSentence(a("tablet.pingsystem.comeCloser"), d.comeCloser, e),
        this._addSentence(a("tablet.pingsystem.retreat"), d.retreat, e),
        this._addSentence(a("tablet.pingsystem.challenge"), d.lightBulb, e),
        this._addAction(a("tablet.pingsystem.mp"), "mp", t),
        this._addAction(a("tablet.pingsystem.warning"), "warning", t),
        this._addAction(a("tablet.pingsystem.stop"), "stop", t),
        this._addAction(a("tablet.pingsystem.attack"), "attack", i),
        this._addAction(a("tablet.pingsystem.move"), "move", i),
        this._addAction(a("tablet.pingsystem.heal"), "heal", i),
        this._addAction(a("tablet.pingsystem.boost"), "boost", i),
        this._addAction(a("tablet.pingsystem.tackle"), "tackle", i),
        this._addAction(a("tablet.pingsystem.valid"), "valid", i),
        this.on("show", function() {
            window.isoEngine.mapRenderer.addCellHighlight(c, [this._cellId], u)
        }),
        this.on("hide", function() {
            window.isoEngine.mapRenderer.deleteCellHighlight(c)
        }),
        r.on("disconnect", function() {
            n.close()
        })
    }
    i(558);
    var o = i(204)
      , s = i(190)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(235)
      , c = i(31)
      , u = i(203).getElementPositionCenteredAt
      , h = i(24).dimensions
      , d = i(559)
      , p = i(5)
      , m = i(32);
    r(n, s),
    e.exports = n,
    n.prototype._addSmileys = function() {
        function e(e, i) {
            function n() {
                window.dofus.sendMessage("ChatSmileyRequestMessage", {
                    smileyId: o.id
                }),
                t.emit("actionSent"),
                t._talkContainer.hide()
            }
            var o = new s("div",{
                name: e.id,
                className: ["chatIcon", "smileyIcon"]
            });
            o.id = e.id,
            o.setStyle("backgroundImage", i),
            m(o),
            o.on("tap", n),
            t._talkContainer.appendChild(o)
        }
        var t = this;
        t._talkContainer.addClassNames("spinner");
        for (var i = window.gui.databases.Smileys, n = Object.keys(i), o = [], a = 0; a < n.length; a++)
            o.push("gfx/smilies/" + i[n[a]].gfxId + ".png");
        p.preloadImages(o, function(o) {
            for (var s = 0; s < o.length; s++)
                e(i[n[s]], o[s]);
            t._talkContainer.delClassNames("spinner")
        })
    }
    ,
    n.prototype._addSentence = function(e, t, i, n) {
        n = n || e;
        var o = this
          , s = window.gui.databases.Smileys[t];
        s || (s = {},
        console.warn("PingBox: Smiley " + t + " details are not available, it could not be displayed"));
        var a = this._sentenceContainer.createChild("div", {
            className: "pingRow"
        });
        m(a, null ),
        a.on("tap", function() {
            window.dofus.sendMessage("ChatSmileyRequestMessage", {
                smileyId: t
            }),
            window.gui.chat.sendChatMessage(e, o._MESSAGE_CHANNEL),
            o.emit("actionSent")
        });
        var r = a.createChild("div", {
            className: "smiley"
        });
        p.preloadImage("gfx/smilies/" + s.gfxId + ".png", function(e) {
            r.setStyle("backgroundImage", e)
        }),
        a.createChild("div", {
            text: e,
            className: "label"
        }),
        a.displayFn = i,
        this._talks.push(a)
    }
    ,
    n.prototype._addAction = function(e, t, i, n) {
        var o = this;
        n = n || e;
        var s = this._actionContainer.createChild("div", {
            className: "pingRow"
        });
        m(s, null ),
        s.on("tap", function() {
            var i = "{pingsystem," + o._cellId + "," + t + "::[" + e + "]}";
            window.gui.chat.sendChatMessage(i, o._MESSAGE_CHANNEL),
            o.emit("actionSent")
        });
        var a = s.createChild("div", {
            className: "iconBox"
        });
        a.createChild("div", {
            className: ["icon", t]
        }),
        s.createChild("div", {
            text: e,
            className: "label"
        }),
        s.displayFn = i,
        this._actions.push(s)
    }
    ,
    n.prototype._filterActionsMenu = function(e) {
        e = e || {};
        var t, i, n = this._talks, o = this._actions;
        for (t = 0,
        i = n.length; t < i; t += 1) {
            var s = n[t];
            s.displayFn(s, e)
        }
        for (t = 0,
        i = o.length; t < i; t += 1) {
            var a = o[t];
            a.displayFn(a, e)
        }
    }
    ,
    n.prototype.isOpen = function() {
        return this._isOpen
    }
    ,
    n.prototype.reposition = function() {
        var e = 10
          , t = this.rootElement.getBoundingClientRect()
          , i = t.left
          , n = t.left + t.width
          , o = t.top
          , s = t.top + t.height;
        i < e && (i = e),
        n > h.screenWidth - e && (i = h.screenWidth - e - t.width),
        o < e && (o = e),
        s > h.screenHeight - e && (o = h.screenHeight - e - t.height),
        i === t.left && o === t.top || c.tween(this, {
            webkitTransform: "scale(1) translate3d(" + Math.round(i) + "px, " + Math.round(o) + "px, 0)"
        }, {
            time: 100,
            easing: "linear"
        })
    }
    ,
    n.prototype.open = function(e, t, i, n) {
        var o = window.foreground;
        this._cellId = i,
        o.confirmBox.close(),
        o.deselectSpell(),
        window.gui.shortcutBar.deselectIcon(),
        this._filterActionsMenu({
            isEmptyCell: n
        }),
        this.show();
        var s = this._position = u(this, e, t);
        this._isOpen ? this.setStyles({
            webkitTransformOrigin: e + "px " + t + "px"
        }) : this.setStyles({
            webkitTransform: "scale(0) translate3d(" + s.x + "px, " + s.y + "px, 0)",
            webkitTransformOrigin: e + "px " + t + "px"
        }),
        c.tween(this, {
            webkitTransform: "scale(1) translate3d(" + s.x + "px, " + s.y + "px, 0)"
        }, {
            time: 100,
            easing: "linear"
        }),
        this._isOpen = !0
    }
    ,
    n.prototype.close = function() {
        var e = this
          , t = this._position;
        this._isOpen && (this._isOpen = !1,
        this._cellId = -1,
        c.tween(this, {
            webkitTransform: "scale(0) translate3d(" + t.x + "px," + t.y + "px,0)"
        }, {
            time: 100,
            easing: "linear"
        }, function() {
            e.hide(),
            e._sentenceContainer.hide(),
            e._actionContainer.hide(),
            e._talkContainer.hide()
        }))
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        hello: 1,
        ready: 4,
        great: 7,
        thx: 8,
        goodJob: 10,
        outSight: 26,
        comeCloser: 43,
        tooFar: 44,
        retreat: 63,
        lightBulb: 80,
        yes: 88,
        no: 89
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "EmoteBox"
        }),
        this._chatIcons = new o,
        this.appendChild(this._chatIcons);
        var e = this;
        this._chatIcons.on("closing", function() {
            e.hide()
        }),
        this.isOpen = !1,
        this._emoteBoxSize = 85,
        this._time = 200,
        this._delay = 0,
        this._easing = "ease-out"
    }
    i(561);
    var o = i(445)
      , s = i(190)
      , a = i(26).inherits
      , r = i(24).dimensions
      , l = i(6)
      , c = i(31);
    a(n, s),
    e.exports = n,
    n.prototype.refreshPosition = function() {
        window.gui.ipadRatio ? (this._chatIcons.setPanelsStyle("right", "auto"),
        this._chatIcons.setPanelsStyle("left", r.pingEmoteBtnSize + "px"),
        this._chatIcons.setPanelsStyle("bottom", this._emoteBoxSize + "px"),
        this.setStyle("left", l.CHAT_BTN_MIN_WIDTH + "px"),
        this.setStyle("width", r.pingEmoteBtnSize + "px"),
        this.setStyle("height", this._emoteBoxSize + "px"),
        this.setStyle("bottom", r.bottomBarHeight + "px"),
        this.setStyle("line-height", "inherit")) : (this._chatIcons.setPanelsStyle("left", "auto"),
        this._chatIcons.setPanelsStyle("right", this._emoteBoxSize + "px"),
        this._chatIcons.setPanelsStyle("bottom", r.pingEmoteBtnSize + "px"),
        this.setStyle("left", r.mapRight - this._emoteBoxSize + "px"),
        this.setStyle("width", this._emoteBoxSize + "px"),
        this.setStyle("height", r.pingEmoteBtnSize + "px"),
        this.setStyle("bottom", "0px"),
        this.setStyle("line-height", r.pingEmoteBtnSize + "px"))
    }
    ,
    n.prototype.show = function() {
        var e = this;
        e.setStyle("visibility", "visible"),
        c.tween(this, {
            webkitTransform: "translate3d(0, 0, 0)"
        }, {
            time: this._time,
            delay: this._delay,
            easing: this._easing
        }, function() {
            e.isOpen = !0
        })
    }
    ,
    n.prototype.hide = function() {
        var e = this;
        window.gui.ipadRatio ? c.tween(this, {
            webkitTransform: "translate3d(0, " + this._emoteBoxSize + "px, 0)"
        }, {
            time: this._time,
            delay: this._delay,
            easing: this._easing
        }, function() {
            e.setStyle("visibility", "collapse"),
            e.isOpen = !1
        }) : c.tween(this, {
            webkitTransform: "translate3d(" + this._emoteBoxSize + "px, 0, 0)"
        }, {
            time: this._time,
            delay: this._delay,
            easing: this._easing
        }, function() {
            e.setStyle("visibility", "collapse"),
            e.isOpen = !1
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e = this
          , t = window.gui;
        this._characterList = [],
        this._charaListMinusDeadPeople = [],
        this._giftList = [],
        this._assigningGifts = {},
        t.once("initialized", function() {
            e._setupEvents()
        }),
        t.on("disconnect", function() {
            e._reset()
        })
    }
    var o = i(26).inherits
      , s = i(16).EventEmitter
      , a = i(323)
      , r = i(22)
      , l = i(442)
      , c = i(35).getText;
    o(n, s),
    e.exports = n,
    n.prototype._setupEvents = function() {
        var e = this;
        window.dofus.connectionManager.on("StartupActionsListMessage", function(t) {
            t.actions.length && (e.setCharacterList(l.getCharacterList()),
            e._createGiftList(t, function(t) {
                return t ? console.error(new Error("Gifts module StartupActionsListMessage: " + t)) : e._giftList.length ? void (e.getCharaListMinusDeadPeople().length && r.open("giftSelection", e._giftList)) : console.error(new Error("Gifts module StartupActionsListMessage: _giftList is empty"))
            }))
        }),
        window.dofus.connectionManager.on("StartupActionFinishedMessage", function(t) {
            t.success || window.gui.openSimplePopup(c("tablet.gift.unableToAssign"), c("tablet.gift.unableToAssignTitle")),
            e._assigningGifts[t.actionId] ? e._assigningGifts[t.actionId] = !1 : (e._assigningGifts[t.actionId] = t.success,
            e.emit("giftAssignRequestResult", t))
        })
    }
    ,
    n.prototype._createGiftList = function(e, t) {
        for (var i = this, n = e.actions, o = [], s = 0, r = n.length; s < r; s += 1)
            for (var l = n[s], c = l.items, u = 0, h = c.length; u < h; u += 1) {
                var d = c[u];
                d && o.push(d)
            }
        a.createItemInstances(o, function(e, o) {
            if (e)
                return t(e);
            for (var s = 0, a = n.length; s < a; s += 1) {
                for (var r = n[s], l = [], c = r.items, u = 0, h = c.length; u < h; u += 1) {
                    var d = o.array[s + u] || null ;
                    d && l.push(d)
                }
                l.length && i._giftList.push({
                    uid: r.uid,
                    title: r.title,
                    text: r.text,
                    items: l
                })
            }
            t()
        })
    }
    ,
    n.prototype._reset = function() {
        this._characterList = [],
        this._charaListMinusDeadPeople = [],
        this._giftList = [],
        this._assigningGifts = {}
    }
    ,
    n.prototype.getCharacterList = function() {
        return this._characterList
    }
    ,
    n.prototype.getCharaListMinusDeadPeople = function() {
        return this._charaListMinusDeadPeople
    }
    ,
    n.prototype.setCharacterList = function(e) {
        this._characterList = e,
        this._charaListMinusDeadPeople = [];
        for (var t = 0, i = e.length; t < i; t += 1) {
            var n = e[t];
            n.deathState && 0 !== n.deathState || this._charaListMinusDeadPeople.push(n)
        }
    }
    ,
    n.prototype.assignGift = function(e, t) {
        window.dofus.sendMessage("StartupActionsObjetAttributionMessage", {
            actionId: e,
            characterId: t
        })
    }
}
, function(e, t, i) {
    function n() {
        y.call(this, {
            backDrawerSize: u.SHORTCUT_GAUGE_SIZE
        }),
        this.addClassNames("ShortcutBar"),
        this.toolbarSwitched = null ,
        this._createDom(),
        this._setupEvents();
        var e = x("shortcutSlots")
          , t = this;
        e.on("selectionChanged", function(e) {
            (e instanceof b || null === e) && (t._selectedSlot = e)
        })
    }
    function o(e, t) {
        var i = t[e.id];
        i || (i = t[e.id] = []),
        e.exclusiveSelector = x("shortcutSlots"),
        e.exclusiveSelector.register(e),
        i.push(e)
    }
    function s(e, t) {
        var i = t[e.id];
        if (i) {
            var n = i.indexOf(e);
            n !== -1 && i.splice(n, 1)
        }
        e.exclusiveSelector && (e.exclusiveSelector.unregister(e),
        delete e.exclusiveSelector)
    }
    function a(e, t) {
        function i() {
            window.clearTimeout(s),
            o.delClassNames("over")
        }
        function n() {
            s = window.setTimeout(function() {
                t(),
                n()
            }, 700)
        }
        var o = new A("div",{
            className: "hoverBorder"
        });
        o.addClassNames(e),
        o.createChild("div", {
            className: "arrow"
        }),
        g(o);
        var s;
        return o.on("touchenter", function() {
            this.addClassNames("over"),
            window.gui.wBody.once("dom.touchend", i),
            n()
        }),
        o.on("touchleave", function() {
            i(),
            window.gui.wBody.removeListener("dom.touchend", i)
        }),
        o
    }
    function r(e, t) {
        for (var i = 0, n = e.length; i < n; i += 1) {
            var o = e[i];
            o.enableContextMenu(t)
        }
    }
    i(564);
    var l = i(565)
      , c = i(204)
      , u = i(6)
      , h = i(24).dimensions
      , d = i(186)
      , p = i(85)
      , m = i(25)
      , f = i(35).getText
      , g = i(189)
      , _ = i(26).inherits
      , v = i(566)
      , y = i(492)
      , w = i(571)
      , b = i(573)
      , C = i(509)
      , I = i(281)
      , T = i(206)
      , S = i(31)
      , A = i(190)
      , E = i(84).playUiSound
      , x = i(556).getExclusiveSelectorByGroup
      , M = l.GENERAL_SHORTCUT_BAR
      , N = l.SPELL_SHORTCUT_BAR
      , R = {};
    R[N] = "spell",
    R[M] = "item";
    var O = {
        spell: b,
        item: v
    }
      , P = u.SHORTCUT_ICON_SIZE
      , D = 30
      , L = 3
      , B = {
        spell: ["shortcutBar", "spellsWindow"],
        item: ["shortcutBar", "equipment", "presets", "characterBox"]
    };
    _(n, y),
    e.exports = n,
    n.prototype.computeBestSize = function(e, t) {
        var i;
        return "narrow" === t ? (i = u.ICONBAR_TAB_WIDTH + u.ICONBAR_CORNER_WIDTH,
        this._iconsVisiblePerLine = ~~((e - i) / P),
        this._iconsVisiblePerLine * P + i) : (i = u.ICONBAR_TAB_HEIGHT,
        this._iconsVisiblePerColumn = ~~((e - i) / P),
        this._iconsVisiblePerColumn * P + i)
    }
    ,
    n.prototype._selectSlot = function(e, t) {
        if (this.isLocked) {
            if (t && window.isoEngine.clearSpellDisplay(),
            this._selectedSlot === e)
                return this._unSelectSlot(e);
            if (this._selectedSlot && this._selectedSlot.select(!1),
            e.isEmpty)
                return void (this._selectedSlot = null );
            this._selectedSlot = e,
            e.select(!0),
            window.gui.fightManager.isInBattle() && this._close(!0)
        }
    }
    ,
    n.prototype._unSelectSlot = function(e) {
        e && this._selectedSlot === e && (this._selectedSlot.select(!1),
        this._selectedSlot = null )
    }
    ,
    n.prototype._positionSlot = function(e, t) {
        var i, n, o, s, a = t % D;
        window.gui.ipadRatio ? (i = a % this._columns,
        n = Math.floor(a / this._columns),
        o = i * P,
        s = n * P) : (i = a % this._lines,
        n = Math.floor(a / this._lines),
        o = n * P,
        s = i * P),
        e.index = t,
        e.x = o,
        e.y = s,
        e.setStyles({
            left: o + "px",
            top: s + "px",
            webkitTransform: ""
        })
    }
    ,
    n.prototype.openPanel = function(e) {
        var t = "spell" === e ? "item" : "spell";
        this.currentPanelType = e,
        this.panels[e].show(),
        this.panels[t].hide(),
        this.panel = this.panels[e],
        this.replaceClassNames([t], [e]),
        this.emit("panel", e)
    }
    ,
    n.prototype.getSlot = function(e, t) {
        var i = this.panels[e];
        if (i)
            return i.slotList[t]
    }
    ,
    n.prototype._setPanelContent = function(e, t) {
        var i, n, a, r = this.panels[e], l = r.slotList, c = r.slotMap = {}, u = new Array(l.length);
        for (i = 0,
        n = t.length; i < n; i += 1)
            a = t[i],
            this._isSlotIndexValid(a.slot) && (u[a.slot] = a);
        for (i = 0,
        n = l.length; i < n; i += 1) {
            a = u[i];
            var h = l[i];
            a ? (h.isEmpty || h.id !== O[e].getId(a)) && (h.setShortcut(a),
            o(h, c)) : h.isEmpty || (h.unset(),
            s(h, c))
        }
    }
    ,
    n.prototype._setPlaceHolder = function(e, t) {
        for (var i = this.panels[e], n = i.slotList, o = 0, s = t.length; o < s; o += 1) {
            var a = t[o];
            this._isSlotIndexValid(a.slot) && n[a.slot].setImage(I.placeHolder)
        }
    }
    ,
    n.prototype._emptyPanel = function(e) {
        var t = this.panels[e]
          , i = t.slotList;
        t.slotMap = {};
        for (var n = 0, o = i.length; n < o; n += 1) {
            var s = i[n];
            s.isEmpty || s.unset()
        }
    }
    ,
    n.prototype._resize = function() {
        var e, t, i = this.panels.spell, n = this.panels.item;
        window.gui.ipadRatio ? (this.setStyles({
            top: "",
            right: "",
            left: h.posShortcutBar + "px",
            bottom: "0px",
            width: h.shortcutBarSize + "px",
            height: h.bottomBarHeight + "px"
        }),
        e = h.shortcutBarSize - 75,
        this._columns = Math.floor(e / P),
        this._lines = Math.ceil(D / this._columns),
        t = this._lines * P + 8,
        this.setOpeningSide("top"),
        i.setSwipeDirection("horizontal"),
        n.setSwipeDirection("horizontal"),
        this.arrowNeg.setStyle("bottom", h.bottomBarHeight + "px"),
        this.arrowPos.setStyle("bottom", h.bottomBarHeight + "px"),
        this.trashZone.setStyle("width", e + "px"),
        this._buttonBox.appendChild(this._lockBtn),
        this._buttonBox.appendChild(this._pagination),
        this._pagination.setDirection("horizontal")) : (this.setStyles({
            bottom: "",
            left: "",
            right: "0px",
            top: h.posShortcutBar + "px",
            width: h.sideBarWidth + "px",
            height: h.shortcutBarSize + "px"
        }),
        t = h.shortcutBarSize - 29,
        this._lines = Math.floor(t / P),
        this._columns = Math.ceil(D / this._lines),
        e = this._columns * P + 13 + 30,
        this.setOpeningSide("left"),
        i.setSwipeDirection("vertical"),
        n.setSwipeDirection("vertical"),
        this.arrowPos.setStyles({
            bottom: -h.posShortcutBar + "px",
            right: h.sideBarWidth + "px",
            height: h.posShortcutBar + "px"
        }),
        this.arrowNeg.setStyles({
            top: -h.posShortcutBar + "px",
            right: h.sideBarWidth + "px",
            height: h.posShortcutBar + "px"
        }),
        this.trashZone.setStyle("height", t + "px"),
        this._panelBox.appendChild(this._lockBtn),
        this._panelBox.appendChild(this._pagination),
        this._pagination.setDirection("vertical")),
        this._panelBox.setStyles({
            width: e + "px",
            height: t + "px"
        });
        for (var o = i.slotList, s = n.slotList, a = 0, r = o.length; a < r; a += 1)
            this._positionSlot(o[a], a),
            this._positionSlot(s[a], a)
    }
    ,
    n.prototype._enableSlotContextMenus = function(e) {
        r(this.panels.item.slotList, e),
        r(this.panels.spell.slotList, e)
    }
    ,
    n.prototype.updateSpellsAvailability = function() {
        if (this.currentCharacterId !== window.gui.playerData.characters.controlledCharacterId)
            return void (this.requestSpellsAvailibilityUpdate = !0);
        for (var e = this.panels.spell.slotList, t = 0, i = e.length; t < i; t += 1) {
            var n = e[t];
            n.isEmpty || this._updateSpellSlotAvailability(n)
        }
    }
    ,
    n.prototype.updateSpellAvailability = function(e) {
        if (this.currentCharacterId !== window.gui.playerData.characters.controlledCharacterId)
            return void (this.requestSpellAvailibilityUpdate = e);
        var t = this.panels.spell.slotMap[e];
        if (t)
            for (var i = 0, n = t.length; i < n; i += 1)
                this._updateSpellSlotAvailability(t[i])
    }
    ,
    n.prototype.setAvailability = function(e) {
        this.overlay.toggleDisplay(!e),
        this.lockDrawer(!e)
    }
    ,
    n.prototype.deselectIcon = function() {
        this._unSelectSlot(this._selectedSlot)
    }
    ,
    n.prototype._updateSpellSlotAvailability = function(e) {
        var t;
        window.gui.gameContext === p.FIGHT && void 0 !== e.id ? (e.isDisabled = !window.gui.fightManager.canCastThisSpell(e.id),
        t = window.gui.fightManager.getSpellCooldown(e.id)) : (e.isDisabled = !1,
        t = 0),
        e.isDisabled && this._unSelectSlot(e),
        e.icon.toggleClassName("disabled", e.isDisabled),
        e.setCooldown(t)
    }
    ,
    n.prototype._updateWeaponSpell = function() {
        var e = window.gui.playerData.characters.mainCharacter.spellData.spells[I.WEAPON_SPELL_ID];
        if (!e)
            return console.warn("the player weapon spell has not been created yet");
        var t = this.panels.spell.slotMap[I.WEAPON_SPELL_ID];
        if (t)
            for (var i = 0; i < t.length; i++)
                t[i].setSpell(e)
    }
    ,
    n.prototype._isSlotIndexValid = function(e) {
        return e < D * L
    }
    ,
    n.prototype._setDragEnableItems = function(e) {
        for (var t = this.panels.item.slotList, i = 0; i < t.length; i++)
            this._setDragEnable(t[i], e)
    }
    ,
    n.prototype._setDragEnableSpells = function(e) {
        for (var t = this.panels.spell.slotList, i = 0; i < t.length; i++)
            this._setDragEnable(t[i], e)
    }
    ,
    n.prototype._onDrop = function(e, t, i, n) {
        function o(i) {
            var n = t.index
              , o = t.getParent()
              , s = t.x - e.x
              , l = t.y - e.y;
            return t.index = e.index,
            r.slotList[t.index] = e.getParent().appendChild(t),
            a._positionSlot(t, t.index),
            e.index = n,
            r.slotList[e.index] = o.appendChild(e),
            i || a._dragStartPage !== a._pagination.current ? (e.addClassNames("vibrate"),
            t.waitingForConfirmation = !1,
            a._positionSlot(e, e.index),
            void a._positionSlot(t, t.index)) : void S.tween(e, {
                webkitTransform: "translate3d(" + s + "px," + l + "px,0)"
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                a._positionSlot(e, e.index),
                e.addClassNames("vibrate"),
                window.dofus.sendMessage("ShortcutBarSwapRequestMessage", {
                    barType: t.type,
                    firstSlot: t.index,
                    secondSlot: e.index
                })
            })
        }
        function s(t) {
            window.gui.removeAllListeners("ShortcutBarAddErrorMessage");
            var i = e.shorcut
              , n = R[e.type];
            a._setShortcut(n, t),
            window.dofus.sendMessage("ShortcutBarAddRequestMessage", {
                barType: e.type,
                shortcut: t
            }),
            window.gui.once("ShortcutBarAddErrorMessage", function() {
                e.isEmpty ? a._removeShortcut(n, e.index) : a._setShortcut(n, i)
            })
        }
        if (!window.gui.fightManager.isInBattle() || !this.isLocked) {
            var a = this
              , r = this.panels[R[t.type]];
            if ("shortcutBar" === i)
                return e.index === t.index || t.waitingForConfirmation ? t.setStyle("webkitTransform", "translate3d(0,0,0)") : (t.waitingForConfirmation = !0,
                window.gui.removeAllListeners("ShortcutBarSwapErrorMessage"),
                e.delClassNames("vibrate"),
                o(),
                void window.gui.once("ShortcutBarSwapErrorMessage", o));
            switch (i) {
            case "characterBox":
            case "equipment":
                var l = t.itemInstance;
                s({
                    _type: "ShortcutObjectItem",
                    slot: e.index,
                    itemUID: l.objectUID,
                    itemGID: l.objectGID
                });
                break;
            case "presets":
                s({
                    _type: "ShortcutObjectPreset",
                    slot: e.index,
                    presetId: t.preset.presetId
                });
                break;
            case "spellsWindow":
                s({
                    _type: "ShortcutSpell",
                    slot: e.index,
                    spellId: n.spellId
                })
            }
        }
    }
    ,
    n.prototype._createSlot = function(e) {
        var t;
        t = "spell" === e ? this._createSpellSlot() : this._createItemSlot(),
        this._setDroppable(t, B[e], {
            matchPositionOnDrop: !0
        });
        var i = this;
        return t.on("drop", function(e, t, n) {
            i._onDrop(this, e, t, n)
        }),
        t.addClassNames("anim" + Math.round(9 * Math.random())),
        t
    }
    ,
    n.prototype._baseSlot = function(e) {
        var t = new e({
            scaleOnPress: !0
        });
        t.addClassNames("vibrate", "ShortcutSlot");
        var i = this;
        return t.on("dom.touchstart", function() {
            i.isLocked || this.delClassNames("vibrate")
        }),
        this._setDraggable(t, null , "shortcutBar", null , {
            dragOnTouchstart: !1,
            dragElement: !0
        }),
        t.on("dragStart", function() {
            i._dragStartPage = i._pagination.current,
            i.isLocked || i.addClassNames("dragging")
        }),
        t.on("dragEnd", function() {
            i.delClassNames("dragging"),
            this.isLocked || t.addClassNames("vibrate")
        }),
        this._disableDrag(t),
        t.on("removed", function() {
            window.gui.removeAllListeners("ShortcutBarRemoveErrorMessage");
            var e = this.shortcut
              , n = R[t.type];
            S.tween(this, {
                webkitTransform: "scale(0)"
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                i._removeShortcut(n, t.index),
                S.tween(t, {
                    webkitTransform: "scale(1)"
                }, {
                    time: 100,
                    easing: "ease-out"
                }),
                window.dofus.sendMessage("ShortcutBarRemoveRequestMessage", {
                    barType: t.type,
                    slot: t.index
                })
            }),
            window.gui.once("ShortcutBarRemoveErrorMessage", function() {
                i._setShortcut(n, e)
            })
        }),
        t.on("unset", function() {
            i._selectedSlot === t && i._unSelectSlot(t)
        }),
        t.on("setData", function() {
            i._selectedSlot === t && i._unSelectSlot(t)
        }),
        t
    }
    ,
    n.prototype._createItemSlot = function() {
        var e = this._baseSlot(v);
        this._setDragEnable(e, !this.isLocked);
        var t = this;
        return e.on("tap", function() {
            var e = !0;
            t._selectSlot(this, e)
        }),
        e
    }
    ,
    n.prototype._createSpellSlot = function() {
        var e = this._baseSlot(b);
        this._updateSpellSlotAvailability(e);
        var t = this;
        return e.on("tap", function() {
            if (!this.isDisabled) {
                var e = !0;
                t._selectSlot(this, e)
            }
        }),
        this._setDragEnable(e, !this.isLocked && window.gui.playerData.characters.isMainCharacterControlled()),
        e
    }
    ,
    n.prototype._createPanel = function(e) {
        var t = new C({
            noHeader: !0
        })
          , i = t.slotList = new Array(D * L);
        t.slotMap = {};
        for (var n = 0; n < L; n += 1) {
            var o = new A("div",{
                className: "page"
            });
            t.addTab("", o, n);
            for (var s = 0; s < D; s += 1) {
                var a = this._createSlot(e);
                this._disableDrag(a);
                var r = n * D + s;
                i[r] = o.appendChild(a),
                this._positionSlot(a, r)
            }
        }
        return t.openTab(0),
        t
    }
    ,
    n.prototype.lockDrag = function(e) {
        if (this.isLocked = e,
        this.toggleClassName("draggable", !e),
        this._setDragEnableItems(!this.isLocked),
        this._setDragEnableSpells(!this.isLocked),
        e)
            this.spellBtn.enable(),
            this.itemBtn.enable(),
            null !== this.toolbarSwitched ? (this.shouldKeepOpen = !1,
            window.gui.resizeToolbar(!this.toolbarSwitched),
            this.toolbarSwitched = null ) : this.close();
        else {
            this.spellBtn.disable(),
            this.itemBtn.disable();
            var t = "spell" === this.currentPanelType
              , i = m.menubarSizeInFight !== m.menubarSize
              , n = t !== window.gui.playerData.isFighting;
            if (i && n) {
                this.toolbarSwitched = t,
                this.shouldKeepOpen = !0;
                var o = t ? "tablet.nowShowingFightToolbar" : "tablet.nowShowingRpToolbar";
                T.showNotification(f(o), this),
                window.gui.showFightingToolbar(t)
            }
        }
    }
    ,
    n.prototype.getSlot = function(e, t) {
        var i = this.panels[e];
        if (i)
            return i.slotList[t]
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            s.setCurrent(e)
        }
        var t = this;
        this.overlay = this.content.createChild("div", {
            className: "overlay",
            hidden: !0
        });
        var i = this._panelBox = this.content.createChild("div", {
            className: "panelBox"
        });
        this.panels = {};
        var n;
        n = this.panels.spell = i.appendChild(this._createPanel("spell")),
        n.on("openTab", e),
        n = this.panels.item = i.appendChild(this._createPanel("item")),
        n.on("openTab", e),
        this.arrowNeg = this.appendChild(a("negative", function() {
            t.panel.swipeNegative()
        })),
        this.arrowPos = this.appendChild(a("positive", function() {
            t.panel.swipePositive()
        })),
        this.on("panel", function() {
            s.setCurrent(t.panel.currentTab.id)
        });
        var o = this._buttonBox = this.content.createChild("div", {
            className: "buttonBox"
        });
        this.spellBtn = o.appendChild(new c({
            className: "spellBtn",
            tooltip: f("ui.charcrea.spells"),
            sound: "BANNER_SPELL_TAB"
        },function() {
            t.openPanel("spell")
        }
        )),
        this.itemBtn = o.appendChild(new c({
            className: "itemBtn",
            tooltip: f("ui.common.objects"),
            sound: "BANNER_SPELL_TAB"
        },function() {
            t.openPanel("item")
        }
        ));
        var s = this._pagination = o.appendChild(new w({
            disableInput: !0,
            soundPrev: "SCROLL_DOWN",
            soundNext: "SCROLL_UP"
        }));
        s.setPageCount(L),
        s.setCurrent(0),
        s.on("next", function() {
            t.panel.openTab(this.current + 1)
        }),
        s.on("previous", function() {
            t.panel.openTab(this.current - 1)
        }),
        this._lockBtn = o.appendChild(new c({
            className: "lockBtn",
            scaleOnPress: !0
        },function() {
            window.gui.playerData.characters.isMainCharacterControlled() && t.lockDrag(!t.isLocked)
        }
        )),
        this.isLocked = !0,
        this.openPanel("spell");
        var r = this.trashZone = this.createChild("div", {
            className: "trashZone"
        });
        r.createChild("div", {
            className: "trashBin",
            text: f("ui.common.remove")
        }),
        this._setDroppable(r, ["shortcutBar"]),
        r.on("drop", function(e) {
            window.gui.removeAllListeners("ShortcutBarRemoveErrorMessage");
            var i = this.shortcut
              , n = R[e.type];
            S.tween(e, {
                opacity: 0
            }, {
                time: 100,
                easing: "ease-out"
            }, function() {
                t._removeShortcut(n, e.index),
                e.setStyles({
                    webkitTransform: "scale(0)",
                    opacity: 1
                }),
                S.tween(e, {
                    webkitTransform: "scale(1)"
                }, {
                    time: 100,
                    easing: "ease-out"
                }),
                window.dofus.sendMessage("ShortcutBarRemoveRequestMessage", {
                    barType: e.type,
                    slot: e.index
                })
            }),
            window.gui.once("ShortcutBarRemoveErrorMessage", function() {
                e.setStyles({
                    webkitTransform: "scale(1)",
                    opacity: 1
                }),
                t._setShortcut(n, i)
            })
        })
    }
    ,
    n.prototype._setShortcut = function(e, t) {
        if (!this._isSlotIndexValid(t.slot))
            return null ;
        var i = this.panels[e]
          , n = i.slotList[t.slot];
        return n.id === O[e].getId(t) ? n : (this._selectedSlot === n && this._unSelectSlot(n),
        s(n, i.slotMap),
        n.setShortcut(t),
        o(n, i.slotMap),
        T.enableTooltip(n, !n.isEmpty && this.isLocked),
        this._setDragEnable(n, !this.isLocked),
        n)
    }
    ,
    n.prototype._removeShortcut = function(e, t) {
        if (this._isSlotIndexValid(t)) {
            var i = this.panels[e]
              , n = i.slotList[t];
            if (!n.isEmpty)
                return s(n, i.slotMap),
                this._selectedSlot === n && this._unSelectSlot(n),
                n.unset(),
                this._setDragEnable(n, !1),
                n
        }
    }
    ,
    n.prototype._setupEvents = function() {
        function e(e, t) {
            function i() {
                r._setPanelContent(e, t),
                r.emit("panelLoaded", e, o)
            }
            var n, o = window.gui.playerData.characters.getControlledCharacter();
            if ("spell" === e) {
                n = o.spellData;
                var s = r.panels.spell.slotMap[I.WEAPON_SPELL_ID];
                if (s) {
                    for (var a = 0; a < s.length; a += 1)
                        s[a].unset();
                    r.panels.spell.slotMap[I.WEAPON_SPELL_ID] = []
                }
            } else
                n = window.gui.playerData.inventory;
            l[e] && n.removeListener("loaded", l[e]),
            n.isLoaded ? i() : (r._setPlaceHolder(e, t),
            l[e] = i,
            n.once("loaded", i))
        }
        function t(e) {
            for (var t = window.gui.playerData.characters.getControlledCharacter(), i = t.spellShortcuts, n = null , o = 0; o < i.length; o++)
                if (i[o].slot === e.slot) {
                    n = o;
                    break
                }
            null !== n ? i[n].slot = e : i.push(e)
        }
        function i(e) {
            for (var t = 0, i = e.length; t < i; t += 1) {
                var n = r.panels.item.slotMap["item" + e[t]];
                if (n)
                    for (var o = 0, s = n.length; o < s; o += 1) {
                        var a = n[o];
                        a.icon.addClassNames("disabled"),
                        a.isDisabled = !0
                    }
            }
        }
        function n(e) {
            for (var t in e) {
                var i = r.panels.item.slotMap["item" + t];
                if (i)
                    for (var n = e[t], o = 0, s = i.length; o < s; o += 1)
                        i[o].setQuantity(n)
            }
        }
        function o(e) {
            for (var t in e) {
                var i = r.panels.item.slotMap["item" + t];
                if (i)
                    for (var n = 0, o = i.length; n < o; n += 1) {
                        var s = i[n];
                        s.setShortcut({
                            itemUID: t
                        })
                    }
            }
        }
        function s() {
            r.updateSpellsAvailability()
        }
        var a = window.gui
          , r = this;
        a.on("disconnect", function() {
            r.close(),
            r.delClassNames("dragging"),
            r._selectedSlot = null ,
            r._emptyPanel("spell"),
            r._emptyPanel("item"),
            r.currentCharacterId = null
        });
        var l = {};
        this.requestSpellsAvailibilityUpdate = null ,
        this.requestSpellAvailibilityUpdate = null ,
        this.currentCharacterId = null ,
        this.on("panelLoaded", function(e, t) {
            "spell" === e && (this.currentCharacterId = t.spellData.characterId,
            this.requestSpellsAvailibilityUpdate ? this.updateSpellsAvailability() : this.requestSpellAvailibilityUpdate && this.updateSpellAvailability(r.requestSpellAvailibilityUpdate),
            this.requestSpellsAvailibilityUpdate = !1,
            this.requestSpellAvailibilityUpdate = !1)
        }),
        a.on("ShortcutBarContentMessage", function(t) {
            if (t.barType === N) {
                var i = window.gui.playerData.characters.getControlledCharacter();
                i.spellShortcuts = t.shortcuts,
                i.emit("spellShortcuts")
            }
            e(R[t.barType], t.shortcuts)
        }),
        a.on("ShortcutBarRefreshMessage", function(e) {
            if (r._isSlotIndexValid(e.shortcut.slot)) {
                var i = r._setShortcut(R[e.barType], e.shortcut);
                i.waitingForConfirmation = !1,
                e.barType === N && t(e.shortcut)
            }
        }),
        a.on("ShortcutBarRemovedMessage", function(e) {
            r._removeShortcut(R[e.barType], e.slot)
        });
        var c = a.playerData.characters;
        c.on("switchControlledCharacter", function() {
            var t = a.playerData.characters.getControlledCharacter();
            return t.spellShortcuts ? void e("spell", t.spellShortcuts) : t.once("spellShortcuts", function() {
                e("spell", t.spellShortcuts)
            })
        }),
        c.mainCharacter.on("spellsUpdate", function() {
            r.currentCharacterId === this.spellData.characterId && r._setPanelContent("spell", this.spellShortcuts)
        }),
        c.mainCharacter.on("spellUpgrade", function(e, t) {
            if (!(r.currentCharacterId !== this.spellData.characterId || t <= 1))
                for (var i = r.panels.spell.slotMap[e], n = 0; n < i.length; n += 1) {
                    var o = i[n];
                    o.setShortcut(o.shortcut)
                }
        }),
        c.mainCharacter.on("weaponChanged", function() {
            r.currentCharacterId === this.spellData.characterId && r._updateWeaponSpell()
        });
        var u = a.playerData.inventory;
        u.on("presetUpdated", function(e) {
            var t = this.presets[e]
              , i = r.panels.item.slotMap["preset" + e];
            if (i)
                for (var n = 0; n < i.length; n += 1)
                    i[n].setShortcut(t)
        }),
        u.on("itemDeleted", function(e) {
            i([e])
        }),
        u.on("itemDeleted", i),
        u.on("itemQuantity", function(e, t) {
            var i = {};
            i[e] = t,
            n(i)
        }),
        u.on("itemsQuantity", n),
        u.on("itemAdded", function(e) {
            var t = {};
            t[e.objectUID] = e,
            o(e)
        }),
        u.on("itemsAdded", o),
        a.playerData.on("actionPointsCurrentUpdated", s),
        a.fightManager.on("UpdatePreFightersList", s),
        a.fightManager.on("TurnCountUpdated", s),
        a.fightManager.on("updateSpellsAvailability", s),
        a.fightManager.on("fightEnterPreparation", function() {
            r.openPanel("item")
        }),
        r.addClassNames("notInFight"),
        a.fightManager.on("fightEnterBattle", function() {
            r._fightEntered()
        }),
        a.fightManager.on("fightEnd", function() {
            r._fightExited(),
            r._unSelectSlot(r._selectedSlot)
        }),
        this.on("open", function() {
            E("WINDOW_OPEN")
        }),
        this.on("close", function() {
            E("WINDOW_CLOSE"),
            this.isLocked || this.lockDrag(!0)
        })
    }
    ,
    n.prototype._fightEntered = function() {
        this.delClassNames("notInFight"),
        this.openPanel("spell"),
        this._enableSlotContextMenus(!1),
        this._turnOnDragToCast()
    }
    ,
    n.prototype._fightExited = function() {
        this.addClassNames("notInFight"),
        this.openPanel("item"),
        this._enableSlotContextMenus(!0),
        this._turnOffDragToCast()
    }
    ,
    n.prototype._turnOnDragToCast = function() {
        this._setDragEnableSpells(!0)
    }
    ,
    n.prototype._turnOffDragToCast = function() {
        this._setDragEnableSpells(!this.isLocked)
    }
    ,
    n.prototype._setDroppable = function(e, t, i) {
        var n = this;
        i = i || {},
        i.isAllowed = function() {
            return !(window.gui.fightManager.isInBattle() && n.isLocked)
        }
        ,
        d.setDroppable(e, t, i)
    }
    ,
    n.prototype._disableDrag = function(e) {
        window.gui.fightManager.isInBattle() || d.disableDrag(e)
    }
    ,
    n.prototype._setDragEnable = function(e, t) {
        d.setDragEnable(e, (t || window.gui.fightManager.isInBattle()) && !e.isEmpty)
    }
    ,
    n.prototype._setDraggable = function(e, t, i, n, o) {
        o.noHover = !0,
        d.setDraggable(e, t, i, n, o);
        var s = this;
        e.on("dragMove", function(t, i) {
            var n = window.gui.fightManager.isInBattle();
            n && s.isLocked && window.background.colorCurrentDragCell(t, i, e)
        }),
        e.on("dragStart", function() {
            window.gui.fightManager.isInBattle() && s.isLocked && (s._selectSlot(e, !1),
            e.customScale = 1,
            e.customXOffset = 0,
            e.customYOffset = -24,
            e.customRotation = 45)
        }),
        e.on("dragEnd", function(t, i) {
            var n = window.gui.fightManager.isInBattle();
            n && s.isLocked && (window.background.dragCellRelease(t, i, e),
            window.foreground.confirmBox.isOpen || s._unSelectSlot(e),
            e.customScale = null ,
            e.customXOffset = null ,
            e.customYOffset = null ,
            e.customRotation = null )
        })
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        GENERAL_SHORTCUT_BAR: 0,
        SPELL_SHORTCUT_BAR: 1
    }
}
, function(e, t, i) {
    function n(e) {
        c.call(this, e),
        this.type = s.GENERAL_SHORTCUT_BAR,
        this.index = 0,
        this.id = null ,
        this.isDisabled = !1,
        this.isEmpty = !0,
        this.addClassNames("empty"),
        this.on("unset", function() {
            this.isEmpty = !0,
            this.id = null ,
            this.isDisabled = !1,
            a.disableDrag(this),
            this.icon.delClassNames("disabled"),
            this.addClassNames("empty")
        }),
        this.on("setData", function() {
            this.delClassNames("empty"),
            this.isEmpty = !1
        })
    }
    var o = i(5)
      , s = i(565)
      , a = i(186)
      , r = i(26).inherits
      , l = i(323)
      , c = i(567);
    r(n, c),
    e.exports = n,
    n.getId = function(e) {
        return e.hasOwnProperty("presetId") ? "preset" + e.presetId : "item" + e.itemUID
    }
    ,
    n.prototype.setShortcut = function(e) {
        function t(e) {
            "remove" === e && s.emit("removed")
        }
        if (!e)
            return void (this.isEmpty || this.unset());
        var i = window.gui.playerData.inventory
          , s = this;
        if (this.shortcut = e,
        this.id = n.getId(e),
        e.hasOwnProperty("presetId")) {
            var a = i.presets[e.presetId];
            this.isDisabled = !1,
            o.preloadImage("gfx/presets/icon_" + a.symbolId + ".png", function(e) {
                s.setImage(e)
            }),
            this.setData(a),
            this.icon.delClassNames("disabled"),
            this.setContextMenu("preset", {
                presetId: e.presetId,
                canRemove: !0,
                onClose: t
            })
        } else {
            var r = i.objects[e.itemUID];
            if (r) {
                if (!r.isInitialised)
                    return r.once("initialised", function() {
                        s.setShortcut(e)
                    });
                this.isDisabled = !1,
                this.icon.delClassNames("disabled"),
                this.setContextMenu("item", {
                    item: r,
                    onClose: t,
                    remove: !0,
                    enableActions: !0
                }),
                this.setItem(r)
            } else
                this.isDisabled = !0,
                this.icon.addClassNames("disabled"),
                l.getItems([e.itemGID], function(e, i) {
                    if (e)
                        return console.error(e);
                    var n = i[0];
                    s.setContextMenu("item", {
                        item: n,
                        onClose: t,
                        remove: !0,
                        enableActions: !0
                    }),
                    s.setItem(n)
                })
        }
    }
}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        o.call(this, e),
        this.addClassNames("ItemSlot"),
        this.itemTypeStyle = "",
        this.descriptionOptions = e.descriptionOptions,
        this.setItem(e.itemData, e.quantity)
    }
    i(568);
    var o = i(569)
      , s = i(395)
      , a = i(206)
      , r = i(26).inherits
      , l = i(5)
      , c = 0
      , u = [1, 9, 10, 11, 16, 17, 81, 26, 78];
    r(n, o),
    e.exports = n,
    n.prototype._getContextualMenuProperties = function() {
        return this._contextMenuParams.item = this.data,
        o.prototype._getContextualMenuProperties.call(this)
    }
    ,
    n.prototype.setItem = function(e, t) {
        if (!e)
            return this.unset();
        this._itemData = e,
        this.itemInstance = e.getItemInstance(),
        this.dbItem = e.getItem();
        var i = e.getProperty("image");
        t = t || e.getProperty("quantity") || 1,
        this.setImage(i),
        this.setQuantity(t),
        this.setDescriptionTooltip(this.descriptionOptions),
        this.setData(e)
    }
    ,
    n.prototype.unset = function() {
        o.prototype.unset.call(this),
        this._itemData = null ,
        this.itemInstance = null ,
        this.dbItem = null
    }
    ,
    n.prototype.lock = function() {
        var e = this;
        this.unset(),
        l.preloadImage("ui/slots/tx_slotLockedimg.png", function(t) {
            e.setImage(t)
        })
    }
    ,
    n.prototype.setDescriptionTooltip = function(e, t) {
        return this.descriptionOptions = e || this.descriptionOptions,
        this.hasTooltip ? void a.enableTooltip(this, !0) : void this.setTooltip(this._getTooltipContent, t)
    }
    ,
    n.prototype._getTooltipContent = function() {
        return new s(this._itemData,this.descriptionOptions)
    }
    ,
    n.prototype.setBackgroundImageByItemType = function(e) {
        u.indexOf(e) === -1 && (e = c);
        var t = "itemType" + e;
        this.replaceClassNames([this.itemTypeStyle], [t]),
        this.itemTypeStyle = t
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        r.call(this, "div", {
            className: "Slot",
            name: e.name || ""
        }),
        a(this),
        this._quantity = 0,
        e.errorIcon && (this.errorIcon = this.createChild("div", {
            className: "errorIcon"
        })),
        this.icon = this.createChild("div", {
            className: "slotIcon"
        }),
        this.quantityBox = this.createChild("div", {
            className: "quantity"
        }),
        this.forceQuantity = e.forceQuantity,
        e.quantity && this.setQuantity(e.quantity),
        e.image && this.setImage(e.image),
        this.tooltipOptions = e.tooltipOptions,
        e.tooltip && this.setTooltip(e.tooltip, this.tooltipOptions),
        this.on("destroy", this._onDestroy),
        this.on("tap", this._openContextMenu),
        this.on("doubletap", this._useItem),
        this.on("tooltipOn", this._removeHoverStyle),
        this.on("tooltipOut", this._applyHoverStyle),
        e.scaleOnPress && (this.on("tapstart", this._showAsPressed),
        this.on("tapend", this._showAsReleased)),
        this.enableContextMenu(!e.hasOwnProperty("enableContextMenu") || e.enableContextMenu)
    }
    i(570);
    var o = i(206)
      , s = i(26).inherits
      , a = i(32)
      , r = i(190)
      , l = i(5)
      , c = i(35).getText
      , u = i(323).isEquippable;
    s(n, r),
    e.exports = n,
    n.prototype._onDestroy = function() {
        this.destroyed = !0
    }
    ,
    n.prototype._openContextMenu = function() {
        this._contextMenuId && this.isContextEnabled && window.gui.openContextualMenuAround(this._contextMenuId, this, this._getContextualMenuProperties())
    }
    ,
    n.prototype._useItem = function() {
        if (this.itemInstance) {
            var e = this.itemInstance;
            if (e.getProperty("usable")) {
                if (!e.getProperty("type").needUseConfirm)
                    return void window.dofus.sendMessage("ObjectUseMessage", {
                        objectUID: e.getProperty("objectUID")
                    });
                window.gui.openConfirmPopup({
                    title: c("ui.common.confirm"),
                    message: c("ui.common.confirmationUseItem", e.getProperty("nameId")),
                    cb: function(t) {
                        t && window.dofus.sendMessage("ObjectUseMessage", {
                            objectUID: e.getProperty("objectUID")
                        })
                    }
                })
            } else
                u(e.getProperty("type").superTypeId) && window.gui.playerData.inventory.equipItem(e.getProperty("objectUID"))
        }
    }
    ,
    n.prototype._showAsPressed = function() {
        this.data && this.icon.setStyle("webkitTransform", "scale(0.9)")
    }
    ,
    n.prototype._showAsReleased = function() {
        this.icon.setStyle("webkitTransform", "scale(1)")
    }
    ,
    n.prototype._removeHoverStyle = function() {
        this.icon.setStyle("webkitTransform", "scale(1.1)")
    }
    ,
    n.prototype._applyHoverStyle = function() {
        this.icon.setStyle("webkitTransform", "scale(1)")
    }
    ,
    n.prototype._getContextualMenuProperties = function() {
        return this._contextMenuParams
    }
    ,
    n.prototype.unset = function() {
        o.enableTooltip(this, !1),
        this.quantityBox.hide(),
        this.setContextMenu(),
        this.setImage(),
        this.setData(),
        this.emit("unset")
    }
    ,
    n.prototype.setQuantity = function(e) {
        this._quantity = e,
        this.quantityBox.setText(e),
        this.quantityBox.toggleDisplay(!!this.forceQuantity || e && e > 1)
    }
    ,
    n.prototype.getQuantity = function() {
        return this._quantity
    }
    ,
    n.prototype.select = function(e) {
        e = !arguments.length || e,
        this.toggleClassName("selected", e),
        this.selected = e,
        this.emit("selected", e)
    }
    ,
    n.prototype.setImage = function(e) {
        return this.rootElement ? (this.image = e,
        e = e || "none",
        this.icon.setStyle("backgroundImage", e),
        this.loadingImage = !1,
        this.requestedImages = null ,
        void this.emit("setImage", this.image)) : console.warn("trying to set an image on a destroyed object")
    }
    ,
    n.prototype.getImage = function() {
        return this.image
    }
    ,
    n.prototype.setTooltip = function(e, t) {
        return this.hasTooltip ? void o.enableTooltip(this, !0) : (o.addTooltip(this, e, t || this.tooltipOptions),
        void (this.hasTooltip = !0))
    }
    ,
    n.prototype.setContextMenu = function(e, t) {
        this._contextMenuId = e,
        this._contextMenuParams = t
    }
    ,
    n.prototype.setData = function(e) {
        this.data = e,
        e && this.emit("setData", this.data)
    }
    ,
    n.prototype.preloadAndSetImages = function(e) {
        e = e || [],
        this.requestedImages = e;
        var t = this;
        this.loadingImage = !0,
        l.preloadImages(e, function(i) {
            if (t.requestedImages === e && !this.destroyed) {
                for (var n = "none", o = 0; o < i.length && (n = i[o],
                "none" === n); o += 1)
                    ;
                t.loadingImage && t.setImage(n)
            }
        })
    }
    ,
    n.prototype.enableContextMenu = function(e) {
        this.isContextEnabled = !arguments.length || e
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        var n = new l({
            className: ["arrow", e],
            repeatDelay: c,
            sound: i
        },function() {
            t.emit(e)
        }
        );
        return t.appendChild(n)
    }
    function o(e) {
        r.call(this, "div", {
            className: "PaginationUI"
        }),
        e = e || {},
        this._leftArrow = n("previous", this, e.soundPrev),
        this._centeringContainer = this.createChild("div", {
            className: "centeringContainer"
        });
        var t = this._numberInputBox = this._centeringContainer.appendChild(new a);
        this.isInputDisabled = !!e.disableInput,
        t.setReadonly(this.isInputDisabled);
        var i = this;
        t.on("change", function(e) {
            i.emit("page", e - 1)
        }),
        this._pageCountLabel = this._centeringContainer.createChild("div", {
            className: "pageCount"
        }),
        this._rightArrow = n("next", this, e.soundNext)
    }
    i(572);
    var s = i(26).inherits
      , a = i(208)
      , r = i(190)
      , l = i(204)
      , c = 200;
    s(o, r),
    o.prototype.setDirection = function(e) {
        this.toggleClassName("vertical", "vertical" === e)
    }
    ,
    o.prototype._checkPosition = function() {
        this._leftArrow.setEnable(0 !== this.current),
        this._rightArrow.setEnable(this.current < this._pageCount - 1);
        var e = this._pageCount <= 1 || this.isInputDisabled;
        this._numberInputBox.setReadonly(e),
        this._centeringContainer.toggleClassName("readOnly", e)
    }
    ,
    o.prototype.setCurrent = function(e) {
        this.current = e,
        this._numberInputBox.setValue(e + 1),
        this._checkPosition()
    }
    ,
    o.prototype.setPageCount = function(e) {
        this._numberInputBox.maxValue = e,
        this._pageCount = e,
        this._pageCountLabel.setText("/ " + e),
        this._checkPosition()
    }
    ,
    e.exports = o
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        r.call(this, e),
        this.type = o.SPELL_SHORTCUT_BAR,
        this.index = 0,
        this.id = null ,
        this.isDisabled = !1,
        this.isEmpty = !0,
        this.addClassNames("empty"),
        this.on("selected", function(e) {
            e && void 0 !== this.id ? window.gui.emit("spellSlotSelected", this.id) : window.gui.emit("spellSlotDeselected")
        }),
        this.on("unset", function() {
            this.isEmpty = !0,
            this.id = null ,
            this.isDisabled = !1,
            s.disableDrag(this),
            this.delClassNames("disabled"),
            this.addClassNames("empty")
        }),
        this.on("setData", function() {
            this.delClassNames("empty"),
            this.isEmpty = !1
        })
    }
    var o = i(565)
      , s = i(186)
      , a = i(26).inherits
      , r = i(574)
      , l = i(281);
    a(n, r),
    e.exports = n,
    n.getId = function(e) {
        return parseInt(e.spellId, 10)
    }
    ,
    n.prototype.setShortcut = function(e) {
        var t = this;
        if (!e)
            return void (this.isEmpty || this.unset());
        var i = window.gui.playerData.characters.getControlledCharacter()
          , o = i.spellData.spells[e.spellId];
        return this.shortcut = e,
        this.id = n.getId(e),
        o ? (this.setSpell(o),
        void this.setContextMenu("spell", {
            spell: o,
            canRemove: !0,
            onClose: function(e) {
                "remove" === e && t.emit("removed")
            }
        })) : e.spellId === l.WEAPON_SPELL_ID ? console.error(new Error("Controlled character does not have a weapon spell but a setShortcut on spellId " + e.spellId + " has been requested")) : window.gui.playerData.characters.mainCharacter.spellData.on("loaded", function() {
            return t.setShortcut(e)
        })
    }
}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        o.call(this, e),
        this.addClassNames("SpellSlot"),
        this.setSpell(e.spellData, e.descriptionOptions),
        this.customScale = null ,
        this.customXOffset = null ,
        this.customYOffset = null ,
        this.customRotation = null
    }
    i(575);
    var o = i(569)
      , s = i(281)
      , a = i(576)
      , r = i(26).inherits
      , l = i(5);
    r(n, o),
    e.exports = n,
    n.prototype.setSpell = function(e, t) {
        if (this.descriptionOptions = t || this.descriptionOptions,
        !e)
            return this.unset();
        var i = this.spellInstance = e._uid ? e : null
          , n = this.dbSpell = i ? i.spell : e
          , o = this;
        if (i && i.isItem) {
            var a = i._item;
            if (!a.isInitialised)
                return a.once("initialised", function() {
                    o.setSpell(e)
                });
            this.setImage(a.item.image)
        } else
            n.image ? this.setImage(n.image) : (this.setImage(s.placeHolder),
            l.preloadImage("gfx/spells/sort_" + n.iconId + ".png", function(e) {
                n.image = e,
                o.setImage(n.image)
            }));
        this.setTooltip(this._getTooltipContent),
        this.setData(e)
    }
    ,
    n.prototype._getTooltipContent = function() {
        return new a({
            spell: this.spellInstance || this.dbSpell
        },this.descriptionOptions)
    }
    ,
    n.prototype.setCooldown = function(e) {
        this.quantityBox.setText(e),
        this.quantityBox.toggleDisplay(e > 0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        if (t = t || {},
        S.call(this, "div", t),
        this.addClassNames("SpellDescription"),
        this._buildDomElements(t),
        this.visibilityBoundToOptions = !t.visibilityOptions && !t.spellTooltipAll,
        this.visibilityOptions = t.visibilityOptions || {},
        t.spellTooltipAll)
            for (var i in E)
                this.visibilityOptions[i] = !0;
        this.updateVisibleBlocks(!0),
        this.updateUI(e)
    }
    function o(e) {
        this._domElements.spellName.setText(e.getName())
    }
    function s(e, t) {
        var i = e.getProperty("apCost", t)
          , n = e.getProperty("minRange", t)
          , o = e.getProperty("range", t);
        this._domElements.points.ap.setText(I("ui.common.ap") + " : " + i),
        this._domElements.points.ra.setText(I("ui.common.ra") + " : " + n),
        o !== n ? this._domElements.points.range.setText(" - " + o) : this._domElements.points.range.clearContent()
    }
    function a(e, t) {
        var i = e.getProperty("criticalHitProbability", t);
        i > 0 ? this._domElements.criticalHit.setText(I("ui.common.short.CriticalHit") + ": 1/" + i) : this._domElements.criticalHit.clearContent()
    }
    function r(e) {
        var t = e.getHumanReadableZoneInfo();
        t.length ? this._domElements.areaOfEffect.setText(I("ui.common.spellArea") + ": " + t) : this._domElements.areaOfEffect.setText(t)
    }
    function l(e, t) {
        this._domElements.level.setText(I("ui.common.level") + " " + e.getProperty("grade", t))
    }
    function c(e, t) {
        0 !== e.getProperty("typeId", t) ? this._domElements.breed.setText(I("ui.common.breedSpell") + ": " + e.getHumanReadableSpellType()) : this._domElements.breed.clearContent()
    }
    function u(e, t) {
        e.getProperty("rangeCanBeBoosted", t) ? this._domElements.rangeBoost.setText(I("ui.spell.rangeBoost")) : this._domElements.rangeBoost.clearContent()
    }
    function h(e, t) {
        !e.getProperty("castTestLos", t) && e.getProperty("range", t) ? this._domElements.castWithoutLos.setText(I("ui.spellInfo.castWithoutLos")) : this._domElements.castWithoutLos.clearContent()
    }
    function d(e, t) {
        e.getProperty("castInLine", t) ? this._domElements.castInLine.setText(I("ui.spellInfo.castInLine")) : this._domElements.castInLine.clearContent()
    }
    function p(e, t) {
        var i = e.getProperty("maxCastPerTurn", t);
        i > 0 ? this._domElements.maxCastPerTurn.setText(I("ui.spellInfo.maxCastPerTurn") + ": " + i) : this._domElements.maxCastPerTurn.clearContent()
    }
    function m(e, t) {
        var i = e.getProperty("maxCastPerTarget", t);
        i > 0 ? this._domElements.maxCastPerTarget.setText(I("ui.spellInfo.maxCastPerTarget") + ": " + i) : this._domElements.maxCastPerTarget.clearContent()
    }
    function f(e, t) {
        e.getProperty("maxStack", t) > 0 ? this._domElements.maxStack.setText(I("ui.spellInfo.maxStack") + ": " + e.getProperty("maxStack", t)) : this._domElements.maxStack.clearContent()
    }
    function g(e, t) {
        var i = e.getProperty("minCastInterval", t);
        i > 0 ? this._domElements.minCastInterval.setText(I("ui.spellInfo.minCastInterval") + ": " + i) : this._domElements.minCastInterval.clearContent()
    }
    function _(e, t) {
        e.getProperty("globalCooldown", t) === -1 ? this._domElements.globalCooldown.setText(I("ui.spellInfo.globalCastInterval")) : this._domElements.globalCooldown.clearContent()
    }
    function v(e, t) {
        var i = e.getProperty("statesForbidden", t);
        if (i && i.length > 0) {
            this._domElements.forbiddenStates.createChild("span", {
                text: I("ui.spellInfo.stateForbidden") + ":"
            });
            for (var n = 0; n < i.length; n++)
                this._domElements.forbiddenStates.createChild("span", {
                    text: " " + e._tables.spellStates[i[n]].nameId
                })
        } else
            this._domElements.forbiddenStates.clearContent()
    }
    function y(e, t) {
        var i = e.getProperty("statesRequired", t);
        if (i && i.length > 0) {
            this._domElements.requiredStates.createChild("span", {
                text: I("ui.spellInfo.stateRequired") + ":"
            });
            for (var n = 0; n < i.length; n++)
                this._domElements.requiredStates.createChild("span", {
                    text: " " + e._tables.spellStates[i[n]].nameId
                })
        } else
            this._domElements.requiredStates.clearContent()
    }
    function w(e, t) {
        this._domElements.effectsAndDamage.setEffectsFromSpell(e, t)
    }
    function b(e, t) {
        this._domElements.description.setText(e.getProperty("descriptionId", t))
    }
    i(577);
    var C = i(397)
      , I = i(35).getText
      , T = i(26).inherits
      , S = i(190)
      , A = i(25)
      , E = {
        spellTooltipName: ["spellName"],
        spellTooltipApRange: ["pointsLine"],
        spellTooltipCritical: ["criticalHit"],
        spellTooltipEffect: ["areaOfEffect", "level", "breed", "rangeBoost", "castWithoutLos", "castInLine", "maxStack", "maxCastPerTarget", "maxCastPerTurn", "minCastInterval", "globalCooldown", "forbiddenStates", "requiredStates", "effectsAndDamage"],
        spellTooltipDescription: ["description"]
    };
    T(n, S),
    e.exports = n,
    n.prototype.updateVisibleBlocks = function(e) {
        var t = this._domElements;
        for (var i in E) {
            var n = this.visibilityOptions[i]
              , o = this.visibilityBoundToOptions ? A[i] : !!this.visibilityOptions[i];
            if (e || o !== n) {
                this.visibilityOptions[i] = o;
                for (var s = E[i], a = 0; a < s.length; a++)
                    t[s[a]].toggleDisplay(o)
            }
        }
    }
    ,
    n.prototype._buildDomElements = function(e, t) {
        var i = this._domElements = {};
        i.spellName = this.createChild("div", {
            className: "spellName"
        }),
        i.pointsLine = this.createChild("div", {
            className: "pointsLine"
        }),
        i.points = {
            ap: i.pointsLine.createChild("span", {
                className: "ap"
            }),
            ra: i.pointsLine.createChild("span", {
                className: "ra"
            }),
            range: i.pointsLine.createChild("span")
        },
        i.criticalHit = this.createChild("div"),
        i.areaOfEffect = this.createChild("div"),
        i.level = this.createChild("div"),
        i.breed = this.createChild("div"),
        i.rangeBoost = this.createChild("div"),
        i.castWithoutLos = this.createChild("div"),
        i.castInLine = this.createChild("div"),
        i.maxStack = this.createChild("div"),
        i.maxCastPerTarget = this.createChild("div"),
        i.maxCastPerTurn = this.createChild("div"),
        i.minCastInterval = this.createChild("div"),
        i.globalCooldown = this.createChild("div"),
        i.forbiddenStates = this.createChild("div"),
        i.requiredStates = this.createChild("div"),
        i.effectsAndDamage = this.appendChild(new C(t)),
        i.description = this.createChild("div", {
            className: "description"
        })
    }
    ,
    n.prototype.updateUI = function(e) {
        if (e && e.spell && e.spell.isLoaded) {
            this.updateVisibleBlocks();
            var t = e.spell
              , i = void 0 !== e.level ? e.level : t.level;
            o.call(this, t),
            s.call(this, t, i),
            a.call(this, t, i),
            r.call(this, t),
            l.call(this, t, i),
            c.call(this, t, i),
            u.call(this, t, i),
            h.call(this, t, i),
            d.call(this, t, i),
            p.call(this, t, i),
            m.call(this, t, i),
            f.call(this, t, i),
            g.call(this, t, i),
            _.call(this, t, i),
            y.call(this, t, i),
            v.call(this, t, i),
            w.call(this, t, i),
            b.call(this, t, i)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return e ? (d.call(this, "div", e),
        this.isAlive = !0,
        this.tweener = null ,
        this.timeout = null ,
        this.isLocked = e.isLocked,
        this.msgPages = null ,
        this.currentPage = 0,
        this._createContent(e),
        this.closeFunc = this.close.bind(this),
        this.actionHandler = e.action,
        this.closeHandler = e.onClose,
        e.title && this.setTitle(e.title),
        this._setContent(e.msg),
        this.actor = e.actor,
        void (e.actor && this.contentLength && this._openNextToActor())) : console.error(new Error("SpeechBubble: params is missing"))
    }
    function o(e, t) {
        for (var i = 0, n = null , o = 0; o < t.length; o++) {
            var s = e.lastIndexOf(t[o]);
            s > i && (n = t[o],
            i = s)
        }
        return null === n ? null : e.substr(0, i + n.length)
    }
    function s(e) {
        for (var t, i = [], n = 0, s = "", a = ""; ; ) {
            t = e.substr(n, b);
            var r = e.length - n;
            if (r < b)
                return i.push(a + t),
                i;
            var l = o(t, S);
            if (l && r - l.length < b * C) {
                var c = o(t.substr(0, r * I), S);
                c && r - c.length <= b && (l = c)
            }
            if (!l || l.length < b * C) {
                var u = o(t, A);
                u && u.length >= b * I && (l = u,
                s = E),
                l || (l = t,
                s = E)
            }
            n += l.length,
            i.push(a + l + s),
            a = s === E ? E : "",
            s = ""
        }
    }
    i(579);
    var a = i(210)
      , r = i(451)
      , l = i(26).inherits
      , c = i(32)
      , u = i(206)
      , h = i(31)
      , d = i(190)
      , p = 250
      , m = 150
      , f = 150
      , g = 150
      , _ = .85
      , v = 2e3
      , y = .6
      , w = 150
      , b = 450
      , C = .3
      , I = .6
      , T = ""
      , S = ["\n", ". ", "... ", "? ", "! "]
      , A = [" ", ", ", ": ", "; "]
      , E = "...";
    l(n, d),
    e.exports = n,
    n.prototype._createContent = function(e) {
        this.addClassNames("speechBubble"),
        this.isLocked && this.addClassNames("frozen"),
        c(this, {
            doubletapTimeout: 1
        }),
        this.on("tap", this._tapHandler),
        e.title && (this.title = this.createChild("div", {
            className: "title"
        })),
        this.content = this.createChild("div", {
            className: "content"
        }),
        this.arrow = this.createChild("div"),
        e.channel && this.addClassNames("channel" + e.channel)
    }
    ,
    n.prototype._resize = function() {
        var e = this.content
          , t = e.rootElement.clientWidth;
        if (t > m) {
            var i = this.contentLength < f ? m : p;
            e.setStyle("width", i + "px")
        }
    }
    ,
    n.prototype._setArrow = function(e) {
        this.arrow.setClassNames("arrow");
        var t = e.angle;
        t > 0 ? t > Math.PI / 2 ? this.arrow.addClassNames("bottomLeft") : this.arrow.addClassNames("bottomRight") : t < -Math.PI / 2 ? this.arrow.addClassNames("topLeft") : this.arrow.addClassNames("topRight")
    }
    ,
    n.prototype.setTitle = function(e) {
        this.title.setText(e)
    }
    ,
    n.prototype._setPage = function(e) {
        this.content.appendChild(r.process(e)),
        this.contentLength = e.length
    }
    ,
    n.prototype._setContent = function(e) {
        if ("string" == typeof e)
            e.length > b && (this.nextBtn = this.createChild("div", {
                className: "nextBtn"
            }),
            this.msgPages = s(e),
            this.currentPage = 0,
            e = this.msgPages[0] + T),
            this._setPage(e);
        else {
            if (!(e instanceof d))
                return console.error(new Error("SpeechBubble: unknown msg type (" + typeof e + ")"));
            this.content.appendChild(e),
            this.contentLength = e.rootElement.innerText.length
        }
    }
    ,
    n.prototype._displayNextPage = function() {
        return !!this.msgPages && (!(this.currentPage >= this.msgPages.length - 1) && (h.tween(this, {
            opacity: 0
        }, {
            time: w
        }, function() {
            if (this.isAlive) {
                this.currentPage++,
                this.currentPage === this.msgPages.length - 1 && this.nextBtn.hide();
                var e = this.msgPages[this.currentPage] + T;
                this.content.setStyle("width", null ),
                this.content.clearContent(),
                this._setPage(e),
                this._resize(),
                this._findPosition(),
                a.forceReflow(this),
                h.tween(this, {
                    opacity: 1
                }, {
                    time: g
                })
            }
        }),
        !0))
    }
    ,
    n.prototype._openNextToActor = function() {
        this.setStyle("opacity", 0),
        window.gui.gameGuiContainer.appendChild(this),
        this._resize();
        var e = window.isoEngine.mapScene.camera;
        e.emitAtDestination ? e.once("reached", this._findPositionAppearAndListen.bind(this)) : this._findPositionAppearAndListen()
    }
    ,
    n.prototype._findPositionAppearAndListen = function() {
        this.isAlive && (this._findPosition(),
        this._appearAndListen())
    }
    ,
    n.prototype._findPosition = function() {
        var e = window.gui.boxArranger;
        this.box && e.removeBox(this.box);
        var t = this.box = window.gui.boxArranger.addBoxNextToActor(this.actor, this);
        this.setStyles({
            left: t.x + "px",
            top: t.y + "px"
        }),
        this._setArrow(t)
    }
    ,
    n.prototype._appearAndListen = function() {
        window.gui.on("disconnect", this.closeFunc),
        this.isLocked || window.isoEngine.on("mapLoaded", this.closeFunc);
        var e = this.isLocked || this.msgPages
          , t = e ? 1 : _;
        this.tweener = h.tween(this, {
            opacity: t
        }, {
            time: g
        }, function() {
            if (!e) {
                var t = u.computeNotificationDisplayTime(this.contentLength);
                this.timeout = window.setTimeout(function(e) {
                    e._dimBeforeDisappearing()
                }, t, this)
            }
        })
    }
    ,
    n.prototype._dimBeforeDisappearing = function() {
        this.tweener = h.tween(this, {
            opacity: y
        }, {
            time: 400
        }, this._disappearLater)
    }
    ,
    n.prototype._disappearLater = function() {
        this.timeout = window.setTimeout(this.closeFunc, v)
    }
    ,
    n.prototype._tapHandler = function() {
        if (!this._displayNextPage()) {
            if (this.isLocked) {
                if (!this.actionHandler)
                    return;
                return this.actionHandler()
            }
            return this.msgPages ? this.close() : this.tweener || this.timeout ? void this._freeze() : this.close()
        }
    }
    ,
    n.prototype._freeze = function() {
        this.addClassNames("frozen"),
        this.setStyle("opacity", 1),
        this.tweener.cancel(),
        this.tweener = null ,
        this.timeout && (window.clearTimeout(this.timeout),
        this.timeout = null ),
        window.foreground.on("dom.touchend", this.closeFunc)
    }
    ,
    n.prototype.close = function(e) {
        e && e.isReload || this.isAlive && (this.isAlive = !1,
        this.setEnable(!1),
        this.tweener && this.tweener.cancel(),
        window.clearTimeout(this.timeout),
        window.isoEngine.removeListener("mapLoaded", this.closeFunc),
        window.foreground.removeListener("dom.touchend", this.closeFunc),
        window.gui.removeListener("disconnect", this.closeFunc),
        this.closeHandler && this.closeHandler(),
        window.gui.boxArranger.removeBox(this.box),
        h.tween(this, {
            opacity: 0
        }, {
            time: w
        }, this.destroy))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "Timeline",
            hidden: !0
        }),
        this._createContent(),
        this.statsDetails = null ,
        this.currentFighter = null ,
        this.selectedFighter = null ,
        this.selectedSpell = null ,
        this.isCollapsed = !1,
        this._registerListeners(window.gui),
        this.timerTimestamp = null ,
        this.timerDuration = null ,
        this.timerTween = null ,
        this._previousFighter = null
    }
    i(581);
    var o = i(26).inherits
      , s = i(25)
      , a = i(190)
      , r = i(439)
      , l = i(582)
      , c = i(584)
      , u = i(206).addTooltip
      , h = i(35).getText
      , d = i(218)
      , p = i(302)
      , m = i(31)
      , f = i(186)
      , g = i(233)
      , _ = 55
      , v = 45
      , y = 0;
    o(n, a),
    e.exports = n,
    n.prototype._registerListeners = function(e) {
        function t(e, t, i) {
            t || (t = [],
            e.length > 0 && t.push(e[0]));
            for (var n = a.getAvailableFighters(), o = 0, s = t.length; o < s; o++) {
                var r = t[o]
                  , l = n[r];
                l && i(l)
            }
        }
        function i(e, i) {
            t(e, i, function(e) {
                o.unsetTurnOf(e),
                o.onOrderFightersSwitched(),
                s.hideDeadFighters && o.refreshTimeline()
            })
        }
        function n(e) {
            e.refreshHP(),
            e.refreshShield()
        }
        var o = this
          , a = e.fightManager;
        a.on("GameFightTurnEnd", function(e) {
            var t = this.getFighter(e);
            t && t.data.alive && o.unsetTurnOf(t)
        }),
        a.on("FightersListUpdated", function() {
            o.refreshTimeline()
        }),
        a.on("UpdatePreFightersList", function() {
            o.refreshTimeline()
        }),
        a.on("GameFightTurnStart", function(e, t) {
            var i = this.getFighter(e);
            i && i.data.alive && o.setTurnOf(i, t)
        }),
        a.on(d.FIGHTER_DEATH, i),
        a.on(d.FIGHTER_LEAVE, i),
        a.on("FoldAll", function() {}),
        a.on("BuffAdd", function(e, t) {
            n(t),
            o._refreshAfterResize()
        }),
        a.on("BuffDispell", function(e) {
            n(e)
        }),
        a.on("BuffRemove", function(e, t) {
            n(t),
            o._refreshAfterResize()
        }),
        a.on("BuffUpdate", function(e, t) {
            n(t)
        }),
        a.on("TurnCountUpdated", function(e) {
            o.turnCountLabel.setText(h("ui.fight.turnNumber", e + 1))
        }),
        a.on("OrderFightersSwitched", function() {
            o.onOrderFightersSwitched()
        }),
        s.on("hideDeadFighters", function() {
            o.refreshTimeline()
        }),
        s.on("orderFighters", function(e) {
            var t = a.getAvailableFighters();
            for (var i in t)
                t[i].picto.fighterNumber.toggleDisplay(e);
            o.refreshTimeline(),
            e || window.actorManager.allTurnNumbersOff()
        }),
        a.on("HideSummonedFighters", function() {}),
        e.on("spellSlotSelected", function(e) {
            o.selectedSpell = e
        }),
        e.on("spellSlotDeselected", function() {
            o.selectedSpell = null
        }),
        e.on("resize", function(e) {
            y = Math.floor(.7 * e.mapWidth)
        }),
        this.on("collapse", function(e) {
            this.isCollapsed = e,
            this._refreshAfterResize()
        }),
        this.on("dragEnd", function() {
            this.fighterListScroller.refresh()
        })
    }
    ,
    n.prototype._createContent = function() {
        r(this, {
            isCollapsable: !0
        });
        var e = this.infoAndFighters = this.createChild("div", {
            className: "infoAndFighters"
        });
        this.fighterListContainer = e.createChild("div", {
            name: "fighterListContainer",
            className: "fighterListContainer"
        }),
        this.fighterListScroller = this.fighterListContainer.appendChild(new p({
            name: "fighterListScroller",
            className: "fighterList"
        },{
            isHorizontal: !0
        })),
        this.fighterList = this.fighterListScroller.content,
        this.infoContainer = e.createChild("div", {
            className: "infoContainer"
        }),
        this.turnCountLabel = this.infoContainer.createChild("div", {
            className: "turnCountLabel"
        }),
        this.fightControlButtons = this.infoContainer.appendChild(new l),
        this.fightControlButtons.on("TurnReadyPressed", function() {
            window.gui.fightManager.finishTurn()
        }),
        this.buffList = this.appendChild(new c)
    }
    ,
    n.prototype.close = function() {
        this.currentFighter && this.unsetTurnOf(this.currentFighter),
        this.selectedFighter = null ,
        this.buffList.close(),
        this.hide(),
        this.fighterList.clearContent(),
        this.turnCountLabel.clearContent()
    }
    ,
    n.prototype.restoreFighterList = function() {
        this.infoAndFighters.insertAsFirstChild(this.fighterListContainer),
        this.restartTimerAnimation(),
        this.refreshTimeline()
    }
    ,
    n.prototype.appendFighterListTo = function(e) {
        e.appendChild(this.fighterListContainer),
        this.restartTimerAnimation(),
        this.refreshTimeline()
    }
    ,
    n.prototype.refreshTimeline = function() {
        var e, t, i, n = "fightPlacement" === window.foreground.tapOptions.mode, o = window.gui.fightManager, a = o.getFighters(), r = o.getDeadFighters(), l = o.getAvailableFighters(), c = {}, u = 1;
        if (n) {
            var h = this.fighterList.getChildren();
            for (i = 0; i < h.length; i++)
                this.fighterList.removeChild(h[i])
        }
        var d, p = a.length, m = 0;
        for (i = 0; i < p; i++) {
            e = a[i],
            c[e] = !0,
            t = l[e] || o.addFighter(e);
            var f = r.indexOf(e) < 0;
            if (t.setAlive(f, !0),
            (f || !s.hideDeadFighters) && (t.updateNumber(f && u++),
            m += t.isSummon() ? v : _,
            !this.fighterList.getChild(e))) {
                d = null ;
                for (var g = i + 1; g < p && !(d = this.fighterList.getChild(a[g])); g++)
                    ;
                this.fighterList.insertChildBefore(t.picto, d),
                t.resizeFighterIllustration()
            }
        }
        if (!n)
            for (e in l)
                if (!c[e]) {
                    var w = this.fighterList.getChild(e);
                    w && this.fighterList.removeChild(w)
                }
        m = Math.min(m, y),
        this.fighterListContainer.setStyle("width", m + "px"),
        this._refreshAfterResize()
    }
    ,
    n.prototype._refreshAfterResize = function() {
        this.emit("resized"),
        this.fighterListScroller.refresh(),
        this.isCollapsed && this.currentFighter && this.fighterListScroller.showElement(this.currentFighter.picto)
    }
    ,
    n.prototype.onOrderFightersSwitched = function() {
        for (var e = this.fighterList.getChildren(), t = window.gui.fightManager, i = 1, n = 0, o = e.length; n < o; n++) {
            var s = e[n].getWuiName()
              , a = t.getFighter(s);
            if (!a)
                return console.error("Fighters' order switch failed, fighter does not exist.");
            a.data.alive ? (a.updateNumber(i),
            i++) : a.updateNumber()
        }
    }
    ,
    n.prototype.linkToTimeline = function(e) {
        var t = this;
        u(e.picto, function() {
            return t.statsDetails ? e.refreshStatsTooltipContent(t.statsDetails) : t.statsDetails = e.createStatsTooltipContent(),
            t.statsDetails
        }),
        e.picto.on("tap", function() {
            t.onFighterSelected(e)
        }),
        e.picto.on("tooltipOn", function() {
            t.onPressEntity(e, !1),
            window.isoEngine.displayEnemyMovementZone(e)
        }),
        e.picto.on("tooltipOut", function() {
            t.onReleaseEntity(),
            window.isoEngine.removeEnemyMovementZone()
        }),
        f.setDroppable(e.picto, ["shortcutBar"]),
        e.picto.on("beforeDragEnd", function() {
            t.onFighterSelected(e)
        })
    }
    ,
    n.prototype.onFighterSelected = function(e) {
        if (this.selectedSpell || 0 === this.selectedSpell) {
            var t = window.gui
              , i = t.playerData.characters.controlledCharacterId;
            return void (e.data.alive && t.fightManager.currentFighterId === i && (window.dofus.sendMessage("GameActionFightCastOnTargetRequestMessage", {
                spellId: this.selectedSpell,
                targetId: e.id
            }),
            t.fightManager.spellCastSucceeded(this.selectedSpell, i),
            window.isoEngine.clearSpellDisplay(),
            t.shortcutBar.deselectIcon()))
        }
        this.selectedFighter && (window.actorManager.selectionIndicatorOff(this.selectedFighter),
        this.selectedFighter.picto.delClassNames("selected")),
        this.selectedFighter === e ? (this.selectedFighter = null ,
        this.buffList.hide()) : (window.actorManager.selectionIndicatorOn(e),
        e.picto.addClassNames("selected"),
        this.selectedFighter = e,
        this.buffList.open(e)),
        this._refreshAfterResize()
    }
    ,
    n.prototype.onPressEntity = function(e) {
        e && e.data.stats.invisibilityState !== g.INVISIBLE && window.isoEngine.highlightActorOnAction(e.id, 1e3)
    }
    ,
    n.prototype.onReleaseEntity = function() {
        window.isoEngine.clearHighlights()
    }
    ,
    n.prototype.restartTimerAnimation = function() {
        if (this.currentFighter && this.timerTween) {
            this.timerTween.cancel();
            var e = Date.now() - this.timerTimestamp;
            if (!(e < 0 || e >= this.timerDuration)) {
                var t = this.timerDuration - e
                  , i = Math.ceil(100 * e / this.timerDuration);
                this.playTimerAnimation(t, i)
            }
        }
    }
    ,
    n.prototype.startTimerAnimation = function(e) {
        this.timerTimestamp = Date.now(),
        this.timerDuration = e,
        this.playTimerAnimation(e, 0)
    }
    ,
    n.prototype.stopTimerAnimation = function() {
        this.timerTimestamp = null ,
        this.timerDuration = null ,
        this.timerTween.cancel(),
        this.timerTween = null ;
        var e = this.currentFighter.picto;
        e.delClassNames("current"),
        e.fighterTimeValue.setStyles({
            webkitTransition: "",
            webkitTransform: "translate3d(0,100%,0)"
        })
    }
    ,
    n.prototype.playTimerAnimation = function(e, t) {
        var i = this.currentFighter.picto;
        i.fighterTimeValue.setStyle("webkitTransform", "translate3d(0, " + (100 - t) + "%, 0)"),
        this.timerTween = m.tween(i.fighterTimeValue, {
            webkitTransform: "translate3d(0, 0, 0)"
        }, {
            time: e,
            easing: "linear"
        }),
        i.addClassNames("current"),
        this.isCollapsed && this.fighterListScroller.showElement(i)
    }
    ,
    n.prototype.unsetTurnOf = function(e) {
        this.currentFighter && this.currentFighter === e && (window.actorManager.turnIndicatorOff(e),
        this.stopTimerAnimation(),
        this.currentFighter = null )
    }
    ,
    n.prototype.setTurnOf = function(e, t) {
        this.currentFighter && this.unsetTurnOf(this.currentFighter),
        this.currentFighter = e,
        this.startTimerAnimation(t),
        this.emit("setTurnOf", e, t),
        this._previousFighter && window.actorManager.turnIndicatorOff(this._previousFighter),
        window.actorManager.turnIndicatorOn(e),
        this._previousFighter = e
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            c.show(),
            l._isReadyForFight = e,
            e ? c.addClassNames("readyForFight") : c.delClassNames("readyForFight")
        }
        function t() {
            c.hide(),
            l.setTurnReadyButtonAvailability(!1),
            u.show()
        }
        function i(e) {
            e && !window.gui.playerData.characters.canControlCharacterId(e.id) || l.setTurnReadyButtonAvailability(!0)
        }
        function n() {
            l.setTurnReadyButtonAvailability(!1)
        }
        function o() {
            u.hide()
        }
        a.call(this, "div", {
            className: "fightControlButtons"
        });
        var l = this;
        this._isReadyForFight = !1;
        var c = this._fightReadyBtn = new r({
            text: s("ui.banner.ready"),
            className: "fightBtn",
            hidden: !0,
            scaleOnPress: !0
        },function() {
            l.toggleReadyForFight()
        }
        );
        this.appendChild(c);
        var u = this._turnReadyBtn = new r({
            text: s("tablet.fight.option.nextTurn"),
            className: "fightBtn",
            hidden: !0,
            scaleOnPress: !0
        },function() {
            l.emit("TurnReadyPressed"),
            n()
        }
        );
        this.appendChild(u),
        window.gui.on("GameFightJoinMessage", function(t) {
            t.canSayReady && e(!1)
        }),
        window.gui.fightManager.on("playerReady", e),
        window.gui.on("GameFightStartMessage", t),
        window.gui.on("GameFightResumeMessage", t),
        window.gui.on("GameFightResumeWithSlavesMessage", t),
        window.gui.on("GameFightTurnStartPlayingMessage", function() {
            i(null )
        }),
        window.gui.on("GameFightTurnStartMessage", i),
        window.gui.on("GameFightTurnStartSlaveMessage", i),
        window.gui.on("GameFightTurnResumeMessage", i),
        window.gui.on("GameFightTurnEndMessage", n),
        window.gui.on("GameFightEndMessage", o),
        window.gui.on("disconnect", o)
    }
    i(583);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(190)
      , r = i(204);
    o(n, a),
    e.exports = n,
    n.prototype.toggleReadyForFight = function() {
        window.dofus.sendMessage("GameFightReadyMessage", {
            isReady: !this._isReadyForFight
        })
    }
    ,
    n.prototype.isReadyForFightButtonVisible = function() {
        return this._fightReadyBtn.isVisible()
    }
    ,
    n.prototype.setTurnReadyButtonAvailability = function(e) {
        var t = this._turnReadyBtn;
        e ? t.enable() : t.disable()
    }
    ,
    n.prototype.getButtonRectForTuto = function(e) {
        var t;
        switch (e) {
        case "fightReadyBtn":
            t = this._fightReadyBtn;
            break;
        case "turnReadyBtn":
            t = this._turnReadyBtn;
            break;
        default:
            return null
        }
        return t.isVisible() ? t.rootElement.getBoundingClientRect() : null
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "FightBuffs"
        }),
        this.buffList = this.createChild("div", {
            className: "buffList"
        }),
        this.buffItems = {},
        this._registerListeners(window.gui.fightManager),
        this.fighter = null ,
        this.lastWasPlayer = !1,
        this.buffDescription = new l,
        this.hide()
    }
    i(585);
    var o = i(26).inherits
      , s = i(190)
      , a = i(586)
      , r = i(206).addTooltip
      , l = i(587);
    o(n, s),
    e.exports = n,
    n.prototype._registerListeners = function(e) {
        var t = this;
        e.on("GameFightTurnStart", function(e) {
            if (e === window.gui.playerData.id)
                t.lastWasPlayer = !0;
            else if (t.lastWasPlayer) {
                for (var i = t.buffList.getChildren(), n = 0; n < i.length; n++)
                    i[n].updateCooldown();
                t.lastWasPlayer = !1
            }
        }),
        e.on("BuffUpdate", function(e, i) {
            t.fighter === i && t.updateBuff(e)
        }),
        e.on("BuffRemove", function(e, i) {
            t.fighter === i && t.removeBuff(e)
        }),
        e.on("BuffAdd", function(e, i) {
            t.fighter === i && (t._addBuff(e),
            t.updateUi())
        })
    }
    ,
    n.prototype.open = function(e) {
        this.fighter !== e && (this.clean(),
        this.fighter = e,
        this.makeItemBuffs(e),
        this.updateUi()),
        this.show()
    }
    ,
    n.prototype.close = function() {
        this.clean(),
        this.hide()
    }
    ,
    n.prototype.clean = function() {
        this.fighter = null ,
        this.buffList.clearContent(),
        this.buffItems = {}
    }
    ,
    n.prototype.makeItemBuffs = function(e) {
        for (var t = e.buffs, i = 0, n = t.length; i < n; i++)
            this._addBuff(t[i])
    }
    ;
    var c = function(e, t) {
        return e.maxCooldown() - t.maxCooldown()
    };
    n.prototype.updateUi = function() {
        for (var e = [], t = [], i = this.buffList.getChildren(), n = 0; n < i.length; n++) {
            var o = i[n];
            0 !== o.parentBoostUid ? t.push(o) : e.push(o)
        }
        for (e.sort(c),
        n = 0; n < t.length; n++) {
            for (var s = t[n], a = !1, r = 0, l = 0; l < e.length; l++)
                if (e[l].maxCooldown() < s.cooldown && (r = l),
                e[l].hasUid(s.parentBoostUid)) {
                    e.splice(l + 1, 0, s),
                    a = !0;
                    break
                }
            a || e.splice(r, 0, s)
        }
        for (n = 0; n < e.length; n++) {
            var u = e[n];
            this.buffList.appendChild(u)
        }
    }
    ,
    n.prototype._addBuff = function(e) {
        function t() {
            for (var e = [], t = -1, i = 0; i < n.buffs.length; i++) {
                var s = n.buffs[i];
                e.push(s.effect),
                t = s.source
            }
            var a = window.gui.fightManager
              , r = a.getFighter(t);
            if (!r)
                return null ;
            var c = {};
            return c.spellName = n.spell.getName(),
            c.casterName = r.name,
            c.effects = e,
            o ? o.updateUI(c) : o = new l(c),
            o
        }
        var i = a.getKey(e)
          , n = this.buffItems[i];
        if (n)
            return void n.addBuff(e);
        n = new a(e);
        var o;
        r(n, t),
        this.buffItems[i] = n,
        this.buffList.appendChild(n),
        n.addBuff(e)
    }
    ,
    n.prototype.updateBuff = function(e) {
        var t = a.getKey(e)
          , i = this.buffItems[t];
        if (i)
            i.updateCooldown(e),
            this.updateUi();
        else {
            var n = a.getDelayKey(e);
            if (i = this.buffItems[n],
            !i)
                return void console.warn("Trying to update a non-existing buff.");
            this.buffItems[t] = i,
            delete this.buffItems[n]
        }
    }
    ,
    n.prototype.removeBuff = function(e) {
        this.removeBuffItem(e, a.getKey(e)),
        this.removeBuffItem(e, a.getDelayKey(e)),
        this.updateUi()
    }
    ,
    n.prototype.removeBuffItem = function(e, t) {
        var i = this.buffItems[t];
        i && (i.removeBuff(e),
        0 === i.buffs.length && (this.buffList.removeChild(i),
        i.destroy(),
        delete this.buffItems[t]))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        var t = window.gui.fightManager.getTurnCount();
        return e.effect.hasOwnProperty("delay") ? t + e.effect.delay : t
    }
    function o(e) {
        l.call(this, "div", {
            className: "BuffItem"
        });
        var t = e.castingSpell.spell.id
          , i = e.castingSpell.casterId
          , o = e.parentBoostUid
          , s = e.effect.hasOwnProperty("delay") && e.effect.delay > 0 ? n(e) : -1;
        s > 0 ? this.key = t + "#" + i + "#" + o + "#" + s : this.key = t + "#" + i + "#" + o,
        this.parentBoostUid = 0,
        this.spell = e.castingSpell.spell;
        var a = this;
        this.spell.getIconUri && c.preloadImage(this.spell.getIconUri(), function(e) {
            a && a.rootElement && a.setStyle("backgroundImage", e)
        }),
        this.buffs = [],
        this.cooldownLabel = this.createChild("div", {
            className: "cooldown"
        }),
        this.setCooldown(0)
    }
    function s(e) {
        return e.castingSpell.spell.id + "#" + e.castingSpell.casterId + "#" + e.parentBoostUid + "#" + n(e)
    }
    function a(e) {
        return e.effect.hasOwnProperty("delay") && e.effect.delay > 0 ? s(e) : e.castingSpell.spell.id + "#" + e.castingSpell.casterId + "#" + e.parentBoostUid
    }
    var r = i(26).inherits
      , l = i(190)
      , c = i(5);
    r(o, l),
    e.exports = o,
    e.exports.getDelayKey = s,
    e.exports.getKey = a,
    o.prototype.hasUid = function(e) {
        for (var t = 0; t < this.buffs.length; t++)
            if (this.buffs[t].uid === e)
                return !0;
        return !1
    }
    ,
    o.prototype.addBuff = function(e) {
        this.buffs.push(e),
        0 !== e.parentBoostUid && (this.parentBoostUid = e.parentBoostUid),
        this.updateCooldown()
    }
    ,
    o.prototype.isUnusableNextTurn = function() {
        for (var e = 0; e < this.buffs.length; e++)
            if (!this.buffs[e].isUnusableNextTurn())
                return !1;
        return !0
    }
    ,
    o.prototype.updateCooldown = function() {
        for (var e = 0, t = !1, i = 0, n = 0, o = this.buffs.length; n < o; n++) {
            var s = this.buffs[n];
            t && e !== s.duration && this.setCooldown(this.cooldown - 1),
            (0 === i || s.effect.delay < i) && (i = s.effect.delay),
            e = s.duration,
            t = !0
        }
        i > 0 ? this.setCooldown(i) : this.setCooldown(e),
        this.isUnusableNextTurn() && this.addClassNames("disabled")
    }
    ,
    o.prototype.setCooldown = function(e) {
        this.cooldown = e,
        e === -1 ? (this.cooldownLabel.setText("+"),
        this.cooldownLabel.show()) : 0 === e || e === Number.MAX_VALUE ? (this.cooldownLabel.setText(""),
        this.cooldownLabel.hide()) : e < -1 ? (this.cooldownLabel.setText(""),
        this.cooldownLabel.show()) : (this.cooldownLabel.setText(e),
        this.cooldownLabel.show())
    }
    ,
    o.prototype.maxCooldown = function() {
        if (this.cooldown !== -1)
            return this.cooldown;
        for (var e = 0, t = 0, i = this.buffs.length; t < i; t++) {
            var n = this.buffs[t];
            (n.duration > e || n.duration < -1) && (e = n.duration)
        }
        return e
    }
    ,
    o.prototype.removeBuff = function(e) {
        for (var t = 0; t < this.buffs.length; t++)
            if (this.buffs[t] === e) {
                this.buffs.splice(t, 1),
                this.updateCooldown();
                break
            }
    }
}
, function(e, t, i) {
    function n(e, t) {
        u.call(this, "div", t),
        this.addClassNames("BuffDescription"),
        this._buildDomElements(t),
        this.updateUI(e)
    }
    function o(e) {
        this._domElements.spellName.setText(e)
    }
    function s(e) {
        this._domElements.casterName.setText(l("ui.fight.caster") + l("ui.common.colon") + e)
    }
    function a(e) {
        this._domElements.effectsAndDamage.setEffects(e)
    }
    i(588);
    var r = i(397)
      , l = i(35).getText
      , c = i(26).inherits
      , u = i(190);
    c(n, u),
    e.exports = n,
    n.prototype._buildDomElements = function(e, t) {
        var i = this._domElements = {};
        i.spellName = this.createChild("div", {
            className: "spellName"
        }),
        i.casterName = this.createChild("div", {
            className: "casterName"
        }),
        i.effectsAndDamage = this.appendChild(new r(t))
    }
    ,
    n.prototype.updateUI = function(e) {
        if (e) {
            var t = e.spellName
              , i = e.casterName
              , n = e.effects;
            o.call(this, t),
            s.call(this, i),
            a.call(this, n)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        u.call(this, "div", {
            className: "dropDown",
            hidden: !0
        });
        var e = this
          , t = this.createChild("div", {
            className: "dropDrownOverlay"
        });
        c(t),
        t.on("tap", function() {
            e.close()
        }),
        this.entryContainer = this.createChild("div", {
            className: "entryContainer"
        }),
        this.scroller = this.entryContainer.appendChild(new l({
            className: "entryList"
        },{
            showHintArrows: !0
        })),
        this.entryList = this.scroller.content,
        this._isOpen = !1,
        this.clearContent(),
        window.gui.on("disconnect", function() {
            e.clearContent(),
            e.close()
        })
    }
    function o() {
        var e = this.dropDown
          , t = this.action;
        e.close(),
        e._selectionFn(t.value, t.index)
    }
    i(590);
    var s = i(204)
      , a = i(24).dimensions
      , r = i(26).inherits
      , l = i(302)
      , c = i(32)
      , u = i(190)
      , h = 30
      , d = 15;
    r(n, u),
    e.exports = n,
    n.prototype.setupDropDown = function(e, t, i, n) {
        var o = e.rootElement.getBoundingClientRect();
        return e === this._parentElt && o.left === this._parentRect.left && o.top === this._parentRect.top ? this.open(i) : (this._updateContent(t, n, e, o),
        void this._firstOpen(i))
    }
    ,
    n.prototype.clearContent = function() {
        this.entryList.clearContent(),
        this._parentElt = null ,
        this._parentRect = null ,
        this._selectionFn = null ,
        this._entries = [],
        this._selectedIndex = -1
    }
    ,
    n.prototype._updateContent = function(e, t, i, n) {
        this.clearContent();
        for (var o = 0, s = e.length; o < s; o++) {
            var a = e[o];
            if (!a.hidden) {
                var r = {
                    index: o,
                    value: a.value
                };
                a.disabled && (r.disabled = !0),
                this._addEntry(a.text, r)
            }
        }
        this._entries = this.entryList.getChildren(),
        this._parentElt = i,
        this._parentRect = n,
        this._selectionFn = t
    }
    ,
    n.prototype.select = function(e) {
        e >= this._entries.length || (this._selectedIndex !== -1 && this._entries[this._selectedIndex].delClassNames("ticked"),
        this._selectedIndex = e,
        this._entries[e].addClassNames("ticked"))
    }
    ,
    n.prototype.close = function() {
        this._isOpen && (this.hide(),
        this._isOpen = !1)
    }
    ,
    n.prototype._firstOpen = function(e) {
        this.setStyle("opacity", 0),
        this.show(),
        this._refreshPositionAndSize(),
        this.open(e)
    }
    ,
    n.prototype.open = function(e) {
        this.show(),
        void 0 !== e && (this.select(e),
        this._scrollToEntryIndex(e)),
        this._isOpen = !0,
        this.setStyle("opacity", 1)
    }
    ,
    n.prototype._scrollToEntryIndex = function(e) {
        return e < 0 || e >= this._entries.length ? console.warn("Invalid dropdown index", e) : void this.scroller.scrollToElement(this._entries[e], 0)
    }
    ,
    n.prototype._refreshPositionAndSize = function() {
        var e = this._parentRect
          , t = e.left
          , i = e.width - h
          , n = e.bottom + 1
          , o = a.screenHeight - d - n
          , s = this.entryList.rootElement.getBoundingClientRect();
        if (o < s.height && e.top > .6 * a.screenHeight) {
            var r = e.top - 5;
            o = Math.min(s.height, r - d),
            n = r - o
        }
        this.entryContainer.setStyles({
            left: t + "px",
            top: n + "px",
            width: i + "px"
        }),
        this.scroller.setStyle("max-height", o + "px"),
        this.scroller.refresh()
    }
    ,
    n.prototype._addEntry = function(e, t) {
        var i = this.entryList.appendChild(new s({
            text: e,
            className: "dropDownEntry"
        }));
        return t.disabled ? void i.addClassNames("disabled") : (i.on("tap", o),
        i.dropDown = this,
        void (i.action = t))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, "div", {
            className: "Compass"
        }),
        this.markers = {}
    }
    i(592);
    var o = i(24).dimensions
      , s = i(26).inherits
      , a = i(206).addTooltip
      , r = i(190)
      , l = i(593)
      , c = i(25)
      , u = 50
      , h = 2
      , d = {
        "-5,-1": -5,
        "-4,0": -4,
        "-3,1": -3,
        "-2,2": -2
    };
    s(n, r),
    e.exports = n,
    n.arrowType = {
        QUEST: 4,
        PARTY: 2
    },
    n.prototype.addMarker = function(e) {
        return this.markers[e.type] = {
            type: e.type,
            arrowType: e.arrowType,
            x: e.x,
            y: e.y,
            tooltip: e.tooltip
        },
        this.getDistance(e.x, e.y)
    }
    ,
    n.prototype.removeMarker = function(e) {
        delete this.markers[e]
    }
    ,
    n.prototype._displayMarkers = function() {
        for (var e = 0; e < this.markersDom.length; e++) {
            var t, i, n = this.markersDom[e], s = n.angleCorrected || n.angle, a = 180 * s / Math.PI, r = o.mapWidth - u, l = o.mapHeight - u;
            a <= -34 && a >= -146 ? (t = (r - Math.tan(Math.PI / 2 - s) * l) / 2,
            i = 0) : a >= 34 && a <= 146 ? (t = (r + Math.tan(Math.PI / 2 - s) * l) / 2,
            i = l) : a < 34 && a > -34 ? (t = r,
            i = (l + Math.tan(s) * r) / 2) : (t = 0,
            i = (l - Math.tan(s) * r) / 2),
            n.setStyles({
                left: o.mapLeft + t + "px",
                top: o.mapTop + i + "px"
            }),
            n.markerArrow.setStyle("webkitTransform", "rotate(" + a + "deg)")
        }
    }
    ,
    n.prototype._addMarkerDom = function(e) {
        var t = window.gui.playerData.position.coordinates;
        if (t.posX !== e.x || t.posY !== e.y) {
            var i = e.x - t.posX
              , n = e.y - t.posY
              , o = this.getDistance(e.x, e.y);
            if (0 !== o) {
                var s = this.createChild("div", {
                    className: "marker"
                });
                s.markerArrow = s.createChild("div", {
                    className: "markerArrow"
                }),
                s.markerArrow.addClassNames("arrow_" + (e.arrowType || e.type));
                var r = s.createChild("div", {
                    className: "markerNumber"
                });
                r.setText(o),
                a(s, e.tooltip),
                s.angle = Math.atan2(n, i),
                s.on("dom.touchstart", function(e) {
                    window.foreground.emit("dom.touchstart", e)
                }),
                s.on("dom.touchend", function(e) {
                    window.foreground.emit("dom.touchend", e)
                }),
                this.markersDom.push(s)
            }
        }
    }
    ,
    n.prototype.updateMarkersPositions = function() {
        var e, t;
        this.clearContent(),
        this.markersDom = [];
        for (e in this.markers)
            t = this.markers[e],
            "phoenix" !== t.arrowType && this._addMarkerDom(t);
        if (c.autoGpsPhoenixes) {
            var i = []
              , n = 1 / 0;
            for (e in this.markers)
                if (t = this.markers[e],
                "phoenix" === t.arrowType) {
                    var o = this.getDistance(t.x, t.y);
                    o < n && (n = o,
                    i = []),
                    o === n && i.push(e)
                }
            if (n > 0)
                for (var s = 0; s < i.length; s++)
                    t = this.markers[i[s]],
                    this._addMarkerDom(t)
        }
        l(this.markersDom),
        this._displayMarkers()
    }
    ,
    n.prototype.getDistance = function(e, t) {
        var i = window.gui.playerData.position.coordinates
          , n = e - i.posX
          , o = t - i.posY
          , s = Math.abs(n) + Math.abs(o)
          , a = this.isInTutorialCorridor(e, t)
          , r = this.isInTutorialCorridor(i.posX, i.posY);
        return a || r ? a && r ? Math.abs(e - i.posX) : a ? s + d[e + "," + t] : s + d[i.posX + "," + i.posY] : s
    }
    ,
    n.prototype.isInTutorialCorridor = function(e, t) {
        return window.gui.playerData.position.worldmapId === h && void 0 !== d[e + "," + t]
    }
}
, function(e, t) {}
, function(e, t) {
    function i(e, t) {
        this.value = e,
        this.originalValue = e,
        this.forceLeft = 0,
        this.forceRight = 0,
        this.left = t,
        this.right = null ,
        t && (t.right = this)
    }
    function n(e, t) {
        return e.angle - t.angle
    }
    function o(e, t) {
        if (!(e.length < 2)) {
            t = t || s,
            e.sort(n);
            var o, l = [], c = null , u = !0, h = null ;
            for (o = 0; o < e.length; o++)
                h = new i(e[o].angle,h),
                l.push(h),
                c = c || h,
                u = u && h.distance(c) < t;
            if (u) {
                if (e[e.length - 1].angle - e[0].angle > t) {
                    for (o = 1; o < e.length; o++)
                        if (e[o].angle - e[0].angle > t) {
                            l[o - 1].right = null ,
                            l[o].left = null ;
                            break
                        }
                    l[0].left = h,
                    h.right = l[0]
                }
            } else
                l[0].left = h,
                h.right = l[0];
            for (var d = 1 / 0, p = a * e.length, m = 0; d > p && !(++m >= r); ) {
                for (d = 0,
                o = 0; o < l.length; o++)
                    l[o].updateForces(t);
                for (o = 0; o < l.length; o++)
                    d += l[o].updateValue()
            }
            for (o = 0; o < e.length; o++)
                e[o].angleCorrected = l[o].value
        }
    }
    var s = .08
      , a = .001
      , r = 1e3
      , l = 1e-4
      , c = 2 * Math.PI;
    i.prototype.updateValue = function() {
        var e = this.forceLeft - this.forceRight;
        return this.value += e,
        Math.abs(e)
    }
    ,
    i.prototype.distance = function(e) {
        if (!e)
            return 1 / 0;
        var t = Math.abs(e.value - this.value);
        return Math.min(t, c - t)
    }
    ,
    i.prototype.updateForces = function(e) {
        var t = this.distance(this.left)
          , i = this.distance(this.right);
        this.forceLeft = t < e + l ? (e - t) / 2 : 0,
        this.forceRight = i < e + l ? (e - i) / 2 : 0
    }
    ,
    e.exports = o
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "HintArrow",
            hidden: !0
        }),
        this.arrow = this.createChild("div", {
            className: "arrow"
        })
    }
    i(595);
    var o = i(26).inherits
      , s = i(190);
    o(n, s),
    e.exports = n,
    n.prototype.showArrow = function(e, t, i) {
        i = i || "downRight",
        this.arrow.setClassNames(["arrow", i]),
        this.setStyles({
            left: e + "px",
            top: t + "px"
        }),
        this.show()
    }
    ,
    n.prototype.hideArrow = function() {
        this.hide()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this),
        this.inTutorial = void 0,
        this.isChangingMap = !1,
        this.inFight = !1
    }
    function o(e) {
        window.gui.transmitMessage({
            _messageType: "_tutorialGameMapMovementMessage",
            actorId: e.actorId,
            isInFight: !0
        })
    }
    var s = i(16).EventEmitter
      , a = i(26).inherits
      , r = i(597)
      , l = i(598)
      , c = i(442)
      , u = i(30);
    a(n, s),
    e.exports = n,
    n.prototype.initialize = function(e) {
        var t = this;
        this.tutorialStep = new l,
        e.on("disconnect", function() {
            t.inTutorial = void 0,
            t.isChangingMap = !1,
            t.inFight = !1,
            t._removeListeners()
        }),
        e.fightManager.on("fightStart", function() {
            t.inFight = !0
        }),
        e.fightManager.on("fightEnd", function() {
            t.inFight = !1
        }),
        e.playerData.position.on("mapUpdate", function() {
            var i = e.playerData.position.subArea
              , n = i && i.id === r.QUEST_TUTORIAL_FIRST_SUB_AREA_ID;
            t.inTutorial !== n && (t.inTutorial = n,
            t.inTutorial ? window.isoEngine.mapRenderer.map ? t._openTutorialStepWindow() : window.isoEngine.once("mapLoaded", function() {
                t._openTutorialStepWindow()
            }) : t._closeTutorialWindows()),
            t.inTutorial ? window.gui.textNotification.hide() : window.gui.textNotification.show(),
            t.isChangingMap = !1
        })
    }
    ,
    n.prototype._openTutorialStepWindow = function() {
        this._registerListeners(),
        this.tutorialStep.start(),
        this.emit("inTutorialStateChanged", this.inTutorial)
    }
    ,
    n.prototype._closeTutorialWindows = function() {
        this._removeListeners(),
        this.tutorialStep.stop(),
        this.emit("inTutorialStateChanged", this.inTutorial)
    }
    ,
    n.prototype._registerListeners = function() {
        window.dofus.toggleTutorialListeners(!0),
        window.gui.on("GameMapMovementMessage", o)
    }
    ,
    n.prototype._removeListeners = function() {
        window.dofus.toggleTutorialListeners(!1),
        window.gui.removeListener("GameMapMovementMessage", o)
    }
    ,
    n.prototype._hasTutorial = function() {
        var e = window.gui.playerData.quests.finished;
        for (var t in e) {
            var i = e[t];
            if (i.questId === r.QUEST_TUTORIAL_ID)
                return !1
        }
        return !0
    }
    ,
    n.prototype._hasValidLevel = function() {
        return window.gui.playerData.characterBaseInformations.level <= r.MAX_CHARACTER_LEVEL_FOR_TUTORIAL
    }
    ,
    n.prototype.isTutorialRequired = function() {
        var e = u.getValue("tutorialDone");
        if (e)
            return !1;
        for (var t = c.getCharacterList(), i = 0; i < t.length; i++)
            if (t[i].level > r.MAX_CHARACTER_LEVEL_FOR_TUTORIAL)
                return u.setValue("tutorialDone", !0),
                !1;
        return !0
    }
    ,
    n.prototype.adminCommand = function(e) {
        return e && 1 === e.length && "start" === e[0] ? window.gui.tutorialManager.inTutorial ? "You are already in the tutorial" : (window.dofus.sendMessage("GuidedModeReturnRequestMessage"),
        "Done") : "Wrong parameter, allowed parameters: start"
    }
}
, function(e, t) {
    t.QUEST_TUTORIAL_ID = 489,
    t.QUEST_TUTORIAL_FIRST_SUB_AREA_ID = 536,
    t.TUTORIAL_MAP_ID_FIRST = 81002496,
    t.TUTORIAL_MAP_ID_SECOND_BEFORE_FIGHT = 81003520,
    t.TUTORIAL_MAP_ID_SECOND_AFTER_FIGHT = 81003522,
    t.TUTORIAL_MAP_ID_THIRD_BEFORE_FIGHT = 81004544,
    t.TUTORIAL_MAP_ID_THIRD_AFTER_FIGHT = 81004546,
    t.MAX_CHARACTER_LEVEL_FOR_TUTORIAL = 49,
    t.QUEST_TUTORIAL_REWARDS = [[10785, 1], [10794, 1], [10797, 1], [10798, 1], [10799, 1], [10784, 1], [10800, 1], [10801, 1], [10792, 1], [10793, 2], [10795, 1], [10796, 1]],
    t.FIRST_EQUIP_ITEMS = [10785],
    t.SECOND_EQUIP_ITEMS = [10784, 10794, 10797, 10798, 10799, 10800],
    t.TUTORIAL_STEP_TALK_NPC_ID = 1222,
    t.TUTORIAL_FIRST_MONSTER_ID = 2785,
    t.TUTORIAL_BOSS_MONSTER_ID = 2781,
    t.TUTORIAL_STEP_ROLEPLAY_MOVE_CELL_ID = 272,
    t.TUTORIAL_STEP_CHANGE_MAP_ARROW_CELL_ID = 503,
    t.FIGHT_LOCATION_TARGET_CELLS = [232, 216, 229, 270, 313, 328, 316, 274],
    t.FIGHT_MOVE_TARGET_CELLS = {
        232: 259,
        216: 259,
        229: 258,
        270: 286,
        313: 286,
        328: 287,
        316: 287,
        274: 287
    },
    t.TUTORIAL_STEP_ROLEPLAY_MOVE = 1,
    t.TUTORIAL_STEP_TALK = 2,
    t.TUTORIAL_SUB_STEP_TALK_SHOW_NPC = 1,
    t.TUTORIAL_SUB_STEP_TALK_SHOW_RESPONSE = 2,
    t.TUTORIAL_STEP_EQUIP_ITEM = 3,
    t.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_ITEM_MENU_ICON = 1,
    t.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_TAB = 2,
    t.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_EQUIPMENT = 3,
    t.TUTORIAL_STEP_CHANGE_MAP = 4,
    t.TUTORIAL_STEP_STARTING_A_FIGHT = 5,
    t.TUTORIAL_STEP_FIGHT_LOCATION = 6,
    t.TUTORIAL_STEP_FIGHT_MOVE = 7,
    t.TUTORIAL_SUB_STEP_FIGHT_MOVE_START_FIGHT = 1,
    t.TUTORIAL_STEP_FIGHT_CAST_SPELL = 8,
    t.TUTORIAL_STEP_FIGHT_SKIP_TURN = 9,
    t.TUTORIAL_STEP_FIGHT_WIN = 10,
    t.TUTORIAL_STEP_START_QUEST = 11,
    t.TUTORIAL_STEP_EQUIP_ALL_ITEMS = 12,
    t.TUTORIAL_STEP_FIND_BOSS = 13,
    t.TUTORIAL_STEP_KILL_BOSS = 14,
    t.TUTORIAL_STEP_SUCCESS_QUEST = 15
}
, function(e, t, i) {
    function n(e, t) {
        var i = {};
        for (var n in t) {
            var o = t[n].objectGID;
            e.indexOf(o) !== -1 && (i[o] = !0)
        }
        return Object.keys(i).length === e.length
    }
    function o() {
        this.initialized = !1,
        this.quest = null ,
        this.currentStepId = null ,
        this.currentStep = null ,
        this.currentStepCount = null ,
        this.currentSubStepCount = null ,
        this.tutorialPopup = null
    }
    function s() {
        window.gui.tutorialManager.isChangingMap = !0,
        window.isoEngine.addArrowOnCell(h.TUTORIAL_STEP_CHANGE_MAP_ARROW_CELL_ID, 0, 0, "upLeft")
    }
    var a = i(26).inherits
      , r = i(16).EventEmitter
      , l = i(186)
      , c = i(453)
      , u = i(451)
      , h = i(597)
      , d = i(22)
      , p = i(599)
      , m = i(158)
      , f = i(181)
      , g = i(30)
      , _ = 0;
    a(o, r),
    e.exports = o,
    o.prototype.start = function() {
        this.initialized || (this._setupHandlerFunctions(),
        this._setupListeners(),
        this.initialized = !0),
        window.gui.playerData.quests.initialized ? this._requestQuestStatus() : window.gui.playerData.quests.once("listUpdated", this._requestQuestStatus),
        this.tutorialPopup = new p,
        this.tutorialPopup.open()
    }
    ,
    o.prototype._requestQuestStatus = function() {
        window.dofus.sendMessage("QuestStepInfoRequestMessage", {
            questId: h.QUEST_TUTORIAL_ID
        })
    }
    ,
    o.prototype.stop = function() {
        this.tutorialPopup && this.tutorialPopup.close()
    }
    ,
    o.prototype._updateSubStep = function(e) {
        this.currentSubStepCount = e,
        m.logTutorialSubStep(this.currentStepCount, e - 1)
    }
    ,
    o.prototype._setupHandlerFunctions = function() {
        function e(e) {
            return e === h.TUTORIAL_STEP_EQUIP_ITEM || e === h.TUTORIAL_STEP_EQUIP_ALL_ITEMS
        }
        var t = this;
        this.movementHandler = function(e) {
            e.actorId === window.gui.playerData.id && (t.currentStepCount === h.TUTORIAL_STEP_ROLEPLAY_MOVE || e.isInFight && t.currentStepCount === h.TUTORIAL_STEP_FIGHT_MOVE) && t._validateCurrentStep()
        }
        ,
        this.itemEquippedHandler = function(e) {
            if (t.currentStepCount === h.TUTORIAL_STEP_EQUIP_ITEM || t.currentStepCount === h.TUTORIAL_STEP_EQUIP_ALL_ITEMS) {
                var i = t.currentStepCount === h.TUTORIAL_STEP_EQUIP_ITEM ? h.FIRST_EQUIP_ITEMS : h.SECOND_EQUIP_ITEMS;
                e && i.indexOf(e.objectGID) !== -1 && (m.logTutorialSubStep(t.currentStepCount, "item" + e.position),
                this.currentSubStepCount++),
                n(i, window.gui.playerData.inventory.equippedItems) && t._validateCurrentStep()
            }
        }
        ,
        this.fightStartingHandler = function() {
            t.currentStepCount === h.TUTORIAL_STEP_STARTING_A_FIGHT || t.currentStepCount === h.TUTORIAL_STEP_FIND_BOSS ? t._validateCurrentStep() : t._updateHintArrow()
        }
        ,
        this.fightStartHandler = function() {
            t.currentStepCount === h.TUTORIAL_STEP_FIGHT_LOCATION ? t._validateCurrentStep() : t._updateHintArrow()
        }
        ,
        this.fightLocationHandler = function() {
            t.currentStepCount === h.TUTORIAL_STEP_FIGHT_LOCATION && t._validateCurrentStep()
        }
        ,
        this.figtTurnEndHandler = function(e) {
            t.currentStepCount === h.TUTORIAL_STEP_FIGHT_SKIP_TURN && e.id === window.gui.playerData.id && t._validateCurrentStep()
        }
        ,
        this.useSpellHandler = function(e) {
            t.currentStepCount === h.TUTORIAL_STEP_FIGHT_CAST_SPELL && e.sourceId === window.gui.playerData.id && t._validateCurrentStep()
        }
        ,
        this.npcDialogOpenedHandler = function() {
            t._updateSubStep(h.TUTORIAL_SUB_STEP_TALK_SHOW_RESPONSE),
            t._updateHintArrow()
        }
        ,
        this.windowOpenedHandler = function(i) {
            var n = i.id
              , o = t.currentStepCount;
            "equipment" === n && e(o) ? (t._updateSubStep(h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_TAB),
            t._updateHintArrow()) : t._hideArrows()
        }
        ,
        this.windowClosedHandler = function() {
            t._updateHintArrow()
        }
        ,
        this.equipmentFilterHandler = function(i) {
            e(t.currentStepCount) && t.currentSubStepCount > h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_ITEM_MENU_ICON && (i !== _ ? t._updateSubStep(h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_TAB) : t._updateSubStep(h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_EQUIPMENT),
            t._updateHintArrow())
        }
        ,
        this.equippableHighlightedHandler = function(i) {
            e(t.currentStepCount) && t.currentSubStepCount && c.pointToCharacterItem(i[0])
        }
        ,
        this.itemDragEndHandler = function(i, n, o) {
            o && "equipment" === o.source && e(t.currentStepCount) && t.currentSubStepCount && t._updateHintArrow()
        }
        ,
        this.updateHintArrowHandler = this._updateHintArrow.bind(this)
    }
    ,
    o.prototype._setupListeners = function() {
        var e = this
          , t = window.gui;
        t.on("disconnect", function() {
            e.reset()
        }),
        t.playerData.quests.on("questUpdate", function(t) {
            t === h.QUEST_TUTORIAL_ID && e._updateDisplay()
        }),
        t.playerData.quests.on("questFinished", function(t) {
            var i = t.questId;
            i === h.QUEST_TUTORIAL_ID && (g.setValue("tutorialDone", !0, 3),
            m.logTutorialStepEnd(15),
            f.trackTutorialCompleted(),
            e._hideArrows())
        }),
        t.tutorialManager.on("inTutorialStateChanged", function(t) {
            t ? e._registerInTutorialListeners() : e._removeInTutorialListeners()
        })
    }
    ,
    o.prototype._registerInTutorialListeners = function() {
        var e = window.gui;
        e.on("_tutorialGameMapMovementMessage", this.movementHandler),
        e.playerData.inventory.on("itemMoved", this.itemEquippedHandler),
        e.playerData.inventory.on("itemAdded", this.itemEquippedHandler),
        e.on("GameFightStartingMessage", this.fightStartingHandler),
        e.on("_tutorialGameEntitiesDispositionMessage", this.fightLocationHandler),
        e.on("GameFightStartMessage", this.fightStartHandler),
        e.fightManager.on("GameFightTurnStart", this.fightStartHandler),
        e.on("GameFightTurnEndMessage", this.figtTurnEndHandler),
        e.on("GameActionFightSpellCastMessage", this.useSpellHandler),
        e.on("GameActionFightCloseCombatMessage", this.useSpellHandler),
        e.npcDialogUi.on("opened", this.npcDialogOpenedHandler),
        d.on("opened", this.windowOpenedHandler),
        d.on("closed", this.windowClosedHandler);
        var t = d.getWindow("equipment");
        t.on("equippableHighlighted", this.equippableHighlightedHandler),
        t.storageView.on("filter", this.equipmentFilterHandler),
        l.on("dragEnd", this.itemDragEndHandler),
        window.isoEngine.on("mapLoaded", this.updateHintArrowHandler),
        window.gui.menuBar.on("open", this.updateHintArrowHandler),
        window.gui.menuBar.on("close", this.updateHintArrowHandler)
    }
    ,
    o.prototype._removeInTutorialListeners = function() {
        var e = window.gui;
        e.removeListener("_tutorialGameMapMovementMessage", this.movementHandler),
        e.playerData.inventory.removeListener("itemMoved", this.itemEquippedHandler),
        e.playerData.inventory.removeListener("itemAdded", this.itemEquippedHandler),
        e.removeListener("GameFightStartingMessage", this.fightStartingHandler),
        e.removeListener("_tutorialGameEntitiesDispositionMessage", this.fightLocationHandler),
        e.removeListener("GameFightStartMessage", this.fightStartHandler),
        e.fightManager.removeListener("GameFightTurnStart", this.fightStartHandler),
        e.removeListener("GameFightTurnEndMessage", this.figtTurnEndHandler),
        e.removeListener("GameActionFightSpellCastMessage", this.useSpellHandler),
        e.removeListener("GameActionFightCloseCombatMessage", this.useSpellHandler),
        e.npcDialogUi.removeListener("opened", this.npcDialogOpenedHandler),
        d.removeListener("opened", this.windowOpenedHandler),
        d.removeListener("closed", this.windowClosedHandler);
        var t = d.getWindow("equipment");
        t.removeListener("equippableHighlighted", this.equippableHighlightedHandler),
        t.storageView.removeListener("filter", this.equipmentFilterHandler),
        l.removeListener("dragEnd", this.itemDragEndHandler),
        window.isoEngine.removeListener("mapLoaded", this.updateHintArrowHandler),
        window.gui.menuBar.removeListener("open", this.updateHintArrowHandler),
        window.gui.menuBar.removeListener("close", this.updateHintArrowHandler)
    }
    ,
    o.prototype._validateCurrentStep = function() {
        if (this.currentStep) {
            for (var e = this.currentStep.questId, t = this.currentStep.objectiveIds, i = 0; i < t.length; i += 1)
                window.dofus.sendMessage("QuestObjectiveValidationMessage", {
                    questId: e,
                    objectiveId: t[i]
                });
            this._hideArrows(),
            m.logTutorialSubStep(this.currentStepCount, this.currentSubStepCount),
            this.currentSubStepCount = null
        }
    }
    ,
    o.prototype._hideArrows = function() {
        window.gui.hintArrow.hideArrow(),
        window.isoEngine.removeArrows()
    }
    ,
    o.prototype.reset = function() {
        this.quest = null ,
        this.currentStepId = null ,
        this.currentStep = null ,
        this.currentStepCount = null ,
        this.currentSubStepCount = null ,
        this.tutorialPopup.setContent(""),
        this.tutorialPopup.hide(),
        this._hideArrows(),
        window.gui.shortcutBar.setAvailability(!0),
        window.gui.timeline.fightControlButtons.setTurnReadyButtonAvailability(!0),
        window.gui.tutorialManager.inTutorial && this._removeInTutorialListeners()
    }
    ,
    o.prototype._shouldSkipFightLocationStep = function() {
        var e = window.gui.fightManager
          , t = e.FIGHT_STATES;
        return e.fightState === t.BATTLE && this.currentStepCount === h.TUTORIAL_STEP_FIGHT_LOCATION
    }
    ,
    o.prototype._shouldSkipEquipItemsStep = function() {
        if (this.currentStepCount === h.TUTORIAL_STEP_EQUIP_ITEM || this.currentStepCount === h.TUTORIAL_STEP_EQUIP_ALL_ITEMS) {
            var e = this.currentStepCount === h.TUTORIAL_STEP_EQUIP_ITEM ? h.FIRST_EQUIP_ITEMS : h.SECOND_EQUIP_ITEMS;
            return !n(e, window.gui.playerData.inventory.objects)
        }
    }
    ,
    o.prototype._updateDisplay = function() {
        var e = !1;
        this.currentStepCount && (m.logTutorialSubStep(this.currentStepCount, this.currentSubStepCount),
        m.logTutorialStepEnd(this.currentStepCount),
        e = !0);
        var t = h.QUEST_TUTORIAL_ID
          , i = window.gui.playerData.quests || {}
          , n = i.active || {}
          , o = n[t];
        return o ? (this.quest = o,
        this.currentStepId = o.stepId,
        this.currentStep = o.dbSteps[this.currentStepId],
        this.currentStepCount = o.dbQuest.stepIds.indexOf(this.currentStepId) + 1,
        e || m.log("F_T_U_E.Step0300_Enter_Tuto"),
        m.logTutorialStepStart(this.currentStepCount),
        this._updateSubStep(1),
        this._shouldSkipFightLocationStep() || this._shouldSkipEquipItemsStep() ? this._validateCurrentStep() : (this._handleMenuBarDisplay(),
        this._updateStepDescription(),
        void this._updateHintArrow())) : void console.error("TutorialStep: Cannot find quest data with questId: " + t)
    }
    ,
    o.prototype._handleMenuBarDisplay = function() {
        var e = this.currentStepCount;
        e >= h.TUTORIAL_STEP_EQUIP_ITEM && window.gui.uiLocker.unlockFeature("inventory", "tutorial")
    }
    ,
    o.prototype._updateStepDescription = function() {
        this.tutorialPopup.setContent(u.process(this.currentStep.descriptionId))
    }
    ,
    o.prototype._pointToMonsterCheck = function() {
        window.gui.playerData.isFighting || window.isoEngine.addArrowOnMonster(this.currentStepCount >= h.TUTORIAL_STEP_FIND_BOSS ? h.TUTORIAL_BOSS_MONSTER_ID : h.TUTORIAL_FIRST_MONSTER_ID)
    }
    ,
    o.prototype._handleHintArrow = function() {
        if (this._hideArrows(),
        window.gui.shortcutBar.setAvailability(!0),
        window.gui.timeline.fightControlButtons.setTurnReadyButtonAvailability(!0),
        this.currentStepCount)
            switch (this.currentStepCount) {
            case h.TUTORIAL_STEP_ROLEPLAY_MOVE:
                window.isoEngine.addArrowOnCell(h.TUTORIAL_STEP_ROLEPLAY_MOVE_CELL_ID, 0, 0, "upLeft");
                break;
            case h.TUTORIAL_STEP_TALK:
            case h.TUTORIAL_STEP_START_QUEST:
            case h.TUTORIAL_STEP_SUCCESS_QUEST:
                this.currentSubStepCount === h.TUTORIAL_SUB_STEP_TALK_SHOW_NPC ? window.isoEngine.addArrowOnNpc(h.TUTORIAL_STEP_TALK_NPC_ID) : this.currentSubStepCount === h.TUTORIAL_SUB_STEP_TALK_SHOW_RESPONSE && c.pointToNpcAnswer(0);
                break;
            case h.TUTORIAL_STEP_EQUIP_ITEM:
            case h.TUTORIAL_STEP_EQUIP_ALL_ITEMS:
                switch (this.currentSubStepCount) {
                case h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_ITEM_MENU_ICON:
                    c.pointToMenuIcon("Bag");
                    break;
                case h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_TAB:
                    c.pointToEquipFilterIcon();
                    break;
                case h.TUTORIAL_SUB_STEP_EQUIP_ITEM_SHOW_EQUIPMENT:
                    c.pointToStorageFirstSlotBox()
                }
                break;
            case h.TUTORIAL_STEP_CHANGE_MAP:
                c.pointToWindowCloseButton("equipment"),
                d.getWindow("equipment").openState || s();
                break;
            case h.TUTORIAL_STEP_STARTING_A_FIGHT:
                this._pointToMonsterCheck();
                break;
            case h.TUTORIAL_STEP_FIGHT_LOCATION:
                this._pointToMonsterCheck(),
                window.foreground.tapOptions && "fightPlacement" === window.foreground.tapOptions.mode && window.isoEngine.addArrowsSequence(h.FIGHT_LOCATION_TARGET_CELLS);
                break;
            case h.TUTORIAL_STEP_FIGHT_MOVE:
                if (this._pointToMonsterCheck(),
                window.foreground.tapOptions)
                    if ("fightPlacement" === window.foreground.tapOptions.mode)
                        c.pointToTimelineButton("fightReadyBtn");
                    else if ("fight" === window.foreground.tapOptions.mode) {
                        var e = window.gui.playerData.id
                          , t = window.gui.fightManager
                          , i = t.currentFighterId
                          , n = t.getFighter(e);
                        if (!n)
                            return console.error("Tutorial step fight move failed, fighter does not exist");
                        if (i === e) {
                            var o = h.FIGHT_MOVE_TARGET_CELLS[n.data.disposition.cellId];
                            window.isoEngine.addArrowOnCell(o)
                        }
                        window.gui.shortcutBar.setAvailability(!1),
                        window.gui.timeline.fightControlButtons.setTurnReadyButtonAvailability(!1)
                    }
                break;
            case h.TUTORIAL_STEP_FIGHT_CAST_SPELL:
                this._pointToMonsterCheck(),
                window.gui.playerData.isFighting && c.pointToFirstSkillShortcut();
                break;
            case h.TUTORIAL_STEP_FIGHT_SKIP_TURN:
                this._pointToMonsterCheck(),
                c.pointToTimelineButton("turnReadyBtn");
                break;
            case h.TUTORIAL_STEP_FIND_BOSS:
                this._pointToMonsterCheck(),
                c.pointToWindowCloseButton("equipment"),
                d.getWindow("equipment").openState || window.gui.playerData.position.mapId !== h.TUTORIAL_MAP_ID_SECOND_AFTER_FIGHT || s()
            }
    }
    ,
    o.prototype._updateHintArrow = function() {
        var e = this;
        setTimeout(function() {
            e._handleHintArrow()
        }, 0)
    }
}
, function(e, t, i) {
    function n(e) {
        r.call(this, "div", e),
        this.addClassNames("tutorialPopup"),
        this.appendChild(new r("div",{
            className: "tutorialPopupTitle",
            text: s("tablet.joris")
        })),
        this.content = this.appendChild(new r("div",{
            className: "tutorialPopupContent"
        })),
        this.appendChild(new r("div",{
            className: "joris"
        }))
    }
    var o = i(24).dimensions
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(190);
    i(600),
    a(n, r),
    e.exports = n,
    n.prototype.setContent = function(e) {
        this.content.clearContent(),
        e instanceof r ? this.content.appendChild(e) : this.content.setText(e),
        this.show()
    }
    ,
    n.prototype.open = function() {
        this.setStyle("bottom", o.screenHeight - o.mapHeight + 7 + "px"),
        this.hide(),
        window.gui.windowsContainer.appendChild(this)
    }
    ,
    n.prototype.close = function() {
        this.hide()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return e = e || "",
        e.split(",")[0]
    }
    function o(e) {
        var t = E[e];
        if (t) {
            for (var i = T[e], o = n(i.trigger), s = A[o], a = s.eventsList || [], r = 0; r < a.length; r += 1) {
                var l = a[r];
                l.listener.removeListener(l.eventId, t)
            }
            delete E[e]
        }
    }
    function s() {
        for (var e = Object.keys(E), t = 0; t < e.length; t += 1) {
            var i = e[t];
            o(i)
        }
    }
    function a() {
        s();
        for (var e = 0; e < x.length; e += 1)
            window.gui.notificationBar.removeNotification(x[e]);
        x = []
    }
    function r(e) {
        var t = x.indexOf(e);
        t >= 0 && x.splice(t, 1)
    }
    function l(e) {
        var t = e.id
          , i = "tip" + t
          , n = window.gui.notificationBar;
        if (!n.isNotificationOpen(i) && !S[t]) {
            var s = {
                type: n.notificationType.TUTORIAL,
                title: e.titleId,
                wuidom: w.process(e.messageId),
                onClose: function() {
                    window.dofus.sendMessage("NotificationUpdateFlagMessage", {
                        index: t
                    }),
                    S[t] = !0,
                    r(i)
                }
            };
            n.newNotification(i, s),
            x.push(i),
            o(t)
        }
    }
    function c() {
        for (var e in T) {
            var t = T[e]
              , i = n(t.trigger)
              , o = A[i];
            if (i && o && !S[e])
                if ("GameStart" !== i)
                    for (var s = o.eventsList || [], a = 0; a < s.length; a += 1) {
                        var r = s[a]
                          , c = r.listener
                          , u = r.eventId;
                        if (!E[e]) {
                            var h = o.customFunc || l;
                            E[e] = h.bind(null , t)
                        }
                        var d = E[e];
                        c.on(u, d)
                    }
                else
                    l(t)
        }
    }
    function u() {
        setTimeout(function() {
            c()
        }, 0)
    }
    function h(e, t) {
        for (var i = t.results || [], n = 0; n < i.length; n += 1) {
            var o = i[n];
            if (o.id === window.gui.playerData.id && o.outcome === v.RESULT_VICTORY)
                return l(e)
        }
    }
    function d(e, t) {
        for (var i = t.actors || [], n = 0; n < i.length; n += 1)
            if ("GameRolePlayGroupMonsterInformations" === i[n]._type)
                return l(e)
    }
    function p(e, t) {
        t.actorId === window.gui.playerData.id && l(e)
    }
    function m() {
        var e = window.gui
          , t = e.playerData
          , i = I.getWindow("grimoire");
        A = {
            CharacterLevelUp: {
                eventsList: [{
                    listener: t,
                    eventId: "characterLevelUp"
                }]
            },
            FightResultVictory: {
                customFunc: h,
                eventsList: [{
                    listener: e,
                    eventId: "GameFightEndMessage"
                }]
            },
            FightSpellCast: {
                eventsList: [{
                    listener: e,
                    eventId: "GameActionFightSpellCastMessage"
                }, {
                    listener: e,
                    eventId: "GameActionFightCloseCombatMessage"
                }]
            },
            GameFightStart: {
                eventsList: [{
                    listener: e,
                    eventId: "GameFightStartMessage"
                }]
            },
            GameFightStarting: {
                eventsList: [{
                    listener: e,
                    eventId: "GameFightStartingMessage"
                }]
            },
            GameRolePlayPlayerLifeStatus: {
                eventsList: [{
                    listener: e,
                    eventId: "GameRolePlayPlayerLifeStatusMessage"
                }]
            },
            GameStart: {},
            LifePointsRegenBegin: {
                eventsList: [{
                    listener: e,
                    eventId: "LifePointsRegenBeginMessage"
                }]
            },
            MapWithMonsters: {
                customFunc: d,
                eventsList: [{
                    listener: e,
                    eventId: "MapComplementaryInformationsDataMessage"
                }]
            },
            NpcDialogCreation: {
                eventsList: [{
                    listener: e,
                    eventId: "NpcDialogCreationMessage"
                }]
            },
            OpenBook: {
                eventsList: [{
                    listener: i,
                    eventId: "open"
                }]
            },
            OpenGrimoireAlignmentTab: {
                eventsList: [{
                    listener: i.tabs.getTabTarget("alignment"),
                    eventId: "open"
                }]
            },
            OpenGrimoireJobTab: {
                eventsList: [{
                    listener: i.tabs.getTabTarget("jobs"),
                    eventId: "open"
                }]
            },
            OpenGrimoireQuestTab: {
                eventsList: [{
                    listener: i.tabs.getTabTarget("quests"),
                    eventId: "open"
                }]
            },
            OpenGrimoireSpellTab: {
                eventsList: [{
                    listener: i.tabs.getTabTarget("spells"),
                    eventId: "open"
                }]
            },
            OpenInventory: {
                eventsList: [{
                    listener: I.getWindow("equipment"),
                    eventId: "open"
                }]
            },
            OpenStats: {
                eventsList: [{
                    listener: I.getWindow("characteristics"),
                    eventId: "open"
                }]
            },
            PlayerFightMove: {
                customFunc: p,
                eventsList: [{
                    listener: e,
                    eventId: "GameMapMovementMessage"
                }]
            },
            PlayerIsDead: {
                eventsList: [{
                    listener: t,
                    eventId: "playerIsDead"
                }]
            },
            PlayerMove: {
                customFunc: p,
                eventsList: [{
                    listener: window.dofus,
                    eventId: "GameMapMovementMessage"
                }]
            },
            PlayerNewSpell: {
                eventsList: [{
                    listener: t.characters.mainCharacter,
                    eventId: "newSpellLearned"
                }]
            }
        }
    }
    function f(e) {
        b.getAllDataMap("Notifications", function(t, i) {
            return t ? e(t) : (T = i,
            void e())
        })
    }
    function g(e) {
        f(function(t) {
            return t ? e(t) : (m(),
            void e())
        })
    }
    function _(e) {
        S = {};
        for (var t = 0; t < e.length; t += 1)
            for (var i = e[t], n = 0; n < 32; n += 1)
                S[n + 32 * t] = !!(1 & i),
                i >>= 1
    }
    var v = i(602)
      , y = i(25)
      , w = i(451)
      , b = i(36)
      , C = i(30)
      , I = i(22)
      , T = {}
      , S = {}
      , A = {}
      , E = {}
      , x = []
      , M = !0
      , N = !1;
    t.initialize = function(e) {
        e.once("initialized", function() {
            M = C.getValue("option-tutorialTips", !0),
            y.on("tutorialTips", function(e) {
                t.enableTips(e)
            }),
            g(function(e) {
                if (e)
                    return console.error(e)
            })
        }),
        e.tutorialManager.on("inTutorialStateChanged", function(e) {
            N = e,
            N ? (a(),
            window.gui.notificationBar.clearNotifications()) : M && !N && u()
        }),
        e.on("disconnect", function() {
            a(),
            N = !1
        }),
        e.on("NotificationListMessage", function(e) {
            _(e.flags)
        })
    }
    ,
    t.enableTips = function(e) {
        M = e,
        N || (M ? u() : a())
    }
    ,
    t.resetTips = function() {
        window.dofus.sendMessage("NotificationResetMessage"),
        _([0]),
        M && !N && (a(),
        u())
    }
}
, function(e, t) {
    e.exports = {
        RESULT_LOST: 0,
        RESULT_DRAW: 1,
        RESULT_VICTORY: 2,
        RESULT_TAX: 5,
        RESULT_DEFENDER_GROUP: 6
    }
}
, function(e, t, i) {
    function n(e) {
        a.call(this, "div", {
            className: "RoleplayBuffs"
        }),
        l(this),
        this.slotList = {},
        this._createDom(),
        this._setupListeners(e),
        this.hide()
    }
    function o(e) {
        return e.position === h.INVENTORY_POSITION_MUTATION || e.position === h.INVENTORY_POSITION_BOOST_FOOD || e.position === h.INVENTORY_POSITION_FIRST_BONUS || e.position === h.INVENTORY_POSITION_SECOND_BONUS || e.position === h.INVENTORY_POSITION_FIRST_MALUS || e.position === h.INVENTORY_POSITION_SECOND_MALUS || e.position === h.INVENTORY_POSITION_ROLEPLAY_BUFFER || e.position === h.INVENTORY_POSITION_FOLLOWER
    }
    i(604);
    var s = i(26).inherits
      , a = i(190)
      , r = i(567)
      , l = i(439)
      , c = i(605).isEmptyObject
      , u = i(24).dimensions
      , h = i(606);
    s(n, a),
    e.exports = n,
    n.prototype._setupListeners = function(e) {
        var t = this;
        window.gui.on("connected", function() {
            t.setStyle("left", ~~(u.mapWidth / 2) + u.mapLeft + "px"),
            t.setStyle("top", u.mapTop + "px")
        }),
        e.on("listUpdate", function(e) {
            t._unloadContent();
            for (var i in e)
                t._addItem(e[i])
        }),
        e.on("unloaded", function() {
            t._unloadContent()
        }),
        e.on("itemAdded", function(e) {
            t._addItem(e)
        }),
        e.on("itemsAdded", function(e) {
            for (var i in e)
                t._addItem(e[i])
        }),
        e.on("itemDeleted", function(e) {
            t._removeItem(e)
        }),
        e.on("itemsDeleted", function(e) {
            for (var i in e)
                t._removeItem(e[i])
        }),
        e.on("itemModified", function(e) {
            t._modifyItem(e)
        })
    }
    ,
    n.prototype._createDom = function() {
        this.slotBox = this.createChild("div", {
            className: "slotBox"
        })
    }
    ,
    n.prototype._addItem = function(e) {
        if (o(e)) {
            var t = e.objectUID
              , i = this.slotList[t];
            i || (i = this.slotList[t] = new r({
                itemData: e,
                enableContextMenu: !1,
                descriptionOptions: {
                    averagePrice: !1,
                    showCategory: !1,
                    showWeight: !1
                }
            }),
            this.slotBox.appendChild(i),
            this.show(),
            this.emit("resized"))
        }
    }
    ,
    n.prototype._removeItem = function(e) {
        var t = this.slotList[e];
        t && (t.destroy(),
        delete this.slotList[e],
        c(this.slotList) && this.hide(),
        this.emit("resized"))
    }
    ,
    n.prototype._modifyItem = function(e) {
        this._removeItem(e.objectUID),
        this._addItem(e)
    }
    ,
    n.prototype._unloadContent = function() {
        this.slotList = {},
        this.slotBox.clearContent(),
        this.hide()
    }
}
, function(e, t) {}
, function(e, t) {
    t.isEmptyObject = function(e) {
        var t;
        for (t in e)
            return !1;
        return !0
    }
}
, function(e, t) {
    e.exports = {
        ACCESSORY_POSITION_HAT: 6,
        ACCESSORY_POSITION_CAPE: 7,
        ACCESSORY_POSITION_BELT: 3,
        ACCESSORY_POSITION_BOOTS: 5,
        ACCESSORY_POSITION_AMULET: 0,
        ACCESSORY_POSITION_SHIELD: 15,
        ACCESSORY_POSITION_WEAPON: 1,
        ACCESSORY_POSITION_PETS: 8,
        INVENTORY_POSITION_RING_LEFT: 2,
        INVENTORY_POSITION_RING_RIGHT: 4,
        INVENTORY_POSITION_DOFUS_1: 9,
        INVENTORY_POSITION_DOFUS_2: 10,
        INVENTORY_POSITION_DOFUS_3: 11,
        INVENTORY_POSITION_DOFUS_4: 12,
        INVENTORY_POSITION_DOFUS_5: 13,
        INVENTORY_POSITION_DOFUS_6: 14,
        INVENTORY_POSITION_MOUNT: 16,
        INVENTORY_POSITION_MUTATION: 20,
        INVENTORY_POSITION_BOOST_FOOD: 21,
        INVENTORY_POSITION_FIRST_BONUS: 22,
        INVENTORY_POSITION_SECOND_BONUS: 23,
        INVENTORY_POSITION_FIRST_MALUS: 24,
        INVENTORY_POSITION_SECOND_MALUS: 25,
        INVENTORY_POSITION_ROLEPLAY_BUFFER: 26,
        INVENTORY_POSITION_FOLLOWER: 27,
        INVENTORY_POSITION_NOT_EQUIPED: 63
    }
}
, function(e, t, i) {
    function n() {
        d = window.gui,
        p = window.isoEngine,
        d.playerData.on("characterSelectedSuccess", o)
    }
    function o() {
        y && r() && (p.on("mapLoaded", s),
        d.once("disconnect", a))
    }
    function s() {
        return d.playerData.position.removeListener("worldMapUpdate", s),
        d.tutorialManager.removeListener("inTutorialStateChanged", s),
        0 === d.playerData.position.worldmapId ? void d.playerData.position.once("worldMapUpdate", s) : void 0 === d.tutorialManager.inTutorial ? void d.tutorialManager.once("inTutorialStateChanged", s) : void (l() && (p.removeListener("mapLoaded", s),
        m.initialize(),
        f.initialize(),
        g.initialize()))
    }
    function a() {
        p.removeListener("mapLoaded", s),
        d.playerData.position.removeListener("worldMapUpdate", s),
        d.tutorialManager.removeListener("inTutorialStateChanged", s),
        w = !1
    }
    function r() {
        return d.playerData.characterBaseInformations.level <= _.characterLevelLimit
    }
    function l(e) {
        return !d.tutorialManager.inTutorial && (!!(p.gameContext !== v.FIGHT || e && e.fightContextAllowed) && (d.playerData.position.worldmapId !== _.INCARNAM_WORLD_MAP ? w : d.playerData.characterBaseInformations.level > _.characterLevelLimit ? w : (w = !0,
        !0)))
    }
    function c(e) {
        w = e
    }
    function u() {
        a(),
        m.removeAndClean(),
        f.removeAndClean(),
        g.removeAndClean()
    }
    function h(e) {
        var t = "Wrong parameter, allowed parameters are: on, ui reset, ui unlock, trigger reset";
        if (!e)
            return t;
        if (1 === e.length && "on" === e[0])
            return y ? "Already activated" : (y = !0,
            o(),
            "Activated");
        if (2 === e.length)
            if ("ui" === e[0]) {
                if ("reset" === e[1])
                    return g.reset(),
                    "Done";
                if ("unlock" === e[1])
                    return g.unlockAll(),
                    "Done"
            } else if ("trigger" === e[0] && "reset" === e[1])
                return f.reset(),
                "Done";
        return t
    }
    i(608);
    var d, p, m = i(609), f = i(628), g = i(629), _ = i(627), v = i(85), y = !0, w = !1;
    t.initialize = n,
    t.isBeginnerAssistantRequired = l,
    t.adminCommand = h,
    t.openDialog = f.openDialog,
    t.setRequired = c,
    t.removeAndClean = u
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return Math.floor(Math.random() * e.length)
    }
    function o(e) {
        return e[n(e)]
    }
    function s(e) {
        return !(!e && 0 !== e) && (e >= 0 && e <= 559)
    }
    function a(e) {
        var t = e + 28;
        return s(t) ? t : null
    }
    function r(e) {
        var t = e - 28;
        return s(t) ? t : null
    }
    function l(e) {
        for (var t, i, n = e.length; 0 !== n; )
            i = Math.floor(Math.random() * n),
            n -= 1,
            t = e[n],
            e[n] = e[i],
            e[i] = t;
        return e
    }
    function c() {
        return me === Re.NOT_CREATED ? null : ce
    }
    function u() {
        ce && ce.refreshAnimation()
    }
    function h() {
        ae = window.isoEngine,
        re = window.actorManager,
        le = window.gui,
        me = Re.NOT_CREATED,
        we = {
            transitionning: !1,
            mapSide: null
        },
        ae.on("mapLoaded", d),
        ae.on("launchMapTransition", ie),
        ae.on("cancelMapTransition", ne),
        le.once("disconnect", p),
        d()
    }
    function d(e) {
        Ie.isBeginnerAssistantRequired() && (e && e.isReload && ce && me !== Re.NOT_CREATED || (we.transitionning = !1,
        we.mapSide = null ,
        ve = {},
        ye = {},
        _e = !1,
        L()))
    }
    function p() {
        ae.removeListener("mapLoaded", d),
        ae.removeListener("launchMapTransition", ie),
        ae.removeListener("cancelMapTransition", ne)
    }
    function m() {
        p()
    }
    function f(e, t) {
        return t = t || 1,
        e < 28 * t
    }
    function g(e, t) {
        return t = t || 1,
        e > 559 - 28 * t
    }
    function _(e, t) {
        t = t || 1;
        var i = e % 14;
        return i < t
    }
    function v(e, t) {
        t = t || 1;
        var i = e % 14;
        return i > 13 - t
    }
    function y(e, t) {
        return _(e, t) || v(e, t) || f(e, t) || g(e, t)
    }
    function w(e) {
        var t = a(e);
        return !!re.occupiedCells[t]
    }
    function b(e) {
        var t = r(e);
        return !!re.occupiedCells[t]
    }
    function C(e) {
        var t = r(e)
          , i = Ee.exits[le.playerData.position.mapId];
        if (!i || !i.length)
            return !1;
        for (var n = 0; n < i.length; n++) {
            var o = i[n]
              , s = null ;
            if ("tile" === o.target)
                s = o.targetId;
            else if ("interactive" === o.type) {
                var a = ae.mapRenderer.identifiedElements[o.targetId];
                a && void 0 !== a._position && null !== a._position && (s = a._position)
            }
            if (null !== s && (e === s || t === s))
                return !0
        }
        return !1
    }
    function I(e, t) {
        var i;
        t || (i = {
            front: !1,
            behind: !1
        });
        var n = a(e)
          , o = r(e)
          , s = ae.mapRenderer.interactiveElements
          , l = ae.mapRenderer.identifiedElements;
        for (var c in s)
            if (l[c] && void 0 !== l[c]._position) {
                if (l[c]._position === n) {
                    if (t)
                        return !0;
                    i.front = !0
                }
                if (l[c]._position === o) {
                    if (t)
                        return !0;
                    i.behind = !0
                }
            }
        return i
    }
    function T(e) {
        if (!ae.mapRenderer.isVisibleCell(e))
            return !1;
        var t = r(e);
        return !!s(t) && ae.mapRenderer.isVisibleCell(t)
    }
    function S(e, t, i) {
        t = t || (i ? 0 : 1);
        for (var n = [], o = Ae.getMapPointFromCellId(e), s = o.x - t, a = o.x + t, r = o.y - t, l = o.y + t, c = r; c <= l; c++)
            for (var u = s; u <= a; u++)
                if (u !== o.x || c !== o.y || i) {
                    var h = Ae.getCellIdFromMapPoint(u, c);
                    h && n.push(h)
                }
        return n
    }
    function A(e) {
        if (!s(e) || 0 === ve[e] || re.occupiedCells[e])
            return 0;
        var t = Be;
        if (void 0 !== ve[e])
            t = ve[e];
        else {
            if (!ae.mapRenderer.isWalkable(e, !1))
                return ve[e] = 0,
                0;
            T(e) || (t -= 25),
            y(e, 1) && (t -= 3),
            y(e, 2) && (t -= 2),
            y(e, 3) && (t -= 1),
            C(e) && (t -= 30);
            var i = I(e);
            i.front && (t -= 15),
            i.behind && (t -= 10),
            ve[e] = t
        }
        return w(e) && (t -= 15),
        b(e) && (t -= 15),
        t
    }
    function E(e, t) {
        if (!s(e) || ye[e] === !1)
            return !1;
        if (re.occupiedCells[e]) {
            if (re.occupiedCells[e].length > 1)
                return !1;
            if (!ce || ce.cellId !== e)
                return !1
        }
        var i = !0;
        return !(void 0 === ye[e] && ((!ae.mapRenderer.isWalkable(e, !1) || !T(e) || t && y(e, 2) || C(e) || I(e, !0)) && (i = !1),
        ye[e] = i,
        !i)) && ((w(e) || b(e)) && (i = !1),
        i)
    }
    function x(e, t) {
        for (var i, n = 1, s = [], a = 0; a < e.length; a++)
            i = A(e[a]),
            i > n && (n = i,
            s = []),
            i === n && s.push(e[a]);
        return 0 === s.length ? null : t ? s : o(s)
    }
    function M(e, t, i) {
        var n = S(e, t, i);
        if (0 === n.length)
            return null ;
        var s = x(n, !0);
        return s && 0 !== s.length || (s = n),
        o(s)
    }
    function N(e, t, i) {
        for (var n = 0; n <= t; n++)
            if (0 !== n || i) {
                var o = S(e, n, i);
                if (0 !== o.length) {
                    var a = x(o);
                    if (s(a))
                        return a
                }
            }
        return null
    }
    function R() {
        ce = null ,
        me = Re.NOT_CREATED,
        ge = null
    }
    function O() {
        ke.emit("removed"),
        R()
    }
    function P() {
        O(),
        Te.prototype.remove.call(this)
    }
    function D(e, t, i) {
        var n = {
            contextualId: "beginnerAssistant",
            look: {
                bonesId: xe,
                scales: [100],
                skins: []
            },
            disposition: {
                cellId: e,
                direction: t
            },
            name: "Joris",
            _type: "BeginnerAssistant"
        };
        re.addActor(n, function(t) {
            return t ? (ce = t,
            ce.remove = P,
            ce.setCellPosition(e),
            re.addAnimBehaviourToActor(ce.actorId, W),
            me = Re.CREATED,
            void i()) : i(new Error("Unable to create the beginner assistant actor"))
        })
    }
    function L() {
        if (ce || me !== Re.NOT_CREATED) {
            if (be === le.playerData.position.mapId)
                return console.error(new Error("Beginner assistant deploy: actor is already loaded"));
            console.error(new Error("Beginner assistant deploy: actor is already loaded but map has changed. Will re-create it for seemless user experience but this should not happen.")),
            O()
        }
        var e = ue = re.userActor.position
          , t = Ae.getMapPointFromCellId(e)
          , i = y(e, 2)
          , n = re.userActor.direction
          , o = null ;
        if (i) {
            var a = [];
            if (_(e, 2))
                a.push({
                    x: -1,
                    y: 1
                }),
                a.push({
                    x: 1,
                    y: -1
                }),
                n = 1;
            else if (v(e, 2))
                a.push({
                    x: -1,
                    y: 1
                }),
                a.push({
                    x: 1,
                    y: -1
                }),
                n = 3;
            else if (f(e, 2))
                a.push({
                    x: -1,
                    y: -1
                }),
                a.push({
                    x: 1,
                    y: 1
                }),
                n = Math.random() > .5 ? 3 : 1;
            else {
                if (!g(e, 2))
                    return console.error(new Error("player seems to be on map border but unable to determine which one"));
                a.push({
                    x: -1,
                    y: -1
                }),
                a.push({
                    x: 1,
                    y: 1
                }),
                n = Math.random() > .5 ? 5 : 7
            }
            for (var r = 0; r < a.length; r++) {
                var l = Ae.getCellIdFromMapPoint(t.x + a[r].x, t.y + a[r].y);
                if (E(l, !1)) {
                    o = l;
                    break
                }
            }
            s(o) || (o = N(e, 7))
        } else
            o = N(e, 7);
        return s(o) ? void D(o, n, function(e) {
            return e ? console.error(e) : i ? (me = Re.MAP_TRANSITION_ENTER,
            void ae.makeActorWalkIn(ce, 300, function() {
                fe = Date.now() + 3e3,
                me = Re.WAITING_PLAYER,
                u(),
                ke.emit("actorStopped"),
                ke.emit("actorReady")
            })) : (fe = Date.now() + k(),
            me = Re.IDLE,
            u(),
            ke.emit("actorStopped"),
            void ke.emit("actorReady"))
        }) : console.error(new Error("Unable to deploy beginner assistant near the player"))
    }
    function B() {
        ce.setCellPosition(ce.position)
    }
    function k() {
        return Pe + Math.floor(Math.random() * De)
    }
    function F(e) {
        return (de !== e || !he || void 0 === pe || pe >= he.length) && (de = e,
        he = Ne[e],
        pe = 0,
        l(he)),
        he[pe++]
    }
    function H() {
        return re.userActor.moving && y(re.userActor.cellId, 1)
    }
    function G() {
        return y(re.userActor.cellId)
    }
    function U() {
        return ce ? Ae.getDistance(ce.position, re.userActor.position) : console.error(new Error("Beginner assistant visualDistanceFromUser: no actor available"))
    }
    function j() {
        return re.occupiedCells[ce.cellId].length > 1
    }
    function q() {
        return me === Re.IDLE || me === Re.WAITING_PLAYER || me === Re.WAITING_FOR_PLAYER_EXIT
    }
    function W() {
        if (me !== Re.CREATED && !_e) {
            var e = Date.now() > fe
              , t = H();
            if (me === Re.WAITING_PLAYER) {
                var i = ue !== re.userActor.position;
                i ? t ? X() : Y() : j() ? J() : e && z()
            } else if (me === Re.IDLE && t)
                X();
            else if (me === Re.IDLE && e) {
                var n = Math.random() < Le ? "pose" : "move";
                "pose" === n && ($() && !j() && E(ce.cellId) || (n = "move")),
                "pose" === n ? K() : J()
            } else
                me !== Re.MOVING_TO_EXIT || t ? j() && q() ? J() : me !== Re.WAITING_FOR_PLAYER_EXIT || t || G() ? e && (fe = Date.now() + k()) : (me = Re.IDLE,
                fe = Date.now() + k()) : Q()
        }
    }
    function V() {
        return we.transitionning && me !== Re.MAP_TRANSITION_EXIT ? oe() : (fe = Date.now() + k(),
        me = Re.IDLE,
        void ke.emit("actorStopped"))
    }
    function z() {
        me = Re.WAITING_PLAYER_POSE,
        fe = 1 / 0;
        var e = Z()
          , t = F("ENTERED_MAP_ANIMS");
        ce.setDisposition(ce.position, e),
        se(t, e, function() {
            ce && (fe = Date.now() + k(),
            me = Re.WAITING_PLAYER,
            ke.emit("actorStopped"))
        })
    }
    function Y(e) {
        me = Re.FIRST_MOVEMENT;
        var t = M(re.userActor.cellId, 3, !1, !0);
        if (null === t)
            return V();
        var i = Se.getPath(ce.cellId, t, re.occupiedCells, !0);
        return 0 === i.length ? V() : (t = i[i.length - 1],
        ce.setCellPosition(t),
        ge = i,
        ce.speedAdjust = Oe,
        void ce.setPath(i, {
            cb: function() {
                if (ce)
                    return ce.speedAdjust = 0,
                    ge = null ,
                    ce.position === t || (B(),
                    e) ? we.transitionning && me !== Re.MAP_TRANSITION_EXIT ? oe() : void V() : Y(!0)
            }
        }))
    }
    function X(e) {
        me = Re.MOVING_TO_EXIT,
        fe = 1 / 0;
        var t = N(re.userActor.cellId, 3, !1);
        if (!s(t))
            return void (me = Re.WAITING_FOR_PLAYER_EXIT);
        var i = Se.getPath(ce.cellId, t, re.occupiedCells, !0);
        return 0 === i.length ? void (me = Re.WAITING_FOR_PLAYER_EXIT) : (t = i[i.length - 1],
        ce.setCellPosition(t),
        ge = i,
        ce.speedAdjust = Oe,
        void ce.setPath(i, {
            cb: function() {
                if (ce && (ce.speedAdjust = 0,
                me === Re.MOVING_TO_EXIT)) {
                    if (ge = null ,
                    ce.position !== t)
                        return B(),
                        void (e || X(!0));
                    if (we.transitionning && me !== Re.MAP_TRANSITION_EXIT)
                        return oe();
                    me = Re.WAITING_FOR_PLAYER_EXIT,
                    fe = Date.now() + k()
                }
            }
        }))
    }
    function Q(e) {
        if (ge) {
            ce.speedAdjust = 0;
            var t = ge.indexOf(ce.position);
            if (t !== -1) {
                var i = ge[t + 1];
                s(i) && (B(),
                me = Re.MOVING_CANCEL,
                ce.cancelMovement(function() {
                    ce && (ge = null ,
                    V(),
                    e && e())
                }))
            }
        }
    }
    function K() {
        me = Re.IDLE_POSE,
        fe = 1 / 0;
        var e = Z()
          , t = F("IDLE_ANIMS");
        ce.setDisposition(ce.position, e),
        se(t, e, function() {
            ce && V()
        })
    }
    function J() {
        me = Re.IDLE_MOVE,
        fe = 1 / 0;
        var e = M(ce.cellId, 3, !1, !0);
        if (!s(e))
            return V();
        var t = Se.getPath(ce.cellId, e, re.occupiedCells, !0);
        return 0 === t.length ? V() : (e = t[t.length - 1],
        ce.setCellPosition(e),
        ge = t,
        ce.speedAdjust = 0,
        void ce.setPath(t, {
            forceWalk: !0,
            cb: function() {
                if (ce)
                    return ge = null ,
                    ce.position !== e && B(),
                    we.transitionning && me !== Re.MAP_TRANSITION_EXIT ? oe() : void V()
            }
        }))
    }
    function Z() {
        var e = ce.direction;
        return 5 === e || 4 === e ? e = 3 : 7 === e || 0 === e ? e = 1 : 6 !== e && 2 !== e || (e = Math.random() > .5 ? 3 : 1),
        e
    }
    function $() {
        return 3 === ce.direction || 1 === ce.direction || 2 === ce.direction
    }
    function ee() {
        _e = !0
    }
    function te(e) {
        fe = Date.now() + (e || 0),
        _e = !1
    }
    function ie(e) {
        be = le.playerData.position.mapId,
        ce && !_e && (we.mapSide = e,
        we.transitionning = !0,
        q() && oe())
    }
    function ne(e) {
        ce && !_e && (we.transitionning = !1,
        we.mapSide = null ,
        me = Re.MAP_TRANSITION_EXIT,
        ae.makeActorWalkInDirection(ce, e, !0, function() {
            ce && V()
        }))
    }
    function oe() {
        if (ce && !_e && we.transitionning && me !== Re.MAP_TRANSITION_EXIT) {
            if (U() > 3)
                return void X();
            me = Re.MAP_TRANSITION_EXIT,
            ae.makeActorWalkInDirection(ce, we.mapSide, !1)
        }
    }
    function se(e, t, i) {
        var n = {
            base: Me[e],
            direction: t
        }
          , o = ce;
        ce.animManager.addAnimation(n, function() {
            ce && ce === o && ce.animManager.assignSymbol(n, !1, function() {
                ce && ce === o && (ce.staticAnim(),
                ce.animManager.cleanupAnimations(),
                i && i())
            })
        })
    }
    var ae, re, le, ce, ue, he, de, pe, me, fe, ge, _e, ve, ye, we, be, Ce = i(16).EventEmitter, Ie = i(607), Te = i(610), Se = i(625), Ae = i(626), Ee = i(627), xe = 3192, Me = {
        HandWave: "AnimAttaque1",
        LookOnFloor: "AnimAttaque2",
        LookAround: "AnimAttaque3",
        AirPunchs: "AnimAttaque4",
        Jump: "AnimAttaque5",
        LetsGo: "AnimAttaque6",
        CrossedArms: "AnimAttaque7",
        GoRight: "AnimAttaque8",
        GoLeft: "AnimAttaque9",
        HeadAttack: "AnimAttaque10",
        JumpAndFlash: "AnimHit",
        JumpAndSmoke: "AnimMort"
    }, Ne = {
        IDLE_ANIMS: ["LookOnFloor", "LookAround", "LookAround", "AirPunchs", "CrossedArms", "GoRight", "GoLeft", "HandWave", "Jump"],
        ENTERED_MAP_ANIMS: ["LetsGo", "LetsGo", "LetsGo", "LetsGo", "AirPunchs", "AirPunchs", "CrossedArms", "LookAround"]
    }, Re = {
        NOT_CREATED: 0,
        CREATED: 1,
        WAITING_PLAYER: 2,
        WAITING_PLAYER_POSE: 3,
        FIRST_MOVEMENT: 4,
        IDLE: 5,
        IDLE_POSE: 6,
        IDLE_MOVE: 7,
        MOVING_TO_EXIT: 8,
        WAITING_FOR_PLAYER_EXIT: 9,
        MOVING_CANCEL: 10,
        MAP_TRANSITION_EXIT: 11,
        MAP_TRANSITION_ENTER: 12
    }, Oe = 8, Pe = 3e3, De = 4e3, Le = .75, Be = 1e3, ke = new Ce;
    t.initialize = h,
    t.stopMoving = Q,
    t.freeze = ee,
    t.unfreeze = te,
    t.getActor = c,
    t.setAnimation = se,
    t.removeAndClean = m,
    t.on = ke.on.bind(ke),
    t.once = ke.once.bind(ke),
    t.removeListener = ke.removeListener.bind(ke)
}
, function(e, t, i) {
    i(611),
    i(613),
    i(615),
    i(616),
    i(617),
    i(618),
    i(620),
    i(621),
    e.exports = i(612)
}
, function(e, t, i) {
    var n = i(612)
      , o = i(6)
      , s = o.ANIM_SYMBOLS;
    n.prototype.getAnimSymbol = function(e, t) {
        return t || 0 === t || (t = this.direction),
        {
            id: e + "_" + s[t],
            base: e,
            direction: t
        }
    }
    ,
    n.prototype.finalizeAnimationSymbol = function(e) {
        e.direction || 0 === e.direction || (e.direction = this.direction)
    }
    ,
    n.prototype.loadAndPlayAnimation = function(e, t, i) {
        function n() {
            t ? o.loopAnim(e, i) : o.oneShootAnim(e, !1, i)
        }
        var o = this;
        this.finalizeAnimationSymbol(e),
        this.animManager.addAnimation(e, n)
    }
    ,
    n.prototype.staticAnim = function() {
        this.animSymbol = this.getAnimSymbol("AnimStatique"),
        this.animManager.assignSymbol(this.animSymbol, !1),
        this.animated = !1
    }
    ,
    n.prototype.loopAnim = function(e, t) {
        this.animSymbol = e,
        this.animated = !0,
        this.animManager.assignSymbol(e, !0, t)
    }
    ,
    n.prototype.oneShootAnim = function(e, t, i) {
        var n = this;
        this.finalizeAnimationSymbol(e),
        this.animSymbol = e,
        this.animated = !0,
        this.animManager.assignSymbol(e, !1, function() {
            return t && n.staticAnim(),
            n.animated = !1,
            i && i()
        })
    }
    ,
    n.prototype.cleanupAnimations = function() {
        this.animManager.cleanupAnimations()
    }
    ,
    n.prototype.death = function(e) {
        var t = this;
        this.moving && (console.warn("kill a moving actor"),
        this.pathTween.stop()),
        this.animated && console.warn("kill an animated actor");
        var i = this.getAnimSymbol("AnimMort");
        this.animSymbol = i,
        this.animated = !0,
        t.actorManager.userActor === this && this.animManager.cleanupAnimationsAndRemoveSubentities(),
        this.isDead = !0,
        this.animManager.assignSymbol(i, !1, function() {
            return t.animated = !1,
            t.fighterIndicator && t.fighterIndicator.remove(),
            t.removeTeamCircle(),
            t.actorManager.removeActor(t.actorId),
            e && e()
        })
    }
}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        e.data = e.data || {},
        r.call(this, e),
        this.actorId = void 0 !== e.actorId ? e.actorId : null ,
        this.cellId = null ,
        this._step = 0,
        this.path = [],
        this.moving = !1,
        this.animated = !1,
        this.speedAdjust = 0,
        this.tints = null ,
        this.data = {},
        this.groupBoss = null ,
        this.isInvisible = !1,
        this.followers = null ,
        this.isFollower = !1,
        this.isLocked = !1,
        this.isRiding = !1,
        this.isDead = !1,
        this.canMoveDiagonally = !0,
        this.isolationCoefficient = 0,
        this.pathTween = new s(this,["step"]),
        this.riderEntity = null ,
        this.carriedActor = null ,
        this.carriedEntity = null ,
        this.parentActor = null ,
        this.circleGraphic = null ,
        this.icons = {},
        this.realLook = null ,
        this.actorManager = e.actorManager,
        this.fighterIndicator = null ,
        this._turnNumber = null ,
        this.updateData(e.data)
    }
    var o = i(26).inherits
      , s = i(261).Tween
      , a = i(280)
      , r = i(242)
      , l = i(85)
      , c = i(266).HOOK_POINT_CATEGORY_MOUNT_DRIVER;
    o(n, r),
    e.exports = n,
    Object.defineProperty(n.prototype, "step", {
        get: function() {
            return this._step
        },
        set: function(e) {
            this._step = e,
            this.forceRefresh()
        }
    }),
    n.prototype.setLook = function(e, t, i, n) {
        this.realLook = e;
        var o = e.subentities;
        if (this.isRiding = !1,
        o)
            for (var s = 0; s < o.length; s += 1) {
                var a = o[s];
                if (a.bindingPointCategory === c) {
                    this.isRiding = !0;
                    break
                }
            }
        return this.actorManager.isCreatureModeOn && !n ? this.setCreatureLook(t, i) : void r.prototype.setLook.call(this, e, t, i)
    }
    ,
    n.prototype.applyLook = function(e) {
        return this.actorManager.isCreatureModeOn ? void (this.realLook = e.look) : (e.animationManager && e.animationManager !== this.animationManager && (this.animManager.clear(),
        this.setAnimManager(e.animationManager)),
        this.staticAnim(),
        void (this.look = e.look))
    }
    ,
    n.prototype.useRealLook = function() {
        this.actorManager.setActorLook(this.actorId, this.realLook, null , !0)
    }
    ,
    n.prototype.updateData = function(e) {
        var t = window.isoEngine
          , i = e.disposition;
        if (i) {
            var n = !0;
            window.actorManager.paused && window.actorManager.userActor !== this && (this.position = i.cellId,
            this.cellId = i.cellId,
            n = !1),
            this.moving && window.actorManager.userActor === this && t.gameContext === l.ROLE_PLAY && (n = !t.isMovementWaitingForConfirmation),
            n && this.setDisposition(i.cellId, i.direction)
        }
        switch (void 0 !== e.alive && (this.isDead = !e.alive),
        e.npcId && (this.data.npcId = e.npcId,
        this.data.npcData = e._npcData),
        e.name && (this.data.name = e.name),
        e.contextualId && (this.data.actorId = e.contextualId),
        e._type) {
        case "GameRolePlayCharacterInformations":
            this.data.accountId = e.accountId,
            this.data.playerId = e.contextualId,
            this.data.humanoidInfo = e.humanoidInfo,
            this.data.alignmentInfos = e.alignmentInfos,
            this.speedAdjust = 5,
            this.processHumanoidOptions();
            break;
        case "GameRolePlayMutantInformations":
            this.data.accountId = e.accountId,
            this.data.playerId = e.contextualId,
            this.data.humanoidInfo = e.humanoidInfo,
            this.data.monsterId = e.monsterId,
            this.data.powerLevel = e.powerLevel,
            this.processHumanoidOptions();
            break;
        case "GameFightMonsterInformations":
        case "GameFightMonsterWithAlignmentInformations":
            this.data.isBoss = e._isBoss;
        case "GameRolePlayGroupMonsterInformations":
            this.data.ageBonus = e.ageBonus,
            this.data.contextualId = e.contextualId,
            this.data.alignmentSide = e.alignmentSide,
            this.data.hasHardcoreDrop = e.hasHardcoreDrop,
            this.data.keyRingBonus = e.keyRingBonus,
            this.data.lootShare = e.lootShare,
            this.data.staticInfos = e.staticInfos,
            this.data.isSummon = e.stats && e.stats.summoned,
            this.data.creatureGenericId = e.creatureGenericId;
            break;
        case "GameRolePlayPrismInformations":
            this.data.prism = e.prism,
            this.data.contextualId = e.contextualId;
            break;
        case "GameRolePlayTaxCollectorInformations":
            this.data.contextualId = e.contextualId,
            this.data.taxCollectorAttack = e.taxCollectorAttack;
            var o = e.identification.guildIdentity;
            this.data.guild = {
                guildLevel: e.guildLevel,
                guildEmblem: o.guildEmblem,
                guildId: o.guildId,
                guildName: o.guildName
            },
            this.data.taxCollector = {
                lastNameId: e.identification.lastNameId,
                firstNameId: e.identification.firstNameId
            };
            break;
        case "FightTeamInformations":
        case "FightAllianceTeamInformations":
        case "FightTeamLightInformations":
            this.data.fightId = e.fightId,
            this.data.teamId = e.teamId,
            this.data.leaderId = e.leaderId,
            this.data.teamSide = e.teamSide,
            this.data.teamTypeId = e.teamTypeId,
            this.data.teamMembers = e.teamMembers;
            break;
        case "GameFightCharacterInformations":
            this.data.playerId = e.contextualId;
            break;
        case "PaddockObject":
            this.data.durability = e.durability;
            break;
        case "GameRolePlayMountInformations":
            this.data.level = e.level,
            this.data.ownerName = e.ownerName
        }
        this.data.type = e._type
    }
    ,
    n.prototype.updateRestrictions = function(e) {
        if (this.data.humanoidInfo && (this.data.humanoidInfo.restrictions = e),
        this.canMoveDiagonally = !e.cantWalk8Directions,
        this.canMoveDiagonally === !1 && 0 === (1 & this.direction)) {
            var t = this.direction + 1;
            t > 7 && (t = 1),
            this.setDisposition(this.position, t)
        }
    }
    ,
    n.prototype.processHumanoidOptions = function() {
        if (this.data.humanoidInfo && this.data.humanoidInfo.options)
            for (var e = this.data.humanoidInfo.options, t = 0; t < e.length; t++) {
                var i = e[t];
                "HumanOptionAlliance" === i._type ? this.addConquestIcon(i) : "HumanOptionFollowers" === i._type && this.actorManager.addActorFollowers(this, i.followingCharactersLook, !0)
            }
    }
    ,
    n.prototype.remove = function() {
        this.removeIcons(),
        (this.pathTween.playing || this.pathTween.starting) && this.pathTween.stop(),
        this.actorManager._removeActor(this),
        r.prototype.remove.call(this)
    }
    ,
    n.prototype.getFighter = function() {
        return window.gui.fightManager.getFighter(this.actorId)
    }
    ,
    n.prototype.getFighterData = function() {
        var e = this.getFighter();
        return e ? e.data : (console.warn("Fighter " + this.actorId + " could not be found."),
        new a)
    }
}
, function(e, t, i) {
    function n(e, t, i, n, o, s) {
        this.c = e,
        this.x = t,
        this.y = i,
        this.d = n,
        this.a = o,
        this.m = s
    }
    var o = i(612)
      , s = i(6)
      , a = i(614)
      , r = i(85)
      , l = s.TIME_UNITS_PER_SECOND
      , c = {
        mounted: {
            linear: 135,
            horizontal: 200,
            vertical: 120,
            symbolId: "AnimCourse"
        },
        parable: {
            linear: 400,
            horizontal: 500,
            vertical: 450,
            symbolId: "FX"
        },
        running: {
            linear: 170,
            horizontal: 255,
            vertical: 150,
            symbolId: "AnimCourse"
        },
        walking: {
            linear: 480,
            horizontal: 510,
            vertical: 425,
            symbolId: "AnimMarche"
        },
        slide: {
            linear: 57,
            horizontal: 85,
            vertical: 50,
            symbolId: "AnimStatique"
        }
    };
    o.prototype.setCellPosition = function(e) {
        this.actorManager.removeActorOccupation(this),
        this.cellId = e,
        this.actorManager.addActorOccupation(this),
        this.carriedActor && this.carriedActor.setCellPosition(e)
    }
    ,
    o.prototype.setOnScreenPosition = function(e) {
        var t = this.actorManager.isoEngine
          , i = t.gameContext === r.FIGHT
          , n = t.mapRenderer.map
          , o = a.cellCoord[e]
          , s = 0;
        n && (i ? this._positionCircle() : s = n.cells[e].f || 0),
        this.position = e,
        this.x = o.x,
        this.y = o.y - s,
        this._positionIcons()
    }
    ,
    o.prototype.setDisposition = function(e, t) {
        this.moving && (this.pathTween.removeOnFinish(),
        this.pathTween.stop(),
        this.isLocked && (this.isLocked = !1)),
        !e && 0 !== e || e === -1 || (this.setOnScreenPosition(e),
        this.setCellPosition(e)),
        (t || 0 === t) && (this.direction = t),
        this.animated || this.staticAnim(),
        this.step = 0,
        this.path = [],
        this.moving = !1
    }
    ,
    o.prototype.noMovement = function() {
        this.moving && (this.pathTween.removeOnFinish(),
        this.pathTween.stop(),
        this.moving = !1,
        this.isLocked && (this.isLocked = !1),
        this.step = 0,
        this.path = [])
    }
    ,
    o.prototype.cancelMovement = function(e) {
        var t = this;
        this.pathTween.removeOnFinish(),
        this.pathTween.stop();
        var i = ~~this.step
          , n = i + 1
          , o = this.path[i].m * (1 - this.step + i)
          , s = this.path[n].c;
        this.pathTween.reset().from({
            step: this.step
        }).to({
            step: n
        }, o),
        this.pathTween.start(!1),
        this.pathTween.onceFinish(function() {
            t.moving = !1,
            t.step = 0,
            t.path = [],
            t.setCellPosition(s),
            t.actorId === window.gui.playerData.id && window.dofus.sendMessage("GameMapMovementCancelMessage", {
                cellId: s
            }),
            e && e(),
            t.moving || t.setDisposition(s)
        })
    }
    ,
    o.prototype.switchPath = function(e, t) {
        var i = this;
        this.pathTween.removeOnFinish(),
        this.pathTween.stop();
        var n = ~~this.step
          , o = n + 1
          , s = this.path[n].m * (1 - (this.step - n));
        this.pathTween.reset().from({
            step: this.step
        }).to({
            step: o
        }, s),
        this.pathTween.start(!1),
        this.pathTween.onceFinish(function() {
            return i.moving = !1,
            i.step = 0,
            i.path = [],
            1 === e.length ? (i.setDisposition(e[0]),
            t()) : (i.setPath(e, {
                cb: t
            }),
            void i.setCellPosition(e[e.length - 1]))
        })
    }
    ,
    o.prototype.isPathMatchingServerPath = function(e, t) {
        var i = e[e.length - 1]
          , n = this.path;
        if (n[n.length - 1].c === i)
            return !0;
        var o;
        for (o = n.length - 2; o >= 0 && n[o].c !== i; o--)
            ;
        var s = ~~this.step;
        if (s >= o)
            return !1;
        for (var a = n[s + 1].c, r = e.length - 1; r >= 0 && (t.unshift(e[r]),
        e[r] !== a); r--)
            ;
        return !1
    }
    ,
    o.prototype.refreshAnimation = function(e) {
        if (this.moving === !0) {
            var t = ~~this._step
              , i = this._step - t
              , n = this.path[t];
            if (n) {
                var o = this.path[t + 1] || this.path[t];
                this._x = n.x + (o.x - n.x) * i,
                this._y = n.y + (o.y - n.y) * i,
                i > .5 && this._position !== o.c && (this.position = o.c),
                this.animSymbol.id === n.a.id && this.direction === n.d || (this.animSymbol = n.a,
                this.direction = n.d,
                this.animManager.assignSymbol(this.animSymbol, !0))
            }
        }
        this._refreshAnimation(e),
        this._positionIcons(),
        this._positionCircle()
    }
    ,
    o.prototype._startPath = function(e) {
        var t = this
          , i = this.path
          , n = i[0].m;
        this.step = 0,
        this.pathTween.reset().from({
            step: 0
        }).to({
            step: 1
        }, n);
        for (var o = 1, s = this.path.length - 1; o < s; o++)
            n = i[o].m,
            this.pathTween.to({
                step: o + 1
            }, n);
        this.animManager.isTemporary || (this.animSymbol = i[0].a,
        this.animManager.assignSymbol(this.animSymbol, !0)),
        this.moving ? console.warn('[Actor._startPath] error: actor "' + this.actorId + '" is already moving.') : (this.pathTween.start(!1),
        this.pathTween.onceFinish(function() {
            t.moving = !1;
            var i = t.path[t.path.length - 1];
            return t.animSymbol = i.a,
            t._x = i.x,
            t._y = i.y,
            t.animManager.assignSymbol(t.animSymbol, !1),
            e && e()
        })),
        this.moving = !0
    }
    ,
    o.prototype.walkToSceneCoordinate = function(e, t, i, o, s) {
        var a = this.getAnimSymbol("AnimMarche", i)
          , r = this.getAnimSymbol("AnimStatique", i);
        this.path = [new n(this.cellId,this._x,this._y,i,a,o), new n(this.cellId,e,t,i,r,0)],
        this._startPath(s)
    }
    ,
    o.prototype.setPath = function(e, t) {
        var i = t && t.cb
          , o = this.actorManager.isoEngine;
        if (!o.mapRenderer.isReady)
            return console.warn("setPath: renderer was not ready"),
            i();
        if (e.length <= 1)
            return i && i();
        var s = t && t.slide
          , u = t && t.forceWalk;
        this.path = [],
        this.step = 0;
        var h, d, p, m, f = o.gameContext === r.FIGHT, g = o.mapRenderer.map.cells;
        m = s ? c.slide : this.isRiding ? c.mounted : e.length > 3 && !u ? c.running : c.walking;
        for (var _, v = (1 + this.speedAdjust / 10 || .001) * l, y = 0; y < e.length; y++) {
            var w, b = e[y], C = f ? 0 : g[b].f || 0, I = a.cellCoord[b];
            0 === y ? _ = 1 : I.y === p ? (w = m.horizontal,
            _ = I.x > d ? 0 : 4) : I.x === d ? (w = m.vertical,
            _ = I.y > p ? 2 : 6) : (w = m.linear,
            _ = I.x > d ? I.y > p ? 1 : 7 : I.y > p ? 3 : 5),
            w /= v,
            s && (_ = this.direction);
            var T = this.getAnimSymbol(m.symbolId, _);
            y > 0 && (h.d = _,
            h.a = T,
            h.m = w),
            this.path.push(new n(b,I.x,I.y - C,_,T,w)),
            h = this.path[this.path.length - 1],
            d = I.x,
            p = I.y
        }
        var S, A, E = this.animManager, x = E.isTemporary ? {} : E.template.exposedSymbols, M = this.getAnimSymbol("AnimStatique", _), N = this.getAnimSymbol("AnimStatique_to_" + this.path[0].a.base, this.path[0].a.direction), R = this.getAnimSymbol(m.symbolId + "_to_" + M.base, _);
        x[N.id] && (S = this.path[0],
        A = E.getSymbolDuration(N.id),
        this.path.unshift(new n(S.c,S.x,S.y,S.d,N,A))),
        x[R.id] && (S = this.path[this.path.length - 1],
        A = E.getSymbolDuration(R.id),
        S.a = R,
        S.m = A,
        this.path.push(new n(S.c,S.x,S.y,S.d,M,S.m))),
        this.path[this.path.length - 1].a = M,
        this._startPath(i)
    }
}
, function(e, t, i) {
    function n(e) {
        var t = e % 14
          , i = Math.floor(e / 14);
        return t += i % 2 * .5,
        {
            x: t * a,
            y: .5 * i * r
        }
    }
    function o() {
        for (var e = 0; e < 560; e += 1)
            l.push(n(e));
        return Object.freeze(l),
        l
    }
    var s = i(6)
      , a = s.CELL_WIDTH
      , r = s.CELL_HEIGHT;
    e.exports.getCellCoord = n;
    var l = [];
    e.exports.cellCoord = o()
}
, function(e, t, i) {
    var n = i(612)
      , o = i(35).getText
      , s = i(413).npcActionRequest
      , a = i(607)
      , r = i(22);
    n.prototype.tap = function(e, t) {
        var i = this.actorId
          , n = this.data
          , l = this.scene.convertSceneToCanvasCoordinate(e, t)
          , c = {
            x: l.x,
            y: l.y,
            isCanvasCoordinate: !0
        };
        switch (n.type) {
        case "GameRolePlayGroupMonsterInformations":
            window.gui.openContextualMenu("monster", n, c);
            break;
        case "GameRolePlayPrismInformations":
            window.gui.openContextualMenu("prism", n, c);
            break;
        case "GameRolePlayTaxCollectorInformations":
            n.mapId = window.isoEngine.mapRenderer.map.id,
            window.gui.openContextualMenu("taxCollector", n, c);
            break;
        case "GameRolePlayNpcInformations":
        case "GameRolePlayNpcWithQuestInformations":
            var u = window.isoEngine
              , h = u.mapRenderer.map.id
              , d = n.npcId;
            if (!d)
                return;
            var p = n.npcData;
            if (!p)
                return console.debug("NPC missing in database:", d);
            if (1 === p.actions.length && window.gui.playerData.isAlive())
                return u.highlightActorOnAction(i),
                s(p, i, h, p.actions[0]);
            window.gui.openContextualMenu("npc", {
                actorId: i,
                npcId: d,
                npcData: p,
                mapId: h
            }, c);
            break;
        case "GameRolePlayCharacterInformations":
        case "GameRolePlayMutantInformations":
            var m;
            this !== this.actorManager.userActor && (m = window.isoEngine.mapRenderer.interactiveElements),
            window.gui.openContextualMenu("player", {
                accountId: n.accountId,
                playerId: n.playerId,
                playerName: n.name,
                cellId: this.cellId,
                isMutant: "GameRolePlayMutantInformations" === n.type,
                humanoidInfoOptions: n.humanoidInfo && n.humanoidInfo.options,
                alignmentInfos: n.alignmentInfos,
                interactiveElements: m
            }, c);
            break;
        case "GameRolePlayMerchantInformations":
            var f = [];
            f.push({
                caption: o("ui.common.buy"),
                target: "dofus",
                action: "sendMessage",
                params: ["ExchangeOnHumanVendorRequestMessage", {
                    humanVendorId: i,
                    humanVendorCell: this.cellId
                }]
            }),
            window.gui.openContextualMenu("generic", {
                title: n.name,
                actions: f
            }, c);
            break;
        case "FightTeamInformations":
        case "FightAllianceTeamInformations":
        case "FightTeamLightInformations":
            window.gui.openContextualMenu("fightTeam", n, c);
            break;
        case "GameFightCharacterInformations":
            window.gui.openContextualMenu("player", {
                playerId: n.playerId,
                playerName: n.name,
                isMutant: !1
            }, c);
            break;
        case "GameRolePlayMountInformations":
            var g = [{
                caption: o("ui.mount.viewMountDetails"),
                cb: function() {
                    r.getWindow("mount").showPaddockMount(i)
                }
            }];
            window.gui.openContextualMenu("generic", {
                title: (n.name || o("ui.common.noName")) + "\n" + o("ui.mount.mountOf", n.ownerName) + "\n" + o("ui.common.rank", n.level),
                actions: g
            }, c);
            break;
        case "GameFightMutantInformations":
        case "GameFightMonsterInformations":
        case "GameFightMonsterWithAlignmentInformations":
        case "GameFightTaxCollectorInformations":
            return;
        case "PaddockObject":
            window.gui.openContextualMenu("paddockObject", {
                cellId: this.cellId,
                paddockObjectName: this.data.name
            }, c);
            break;
        case "BeginnerAssistant":
            a.openDialog();
            break;
        default:
            return
        }
    }
}
, function(e, t, i) {
    var n = i(612)
      , o = i(261).Tween
      , s = {
        red: 0,
        green: 0,
        blue: 0,
        alpha: 0
    }
      , a = {
        red: 1,
        green: 1,
        blue: 1,
        alpha: .6
    };
    n.prototype.setInvisibility = function(e, t) {
        if (this.showTeamCircle(1 !== e),
        3 === e)
            this.removeHighlight(),
            this.isInvisible = !1,
            this.actorManager.addActorOccupation(this);
        else {
            var i = this.actorManager.userActor.getFighterData().teamId;
            t === i ? this.setHighlight(a) : (this.setHighlight(s),
            this.isInvisible = !0,
            this.actorManager.removeActorOccupation(this),
            this.actorManager.turnIndicatorOff())
        }
    }
    ,
    n.prototype.invisibleDetectedAnimation = function() {
        var e = {
            red: 0,
            green: 0,
            blue: 0,
            alpha: 1
        };
        this.setHighlight(e),
        o(this.highlight, ["alpha"]).from({
            alpha: 1
        }).to({
            alpha: 0
        }, 30).start(!1)
    }
}
, function(e, t, i) {
    var n = i(612)
      , o = i(242)
      , s = i(263)
      , a = i(266)
      , r = a.HOOK_POINT_CATEGORY_MOUNT_DRIVER
      , l = a.HOOK_POINT_CATEGORY_LIFTED_ENTITY;
    n.prototype.addSubentity = function(e, t, i) {
        var n = this;
        o.prototype.addSubentity.call(this, e, t, function(t) {
            return e.bindingPointCategory === r && (n.riderEntity = t),
            i && i(t)
        })
    }
    ,
    n.prototype.carryCharacter = function(e) {
        var t = this;
        if (this.animManager.isTemporary)
            return console.warn("Actor animManager is not ready."),
            void window.setTimeout(function() {
                t.carryCharacter(e)
            }, 2e3);
        var i = this.riderEntity || this.animManager;
        i.addAnimation({
            base: "carrying",
            direction: -1
        }, function() {
            i.addAnimationModifier("AnimStatique", "AnimStatiqueCarrying"),
            i.addAnimationModifier("AnimMarche", "AnimMarcheCarrying"),
            i.addAnimationModifier("AnimCourse", "AnimCourseCarrying"),
            i.addAnimationModifier("AnimHit", "AnimHitCarrying"),
            i.addAnimationModifier("AnimTacle", "AnimTacleCarrying");
            var n = {
                animManager: e.animManager,
                bindingPoint: "carried_3_0",
                symbolModifier: s[l],
                bindingPointCategory: l
            };
            e.parentActor = t,
            t.carriedEntity = n,
            t.carriedActor = e,
            i.addSubentity(n),
            e.setDisposition(t.cellId),
            e.getFighterData().isCarryied = !0,
            e.y = -1e3,
            t.staticAnim()
        })
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        return e === t ? "ally" : e === i ? "defender" : "attacker"
    }
    var o = i(612)
      , s = i(6)
      , a = i(248)
      , r = i(619)
      , l = i(253)
      , c = i(249)
      , u = i(336)
      , h = i(261).Delay
      , d = i(346)
      , p = i(335)
      , m = {
        QUEST: 1,
        DEFAULT: 2,
        AVA: 3,
        SMILEY: 4,
        UI: 5
    }
      , f = {
        miniBoss: "archmonsters",
        hardcoreDrop: "treasure",
        defender: "defender",
        attacker: "forward",
        ally: "ownTeam",
        disqualified: "neutral",
        prequalified: "clock"
    }
      , g = 5
      , _ = 5
      , v = 72
      , y = new h;
    o.prototype._getIcon = function(e, t) {
        return this.icons.hasOwnProperty(t) ? this.icons[t][e] : null
    }
    ,
    o.prototype._setIcon = function(e, t, i) {
        this.icons.hasOwnProperty(i) || (this.icons[i] = {}),
        this.icons[i][t] = e
    }
    ,
    o.prototype.addConquestIcon = function(e) {
        var t, i = window.gui.playerData, o = i.characters.mainCharacter.characteristics.alignmentInfos.aggressable, s = o !== p.NON_AGGRESSABLE, a = e.aggressable !== p.NON_AGGRESSABLE, r = e.aggressable === p.PvP_ENABLED_AGGRESSABLE || e.aggressable === p.PvP_ENABLED_NON_AGGRESSABLE;
        if (s && i.alliance.hasAlliance() && a && !r) {
            var l = u.entities.prism[i.position.subAreaId];
            if (l && l.prism && l.prism.state === d.PRISM_STATE_VULNERABLE) {
                var c = e.allianceInformations.allianceId
                  , h = i.alliance.current.allianceId
                  , f = l.prism.alliance.allianceId
                  , g = this.actorId === i.id;
                switch (e.aggressable) {
                case p.AvA_DISQUALIFIED:
                    g && (t = "disqualified");
                    break;
                case p.AvA_PREQUALIFIED_AGGRESSABLE:
                    t = g ? "prequalified" : n(c, h, f);
                    break;
                case p.AvA_ENABLED_AGGRESSABLE:
                    t = g ? "ally" : n(c, h, f)
                }
            }
        }
        this._getIcon(t, m.AVA) || (this.removeIconCategory(m.AVA),
        t && this.addIcon(t, m.AVA))
    }
    ,
    o.prototype.addSmileyIcon = function(e) {
        var t = this
          , i = window.gui.databases.Smileys[e];
        if (!i)
            return console.error("Smiley " + e + " details are not available, it could not be displayed");
        var n = m.SMILEY;
        this.removeIconCategory(n),
        this.addIcon(i.gfxId, n),
        (y.playing || y.starting) && y.stop(),
        y.reset(v, function() {
            t.removeIconCategory(n)
        }),
        y.start()
    }
    ,
    o.prototype.addReadyIconOnActor = function() {
        this.addIcon("Social_tx_fightState", m.UI)
    }
    ,
    o.prototype.removeReadyIconOnActor = function() {
        this.removeIconCategory(m.UI)
    }
    ,
    o.prototype.addQuestIcon = function(e) {
        var t = this
          , i = "questObjectiveClip";
        if (e.questsToStartId.length && (i = "questClip"),
        !this._getIcon(i, m.QUEST)) {
            this.removeQuestIcon(),
            this.questType = i;
            var n = new a({
                layer: s.MAP_LAYER_ICONS,
                x: t.x,
                y: t.y,
                offsetY: 0,
                scene: t.scene
            });
            c.loadAnimationManager(n, "embedded", "quest", function(e) {
                e.assignSymbol({
                    base: i,
                    direction: -1
                }, !0),
                t._setIcon(n, i, m.QUEST),
                t._positionIcons()
            })
        }
    }
    ,
    o.prototype.addIcon = function(e, t) {
        function i(e) {
            return u._cleared ? void e.release() : (u.w = e.element.width,
            u.h = e.element.height,
            u.texture = e,
            a._positionIcons(),
            void u.forceRefresh())
        }
        t = t || m.DEFAULT;
        var n = this._getIcon(e, t);
        if (!n) {
            var o;
            switch (t) {
            case m.SMILEY:
                o = "gfx/smilies/";
                break;
            case m.UI:
                o = "ui/";
                break;
            default:
                e = f[e],
                o = "gfx/icons/conquestIcon/"
            }
            if (!e)
                return console.warn("Icon type '" + e + "' is unknown and could not be displayed.");
            var a = this
              , c = o + e + ".png"
              , u = new r({
                layer: s.MAP_LAYER_ICONS,
                x: this.x,
                y: this.y,
                w: 0,
                h: 0,
                scene: this.scene
            });
            this._setIcon(u, e, t),
            l.loadTexture(c, i, this.scene.renderer)
        }
    }
    ,
    o.prototype._positionIcons = function() {
        var e = 0;
        for (var t in m) {
            var i, n = m[t], o = 0, s = 0;
            for (i in this.icons[n]) {
                var a = this.icons[n][i].w;
                o += a ? a : 0,
                s++
            }
            if (0 !== s) {
                o += g * (s - 1);
                var r = ~~(.5 * -o)
                  , l = 0;
                for (i in this.icons[n]) {
                    var c = this.icons[n][i]
                      , u = c.h ? c.h : 0;
                    l = Math.max(l, c.h ? c.h : 50);
                    var h = this.bbox ? this.bbox[2] - this.y - u - 10 : -100;
                    h -= e,
                    this.y + h < 0 && (h = this.bbox ? this.bbox[3] - this.y + 10 : 100,
                    h += e),
                    c.x = this.x + r,
                    c.y = this.y + h,
                    c.position = this.position,
                    r += c.w + g
                }
                e += l + _
            }
        }
        1 === window.gui.fightManager.fightState && this.updateTurnIndicatorPosition(),
        this.fighterIndicator && (this.fighterIndicator.x = this.x,
        this.fighterIndicator.y = this.bbox[2] - 10),
        this._turnNumber && this._turnNumber.updatePosition(this.x, this.y)
    }
    ,
    o.prototype.removeQuestIcon = function() {
        this.removeIconCategory(m.QUEST)
    }
    ,
    o.prototype.removeIcon = function(e, t) {
        var i = this._getIcon(e, t);
        i && (i.remove(),
        delete this.icons[t][e])
    }
    ,
    o.prototype.removeIconCategory = function(e) {
        for (var t in this.icons[e])
            this.removeIcon(t, e)
    }
    ,
    o.prototype.removeIcons = function() {
        for (var e in m) {
            var t = m[e];
            this.removeIconCategory(t)
        }
    }
}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, e),
        this.w = e.w || 0,
        this.h = e.h || 0,
        this.texture = t
    }
    var o = i(26).inherits
      , s = i(244);
    o(n, s),
    e.exports = n,
    n.prototype.render = function() {
        this.renderer.save(),
        this.renderer.multiplyColor(this.tint[0], this.tint[1], this.tint[2], this.tint[3]),
        this.renderer.drawImage(this.texture, this._x, this._y, this.w * this._scaleX, this.h),
        this.renderer.restore()
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        return [0, this.w, 0, this.h]
    }
    ,
    n.prototype.clear = function() {
        this.texture && this.texture.release()
    }
}
, function(e, t, i) {
    function n() {
        if (h)
            return h;
        h = {};
        var e = /^\{[\d]*\|([\d]*)/i
          , t = window.gui.databases.Breeds;
        for (var i in t) {
            var n = t[i]
              , o = e.exec(n.maleLook)[1]
              , s = e.exec(n.femaleLook)[1];
            h[o] = n.creatureBonesId,
            h[s] = n.creatureBonesId
        }
        return h[453] = t[12].creatureBonesId,
        h
    }
    function o(e) {
        return {
            base: e.base,
            type: 0,
            param: null ,
            direction: e.direction
        }
    }
    function s(e) {
        return {
            base: "AnimAttaque",
            type: 0,
            param: null ,
            direction: e.direction
        }
    }
    var a = i(612)
      , r = i(85)
      , l = i(242)
      , c = {
        1: !0,
        113: !0,
        44: !0,
        1575: !0,
        1576: !0
    }
      , u = [1097, 1111, 1112, 3451]
      , h = null ;
    a.prototype.getCreatureBones = function() {
        switch (this.data.type) {
        case "FightTeamInformations":
        case "FightAllianceTeamInformations":
        case "FightTeamLightInformations":
        case "GameRolePlayNpcInformations":
        case "GameRolePlayNpcWithQuestInformations":
            return null ;
        case "GameFightCharacterInformations":
        case "GameRolePlayCharacterInformations":
        case "GameRolePlayHumanoidInformations":
            var e = l.getLookWithoutMount(this.realLook)
              , t = e.bonesId;
            if (!c[t])
                return 1749;
            var i = e.skins[0];
            return n()[i] || 666;
        case "GameRolePlayPrismInformations":
            return 2247;
        case "GameRolePlayMerchantInformations":
            return 1965;
        case "GameRolePlayTaxCollectorInformations":
        case "GameFightTaxCollectorInformations":
            return 1813;
        case "GameRolePlayGroupMonsterInformations":
        case "GameFightMonsterInformations":
        case "GameFightMonsterWithAlignmentInformations":
            return this.data.isBoss ? 1748 : u.indexOf(this.data.creatureGenericId) >= 0 ? 2247 : this.data.isSummon ? 1765 : 1747;
        case "GameRolePlayMountInformations":
            return 1749;
        case "GameFightMutantInformations":
        case "GameRolePlayMutantInformations":
            return 1747;
        default:
            return 666
        }
    }
    ,
    a.prototype.setCreatureLook = function(e, t) {
        var i = window.isoEngine.gameContext === r.FIGHT;
        if (!i && !this.data.humanoidInfo)
            return this.realLook ? this.actorManager.setActorLook(this.actorId, this.realLook, t, !0) : t && t();
        var n = this.getCreatureBones();
        if (n) {
            var a = {
                bonesId: n,
                skins: [],
                indexedColors: [],
                scales: [90],
                subentities: []
            }
              , c = this;
            l.prototype.setLook.call(this, a, e, function() {
                return c.animManager.addAnimationModifier("AnimArme", o),
                c.animManager.addAnimationModifier("AnimAttaque", o),
                c.animManager.addAnimationModifier("AnimTacle", "AnimHit"),
                c.animManager.addAnimationModifier("AnimEmote", s),
                c.animManager.addAnimationModifier("AnimConsulter", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimCueillir0", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimCueillirSol0", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimDrop", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimFaucher", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimHache", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimPeche", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimPickup", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimPioche", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimPuiser", "AnimAttaque0"),
                c.animManager.addAnimationModifier("AnimThrow", "AnimAttaque0"),
                c.staticAnim(),
                t && t()
            })
        }
    }
}
, function(e, t, i) {
    var n = i(612)
      , o = i(253)
      , s = i(6)
      , a = i(619)
      , r = i(622)
      , l = i(213)
      , c = i(623)
      , u = "ui/embedded/teamCircleRed.png"
      , h = "ui/embedded/teamCircleBlue.png";
    n.prototype.addTeamCircle = function() {
        function e(e) {
            n.circleGraphic ? (n.circleGraphic.w = e.element.width,
            n.circleGraphic.h = e.element.height,
            n.circleGraphic.texture = e,
            n._positionCircle(),
            n.circleGraphic.forceRefresh()) : e.release()
        }
        if (!this.circleGraphic) {
            var t = this.getFighter();
            if (t) {
                var i = t.data.teamId
                  , n = this;
                this.circleGraphic = new a({
                    layer: s.MAP_LAYER_BACKGROUND,
                    x: this.x,
                    y: this.y,
                    w: 0,
                    h: 0,
                    scene: this.scene
                });
                var r;
                0 === i ? r = u : 1 === i ? r = h : console.error("invalid team number"),
                o.loadTexture(r, e, this.scene.renderer)
            }
        }
    }
    ,
    n.prototype.removeTeamCircle = function() {
        this.circleGraphic && (this.circleGraphic.remove(),
        this.circleGraphic = null )
    }
    ,
    n.prototype._positionCircle = function() {
        this.circleGraphic && (this.circleGraphic.x = this.x - s.CELL_WIDTH / 2,
        this.circleGraphic.y = this.y - s.CELL_HEIGHT / 2,
        this.circleGraphic.position = this.position,
        this.circleGraphic.forceRefresh())
    }
    ,
    n.prototype.showTeamCircle = function(e) {
        this.circleGraphic && (e ? this.circleGraphic.show() : this.circleGraphic.hide())
    }
    ,
    n.prototype.updateTurnIndicatorPosition = function() {
        var e = window.gui.fightManager.getFighter(this.actorId);
        e && window.gui.fightManager.currentFighterId === e.id && (e.data.teamId === l.TEAM_CHALLENGER ? r.moveRedFeedback(this.x, this.y) : r.moveBlueFeedback(this.x, this.y))
    }
    ,
    n.prototype.addTurnNumber = function(e) {
        this.removeTurnNumber(),
        this._turnNumber = new c(this.x,this.y,e)
    }
    ,
    n.prototype.removeTurnNumber = function() {
        this._turnNumber && (this._turnNumber.remove(),
        this._turnNumber = null )
    }
}
, function(e, t, i) {
    function n(e, t) {
        e === g.TAP_MARKER && (t.layer = p.MAP_LAYER_TAP_FEEDBACK),
        d.call(this, t),
        this.setWhiteListedness(!0),
        this.infos = e
    }
    function o() {
        var e = 1.5
          , t = [1, 0, 0, 1]
          , i = [0, 0, 1, 1];
        for (var o in g) {
            var s = g[o];
            if (3 === s.id || 4 === s.id)
                var a = new n(s,{
                    scene: window.isoEngine.mapRenderer.mapScene,
                    layer: p.MAP_LAYER_BACKGROUND,
                    hue: 3 === s.id ? t : i,
                    sx: e,
                    sy: e
                });
            else
                a = new n(s,{
                    scene: window.isoEngine.mapRenderer.mapScene
                });
            _[s.id] = a,
            m.loadAnimationManager(a, "embedded", "tapFeedback")
        }
    }
    function s(e, t) {
        var i = _[e.id];
        return i ? void i.play(t) : console.warn("Tap feedback", e.id, "does not exist.")
    }
    function a(e) {
        var t = _[e.id];
        t && t.remove()
    }
    function r(e) {
        s(g.MOVEMENT_MARKER, e)
    }
    function l() {
        a(g.MOVEMENT_MARKER),
        a(g.TURN_MARKER_RED),
        a(g.TURN_MARKER_BLUE)
    }
    function c(e) {
        s(g.TAP_MARKER, e)
    }
    function u() {
        a(g.TAP_MARKER)
    }
    var h = i(26).inherits
      , d = i(248)
      , p = i(6)
      , m = i(249)
      , f = i(213)
      , g = {
        TAP_MARKER: {
            id: 1,
            animationName: "touch_anim_ok",
            isLoop: !1
        },
        MOVEMENT_MARKER: {
            id: 2,
            animationName: "marqueur_anim_ok",
            isLoop: !0
        },
        TURN_MARKER_RED: {
            id: 3,
            animationName: "marqueur_anim_ok",
            isLoop: !0
        },
        TURN_MARKER_BLUE: {
            id: 4,
            animationName: "marqueur_anim_ok",
            isLoop: !0
        }
    }
      , _ = {};
    h(n, d),
    n.prototype.play = function(e) {
        var t = this.infos
          , i = this
          , n = t.isLoop
          , o = n ? void 0 : function() {
            i.remove(!1)
        }
        ;
        this.animManager.assignSymbol({
            base: t.animationName,
            direction: -1
        }, n, o),
        (e.position || 0 === e.position) && (this.position = e.position),
        this.x = e.x,
        this.y = e.y,
        this.show()
    }
    ,
    t.initialize = function() {
        o()
    }
    ,
    t.addMovementFeedback = r,
    t.removeMovementFeedback = l,
    t.addTapFeedback = c,
    t.removeTapFeedback = u,
    t.addTurnFeedback = function(e, t) {
        var i = t === f.TEAM_CHALLENGER ? g.TURN_MARKER_RED : g.TURN_MARKER_BLUE;
        s(i, e)
    }
    ,
    t.moveRedFeedback = function(e, t) {
        var i = _[3];
        i.x = e,
        i.y = t
    }
    ,
    t.moveBlueFeedback = function(e, t) {
        var i = _[4];
        i.x = e,
        i.y = t
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        this._number = i,
        this._numberImage = new o(i),
        this._numberImage.x = e - l,
        this._numberImage.y = t - c
    }
    var o = i(624)
      , s = i(6)
      , a = s.CELL_WIDTH
      , r = s.CELL_HEIGHT
      , l = a / 2
      , c = r / 4;
    e.exports = n,
    n.prototype.updatePosition = function(e, t) {
        this._numberImage.x = e - l,
        this._numberImage.y = t - c
    }
    ,
    n.prototype.updateNumber = function(e) {
        e !== this._number && (this._numberImage = new o(e),
        this._number = e)
    }
    ,
    n.prototype.remove = function() {
        this._numberImage.clear(),
        this._numberImage = null
    }
}
, function(e, t, i) {
    function n(e) {
        var t = {
            id: l++,
            scene: window.isoEngine.mapScene,
            layer: a.MAP_LAYER_FOREGROUND,
            position: 0
        };
        this.canvas = document.createElement("canvas"),
        this.canvas.height = t.h = r + c + 2,
        this.canvasContext = this.canvas.getContext("2d"),
        this.canvasContext.font = r + "px " + u,
        this.canvas.width = t.w = Math.ceil(this.canvasContext.measureText(e.toString()).width) + c,
        this.canvasContext.font = r + "px " + u,
        this.canvasContext.shadowBlur = 2,
        this.canvasContext.shadowColor = "rgba(0, 0, 0, 1)",
        this.canvasContext.shadowOffsetX = 1,
        this.canvasContext.shadowOffsetY = 1,
        s.call(this, t),
        this.canvasContext.fillStyle = "rgb(255, 255, 255)",
        this.canvasContext.textAlign = "left",
        this.canvasContext.fillText(e, 1, r - c),
        this.texture && this.texture.release(),
        this.texture = window.isoEngine.mapScene.createTexture(this.canvas),
        this.show()
    }
    var o = i(26).inherits
      , s = i(619)
      , a = i(6)
      , r = 20
      , l = 0
      , c = 2
      , u = "Verdana";
    o(n, s),
    e.exports = n,
    n.prototype.clear = function() {
        this.texture ? (this.texture.release(),
        this.texture = null ) : console.warn("[CanvasText.clear] Clearing CanvasText, but it was already clear"),
        this.hide()
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.i = e,
        this.j = t,
        this.floor = -1,
        this.zone = -1,
        this.speed = 1,
        this.weight = 0,
        this.candidateRef = null
    }
    function o(e, t) {
        void 0 !== e && 1 & e.l ? (t.floor = e.f || 0,
        t.zone = e.z || 0,
        t.speed = 1 + (e.s || 0) / 10,
        t.zone !== T && (I = !1)) : (t.floor = -1,
        t.zone = -1)
    }
    function s(e, t, i, n, o) {
        this.i = e,
        this.j = t,
        this.w = i,
        this.d = n,
        this.path = o
    }
    function a(e, t) {
        return e.floor === t.floor || e.zone === t.zone && (I || 0 !== e.zone || Math.abs(e.floor - t.floor) <= g)
    }
    function r(e, t, i, n) {
        return a(e, t) && (a(e, i) || a(e, n))
    }
    function l(e, t, i, n, o, a) {
        var r = e.i
          , l = e.j
          , c = Math.sqrt((i - r) * (i - r) + (n - l) * (n - l));
        if (t = t / e.speed + e.weight,
        null === e.candidateRef) {
            var u = new s(r,l,a.w + t,c,a);
            o.push(u),
            e.candidateRef = u
        } else {
            var h = e.candidateRef.w
              , d = a.w + t;
            d < h && (e.candidateRef.w = d,
            e.candidateRef.path = a)
        }
    }
    function c(e, t, i, n, o) {
        var s = e.i
          , c = e.j
          , u = y[s][c]
          , h = y[s - 1][c]
          , d = y[s][c - 1]
          , p = y[s][c + 1]
          , m = y[s + 1][c]
          , f = 1;
        a(u, h) && l(h, f, t, i, n, e),
        a(u, m) && l(m, f, t, i, n, e),
        a(u, d) && l(d, f, t, i, n, e),
        a(u, p) && l(p, f, t, i, n, e);
        var g = y[s - 1][c - 1]
          , _ = y[s - 1][c + 1]
          , v = y[s + 1][c - 1]
          , w = y[s + 1][c + 1]
          , b = Math.sqrt(2);
        o && (r(u, g, h, d) && l(g, b, t, i, n, e),
        r(u, v, m, d) && l(v, b, t, i, n, e),
        r(u, _, h, p) && l(_, b, t, i, n, e),
        r(u, w, m, p) && l(w, b, t, i, n, e))
    }
    function u(e) {
        if (!Array.isArray(e) || e.length < 2)
            return !1;
        for (var t = p(e[0]), i = 1, n = e.length; i < n; i += 1) {
            var o = e[i]
              , s = p(o);
            if (Math.abs(t.x - s.x) > 1)
                return !1;
            if (Math.abs(t.y - s.y) > 1)
                return !1;
            t = s
        }
        return !0
    }
    function h(e) {
        if (!Array.isArray(e))
            return [];
        if (e.length < 2)
            return e;
        var t = [];
        t.push(e[0]);
        for (var i = p(e[0]), n = 1, o = e.length; n < o; n += 1) {
            var s, a, r = e[n], l = p(r);
            if (Math.abs(l.x - i.x) > 1)
                for (s = l.x > i.x ? 1 : -1,
                i.x += s; i.x !== l.x; )
                    t.push(m(i.x, i.y)),
                    i.x += s;
            if (Math.abs(l.y - i.y) > 1)
                for (a = l.y > i.y ? 1 : -1,
                i.y += a; i.y !== l.y; )
                    t.push(m(i.x, i.y)),
                    i.y += a;
            i = l,
            t.push(r)
        }
        return t
    }
    for (var d = i(626), p = d.getMapPointFromCellId, m = d.getCellIdFromMapPoint, f = 10, g = 11.825, _ = 35, v = 36, y = [], w = 0; w < _; w += 1) {
        for (var b = [], C = 0; C < v; C += 1)
            b[C] = new n(w,C);
        y[w] = b
    }
    var I, T;
    t.fillPathGrid = function(e) {
        T = e.cells[0].z || 0,
        I = !0;
        for (var t = 0; t < _; t += 1)
            for (var i = y[t], n = 0; n < v; n += 1) {
                var s = m(t - 1, n - 1)
                  , a = i[n]
                  , r = e.cells[s];
                o(r, a)
            }
    }
    ,
    t.updateCellPath = function(e, t) {
        var i = d.getMapPointFromCellId(e)
          , n = y[i.x + 1][i.y + 1];
        o(t, n)
    }
    ,
    t.getPath = function(e, t, i, n, o) {
        var a, r;
        n = void 0 === n || !!n;
        var l = p(e)
          , u = p(t)
          , h = l.x + 1
          , d = l.y + 1
          , g = y[h][d];
        if (g.zone === -1) {
            for (var _ = null , v = 1 / 0, w = 1 / 0, b = -1; b <= 1; b += 1)
                for (var C = -1; C <= 1; C += 1)
                    if (0 !== b || 0 !== C) {
                        var I = y[h + b][d + C];
                        if (I.zone !== -1) {
                            var T = Math.abs(I.f - g.f)
                              , S = Math.abs(b) + Math.abs(C);
                            (null === _ || T < w || T <= w && S < v) && (_ = I,
                            v = S,
                            w = T)
                        }
                    }
            return null !== _ ? [e, m(_.i - 1, _.j - 1)] : (console.error(new Error("[pathFinder.getPath] Player is stuck in " + h + "/" + d)),
            [e])
        }
        var A, E, x = u.x + 1, M = u.y + 1;
        for (E in i)
            A = p(E),
            y[A.x + 1][A.y + 1].weight += f;
        for (var N = [], R = [], O = Math.sqrt((h - x) * (h - x) + (d - M) * (d - M)), P = new s(h,d,0,O,null ), D = null , L = P; P.i !== x || P.j !== M; ) {
            c(P, x, M, N, n);
            var B = N.length;
            if (0 === B) {
                P = L;
                break
            }
            var k = 1 / 0
              , F = 0;
            for (a = 0; a < B; a += 1)
                r = N[a],
                r.w + r.d < k && (P = r,
                k = r.w + r.d,
                F = a);
            if (R.push(P),
            N.splice(F, 1),
            0 === P.d || o && P.d < 1.5) {
                if (null === D || P.w < D.w) {
                    D = P,
                    L = P;
                    var H = [];
                    for (a = 0; a < N.length; a += 1)
                        r = N[a],
                        r.w + r.d < D.w ? H.push(r) : y[r.i][r.j].candidateRef = null ;
                    N = H
                }
            } else
                P.d < L.d && (L = P)
        }
        for (a = 0; a < N.length; a += 1)
            r = N[a],
            y[r.i][r.j].candidateRef = null ;
        for (var G = 0; G < R.length; G += 1)
            P = R[G],
            y[P.i][P.j].candidateRef = null ;
        for (E in i)
            A = p(E),
            y[A.x + 1][A.y + 1].weight -= f;
        for (var U = []; null !== L; )
            U.unshift(m(L.i - 1, L.j - 1)),
            L = L.path;
        return U
    }
    ,
    t.getAccessibleCells = function(e, t) {
        e += 1,
        t += 1;
        var i = y[e][t]
          , n = y[e - 1][t]
          , o = y[e][t - 1]
          , s = y[e][t + 1]
          , r = y[e + 1][t]
          , l = [];
        return a(i, n) && l.push({
            i: n.i - 1,
            j: n.j - 1
        }),
        a(i, r) && l.push({
            i: r.i - 1,
            j: r.j - 1
        }),
        a(i, o) && l.push({
            i: o.i - 1,
            j: o.j - 1
        }),
        a(i, s) && l.push({
            i: s.i - 1,
            j: s.j - 1
        }),
        l
    }
    ,
    t.compressPath = function(e) {
        for (var t, i, n = [], o = e[0], s = -1, a = 0; a < e.length; a++) {
            var r, l = e[a], c = p(l);
            r = 0 === a ? -1 : c.y === i ? c.x > t ? 7 : 3 : c.x === t ? c.y > i ? 1 : 5 : c.x > t ? c.y > i ? 0 : 6 : c.y > i ? 2 : 4,
            r !== s && (n.push(o + (r << 12)),
            s = r),
            o = l,
            t = c.x,
            i = c.y
        }
        return n.push(o + (s << 12)),
        n
    }
    ,
    t.normalizePath = function(e) {
        return u(e) ? e : h(e)
    }
    ,
    t.logPath = function(e) {
        e = e || [];
        var t, i, n = [];
        for (t = 0; t < 33; t += 1)
            for (n.push([]),
            i = 0; i < 34; i += 1)
                void 0 === m(t, i) ? n[t][i] = "    " : n[t][i] = "[  ]";
        for (var o = 0, s = e.length; o < s; o += 1) {
            var a = e[o]
              , r = p(a)
              , l = o < 10 ? "0" : "";
            n[r.x][r.y] = "[" + l + o + "]"
        }
        var c = "";
        for (i = 0; i < 34; i += 1) {
            for (t = 0; t < 33; t += 1)
                c += n[t][i];
            c += "\n"
        }
        return c
    }
}
, function(e, t, i) {
    function n(e) {
        var t = e.x - _
          , i = e.y;
        return {
            x: (y * t + y * i) / w + d / 2 + m,
            y: (y * i - y * t) / b + f
        }
    }
    function o(e) {
        var t = e % 14 - ~~(e / 28)
          , i = t + 19
          , n = t + ~~(e / 14);
        return {
            x: i,
            y: n
        }
    }
    function s() {
        for (var e = 0; e < 560; e++) {
            var t = o(e);
            C[t.x + "_" + t.y] = e
        }
    }
    function a(e, t) {
        var i = C[e + "_" + t];
        return i
    }
    function r(e, t) {
        t = t || !1;
        var i = o(e)
          , n = i.x
          , s = i.y
          , r = [];
        return t && r.push(a(n + 1, s + 1)),
        r.push(a(n, s + 1)),
        t && r.push(a(n - 1, s + 1)),
        r.push(a(n - 1, s)),
        t && r.push(a(n - 1, s - 1)),
        r.push(a(n, s - 1)),
        t && r.push(a(n + 1, s - 1)),
        r.push(a(n + 1, s)),
        r
    }
    function l(e, t, i) {
        return r(e, i).indexOf(t) !== -1
    }
    function c(e, t, i) {
        var n, s = o(e), a = o(t), r = Math.atan2(s.y - a.y, a.x - s.x);
        return i ? (r = ~~(Math.floor(8 * r / Math.PI) + 8),
        n = [3, 2, 2, 1, 1, 0, 0, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3][r]) : (r = ~~(Math.floor(4 * r / Math.PI) + 4),
        n = [3, 1, 1, 7, 7, 5, 5, 3, 3][r]),
        n
    }
    function u(e, t) {
        return e = o(e),
        t = o(t),
        Math.abs(e.x - t.x) + Math.abs(e.y - t.y)
    }
    var h = i(6)
      , d = h.CELL_WIDTH
      , p = h.CELL_HEIGHT
      , m = h.HORIZONTAL_OFFSET - d
      , f = h.VERTICAL_OFFSET - p / 2
      , g = 19
      , _ = g + .225
      , v = Math.sqrt(2)
      , y = v / 2
      , w = v / d
      , b = v / p;
    t.getCoordinateSceneFromGrid = n,
    t.getMapPointFromCellId = o;
    var C = {};
    s(),
    Object.freeze(C),
    t.getCellIdFromMapPoint = a,
    t.getNeighbourCells = r,
    t.areCellsNeighbours = l,
    t.getOrientation = c,
    t.getDistance = u
}
, function(e, t) {
    t.characterLevelLimit = 49,
    t.exits = {
        81527299: [{
            type: "sun",
            target: "tile",
            targetId: 424,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "sun",
            target: "tile",
            targetId: 438,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463588,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463589,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80219654: [{
            type: "sun",
            target: "tile",
            targetId: 148,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81529347: [{
            type: "sun",
            target: "tile",
            targetId: 341,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81527301: [{
            type: "sun",
            target: "tile",
            targetId: 316,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81529349: [{
            type: "sun",
            target: "tile",
            targetId: 344,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81528323: [{
            type: "sun",
            target: "tile",
            targetId: 311,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81528325: [{
            type: "sun",
            target: "tile",
            targetId: 316,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81529345: [{
            type: "sun",
            target: "tile",
            targetId: 358,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463599,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81527297: [{
            type: "sun",
            target: "tile",
            targetId: 427,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463597,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 472493,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80218116: [{
            type: "interactive",
            target: "interactive",
            targetId: 463596,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463601,
            delta: {
                x: 0,
                y: 0
            }
        }],
        81528321: [{
            type: "interactive",
            target: "interactive",
            targetId: 463586,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80218626: [{
            type: "interactive",
            target: "interactive",
            targetId: 463600,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80216578: [{
            type: "interactive",
            target: "interactive",
            targetId: 463602,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80740865: [{
            type: "sun",
            target: "tile",
            targetId: 321,
            delta: {
                x: 0,
                y: 0
            }
        }, {
            type: "interactive",
            target: "interactive",
            targetId: 463651,
            delta: {
                x: 0,
                y: 0
            }
        }],
        80741889: [{
            type: "sun",
            target: "tile",
            targetId: 459,
            delta: {
                x: 0,
                y: 0
            }
        }]
    },
    t.questsHints = {
        717: {
            questId: 717,
            question: "tablet.joris.questQuestion717",
            answer: "tablet.joris.questAnswer717",
            coordinate: {
                x: -5,
                y: -1
            },
            priority: 10
        },
        780: {
            questId: 780,
            question: "tablet.joris.questQuestion717",
            answer: "tablet.joris.questAnswer717",
            coordinate: {
                x: -5,
                y: -1
            },
            requirements: [717],
            priority: 10
        },
        777: {
            questId: 777,
            question: "tablet.joris.questQuestion717",
            answer: "tablet.joris.questAnswer717",
            coordinate: {
                x: -5,
                y: -1
            },
            requirements: [780],
            priority: 10
        },
        783: {
            questId: 783,
            question: "tablet.joris.questQuestion783",
            answer: "tablet.joris.questAnswer783",
            coordinate: {
                x: 0,
                y: 3
            },
            requirements: [777],
            priority: 9
        },
        181: {
            questId: 181,
            question: "tablet.joris.questQuestion181",
            answer: "tablet.joris.questAnswer181",
            coordinate: {
                x: 0,
                y: 3
            },
            requirements: [777],
            priority: 8
        },
        784: {
            questId: 784,
            question: "tablet.joris.questQuestion784",
            answer: "tablet.joris.questAnswer784",
            coordinate: {
                x: 4,
                y: 3
            },
            requirements: [777],
            priority: 7
        }
    },
    t.phoenixPosition = {
        x: 6,
        y: 6
    },
    t.tutorialQuests = {
        489: !0,
        492: !0
    },
    t.rewardsPendingHintLimit = 5,
    t.beginnerHatGID = 10801,
    t.INCARNAM_WORLD_MAP = 2,
    t.noTacticalModeMaps = [80216064, 80216065, 80216067, 80216071, 80216576, 80216077, 80216833, 80217088, 80217089, 80217091, 80217345, 80217603, 80217604, 80218112, 80218113, 80218115, 80218624, 80218627, 80219136, 80219137, 80219138, 80219139, 80219141, 80219649, 80219650, 80220160, 80220161, 80220162, 80220673, 80220674, 80347649, 80347651, 80216068, 81270787, 81269763, 81268739, 81266688],
    t.achievementsHintId = 118,
    t.incarnamDungeon = {
        keyId: 8545,
        playerLevelThreshold: 15,
        firstMapId: 80742913,
        coord: {
            x: 7,
            y: 5
        }
    },
    t.newEquipmentHintsId = [2478, 2475, 2476, 2473, 2477, 2474],
    t.creatureModeHintCreaturesId = [1001, 984, 983, 981],
    t.numPlayersMetForGuildHint = 2,
    t.minLevelForGuildHint = 12,
    t.noobGuildData = {
        900: {
            guildId: 85,
            guildName: "YopLaGuilde",
            leaders: [{
                id: 216,
                name: "PandiPanda"
            }, {
                id: 1828,
                name: "Anframbin"
            }, {
                id: 230,
                name: "Rowenn"
            }]
        },
        300: [{
            guildId: 27,
            guildName: "Go Gobball",
            leaders: [{
                id: 29,
                name: "Verdichex"
            }]
        }, {
            guildId: 42,
            guildName: "LoupsJauneDevant",
            leaders: [{
                id: 1126,
                name: "Marie-Adelle"
            }]
        }],
        301: {
            guildId: 3,
            guildName: "Au Bazar de Papycha",
            leaders: [{
                id: 8,
                name: "Cait"
            }, {
                id: 3847,
                name: "Hera"
            }, {
                id: 4649,
                name: "Tenebros"
            }, {
                id: 1705,
                name: "Acide-Sulfurique"
            }]
        },
        403: {
            guildId: 1,
            guildName: "Au Bazar de Papycha",
            leaders: [{
                id: 212,
                name: "Cait"
            }, {
                id: 83,
                name: "Hera"
            }, {
                id: 169105,
                name: "Ceridwen"
            }, {
                id: 24203,
                name: "Hachirota"
            }, {
                id: 9463,
                name: "Ravasz"
            }]
        },
        404: {
            guildId: 314,
            guildName: "Sapientia Malum",
            leaders: [{
                id: 53394,
                name: "Horasi"
            }, {
                id: 5340,
                name: "Glowing-Glue"
            }, {
                id: 7020,
                name: "Golden-Shaman"
            }]
        }
    }
}
, function(e, t, i) {
    function n() {
        ne = window.foreground,
        oe = window.gui,
        se = window.isoEngine,
        ae = oe.GPS;
        for (var e = 0; e < Me.length; e++) {
            var t = Me[e].key
              , i = Me[e].type;
            Pe[t] = Se.getValue(oe.playerData.id + "-" + t, 0),
            "bool" === i && (Pe[t] = !!Pe[t])
        }
        s(),
        l()
    }
    function o() {
        for (var e = 0; e < Me.length; e++) {
            var t = Me[e].key;
            Se.setValue(oe.playerData.id + "-" + t, 0)
        }
    }
    function s() {
        me.on("removed", r),
        se.on("mapLoaded", l),
        pe.on("GameRolePlayShowActorMessage", c),
        oe.playerData.on("characterInfosUpdated", u),
        oe.playerData.inventory.on("weightUpdated", h),
        oe.on("GameActionFightTackledMessage", d),
        se.on("GameFightEndMessage", p),
        se.on("GameFightStartMessage", f),
        oe.once("disconnect", a)
    }
    function a() {
        me.removeListener("removed", r),
        se.removeListener("mapLoaded", l),
        pe.removeListener("GameRolePlayShowActorMessage", c),
        oe.playerData.removeListener("characterInfosUpdated", u),
        oe.playerData.inventory.removeListener("weightUpdated", h),
        oe.removeListener("GameActionFightTackledMessage", d),
        se.removeListener("GameFightEndMessage", p),
        se.removeListener("GameFightStartMessage", f),
        oe.removeListener("QuestStartedMessage", te),
        oe.removeListener("CompassResetMessage", $),
        J()
    }
    function r() {
        Re = [],
        null !== Ne && (clearTimeout(Ne),
        Ne = null ),
        E()
    }
    function l() {
        Ae.isBeginnerAssistantRequired() && (Oe = !1,
        w(),
        b(),
        ie(),
        C())
    }
    function c() {
        Ae.isBeginnerAssistantRequired() && w()
    }
    function u() {
        Ae.isBeginnerAssistantRequired() && (y(),
        C())
    }
    function h() {
        Ae.isBeginnerAssistantRequired() && b()
    }
    function d(e) {
        if (!Pe.tackleHintShown && Ae.isBeginnerAssistantRequired({
            fightContextAllowed: !0
        }) && e.sourceId === oe.playerData.id) {
            var t = Q(ve("tablet.joris.fight.tackle"));
            t && (Pe.tackleHintShown = !0,
            Se.setValue(oe.playerData.id + "-tackleHintShown", 1))
        }
    }
    function p(e) {
        J(),
        Ae.isBeginnerAssistantRequired({
            fightContextAllowed: !0
        }) && m(e)
    }
    function m(e) {
        if (!Pe.newEquipmentHintShown && !oe.uiLocker.isFeatureLocked("inventory") && e.results && 0 !== e.results.length) {
            for (var t = window.gui.playerData.inventory, i = null , n = 0; n < e.results.length; n++) {
                var o = e.results[n];
                if ("FightResultPlayerListEntry" === o._type && o.id === oe.playerData.id && o.rewards && o.rewards.objects && 0 !== o.rewards.objects.length) {
                    for (var s = 0; s < o.rewards.objects.length; s += 2) {
                        var a = o.rewards.objects[s];
                        if (fe.newEquipmentHintsId.indexOf(a) !== -1 && !t.isGenericItemEquipped(a)) {
                            i = a;
                            break
                        }
                    }
                    if (i)
                        break
                }
            }
            i && Ie.getItems([i], function(e) {
                if (e)
                    return console.error(e);
                var t = Ie.items[i]
                  , n = t.nameId;
                T(Ce.process(ve("tablet.joris.newEquipment", "(" + n + ")"))),
                Pe.newEquipmentHintShown = !0,
                Se.setValue(oe.playerData.id + "-newEquipmentHintShown", 1)
            })
        }
    }
    function f() {
        _(),
        g(),
        v()
    }
    function g() {
        if (!Pe.tacticalModeHintShown && Ae.isBeginnerAssistantRequired({
            fightContextAllowed: !0
        }) && fe.noTacticalModeMaps.indexOf(oe.playerData.position.mapId) === -1) {
            var e = Q(ve("tablet.joris.fight.tactical"));
            e && (Pe.tacticalModeHintShown = !0,
            Se.setValue(oe.playerData.id + "-tacticalModeHintShown", 1))
        }
    }
    function _() {
        if (!Pe.creatureModeHintShown && Ae.isBeginnerAssistantRequired({
            fightContextAllowed: !0
        })) {
            var e = !1;
            for (var t in window.actorManager.actors) {
                var i = window.actorManager.actors[t];
                if (i.data && fe.creatureModeHintCreaturesId.indexOf(i.data.creatureGenericId) !== -1) {
                    e = !0;
                    break
                }
            }
            if (e) {
                var n = Q(ve("tablet.joris.fight.creatureMode"));
                n && (Pe.creatureModeHintShown = !0,
                Se.setValue(oe.playerData.id + "-creatureModeHintShown", 1));
            }
        }
    }
    function v() {
        if (!Pe.pingHintShown && Ae.isBeginnerAssistantRequired({
            fightContextAllowed: !0
        })) {
            var e = !1
              , t = oe.fightManager.getFighter(oe.playerData.id);
            if (t && t.data && !isNaN(t.data.teamId)) {
                var i = t.data.teamId
                  , n = oe.fightManager.getAvailableFighters();
                for (var o in n)
                    if (Number(o) !== oe.playerData.id && !(Number(o) < 0)) {
                        var s = n[o];
                        if (s && s.data && s.data.teamId === i) {
                            e = !0;
                            break
                        }
                    }
                if (e) {
                    var a = Q(ve("tablet.joris.fight.ping"));
                    a && (Pe.pingHintShown = !0,
                    Se.setValue(oe.playerData.id + "-pingHintShown", 1))
                }
            }
        }
    }
    function y() {
        Pe.dungeonKeyHintShown || Ae.isBeginnerAssistantRequired() && oe.playerData.inventory.quantityList[fe.incarnamDungeon.keyId] && (oe.playerData.characterBaseInformations.level < fe.incarnamDungeon.playerLevelThreshold || (T(Ce.process(ve("tablet.joris.dungeonKey"))),
        ee(fe.incarnamDungeon.coord.x, fe.incarnamDungeon.coord.y, null , fe.incarnamDungeon.firstMapId),
        Pe.dungeonKeyHintShown = !0,
        Se.setValue(oe.playerData.id + "-dungeonKeyHintShown", 1)))
    }
    function w() {
        oe.playerData.characterBaseInformations.level < fe.minLevelForGuildHint || Pe.numPlayersMet >= fe.numPlayersMetForGuildHint || 0 !== window.actorManager.getPlayers().length && (Oe || (Pe.numPlayersMet++,
        Oe = !0,
        Se.setValue(oe.playerData.id + "-numPlayersMet", Pe.numPlayersMet),
        Pe.numPlayersMet < fe.numPlayersMetForGuildHint || T(Y())))
    }
    function b() {
        if (!Pe.maxWeightHintShown) {
            var e = window.gui.playerData.inventory;
            e.weight < e.maxWeight || (T(Ce.process(ve("tablet.joris.maxWeight"))),
            Pe.maxWeightHintShown = !0,
            Se.setValue(oe.playerData.id + "-maxWeightHintShown", 1))
        }
    }
    function C() {
        (oe.playerData.characterBaseInformations.level > fe.characterLevelLimit || oe.playerData.position.worldmapId !== fe.INCARNAM_WORLD_MAP) && X()
    }
    function I() {
        a();
        for (var e = 0; e < Me.length; e++) {
            var t = Me[e].key;
            Se.delValue(oe.playerData.id + "-" + t)
        }
    }
    function T(e, t, i) {
        function n() {
            T(e, t, i)
        }
        if (oe.npcDialogUi.inDialog) {
            if (oe.npcDialogUi.actor && "beginnerAssistant" === oe.npcDialogUi.actor.actorId) {
                if (!e)
                    return;
                return Re.push({
                    content: e,
                    buttons: t,
                    closeCb: i
                })
            }
            return oe.npcDialogUi.once("closed", n)
        }
        if (re) {
            if (!e)
                return;
            return Re.push({
                content: e,
                buttons: t,
                closeCb: i
            })
        }
        var o = me.getActor();
        return o ? (le = null ,
        ce = t || [],
        ue = i || null ,
        o.moving ? me.once("actorStopped", n) : (me.freeze(),
        e ? N(e) : x(),
        void S())) : me.once("actorReady", n)
    }
    function S() {
        if (!ce || 0 === ce.length)
            return re = oe.newSpeechBubble({
                title: ve("tablet.joris"),
                msg: le,
                actor: me.getActor(),
                onClose: function() {
                    return ue ? ue() : void A()
                },
                isLocked: !0,
                action: function() {
                    re.close()
                }
            }),
            void ne.unlock("beginnerAssistantDialog");
        ne.lock("beginnerAssistantDialog");
        for (var e = [], t = 0; t < ce.length; t++)
            e.push(ce[t].buttonText);
        oe.npcDialogUi.showNpcQuestion(le, e, function(e) {
            var t;
            return null !== e && ce[e].callback ? t = ce[e].callback : null === e && ue && (t = ue,
            oe.npcDialogUi.leaveDialog()),
            t ? (le = null ,
            ce = [],
            ue = null ,
            t()) : (oe.npcDialogUi.leaveDialog(),
            void A())
        }, {
            actor: me.getActor(),
            npcData: {
                nameId: ve("tablet.joris")
            }
        })
    }
    function A() {
        return re = null ,
        le = null ,
        ue = null ,
        ce = [],
        Re.length > 0 ? void (Ne = setTimeout(function() {
            Ne = null ;
            var e = Re.shift();
            T(e.content, e.buttons, e.closeCb)
        }, 500)) : (ne.unlock("beginnerAssistantDialog"),
        void me.unfreeze(2e3))
    }
    function E() {
        re && re.close(),
        oe.npcDialogUi.inDialog && (oe.npcDialogUi.leaveDialog(),
        A())
    }
    function x() {
        var e, t = [];
        if (fe.exits[oe.playerData.position.mapId] && t.push({
            type: "exit",
            priority: 10
        }),
        H() && t.push({
            type: "nextQuest",
            priority: 8
        }),
        oe.playerData.state === be.STATUS_PHANTOM && t.push({
            type: "ghost",
            priority: 20
        }),
        Object.keys(oe.playerData.achievements.rewardableAchievements).length >= fe.rewardsPendingHintLimit && t.push({
            type: "rewards",
            priority: 3
        }),
        q() && t.push({
            type: "beginnerHat",
            priority: 5
        }),
        V() && t.push({
            type: "guild",
            priority: 2
        }),
        t.sort(M),
        0 === t.length)
            return N(ve("tablet.joris.noHint")),
            void O();
        for (N(ve("tablet.joris.canIHelp")),
        e = 0; e < t.length && !(e >= xe); e++)
            "exit" === t[e].type ? R(P()) : "nextQuest" === t[e].type ? R(D()) : "ghost" === t[e].type ? R(U()) : "rewards" === t[e].type ? R(j()) : "beginnerHat" === t[e].type ? R(W()) : "guild" === t[e].type && R(z())
    }
    function M(e, t) {
        return t.priority - e.priority
    }
    function N(e) {
        var t = new ge("div",{
            className: "message"
        });
        e instanceof ge ? t.appendChild(e) : t.setHtml(e),
        le = t
    }
    function R(e) {
        return e ? void ce.push(e) : console.warn("beginnerAssistant.addButton: invalid buttonData")
    }
    function O(e) {
        R({
            buttonText: "Ok",
            callback: e || E
        })
    }
    function P() {
        var e = !1
          , t = !1
          , i = fe.exits[oe.playerData.position.mapId];
        if (i && i.length)
            for (var n = 0; n < i.length; n++) {
                var o = i[n];
                "sun" === o.type ? e = !0 : "interactive" === o.type && (t = !0)
            }
        var s;
        return s = ve(e && !t ? "tablet.joris.exitSun" : !e && t ? "tablet.joris.exitInteractive" : "tablet.joris.exits"),
        {
            buttonText: ve("tablet.joris.searchingExit"),
            callback: function() {
                N(s),
                O(function() {
                    Z(),
                    E()
                }),
                S()
            }
        }
    }
    function D() {
        var e = G();
        return 0 === e.length ? null : {
            buttonText: ve("tablet.joris.whatToDo"),
            callback: function() {
                k(e),
                S()
            }
        }
    }
    function L(e, t) {
        return fe.questsHints[t].priority - fe.questsHints[e].priority
    }
    function B(e) {
        R({
            buttonText: ve(e.question),
            callback: function() {
                F(e),
                S()
            }
        })
    }
    function k(e) {
        if (1 === e.length)
            return F(fe.questsHints[e[0]]);
        e.sort(L);
        for (var t = 0; t < e.length; t++) {
            var i = fe.questsHints[e[t]];
            B(i)
        }
    }
    function F(e) {
        N(ve(e.answer)),
        R({
            buttonText: ve("tablet.joris.yesPlease"),
            callback: function() {
                var t = oe.playerData.position.coordinates;
                return e.coordinate.x === t.posX && e.coordinate.y === t.posY ? (N(ve("tablet.joris.onTheMap")),
                R({
                    buttonText: ve("ui.common.ok"),
                    callback: E
                }),
                void S()) : (ee(e.coordinate.x, e.coordinate.y, e.questId),
                void E())
            }
        }),
        R({
            buttonText: ve("tablet.joris.noThanks"),
            callback: E
        })
    }
    function H() {
        return G().length > 0
    }
    function G() {
        var e = oe.playerData.quests
          , t = [];
        for (var i in fe.questsHints)
            if (!e.all[i]) {
                var n = fe.questsHints[i]
                  , o = !0;
                if (n.requirements && n.requirements.length > 0)
                    for (var s = 0; s < n.requirements.length; s++)
                        if (!e.finished[n.requirements[s]]) {
                            o = !1;
                            break
                        }
                o && t.push(i)
            }
        return t
    }
    function U() {
        return {
            buttonText: ve("tablet.joris.ghostQuestion"),
            callback: function() {
                var e = fe.phoenixPosition;
                N(Ce.process(ve("tablet.joris.ghostAnswer", e.x, e.y))),
                R({
                    buttonText: ve("ui.common.ok"),
                    callback: E
                }),
                S()
            }
        }
    }
    function j() {
        return {
            buttonText: ve("tablet.joris.rewardsQuestion"),
            callback: function() {
                N(ve("tablet.joris.rewardsAnswer")),
                R({
                    buttonText: ve("ui.common.ok"),
                    callback: E
                }),
                S()
            }
        }
    }
    function q() {
        var e = oe.playerData.inventory;
        if (0 !== e.getGenericItemCount(fe.beginnerHatGID) && !e.isGenericItemEquipped(fe.beginnerHatGID) && !e.equippedItems[Te.hat])
            return !0
    }
    function W() {
        return {
            buttonText: ve("tablet.joris.beginnerHatQuestion"),
            callback: function() {
                N(Ce.process(ve("tablet.joris.beginnerHatAnswer"))),
                R({
                    buttonText: ve("ui.common.ok"),
                    callback: E
                }),
                S()
            }
        }
    }
    function V() {
        return !oe.playerData.guild.hasGuild() && Pe.numPlayersMet >= 2
    }
    function z() {
        return {
            buttonText: ve("tablet.joris.guildQuestion"),
            callback: function() {
                N(Y()),
                R({
                    buttonText: ve("ui.common.ok"),
                    callback: E
                }),
                S()
            }
        }
    }
    function Y() {
        var e = ve("tablet.joris.guildAnswer")
          , t = fe.noobGuildData[oe.serversData.connectedServerId];
        if (!t)
            return ve("tablet.joris.guildAnswerFailover");
        t instanceof Array && (t = t[Math.floor(Math.random() * t.length)]);
        for (var i = "", n = 0; n < t.leaders.length; n++)
            n === t.leaders.length - 1 && n > 0 ? i += ve("tablet.joris.guildAnswerOr") : n > 0 && (i += ", "),
            i += "{player," + t.leaders[n].name + "," + t.leaders[n].id + "}";
        return e = ye(e, t.guildId, t.guildName, i),
        e = Ce.process(e)
    }
    function X() {
        var e = me.getActor();
        if (!e)
            return me.once("actorReady", X);
        var t, i;
        if (oe.playerData.characterBaseInformations.level > fe.characterLevelLimit)
            t = "tablet.joris.goodByeMaxLevel",
            i = "maxLevel";
        else {
            if (oe.playerData.position.worldmapId === fe.INCARNAM_WORLD_MAP)
                return console.error(new Error("beginnerAssistant: no reason to say good bye"));
            t = "tablet.joris.goodByeIncarnam",
            i = "incarnamLeft"
        }
        var n = e.direction;
        3 !== n && 1 !== n && (n = Math.random() < .5 ? 3 : 1),
        Ae.setRequired(!1);
        var o = function() {
            oe.npcDialogUi.leaveDialog(),
            setTimeout(function() {
                Re = [],
                A(),
                me.freeze(),
                me.setAnimation("JumpAndSmoke", n, function() {
                    me.getActor().remove(),
                    "maxLevel" === i && Ae.removeAndClean()
                })
            }, 300)
        };
        T(ve(t), [{
            buttonText: ve("tablet.joris.goodBye"),
            callback: o
        }], o)
    }
    function Q(e) {
        if (de && de.isVisible())
            return !1;
        if (de || (de = new Ee,
        de.allowDomEvents(),
        de.on("dom.touchstart", K),
        de.open()),
        "string" == typeof e) {
            var t = new ge("span");
            t.setHtml(e),
            e = t
        }
        return de.setContent(e),
        !0
    }
    function K() {
        de && de.close()
    }
    function J() {
        de && (K(),
        de.removeListener("dom.touchstart", K),
        de.destroy(),
        de = null )
    }
    function Z() {
        se.removeArrows();
        var e = fe.exits[oe.playerData.position.mapId];
        if (e && e.length)
            for (var t = 0; t < e.length; t++) {
                var i = e[t]
                  , n = i.delta || {
                    x: 0,
                    y: 0
                };
                if ("tile" === i.target)
                    se.addArrowOnCell(i.targetId, n.x, n.y, void 0, 5);
                else if ("interactive" === i.target) {
                    var o = se.mapRenderer.identifiedElements[i.targetId];
                    se.addArrowOnGraphic(o, n.x, n.y, void 0, 5)
                }
            }
    }
    function $() {
        he && he.listening && (oe.removeListener("QuestStartedMessage", te),
        oe.removeListener("CompassResetMessage", $)),
        !he || null === he.questId && null === he.mapId || ae.removePOI("flag_srv" + we.COMPASS_TYPE_QUEST),
        he = {
            questId: null ,
            mapId: null ,
            listening: !1
        }
    }
    function ee(e, t, i, n) {
        $(),
        ae.addPOI({
            id: "flag_srv" + we.COMPASS_TYPE_QUEST,
            x: e,
            y: t,
            categoryId: "hint",
            nameId: "(" + e + "," + t + ")",
            color: {
                r: 85,
                g: 136,
                b: 0,
                a: 1
            },
            isDestination: !0
        }),
        oe.on("QuestStartedMessage", te),
        oe.on("CompassResetMessage", $),
        he.listening = !0,
        he.questId = i || null ,
        he.mapId = n || null
    }
    function te(e) {
        he && he.questId !== e.questId || $()
    }
    function ie() {
        oe.playerData.position.mapId === fe.incarnamDungeon.firstMapId && (Pe.dungeonKeyHintShown = !0,
        Se.setValue(oe.playerData.id + "-dungeonKeyHintShown", 1)),
        he && he.mapId === oe.playerData.position.mapId && $()
    }
    var ne, oe, se, ae, re, le, ce, ue, he, de, pe = i(49), me = i(609), fe = i(627), ge = i(190), _e = i(35), ve = _e.getText, ye = _e.processText, we = i(452), be = i(420), Ce = i(451), Ie = i(323), Te = Ie.positions, Se = i(30), Ae = i(607), Ee = i(599), xe = 3, Me = [{
        key: "numPlayersMet",
        type: "int"
    }, {
        key: "maxWeightHintShown",
        type: "bool"
    }, {
        key: "tackleHintShown",
        type: "bool"
    }, {
        key: "tacticalModeHintShown",
        type: "bool"
    }, {
        key: "creatureModeHintShown",
        type: "bool"
    }, {
        key: "pingHintShown",
        type: "bool"
    }, {
        key: "dungeonKeyHintShown",
        type: "bool"
    }, {
        key: "newEquipmentHintShown",
        type: "bool"
    }], Ne = null , Re = [], Oe = !1, Pe = {};
    t.initialize = n,
    t.openDialog = T,
    t.onActorRemoved = r,
    t.reset = o,
    t.removeAndClean = I
}
, function(e, t, i) {
    function n() {
        return !1
    }
    function o(e) {
        return M.tutorialQuests[e] || !1
    }
    function s() {
        S = window.gui,
        A = window.isoEngine,
        b(),
        f(),
        T() || (w(),
        S.playerData.on("characterInfosUpdated", a),
        A.on("mapLoaded", r),
        E.on("GameRolePlayShowActorMessage", l),
        S.playerData.quests.on("questStarted", c),
        S.playerData.quests.on("questUpdate", u),
        S.on("AchievementFinishedMessage", h),
        S.uiLocker.on("updated", d),
        S.once("disconnect", p),
        g("myShop"),
        r())
    }
    function a() {
        return S.playerData.characterBaseInformations.level > M.characterLevelLimit ? m() : void g(["spells", "carac", "bidHouse"])
    }
    function r() {
        return S.playerData.position.worldmapId !== M.INCARNAM_WORLD_MAP ? m() : void g(["worldMap", "friends"])
    }
    function l() {
        g(["friends", "directory"])
    }
    function c() {
        g(["quests", "bestiary"])
    }
    function u() {
        g("bestiary")
    }
    function h() {
        g("achievements")
    }
    function d(e) {
        "job" === e.featureId && g("job")
    }
    function p() {
        S.playerData.removeListener("characterInfosUpdated", a),
        A.removeListener("mapLoaded", r),
        E.removeListener("GameRolePlayShowActorMessage", l),
        S.playerData.quests.removeListener("questStarted", c),
        S.playerData.quests.removeListener("questUpdate", u),
        S.removeListener("AchievementFinishedMessage", h),
        S.uiLocker.removeListener("updated", d),
        S.removeListener("disconnect", p),
        I(!1)
    }
    function m() {
        I(!0),
        p()
    }
    function f() {
        for (var e in P) {
            var t = P[e];
            t.alreadyUnlocked || !t.evaluateCurrent || t.evaluateCurrent({
                init: !0
            }) ? t.alreadyUnlocked = !0 : (S.uiLocker.lockFeature(e, "beginnerAssistant"),
            t.alreadyUnlocked = !1)
        }
    }
    function g(e) {
        e ? e instanceof Array || (e = [e]) : e = Object.keys(P);
        for (var t = !1, i = 0; i < e.length; i++) {
            var n = e[i]
              , o = _(n, !1);
            t = t || o
        }
        t && w()
    }
    function _(e, t) {
        if (!x.isBeginnerAssistantRequired())
            return !1;
        var i = P[e];
        return !i.alreadyUnlocked && (!!i.evaluateCurrent() && (i.alreadyUnlocked = !0,
        S.uiLocker.unlockFeature(e, "beginnerAssistant"),
        i.jorisDialog && x.openDialog(R.process(O(i.jorisDialog))),
        t && w(),
        !0))
    }
    function v() {
        m()
    }
    function y() {
        return "beginnerUiLocked"
    }
    function w() {
        var e = {};
        for (var t in P)
            P[t].alreadyUnlocked || (e[t] = 1);
        N.setValue(y(), e)
    }
    function b() {
        var e = N.getValue(y(), null );
        if (null !== e)
            for (var t in P)
                P[t].alreadyUnlocked = !e[t]
    }
    function C() {
        for (var e in P)
            P[e].alreadyUnlocked = !1;
        f(),
        w(),
        N.delValue("beginnerUiLocked.alreadyConnectedChars")
    }
    function I(e) {
        for (var t in P)
            P[t].alreadyUnlocked = !0,
            S.uiLocker.unlockFeature(t, "beginnerAssistant");
        e && w()
    }
    function T() {
        for (var e in P)
            if (!P[e].alreadyUnlocked)
                return !1;
        return !0
    }
    var S, A, E = i(49), x = i(607), M = i(627), N = i(30), R = i(451), O = i(35).getText, P = {
        spells: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.spells",
            evaluateCurrent: function() {
                return S.playerData.characterBaseInformations.level >= 3
            }
        },
        carac: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.carac",
            evaluateCurrent: function() {
                return S.playerData.characterBaseInformations.level >= 2
            }
        },
        bidHouse: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.bidHouse",
            evaluateCurrent: function() {
                return S.playerData.characterBaseInformations.level >= 8
            }
        },
        worldMap: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.worldMap",
            evaluateCurrent: function() {
                var e = S.playerData.position.coordinates;
                return !S.compass.isInTutorialCorridor(e.posX, e.posY)
            }
        },
        friends: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.friends",
            evaluateCurrent: function() {
                return window.actorManager.getPlayers().length > 0
            }
        },
        quests: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.quests",
            evaluateCurrent: function() {
                for (var e = Object.keys(S.playerData.quests.all), t = 0; t < e.length; t++)
                    if (!o(e[t]))
                        return !0;
                return !1
            }
        },
        koliseum: {
            alreadyUnlocked: !1,
            jorisDialog: null ,
            evaluateCurrent: n
        },
        directory: {
            alreadyUnlocked: !1,
            jorisDialog: null ,
            evaluateCurrent: function() {
                return P.friends.alreadyUnlocked || P.friends.evaluateCurrent()
            }
        },
        alignment: {
            alreadyUnlocked: !1,
            jorisDialog: null ,
            evaluateCurrent: n
        },
        bestiary: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.bestiary",
            evaluateCurrent: function() {
                for (var e in S.playerData.quests.all) {
                    var t = Number(e);
                    if (172 === t || 199 === t)
                        return !0;
                    if (826 === t) {
                        var i = S.playerData.quests.all[826].objectives;
                        if (void 0 === i)
                            return S.playerData.quests.finished[826] || console.error(new Error("quest 826 objectives is undefined but quest is not finished")),
                            !0;
                        for (var n = 0; n < i.length; n++)
                            if (5246 === i[n].objectiveId || 5247 === i[n].objectiveId)
                                return !0
                    }
                }
                return !1
            }
        },
        ornaments: {
            alreadyUnlocked: !1,
            jorisDialog: null ,
            evaluateCurrent: n
        },
        achievements: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.achievements",
            evaluateCurrent: function() {
                for (var e = S.playerData.achievements.finishedAchievementsIds, t = 0; t < e.length; t++)
                    if (e[t] === M.achievementsHintId)
                        return !0;
                return !1
            }
        },
        almanax: {
            alreadyUnlocked: !1,
            jorisDialog: null ,
            evaluateCurrent: n
        },
        myShop: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.myShop",
            evaluateCurrent: function(e) {
                if (e && e.init)
                    return P.myShop.alreadyUnlocked;
                var t = N.getValue("beginnerUiLocked.alreadyConnectedChars", []);
                return t.indexOf(S.playerData.id) !== -1 ? (N.delValue("beginnerUiLocked.alreadyConnectedChars"),
                !0) : (t.push(S.playerData.id),
                N.setValue("beginnerUiLocked.alreadyConnectedChars", t),
                !1)
            }
        },
        job: {
            alreadyUnlocked: !1,
            jorisDialog: "tablet.joris.uiUnlocker.job",
            evaluateCurrent: function() {
                return S.playerData.jobs && Object.keys(S.playerData.jobs.list).length > 0
            }
        }
    };
    t.initialize = s,
    t.reset = C,
    t.unlockAll = I,
    t.removeAndClean = v
}
, function(e, t, i) {
    function n() {
        this.handlerMap = {},
        this.handlerMap[l] = this.kamaConvertHandler,
        this.handlerMap[c] = this.kamaConvertHandler,
        this.handlerMap[u] = this.kamaLostHandler,
        this.previousConvertedKamaAmount = null
    }
    var o = i(235)
      , s = i(35).getText
      , a = i(548)
      , r = i(631)
      , l = 221
      , c = 220
      , u = 46;
    n.prototype.initialize = function() {
        var e = this
          , t = window.dofus.connectionManager
          , i = {};
        i[r.TEXT_INFORMATION_MESSAGE] = o.PSEUDO_CHANNEL_INFO,
        i[r.TEXT_INFORMATION_PVP] = o.CHANNEL_ALLIANCE,
        i[r.TEXT_INFORMATION_FIGHT] = o.PSEUDO_CHANNEL_FIGHT_LOG,
        t.on("TextInformationMessage", function(t) {
            if ("ADMIN_DEBUG" === t.parameters[0])
                return console.warn(t.text);
            var n = 1e4 * t.msgType + t.msgId
              , o = e.handlerMap[n];
            o && !o.call(e, t) || (t.msgType === r.TEXT_INFORMATION_ERROR ? window.gui.chat.logError(t.text) : window.gui.chat.logMsg(t.text, i[t.msgType]))
        })
    }
    ,
    n.prototype.kamaConvertHandler = function(e) {
        return this.previousConvertedKamaAmount = ~~e.parameters[0],
        !1
    }
    ,
    n.prototype.kamaLostHandler = function(e) {
        var t = ~~e.parameters[0];
        if (t !== this.previousConvertedKamaAmount)
            return this.previousConvertedKamaAmount = null ,
            !0;
        this.previousConvertedKamaAmount = null ;
        var i = a.computeHardPrice(t);
        return i ? (e.text = s("tablet.spent.hard", i),
        !0) : console.warn("Cannot convert currency")
    }
    ,
    e.exports = new n
}
, function(e, t) {
    e.exports = {
        TEXT_INFORMATION_MESSAGE: 0,
        TEXT_INFORMATION_ERROR: 1,
        TEXT_INFORMATION_PVP: 2,
        TEXT_INFORMATION_FIGHT_LOG: 3,
        TEXT_INFORMATION_POPUP: 4,
        TEXT_LIVING_OBJECT: 5,
        TEXT_ENTITY_TALK: 6,
        TEXT_INFORMATION_FIGHT: 7
    }
}
, function(e, t, i) {
    function n() {
        return c
    }
    function o() {
        s = window.gui,
        r.call(this),
        this.lockStatus = {};
        for (var e in u)
            this.lockStatus[e] = {
                base: null ,
                customLockedReasons: null
            };
        this._setupEvents(),
        this.updateAll()
    }
    var s, a = i(26).inherits, r = i(16).EventEmitter, l = !0, c = !1, u = {
        carac: {
            windowId: "characteristics",
            menuButtonId: "Carac",
            evaluateCurrent: n
        },
        spells: {
            windowId: "grimoire",
            tabId: "spells",
            menuButtonId: "Spell",
            evaluateCurrent: n
        },
        inventory: {
            windowId: "equipment",
            menuButtonId: "Bag",
            evaluateCurrent: n
        },
        bidHouse: {
            windowId: "bidHouseShop",
            menuButtonId: "BidHouse",
            evaluateCurrent: n
        },
        worldMap: {
            windowId: "worldMap",
            menuButtonId: "Map",
            evaluateCurrent: n
        },
        friends: {
            windowId: "social",
            tabId: "friends",
            menuButtonId: "Friend",
            evaluateCurrent: n
        },
        quests: {
            windowId: "grimoire",
            tabId: "quests",
            menuButtonId: "Book",
            evaluateCurrent: n
        },
        guild: {
            windowId: "social",
            tabId: "guild",
            menuButtonId: "Guild",
            evaluateCurrent: function() {
                return s.playerData.guild.hasGuild() ? c : l
            }
        },
        koliseum: {
            windowId: "arena",
            menuButtonId: "Conquest",
            evaluateCurrent: n
        },
        market: {
            windowId: "market",
            tabId: "shop",
            menuButtonId: "Goultine",
            evaluateCurrent: n
        },
        job: {
            windowId: "grimoire",
            tabId: "jobs",
            menuButtonId: "Job",
            evaluateCurrent: function() {
                return s.playerData.jobs && Object.keys(s.playerData.jobs.list).length > 0 ? c : l
            }
        },
        alliance: {
            windowId: "social",
            tabId: "alliance",
            menuButtonId: "Alliance",
            evaluateCurrent: function() {
                return s.playerData.alliance.hasAlliance() ? c : l
            }
        },
        mount: {
            windowId: "mount",
            menuButtonId: "Mount",
            evaluateCurrent: function() {
                return s.playerData.equippedMount ? c : l
            }
        },
        directory: {
            windowId: "social",
            tabId: "directory",
            menuButtonId: "Directory",
            evaluateCurrent: n
        },
        alignment: {
            windowId: "grimoire",
            tabId: "alignment",
            menuButtonId: "Alignment",
            evaluateCurrent: n
        },
        bestiary: {
            windowId: "grimoire",
            tabId: "bestiary",
            menuButtonId: "Bestiary",
            evaluateCurrent: n
        },
        ornaments: {
            windowId: "grimoire",
            tabId: "ornaments",
            menuButtonId: "Title",
            evaluateCurrent: n
        },
        achievements: {
            windowId: "grimoire",
            tabId: "achievements",
            menuButtonId: "Achievement",
            evaluateCurrent: n
        },
        almanax: {
            windowId: "grimoire",
            tabId: "almanax",
            menuButtonId: "Almanax",
            evaluateCurrent: n
        },
        spouse: {
            windowId: "social",
            tabId: "spouse",
            menuButtonId: "Spouse",
            evaluateCurrent: function() {
                return s.playerData.socialData.spouse ? c : l
            }
        },
        myShop: {
            windowId: "tradeStorage",
            menuButtonId: "Shop",
            evaluateCurrent: n
        }
    };
    a(o, r),
    e.exports = o,
    o.prototype.updateAll = function() {
        for (var e in u)
            this.updateFeatureId(e)
    }
    ,
    o.prototype.updateFeatureId = function(e) {
        var t = u[e]
          , i = this.lockStatus[e].base
          , n = t.evaluateCurrent();
        n !== i && this._setStatus(e, n)
    }
    ,
    o.prototype.isFeatureLocked = function(e) {
        return void 0 === this.lockStatus[e] ? (console.error(new Error("UiLocker.isFeatureLocked: featureId `" + e + "` unknown")),
        !0) : !(this.lockStatus[e].base !== l && !this.lockStatus[e].customLockedReasons)
    }
    ,
    o.prototype.isFeatureAvailable = function(e) {
        return !this.isFeatureLocked(e)
    }
    ,
    o.prototype.isMenuButtonAvailable = function(e) {
        for (var t in u) {
            var i = u[t];
            if (i.menuButtonId === e)
                return this.isFeatureAvailable(t)
        }
        return console.error(new Error("UiLocker.isMenuButtonAvailable: no feature is matching the menuButtonId " + e)),
        !1
    }
    ,
    o.prototype.isTabAvailable = function(e, t) {
        for (var i in u) {
            var n = u[i];
            if (n.windowId === e && n.tabId === t)
                return this.isFeatureAvailable(i)
        }
        return console.error(new Error("UiLocker.isTabAvailable: no feature matching window " + e + " w/ tabId " + t)),
        !1
    }
    ,
    o.prototype._setStatus = function(e, t, i) {
        var n = u[e];
        if (!n)
            return console.error(new Error("UiLocker._setStatus: featureId " + e + " unknown"));
        var o = this.isFeatureLocked(e)
          , s = this.lockStatus[e]
          , a = s.base;
        if (i) {
            var r = -1;
            s.customLockedReasons && (r = s.customLockedReasons.indexOf(i)),
            t ? r === -1 && (s.customLockedReasons || (s.customLockedReasons = []),
            s.customLockedReasons.push(i)) : (r !== -1 && (s.customLockedReasons.splice(r, 1),
            0 === s.customLockedReasons.length && (s.customLockedReasons = null )),
            s.base = n.evaluateCurrent())
        } else
            s.base = t;
        var l = this.isFeatureLocked(e)
          , c = s.base;
        l === o && c === a || this.emit("updated", {
            featureId: e,
            locked: l,
            baseLocked: c,
            menuButtonId: n.menuButtonId,
            windowId: n.windowId,
            tabId: n.tabId
        })
    }
    ,
    o.prototype._setupEvents = function() {
        var e = this;
        s.playerData.jobs.on("jobListUpdated", function() {
            e.updateFeatureId("job")
        }),
        s.playerData.alliance.on("allianceUpdated", function() {
            e.updateFeatureId("alliance")
        }),
        s.playerData.alliance.on("allianceJoined", function() {
            e.updateFeatureId("alliance")
        }),
        s.playerData.alliance.on("allianceLeft", function() {
            e.updateFeatureId("alliance")
        }),
        s.playerData.guild.on("GuildGeneralInformationUpdate", function() {
            e.updateFeatureId("guild")
        }),
        s.playerData.guild.on("guildLeft", function() {
            e.updateFeatureId("guild")
        }),
        s.playerData.on("setMount", function() {
            e.updateFeatureId("mount")
        }),
        s.playerData.on("unsetMount", function() {
            e.updateFeatureId("mount")
        }),
        s.playerData.socialData.on("spouseUpdate", function() {
            e.updateFeatureId("spouse")
        }),
        s.playerData.socialData.on("spouseLeft", function() {
            e.updateFeatureId("spouse")
        })
    }
    ,
    o.prototype.lockFeature = function(e, t) {
        return t ? void this._setStatus(e, !0, t) : console.error(new Error("UiLocker.lockFeature: a reasonKey is required to lock a feature"))
    }
    ,
    o.prototype.unlockFeature = function(e, t) {
        return t ? void this._setStatus(e, !1, t) : console.error(new Error("UiLocker.unlockFeature: a reasonKey is required to unlock a feature"))
    }
    ,
    o.prototype.lockAllFeatures = function(e) {
        if (!e)
            return console.error(new Error("UiLocker.lockAllFeatures: a reasonKey is required to lock features"));
        for (var t in this.lockStatus)
            this.lockFeature(t, e)
    }
    ,
    o.prototype.unlockAllFeatures = function(e) {
        if (!e)
            return console.error(new Error("UiLocker.unlockAllFeatures: a reasonKey is required to unlock features"));
        for (var t in this.lockStatus)
            this.unlockFeature(t, e)
    }
}
, function(e, t, i) {
    function n(e) {
        e.on("connected", function() {
            o()
        })
    }
    function o() {
        F = !1,
        H = {},
        G = [],
        U = null
    }
    function s(e) {
        return F ? G.push(e) : void (U ? q.setImmediate(function() {
            e(null , U)
        }) : (G.push(e),
        r()))
    }
    function a(e, t) {
        for (var i = 0; i < G.length; i++)
            G[i](e, t);
        G = []
    }
    function r() {
        return F = !0,
        window.wizPurchase ? void window.dofus.send("shopIAPListRequest") : d({})
    }
    function l() {
        f(new Error("Request IAP keys failed"))
    }
    function c(e) {
        var t = e.iapList;
        if (!t.length)
            return d({});
        for (var i = [], n = 0; n < t.length; n++)
            i.push(t[n].key);
        h(i)
    }
    function u(e) {
        var t;
        try {
            var i = new W(e);
            t = i.times("0.000001").toNumber()
        } catch (n) {
            return console.error(new Error("Could not parse price " + e)),
            NaN
        }
        return t === 1 / 0 || t === -(1 / 0) ? NaN : t
    }
    function h(e) {
        return window.wizPurchase ? e.length ? void window.wizPurchase.getProductDetails(e, function(e) {
            var t = e.products;
            for (var i in t) {
                var n = t[i]
                  , o = u(n.priceMicros);
                isNaN(o) || (n._parsedPrice = o,
                H[i] = n)
            }
            var s = {
                platform: z.osName,
                currency: e.currency,
                country: e.country
            };
            d(s)
        }, function(t) {
            return f(new Error("wizPurchase.getProductDetails failed with keys: " + e + " and error: " + t))
        }) : d({}) : f(new Error("Purchases are not available on this platform"))
    }
    function d(e) {
        e = e || {},
        window.dofus.send("setShopDetailsRequest", e)
    }
    function p() {
        f(new Error("Request to set shop details failed"))
    }
    function m(e) {
        f(null , e.shopDetails)
    }
    function f(e, t) {
        return F = !1,
        e ? a(e) : (U = t,
        void a(null , t))
    }
    function g(e) {
        e.key || (e._softPrice = Q.computeSoftPrice(e.price),
        e.original_price && (e._softOriginalPrice = Q.computeSoftPrice(e.original_price)))
    }
    function _(e) {
        for (var t = [], i = 0; i < e.length; i++) {
            var n = e[i];
            if (n.key) {
                var o = H[n.key];
                if (!o)
                    continue;
                n.product = o
            } else {
                if (n.currency !== V.GOULTINE)
                    continue;
                g(n)
            }
            if (n.price && n.original_price) {
                var s = Math.floor(100 - 100 * n.price / n.original_price);
                n._promoRate = s ? "- " + s + "%" : ""
            }
            for (var a = [], r = n.references, l = 0; l < r.length; l++) {
                var c = r[l].reference_virtualgift;
                if (c)
                    for (var u = 0; u < c.length; u++)
                        a.push(c[u].id)
            }
            n.itemsId = a,
            t.push(n)
        }
        return t
    }
    function v(e) {
        var t = Y("tablet.price.hard", X.kamasToString(e.price, ""));
        window.gui.openConfirmPopup({
            title: Y("ui.popup.warning"),
            message: Y("tablet.shop.notEnoughKamas", e.name, t),
            cb: function(t) {
                t && b(e, V.GOULTINE)
            }
        })
    }
    function y(e) {
        var t = K.getWindow("buyHardCurrencyConfirm");
        t.confirmBuy(e)
    }
    function w(e) {
        return e ? void B(function(t, i) {
            return t ? (console.error(t),
            window.gui.openSimplePopup(Y("tablet.shop.couldNotBuy"))) : i.length ? K.getWindow("purchasesPending").validatePendingPurchases(i) : void K.getWindow("shopConfirm").confirmBuy({
                article: e
            }, function(t) {
                if (t) {
                    if (!U)
                        return console.error(new Error("Purchase could not be done, store infos are no longer available")),
                        R(),
                        window.gui.openSimplePopup(Y("tablet.shop.couldNotBuy"));
                    var i = {
                        currency: U.currency,
                        iapKey: e.key,
                        purchase: JSON.stringify([{
                            quantity: 1,
                            id: e.id,
                            amount: e.product._parsedPrice
                        }])
                    };
                    console.error("[Haapi info] ShopWindow sending shopBuyIAPRequest with data: " + JSON.stringify(i)),
                    window.dofus.send("shopBuyIAPRequest", i)
                }
            })
        }) : console.error(new Error("Trying to buy a non-existent article"))
    }
    function b(e, t) {
        if (!e)
            return console.error(new Error("Trying to buy a non-existent article"));
        var i = window.gui.playerData.inventory
          , n = i.goultines
          , o = i.kamas
          , s = t === V.KAMA;
        if (s && e._softPrice > o)
            return v(e);
        if (!s && e.price > n) {
            var a = e.price - n;
            return y(a)
        }
        K.getWindow("shopConfirm").confirmBuy({
            article: e,
            isSoft: s
        }, function(i) {
            i && window.dofus.send("shopBuyRequest", {
                currency: t,
                amountHard: e.price,
                amountSoft: e._softPrice,
                purchase: JSON.stringify([{
                    quantity: 1,
                    id: e.id
                }])
            })
        })
    }
    function C(e) {
        var t;
        return t = "android" === e.platform ? JSON.stringify({
            json: e.json,
            developerPayload: e.developerPayload,
            signature: e.signature
        }) : e.receipt
    }
    function I(e, t, i) {
        return i = i || function(e) {
            e && console.error(e)
        }
        ,
        window.wizPurchase ? (window.dofus.send("moneyGoultinesAmountRequest"),
        void window.wizPurchase.finishPurchase(e, !0, function() {
            return i(null , e)
        }, function(n) {
            return i(new Error("Finish purchase failed for key " + e + " and order id " + t + " with error: " + n), e)
        })) : i(new Error("Purchase should not have been possible on this platform, for key: " + e + " and order id: " + t), e)
    }
    function T(e) {
        "RECEIPT_ALREADY_VALIDATED" === e.reason ? I(e.iapKey, e.orderId, function() {
            R()
        }) : (R(),
        window.gui.openSimplePopup(Y("tablet.shop.validateIAPFail")))
    }
    function S(e) {
        window.gui.openSimplePopup(Y("tablet.shop.validateIAPSuccess"), Y("ui.common.informations")),
        I(e.iapKey, e.buyResult.order_id, function() {
            R()
        })
    }
    function A() {
        R(),
        window.gui.openSimplePopup(Y("tablet.shop.buyFail"))
    }
    function E(e) {
        R(),
        window.gui.openSimplePopup(Y("tablet.shop.buySuccess"), Y("ui.common.informations")),
        e.currency === V.GOULTINE && window.dofus.send("moneyGoultinesAmountRequest")
    }
    function x(e, t) {
        var i = C(t)
          , n = t.productId;
        "android" === t.platform ? console.error("[Haapi info] ShopWindow sending shopMobileValidateOrderRequest with data: " + JSON.stringify({
            orderId: e,
            receipt: i,
            iapKey: n
        })) : console.error("[Haapi info] ShopWindow sending shopMobileValidateOrderRequest with data: " + JSON.stringify({
            orderId: e,
            iapKey: n
        })),
        window.dofus.send("shopMobileValidateOrderRequest", {
            orderId: e,
            receipt: i,
            iapKey: n
        })
    }
    function M() {
        R(),
        window.gui.openSimplePopup(Y("tablet.shop.buyFail"))
    }
    function N(e) {
        if (!window.wizPurchase)
            return console.error(new Error("Purchase should not have been possible on this platform, for key: " + e.iapKey + " and order id: " + e.buyResult.order_id));
        var t = e.iapKey
          , i = e.buyResult.order_id;
        window.wizPurchase.makePurchase(t, function(e) {
            var n = H[t];
            U ? n ? j.trackIAPBought(n._parsedPrice, U.currency, i) : console.error(new Error("Could not send event to Adjust, no product found for key: " + t)) : console.error(new Error("Could not send event to Adjust, store infos are no longer available")),
            x(i, e)
        }, function(e) {
            return e === window.WizPurchaseError.ALREADY_OWNED ? L() : (R(),
            void window.gui.openSimplePopup(Y("tablet.shop.validateIAPFail")))
        })
    }
    function R() {
        K.close("shopConfirm")
    }
    function O(e) {
        "RECEIPT_ALREADY_VALIDATED" === e.reason ? I(e.iapKey, null , function(e, t) {
            K.getWindow("purchasesPending").validateNextPendingPurchases(e, t)
        }) : K.getWindow("purchasesPending").validateNextPendingPurchases(new Error("Validate pending order failed for productId: " + e.iapKey + " with reason: " + e.reason), e.iapKey)
    }
    function P(e) {
        I(e.iapKey, e.buyResult.order_id, function(e, t) {
            K.getWindow("purchasesPending").validateNextPendingPurchases(e, t)
        })
    }
    function D(e) {
        var t = C(e)
          , i = e.productId;
        "android" === e.platform ? console.error("[Haapi info] ShopWindow sending shopMobileValidatePendingOrderRequest with data: " + JSON.stringify({
            receipt: t,
            iapKey: i
        })) : console.error("[Haapi info] ShopWindow sending shopMobileValidatePendingOrderRequest with data: " + JSON.stringify({
            iapKey: i
        })),
        window.dofus.send("shopMobileValidatePendingOrderRequest", {
            receipt: t,
            iapKey: i
        })
    }
    function L() {
        return window.wizPurchase ? void window.wizPurchase.restoreAllPurchases(function(e) {
            e = e || [],
            R(),
            K.getWindow("purchasesPending").validatePendingPurchases(e)
        }, function(e) {
            console.error(new Error("Restore all purchases failed with error: " + e)),
            R(),
            window.gui.openSimplePopup(Y("tablet.shop.restoreFailed"))
        }) : console.error(new Error("Restoring purchases should not have been possible on this platform"))
    }
    function B(e) {
        return window.wizPurchase ? void window.wizPurchase.getPendingPurchases(function(t) {
            return t = t || [],
            e(null , t)
        }, function(t) {
            return e(new Error("Get pending purchases failed with error: " + t))
        }) : e(new Error("Check pending purchases should not have been possible on this platform"))
    }
    function k() {
        B(function(e, t) {
            return e ? console.error(new Error("Check pending purchases failed with error: " + e)) : void (t.length && K.getWindow("purchasesPending").validatePendingPurchases(t))
        })
    }
    var F, H, G, U, j = i(181), q = i(12), W = i(634), V = i(635), z = i(7), Y = i(35).getText, X = i(210), Q = i(548), K = i(22);
    W.config({
        ROUNDING_MODE: W.ROUND_HALF_EVEN,
        ERRORS: !0
    });
    var J = window.dofus.connectionManager;
    J.on("setShopDetailsSuccess", m),
    J.on("setShopDetailsError", p),
    J.on("shopIAPListSuccess", c),
    J.on("shopIAPListError", l),
    J.on("shopMobileValidateOrderError", T),
    J.on("shopMobileValidateOrderSuccess", S),
    J.on("shopBuyError", A),
    J.on("shopBuySuccess", E),
    J.on("shopBuyIAPError", M),
    J.on("shopBuyIAPSuccess", N),
    J.on("shopMobileValidatePendingOrderError", O),
    J.on("shopMobileValidatePendingOrderSuccess", P),
    t.initialize = n,
    t.getStoreInfos = s,
    t.enrichWithSoftPrice = g,
    t.validateArticles = _,
    t.purchaseArticleOnStore = w,
    t.purchaseArticleOnAnkama = b,
    t.openNotEnoughHardCurrencyPopup = y,
    t.validatePendingIAP = D,
    t.checkPendingPurchases = k
}
, function(e, t, i) {
    var n;
    !function(o) {
        "use strict";
        function s(e) {
            function t(e, n) {
                var o, s, a, r, l, c, u = this;
                if (!(u instanceof t))
                    return W && O(26, "constructor call without new", e),
                    new t(e,n);
                if (null != n && V(n, 2, 64, L, "base")) {
                    if (n = 0 | n,
                    c = e + "",
                    10 == n)
                        return u = new t(e instanceof t ? e : c),
                        P(u, F + u.e + 1, H);
                    if ((r = "number" == typeof e) && 0 * e != 0 || !new RegExp("^-?" + (o = "[" + T.slice(0, n) + "]+") + "(?:\\." + o + ")?$",n < 37 ? "i" : "").test(c))
                        return _(u, c, r, n);
                    r ? (u.s = 1 / e < 0 ? (c = c.slice(1),
                    -1) : 1,
                    W && c.replace(/^0\.0*|\./, "").length > 15 && O(L, I, e),
                    r = !1) : u.s = 45 === c.charCodeAt(0) ? (c = c.slice(1),
                    -1) : 1,
                    c = i(c, 10, n, u.s)
                } else {
                    if (e instanceof t)
                        return u.s = e.s,
                        u.e = e.e,
                        u.c = (e = e.c) ? e.slice() : e,
                        void (L = 0);
                    if ((r = "number" == typeof e) && 0 * e == 0) {
                        if (u.s = 1 / e < 0 ? (e = -e,
                        -1) : 1,
                        e === ~~e) {
                            for (s = 0,
                            a = e; a >= 10; a /= 10,
                            s++)
                                ;
                            return u.e = s,
                            u.c = [e],
                            void (L = 0)
                        }
                        c = e + ""
                    } else {
                        if (!v.test(c = e + ""))
                            return _(u, c, r);
                        u.s = 45 === c.charCodeAt(0) ? (c = c.slice(1),
                        -1) : 1
                    }
                }
                for ((s = c.indexOf(".")) > -1 && (c = c.replace(".", "")),
                (a = c.search(/e/i)) > 0 ? (s < 0 && (s = a),
                s += +c.slice(a + 1),
                c = c.substring(0, a)) : s < 0 && (s = c.length),
                a = 0; 48 === c.charCodeAt(a); a++)
                    ;
                for (l = c.length; 48 === c.charCodeAt(--l); )
                    ;
                if (c = c.slice(a, l + 1))
                    if (l = c.length,
                    r && W && l > 15 && O(L, I, u.s * e),
                    s = s - a - 1,
                    s > q)
                        u.c = u.e = null ;
                    else if (s < j)
                        u.c = [u.e = 0];
                    else {
                        if (u.e = s,
                        u.c = [],
                        a = (s + 1) % A,
                        s < 0 && (a += A),
                        a < l) {
                            for (a && u.c.push(+c.slice(0, a)),
                            l -= A; a < l; )
                                u.c.push(+c.slice(a, a += A));
                            c = c.slice(a),
                            a = A - c.length
                        } else
                            a -= l;
                        for (; a--; c += "0")
                            ;
                        u.c.push(+c)
                    }
                else
                    u.c = [u.e = 0];
                L = 0
            }
            function i(e, i, n, o) {
                var s, a, l, c, u, d, m, f = e.indexOf("."), g = F, _ = H;
                for (n < 37 && (e = e.toLowerCase()),
                f >= 0 && (l = X,
                X = 0,
                e = e.replace(".", ""),
                m = new t(n),
                u = m.pow(e.length - f),
                X = l,
                m.c = h(p(r(u.c), u.e), 10, i),
                m.e = m.c.length),
                d = h(e, n, i),
                a = l = d.length; 0 == d[--l]; d.pop())
                    ;
                if (!d[0])
                    return "0";
                if (f < 0 ? --a : (u.c = d,
                u.e = a,
                u.s = o,
                u = D(u, m, g, _, i),
                d = u.c,
                c = u.r,
                a = u.e),
                s = a + g + 1,
                f = d[s],
                l = i / 2,
                c = c || s < 0 || null != d[s + 1],
                c = _ < 4 ? (null != f || c) && (0 == _ || _ == (u.s < 0 ? 3 : 2)) : f > l || f == l && (4 == _ || c || 6 == _ && 1 & d[s - 1] || _ == (u.s < 0 ? 8 : 7)),
                s < 1 || !d[0])
                    e = c ? p("1", -g) : "0";
                else {
                    if (d.length = s,
                    c)
                        for (--i; ++d[--s] > i; )
                            d[s] = 0,
                            s || (++a,
                            d.unshift(1));
                    for (l = d.length; !d[--l]; )
                        ;
                    for (f = 0,
                    e = ""; f <= l; e += T.charAt(d[f++]))
                        ;
                    e = p(e, a)
                }
                return e
            }
            function n(e, i, n, o) {
                var s, a, l, c, u;
                if (n = null != n && V(n, 0, 8, o, C) ? 0 | n : H,
                !e.c)
                    return e.toString();
                if (s = e.c[0],
                l = e.e,
                null == i)
                    u = r(e.c),
                    u = 19 == o || 24 == o && l <= G ? d(u, l) : p(u, l);
                else if (e = P(new t(e), i, n),
                a = e.e,
                u = r(e.c),
                c = u.length,
                19 == o || 24 == o && (i <= a || a <= G)) {
                    for (; c < i; u += "0",
                    c++)
                        ;
                    u = d(u, a)
                } else if (i -= l,
                u = p(u, a),
                a + 1 > c) {
                    if (--i > 0)
                        for (u += "."; i--; u += "0")
                            ;
                } else if (i += a - c,
                i > 0)
                    for (a + 1 == c && (u += "."); i--; u += "0")
                        ;
                return e.s < 0 && s ? "-" + u : u
            }
            function o(e, i) {
                var n, o, s = 0;
                for (u(e[0]) && (e = e[0]),
                n = new t(e[0]); ++s < e.length; ) {
                    if (o = new t(e[s]),
                    !o.s) {
                        n = o;
                        break
                    }
                    i.call(n, o) && (n = o)
                }
                return n
            }
            function f(e, t, i, n, o) {
                return (e < t || e > i || e != m(e)) && O(n, (o || "decimal places") + (e < t || e > i ? " out of range" : " not an integer"), e),
                !0
            }
            function R(e, t, i) {
                for (var n = 1, o = t.length; !t[--o]; t.pop())
                    ;
                for (o = t[0]; o >= 10; o /= 10,
                n++)
                    ;
                return (i = n + i * A - 1) > q ? e.c = e.e = null : i < j ? e.c = [e.e = 0] : (e.e = i,
                e.c = t),
                e
            }
            function O(e, t, i) {
                var n = new Error(["new BigNumber", "cmp", "config", "div", "divToInt", "eq", "gt", "gte", "lt", "lte", "minus", "mod", "plus", "precision", "random", "round", "shift", "times", "toDigits", "toExponential", "toFixed", "toFormat", "toFraction", "pow", "toPrecision", "toString", "BigNumber"][e] + "() " + t + ": " + i);
                throw n.name = "BigNumber Error",
                L = 0,
                n
            }
            function P(e, t, i, n) {
                var o, s, a, r, l, c, u, h = e.c, d = x;
                if (h) {
                    e: {
                        for (o = 1,
                        r = h[0]; r >= 10; r /= 10,
                        o++)
                            ;
                        if (s = t - o,
                        s < 0)
                            s += A,
                            a = t,
                            l = h[c = 0],
                            u = l / d[o - a - 1] % 10 | 0;
                        else if (c = y((s + 1) / A),
                        c >= h.length) {
                            if (!n)
                                break e;
                            for (; h.length <= c; h.push(0))
                                ;
                            l = u = 0,
                            o = 1,
                            s %= A,
                            a = s - A + 1
                        } else {
                            for (l = r = h[c],
                            o = 1; r >= 10; r /= 10,
                            o++)
                                ;
                            s %= A,
                            a = s - A + o,
                            u = a < 0 ? 0 : l / d[o - a - 1] % 10 | 0
                        }
                        if (n = n || t < 0 || null != h[c + 1] || (a < 0 ? l : l % d[o - a - 1]),
                        n = i < 4 ? (u || n) && (0 == i || i == (e.s < 0 ? 3 : 2)) : u > 5 || 5 == u && (4 == i || n || 6 == i && (s > 0 ? a > 0 ? l / d[o - a] : 0 : h[c - 1]) % 10 & 1 || i == (e.s < 0 ? 8 : 7)),
                        t < 1 || !h[0])
                            return h.length = 0,
                            n ? (t -= e.e + 1,
                            h[0] = d[(A - t % A) % A],
                            e.e = -t || 0) : h[0] = e.e = 0,
                            e;
                        if (0 == s ? (h.length = c,
                        r = 1,
                        c--) : (h.length = c + 1,
                        r = d[A - s],
                        h[c] = a > 0 ? w(l / d[o - a] % d[a]) * r : 0),
                        n)
                            for (; ; ) {
                                if (0 == c) {
                                    for (s = 1,
                                    a = h[0]; a >= 10; a /= 10,
                                    s++)
                                        ;
                                    for (a = h[0] += r,
                                    r = 1; a >= 10; a /= 10,
                                    r++)
                                        ;
                                    s != r && (e.e++,
                                    h[0] == S && (h[0] = 1));
                                    break
                                }
                                if (h[c] += r,
                                h[c] != S)
                                    break;
                                h[c--] = 0,
                                r = 1
                            }
                        for (s = h.length; 0 === h[--s]; h.pop())
                            ;
                    }
                    e.e > q ? e.c = e.e = null : e.e < j && (e.c = [e.e = 0])
                }
                return e
            }
            var D, L = 0, B = t.prototype, k = new t(1), F = 20, H = 4, G = -7, U = 21, j = -1e7, q = 1e7, W = !0, V = f, z = !1, Y = 1, X = 100, Q = {
                decimalSeparator: ".",
                groupSeparator: ",",
                groupSize: 3,
                secondaryGroupSize: 0,
                fractionGroupSeparator: "",
                fractionGroupSize: 0
            };
            return t.another = s,
            t.ROUND_UP = 0,
            t.ROUND_DOWN = 1,
            t.ROUND_CEIL = 2,
            t.ROUND_FLOOR = 3,
            t.ROUND_HALF_UP = 4,
            t.ROUND_HALF_DOWN = 5,
            t.ROUND_HALF_EVEN = 6,
            t.ROUND_HALF_CEIL = 7,
            t.ROUND_HALF_FLOOR = 8,
            t.EUCLID = 9,
            t.config = function() {
                var e, t, i = 0, n = {}, o = arguments, s = o[0], a = s && "object" == typeof s ? function() {
                    if (s.hasOwnProperty(t))
                        return null != (e = s[t])
                }
                : function() {
                    if (o.length > i)
                        return null != (e = o[i++])
                }
                ;
                return a(t = "DECIMAL_PLACES") && V(e, 0, N, 2, t) && (F = 0 | e),
                n[t] = F,
                a(t = "ROUNDING_MODE") && V(e, 0, 8, 2, t) && (H = 0 | e),
                n[t] = H,
                a(t = "EXPONENTIAL_AT") && (u(e) ? V(e[0], -N, 0, 2, t) && V(e[1], 0, N, 2, t) && (G = 0 | e[0],
                U = 0 | e[1]) : V(e, -N, N, 2, t) && (G = -(U = 0 | (e < 0 ? -e : e)))),
                n[t] = [G, U],
                a(t = "RANGE") && (u(e) ? V(e[0], -N, -1, 2, t) && V(e[1], 1, N, 2, t) && (j = 0 | e[0],
                q = 0 | e[1]) : V(e, -N, N, 2, t) && (0 | e ? j = -(q = 0 | (e < 0 ? -e : e)) : W && O(2, t + " cannot be zero", e))),
                n[t] = [j, q],
                a(t = "ERRORS") && (e === !!e || 1 === e || 0 === e ? (L = 0,
                V = (W = !!e) ? f : c) : W && O(2, t + b, e)),
                n[t] = W,
                a(t = "CRYPTO") && (e === !!e || 1 === e || 0 === e ? (z = !(!e || !g || "object" != typeof g),
                e && !z && W && O(2, "crypto unavailable", g)) : W && O(2, t + b, e)),
                n[t] = z,
                a(t = "MODULO_MODE") && V(e, 0, 9, 2, t) && (Y = 0 | e),
                n[t] = Y,
                a(t = "POW_PRECISION") && V(e, 0, N, 2, t) && (X = 0 | e),
                n[t] = X,
                a(t = "FORMAT") && ("object" == typeof e ? Q = e : W && O(2, t + " not an object", e)),
                n[t] = Q,
                n
            }
            ,
            t.max = function() {
                return o(arguments, B.lt)
            }
            ,
            t.min = function() {
                return o(arguments, B.gt)
            }
            ,
            t.random = function() {
                var e = 9007199254740992
                  , i = Math.random() * e & 2097151 ? function() {
                    return w(Math.random() * e)
                }
                : function() {
                    return 8388608 * (1073741824 * Math.random() | 0) + (8388608 * Math.random() | 0)
                }
                ;
                return function(e) {
                    var n, o, s, a, r, l = 0, c = [], u = new t(k);
                    if (e = null != e && V(e, 0, N, 14) ? 0 | e : F,
                    a = y(e / A),
                    z)
                        if (g && g.getRandomValues) {
                            for (n = g.getRandomValues(new Uint32Array(a *= 2)); l < a; )
                                r = 131072 * n[l] + (n[l + 1] >>> 11),
                                r >= 9e15 ? (o = g.getRandomValues(new Uint32Array(2)),
                                n[l] = o[0],
                                n[l + 1] = o[1]) : (c.push(r % 1e14),
                                l += 2);
                            l = a / 2
                        } else if (g && g.randomBytes) {
                            for (n = g.randomBytes(a *= 7); l < a; )
                                r = 281474976710656 * (31 & n[l]) + 1099511627776 * n[l + 1] + 4294967296 * n[l + 2] + 16777216 * n[l + 3] + (n[l + 4] << 16) + (n[l + 5] << 8) + n[l + 6],
                                r >= 9e15 ? g.randomBytes(7).copy(n, l) : (c.push(r % 1e14),
                                l += 7);
                            l = a / 7
                        } else
                            W && O(14, "crypto unavailable", g);
                    if (!l)
                        for (; l < a; )
                            r = i(),
                            r < 9e15 && (c[l++] = r % 1e14);
                    for (a = c[--l],
                    e %= A,
                    a && e && (r = x[A - e],
                    c[l] = w(a / r) * r); 0 === c[l]; c.pop(),
                    l--)
                        ;
                    if (l < 0)
                        c = [s = 0];
                    else {
                        for (s = -1; 0 === c[0]; c.shift(),
                        s -= A)
                            ;
                        for (l = 1,
                        r = c[0]; r >= 10; r /= 10,
                        l++)
                            ;
                        l < A && (s -= A - l)
                    }
                    return u.e = s,
                    u.c = c,
                    u
                }
            }(),
            D = function() {
                function e(e, t, i) {
                    var n, o, s, a, r = 0, l = e.length, c = t % M, u = t / M | 0;
                    for (e = e.slice(); l--; )
                        s = e[l] % M,
                        a = e[l] / M | 0,
                        n = u * s + a * c,
                        o = c * s + n % M * M + r,
                        r = (o / i | 0) + (n / M | 0) + u * a,
                        e[l] = o % i;
                    return r && e.unshift(r),
                    e
                }
                function i(e, t, i, n) {
                    var o, s;
                    if (i != n)
                        s = i > n ? 1 : -1;
                    else
                        for (o = s = 0; o < i; o++)
                            if (e[o] != t[o]) {
                                s = e[o] > t[o] ? 1 : -1;
                                break
                            }
                    return s
                }
                function n(e, t, i, n) {
                    for (var o = 0; i--; )
                        e[i] -= o,
                        o = e[i] < t[i] ? 1 : 0,
                        e[i] = o * n + e[i] - t[i];
                    for (; !e[0] && e.length > 1; e.shift())
                        ;
                }
                return function(o, s, r, l, c) {
                    var u, h, d, p, m, f, g, _, v, y, b, C, I, T, E, x, M, N = o.s == s.s ? 1 : -1, R = o.c, O = s.c;
                    if (!(R && R[0] && O && O[0]))
                        return new t(o.s && s.s && (R ? !O || R[0] != O[0] : O) ? R && 0 == R[0] || !O ? 0 * N : N / 0 : NaN);
                    for (_ = new t(N),
                    v = _.c = [],
                    h = o.e - s.e,
                    N = r + h + 1,
                    c || (c = S,
                    h = a(o.e / A) - a(s.e / A),
                    N = N / A | 0),
                    d = 0; O[d] == (R[d] || 0); d++)
                        ;
                    if (O[d] > (R[d] || 0) && h--,
                    N < 0)
                        v.push(1),
                        p = !0;
                    else {
                        for (T = R.length,
                        x = O.length,
                        d = 0,
                        N += 2,
                        m = w(c / (O[0] + 1)),
                        m > 1 && (O = e(O, m, c),
                        R = e(R, m, c),
                        x = O.length,
                        T = R.length),
                        I = x,
                        y = R.slice(0, x),
                        b = y.length; b < x; y[b++] = 0)
                            ;
                        M = O.slice(),
                        M.unshift(0),
                        E = O[0],
                        O[1] >= c / 2 && E++;
                        do {
                            if (m = 0,
                            u = i(O, y, x, b),
                            u < 0) {
                                if (C = y[0],
                                x != b && (C = C * c + (y[1] || 0)),
                                m = w(C / E),
                                m > 1)
                                    for (m >= c && (m = c - 1),
                                    f = e(O, m, c),
                                    g = f.length,
                                    b = y.length; 1 == i(f, y, g, b); )
                                        m--,
                                        n(f, x < g ? M : O, g, c),
                                        g = f.length,
                                        u = 1;
                                else
                                    0 == m && (u = m = 1),
                                    f = O.slice(),
                                    g = f.length;
                                if (g < b && f.unshift(0),
                                n(y, f, b, c),
                                b = y.length,
                                u == -1)
                                    for (; i(O, y, x, b) < 1; )
                                        m++,
                                        n(y, x < b ? M : O, b, c),
                                        b = y.length
                            } else
                                0 === u && (m++,
                                y = [0]);
                            v[d++] = m,
                            y[0] ? y[b++] = R[I] || 0 : (y = [R[I]],
                            b = 1)
                        } while ((I++ < T || null != y[0]) && N--);p = null != y[0],
                        v[0] || v.shift()
                    }
                    if (c == S) {
                        for (d = 1,
                        N = v[0]; N >= 10; N /= 10,
                        d++)
                            ;
                        P(_, r + (_.e = d + h * A - 1) + 1, l, p)
                    } else
                        _.e = h,
                        _.r = +p;
                    return _
                }
            }(),
            _ = function() {
                var e = /^(-?)0([xbo])(?=\w[\w.]*$)/i
                  , i = /^([^.]+)\.$/
                  , n = /^\.([^.]+)$/
                  , o = /^-?(Infinity|NaN)$/
                  , s = /^\s*\+(?=[\w.])|^\s+|\s+$/g;
                return function(a, r, l, c) {
                    var u, h = l ? r : r.replace(s, "");
                    if (o.test(h))
                        a.s = isNaN(h) ? null : h < 0 ? -1 : 1;
                    else {
                        if (!l && (h = h.replace(e, function(e, t, i) {
                            return u = "x" == (i = i.toLowerCase()) ? 16 : "b" == i ? 2 : 8,
                            c && c != u ? e : t
                        }),
                        c && (u = c,
                        h = h.replace(i, "$1").replace(n, "0.$1")),
                        r != h))
                            return new t(h,u);
                        W && O(L, "not a" + (c ? " base " + c : "") + " number", r),
                        a.s = null
                    }
                    a.c = a.e = null ,
                    L = 0
                }
            }(),
            B.absoluteValue = B.abs = function() {
                var e = new t(this);
                return e.s < 0 && (e.s = 1),
                e
            }
            ,
            B.ceil = function() {
                return P(new t(this), this.e + 1, 2)
            }
            ,
            B.comparedTo = B.cmp = function(e, i) {
                return L = 1,
                l(this, new t(e,i))
            }
            ,
            B.decimalPlaces = B.dp = function() {
                var e, t, i = this.c;
                if (!i)
                    return null ;
                if (e = ((t = i.length - 1) - a(this.e / A)) * A,
                t = i[t])
                    for (; t % 10 == 0; t /= 10,
                    e--)
                        ;
                return e < 0 && (e = 0),
                e
            }
            ,
            B.dividedBy = B.div = function(e, i) {
                return L = 3,
                D(this, new t(e,i), F, H)
            }
            ,
            B.dividedToIntegerBy = B.divToInt = function(e, i) {
                return L = 4,
                D(this, new t(e,i), 0, 1)
            }
            ,
            B.equals = B.eq = function(e, i) {
                return L = 5,
                0 === l(this, new t(e,i))
            }
            ,
            B.floor = function() {
                return P(new t(this), this.e + 1, 3)
            }
            ,
            B.greaterThan = B.gt = function(e, i) {
                return L = 6,
                l(this, new t(e,i)) > 0
            }
            ,
            B.greaterThanOrEqualTo = B.gte = function(e, i) {
                return L = 7,
                1 === (i = l(this, new t(e,i))) || 0 === i
            }
            ,
            B.isFinite = function() {
                return !!this.c
            }
            ,
            B.isInteger = B.isInt = function() {
                return !!this.c && a(this.e / A) > this.c.length - 2
            }
            ,
            B.isNaN = function() {
                return !this.s
            }
            ,
            B.isNegative = B.isNeg = function() {
                return this.s < 0
            }
            ,
            B.isZero = function() {
                return !!this.c && 0 == this.c[0]
            }
            ,
            B.lessThan = B.lt = function(e, i) {
                return L = 8,
                l(this, new t(e,i)) < 0
            }
            ,
            B.lessThanOrEqualTo = B.lte = function(e, i) {
                return L = 9,
                (i = l(this, new t(e,i))) === -1 || 0 === i
            }
            ,
            B.minus = B.sub = function(e, i) {
                var n, o, s, r, l = this, c = l.s;
                if (L = 10,
                e = new t(e,i),
                i = e.s,
                !c || !i)
                    return new t(NaN);
                if (c != i)
                    return e.s = -i,
                    l.plus(e);
                var u = l.e / A
                  , h = e.e / A
                  , d = l.c
                  , p = e.c;
                if (!u || !h) {
                    if (!d || !p)
                        return d ? (e.s = -i,
                        e) : new t(p ? l : NaN);
                    if (!d[0] || !p[0])
                        return p[0] ? (e.s = -i,
                        e) : new t(d[0] ? l : 3 == H ? -0 : 0)
                }
                if (u = a(u),
                h = a(h),
                d = d.slice(),
                c = u - h) {
                    for ((r = c < 0) ? (c = -c,
                    s = d) : (h = u,
                    s = p),
                    s.reverse(),
                    i = c; i--; s.push(0))
                        ;
                    s.reverse()
                } else
                    for (o = (r = (c = d.length) < (i = p.length)) ? c : i,
                    c = i = 0; i < o; i++)
                        if (d[i] != p[i]) {
                            r = d[i] < p[i];
                            break
                        }
                if (r && (s = d,
                d = p,
                p = s,
                e.s = -e.s),
                i = (o = p.length) - (n = d.length),
                i > 0)
                    for (; i--; d[n++] = 0)
                        ;
                for (i = S - 1; o > c; ) {
                    if (d[--o] < p[o]) {
                        for (n = o; n && !d[--n]; d[n] = i)
                            ;
                        --d[n],
                        d[o] += S
                    }
                    d[o] -= p[o]
                }
                for (; 0 == d[0]; d.shift(),
                --h)
                    ;
                return d[0] ? R(e, d, h) : (e.s = 3 == H ? -1 : 1,
                e.c = [e.e = 0],
                e)
            }
            ,
            B.modulo = B.mod = function(e, i) {
                var n, o, s = this;
                return L = 11,
                e = new t(e,i),
                !s.c || !e.s || e.c && !e.c[0] ? new t(NaN) : !e.c || s.c && !s.c[0] ? new t(s) : (9 == Y ? (o = e.s,
                e.s = 1,
                n = D(s, e, 0, 3),
                e.s = o,
                n.s *= o) : n = D(s, e, 0, Y),
                s.minus(n.times(e)))
            }
            ,
            B.negated = B.neg = function() {
                var e = new t(this);
                return e.s = -e.s || null ,
                e
            }
            ,
            B.plus = B.add = function(e, i) {
                var n, o = this, s = o.s;
                if (L = 12,
                e = new t(e,i),
                i = e.s,
                !s || !i)
                    return new t(NaN);
                if (s != i)
                    return e.s = -i,
                    o.minus(e);
                var r = o.e / A
                  , l = e.e / A
                  , c = o.c
                  , u = e.c;
                if (!r || !l) {
                    if (!c || !u)
                        return new t(s / 0);
                    if (!c[0] || !u[0])
                        return u[0] ? e : new t(c[0] ? o : 0 * s)
                }
                if (r = a(r),
                l = a(l),
                c = c.slice(),
                s = r - l) {
                    for (s > 0 ? (l = r,
                    n = u) : (s = -s,
                    n = c),
                    n.reverse(); s--; n.push(0))
                        ;
                    n.reverse()
                }
                for (s = c.length,
                i = u.length,
                s - i < 0 && (n = u,
                u = c,
                c = n,
                i = s),
                s = 0; i; )
                    s = (c[--i] = c[i] + u[i] + s) / S | 0,
                    c[i] %= S;
                return s && (c.unshift(s),
                ++l),
                R(e, c, l)
            }
            ,
            B.precision = B.sd = function(e) {
                var t, i, n = this, o = n.c;
                if (null != e && e !== !!e && 1 !== e && 0 !== e && (W && O(13, "argument" + b, e),
                e != !!e && (e = null )),
                !o)
                    return null ;
                if (i = o.length - 1,
                t = i * A + 1,
                i = o[i]) {
                    for (; i % 10 == 0; i /= 10,
                    t--)
                        ;
                    for (i = o[0]; i >= 10; i /= 10,
                    t++)
                        ;
                }
                return e && n.e + 1 > t && (t = n.e + 1),
                t
            }
            ,
            B.round = function(e, i) {
                var n = new t(this);
                return (null == e || V(e, 0, N, 15)) && P(n, ~~e + this.e + 1, null != i && V(i, 0, 8, 15, C) ? 0 | i : H),
                n
            }
            ,
            B.shift = function(e) {
                var i = this;
                return V(e, -E, E, 16, "argument") ? i.times("1e" + m(e)) : new t(i.c && i.c[0] && (e < -E || e > E) ? i.s * (e < 0 ? 0 : 1 / 0) : i)
            }
            ,
            B.squareRoot = B.sqrt = function() {
                var e, i, n, o, s, l = this, c = l.c, u = l.s, h = l.e, d = F + 4, p = new t("0.5");
                if (1 !== u || !c || !c[0])
                    return new t(!u || u < 0 && (!c || c[0]) ? NaN : c ? l : 1 / 0);
                if (u = Math.sqrt(+l),
                0 == u || u == 1 / 0 ? (i = r(c),
                (i.length + h) % 2 == 0 && (i += "0"),
                u = Math.sqrt(i),
                h = a((h + 1) / 2) - (h < 0 || h % 2),
                u == 1 / 0 ? i = "1e" + h : (i = u.toExponential(),
                i = i.slice(0, i.indexOf("e") + 1) + h),
                n = new t(i)) : n = new t(u + ""),
                n.c[0])
                    for (h = n.e,
                    u = h + d,
                    u < 3 && (u = 0); ; )
                        if (s = n,
                        n = p.times(s.plus(D(l, s, d, 1))),
                        r(s.c).slice(0, u) === (i = r(n.c)).slice(0, u)) {
                            if (n.e < h && --u,
                            i = i.slice(u - 3, u + 1),
                            "9999" != i && (o || "4999" != i)) {
                                +i && (+i.slice(1) || "5" != i.charAt(0)) || (P(n, n.e + F + 2, 1),
                                e = !n.times(n).eq(l));
                                break
                            }
                            if (!o && (P(s, s.e + F + 2, 0),
                            s.times(s).eq(l))) {
                                n = s;
                                break
                            }
                            d += 4,
                            u += 4,
                            o = 1
                        }
                return P(n, n.e + F + 1, H, e)
            }
            ,
            B.times = B.mul = function(e, i) {
                var n, o, s, r, l, c, u, h, d, p, m, f, g, _, v, y = this, w = y.c, b = (L = 17,
                e = new t(e,i)).c;
                if (!(w && b && w[0] && b[0]))
                    return !y.s || !e.s || w && !w[0] && !b || b && !b[0] && !w ? e.c = e.e = e.s = null : (e.s *= y.s,
                    w && b ? (e.c = [0],
                    e.e = 0) : e.c = e.e = null ),
                    e;
                for (o = a(y.e / A) + a(e.e / A),
                e.s *= y.s,
                u = w.length,
                p = b.length,
                u < p && (g = w,
                w = b,
                b = g,
                s = u,
                u = p,
                p = s),
                s = u + p,
                g = []; s--; g.push(0))
                    ;
                for (_ = S,
                v = M,
                s = p; --s >= 0; ) {
                    for (n = 0,
                    m = b[s] % v,
                    f = b[s] / v | 0,
                    l = u,
                    r = s + l; r > s; )
                        h = w[--l] % v,
                        d = w[l] / v | 0,
                        c = f * h + d * m,
                        h = m * h + c % v * v + g[r] + n,
                        n = (h / _ | 0) + (c / v | 0) + f * d,
                        g[r--] = h % _;
                    g[r] = n
                }
                return n ? ++o : g.shift(),
                R(e, g, o)
            }
            ,
            B.toDigits = function(e, i) {
                var n = new t(this);
                return e = null != e && V(e, 1, N, 18, "precision") ? 0 | e : null ,
                i = null != i && V(i, 0, 8, 18, C) ? 0 | i : H,
                e ? P(n, e, i) : n
            }
            ,
            B.toExponential = function(e, t) {
                return n(this, null != e && V(e, 0, N, 19) ? ~~e + 1 : null , t, 19)
            }
            ,
            B.toFixed = function(e, t) {
                return n(this, null != e && V(e, 0, N, 20) ? ~~e + this.e + 1 : null , t, 20)
            }
            ,
            B.toFormat = function(e, t) {
                var i = n(this, null != e && V(e, 0, N, 21) ? ~~e + this.e + 1 : null , t, 21);
                if (this.c) {
                    var o, s = i.split("."), a = +Q.groupSize, r = +Q.secondaryGroupSize, l = Q.groupSeparator, c = s[0], u = s[1], h = this.s < 0, d = h ? c.slice(1) : c, p = d.length;
                    if (r && (o = a,
                    a = r,
                    r = o,
                    p -= o),
                    a > 0 && p > 0) {
                        for (o = p % a || a,
                        c = d.substr(0, o); o < p; o += a)
                            c += l + d.substr(o, a);
                        r > 0 && (c += l + d.slice(o)),
                        h && (c = "-" + c)
                    }
                    i = u ? c + Q.decimalSeparator + ((r = +Q.fractionGroupSize) ? u.replace(new RegExp("\\d{" + r + "}\\B","g"), "$&" + Q.fractionGroupSeparator) : u) : c
                }
                return i
            }
            ,
            B.toFraction = function(e) {
                var i, n, o, s, a, l, c, u, h, d = W, p = this, m = p.c, f = new t(k), g = n = new t(k), _ = c = new t(k);
                if (null != e && (W = !1,
                l = new t(e),
                W = d,
                (d = l.isInt()) && !l.lt(k) || (W && O(22, "max denominator " + (d ? "out of range" : "not an integer"), e),
                e = !d && l.c && P(l, l.e + 1, 1).gte(k) ? l : null )),
                !m)
                    return p.toString();
                for (h = r(m),
                s = f.e = h.length - p.e - 1,
                f.c[0] = x[(a = s % A) < 0 ? A + a : a],
                e = !e || l.cmp(f) > 0 ? s > 0 ? f : g : l,
                a = q,
                q = 1 / 0,
                l = new t(h),
                c.c[0] = 0; u = D(l, f, 0, 1),
                o = n.plus(u.times(_)),
                1 != o.cmp(e); )
                    n = _,
                    _ = o,
                    g = c.plus(u.times(o = g)),
                    c = o,
                    f = l.minus(u.times(o = f)),
                    l = o;
                return o = D(e.minus(n), _, 0, 1),
                c = c.plus(o.times(g)),
                n = n.plus(o.times(_)),
                c.s = g.s = p.s,
                s *= 2,
                i = D(g, _, s, H).minus(p).abs().cmp(D(c, n, s, H).minus(p).abs()) < 1 ? [g.toString(), _.toString()] : [c.toString(), n.toString()],
                q = a,
                i
            }
            ,
            B.toNumber = function() {
                return +this
            }
            ,
            B.toPower = B.pow = function(e) {
                var i, n, o = w(e < 0 ? -e : +e), s = this;
                if (!V(e, -E, E, 23, "exponent") && (!isFinite(e) || o > E && (e /= 0) || parseFloat(e) != e && !(e = NaN)))
                    return new t(Math.pow(+s, e));
                for (i = X ? y(X / A + 2) : 0,
                n = new t(k); ; ) {
                    if (o % 2) {
                        if (n = n.times(s),
                        !n.c)
                            break;
                        i && n.c.length > i && (n.c.length = i)
                    }
                    if (o = w(o / 2),
                    !o)
                        break;
                    s = s.times(s),
                    i && s.c && s.c.length > i && (s.c.length = i)
                }
                return e < 0 && (n = k.div(n)),
                i ? P(n, X, H) : n
            }
            ,
            B.toPrecision = function(e, t) {
                return n(this, null != e && V(e, 1, N, 24, "precision") ? 0 | e : null , t, 24)
            }
            ,
            B.toString = function(e) {
                var t, n = this, o = n.s, s = n.e;
                return null === s ? o ? (t = "Infinity",
                o < 0 && (t = "-" + t)) : t = "NaN" : (t = r(n.c),
                t = null != e && V(e, 2, 64, 25, "base") ? i(p(t, s), 0 | e, 10, o) : s <= G || s >= U ? d(t, s) : p(t, s),
                o < 0 && n.c[0] && (t = "-" + t)),
                t
            }
            ,
            B.truncated = B.trunc = function() {
                return P(new t(this), this.e + 1, 1)
            }
            ,
            B.valueOf = B.toJSON = function() {
                var e, t = this, i = t.e;
                return null === i ? t.toString() : (e = r(t.c),
                e = i <= G || i >= U ? d(e, i) : p(e, i),
                t.s < 0 ? "-" + e : e)
            }
            ,
            null != e && t.config(e),
            t
        }
        function a(e) {
            var t = 0 | e;
            return e > 0 || e === t ? t : t - 1
        }
        function r(e) {
            for (var t, i, n = 1, o = e.length, s = e[0] + ""; n < o; ) {
                for (t = e[n++] + "",
                i = A - t.length; i--; t = "0" + t)
                    ;
                s += t
            }
            for (o = s.length; 48 === s.charCodeAt(--o); )
                ;
            return s.slice(0, o + 1 || 1)
        }
        function l(e, t) {
            var i, n, o = e.c, s = t.c, a = e.s, r = t.s, l = e.e, c = t.e;
            if (!a || !r)
                return null ;
            if (i = o && !o[0],
            n = s && !s[0],
            i || n)
                return i ? n ? 0 : -r : a;
            if (a != r)
                return a;
            if (i = a < 0,
            n = l == c,
            !o || !s)
                return n ? 0 : !o ^ i ? 1 : -1;
            if (!n)
                return l > c ^ i ? 1 : -1;
            for (r = (l = o.length) < (c = s.length) ? l : c,
            a = 0; a < r; a++)
                if (o[a] != s[a])
                    return o[a] > s[a] ^ i ? 1 : -1;
            return l == c ? 0 : l > c ^ i ? 1 : -1
        }
        function c(e, t, i) {
            return (e = m(e)) >= t && e <= i
        }
        function u(e) {
            return "[object Array]" == Object.prototype.toString.call(e)
        }
        function h(e, t, i) {
            for (var n, o, s = [0], a = 0, r = e.length; a < r; ) {
                for (o = s.length; o--; s[o] *= t)
                    ;
                for (s[n = 0] += T.indexOf(e.charAt(a++)); n < s.length; n++)
                    s[n] > i - 1 && (null == s[n + 1] && (s[n + 1] = 0),
                    s[n + 1] += s[n] / i | 0,
                    s[n] %= i)
            }
            return s.reverse()
        }
        function d(e, t) {
            return (e.length > 1 ? e.charAt(0) + "." + e.slice(1) : e) + (t < 0 ? "e" : "e+") + t
        }
        function p(e, t) {
            var i, n;
            if (t < 0) {
                for (n = "0."; ++t; n += "0")
                    ;
                e = n + e
            } else if (i = e.length,
            ++t > i) {
                for (n = "0",
                t -= i; --t; n += "0")
                    ;
                e += n
            } else
                t < i && (e = e.slice(0, t) + "." + e.slice(t));
            return e
        }
        function m(e) {
            return e = parseFloat(e),
            e < 0 ? y(e) : w(e)
        }
        var f, g, _, v = /^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i, y = Math.ceil, w = Math.floor, b = " not a boolean or binary digit", C = "rounding mode", I = "number type has more than 15 significant digits", T = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_", S = 1e14, A = 14, E = 9007199254740991, x = [1, 10, 100, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9, 1e10, 1e11, 1e12, 1e13], M = 1e7, N = 1e9;
        f = s(),
        n = function() {
            return f
        }
        .call(t, i, t, e),
        !(void 0 !== n && (e.exports = n))
    }(this)
}
, function(e, t) {
    e.exports = {
        GOULTINE: "GOU",
        KAMA: "KMS"
    }
}
, function(e, t, i) {
    var n = i(22)
      , o = i(637)
      , s = i(645)
      , a = i(648)
      , r = i(651)
      , l = i(653)
      , c = i(686)
      , u = i(690)
      , h = i(697)
      , d = i(709)
      , p = i(688)
      , m = i(711)
      , f = i(717)
      , g = i(721)
      , _ = i(724)
      , v = i(726)
      , y = i(728)
      , w = i(731)
      , b = i(733)
      , C = i(760)
      , I = i(762)
      , T = i(764)
      , S = i(766)
      , A = i(768)
      , E = i(770)
      , x = i(772)
      , M = i(774)
      , N = i(778)
      , R = i(780)
      , O = i(782)
      , P = i(784)
      , D = i(786)
      , L = i(788)
      , B = i(790)
      , k = i(792)
      , F = i(794)
      , H = i(795)
      , G = i(797)
      , U = i(801)
      , j = i(805)
      , q = i(809)
      , W = i(811)
      , V = i(814)
      , z = i(816)
      , Y = i(818)
      , X = i(823)
      , Q = i(825)
      , K = i(827)
      , J = i(829)
      , Z = i(831)
      , $ = i(311)
      , ee = i(835)
      , te = i(856)
      , ie = i(892)
      , ne = i(894)
      , oe = i(896)
      , se = i(898)
      , ae = i(900)
      , re = i(902)
      , le = i(905)
      , ce = i(907)
      , ue = i(911)
      , he = i(918)
      , de = i(919)
      , pe = i(921)
      , me = i(924)
      , fe = i(928)
      , ge = i(930)
      , _e = i(935)
      , ve = i(937)
      , ye = i(943)
      , we = i(945)
      , be = i(947)
      , Ce = i(949)
      , Ie = i(953)
      , Te = i(955)
      , Se = i(957)
      , Ae = i(964)
      , Ee = i(975)
      , xe = i(977);
    e.exports = function() {
        var e = new o({
            enablePresets: !0,
            dataHandler: window.gui.playerData.inventory
        })
          , t = new o({
            enablePresets: !1,
            dataHandler: null
        })
          , i = new o({
            enablePresets: !1,
            dataHandler: window.gui.playerData.inventory
        });
        n.addWindow("breedDetail", new r),
        n.addWindow("breeding", new l, {
            fixed: !0,
            group: "inventory"
        }),
        n.addWindow("cancel", new be),
        n.addWindow("characterCreation", new ce, {
            fixed: !0
        }),
        n.addWindow("serverSimpleSelection", new q, {
            fixed: !0
        }),
        n.addWindow("serverListSelection", new U, {
            fixed: !0
        }),
        n.addWindow("serverDetails", new G),
        n.addWindow("serverSelection", new j, {
            fixed: !0
        }),
        n.addWindow("worldMap", new ee),
        n.addWindow("characteristics", new c, {
            group: "mainGroup"
        }),
        n.addWindow("characUpdate", new p),
        n.addWindow("fightEnd", new v),
        n.addWindow("fightList", new y),
        n.addWindow("itemAppearance", new N),
        n.addWindow("itemBox", new R),
        n.addWindow("itemManage", new O),
        n.addWindow("itemRecipes", new P),
        n.addWindow("itemSets", new D),
        n.addWindow("levelUp", new L),
        n.addWindow("rewardsPending", new H),
        n.addWindow("characterSelection", new u, {
            fixed: !0
        }),
        n.addWindow("giftSelection", new h, {
            fixed: !0
        }),
        n.addWindow("deleteCharacterConfirm", new d, {
            fixed: !0
        }),
        n.addWindow("options", new Ce),
        n.addWindow("adminConsole", new s),
        n.addWindow("document", new m),
        n.addWindow("houseBuySell", new M),
        n.addWindow("teleporterList", new W),
        n.addWindow("exchangeInventory", new V(e), {
            group: "inventory"
        }),
        n.addWindow("exchangeStorage", new z(t)),
        n.addWindow("wallet", new Z),
        n.addWindow("tradeInventory", new K(e), {
            group: "inventory"
        }),
        n.addWindow("tradeStorage", new J),
        n.addWindow("tradeMode", new Q),
        n.addWindow("tradeItem", new Y),
        n.addWindow("tradeItemConfirm", new X),
        n.addWindow("bidHouseShop", new $),
        n.addWindow("padlock", new B),
        n.addWindow("global", new w),
        n.addWindow("prismVulnerabilityDate", new C),
        n.addWindow("socialGroupCreation", new I),
        n.addWindow("allianceCard", new T),
        n.addWindow("guildCard", new S),
        n.addWindow("guildHouseInfo", new A),
        n.addWindow("guildHouseSetting", new E),
        n.addWindow("equipment", new f(e), {
            group: "inventory"
        }),
        n.addWindow("estateForSale", new g),
        n.addWindow("estateInformation", new _),
        n.addWindow("partyInviteDetails", new k),
        n.addWindow("presetChooseIcon", new F),
        n.addWindow("arena", new a),
        n.addWindow("grimoire", new b, {
            group: "mainGroup"
        }),
        n.addWindow("social", new te, {
            group: "mainGroup"
        }),
        n.addWindow("paddockBuy", new ie),
        n.addWindow("mount", new ne),
        n.addWindow("feed", new oe(i)),
        n.addWindow("mountRename", new se),
        n.addWindow("familyTree", new ae),
        n.addWindow("jobOptions", new re),
        n.addWindow("spellForget", new le),
        n.addWindow("crafting", new ue),
        n.addWindow("craftingMulti", new he),
        n.addWindow("craftersList", new de),
        n.addWindow("crafter", new pe),
        n.addWindow("craftMagus", new me),
        n.addWindow("craftMagusMulti", new fe),
        n.addWindow("craftPayment", new ge),
        n.addWindow("craftInventory", new _e(e), {
            group: "inventory"
        }),
        n.addWindow("tradeWithNPC", new ye),
        n.addWindow("tradeWithPlayer", new ve),
        n.addWindow("tradeWithPlayerAndNPCInventory", new we(e), {
            group: "inventory"
        }),
        n.addWindow("guildMemberRights", new x),
        n.addWindow("fightEndRewards", new Ie),
        n.addWindow("hardcoreDeath", new Te),
        n.addWindow("purchasesPending", new xe),
        n.addWindow("buyHardCurrencyConfirm", new Ee),
        n.addWindow("shopConfirm", new Se),
        n.addWindow("market", new Ae)
    }
}
, function(e, t, i) {
    function n(e, t, i, n, o, s) {
        return e.position === A && (0 !== t && (!(this.filteringOptions.usable && !e.item.usable) && (!!this.filterCategories[i] && ((i === this.filteringOptions.filterId || !o) && ((e.item.typeId === this.filteringOptions.subFilterId || !s) && (!n || e.item.getNameForSearch().indexOf(n) !== -1))))))
    }
    function o(e) {
        d.call(this),
        e = e || {},
        this.itemList = {},
        this.itemsQuantityList = {},
        this.slotList = {},
        this._filters = [n],
        this.weight = 0,
        this.maxWeight = 1,
        this.enablePresets = e.enablePresets;
        var t = e.dataHandler;
        t && (this._setupEvents(t),
        this.enablePresets && this.on("StorageViewerOpen", function() {
            this.setWeight(t.weight, t.maxWeight),
            this.setKamas(t.kamas)
        })),
        this.currentOpenedWindow = null ,
        this.selectedSlot = null ,
        this.slotToShow = null ,
        this.filterCategories = {};
        for (var i in g.categories)
            this.filterCategories[g.categories[i]] = !0;
        this.filteringOptions = {},
        this.storageUI = new T("div",{
            className: "StorageViewer"
        }),
        this.domIsCreated = !1,
        this.contentInitiated = !1,
        this.listUpdateRequested = null ,
        this.sortingCriterias = ["none"],
        this.currentPage = -1,
        this.pageCount = -1,
        this.dragSourceData = {}
    }
    function s() {
        this.addClassNames("pressed")
    }
    function a() {
        this.delClassNames("pressed")
    }
    function r(e) {
        var t = new T("div",{
            className: ["arrow", e]
        });
        return I(t),
        t.on("tapstart", s),
        t.on("tapend", a),
        t
    }
    function l(e, t, i) {
        return t[i] - e[i]
    }
    function c(e, t, i) {
        for (var n = 0, o = e.length; n < o; n += 1) {
            var s = e[n]
              , a = E[s] || l
              , r = a(t, i, s);
            if (0 !== r)
                return r
        }
        return 0
    }
    i(638);
    var u = i(206).addTooltip
      , h = i(186)
      , d = i(16).EventEmitter
      , p = i(35).getText
      , m = i(210)
      , f = i(26).inherits
      , g = i(323)
      , _ = i(567)
      , v = i(389)
      , y = i(571)
      , w = i(639)
      , b = i(643)
      , C = i(33).events
      , I = i(32)
      , T = i(190)
      , S = 40
      , A = g.positions.notEquipped;
    f(o, d),
    e.exports = o,
    o.prototype._updatePageSystem = function() {
        var e = this.currentOpenedWindow;
        e && (e._storageViewer = e._storageViewer || {},
        this.slotsMask.setStyles({
            width: e.availableSlotBoxWidth,
            height: e.availableSlotBoxHeight
        }),
        this._updatePageCount(e),
        this.slotsBox.setStyle("height", e._storageViewer.slotsPerColumn * this.pageCount * S + "px"),
        this.slotsContainer.delClassNames("spinner"),
        this.slotsBox.show())
    }
    ,
    o.prototype._updatePageCount = function(e) {
        var t = e._storageViewer;
        if (t.slotsPerPage) {
            var i = Math.ceil(this.displayedSlotCount / t.slotsPerPage) || 1;
            i !== this.pageCount && (this.pageCount = i,
            this._displayPage(0),
            this.pagination.setPageCount(i))
        }
    }
    ,
    o.prototype._getAvailableSpaceAndUpdatePageSystem = function() {
        var e = this.currentOpenedWindow;
        if (!e)
            return !1;
        var t = e._storageViewer
          , i = this.slotsContainer.rootElement.clientHeight;
        if (0 === i)
            return !1;
        var n = this.slotsContainer.rootElement.clientWidth
          , o = Math.floor(n / S);
        return t.slotsPerColumn = Math.floor(i / S),
        t.slotsPerPage = o * t.slotsPerColumn,
        e.availableSlotBoxWidth = o * S + "px",
        e.availableSlotBoxHeight = t.slotsPerColumn * S + "px",
        this._updatePageSystem(),
        !0
    }
    ,
    o.prototype._initializeView = function() {
        this._getAvailableSpaceAndUpdatePageSystem() && this.slotToShow && this._displaySlotPage(this.slotToShow)
    }
    ,
    o.prototype.registerView = function(e, t) {
        var i = this;
        t = t || {},
        e.on("open", function() {
            if (i.currentOpenedWindow = this,
            i.dragSourceData.source = this.id,
            i.contextParams = t.contextParams || {},
            i.enableAveragePrice = !t.hasOwnProperty("enableAveragePrice") || t.enableAveragePrice,
            i.enableSlotContext = !t.hasOwnProperty("enableSlotContext") || t.enableSlotContext,
            i.domIsCreated || (i._createDom(),
            i.domIsCreated = !0),
            i.averagePrice.toggleDisplay(!!i.enableAveragePrice),
            i.listUpdateRequested ? (i.setItemList(i.listUpdateRequested),
            i.listUpdateRequested = null ) : t.manualReset || i.resetDisplay(),
            t.manualOpening || e.windowBody.appendChild(i.storageUI),
            e.availableSlotBoxWidth ? i._updatePageSystem() : (i.slotsBox.hide(),
            i.slotsContainer.addClassNames("spinner")),
            i.currentOpenedWindow !== i.lastOpenedWindow) {
                i.leftArrow.toggleDisplay(!!t.leftArrow),
                i.rightArrow.toggleDisplay(!!t.rightArrow);
                var n;
                if (!i.listUpdateRequested)
                    for (n in i.slotList) {
                        var o = i.slotList[n];
                        o.data && (i.contextParams.item = o.data,
                        o.setContextMenu("item", i.contextParams),
                        o.enableContextMenu(!!i.enableSlotContext))
                    }
                var s = {
                    equipment: !0,
                    consumables: !0,
                    resources: !0,
                    quest: !1,
                    preset: !1
                };
                for (n in g.categories) {
                    var a = !(!t.filters || !t.filters[n]) || s[n];
                    i.filter.toggleCategoryDisplay(g.categories[n], a),
                    i.filter.selectedFilter !== g.categories[n] || a || i.filter.selectCategory(-1)
                }
            }
            i.contentInitiated = !0,
            i.emit("StorageViewerOpen")
        }),
        e.on("opened", function() {
            i.domIsCreated ? i._initializeView() : i.once("domCreated", i._initializeView)
        }),
        e.on("close", function() {
            i.lastOpenedWindow = i.currentOpenedWindow,
            i.currentOpenedWindow = null
        })
    }
    ,
    o.prototype._createDom = function() {
        var e = this
          , t = this.storageUI = new T("div",{
            className: "StorageViewer"
        })
          , i = t.createChild("div", {
            className: "filterBox"
        })
          , n = this.leftArrow = i.appendChild(r("left"));
        u(n, p("ui.storage.advancedTransferts")),
        n.on("tap", function(t) {
            e.currentOpenedWindow && e.currentOpenedWindow.emit("leftArrow-tap", t)
        }),
        this.filter = i.appendChild(new v),
        this.enablePresets && (this.presetsBox = t.appendChild(new w),
        this.presetsBox.on("setItemSlotTapped", function(t) {
            t.data && "placeholder" === t.data.mountLocation || e.currentOpenedWindow.emit("slot-tap", t)
        })),
        this.filter.toggleCategoryDisplay(g.categories.preset, !!this.enablePresets),
        this.filter.on("filter", function(t, i, n) {
            var o = e.filteringOptions.filterId !== t || e.filteringOptions.subFilterId !== i || e.filteringOptions.search !== n;
            if (o) {
                var s = e.filteringOptions.filterId === t;
                e.filteringOptions.filterId = t,
                e.filteringOptions.subFilterId = i,
                e.filteringOptions.search = n,
                e.filterList(),
                e._displayPage(0),
                e.presetsBox && e._enablePresetsView(t === g.categories.preset),
                s || e._getAvailableSpaceAndUpdatePageSystem(),
                e.emit("filter", t)
            }
        }),
        n = this.rightArrow = i.appendChild(r("right")),
        u(n, p("ui.storage.advancedTransferts")),
        n.on("tap", function(t) {
            e.currentOpenedWindow && e.currentOpenedWindow.emit("rightArrow-tap", t)
        }),
        this.slotsContainer = t.createChild("div", {
            className: "slotBox"
        }),
        this.slotsMask = this.slotsContainer.createChild("div", {
            className: "slotsMask"
        }),
        this.slotsBox = this.slotsMask.createChild("div", {
            className: "slots"
        }),
        this.slotsBox.hide(),
        this.slotsBox.rootElement.addEventListener(C.end, function(e) {
            e.preventDefault()
        }, !1),
        this.pagination = t.appendChild(new y),
        this.pagination.on("previous", function() {
            e._displayPage(e.currentPage - 1)
        }),
        this.pagination.on("next", function() {
            e._displayPage(e.currentPage + 1)
        }),
        this.pagination.on("page", function(t) {
            e._displayPage(t)
        });
        var o = this.podContainer = t.createChild("div", {
            className: "podContainer"
        })
          , s = o.createChild("div", {
            className: "priceBox"
        });
        this.averagePrice = s.createChild("div", {
            className: "averagePrice",
            text: 0
        }),
        u(this.averagePrice, function() {
            var t = m.kamasToString(e.averagePriceValue);
            return new T("div",{
                text: p("ui.storage.estimatedValue") + p("ui.common.colon") + t
            })
        }),
        this.kamas = s.createChild("div", {
            className: "kamas",
            text: 0
        }),
        u(this.kamas, function() {
            var t = m.kamasToString(e.kamasValue);
            return new T("div",{
                text: p("ui.storage.ownedKamas") + p("ui.common.colon") + t
            })
        });
        var a = o.createChild("div", {
            className: "progressBarContainer"
        });
        a.createChild("div", {
            text: "Pods:",
            className: "label"
        }),
        this.progressBar = a.appendChild(new b({
            className: "green"
        })),
        u(this.progressBar, function() {
            return new T("div",{
                text: m.intToString(e.weight) + " / " + m.intToString(e.maxWeight)
            })
        }),
        this.emit("domCreated")
    }
    ,
    o.prototype._enablePresetsView = function(e) {
        this.filter.subFiltersBox.toggleDisplay(!e),
        this.pagination.toggleDisplay(!e),
        this.podContainer.toggleDisplay(!e),
        this.kamas.toggleDisplay(!e),
        this.presetsBox.toggleDisplay(e)
    }
    ,
    o.prototype._filter = function(e, t, i, n, o, s) {
        for (var a = 0, r = this._filters.length; a < r; a += 1) {
            var l = this._filters[a];
            if (!l.call(this, e, t, i, n, o, s))
                return !1
        }
        return !0
    }
    ,
    o.prototype._displayPage = function(e) {
        if (this.currentPage !== e && this.currentOpenedWindow && !(e < 0 || e > this.pageCount - 1)) {
            var t = this.currentOpenedWindow._storageViewer;
            this.currentPage = e;
            var i = "translateY(-" + e * t.slotsPerColumn * S + "px)";
            this.slotsBox.setStyles({
                webkitTransform: i,
                transform: i
            }),
            this.pagination.setCurrent(e)
        }
    }
    ,
    o.prototype.addFilters = function(e) {
        for (var t = 0, i = e.length; t < i; t += 1)
            this._filters.push(e[t])
    }
    ,
    o.prototype.removeFilter = function(e) {
        var t = this._filters;
        t.indexOf(e) !== -1 ? t.splice(t.indexOf(e), 1) : console.error(new Error("StorageViewer: remove unknown filter"))
    }
    ,
    o.prototype._updateAveragePrice = function() {
        var e = 0;
        for (var t in this.slotList)
            if (this.slotList[t].isVisible()) {
                var i = this.itemList[t];
                if (!i)
                    continue;
                var n = i.item.averagePrice === -1 ? 0 : i.item.averagePrice;
                e += n * this.itemsQuantityList[t]
            }
        this.averagePriceValue = e,
        this.averagePrice.setText(m.intToString(e))
    }
    ,
    o.prototype._updateFilter = function() {
        var e = {};
        for (var t in this.itemList) {
            var i = this.itemList[t];
            if (i.position === A && this.itemsQuantityList[t] > 0) {
                if (!i.item) {
                    console.error(new Error('Missing the property "item" for item: ' + i.id + " item is an " + m.getObjectInstanceName(i)));
                    continue
                }
                e[i.item.typeId] = !0
            }
        }
        this.filter.updateSubFilters(Object.keys(e))
    }
    ,
    o.prototype._filterItem = function(e) {
        var t = this.filteringOptions.search ? m.simplifyString(this.filteringOptions.search) : null
          , i = this.filteringOptions.filterId !== v.filters.all
          , n = this.filteringOptions.subFilterId !== v.subFilters.all
          , o = g.getItemTypeMap()
          , s = o[e.item.typeId].category
          , a = this.itemsQuantityList[e.objectUID]
          , r = a && this._filter(e, a, s, t, i, n)
          , l = this.slotList[e.objectUID];
        l.isVisible() && (this.displayedSlotCount -= 1),
        r ? (this.displayedSlotCount += 1,
        l.show()) : (this.unSelectSlot(e.objectUID),
        l.hide()),
        this._updatePageSystem(),
        this.enableAveragePrice && this._updateAveragePrice()
    }
    ,
    o.prototype.filterList = function() {
        var e = this.filteringOptions.search ? m.simplifyString(this.filteringOptions.search) : null
          , t = this.filteringOptions.filterId !== v.filters.all
          , i = this.filteringOptions.subFilterId !== v.subFilters.all
          , n = g.getItemTypeMap();
        this.displayedSlotCount = 0;
        for (var o in this.itemList) {
            var s = this.itemList[o]
              , a = n[s.item.typeId].category
              , r = this._filter(s, this.itemsQuantityList[o], a, e, t, i)
              , l = this.slotList[s.objectUID];
            r ? (this.displayedSlotCount += 1,
            l.show()) : (this.unSelectSlot(s.objectUID),
            l.hide())
        }
        this._updatePageSystem(),
        this.enableAveragePrice && this._updateAveragePrice()
    }
    ,
    o.prototype.getDisplayedItemsUIDs = function() {
        var e = []
          , t = this.slotList;
        for (var i in t)
            t[i].isVisible() && e.push(i);
        return e
    }
    ,
    o.prototype._createSlot = function(e) {
        var t = new _({
            itemData: e,
            enableContextMenu: this.enableSlotContext
        });
        t.setQuantity(e.quantity),
        t.setContextMenu("item", this.contextParams);
        var i = this;
        return t.on("tap", function(e) {
            i._selectSlot(t),
            i.currentOpenedWindow.emit("slot-tap", this, e.x, e.y)
        }),
        t.on("doubletap", function(e) {
            i.currentOpenedWindow.emit("slot-doubletap", this, e.x, e.y)
        }),
        t.on("dragStart", function() {
            h.setElementSource(this, i.currentOpenedWindow.id),
            i.currentOpenedWindow.emit("slot-dragStart", t)
        }),
        h.setDraggable(t, {
            backgroundImage: t.getImage()
        }, "storageViewer", i.dragSourceData),
        this.emit("slotCreated", t),
        t
    }
    ;
    var E = {
        none: function(e, t) {
            return t.objectUID - e.objectUID
        },
        name: function(e, t) {
            return t.item.nameId.localeCompare(e.item.nameId)
        },
        level: function(e, t) {
            return t.item.level - e.item.level
        },
        totalWeight: function(e, t) {
            return t.quantity * t.weight - e.quantity * e.weight
        },
        averagePrice: function(e, t) {
            var i = e.item.averagePrice;
            i = i === -1 ? 0 : i;
            var n = t.item.averagePrice;
            return n = n === -1 ? 0 : n,
            n - i
        },
        totalAveragePrice: function(e, t) {
            var i = e.item.averagePrice;
            i = i === -1 ? 0 : i;
            var n = t.item.averagePrice;
            return n = n === -1 ? 0 : n,
            t.quantity * i - e.quantity * n
        },
        category: function(e, t) {
            t.item.type.nameId.localeCompare(e.item.type.nameId)
        }
    };
    o.prototype._positionItem = function(e) {
        for (var t = this.slotsBox.getChildren(), i = this.slotList[e.objectUID], n = this, o = 0, s = t.length; o < s; o += 1)
            if (c(n.sortingCriterias, e, t[o].itemInstance) < 0)
                return void i.insertBefore(t[o]);
        this.slotsBox.appendChild(i)
    }
    ,
    o.prototype._displaySlotPage = function(e) {
        var t = this.currentOpenedWindow && this.currentOpenedWindow._storageViewer;
        if (!t || !t.slotsPerPage)
            return void (this.slotToShow = e);
        this.slotToShow = null ;
        for (var i = this.slotsBox.getChildren(), n = 0, o = 0; o < i.length; o++) {
            var s = i[o];
            if (s.isVisible()) {
                if (s === e)
                    return void this._displayPage(~~(n / t.slotsPerPage));
                n++
            }
        }
    }
    ,
    o.prototype.sortBy = function(e) {
        if (e) {
            this.sortingCriterias = e;
            for (var t = this.itemList, i = Object.keys(t).sort(function(i, n) {
                return c(e, t[i], t[n])
            }), n = 0, o = i.length; n < o; n += 1) {
                var s = this.slotList[i[n]];
                this.slotsBox.appendChild(s)
            }
        }
    }
    ,
    o.prototype.resetDisplay = function() {
        for (var e in this.itemList) {
            var t = this.itemsQuantityList[e] = this.itemList[e].quantity;
            this.slotList[e] && this.slotList[e].setQuantity(t)
        }
        this.filter.reset(),
        this.pageCount = -1,
        this.currentPage = -1,
        this._updatePageSystem(),
        this.selectedSlot && this.unSelectSlot(this.selectedSlot.itemInstance.objectUID)
    }
    ,
    o.prototype.unloadContent = function() {
        this.slotList = {},
        this.slotsBox && this.slotsBox.clearContent(),
        this.itemsQuantityList = {},
        this.itemList = [],
        this.selectedSlot = null ,
        this.contentInitiated = !1
    }
    ,
    o.prototype.setItemList = function(e) {
        this.slotList = {},
        this.slotsBox.clearContent(),
        this.itemsQuantityList = {},
        this.itemList = e,
        this.selectedSlot = null ;
        for (var t in this.itemList) {
            var i = this.itemList[t];
            this.slotList[t] = this._createSlot(i),
            this.itemsQuantityList[t] = i.quantity
        }
        this.filterList(),
        this._updateFilter(),
        this.filter.reset(),
        this.sortBy(this.sortingCriterias)
    }
    ,
    o.prototype.modifyItem = function(e) {
        if (this.contentInitiated) {
            var t = e.objectUID
              , i = this.slotList[t];
            i && (this.unSelectSlot(t),
            i.destroy()),
            this.slotList[t] = this._createSlot(e),
            this.itemList[t] = e,
            this.itemsQuantityList[t] = e.quantity,
            this._positionItem(e),
            this._filterItem(e),
            this.currentOpenedWindow && this.currentOpenedWindow.emit("itemModified", e)
        }
    }
    ,
    o.prototype.moveItem = function(e) {
        this.contentInitiated && (this._filterItem(e),
        this._updateFilter(),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("itemMoved", e))
    }
    ,
    o.prototype.setItemQuantity = function(e, t) {
        if (this.contentInitiated) {
            var i = this.slotList[e];
            if (!i)
                return console.warn("StorageViewer.setItemQuantity: no slot with item UID " + e);
            i.setQuantity(t),
            this.itemsQuantityList[e] = t,
            this._filterItem(this.itemList[e]),
            this._updateFilter(),
            this.currentOpenedWindow && this.currentOpenedWindow.emit("itemQuantity", this.itemList[e], t)
        }
    }
    ,
    o.prototype.setItemsQuantity = function(e) {
        if (this.contentInitiated) {
            for (var t in e) {
                var i = this.slotList[t]
                  , n = e[t];
                i.setQuantity(n),
                this.itemsQuantityList[t] = n,
                this._filterItem(this.itemList[t])
            }
            this._updateFilter(),
            this.currentOpenedWindow && this.currentOpenedWindow.emit("itemsQuantity", e)
        }
    }
    ,
    o.prototype.resetItemQuantity = function(e) {
        var t = this.itemList[e];
        t && this.setItemQuantity(e, t.quantity)
    }
    ,
    o.prototype.resetItemsQuantity = function() {
        for (var e in this.itemList)
            this.resetItemQuantity(e)
    }
    ,
    o.prototype._addItem = function(e) {
        var t = e.objectUID
          , i = this.slotList[t];
        i && (this.unSelectSlot(t),
        i.destroy()),
        i = this.slotList[t] = this._createSlot(e),
        i.hide(),
        this.itemList[t] = e,
        this.itemsQuantityList[t] = e.quantity
    }
    ,
    o.prototype.addItem = function(e) {
        this.contentInitiated && (this._addItem(e),
        this._filterItem(e),
        this._positionItem(e),
        this._updateFilter(),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("itemAdded", e))
    }
    ,
    o.prototype.addItems = function(e) {
        if (this.contentInitiated) {
            for (var t in e) {
                var i = e[t];
                this._addItem(i),
                this._filterItem(i),
                this._positionItem(i)
            }
            this._updateFilter(),
            this.currentOpenedWindow && this.currentOpenedWindow.emit("itemsAdded", e)
        }
    }
    ,
    o.prototype._removeItem = function(e) {
        var t = this.slotList[e];
        this.unSelectSlot(t.itemInstance.objectUID),
        t.destroy(),
        delete this.slotList[e],
        delete this.itemList[e],
        delete this.itemsQuantityList[e]
    }
    ,
    o.prototype.removeItems = function(e) {
        if (this.contentInitiated) {
            for (var t = 0, i = e.length; t < i; t += 1)
                this._removeItem(e[t]);
            this._updateFilter(),
            this.currentOpenedWindow && this.currentOpenedWindow.emit("itemsRemoved", e),
            this._updateAveragePrice()
        }
    }
    ,
    o.prototype.removeItem = function(e) {
        this.contentInitiated && (this._removeItem(e),
        this._updateFilter(),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("itemRemoved", e),
        this._updateAveragePrice())
    }
    ,
    o.prototype.setPodProgressBarValue = function(e) {
        this.progressBar.setValue(e),
        this.progressBar.toggleClassName("green", e < .75),
        this.progressBar.toggleClassName("yellow", e >= .75 && e < .9),
        this.progressBar.toggleClassName("orange", e >= .9 && e < 1),
        this.progressBar.toggleClassName("red", e >= 1)
    }
    ,
    o.prototype.setMaxWeight = function(e) {
        this.maxWeight = e || 1,
        this.contentInitiated && (this.setPodProgressBarValue(this.weight / this.maxWeight),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("weightUpdated", this.weight, this.maxWeight))
    }
    ,
    o.prototype.setWeight = function(e, t) {
        this.weight = e,
        this.maxWeight = t || this.maxWeight,
        this.contentInitiated && (this.setPodProgressBarValue(this.weight / this.maxWeight),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("weightUpdated", e, this.maxWeight))
    }
    ,
    o.prototype.setKamas = function(e) {
        this.contentInitiated && (this.kamasValue = e,
        this.kamas.setText(m.intToString(e)),
        this.currentOpenedWindow && this.currentOpenedWindow.emit("kamasUpdated", e))
    }
    ,
    o.prototype.selectAndShowSlotByGID = function(e) {
        for (var t in this.slotList) {
            var i = this.itemList[t];
            if (i.getProperty("id") === e && this._selectSlotAndDisplayPage(this.slotList[t]))
                return i
        }
        return null
    }
    ,
    o.prototype.selectAndShowSlotByUID = function(e) {
        var t = this.slotList[e];
        return t && this._selectSlotAndDisplayPage(t) ? t.itemInstance : null
    }
    ,
    o.prototype._selectSlotAndDisplayPage = function(e) {
        return !!e.isVisible() && (this._selectSlot(e),
        this._displaySlotPage(e),
        !0)
    }
    ,
    o.prototype._selectSlot = function(e) {
        if (this.selectedSlot) {
            if (this.selectedSlot === e)
                return;
            this.selectedSlot.select(!1)
        }
        e && (e.select(),
        this.selectedSlot = e)
    }
    ,
    o.prototype.unSelectSlot = function(e) {
        if (void 0 === e)
            return void (this.selectedSlot && (this.selectedSlot.select(!1),
            this.selectedSlot = null ));
        var t = this.slotList[e];
        this.selectedSlot === t && (t.select(!1),
        this.selectedSlot = null )
    }
    ,
    o.prototype.toggleSlotSelection = function(e) {
        var t = this.slotList[e];
        this.selectedSlot !== t ? (this.selectedSlot && this.selectedSlot.select(!1),
        t.select(),
        this.selectedSlot = t) : (t.select(!1),
        this.selectedSlot = null )
    }
    ,
    o.prototype._setupEvents = function(e) {
        var t = this;
        e.on("listUpdate", function(e) {
            t.currentOpenedWindow ? t.setItemList(e) : t.listUpdateRequested = e
        }),
        e.on("unloaded", function() {
            t.unloadContent()
        }),
        e.on("itemAdded", function(e) {
            t.addItem(e)
        }),
        e.on("itemsAdded", function(e) {
            t.addItems(e)
        }),
        e.on("itemDeleted", function(e) {
            t.removeItem(e)
        }),
        e.on("itemsDeleted", function(e) {
            t.removeItems(e)
        }),
        e.on("itemModified", function(e) {
            t.modifyItem(e)
        }),
        e.on("itemMoved", function(e) {
            t.moveItem(e)
        }),
        e.on("itemQuantity", function(e, i) {
            t.setItemQuantity(e, i)
        }),
        e.on("itemsQuantity", function(e) {
            t.setItemsQuantity(e)
        }),
        e.on("kamasUpdated", function(e) {
            t.setKamas(e)
        }),
        e.on("weightUpdated", function(e, i) {
            t.setWeight(e, i)
        }),
        e.on("sort", function(e) {
            t.sortBy(e)
        })
    }
    ,
    o.prototype.getDisplayedQuantity = function(e) {
        return this.itemsQuantityList[e]
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            var e = R.setSlotsBox.selectedSlot;
            t(!e.preset),
            e.preset ? (R.deleteSetButton.enable(),
            R.saveSetButton.enable()) : (R.deleteSetButton.disable(),
            R.saveSetButton.disable());
            var i = window.gui.playerData.inventory.presets;
            Object.keys(i).length >= g ? R.addSetButton.disable() : R.addSetButton.enable()
        }
        function t(e) {
            R.explanationPanel.toggleDisplay(e),
            R.setItemSlotsBox.toggleDisplay(!e),
            R.buttonsBox.toggleDisplay(!e)
        }
        function i(e) {
            function t(t) {
                if ("remove" === t) {
                    var n = R.setSlotsBox.selectedSlot.preset.presetId
                      , o = i.nameId || i.item.nameId;
                    A(o, n, function(t) {
                        t === f.YES ? R.saveCustom = !0 : e.setItem(i)
                    })
                }
            }
            var i = e.itemInstance || e.dbItem;
            e.setContextMenu("preset", {
                slot: e,
                canRemove: !0,
                onClose: t
            })
        }
        function n(t) {
            t.select();
            var i;
            R.setSlotsBox.getChild(t.getWuiName()) ? (i = R.setSlotsBox,
            R._displaySet(t.preset)) : R.setItemSlotsBox.getChild(t.getWuiName()) ? (i = R.setItemSlotsBox,
            R.emit("setItemSlotTapped", t)) : i = R.setIconsBox,
            i.selectedSlot && t !== i.selectedSlot && i.selectedSlot.select(!1),
            i.selectedSlot = t,
            i === R.setSlotsBox && e()
        }
        function c(e) {
            e.preset && (window.dofus.sendMessage("InventoryPresetUseMessage", {
                presetId: e.preset.presetId
            }),
            R.addClassNames("spinner"))
        }
        function d(e) {
            e.on("tap", function() {
                n(this)
            })
        }
        function p(e) {
            e.on("doubletap", function() {
                c(this)
            })
        }
        function b(e) {
            e.on("setData", function() {
                i(this)
            })
        }
        function C() {
            for (var e = 0; e < g; e += 1) {
                var t = R.setSlotsBox.appendChild(new u({
                    name: "setSlot" + e
                }));
                d(t),
                p(t),
                t.dragUI = {
                    width: y,
                    height: y,
                    onDragClassName: "slot"
                },
                r.setDraggable(t, t.dragUI, "presets", {
                    type: w
                })
            }
        }
        function I() {
            for (var e = 0; e < _; e += 1) {
                var t = R.setItemSlotsBox.appendChild(new h({
                    name: "setItemSlot" + e,
                    errorIcon: !0
                }));
                t.addClassNames("pos" + e),
                d(t),
                b(t)
            }
        }
        function T() {
            R.setIconsBox.addClassNames("spinner");
            for (var e = [], t = 0; t < v; t += 1) {
                e.push("gfx/presets/small_" + t + ".png");
                var i = R.setIconsBox.appendChild(new u({
                    name: "setIconSlot" + t
                }));
                d(i)
            }
            s.preloadImages(e, function(e) {
                for (var t = 0; t < e.length; t += 1) {
                    var i = R.setIconsBox.getChild("setIconSlot" + t);
                    i.setImage(e[t])
                }
                R.setIconsBox.delClassNames("spinner")
            })
        }
        function S(e, t) {
            window.gui.openConfirmPopup({
                title: l("ui.popup.warning"),
                message: l("ui.preset.warningDelete", e + 1),
                cb: t
            })
        }
        function A(e, t, i) {
            window.gui.openConfirmPopup({
                title: l("ui.popup.warning"),
                message: l("ui.preset.warningItemDelete", e, t + 1),
                cb: i
            })
        }
        function E() {
            R.addSetButton.on("tap", function() {
                this.disable(),
                R._addSet()
            }),
            R.importSetButton.on("tap", function() {
                R._importSet()
            }),
            o(R.importSetButton, l("ui.preset.importCurrentStuff")),
            R.deleteSetButton.on("tap", function() {
                var e = R.deleteSetButton;
                e.disable();
                var t = R.setSlotsBox.selectedSlot && R.setSlotsBox.selectedSlot.preset;
                return t ? void S(t.presetId, function(i) {
                    i === f.YES ? (window.dofus.sendMessage("InventoryPresetDeleteMessage", {
                        presetId: t.presetId
                    }),
                    R.addClassNames("spinner")) : e.enable()
                }) : e.enable()
            }),
            o(R.deleteSetButton, l("ui.preset.delete")),
            R.chooseIconButton.on("tap", function() {
                R._confirmIconPopup(function(e) {
                    e === f.YES && R._saveSet()
                })
            }),
            R.saveSetButton.on("tap", function() {
                this.disable(),
                R._saveSet()
            })
        }
        function x() {
            for (var e = R.setSlotsBox.getChildren(), t = 0; t < e.length; t += 1) {
                var i = e[t];
                i.preset && R._deleteSet(i.preset.presetId)
            }
            var n = window.gui.playerData.inventory.presets || {};
            for (var o in n)
                R._updateSetSlot(o);
            e[0].emit("tap")
        }
        function M(e) {
            var t = {
                usePartial: l("ui.preset.error.usePartial"),
                badObjectId: l("ui.preset.error.badObjectId"),
                tooMany: l("ui.preset.error.tooMany"),
                criterion: l("ui.preset.error.criterion"),
                badId: l("ui.preset.error.badId"),
                badPosition: l("ui.preset.error.badPosition"),
                unknown: l("ui.common.unknownFail")
            };
            window.gui.openSimplePopup(t[e])
        }
        function N() {
            R.displayedPreset && R.displayedPreset.mount && R._displaySet(R.displayedPreset)
        }
        m.call(this, "div", {
            className: "PresetsBox"
        });
        var R = this;
        this.displayedItems = {},
        this.setSlotsBox = this.createChild("div", {
            className: "setSlotsBox"
        }),
        this.addSetButton = this.appendChild(new a(l("ui.common.new"),{
            className: ["addSetButton"]
        })),
        this.setItemSlotsBox = this.createChild("div", {
            className: "setItemSlotsBox"
        }),
        this.setIconsBox = this.createChild("div", {
            className: "setIconsBox"
        });
        var O = this.createChild("div", {
            className: "buttonsBox"
        });
        this.importSetButton = O.appendChild(new a("",{
            className: ["importSetButton"]
        })),
        this.importSetButton.createChild("div", {
            className: "icon"
        }),
        this.deleteSetButton = O.appendChild(new a("",{
            className: ["deleteSetButton"]
        })),
        this.deleteSetButton.createChild("div", {
            className: "icon"
        }),
        this.chooseIconButton = O.appendChild(new a("!",{
            className: ["chooseIconButton"]
        })),
        this.chooseIconButton.createChild("div", {
            className: "icon"
        }),
        this.saveSetButton = O.appendChild(new a(l("ui.common.save"),{
            className: ["saveSetButton"]
        })),
        this.buttonsBox = O,
        this.createChild("div", {
            className: "overlay"
        }),
        this.explanationPanel = this.createChild("div", {
            className: "explanationPanel"
        }),
        this.explanationPanel.createChild("div", {
            className: "instruction",
            text: l("ui.preset.howToUse")
        }),
        C(),
        I(),
        T(),
        E(),
        x();
        var P = window.gui.playerData
          , D = P.inventory;
        D.on("listUpdate", function() {
            x()
        }),
        D.on("presetSaved", function(t, i) {
            if (R.delClassNames("spinner"),
            i)
                return e(),
                M(i)
        }),
        D.on("presetDeleted", function(t, i) {
            return R.delClassNames("spinner"),
            i ? (e(),
            M(i)) : (R._deleteSet(t),
            void e())
        }),
        D.on("presetUpdated", function(t, i) {
            return i ? M(i) : (R._updateSetSlot(t),
            void e())
        }),
        D.on("presetItemUpdated", function(e) {
            R._updateSetSlot(e)
        }),
        D.on("presetItemUpdateError", M),
        D.on("presetUsed", function(e, t) {
            if (R.delClassNames("spinner"),
            t)
                return M(t);
            var i = D.presets[e]
              , n = P.equippedMount && i.mount && !P.isRiding;
            n && window.gui.textNotification.add(l("tablet.mount.cannotRide"))
        }),
        P.on("setMount", N),
        P.on("unsetMount", N)
    }
    i(640);
    var o = i(206).addTooltip
      , s = i(5)
      , a = i(204).DofusButton
      , r = i(186)
      , l = i(35).getText
      , c = i(323)
      , u = i(569)
      , h = i(567)
      , d = i(26)
      , p = i(22)
      , m = i(190)
      , f = i(641).actionsEnum
      , g = 8
      , _ = 16
      , v = 27
      , y = 40
      , w = i(565).GENERAL_SHORTCUT_BAR
      , b = c.positions.pets
      , C = 3;
    d.inherits(n, m),
    e.exports = n,
    n.prototype._getItemPosMap = function(e) {
        if (e) {
            for (var t = e.objects || e, i = window.gui.playerData.inventory, n = {}, o = 0; o < t.length; o += 1) {
                var s, a = t[o].objUid || t[o].objectUID, r = t[o].position;
                if (a)
                    s = i.objects[a];
                else {
                    var l = t[o].objGid;
                    s = c.items[l]
                }
                n[r] = s
            }
            return n
        }
    }
    ,
    n.prototype._updateSetSlot = function(e) {
        var t = window.gui.playerData.inventory.presets[e]
          , i = this.setSlotsBox.getChild("setSlot" + t.presetId);
        i.preset = t,
        s.preloadImage("gfx/presets/icon_" + t.symbolId + ".png", function(e) {
            i.setImage(e),
            i.dragUI.backgroundImage = i.getImage(),
            r.enableDrag(i)
        });
        var n = this.setIconsBox.getChild("setIconSlot" + t.symbolId);
        n.preset = t;
        var o = this.setSlotsBox.selectedSlot && this.setSlotsBox.selectedSlot.preset;
        o && o.presetId === t.presetId && this._displaySet(t)
    }
    ,
    n.prototype._getIsItemUnavailable = function(e) {
        if (!e)
            return !1;
        if (e.mountLocation) {
            var t = window.gui.playerData.equippedMount;
            return !t
        }
        return !e.objectUID || e.conditions && !e.conditions.isRespected()
    }
    ,
    n.prototype._updateSetItemSlots = function(e) {
        function t(e, t) {
            e.setData(t),
            s.preloadImage("gfx/mounts/" + t.model + ".png", function(t) {
                e.setImage(t)
            })
        }
        if (!e)
            return this._resetItemSlots(this.setItemSlotsBox.getChildren());
        for (var i = 0; i < _; i += 1) {
            var n = e[i]
              , o = this.setItemSlotsBox.getChild("setItemSlot" + i);
            o.unset(),
            o.delClassNames("unavailable"),
            n && (n.mountLocation ? t(o, n) : o.setItem(n),
            o.toggleClassName("unavailable", !!this._getIsItemUnavailable(n)))
        }
        var a = this.setItemSlotsBox.selectedSlot;
        a && a.select(!1)
    }
    ,
    n.prototype._resetItemSlots = function(e) {
        for (var t = 0; t < e.length; t += 1)
            e[t].unset()
    }
    ,
    n.prototype._displaySet = function(e) {
        var t = window.gui.playerData
          , i = this._getItemPosMap(e)
          , n = e && e.symbolId;
        if (e)
            n = e.symbolId,
            e.mount && (i[b] = t.equippedMount || {
                model: C,
                mountLocation: "placeholder"
            });
        else {
            var o = this.setIconsBox.getChildren()
              , s = this._getNextAvailableSlot(o);
            n = o.indexOf(s)
        }
        this._updateSetItemSlots(i),
        this.shouldSaveEquipment = !1,
        this.saveCustom = !1,
        this.setIconsBox.getChild("setIconSlot" + n).emit("tap"),
        this.displayedPreset = e
    }
    ,
    n.prototype._deleteSet = function(e) {
        for (var t = this.setSlotsBox.getChildren(), i = 0; i < t.length; i += 1) {
            var n = t[i];
            if (n.preset && n.preset.presetId === e) {
                delete n.preset,
                n.unset(),
                r.disableDrag(n),
                this._resetItemSlots(this.setItemSlotsBox.getChildren());
                break
            }
        }
    }
    ,
    n.prototype._importSet = function() {
        var e = window.gui.playerData
          , t = e.inventory.equippedItems;
        e.isRiding && (t[b] = e.equippedMount),
        this._updateSetItemSlots(t),
        this.shouldSaveEquipment = !0
    }
    ,
    n.prototype._saveSet = function() {
        var e = this
          , t = this.setSlotsBox.getChildren()
          , i = this.setItemSlotsBox.getChildren()
          , n = this.setIconsBox.getChildren()
          , o = this.setSlotsBox.selectedSlot
          , s = this.setIconsBox.selectedSlot;
        if (o.preset) {
            var a = n[o.preset.symbolId];
            delete a.preset
        }
        var r, l;
        if (this.saveCustom) {
            for (var c = [], u = [], h = 0; h < i.length; h += 1) {
                var d = i[h].itemInstance;
                if (d)
                    c.push(d.position),
                    u.push(d.objectUID || d.mountLocation && d.id);
                else {
                    var p = i[h].data;
                    p && p.mountLocation && (c.push(b),
                    u.push(p.id))
                }
            }
            r = {
                presetId: t.indexOf(o),
                symbolId: n.indexOf(s),
                itemsPositions: c,
                itemsUids: u
            },
            l = "InventoryPresetSaveCustomMessage"
        } else
            r = {
                presetId: t.indexOf(o),
                symbolId: n.indexOf(s),
                saveEquipment: this.shouldSaveEquipment
            },
            l = "InventoryPresetSaveMessage";
        window.dofus.sendMessage(l, r),
        e.addClassNames("spinner")
    }
    ,
    n.prototype._getNextAvailableSlot = function(e) {
        for (var t = 0; t < e.length; t += 1) {
            var i = e[t];
            if (!i.preset)
                return i
        }
    }
    ,
    n.prototype._confirmIconPopup = function(e) {
        p.open("presetChooseIcon", this.setIconsBox),
        p.getWindow("presetChooseIcon").once("close", e)
    }
    ,
    n.prototype._addSet = function() {
        var e = this
          , t = this._getNextAvailableSlot(this.setSlotsBox.getChildren());
        if (t) {
            var i = this._getNextAvailableSlot(this.setIconsBox.getChildren());
            t.emit("tap"),
            i.emit("tap"),
            this._confirmIconPopup(function(t) {
                return t !== f.YES ? e.addSetButton.enable() : (e._importSet(),
                void e._saveSet())
            })
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {
            className: "confirmWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 600,
                height: 200,
                isModal: !0
            },
            noCloseButton: !0
        },
        s.call(this, e),
        this._domCreated = !1,
        this.actionsEnum = c;
        var t = this._box = this.windowBody.createChild("div", {
            className: "messageBox"
        });
        this.message = t.createChild("div", {
            className: "message"
        })
    }
    i(642);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = {
        NO: 0,
        YES: 1,
        IGNORE: 2
    };
    o(n, s),
    e.exports = n,
    e.exports.actionsEnum = c,
    n.prototype.createDom = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , i = t.appendChild(new r(l("ui.common.yes")));
        i.on("tap", function() {
            "function" == typeof e.cb && e.cb(c.YES),
            a.close(e.id, {
                keepDialog: e.keepDialog
            })
        });
        var n = t.appendChild(new r(l("ui.common.no")));
        n.on("tap", function() {
            "function" == typeof e.cb && e.cb(c.NO),
            a.close(e.id)
        }),
        this._buttonIgnore = t.appendChild(new r(l("ui.common.ignore"))),
        this._buttonIgnore.on("tap", function() {
            "function" == typeof e.cb && e.cb(c.IGNORE),
            a.close(e.id)
        }),
        this._buttonIgnore.hide(),
        this._domCreated = !0
    }
    ,
    n.prototype.update = function(e, t) {
        this._domCreated || this.createDom(),
        t = t || {},
        this.windowTitle.setText(e.title),
        this.message.setHtml(e.message),
        this.cb = e.cb,
        this.keepDialog = t.keepDialog,
        this._buttonIgnore.toggleDisplay(!!t.ignoreEnable)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        r.call(this, "div", {
            className: "ProgressBar",
            name: e.name
        }),
        this.addClassNames(e.className),
        this.barBg = this.createChild("div", {
            className: "barBg"
        }),
        this.barFill = this.createChild("div", {
            className: "barFill"
        }),
        this.barColor = this.barFill.createChild("div", {
            className: "barColor"
        }),
        this.vertical = e.vertical || !1,
        this.barFill.toggleClassName("vertical", this.vertical),
        e.tooltip && (this.tooltipText = e.tooltip,
        a.addTooltip(this, this._tooltipHandler.bind(this))),
        this.setValue(e.value || 0)
    }
    i(644);
    var o = i(35).getText
      , s = i(26).inherits
      , a = i(206)
      , r = i(190);
    s(n, r),
    e.exports = n,
    n.prototype.setValue = function(e, t, i) {
        this.maxValue = t,
        t ? (this.humanValue = e,
        void 0 !== i ? e = i : e /= t) : this.humanValue = Math.round(100 * e),
        e *= 100;
        var n = 5;
        e < n && e > 0 && (e = n),
        e > 100 - n && e < 100 && (e = 100 - n),
        e = Math.round(e);
        var o = e ? e + "%" : "1px";
        this.barFill.setStyle("-webkit-mask-size", this.vertical ? "100% " + o : o + " 100%"),
        this.barFill.setStyle("-webkit-mask-position", this.vertical ? "0 100%" : "0 0")
    }
    ,
    n.prototype.setRange = function(e, t) {
        var i = t - e
          , n = i ? Math.round(100 * i) + "%" : "1px"
          , o = e ? Math.round(100 * e) + "%" : "1px";
        this.barFill.setStyle("-webkit-mask-size", this.vertical ? "100% " + n : n + " 100%"),
        this.barFill.setStyle("-webkit-mask-position", this.vertical ? "100% " + o : o + " 100%")
    }
    ,
    n.prototype._tooltipHandler = function() {
        var e = this.tooltipText + o("ui.common.colon");
        return this.maxValue ? e + this.humanValue + " / " + this.maxValue : e + this.humanValue + "%"
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            return o[o.length - 1] !== e && e ? (o.push(e),
            void (s = o.length)) : void (s = o.length)
        }
        function t() {
            if (!(s < 1)) {
                s -= 1;
                var e = o[s];
                n.cmdInput.setValue(e)
            }
        }
        function i() {
            if (!(s > o.length - 1)) {
                s += 1;
                var e = o[s] || "";
                n.cmdInput.setValue(e)
            }
        }
        a.call(this, {
            className: "adminConsoleWindow",
            title: "Admin Console",
            positionInfo: {
                left: "c",
                top: "c",
                width: 800,
                height: 500
            }
        });
        var n = this
          , o = []
          , s = 0;
        this.once("open", function() {
            var o = n.windowBody
              , s = o.createChild("div", {
                className: "upDownContainer"
            })
              , a = s.appendChild(new r("Next cmd",{
                className: "upAndDown"
            }));
            a.on("tap", i);
            var c = s.appendChild(new r("Previous cmd",{
                className: "upAndDown"
            }));
            c.on("tap", t);
            var d = o.createChild("form", {
                attr: {
                    action: "#_",
                    method: "post"
                }
            })
              , p = d.createChild("table", {
                className: "cmdInputBar"
            })
              , m = p.createChild("td")
              , f = this.cmdInput = new l({
                className: "cmdInput",
                attr: {
                    id: "cmdInput"
                }
            });
            m.appendChild(f),
            m = p.createChild("td", {
                className: "buttonSend"
            });
            var g = this._buttonSend = m.appendChild(new r(h("ui.social.reportSend")))
              , _ = this._preloadBox = o.createChild("div", {
                className: "preloadBox",
                hidden: !0
            });
            this._preloadPB = _.appendChild(new u({
                className: ["preloadPB", "green"]
            })),
            this._preloadCount = _.createChild("div", {
                className: "preloadCount"
            }),
            this._preloadPercent = _.createChild("div", {
                className: "preloadPercent"
            }),
            this._preloadEstimate = _.createChild("div", {
                className: "preloadEstimate"
            }),
            this.log = o.createChild("div", {
                className: "logBox"
            }),
            g.on("tap", function() {
                var t = f.getValue();
                f.setValue(""),
                n._runCommand(t),
                e(t)
            }),
            f.rootElement.addEventListener("keydown", function(e) {
                if (e) {
                    var n = e.keyCode;
                    40 === n ? (e.preventDefault(),
                    i()) : 38 === n && (e.preventDefault(),
                    t())
                }
            }),
            d.rootElement.addEventListener("submit", function(e) {
                e.preventDefault(),
                g.emit("tap")
            })
        }),
        this.on("focus", function() {
            window.setTimeout(function() {
                n.cmdInput.focus()
            }, 100)
        }),
        this.on("close", function() {
            d.hide()
        }),
        this.on("opened", function() {
            n.cmdInput.focus()
        }),
        window.gui.on("ConsoleCommandsListMessage", function(e) {
            n.helpInfo = e
        }),
        window.gui.on("ConsoleMessage", function(e) {
            return n.log ? void n.logMessage(e.content, g[e.type]) : console.warn(e.content)
        }),
        window.gui.on("DebugInClientMessage", function(e) {
            n.log && n.logMessage(e.message, _[e.level]),
            e.level >= v ? console.warn(e.message) : console.log(e.message)
        }),
        f.on("step", function(e) {
            e = e || {};
            var t = e.percent;
            n._preloadPB.setValue(t),
            n._preloadCount.setText(e.count + "/" + e.nbTotalMaps),
            n._preloadPercent.setText(~~(100 * t) + "%"),
            n._preloadEstimate.setText(e.secondLeft < 0 ? 0 : e.secondLeft + "s")
        }),
        f.on("error", function(e) {
            n.cmdInput.enable(),
            n._buttonSend.enable(),
            n._preloadBox.hide(),
            console.error(e)
        }),
        f.on("end", function(e) {
            n.cmdInput.enable(),
            n._buttonSend.enable(),
            n._preloadBox.hide(),
            n.logMessage("Finished preloading of " + e.area + " in " + e.elapsedSecond + "s")
        })
    }
    i(646);
    var o = i(435)
      , s = i(26).inherits
      , a = i(402)
      , r = i(204).DofusButton
      , l = i(391)
      , c = i(647)
      , u = i(643)
      , h = i(35).getText
      , d = i(301)
      , p = i(607)
      , m = 400
      , f = new c
      , g = ["Info", "Warn", "Error"]
      , _ = ["Debug", "Debug", "Info", "Warn", "Error", "Fatal"]
      , v = 3;
    s(n, a),
    e.exports = n,
    n.prototype.logMessage = function(e, t) {
        this.log.getChildCount() > m && this.log.clearContent();
        var i = "message" + (t || "Info")
          , n = this.log.createChild("div", {
            className: i
        });
        e = e.replace(/\n/g, "<br>"),
        n.setHtml(e)
    }
    ,
    n.prototype._runCommand = function(e) {
        if (e = e.trim(),
        this.log.clearContent(),
        this.logMessage(e, "Command"),
        "help" === e || "" === e)
            return this.logMessage("\n" + this.helpInfo.descriptions.join(""), "Debug");
        var t = e.split(" ");
        if (window.gui.playerData.isAdmin()) {
            var i;
            if ("preload" === t[0])
                return t.shift(),
                this.cmdInput.disable(),
                this._buttonSend.disable(),
                this._preloadBox.show(),
                this._preloadPB.setValue(0),
                f.preloadArea(t[0]);
            if ("joris" === t[0])
                return t.shift(),
                i = p.adminCommand(t),
                this.logMessage(i, "Debug");
            if ("tutorial" === t[0])
                return t.shift(),
                i = window.gui.tutorialManager.adminCommand(t),
                this.logMessage(i, "Debug");
            if ("autotest" === t[0] && o.run)
                return t.shift(),
                o.run(t.join(" "));
            if ("gridcolor" === t[0])
                return t.shift(),
                4 !== t.length ? this.logMessage("4 arguments required: gridcolor [red] [green] [blue] [alpha]", "Debug") : t[0] > 1 ? this.logMessage("Red   component has to be in range [0, 1]", "Debug") : t[1] > 1 ? this.logMessage("Green component has to be in range [0, 1]", "Debug") : t[2] > 1 ? this.logMessage("Blue  component has to be in range [0, 1]", "Debug") : t[3] > 1 ? this.logMessage("Alpha has to be in range [0, 1]", "Debug") : (window.isoEngine.background.setGridColor(t),
                this.logMessage("Grid color changed!", "Debug"))
        }
        window.dofus.sendMessage("AdminCommandMessage", {
            content: e
        })
    }
    ,
    n.prototype.runCommand = function(e) {
        window.dofus.sendMessage("AdminQuietCommandMessage", {
            content: e
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this),
        this._INCARNAM_AREA_ID = 45
    }
    function o(e, t) {
        var i = d + e + ".json";
        c.loadJson(i, function(i) {
            var n = [p + e + ".jpg"];
            i.foreground && n.push(m + e + ".jpg");
            for (var o = i.midgroundLayer, s = Object.keys(o), a = 0; a < s.length; a++)
                for (var r = s[a], l = o[r], u = 0; u < l.length; u++) {
                    var d = l[u]
                      , f = d.g;
                    if (f) {
                        var g = d.jpg ? "jpg" : "png"
                          , _ = g + "/" + f + "." + g;
                        n.push(h + _)
                    }
                }
            c.preloadAssets(n, !1, null , function(e) {
                t(null , e)
            })
        })
    }
    var s = i(12)
      , a = i(26).inherits
      , r = i(16).EventEmitter
      , l = i(36)
      , c = i(5)
      , u = i(6)
      , h = u.IMG_PATH
      , d = u.MAP_PATH
      , p = u.BACKGROUND_PATH
      , m = u.FOREGROUND_PATH;
    a(n, r),
    e.exports = n,
    n.prototype._onError = function(e) {
        this.emit("error", e)
    }
    ,
    n.prototype._onEnd = function(e) {
        this.emit("end", e)
    }
    ,
    n.prototype._secondLeft = function(e, t) {
        var i = Date.now()
          , n = ~~((i - t) / 1e3)
          , o = ~~(n / e);
        return o - n
    }
    ,
    n.prototype.preloadArea = function(e) {
        e = e || "";
        var t = this
          , i = 0;
        return "incarnam" === e.toLowerCase() && (i = this._INCARNAM_AREA_ID),
        i ? void l.getAllDataMap("SubAreas", function(n, a) {
            if (n)
                return t._onError(n);
            var r = [];
            for (var l in a)
                if (a.hasOwnProperty(l)) {
                    var c = a[l]
                      , u = c.mapIds || [];
                    if (c.areaId !== i)
                        continue;
                    r = r.concat(u)
                }
            var h = r.length
              , d = 0
              , p = Date.now();
            return s.forEachSeries(r, function(e, i) {
                return o(e, function(e) {
                    if (e)
                        return t._onError(e),
                        i(e);
                    var n = Math.round(d / h * 100) / 100
                      , o = t._secondLeft(n, p);
                    return d++,
                    t.emit("step", {
                        count: d,
                        nbTotalMaps: h,
                        percent: n,
                        secondLeft: o
                    }),
                    i()
                })
            }, function(i) {
                return i ? t._onError(i) : t._onEnd({
                    area: e,
                    elapsedSecond: ~~((Date.now() - p) / 1e3)
                })
            })
        }) : this._onError("noArea")
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "ArenaWindow",
            title: l("ui.common.koliseum"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 500
            }
        }),
        this.mustReload = !0,
        this.on("open", function() {
            this.statusTitle || (this.createContent(),
            this.setupListeners()),
            this.mustReload && this.reloadPartyData()
        })
    }
    i(649);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204).DofusButton
      , r = i(485)
      , l = i(35).getText
      , c = i(412)
      , u = i(540)
      , h = i(650);
    o(n, s),
    e.exports = n,
    n.prototype.createContent = function() {
        this.messageContainerSetup(),
        this.tableSetup(),
        this.informationSetup(),
        this.buttonsSetup()
    }
    ,
    n.prototype.messageContainerSetup = function() {
        var e = this.windowBody.createChild("div", {
            className: "wrapper",
            name: "status"
        });
        this.statusTitle = e.createChild("div", {
            className: "title"
        }),
        this.statusText = e.createChild("div", {
            className: "text"
        })
    }
    ,
    n.prototype.tableSetup = function() {
        this.table = this.windowBody.appendChild(new r({
            colIds: ["icon", "name", "status"],
            headerContent: ["", l("ui.common.team")],
            minRows: 3,
            defaultRowContent: ["", l("ui.common.randomCharacter")]
        }))
    }
    ,
    n.prototype.informationSetup = function() {
        var e = this.windowBody.createChild("div", {
            className: "wrapper",
            name: "informations"
        });
        e.createChild("div", {
            className: "title",
            text: l("ui.common.myInformations")
        }),
        e.createChild("div", {
            className: "text",
            name: "currentRating"
        }),
        e.createChild("div", {
            className: "text",
            name: "dailyRating"
        }),
        e.createChild("div", {
            className: "text",
            name: "maxRating"
        }),
        e.createChild("div", {
            className: "text",
            name: "fightsWon"
        })
    }
    ,
    n.prototype.registerInArena = function() {
        window.dofus.sendMessage("GameRolePlayArenaRegisterMessage", {
            battleMode: h.ARENA_TYPE_3VS3
        })
    }
    ,
    n.prototype.buttonsSetup = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: "buttons"
        });
        this.unregisterBtn = t.appendChild(new a(l("ui.teamSearch.unregistration"))),
        this.registerBtn = t.appendChild(new a(l("ui.teamSearch.registration"))),
        this.leaveArenaBtn = t.appendChild(new a(l("ui.party.arenaQuit"))),
        this.registerBtn.on("tap", function() {
            e.registerInArena()
        }),
        this.unregisterBtn.on("tap", function() {
            window.dofus.sendMessage("GameRolePlayArenaUnregisterMessage")
        }),
        this.leaveArenaBtn.on("tap", function() {
            window.dofus.sendMessage("PartyLeaveRequestMessage", {
                partyId: e.partyId
            })
        })
    }
    ,
    n.prototype.setLeaderRow = function(e, t) {
        e.getChild("icon").toggleClassName("leaderIcon", t)
    }
    ,
    n.prototype.addMemberRow = function(e, t) {
        var i = this.table.addRow({
            name: e
        }, {
            id: t
        });
        return t === this.leaderId && this.setLeaderRow(i, !0),
        this.memberCount++,
        i
    }
    ,
    n.prototype.addThisPlayerRow = function() {
        var e = window.gui.playerData
          , t = e.characterBaseInformations.name;
        return this.addMemberRow(t, e.id)
    }
    ,
    n.prototype.findMemberRow = function(e) {
        if (!e)
            return -1;
        for (var t = this.table.getRows(), i = 0; i < t.length; i++)
            if (t[i].id === e)
                return i;
        return -1
    }
    ,
    n.prototype.removeMemberRow = function(e) {
        var t = this.findMemberRow(e);
        return t === -1 ? console.warn("Cannot remove unknown arena member #" + e) : (this.table.delRow(t),
        void this.memberCount--)
    }
    ,
    n.prototype.enableOrDisableLeaveArenaButton = function() {
        this.partyId ? this.leaveArenaBtn.enable() : this.leaveArenaBtn.disable()
    }
    ,
    n.prototype.enableOrDisableRegisterButton = function() {
        this.isLeader || !this.leaderId ? (this.registerBtn.enable(),
        this.unregisterBtn.enable()) : (this.registerBtn.disable(),
        this.unregisterBtn.disable())
    }
    ,
    n.prototype.showOrHideRegisterButton = function(e) {
        e.arenaRegistered ? (this.registerBtn.hide(),
        this.unregisterBtn.show()) : (this.registerBtn.show(),
        this.unregisterBtn.hide())
    }
    ,
    n.prototype.setNewLeader = function(e) {
        var t = this.findMemberRow(this.leaderId);
        t >= 0 && this.setLeaderRow(this.table.getRow(t), !1),
        t = this.findMemberRow(e),
        t >= 0 && this.setLeaderRow(this.table.getRow(t), !0),
        this.leaderId = e,
        this.isLeader = e === window.gui.playerData.id,
        this.enableOrDisableRegisterButton()
    }
    ,
    n.prototype.updateArenaStats = function(e) {
        var t = e.arenaStats
          , i = this.windowBody.getChild("informations");
        i.getChild("currentRating").setText(l("ui.party.arenaRank", t.rank)),
        i.getChild("dailyRating").setText(l("ui.party.arenaRankMaxToday", t.bestDailyRank)),
        i.getChild("maxRating").setText(l("ui.party.arenaRankMax", t.bestRank)),
        i.getChild("fightsWon").setText(l("ui.party.arenaFightsOfTheDay", t.victoryCount, t.arenaFightCount))
    }
    ,
    n.prototype.reloadPartyData = function() {
        this.mustReload = !1;
        var e = window.gui.playerData.partyData;
        this.updateArenaStats(e),
        this.updatePartyData(e),
        this.updateRegistrationStatus(e)
    }
    ,
    n.prototype.updatePartyData = function(e) {
        var t = e.partyTypes[c.PARTY_TYPE_ARENA];
        this.setNewLeader(t.leaderId),
        this.partyId = t.id;
        var i = t.members;
        this.memberCount = 0,
        this.table.clearContent(),
        this.isLeader && this.addThisPlayerRow();
        for (var n in i)
            this.addMemberRow(i[n].name, ~~n);
        this.isLeader || this.addThisPlayerRow()
    }
    ;
    var d = ["ui.party.arenaInfoSearch", "ui.party.arenaInfoWaiting", "ui.party.arenaInfoFighting", "ui.party.arenaInfoInvite"]
      , p = l;
    n.prototype.getStepText = function(e, t) {
        return p(d[e], t)
    }
    ,
    n.prototype.updateRegistrationStatus = function(e) {
        var t = e.arenaStep;
        switch (this.statusTitle.setText(l("ui.common.step", (t + 1) % 4 + 1, 4)),
        this.statusText.setText(this.getStepText(t, 0)),
        this.showOrHideRegisterButton(e),
        t) {
        case u.ARENA_STEP_REGISTRED:
            this.enableOrDisableLeaveArenaButton();
            break;
        case u.ARENA_STEP_WAITING_FIGHT:
        case u.ARENA_STEP_STARTING_FIGHT:
            this.leaveArenaBtn.disable(),
            this.registerBtn.disable();
            break;
        case u.ARENA_STEP_UNREGISTER:
            this.enableOrDisableLeaveArenaButton(),
            this.enableOrDisableRegisterButton();
            break;
        default:
            console.error("Unknown arena step #" + t)
        }
    }
    ,
    n.prototype.onFightEnd = function() {
        if (this.enableOrDisableLeaveArenaButton(),
        this.isLeader) {
            this.registerBtn.enable();
            var e = this;
            window.gui.openConfirmPopup({
                title: l("ui.common.confirm"),
                message: l("ui.party.arenaPopupReinscription"),
                cb: function(t) {
                    t && e.registerInArena()
                }
            })
        }
    }
    ,
    n.prototype.setupListeners = function() {
        var e = this
          , t = window.gui.playerData.partyData;
        window.gui.on("disconnect", function() {
            e.mustReload = !0
        }),
        t.on("arenaRegistrationStatus", function() {
            e.updateRegistrationStatus(t)
        }),
        t.on("arenaFightEnd", function() {
            e.onFightEnd()
        }),
        t.on("arenaStatsUpdated", function() {
            e.updateArenaStats(t)
        }),
        t.on("arenaJoined", function() {
            e.updatePartyData(t)
        }),
        t.on("arenaNewMember", function(t) {
            return e.findMemberRow(t.id) >= 0 ? console.error("Dupe arena member #" + t.name) : void e.addMemberRow(t.name, t.id)
        }),
        t.on("arenaMemberLeft", function(t) {
            e.removeMemberRow(t)
        }),
        t.on("arenaLeft", function() {
            e.reloadPartyData()
        }),
        t.on("arenaLeaderUpdate", function(t) {
            e.setNewLeader(t)
        }),
        t.on("arenaFighterReady", function(t) {
            e.statusText.setText(e.getStepText(1, t))
        })
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        ARENA_TYPE_3VS3: 3,
        ARENA_TYPE_5VS5: 5
    }
}
, function(e, t, i) {
    function n() {
        p.call(this, {
            title: s("ui.charcrea.more"),
            className: "BreedDetailWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 912,
                height: "90%",
                maxHeight: 683,
                isModal: !0,
                isFullScreen: !0
            }
        }),
        this.loadedSpells = {},
        this.favSpells = [],
        this.on("open", this._initialize)
    }
    function o() {
        d.showNotification(s("tablet.common.longTapForTooltip"), this)
    }
    i(652);
    var s = i(35).getText
      , a = i(26).inherits
      , r = i(302)
      , l = i(210).showProgressively
      , c = i(576)
      , u = i(281)
      , h = i(574)
      , d = i(206)
      , p = i(402)
      , m = [[], [10, 7, 3], [34, 31, 27], [60, 58, 50], [72, 80, 67], [88, 81, 95], [105, 101, 109], [126, 130, 140], [142, 159, 153], [179, 168, 174], [191, 190, 186], [434, 446, 431], [686, 705, 696], [2778, 2806, 2810], [2890, 2897, 2872], [3212, 3211, 3218]]
      , f = {
        spellTooltipAll: !0
    }
      , g = {
        visibilityOptions: {
            spellTooltipName: !0,
            spellTooltipDescription: !0
        }
    };
    a(n, p),
    e.exports = n,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this.loadedSpells = {},
        this.favSpells = []
    }
    ,
    n.prototype._initialize = function(e) {
        this.breedData = e.breedData,
        this._createContent(this.windowBody),
        this._updateBreedDescription(),
        this._updateSpells()
    }
    ,
    n.prototype._createContent = function(e) {
        var t = this.scroller = e.appendChild(new r({},{
            showHintArrows: !0
        }))
          , i = t.content;
        this.breedDescription = i.createChild("div", {
            className: "breedDescription",
            hidden: !0
        });
        var n = this.breedDescription.createChild("div", {
            className: "descriptionZone"
        })
          , o = n.createChild("div", {
            className: "descriptionText"
        });
        this.breedName = o.createChild("div", {
            className: "breedName",
            text: "."
        }),
        this.breedName.setText(""),
        this.breedStory = o.createChild("div", {
            className: "breedStory"
        });
        var a = this.favoriteSpells = i.createChild("div", {
            className: "favSpells",
            hidden: !0
        });
        a.createChild("div", {
            className: "title",
            text: s("tablet.charCrea.popularSpells")
        });
        for (var l = m[this.breedData.id] || [], c = 0; c < l.length; c++) {
            var u = this.favSpells[c] = a.createChild("div", {
                className: "spell",
                hidden: !0
            });
            u.spellId = l[c]
        }
        var h = this.allSpells = i.createChild("div", {
            className: "spells",
            hidden: !0
        });
        h.createChild("div", {
            className: "title",
            text: s("tablet.charCrea.allSpells")
        }),
        this.spellsContainer = h.createChild("div", {
            className: "spellsContainer"
        })
    }
    ,
    n.prototype._appearWhenReady = function() {
        l(this.breedDescription),
        l(this.favoriteSpells),
        l(this.allSpells),
        this.scroller.refresh(),
        this.scroller.notify()
    }
    ,
    n.prototype._updateBreedDescription = function() {
        var e = this.breedData;
        this.breedName.setText(e.longNameId),
        this.breedStory.setText(e.descriptionId)
    }
    ,
    n.prototype._updateSpells = function() {
        this.windowBody.addClassNames("spinner");
        var e = this.breedId
          , t = this.breedData.breedSpellsId
          , i = this;
        this._loadSpellsData(t, function(n) {
            return n ? console.error(n) : void (i.openState && i.breedId === e && i._updateSpellSlots(t))
        })
    }
    ,
    n.prototype._loadSpellsData = function(e, t) {
        for (var i = [], n = this.loadedSpells, o = 0; o < e.length; o += 1)
            n[e[o]] || i.push(e[o]);
        return i.length ? void u.createSpells(i, function(e, i) {
            if (e)
                return t(e);
            i = u.sortSpells(i, "minPlayerLevel");
            for (var o = 0; o < i.length; o += 1) {
                var s = i[o];
                n[s.id] = s
            }
            t()
        }) : t()
    }
    ,
    n.prototype._updateSpellSlots = function(e) {
        for (var t, i = 0; i < e.length; i += 1) {
            var n = this.spellsContainer.appendChild(new h);
            t = this.loadedSpells[e[i]],
            n.setSpell(t, f),
            n.toggleDisplay(!!t),
            n.on("tap", o)
        }
        for (this.windowBody.delClassNames("spinner"),
        i = 0; i < this.favSpells.length; i++) {
            var s = this.favSpells[i];
            t = this.loadedSpells[s.spellId],
            t && (s.slot = s.appendChild(new h),
            s.slot.setSpell(t, f),
            s.slot.on("tap", o),
            s.appendChild(new c({
                spell: t
            },g)),
            s.show())
        }
        this._appearWhenReady()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        T.call(this, {
            className: "BreedingWindow",
            positionInfo: {
                left: "0",
                bottom: "0",
                width: "100%",
                height: "100%"
            },
            noTitle: !0
        }),
        this.mountDataFromCertifId = {},
        this.babyMap = {},
        this._reset(),
        this._setupEvents()
    }
    function o() {
        var e = this.room.breedingWindow;
        e._selectTile(this.room, this)
    }
    i(654);
    var s = i(204)
      , a = i(448)
      , r = i(655)
      , l = i(186)
      , c = i(657)
      , u = i(659)
      , h = i(660)
      , d = i(35).getText
      , p = i(26).inherits
      , m = i(605).isEmptyObject
      , f = i(661)
      , g = i(673)
      , _ = i(675)
      , v = i(318)
      , y = i(680)
      , w = i(393)
      , b = i(682)
      , C = i(206)
      , I = i(684)
      , T = i(402)
      , S = i(22)
      , A = i(190)
      , E = r.DRAG_ID
      , x = "c"
      , M = 150
      , N = 1
      , R = 200
      , O = "paddock"
      , P = 994
      , D = 995
      , L = 996
      , B = 997
      , k = 998
      , F = {
        id: !0,
        name: !0,
        model: !0
    }
      , H = 2
      , G = !0
      , U = 6e5;
    p(n, T),
    e.exports = n,
    n.prototype._reset = function() {
        this.isWindowSizeFull = !1,
        this.isMultiselect = !1,
        this.selectionRoom = null ,
        this.focusedTile = null ,
        this.openedRoom = null ,
        this.dropZones = {},
        this.certificateQueue = [],
        this.certificateTilePendingSelection = null ,
        this.nonLoadedCertifCount = 0,
        this.waitingGaugeGoal = 0,
        this.certifAreRequested = !1,
        this.numMassRemove = 0,
        this.numMassAdd = 0,
        this.isFilterEmpty = !0,
        this._purgeNewbornList()
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this.equipBox = null ,
        this.focusedMountDetails = null ,
        this.rooms = null ,
        this.roomBoxes = null ,
        this.roomTabs = null ,
        this.displayedRooms = null ,
        this.roomDropZones = null ,
        this.mountFilterBox = null ,
        this.statusBar = null ,
        this.allNoneCheckbox = null ,
        this.waitingGauge = null
    }
    ,
    n.prototype._resetDom = function() {
        for (var e in this.rooms)
            this.rooms[e].reset();
        this._hideMountDetails(),
        this.equipBox.updateMount(null ),
        this._setFilterBoxVisible(!1),
        this.mountFilterBox && this.mountFilterBox.resetFilters(),
        this.allNoneCheckbox.toggleActivation(!1, !0),
        this.waitingGauge.hideGauge(),
        g.freeContent()
    }
    ,
    n.prototype._createDom = function() {
        this._createRooms();
        var e = this.windowBody.createChild("div", {
            className: "leftCol"
        });
        this._setupMountDetails(e),
        this._setupEquipBox(e),
        this._hideMountDetails();
        var t = this.windowBody.createChild("div", {
            className: "rightCol"
        });
        this._setupFilterMenuBox(t),
        this.rooms.paddock.capacity = this.paddockCapacity,
        this._setupRoomBoxes(t),
        this.waitingGauge = this.windowBody.appendChild(new I),
        this._setupMountFilterBox(t),
        this._setupDropZones()
    }
    ,
    n.prototype._setupEvents = function() {
        function e(e) {
            if (t.waitingGauge.hideGauge(),
            e === u.MOUNT_PADDOCK_ERROR) {
                var i = d("ui.exchange.cantExchangeMountPaddockError");
                window.gui.openSimplePopup(i)
            }
        }
        var t = this
          , i = window.gui
          , n = window.dofus.connectionManager
          , o = i.playerData
          , s = o.inventory;
        i.on("disconnect", function() {
            t.mountDataFromCertifId = {}
        }),
        this.on("close", function() {
            this._resetDom(),
            this._reset(),
            i.uiLocker.unlockFeature("mount", "breedingOpened")
        }),
        this.on("opened", function() {
            this.isWindowSizeFull = !0
        }),
        n.on("ExchangeStartOkMountMessage", function(e) {
            t._initDisplay(e)
        }),
        o.on("setMount", this.localizeEvent(function() {
            t._updateEquipBox(),
            t.waitingGauge.hideGauge()
        })),
        o.on("unsetMount", this.localizeEvent(function() {
            t.numMassRemove && t.numMassRemove--,
            t._updateEquipBox()
        })),
        i.on("ExchangeMountStableBornAddMessage", function(e) {
            var i = e.mountDescription;
            t.babyMap[i.id] = Date.now(),
            t.equipBox && t._addMountsToRoom(t.rooms.shed, i)
        }),
        i.on("ExchangeMountStableAddMessage", this.localizeEvent(function(e) {
            t._addMountsToRoom(t.rooms.shed, e.mountDescription)
        })),
        i.on("ExchangeMountStableRemoveMessage", this.localizeEvent(function(e) {
            t._removeMountsFromRoom(t.rooms.shed, e.mountId)
        })),
        i.on("ExchangeMountPaddockAddMessage", this.localizeEvent(function(e) {
            t._addMountsToRoom(t.rooms.paddock, e.mountDescription)
        })),
        i.on("ExchangeMountPaddockRemoveMessage", this.localizeEvent(function(e) {
            t._removeMountsFromRoom(t.rooms.paddock, e.mountId)
        })),
        i.on("PaddockPropertiesMessage", this._updatePaddockProperties.bind(this)),
        s.on("itemAdded", this.localizeEvent(function(e) {
            t._addCertificates([e])
        })),
        s.on("itemsAdded", this.localizeEvent(function(e) {
            t._addCertificates(e)
        })),
        s.on("itemDeleted", this.localizeEvent(function(e, i) {
            t._removeCertificates([i])
        })),
        s.on("itemsDeleted", this.localizeEvent(function(e, i) {
            t._removeCertificates(i)
        })),
        n.on("MountDataMessage", this.localizeEvent(function(e) {
            t._receiveMountData(e.mountData)
        })),
        n.on("MountRenamedMessage", this.localizeEvent(function(e) {
            var i = t._findTileInRooms(e.mountId);
            i.mountData.name = e.name,
            t._refreshTile(i)
        })),
        n.on("MountSterilizedMessage", this.localizeEvent(function(e) {
            var i = t._findTileInRooms(e.mountId);
            i.mountData.reproductionCount = -1,
            t._refreshTile(i)
        })),
        i.on("ExchangeMountStableErrorMessage", function() {
            e(u.MOUNT_PADDOCK_ERROR)
        }),
        n.on("ExchangeErrorMessage", this.localizeEvent(function(t) {
            e(t.errorType)
        })),
        l.on("dragStart", this.localizeEvent(function(e, i, n) {
            i === E && t._startDragging(e, n)
        })),
        l.on("dragEnd", this.localizeEvent(function(e, i) {
            i === E && t._endDragging(e)
        }))
    }
    ,
    n.prototype._initDisplay = function(e) {
        var t = window.gui.playerData.inventory;
        window.gui.uiLocker.lockFeature("mount", "breedingOpened"),
        S.openDialog(this.id),
        this.equipBox ? this._resetDom() : this._createDom(),
        this._updateEquipBox(!0),
        this.roomBoxes.hide(),
        this._addMountsToRoom(this.rooms.shed, e.stabledMountsDescription),
        this._addMountsToRoom(this.rooms.paddock, e.paddockedMountsDescription),
        this._addCertificates(Object.keys(t.objects)),
        this.roomBoxes.show(),
        this.roomTabs.openTab(O, null , {
            forceOpen: !0
        }),
        this.waitingGauge.hideGauge()
    }
    ,
    n.prototype._createRooms = function() {
        var e = [{
            id: "paddock",
            name: d("ui.common.mountPark")
        }, {
            id: "shed",
            name: d("ui.mount.barn"),
            capacity: M
        }, {
            id: "certificate",
            name: d("ui.mount.certificates")
        }, {
            id: "equip",
            name: d("ui.common.equip"),
            capacity: N,
            hidden: !0
        }];
        this.rooms = {},
        this.displayedRooms = {};
        for (var t = 0; t < e.length; t += 1) {
            var i = e[t]
              , n = i.id
              , o = this.rooms[n] = new y(this,n,i.name,i.capacity);
            i.hidden || (this.displayedRooms[n] = o)
        }
        this.numTabs = Object.keys(this.displayedRooms).length
    }
    ,
    n.prototype._updatePaddockProperties = function(e) {
        this.paddockCapacity = e.properties.maxOutdoorMount,
        this.openState && this._updateRoomTab(this.rooms.paddock)
    }
    ,
    n.prototype._setupMountDetails = function(e) {
        var t = e.createChild("div", {
            className: "mountDetailsBox"
        })
          , i = this.focusedMountDetails = t.appendChild(new f)
          , n = i.getIllustrationElement();
        i.placeholder = new v(t),
        i.dragInfo = new r(this,n)
    }
    ,
    n.prototype._setupEquipBox = function(e) {
        this.equipBox = new c(e,this.rooms.equip,o)
    }
    ,
    n.prototype._selectTab = function(e) {
        this.openedRoom = this.rooms[e],
        this._updateDisplayedRoom();
        var t = this.isMultiselect && this.openedRoom === this.selectionRoom;
        this.allNoneCheckbox.toggleActivation(t, !0)
    }
    ,
    n.prototype._setupRoomBoxes = function(e) {
        var t = this.roomBoxes = e.createChild("div", {
            className: "roomBoxes"
        })
          , i = t.createChild("div", {
            className: "roomBoxWrapper"
        })
          , n = i.createChild("div", {
            className: "tileSpace"
        });
        this.roomPlaceholder = new v(n);
        var o = this.roomTabs = t.appendChild(new b({
            className: "roomTabs"
        }))
          , s = i.rootElement.clientHeight / this.numTabs
          , a = 0;
        o.on("openTab", this._selectTab.bind(this));
        for (var r in this.rooms)
            if (this.displayedRooms[r]) {
                var l = this.rooms[r]
                  , c = l.createBox(n);
                o.addTab(l.name, c, r);
                var u = o.getTabsMap()[r].tab;
                u.setStyles({
                    width: s + "px",
                    top: a + "px"
                }),
                a += s,
                u.title = u.createChild("div", {
                    className: "title",
                    text: l.name
                }),
                u.statusLabel = u.createChild("div", {
                    className: "statusLabel"
                }),
                this._updateRoomTab(l)
            }
    }
    ,
    n.prototype._setupFilterMenuBox = function(e) {
        var t = this
          , i = e.createChild("div", {
            className: "filterMenuBox"
        })
          , n = i.createChild("div", {
            className: "filterMenu"
        });
        this.filterBtn = n.appendChild(new s({
            text: d("tablet.mount.filter"),
            className: ["button", "filterButton"],
            addIcon: "before"
        },function() {
            t._setFilterBoxVisible(!t.isFilterBoxVisible)
        }
        ));
        var o = n.appendChild(new w({
            className: "sortSelector"
        }));
        this.sorters = [{
            name: d("ui.common.sort") + d("ui.common.colon"),
            property: "id"
        }, {
            name: d("tablet.mount.type"),
            property: "model"
        }, {
            name: d("ui.common.sex"),
            property: "sex"
        }, {
            name: d("ui.common.name"),
            property: "name"
        }, {
            name: d("ui.common.level"),
            property: "level"
        }];
        for (var a = 0; a < this.sorters.length; a += 1) {
            var r = this.sorters[a];
            o.addOption(r.name, r.property),
            o.toggleOption(a, !0)
        }
        o.on("change", this._changeSorter.bind(this)),
        this.selectedSorter = o.selectFirst(!0),
        this._createSelectAllOrNone(n);
        var l = this.statusBar = i.createChild("div", {
            className: "statusBar"
        })
          , c = new A("div",{
            className: "statusBarTooltip"
        });
        c.createChild("div", {
            className: "title",
            text: d("tablet.mount.activeFilters")
        }),
        c.filterList = null ,
        C.addTooltip(l, function() {
            return c.filterList && c.removeChild(c.filterList),
            c.filterList = c.appendChild(t._buildFilterDescription()),
            c
        })
    }
    ,
    n.prototype._createSelectAllOrNone = function(e) {
        var t = this
          , i = d("ui.common.all") + " / " + d("ui.common.none")
          , n = this.allNoneCheckbox = e.appendChild(new a(i));
        n.addClassNames("allNoneCheckbox"),
        n.on("change", function(e) {
            t._setMultiselect(e, !0)
        })
    }
    ,
    n.prototype._setupDropZones = function() {
        function e(e, t, i) {
            n._droppedMount(this, e, i)
        }
        function t() {
            n._handleDragEnter(this.id, !0)
        }
        function i() {
            n._handleDragEnter(this.id, !1)
        }
        var n = this
          , o = [];
        for (var s in this.rooms) {
            o.push(s);
            var a = this.roomTabs.getTabsMap()[s];
            if (a) {
                var r = this.roomTabs.getTabsMap()[s].tab;
                l.setDroppable(r, [E]),
                r.id = s,
                r.on("drop", e),
                r.on("dragEnter", t),
                r.on("dragLeave", i)
            }
        }
        this.roomDropZones = this.roomBoxes.createChild("div", {
            className: "roomDropZones"
        });
        for (var c = 0; c < o.length; c += 1) {
            s = o[c];
            var u = this.dropZones[s] = new A("div",{
                className: ["dropZone", s, "transition"]
            });
            u.id = s;
            var h = this.rooms[s];
            "equip" === s ? (this.equipBox.box.appendChild(u),
            u.addClassNames("equip")) : (this.roomDropZones.appendChild(u),
            u.addClassNames("room")),
            u.createChild("div", {
                className: "amount",
                name: "amount"
            }),
            u.createChild("div", {
                className: "label",
                text: h.name,
                name: "label"
            }),
            l.setDroppable(u, [E]),
            u.on("drop", e),
            u.on("dragEnter", t),
            u.on("dragLeave", i)
        }
    }
    ,
    n.prototype._setupMountFilterBox = function(e) {
        if (!this.isWindowSizeFull)
            return this.once("opened", this._setupMountFilterBox.bind(this, e));
        this.mountFilterBox = e.appendChild(new _({
            className: "transition"
        })),
        this._updateTypeFilters();
        var t = this;
        this.mountFilterBox.on("activeFiltersUpdated", function(e) {
            t.activeFilters = e,
            t.isFilterEmpty = m(e),
            t._setMultiselect(!1),
            t._updateDisplayedRoom(),
            t._updateStatusBar()
        })
    }
    ,
    n.prototype._receiveMountData = function(e) {
        var t, i = e.id;
        if (!this.certificateQueue.length)
            return (t = this._findTileInRooms(i)) ? (t.mountData = this._prepareMountForRoom(e, t.room),
            this._refreshTile(t),
            void (t === this.focusedTile && this._displayMountDetails(e))) : console.error("Received data about unknown mount ", e);
        var n = this.certificateQueue.shift()
          , o = x + n.objectUID;
        if (this.mountDataFromCertifId[o] = this._prepareMountForRoom(e, this.rooms.certificate),
        e.isNewborn && (this.babyMap[o] = this.babyMap[i]),
        t = this.rooms.certificate.getTile(o),
        t.mountData.receivedData = e,
        this._refreshTile(t),
        t.setSpinnerVisible(!1),
        this.certificateTilePendingSelection === t && (this.certificateTilePendingSelection = null ,
        this._selectTile(this.rooms.certificate, t)),
        this.nonLoadedCertifCount--,
        this.certifAreRequested && this.waitingGauge.refreshGauge(this.nonLoadedCertifCount),
        !G) {
            var s = this.certificateQueue[0];
            if (s)
                return this._requestMountData(s)
        }
        0 === this.nonLoadedCertifCount && this.certifAreRequested && (this.certifAreRequested = !1,
        "certificate" === this.openedRoom.id && this._updateDisplayedRoom())
    }
    ,
    n.prototype._requestOneCertificate = function(e) {
        this.certificateQueue.indexOf(e) >= 0 || (this.certificateQueue.push(e),
        !G && this.certificateQueue.length > 1 || this._requestMountData(e))
    }
    ,
    n.prototype._requestAllCertificates = function() {
        this.certifAreRequested = !0,
        this.waitingGauge.showGauge(this.nonLoadedCertifCount, d("tablet.mount.loadingCertif", this.nonLoadedCertifCount));
        var e = this.rooms.certificate.mountMap;
        for (var t in e)
            this.mountDataFromCertifId[t] || this._requestOneCertificate(e[t].certificate)
    }
    ,
    n.prototype.tileTapHandler = function(e) {
        return this._setFilterBoxVisible(!1),
        e.mountData.certificate && !e.mountData.receivedData ? (e.setSpinnerVisible(!0),
        this.certificateTilePendingSelection = e,
        this._requestOneCertificate(e.mountData.certificate)) : (e.selected && !this.isMultiselect && this._setMultiselect(!0),
        void this._selectTile(e.room, e))
    }
    ,
    n.prototype._purgeNewbornList = function() {
        var e = Date.now();
        for (var t in this.babyMap)
            e - this.babyMap[t] > U && delete this.babyMap[t]
    }
    ,
    n.prototype._prepareMountForRoom = function(e, t) {
        return e.mountLocation = t.id,
        e.isNewborn = !!(this.babyMap[e.id] || e.receivedData && this.babyMap[e.receivedData.id]),
        e
    }
    ,
    n.prototype._addMountsToRoom = function(e, t) {
        t = Array.isArray(t) ? t : [t];
        for (var i = t.length, n = 0; n < i; n++)
            e.addMount(this._prepareMountForRoom(t[n], e));
        this.numMassAdd && (this.numMassAdd -= i,
        this.waitingGauge.refreshGauge(this.numMassAdd + this.numMassRemove)),
        0 === this.numMassAdd && (this._updateRoomTab(e),
        e === this.openedRoom && this._updateDisplayedRoom(),
        this._updateTypeFilters())
    }
    ,
    n.prototype._removeMountsFromRoom = function(e, t) {
        t = Array.isArray(t) ? t : [t];
        var i = t.length
          , n = this.focusedTile && this.focusedTile.id;
        t.indexOf(n) !== -1 && (this._hideMountDetails(),
        this.focusedTile = null );
        for (var o = 0; o < t.length; o += 1)
            e.removeMount(t[o]);
        this.numMassRemove && (this.numMassRemove -= i,
        this.waitingGauge.refreshGauge(this.numMassAdd + this.numMassRemove)),
        0 === this.numMassRemove && (e === this.selectionRoom && 0 === e.getNumSelected() && this._setMultiselect(!1),
        this._updateRoomTab(e),
        e === this.openedRoom && this._updateDisplayedRoom(),
        this._updateTypeFilters())
    }
    ,
    n.prototype._addCertificates = function(e) {
        for (var t = this._extractCertificates(e), i = [], n = 0; n < t.length; n++) {
            var o = t[n]
              , s = o.mountInfo
              , a = x + o.objectUID
              , r = this.mountDataFromCertifId[a];
            r || this.nonLoadedCertifCount++,
            i.push({
                id: a,
                certificate: o,
                model: s.modelId,
                name: s.name,
                receivedData: r
            })
        }
        this._addMountsToRoom(this.rooms.certificate, i)
    }
    ,
    n.prototype._removeCertificates = function(e) {
        for (var t = [], i = 0; i < e.length; i += 1) {
            var n = x + e[i].objectUID
              , o = this.mountDataFromCertifId[n];
            o ? delete this.mountDataFromCertifId[n] : this.nonLoadedCertifCount--,
            t.push(n)
        }
        this._removeMountsFromRoom(this.rooms.certificate, t)
    }
    ,
    n.prototype._extractCertificates = function(e) {
        for (var t = window.gui.playerData.inventory, i = [], n = 0; n < e.length; n += 1) {
            var o = e[n]
              , s = o.objectUID ? o : t.objects[o];
            this._enrichCertificateData(s) && i.push(s)
        }
        return i
    }
    ,
    n.prototype._enrichCertificateData = function(e) {
        var t = e.effectsMap
          , i = t[D];
        if (!i)
            return !1;
        if (t[P])
            return !1;
        var n = {
            mountId: i.mountId,
            date: i.date,
            modelId: i.modelId
        }
          , o = t[B];
        o && (n.name = o.text);
        var s = t[k];
        s && (n.validityDays = s.days,
        n.validityHours = s.hours,
        n.validityMinutes = s.minutes,
        n.validityDesc = s.description);
        var a = t[L];
        return a && (n.ownerDesc = a.description),
        e.mountInfo = n,
        !0
    }
    ,
    n.prototype._requestMountData = function(e) {
        var t = e.mountInfo;
        window.dofus.sendMessage("MountInformationRequestMessage", {
            id: t.mountId,
            time: t.date
        })
    }
    ,
    n.prototype._updateRoomTab = function(e) {
        var t = this.roomTabs.getTabsMap()[e.id];
        if (t) {
            var i = t.tab.statusLabel
              , n = '(<span class="highlight">' + e.numMounts;
            n += void 0 !== e.capacity && e.capacity !== Number.POSITIVE_INFINITY ? "</span> / " + e.capacity + ")" : "</span>)",
            i.setHtml(n)
        }
    }
    ,
    n.prototype._showRoomPlaceholderIfNeeded = function() {
        var e = this.openedRoom
          , t = e.getNumHiddenMounts()
          , i = e.numMounts
          , n = null ;
        0 === i ? n = d("tablet.mount.emptyRoom") : i === t && (n = d("tablet.mount.filteredMounts", i)),
        e.toggleDisplay(!n),
        this.roomPlaceholder.setText(n)
    }
    ,
    n.prototype._updateDisplayedRoom = function() {
        var e = this.openedRoom;
        e && ("certificate" === e.id && !this.isFilterEmpty && this._initLoadAllCertificates() || (e.refreshDisplay(this.activeFilters, this.selectedSorter),
        this._showRoomPlaceholderIfNeeded()))
    }
    ,
    n.prototype._refreshTile = function(e) {
        e.refreshDisplay(),
        e.room === this.openedRoom && this._updateDisplayedRoom()
    }
    ,
    n.prototype._clearSelection = function() {
        var e = this.focusedTile;
        e && (e.room.setMountSelected(e.id, !1),
        this.focusedTile = null ),
        this.selectionRoom && (this.selectionRoom.unselectAll(),
        this.selectionRoom = null )
    }
    ,
    n.prototype._setMultiselect = function(e, t) {
        this.allNoneCheckbox.toggleActivation(e, !0),
        this.isMultiselect = e,
        this._clearSelection(),
        this._hideMountDetails(),
        e && (this.selectionRoom = this.openedRoom,
        t && this.openedRoom.selectAll())
    }
    ,
    n.prototype._selectTile = function(e, t) {
        var i = this.focusedTile;
        if (this.isMultiselect && t.room !== this.selectionRoom && this._setMultiselect(!1),
        this.isMultiselect) {
            if (e.setMountSelected(t.id, !t.selected),
            0 === e.getNumSelected())
                return this._setMultiselect(!1)
        } else {
            if (t === i)
                return;
            i && i.room.setMountSelected(i.id, !1),
            e.setHightlightedMount(t.id)
        }
        this.focusedTile = t,
        this._displayMountDetails(t.mountData)
    }
    ,
    n.prototype._updateEquipBox = function(e) {
        var t = window.gui.playerData.equippedMount;
        if (t && this._prepareMountForRoom(t, this.rooms.equip),
        this.equipBox.updateMount(t),
        !e) {
            var i = this.focusedTile === this.equipBox.tile;
            t ? i ? this._displayMountDetails(t) : this._selectTile(this.rooms.equip, this.equipBox.tile) : i && this._hideMountDetails()
        }
    }
    ,
    n.prototype._hideMountDetails = function() {
        var e = this.focusedMountDetails;
        e.hide(),
        e.placeholder.toggleDisplay(!0);
        var t = d(this.isMultiselect ? "tablet.mount.pendingMultiselect" : "tablet.mount.selectMount");
        e.placeholder.setText(t)
    }
    ,
    n.prototype._displayMountDetails = function(e) {
        if (e.certificate && (e = e.receivedData,
        !e))
            return this._hideMountDetails();
        var t = this.focusedMountDetails;
        t.show(),
        t.placeholder.toggleDisplay(!1),
        t.dragInfo.setMount(e),
        t.setMount(e, {
            context: "breeding"
        })
    }
    ,
    n.prototype._requestExchangeBetweenRooms = function(e, t, i) {
        var n = h[e][t];
        n && window.dofus.sendMessage("ExchangeHandleMountStableMessage", {
            actionType: n,
            rideId: i
        })
    }
    ,
    n.prototype._getIdForExchange = function(e, t) {
        return "certificate" !== e ? t : ~~t.substr(1)
    }
    ,
    n.prototype._moveMounts = function(e, t, i, n) {
        void 0 === n && (n = i.length);
        var o = H * n;
        for (this.waitingGauge.showGauge(o, d("tablet.mount.moving", n), H),
        this.numMassRemove = this.numMassAdd = n; n > 0; n--) {
            var s = this._getIdForExchange(e, i.pop());
            this._requestExchangeBetweenRooms(e, t, s)
        }
    }
    ,
    n.prototype.prepareDraggedTiles = function(e) {
        var t = this.rooms[e.mountLocation]
          , i = t.getTile(e.id);
        return i.selected || this._selectTile(t, i),
        t.getNumSelected()
    }
    ,
    n.prototype._startDragging = function(e, t) {
        var i = this;
        this.roomDropZones.addClassNames("enable"),
        e.addClassNames("dragging");
        var n = t.mount
          , o = this.rooms[n.mountLocation]
          , s = o.getNumSelected();
        this.dragTimeout = setTimeout(function() {
            for (var e in i.dropZones) {
                var t = i.dropZones[e];
                if (t.isEnabled = e !== o.id && ("equip" !== t.id || s <= 1),
                t.toggleClassName("enable", t.isEnabled),
                t.isEnabled) {
                    var n = i.rooms[e]
                      , a = n.capacity - n.numMounts
                      , r = "";
                    s > a && (r = a > 0 ? d("tablet.mount.roomLeft", a) : d("tablet.mount.roomFullShort")),
                    t.toggleClassName("warning", !!r && a > 0),
                    t.toggleClassName("full", !!r && a <= 0),
                    t.getChild("amount").setText(r)
                }
            }
        }, R),
        this._setFilterBoxVisible(!1)
    }
    ,
    n.prototype._endDragging = function(e) {
        clearTimeout(this.dragTimeout),
        e.delClassNames("dragging");
        for (var t in this.dropZones) {
            var i = this.dropZones[t];
            i.delClassNames("enable", "dragEnter");
            var n = this.roomTabs.getTabsMap()[t];
            if (n) {
                var o = n.tab;
                o.delClassNames("dragEnter")
            }
        }
        if (this.roomDropZones.delClassNames("enable"),
        l.isLostDrop && this.focusedTile) {
            var s = this.focusedTile.mountData;
            s.certificate && !s.receivedData && this._clearSelection()
        }
    }
    ,
    n.prototype._handleDragEnter = function(e, t) {
        var i = this.dropZones[e];
        i.toggleClassName("dragEnter", t);
        var n = this.roomTabs.getTabsMap()[e];
        if (n) {
            var o = n.tab;
            o.toggleClassName("dragEnter", t && i.isEnabled)
        }
    }
    ,
    n.prototype._droppedMount = function(e, t, i) {
        var n = i.mount
          , o = n.mountLocation
          , s = e.id;
        if (o !== s) {
            var a = this.rooms[o]
              , r = this.rooms[s]
              , l = "equip" !== s ? r.capacity - r.numMounts : r.capacity
              , c = "equip" !== s ? a.getSelection() : [n.id]
              , u = c.length;
            if (l <= 0)
                window.gui.openSimplePopup(d("tablet.mount.roomFull"));
            else if (l < u) {
                var h = this;
                window.gui.openConfirmPopup({
                    title: d("ui.popup.warning"),
                    message: d("tablet.mount.partialMoveMounts", l),
                    cb: function(e) {
                        e && h._moveMounts(o, s, c, l)
                    }
                })
            } else
                this._moveMounts(o, s, c)
        }
    }
    ,
    n.prototype._findTileInRooms = function(e) {
        for (var t in this.rooms) {
            var i = this.rooms[t].getTile(e);
            if (i)
                return i
        }
        return null
    }
    ,
    n.prototype._initLoadAllCertificates = function() {
        return 0 !== this.nonLoadedCertifCount && (this.rooms.certificate.lockRoom(),
        this.roomPlaceholder.setText(" "),
        this._requestAllCertificates(),
        !0)
    }
    ,
    n.prototype._changeSorter = function(e) {
        this.selectedSorter = e,
        "certificate" === this.openedRoom.id && !F[e] && this._initLoadAllCertificates() || this._updateDisplayedRoom()
    }
    ,
    n.prototype._setFilterBoxVisible = function(e) {
        this.isFilterBoxVisible = e,
        this.filterBtn.toggleClassName("enabled", e),
        this.mountFilterBox.toggleClassName("enable", e)
    }
    ,
    n.prototype._updateTypeFilters = function() {
        if (this.mountFilterBox) {
            var e, t = [];
            for (var i in this.rooms) {
                var n = this.rooms[i].mountMap;
                for (var o in n)
                    e = n[o].model,
                    t.indexOf(e) === -1 && t.push(e)
            }
            this.mountFilterBox.updateTypeSelector(t)
        }
    }
    ,
    n.prototype._buildFilterDescription = function() {
        for (var e = new A("div"), t = Object.keys(this.activeFilters), i = 0; i < t.length; i++) {
            var n, o = t[i], s = this.activeFilters[o];
            n = s.interval ? this.mountFilterBox.filterBoxes[o].label.getText() : s.args[0] ? s.name : s.antiName;
            var a = i < t.length - 1 ? "," : ""
              , r = e.createChild("span", {
                className: "filterLabelBox",
                text: (n || s.name) + a
            });
            r.isAnti = !n,
            r.toggleClassName("anti", r.isAnti)
        }
        return e
    }
    ,
    n.prototype._updateStatusBar = function() {
        this.filterBtn.toggleClassName("hasFilter", !m(this.activeFilters)),
        this.statusBar.clearContent(),
        this.statusBar.appendChild(this._buildFilterDescription())
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        var t = Math.min(e - 1, l)
          , i = new a("div",{
            className: "emptyFrame"
        });
        i.setStyles({
            left: t * c + "px",
            top: t * u + "px"
        });
        for (var n = i, o = t - 1; o >= 0; o--)
            n = n.createChild("div", {
                className: "emptyFrame"
            });
        return n.createChild("div", {
            className: "number",
            text: e
        }),
        i
    }
    function o(e, t) {
        this.sourceData = {
            mount: null
        },
        this.styles = {},
        this.onDragClassName = "draggedMount",
        this.wElement = t,
        this.imgElement = t,
        this.breedingWindow = e;
        var i = {
            containerWidth: h,
            containerHeight: d
        };
        s.setDraggable(t, this, r, this.sourceData, i)
    }
    i(656);
    var s = i(186)
      , a = i(190)
      , r = "mountRoom"
      , l = 7
      , c = -4
      , u = 4
      , h = 138
      , d = 118;
    e.exports = o,
    o.DRAG_ID = r,
    o.prototype.setMount = function(e, t) {
        this.sourceData.mount = e,
        this.imgElement = t || this.imgElement
    }
    ,
    o.prototype.setStyle = function(e, t) {
        this.styles[e] = t
    }
    ,
    o.prototype.prepareForDrag = function(e, t) {
        this.setStyle("backgroundImage", this.imgElement.getStyle("backgroundImage"));
        var i = this.breedingWindow.prepareDraggedTiles(this.sourceData.mount);
        if (i > 1) {
            t.addClassNames("multiselect");
            var o = n(i);
            t.insertAsFirstChild(o),
            this.wElement.once("dragEnd", function() {
                t.removeChild(o),
                t.delClassNames("multiselect")
            })
        }
        return !0
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        this.mountData = null ,
        this.box = e.createChild("div", {
            className: "equipBox"
        }),
        this._createTile(t, i),
        this.placeholder = new r(this.box),
        this.placeholder.setText(a("tablet.mount.noEquipped"))
    }
    i(658);
    var o = i(5)
      , s = i(655)
      , a = i(35).getText
      , r = i(318)
      , l = i(32);
    e.exports = n,
    n.prototype._createTile = function(e, t) {
        var i = this.tile = this.box.createChild("div", {
            className: ["mount", "neutralTile"]
        });
        e.getTile = function(e) {
            return i.id === e ? i : null
        }
        ,
        i.createChild("div", {
            className: "title",
            text: a("tablet.mount.equipped")
        }),
        this.mountImg = i.createChild("div", {
            className: "mountImg"
        });
        var n = i.createChild("div", {
            className: "nameAndLevel"
        });
        this.mountName = n.createChild("div", {
            className: "mountName"
        }),
        this.mountLevel = n.createChild("div", {
            className: "level"
        }),
        l(i),
        i.on("tap", t),
        i.setTileSelected = this._setTileSelected.bind(this),
        i.refreshDisplay = this._refreshTile.bind(this),
        i.highlightTile = function() {}
        ,
        i.id = null ,
        i.mountData = null ,
        i.selected = !1,
        i.room = e,
        i.equipBox = this,
        this.dragInfo = new s(e.breedingWindow,i)
    }
    ,
    n.prototype.updateMount = function(e) {
        var t = this.mountData
          , i = !!e;
        return this.tile.toggleDisplay(i),
        this.placeholder.toggleDisplay(!i),
        e ? (this.mountData = e,
        this._refreshTile(),
        this.dragInfo.setMount(e, this.mountImg)) : (this.mountData = null ,
        this.tile.addClassNames("neutralTile"),
        this.tile.delClassNames("focusedTile")),
        t
    }
    ,
    n.prototype._setTileSelected = function(e) {
        e = void 0 === e || e,
        this.tile.toggleClassName("focusedTile", e),
        this.tile.toggleClassName("neutralTile", !e),
        this.tile.selected = e
    }
    ,
    n.prototype._refreshTile = function() {
        var e = this.mountData;
        this.tile.mountData = e,
        this.tile.id = e.id,
        this.mountName.setText(e.name || a("ui.common.noName")),
        this.mountLevel.setText(a("ui.common.short.level") + " " + e.level);
        var t = this;
        o.preloadImage("gfx/mounts/" + e.model + ".png", function(e) {
            t.mountImg.setStyle("backgroundImage", e)
        })
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        REQUEST_IMPOSSIBLE: 1,
        REQUEST_CHARACTER_OCCUPIED: 2,
        REQUEST_CHARACTER_JOB_NOT_EQUIPED: 3,
        REQUEST_CHARACTER_TOOL_TOO_FAR: 4,
        REQUEST_CHARACTER_OVERLOADED: 5,
        REQUEST_CHARACTER_NOT_SUSCRIBER: 6,
        REQUEST_CHARACTER_RESTRICTED: 7,
        BUY_ERROR: 8,
        SELL_ERROR: 9,
        MOUNT_PADDOCK_ERROR: 10,
        BID_SEARCH_ERROR: 11
    }
}
, function(e, t) {
    e.exports = {
        shed: {
            equip: 2,
            free: 3,
            certificate: 4,
            paddock: 6,
            sterilize: 17
        },
        paddock: {
            shed: 7,
            free: 8,
            equip: 10,
            certificate: 14,
            sterilize: 19
        },
        equip: {
            shed: 1,
            paddock: 9,
            free: 11,
            certificate: 13,
            sterilize: 18
        },
        certificate: {
            shed: 5,
            paddock: 16,
            equip: 15
        }
    }
}
, function(e, t, i) {
    function n() {
        b.call(this, "div", {
            className: "MountDetails"
        }),
        this.mountData = {},
        this.boostMap = {
            1: {
                property: "energy",
                update: this._setEnergy
            },
            2: {
                property: "serenity",
                update: this._setSerenity
            },
            3: {
                property: "stamina",
                update: this._setStamina
            },
            4: {
                property: "love",
                update: this._setLove
            },
            5: {
                property: "maturity",
                update: this._setMaturity
            },
            6: {
                property: "boostLimiter",
                update: this._setTiredness
            }
        },
        this._givenXP = 0,
        this._name = "",
        this.shouldResetTab = !0,
        this.hasDomAndListeners = !1,
        this.on("destroy", function() {
            this.hasDomAndListeners && (this._setEventListeners(!1),
            this.hasDomAndListeners = !1)
        })
    }
    function o() {
        return this.tooltipText
    }
    i(662);
    var s = i(5)
      , a = i(204)
      , r = i(224)
      , l = i(660)
      , c = i(663)
      , u = i(35).getText
      , h = i(26).inherits
      , d = i(201)
      , p = i(666)
      , m = i(667)
      , f = i(643)
      , g = i(669)
      , _ = i(671)
      , v = i(509)
      , y = i(206)
      , w = i(22)
      , b = i(190)
      , C = 33
      , I = 0
      , T = 1
      , S = 2;
    h(n, b),
    e.exports = n,
    n.prototype.getIllustrationElement = function() {
        return this.hasDomAndListeners || this._setupDomAndListeners(),
        this._mountIllus
    }
    ,
    n.prototype._createProgressBar = function(e, t, i, n) {
        var o = u("ui.common.colon")
          , s = e.createChild("div", {
            className: t
        });
        return s.createChild("div", {
            className: "label",
            text: i + o
        }),
        s.appendChild(new f({
            className: ["mountBar", n],
            tooltip: i
        }))
    }
    ,
    n.prototype._getActionOnMount = function(e) {
        var t = this.mountData.mountLocation;
        return t ? l[this.mountData.mountLocation][e] : null
    }
    ,
    n.prototype._exchangeAction = function(e) {
        var t = this._getActionOnMount(e);
        if (!t)
            return console.error(new Error("Invalid action " + e));
        var i = this;
        window.dofus.sendMessage("ExchangeHandleMountStableMessage", {
            actionType: t,
            rideId: i.mountData.id
        })
    }
    ,
    n.prototype._setSex = function(e) {
        e ? this._sexIcon.replaceClassNames(["male"], ["female"]) : this._sexIcon.replaceClassNames(["female"], ["male"])
    }
    ,
    n.prototype._setupDomAndListeners = function() {
        this.mustResize = !0,
        this._createMinMaxBox(),
        this._createMainInformation(),
        this._createPanels(),
        this._createButtons(),
        this._setEventListeners(!0),
        this.hasDomAndListeners = !0
    }
    ,
    n.prototype._createMainInformation = function() {
        var e = this
          , t = this.createChild("div", {
            className: "mainContainer"
        })
          , i = t.createChild("div", {
            className: "mainInfosTop"
        })
          , n = i.createChild("div", {
            className: "leftColumn"
        });
        this._mountIllus = n.createChild("div", {
            className: "mountIllus"
        }),
        this._sexIcon = this._mountIllus.createChild("div", {
            className: "sexIcon"
        }),
        y.addTooltip(this._mountIllus, o);
        var s = i.createChild("div", {
            className: "rightColumn"
        });
        this._mountName = s.createChild("div", {
            className: "mountName"
        }),
        this._renameButton = s.appendChild(new a({
            className: ["simpleButton", "tinyBtn", "renameBtn"],
            tooltip: u("ui.mount.renameTooltip")
        },function() {
            w.open("mountRename", {
                name: e.mountData.name,
                mountId: e.mountData.id,
                inputBox: e._mountName
            })
        }
        ));
        var r = s.createChild("div", {
            className: "typeAndLevel"
        });
        this._mountType = r.appendChild(new m),
        this._level = r.createChild("div", {
            className: "level"
        });
        var l = t.createChild("div", {
            className: "mainInfosBottom"
        })
          , c = this.abilityDiv = l.createChild("div", {
            className: "abilityDiv"
        });
        this.abilities = [];
        for (var h = 0; h < S; h++) {
            var d = this.abilities[h] = c.createChild("div", {
                className: "ability"
            });
            y.addTooltip(d, o)
        }
        var p = l.createChild("div", {
            className: "statusIcons"
        });
        this.fertileIcon = p.appendChild(new _("fertile",{
            tooltip: ""
        })),
        this.domesticIcon = p.appendChild(new _("domestic",{
            tooltip: u("tablet.mount.domestic")
        })),
        this.mountableIcon = p.appendChild(new _("mountable",{
            tooltip: u("ui.common.mountable")
        })),
        this._rideButtonDiv = p.createChild("div", {
            className: "rideBtnDiv"
        }),
        this._rideButton = this._rideButtonDiv.appendChild(new a({
            className: ["greenButton", "rideButton"],
            addIcon: !0,
            tooltip: u("ui.mount.rideTooltip")
        },function() {
            window.dofus.sendMessage("MountToggleRidingRequestMessage")
        }
        ))
    }
    ,
    n.prototype._createPanels = function() {
        var e = this._tabs = this.appendChild(new v({
            className: "tabs"
        }));
        e.addTab(u("tablet.mount.breeding"), this._createBreedingPanel()),
        e.addTab(u("ui.common.short.caracteristic"), this._createStatPanel())
    }
    ,
    n.prototype._createBreedingPanel = function() {
        var e = new b("div",{
            className: "panel"
        })
          , t = e.createChild("div", {
            className: "breedingPanel"
        })
          , i = u("ui.common.colon");
        this._tirednessValue = this._createProgressBar(t, ["progressBar2col", "tired"], u("ui.common.tire"), "orange");
        var n = t.createChild("div", {
            className: "iconGaugeBar"
        });
        this._staminaGauge = n.appendChild(new c("stamina",u("ui.common.stamina"))),
        this._maturityGauge = n.appendChild(new c("maturity",u("ui.common.maturity"))),
        this._loveGauge = n.appendChild(new c("love",u("ui.common.love"))),
        this._serenityGauge = t.appendChild(new g);
        var o = this._fertilityDiv = t.createChild("div", {
            className: ["textInfo", "mating"]
        });
        return o.createChild("div", {
            className: "label",
            text: u("ui.common.reproductions") + i
        }),
        this._fertilityValue = o.createChild("div", {
            className: "value"
        }),
        this._fecondationState = t.createChild("div", {
            className: "fecondationState"
        }),
        e
    }
    ,
    n.prototype._createStatPanel = function() {
        var e = new b("div",{
            className: "panel"
        })
          , t = e.createChild("div", {
            className: "statPanel"
        });
        return this._energyGauge = t.appendChild(new c("energy",u("ui.common.energy"),{
            size: C
        })),
        this._experienceValue = this._createProgressBar(t, ["progressBar2col", "xp"], u("ui.common.experiment"), "blue"),
        this._createGivenXp(t),
        t.createChild("div", {
            className: "effectLabel",
            text: u("ui.effects")
        }),
        this._effectsContent = t.createChild("div", {
            className: "effectsContent"
        }),
        e
    }
    ,
    n.prototype._createGivenXp = function(e) {
        var t = this
          , i = this._givenXpDiv = e.createChild("div", {
            className: "givenXp"
        })
          , n = u("ui.common.giveXP") + u("ui.common.colon");
        i.createChild("div", {
            className: "label",
            text: n
        });
        var o = i.createChild("div", {
            className: "valueAndButton"
        });
        this._xpValue = o.createChild("div", {
            className: "value"
        }),
        o.appendChild(new a({
            className: ["simpleButton", "tinyBtn", "xpButton"],
            tooltip: u("ui.mount.xpPercentTooltip")
        },function() {
            t.minMaxSelector.open({
                min: 0,
                max: 90,
                defaultValue: t._givenXP
            })
        }
        ))
    }
    ,
    n.prototype._feedMount = function() {
        var e = w.getWindow("feed");
        if (!e.possessFeedItemForMount())
            return window.gui.openSimplePopup(u("ui.item.errorNoFoodMount"));
        var t = "shed" === this.mountData.mountLocation ? p.LOCATION_STABLED : p.LOCATION_EQUIPED;
        w.open("feed", {
            mode: "mount",
            mountUid: this.mountData.id,
            mountLocation: t
        })
    }
    ,
    n.prototype._neuterMount = function() {
        var e = this;
        window.gui.openConfirmPopup({
            title: u("ui.popup.warning"),
            message: u("ui.mount.doUCastrateYourMount"),
            cb: function(t) {
                t && (e.inBreeding ? e._exchangeAction("sterilize") : window.dofus.sendMessage("MountSterilizeRequestMessage"))
            }
        })
    }
    ,
    n.prototype._releaseMount = function() {
        var e = this;
        window.gui.openConfirmPopup({
            title: u("ui.popup.warning"),
            message: u("ui.mount.doUKillYourMount"),
            cb: function(t) {
                t && (e.inBreeding ? e._exchangeAction("free") : window.dofus.sendMessage("MountReleaseRequestMessage"))
            }
        })
    }
    ,
    n.prototype._createButtons = function() {
        var e = this
          , t = this.createChild("div", {
            className: "buttons"
        });
        this._feedButton = t.appendChild(new a({
            className: ["simpleButton", "mountButton", "feedButton"],
            tooltip: u("ui.mount.feed")
        },this._feedMount.bind(this))),
        this._feedButton.disable(),
        this._inventoryButton = t.appendChild(new a({
            className: ["simpleButton", "mountButton", "inventoryButton"],
            tooltip: u("ui.mount.inventoryAccess")
        },function() {
            window.dofus.sendMessage("ExchangeRequestOnMountStockMessage")
        }
        )),
        this._genealogyButton = t.appendChild(new a({
            className: ["simpleButton", "mountButton", "genealogyButton"],
            tooltip: u("ui.mount.ancestorTooltip")
        },function() {
            w.open("familyTree", e.mountData)
        }
        )),
        this._cutButton = t.appendChild(new a({
            className: ["simpleButton", "mountButton", "cutButton"],
            tooltip: u("ui.mount.castrateTooltip")
        },this._neuterMount.bind(this))),
        this._releaseButton = t.appendChild(new a({
            className: ["simpleButton", "mountButton", "releaseButton"],
            tooltip: u("ui.mount.killTooltip")
        },this._releaseMount.bind(this)))
    }
    ,
    n.prototype._createMinMaxBox = function() {
        var e = this.minMaxSelector = this.appendChild(new d);
        e.setStyles({
            left: "-12px",
            top: "249px"
        });
        var t = this;
        e.on("confirm", function(e) {
            e !== t._givenXP && window.dofus.sendMessage("MountSetXpRatioRequestMessage", {
                xpRatio: e
            })
        })
    }
    ,
    n.prototype._processMountRenamed = function(e) {
        e.mountId === this.mountData.id && (this._setName(e.name),
        this.emit("renameMount", this._name))
    }
    ,
    n.prototype._processMountSterilized = function(e) {
        e.mountId === this.mountData.id && (this.mountData.reproductionCount = -1,
        this._setFertilityState())
    }
    ,
    n.prototype._processMountRiding = function(e) {
        var t = window.gui.playerData;
        t.equippedMount.id === this.mountData.id && this._setRideButton(e)
    }
    ,
    n.prototype._processMountReleased = function(e) {
        e.mountId === this.mountData.id && this.emit("freeMount", e.mountId)
    }
    ,
    n.prototype._processUpdateMountBoost = function(e) {
        e.rideId === this.mountData.id && this._updateBoost(e.boostToUpdateList)
    }
    ,
    n.prototype._setEventListeners = function(e) {
        var t = window.gui.playerData
          , i = window.dofus.connectionManager;
        e ? (this.mountRenamedHandler || (this.mountRenamedHandler = this._processMountRenamed.bind(this),
        this.mountSterilizedHandler = this._processMountSterilized.bind(this),
        this.mountReleasedHandler = this._processMountReleased.bind(this),
        this.updateMountBoostHandler = this._processUpdateMountBoost.bind(this),
        this.setRatioHandler = this._setXpRatio.bind(this),
        this.mountRidingHandler = this._processMountRiding.bind(this)),
        i.on("MountRenamedMessage", this.mountRenamedHandler),
        i.on("MountSterilizedMessage", this.mountSterilizedHandler),
        i.on("MountReleasedMessage", this.mountReleasedHandler),
        i.on("UpdateMountBoostMessage", this.updateMountBoostHandler),
        t.on("setMountRatio", this.setRatioHandler),
        t.on("mountRiding", this.mountRidingHandler)) : (i.removeListener("MountRenamedMessage", this.mountRenamedHandler),
        i.removeListener("MountSterilizedMessage", this.mountSterilizedHandler),
        i.removeListener("MountReleasedMessage", this.mountReleasedHandler),
        i.removeListener("UpdateMountBoostMessage", this.updateMountBoostHandler),
        t.removeListener("setMountRatio", this.setRatioHandler),
        t.removeListener("mountRiding", this.mountRidingHandler))
    }
    ,
    n.prototype._updateBoost = function(e) {
        for (var t = this.mountData, i = 0; i < e.length; i += 1) {
            var n = e[i]
              , o = this.boostMap[n.type].property;
            t[o] = n.value,
            this.boostMap[n.type].update.call(this, n.value)
        }
    }
    ,
    n.prototype._setSpecificBehaviors = function(e) {
        if (this.abilityDiv.toggleClassName("withoutAbilities", 0 === e.length),
        e.length)
            for (var t = window.gui.databases.MountBehaviors, i = 0; i < this.abilities.length; i++) {
                var n = this.abilities[i]
                  , o = e[i];
                o && (n.setText(t[o].nameId),
                n.tooltipText = t[o].descriptionId),
                n.toggleDisplay(!!o)
            }
    }
    ,
    n.prototype._setName = function(e) {
        this._name = this.mountData.name = e,
        this._name || (this._name = u("ui.common.noName")),
        this._mountName.setText(this._name);
        var t = u(this.mountData.sex ? "ui.common.animalFemale" : "ui.common.animalMale");
        this._mountIllus.tooltipText = this._name + " (" + t + ")"
    }
    ,
    n.prototype.getName = function() {
        return this._name
    }
    ,
    n.prototype._setXpRatio = function(e) {
        this._givenXP = e,
        this._xpValue.setText(e + "%")
    }
    ,
    n.prototype._setRideButton = function(e) {
        this._rideButton.toggleClassName("isRiding", !!e)
    }
    ,
    n.prototype._setLove = function(e) {
        this._loveGauge.setValue(e, this.mountData.loveMax)
    }
    ,
    n.prototype._setTiredness = function(e) {
        this._tirednessValue.setValue(e, this.mountData.boostMax)
    }
    ,
    n.prototype._setEnergy = function(e) {
        this._energyGauge.setValue(e, this.mountData.energyMax)
    }
    ,
    n.prototype._setStamina = function(e) {
        this._staminaGauge.setValue(e, this.mountData.staminaMax)
    }
    ,
    n.prototype._setMaturity = function(e) {
        this._maturityGauge.setValue(e, this.mountData.maturityForAdult)
    }
    ,
    n.prototype._setSerenity = function(e) {
        this._serenityGauge.setValue(e)
    }
    ,
    n.getFertilityState = function(e) {
        var t = e.reproductionCount
          , i = e.reproductionCountMax
          , n = t >= 0 && t < i
          , o = t < 0
          , s = {
            canReproduce: n,
            isNeutered: o,
            isFecondationReady: e.isFecondationReady,
            fecondationTime: e.fecondationTime
        };
        return n && (s.reproCount = t,
        s.reproMax = i),
        e.isNewborn && (s.isNewborn = !0),
        s
    }
    ,
    n.prototype._setFertilityState = function() {
        var e = n.getFertilityState(this.mountData)
          , t = !!e.canReproduce;
        t && this._fertilityValue.setText(e.reproCount + "/" + e.reproMax),
        this._fertilityDiv.toggleDisplay(t),
        this._cutButton.setEnable(t && !!this._getActionOnMount("sterilize")),
        this.fertileIcon.setFertileIcon(e, !0)
    }
    ,
    n.prototype._setFecondationState = function() {
        var e = this.mountData.isFecondationReady
          , t = this.mountData.fecondationTime
          , i = !e && t > -1;
        this._fecondationState.toggleDisplay(i),
        i && this._fecondationState.setText(u("ui.mount.pregnantSince", t))
    }
    ,
    n.prototype._setExperience = function(e, t, i) {
        i === -1 && (i = e);
        var n = (e - t) / (i - t);
        this._experienceValue.setValue(e, i, n)
    }
    ,
    n.prototype._resize = function() {
        return this.isVisible() && this.rootElement.clientWidth ? (this.mustResize = !1,
        void this._serenityGauge.resize()) : this.once("show", this._resize.bind(this))
    }
    ,
    n.prototype.setMount = function(e, t) {
        var i = this
          , n = window.gui.playerData;
        e = e || {},
        t = t || {};
        var o = this.inBreeding = "breeding" === t.context;
        this.hasDomAndListeners || this._setupDomAndListeners(),
        this.shouldResetTab && (this.shouldResetTab = !1,
        this._tabs.openTab(o ? I : T)),
        this.mustResize && this._resize(),
        this.mountData = e;
        var a = e.mountLocation;
        a || console.error("Mount", e.id, "does not have a location."),
        this._givenXpDiv.toggleDisplay("equip" === a),
        this._setXpRatio(e.xpRatio),
        this.domesticIcon.setEnabled(!e.isWild);
        var l = "equipped" === t.context;
        this._rideButtonDiv.toggleDisplay(l),
        this.mountableIcon.toggleDisplay(!l),
        l ? (this._rideButton.setEnable(e.isRideable),
        this._setRideButton(n.isRiding)) : this.mountableIcon.setEnabled(e.isRideable),
        this._setName(e.name),
        this._setSpecificBehaviors(e.behaviors),
        this._releaseButton.setEnable(!!this._getActionOnMount("free")),
        this._renameButton.setEnable("equip" === e.mountLocation || "shed" === e.mountLocation),
        this._feedButton.setEnable(e.maturity === e.maturityForAdult && ("shed" === this.mountData.mountLocation || "equip" === this.mountData.mountLocation) && "fight" !== window.foreground.tapOptions.mode),
        this._inventoryButton.setEnable(e.maxPods > 0 && "equip" === e.mountLocation && !o),
        this._level.setText(u("ui.common.short.level") + " " + e.level),
        this._setExperience(e.experience, e.experienceForLevel, e.experienceForNextLevel),
        this._setFecondationState(),
        this._setFertilityState(),
        this._setSex(e.sex),
        this._setEnergy(e.energy),
        this._setLove(e.love),
        this._setTiredness(e.boostLimiter),
        this._setStamina(e.stamina),
        this._setMaturity(e.maturity),
        this._setSerenity(e.serenity),
        this._mountType.setModel(e.model),
        s.preloadImage("gfx/mounts/" + e.model + ".png", function(e) {
            i._mountIllus.setStyle("backgroundImage", e)
        }),
        r.createEffectInstances(e.effectList, function(e, t) {
            var n = "<ul>"
              , o = "<li>" + u("ui.common.lowerNone", 0) + "</li>";
            if (e)
                return n += o + "</ul>",
                i._effectsContent.setHtml(o),
                console.error(e);
            if (t.length <= 0)
                return n += o + "</ul>",
                i._effectsContent.setHtml(o);
            for (var s = 0, a = t.length; s < a; s += 1) {
                var r = t[s];
                n += "<li>" + r.description + "</li>"
            }
            n += "</ul>",
            i._effectsContent.setHtml(n)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        r.call(this, "div", {
            className: ["gaugeIcon", e]
        }),
        i = i || {},
        this.name = e,
        this.createChild("div", {
            className: "icon"
        });
        var n = i.size || l
          , o = i.thickness || (n < l ? u : c);
        this.progressCircle = this.appendChild(new a({
            size: n,
            thickness: o,
            color: i.color || d[e],
            bgColor: i.bgColor || h,
            tooltip: t
        })),
        this.valueElt = i.withoutLabel ? null : this.createChild("div", {
            className: "value",
            text: ""
        })
    }
    i(664);
    var o = i(210)
      , s = i(26).inherits
      , a = i(665)
      , r = i(190)
      , l = 40
      , c = 2.5
      , u = 2
      , h = "#222"
      , d = {
        energy: "#ffcc00",
        stamina: "#ebae23",
        maturity: "#0099ff",
        love: "#ff1e1e"
    }
      , p = {
        stamina: .75,
        maturity: 1,
        love: .75
    }
      , m = .001;
    s(n, r),
    e.exports = n,
    n.prototype.setValue = function(e, t, i) {
        i = i || p[this.name] || m,
        this.valueElt && this.valueElt.setText(o.intToString(e));
        var n = !t || !i || e >= t * i;
        this.toggleClassName("enabled", n),
        this.progressCircle.setValue(e, t)
    }
    ,
    n.prototype.setLabel = function(e) {
        this.valueElt.setText(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        r.call(this, "div", {
            className: "ProgressCircle"
        }),
        this.addClassNames(e.className),
        this.size = e.size || l,
        this.thickness = e.thickness || Math.round(.15 * this.size),
        this.bgThickness = e.bgThickness || this.thickness + 2,
        this.color = e.color || "#EEE",
        this.bgColor = e.bgColor,
        e.tooltip && (this.tooltipText = e.tooltip,
        a.addTooltip(this, this._tooltipHandler.bind(this))),
        this.radius = (this.size - this.bgThickness) / 2,
        this.center = this.size / 2;
        var t = this.createChild("canvas", {
            className: "canvas"
        }).rootElement;
        t.width = this.size,
        t.height = this.size,
        t.style.width = this.size + "px",
        t.style.height = this.size + "px",
        this._ctx = t.getContext("2d")
    }
    var o = i(35).getText
      , s = i(26).inherits
      , a = i(206)
      , r = i(190)
      , l = 50;
    s(n, r),
    e.exports = n,
    n.prototype.setValue = function(e, t) {
        var i;
        t ? (this.value = e,
        i = e / t) : (this.value = e,
        i = e),
        this.maxValue = t;
        var n = this._ctx;
        this._ctx.clearRect(0, 0, n.canvas.width, n.canvas.height),
        this.bgColor && this._drawArc(this.bgThickness, this.bgColor, 1),
        this._drawArc(this.thickness, this.color, i)
    }
    ,
    n.prototype._drawArc = function(e, t, i) {
        i < .01 && 0 !== i && (i = .01),
        i > .99 && 1 !== i && (i = .99);
        var n = this._ctx;
        n.lineWidth = e,
        n.strokeStyle = t,
        n.beginPath(),
        n.arc(this.center, this.center, this.radius, -.5 * Math.PI, (2 * i - .5) * Math.PI, !1),
        n.stroke()
    }
    ,
    n.prototype._tooltipHandler = function() {
        var e = this.tooltipText + o("ui.common.colon");
        return this.maxValue ? e + this.value + " / " + this.maxValue : e + this.value + "%"
    }
}
, function(e, t) {
    e.exports = {
        LOCATION_EQUIPED: 1,
        LOCATION_INVENTORY: 2,
        LOCATION_STABLED: 3,
        LOCATION_MAP: 4
    }
}
, function(e, t, i) {
    function n() {
        return this.tooltipText
    }
    function o() {
        c.call(this, "div", {
            className: "mountType"
        }),
        this.color1 = this.createChild("div", {
            className: "color"
        }),
        this.color2 = this.createChild("div", {
            className: ["color", "color2"]
        }),
        l.addTooltip(this, n)
    }
    function s(e) {
        var t = e.split("|")[2];
        return t ? t.split(",").map(function(e) {
            var t = Number(e.split("=")[1]);
            return t || 0 === t ? "#" + t.toString(16) : null
        }) : []
    }
    i(668);
    var a = i(26).inherits
      , r = i(36)
      , l = i(206)
      , c = i(190);
    a(o, c),
    e.exports = o,
    o.prototype.setModel = function(e) {
        var t = this;
        r.getData("Mounts", e, function(i, n) {
            if (i)
                return console.error("Failed loading Mounts with id=", e);
            var o = s(n.look);
            t.color1.setStyle("backgroundColor", o[0]),
            t.color2.setStyle("backgroundColor", o[1]),
            t.color2.toggleDisplay(o[1] !== o[0]),
            t.tooltipText = n.nameId
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        r.call(this, "div", {
            className: "serenityGauge"
        }),
        e && this.addClassNames("mini"),
        this.isMini = e,
        e || this.createChild("div", {
            className: ["bigIcon", "bigIcon_mad"]
        });
        var t = this.createChild("div", {
            className: "barWrapper"
        })
          , i = this._serenityBar = t.createChild("div", {
            className: "serenityBar"
        });
        this.zones = [],
        this._createColorZone("stamina", l, c, o("ui.mount.viewerTooltipZone1")),
        this._createColorZone("maturity", c, u, o("ui.mount.viewerToolTipZone2")),
        this._createColorZone("love", u, h, o("ui.mount.viewerTooltipZone3")),
        this._serenityBarCursor = i.createChild("div", {
            className: "cursor"
        }),
        e || (this._serenityValue = this._serenityBarCursor.createChild("div", {
            className: "value"
        })),
        t.createChild("div", {
            className: "background"
        }),
        e || this.createChild("div", {
            className: ["bigIcon", "bigIcon_happy"]
        })
    }
    i(670);
    var o = i(35).getText
      , s = i(26).inherits
      , a = i(206)
      , r = i(190)
      , l = -1e4
      , c = -2e3
      , u = 2e3
      , h = 1e4
      , d = 73
      , p = 50;
    s(n, r),
    e.exports = n,
    n.prototype._createColorZone = function(e, t, i, n) {
        var s = this._serenityBar.createChild("div", {
            className: ["colorZone", e]
        });
        this.isMini || (s.createChild("div", {
            className: "icon"
        }),
        a.addTooltip(s, o("tablet.mount.serenityZoneTooltip", t, i, n))),
        s.name = e,
        s.min = t,
        s.max = i,
        this.zones.push(s),
        this._serenityBar[e] = s
    }
    ,
    n.prototype.resize = function() {
        this.isMini ? (this.serenityBarWidth = d,
        this.serenityCursorOffset = -p / 2) : (this.serenityBarWidth = this._serenityBar.rootElement.clientWidth,
        this.serenityCursorOffset = -this._serenityBarCursor.rootElement.clientWidth / 2);
        for (var e = h - l, t = this._serenityBar.maturity, i = (t.max - t.min) / e * this.serenityBarWidth / 2, n = 0, o = this.zones, s = 0; s < o.length; s++) {
            var a = o[s]
              , r = (a.max - a.min) / e
              , c = r * this.serenityBarWidth;
            "maturity" !== a.name && (c += i),
            "stamina" !== a.name && (n -= i),
            a.setStyle("left", n + "px"),
            a.setStyle("width", c + "px"),
            n += c
        }
        this._serenityBar.maturity.setStyles({
            borderBottomLeftRadius: i + "px",
            borderTopRightRadius: i + "px"
        })
    }
    ,
    n.prototype.setValue = function(e) {
        this.isMini || this._serenityValue.setText(e);
        var t = (e - l) / (h - l)
          , i = t * this.serenityBarWidth + this.serenityCursorOffset;
        this._serenityBarCursor.setStyle("left", i + "px"),
        this._serenityBar.stamina.toggleClassName("disabled", e >= 0),
        this._serenityBar.maturity.toggleClassName("disabled", e < c || e > u),
        this._serenityBar.love.toggleClassName("disabled", e <= 0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        l.call(this, "div", {
            className: ["statusIcon", e]
        }),
        t = t || {},
        this.isEnabled = !1,
        this.tooltipText = t.tooltip,
        void 0 !== t.tooltip && r.addTooltip(this, o)
    }
    function o() {
        return this.isEnabled === !1 ? new l("div",{
            className: "disabledTooltipFeature",
            text: this.tooltipText
        }) : this.tooltipText
    }
    i(672);
    var s = i(35).getText
      , a = i(26).inherits
      , r = i(206)
      , l = i(190);
    a(n, l),
    e.exports = n,
    n.prototype.setEnabled = function(e) {
        this.isEnabled = e,
        this.toggleClassName("disabled", !e)
    }
    ,
    n.prototype.setFertileIcon = function(e, t) {
        var i = !1;
        if (e.isNewborn)
            this.replaceClassNames(["disabled", "fertile", "pregnant", "sterile"], ["newborn"]),
            this.tooltipText = s("ui.mount.filterBorn");
        else if (e.fecondationTime >= 0)
            this.replaceClassNames(["disabled", "fertile", "neutered", "newborn", "sterile"], ["pregnant"]),
            this.tooltipText = s("ui.mount.pregnantSince", e.fecondationTime);
        else if (e.canReproduce) {
            if (!e.isFecondationReady && !t)
                return void this.hide();
            this.replaceClassNames(["pregnant", "neutered", "newborn", "sterile"], ["fertile"]),
            i = t && !e.isFecondationReady,
            this.toggleClassName("disabled", i),
            this.tooltipText = s("ui.mount.fecondable")
        } else {
            this.replaceClassNames(["disabled", "fertile", "pregnant", "newborn"], ["sterile"]);
            var n = e.isNeutered;
            this.toggleClassName("neutered", n),
            this.tooltipText = s(n ? "ui.mount.castrated" : "ui.mount.sterilized")
        }
        this.show(),
        this.isEnabled = !i
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        var i = e.id;
        v.call(this, "div", {
            className: "mountBox",
            name: i,
            hidden: !0
        }),
        "certificate" === t.id && this.addClassNames("certificate"),
        this.id = i,
        this.room = t,
        this.mountData = e,
        this.selected = !1,
        this.renderingFg = null ,
        this.detailLevel = C
    }
    function o() {
        var e = this.mountBox;
        e.room.breedingWindow.tileTapHandler(e)
    }
    function s() {
        return o.call(this.foreground)
    }
    function a() {
        this.cancelTap();
        var e = this.foreground.mountBox.mountData.certificate.mountInfo
          , t = e.ownerDesc + "\n" + e.validityDesc;
        _.showNotification(t, this)
    }
    function r(e) {
        var t = "certificate" === e.id
          , i = t ? ["fg", "certificate"] : "fg"
          , n = new v("div",{
            className: i,
            hidden: !0
        });
        if (n.mountBox = null ,
        g(n, {
            doubletapTimeout: 1
        }),
        n.on("tap", o),
        n.dragInfo = new c(e.breedingWindow,n),
        n._mountName = n.createChild("div", {
            className: "mountName"
        }),
        n._mountImg = n.createChild("div", {
            className: "mountImg"
        }),
        t) {
            n._certifValidity = n.createChild("div", {
                className: "certifValidity"
            });
            var r = n.createChild("div", {
                className: "certifImg"
            });
            g(r, {
                doubletapTimeout: 1
            }),
            r.foreground = n,
            r.on("tap", s),
            r.on("longtap", a)
        } else {
            n._level = n.createChild("div", {
                className: "level"
            }),
            n._fertileIcon = n.appendChild(new f("fertile"));
            var l = n.gaugeDiv = n.createChild("div", {
                className: ["gaugeDiv", "partial"]
            })
              , h = l.createChild("div", {
                className: "iconGaugeBar"
            });
            n._staminaGauge = h.appendChild(new u("stamina",null ,{
                size: y,
                withoutLabel: !0
            })),
            n._maturityGauge = h.appendChild(new u("maturity",null ,{
                size: y,
                withoutLabel: !0
            })),
            n._loveGauge = h.appendChild(new u("love",null ,{
                size: y,
                withoutLabel: !0
            })),
            n._serenityGauge = l.appendChild(new m((!0))),
            n._serenityGauge.resize()
        }
        return n
    }
    i(674);
    var l = i(5)
      , c = i(655)
      , u = i(663)
      , h = i(35).getText
      , d = i(26).inherits
      , p = i(661)
      , m = i(669)
      , f = i(671)
      , g = i(32)
      , _ = i(206)
      , v = i(190)
      , y = 27
      , w = 4
      , b = 2
      , C = 0
      , I = 1
      , T = 2
      , S = {};
    S.shed = [],
    S.paddock = [],
    S.certificate = [];
    var A = {};
    d(n, v),
    e.exports = n,
    n.freeContent = function() {
        S.shed = [],
        S.paddock = [],
        S.certificate = []
    }
    ,
    n.prototype.setSpinnerVisible = function(e) {
        this.renderingFg && this.renderingFg.toggleClassName("spinner", !!e)
    }
    ,
    n.prepareTilePool = function(e, t) {
        for (var i = S[e.id], n = t - i.length, o = 0; o < n; o++) {
            var s = e.box.appendChild(r(e));
            i.push(s)
        }
    }
    ,
    n.prototype._createTile = function() {
        var e = this.room
          , t = S[e.id]
          , i = t.pop();
        i || (i = e.box.appendChild(r(e))),
        i.mountBox = this,
        this.renderingFg = i
    }
    ,
    n.prototype._moveTile = function(e) {
        var t = this.renderingFg;
        if (t.index !== e) {
            var i = this.room
              , n = i.numColumns
              , o = Math.floor(e / n) * i.rowHeight
              , s = e % n * i.columnWidth;
            t.index = e,
            t.setStyle("webkitTransform", "translate3d(" + s + "px, " + o + "px, 0)")
        }
    }
    ,
    n.prototype._releaseTileContent = function() {
        var e = S[this.room.id];
        e.push(this.renderingFg),
        this.renderingFg = null ,
        this.detailLevel = C
    }
    ,
    n.prototype._updateTileContent = function(e) {
        var t = this.renderingFg;
        if (t) {
            this.detailLevel = e;
            var i = this.mountData;
            if (t._mountName.setText(i.name || h("ui.common.noName")),
            t._mountName.toggleClassName("noName", !i.name),
            i.certificate) {
                var n = i.receivedData;
                t._mountName.toggleClassName("sexUnknown", !n),
                t._mountName.toggleClassName("female", !!n && n.sex);
                var o = i.certificate.mountInfo;
                this._setValidity(t._certifValidity, o.validityDays, o.validityHours, o.validityMinutes)
            } else {
                t._mountName.toggleClassName("female", !!i.sex),
                t._level.setText(h("ui.common.short.level") + " " + i.level);
                var s = p.getFertilityState(i);
                t._fertileIcon.setFertileIcon(s),
                e === T ? (t.gaugeDiv.delClassNames("partial"),
                t._staminaGauge.setValue(i.stamina, i.staminaMax),
                t._maturityGauge.setValue(i.maturity, i.maturityForAdult),
                t._loveGauge.setValue(i.love, i.loveMax),
                t._serenityGauge.setValue(i.serenity)) : t.gaugeDiv.addClassNames("partial")
            }
            t.dragInfo.setMount(i, t._mountImg),
            this._retrieveMountImgUrl(t._mountImg, i.model),
            t.show()
        }
    }
    ,
    n.prototype._retrieveMountImgUrl = function(e, t) {
        var i = A[t];
        return i ? e.setStyle("backgroundImage", i) : void l.preloadImage("gfx/mounts/" + t + ".png", function(t) {
            e.setStyle("backgroundImage", t)
        })
    }
    ,
    n.prototype._setValidity = function(e, t, i, n) {
        var o = h("tablet.common.validity") + h("ui.common.colon");
        o += t > 0 ? t + " " + h("ui.time.days", t) : i > 0 ? i + " " + h("ui.time.hours", i) : n + " " + h("ui.time.minutes", n),
        e.toggleClassName("expiringSoon", t < w && t >= b),
        e.toggleClassName("expiringVerySoon", t < b),
        e.setText(o)
    }
    ,
    n.prototype.refreshDisplay = function() {
        this._updateTileContent(T)
    }
    ,
    n.prototype.setTileSelected = function(e) {
        this.selected = e,
        this.toggleClassName("selected", e),
        this.delClassNames("focusedTile")
    }
    ,
    n.prototype.highlightTile = function() {
        this.selected = !0,
        this.addClassNames("focusedTile")
    }
    ,
    n.prototype.prepareToShow = function(e, t) {
        if (this.renderingFg && this.renderingFg.index < 0 && this._moveTile(e),
        1 === t) {
            if (this.detailLevel >= I)
                return !1;
            this._createTile(),
            this._moveTile(e),
            this._updateTileContent(I)
        } else if (2 === t) {
            if (this.detailLevel === T)
                return !1;
            this._updateTileContent(T)
        }
        return !0
    }
    ,
    n.prototype.prepareToGoOffScreen = function() {
        this.renderingFg && this._releaseTileContent()
    }
    ,
    n.prototype.showTile = function() {
        this.show()
    }
    ,
    n.prototype.hideTile = function() {
        this.hide(),
        this.renderingFg && (this.renderingFg.hide(),
        this._releaseTileContent())
    }
    ,
    n.hidePoolTiles = function(e) {
        for (var t = S[e.id], i = t.length - 1; i >= 0; i--)
            t[i].hide()
    }
    ,
    n.prototype.markForReorder = function() {
        this.renderingFg && (this.renderingFg.index = -1)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        p.call(this, "div", {
            className: ["MountFilterBox", "transition"]
        }),
        this.mountFilters = new r,
        this._activeFilters = {},
        this.defaultExpandedSections = {
            text: !0,
            type: !0,
            breeding: !0
        },
        this.flagMap = [],
        this.filterSections = {},
        this.filterBoxes = {};
        var e = this;
        this.isResetPending = !1,
        this.flagMap[f] = !0,
        this.flagMap[g] = !1,
        this.flagMap[m] = null ,
        this.mountFilters.ready ? this._createDom() : this.mountFilters.once("ready", function() {
            e._createDom()
        })
    }
    i(676);
    var o = i(35).getText
      , s = i(26).inherits
      , a = i(391)
      , r = i(677)
      , l = i(393)
      , c = i(678)
      , u = i(302)
      , h = i(204)
      , d = i(32)
      , p = i(190)
      , m = 1
      , f = 0
      , g = 2;
    s(n, p),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this;
        this._setupFilterSections(),
        this._setupSearchBar(),
        this._setupTypeSelector(),
        this._setupFilterBoxes(),
        this.appendChild(new h({
            text: o("ui.common.reset"),
            className: ["button", "resetButton"]
        },function() {
            e.resetFilters(),
            e._emitUpdate()
        }
        )),
        this.ready = !0,
        e.resetFilters(),
        this.emit("ready")
    }
    ,
    n.prototype._emitUpdate = function() {
        this.isResetPending || (this._highlightHeaders(),
        this.emit("activeFiltersUpdated", this._activeFilters))
    }
    ,
    n.prototype._setupFilterSections = function() {
        function e() {
            this.isCollapsed = !this.isCollapsed;
            var e = t.filterSections[this.categoryId];
            this.toggleClassName("collapse", this.isCollapsed),
            e.toggleClassName("collapse", this.isCollapsed),
            window.setTimeout(function() {
                t.sectionsContainer.refresh()
            }, 250)
        }
        var t = this
          , i = this.mountFilters.categories;
        this.sectionsContainer = this.appendChild(new u({
            className: "sectionsContainer"
        }));
        for (var n = 0; n < i.length; n += 1) {
            var o = i[n]
              , s = this.sectionsContainer.content.createChild("div", {
                className: "sectionHeader"
            });
            s.arrow = s.createChild("div", {
                className: "sectionArrow"
            }),
            s.title = s.createChild("div", {
                className: "sectionTitle",
                text: o.name
            }),
            s.categoryId = o.id;
            var a = this.filterSections[o.id] = this.sectionsContainer.content.createChild("div", {
                className: ["transition", "filterSection", o.id]
            });
            this.defaultExpandedSections[o.id] || e.call(s),
            d(s),
            a.sectionHeader = s,
            s.on("tap", e)
        }
    }
    ,
    n.prototype._setupSearchBar = function() {
        function e(e) {
            n.searchStr = (e || "").toLowerCase(),
            n.searchStr ? (n._activeFilters.text = n.mountFilters.filterMap.text,
            n._activeFilters.text.args = e,
            n._activeFilters.text.name = '"' + e + '"') : delete n._activeFilters.text,
            i.toggleDisplay(!!e),
            e ? t.enable() : t.disable(),
            t.toggleClassName("disabled", !e),
            n._emitUpdate()
        }
        var t, i, n = this, s = this.mountFilters.categories[this.mountFilters.catEnum.TEXT].id, r = this.filterSections[s], l = this.searchInput = r.appendChild(new a({
            className: "searchInput"
        })), c = o("ui.common.search");
        l.setPlaceholder(c.charAt(0).toUpperCase() + c.slice(1)),
        l.on("change", e),
        t = r.createChild("div", {
            className: ["clearSearchButton", "disabled"]
        }),
        d(t),
        t.disable(),
        i = r.createChild("div", {
            className: "searchActive",
            text: "*",
            hidden: !0
        }),
        t.on("tap", function() {
            n._clearSearchInput()
        })
    }
    ,
    n.prototype._setupFilterBoxes = function() {
        function e() {
            var e = this.filterBox.getChild("slider");
            this.anti ? e.setGrip(g) : e.setGrip(f)
        }
        for (var t = this.mountFilters.categories[this.mountFilters.catEnum.TYPE].id, i = 0; i < this.mountFilters.filters.length; i += 1) {
            var n = this.mountFilters.filters[i];
            if (!("text" === n.id || n.id.indexOf(t) > -1)) {
                var s = this.filterSections[n.category].createChild("div", {
                    className: "filterBox"
                });
                this.filterBoxes[n.id] = s;
                var a, r = s.label = s.createChild("div", {
                    className: "filterLabel",
                    text: n.name
                });
                n.interval || (a = s.createChild("div", {
                    className: "filterAntiLabel",
                    text: n.antiName || o("tablet.mount.filter.not")
                })),
                n.interval ? s.appendChild(this._createRangeSlider(n)) : (r.filterBox = s,
                d(r),
                r.on("tap", e),
                a && (a.filterBox = s,
                a.anti = !0,
                d(a),
                a.on("tap", e)),
                s.appendChild(this._createFlagSlider(n)))
            }
        }
    }
    ,
    n.prototype._setupTypeSelector = function() {
        function e(e) {
            if (t.selectedTypeFilterId !== e) {
                if (delete t._activeFilters[t.selectedTypeFilterId],
                e) {
                    var i = t.mountFilters.filterMap[e];
                    t._activeFilters[e] = i,
                    t._activeFilters[e].args = e
                }
                t.selectedTypeFilterId = e,
                t._emitUpdate()
            }
        }
        var t = this
          , i = this.mountFilters.categories[this.mountFilters.catEnum.TYPE].id
          , n = this.filterSections[i];
        this.typeSelector = n.appendChild(new l({
            className: "typeSelector"
        })),
        this.typeSelector.addOption(o("tablet.mount.filter.allTypes")),
        this.typeSelector.on("change", e);
        for (var s = 0; s < this.mountFilters.filters.length; s += 1) {
            var a = this.mountFilters.filters[s];
            a.id.indexOf(i) !== -1 && "text" !== a.id && this.typeSelector.addOption(a.name, a.id)
        }
    }
    ,
    n.prototype._highlightHeaders = function() {
        var e;
        for (e in this.filterSections)
            this.filterSections[e].sectionHeader.delClassNames("active");
        for (e in this._activeFilters) {
            var t = this._activeFilters[e]
              , i = this.filterSections[t.category].sectionHeader;
            i.addClassNames("active")
        }
    }
    ,
    n.prototype._clearSearchInput = function() {
        this.searchInput.setValue(""),
        this.searchInput.emit("change", "")
    }
    ,
    n.prototype._createFlagSlider = function(e) {
        function t(t) {
            var n = i.filterBoxes[this.filterId];
            if (t !== n.snapId) {
                n.snapId = t;
                var o = i.flagMap[t]
                  , s = [o];
                2 === e["do"].length && s.push(e.id),
                null !== o ? (i._activeFilters[e.id] = e,
                i._activeFilters[e.id].args = s) : delete i._activeFilters[e.id],
                n.setClassNames(["filterBox", "flag" + t]),
                i._emitUpdate()
            }
        }
        var i = this
          , n = new c({
            name: "slider",
            numSnaps: 3
        });
        return n.filterId = e.id,
        n.labelSnap(m, o("tablet.mount.filter.slider.all")),
        n.on("setGrip", t),
        n
    }
    ,
    n.prototype._createRangeSlider = function(e) {
        function t() {
            i.call(this),
            n._emitUpdate()
        }
        function i() {
            var t = n.filterBoxes[this.filterId]
              , i = [];
            for (var s in this.grips) {
                var a = this.grips[s]
                  , r = a.snapValue = e.min + e.interval * a.snapId;
                i[s] = r
            }
            var l = this.grips[0].snapValue
              , c = this.grips[1].snapValue;
            l !== e.min || c !== e.max ? (n._activeFilters[e.id] = e,
            n._activeFilters[e.id].args = i,
            t.label.setText(e.name + " (" + l + " " + o("tablet.mount.filter.to") + " " + c + ")"),
            t.addClassNames("on")) : (delete n._activeFilters[e.id],
            t.label.setText(e.name),
            t.delClassNames("on"))
        }
        var n = this
          , s = (Math.abs(e.min) + Math.abs(e.max)) / e.interval + 1
          , a = new c({
            name: "slider",
            numSnaps: s,
            numGrips: 2,
            isRange: !0
        });
        a.filterId = e.id;
        for (var r = 0; r < s; r += 1) {
            var l, u = e.min + e.interval * r;
            l = e.criticalValues ? e.criticalValues.indexOf(u) > -1 ? u : "" : u,
            e.formatValue && l && (l = e.formatValue(u)),
            a.labelSnap(r, l)
        }
        return a.on("setGrip", t),
        a.on("slideGrip", i),
        a
    }
    ,
    n.prototype.resetFilters = function() {
        if (this.ready) {
            this.isResetPending = !0;
            for (var e in this.filterBoxes) {
                var t = this.filterBoxes[e].getChild("slider");
                if (t) {
                    var i = Object.keys(t.grips).length
                      , n = Object.keys(t.snaps).length;
                    1 === i ? t.setGrip(1, void 0) : 2 === i && (t.setGrip(0, 0),
                    t.setGrip(n - 1, 1))
                }
            }
            this._clearSearchInput(),
            this.typeSelector.selectFirst(),
            this.isResetPending = !1
        }
    }
    ,
    n.prototype.updateTypeSelector = function(e) {
        if (!this.ready)
            return void this.once("ready", function() {
                this.updateTypeSelector(e)
            });
        e = e || [];
        for (var t, i = this.mountFilters.allTypeIds, n = 0; n < i.length; n += 1) {
            t = i[n];
            var o = e.indexOf(t) < 0;
            this.typeSelector.setOptionHidden(n + 1, o)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        o.call(this);
        var e = this
          , t = this.catEnum = {
            TEXT: 0,
            TYPE: 1,
            BREEDING: 2,
            MOOD: 3,
            ABILITY: 4
        }
          , i = this.categories = [{
            id: "text",
            name: s("ui.common.name")
        }, {
            id: "type",
            name: s("tablet.mount.type")
        }, {
            id: "breeding",
            name: s("tablet.mount.breeding")
        }, {
            id: "mood",
            name: s("tablet.mount.mood")
        }, {
            id: "ability",
            name: s("tablet.mount.abilities")
        }];
        this.allTypeIds = [],
        this.filterMap = {},
        this.ready = !1,
        this.filters = [{
            id: "text",
            "do": function(e) {
                return this.name.toLowerCase().indexOf(e) > -1
            },
            category: i[t.TEXT].id
        }, {
            id: "sex",
            name: s("ui.common.animalFemale"),
            antiName: s("ui.common.animalMale"),
            "do": function(e) {
                return this.sex === e
            },
            category: i[t.BREEDING].id
        }, {
            id: "baby",
            name: s("tablet.mount.filterNewborn"),
            "do": function(e) {
                var t = !!this.isNewborn;
                return t === e
            },
            category: i[t.BREEDING].id
        }, {
            id: "fruitful",
            name: s("tablet.mount.filterFertile"),
            "do": function(e) {
                var t = this.isFecondationReady
                  , i = !t && h.indexOf(this.reproductionCount) === -1 && this.level >= u;
                return t && e || i && !e
            },
            category: i[t.BREEDING].id
        }, {
            id: "fertilized",
            name: s("tablet.mount.filterPregnant"),
            "do": function(e) {
                return this.fecondationTime > 0 === e && void 0 !== this.fecondationTime
            },
            category: i[t.BREEDING].id
        }, {
            id: "mountable",
            name: s("tablet.mount.filterMountable"),
            "do": function(e) {
                return this.isRideable === e
            },
            category: i[t.BREEDING].id
        }, {
            id: "sterilized",
            name: s("tablet.mount.filterSterilized"),
            "do": function(e) {
                return h.indexOf(this.reproductionCount) > -1 === e
            },
            category: i[t.BREEDING].id
        }, {
            id: "love",
            name: s("tablet.mount.filterNeedLove"),
            "do": function(e) {
                return this.love < d === e
            },
            category: i[t.MOOD].id
        }, {
            id: "stamina",
            name: s("tablet.mount.filterNeedStamina"),
            "do": function(e) {
                return this.stamina < d === e
            },
            category: i[t.MOOD].id
        }, {
            id: "maturity",
            name: s("tablet.mount.filterNeedMaturity"),
            "do": function(e) {
                return this.maturity < this.maturityForAdult === e
            },
            category: i[t.MOOD].id
        }, {
            id: "energy",
            name: s("tablet.mount.filterNeedEnergy"),
            "do": function(e) {
                return this.energy < this.energyMax === e
            },
            category: i[t.MOOD].id
        }, {
            id: "serenityRange",
            name: s("ui.common.serenity"),
            min: -l,
            max: l,
            interval: 500,
            criticalValues: [-l, -c, 0, c, l],
            formatValue: function(e) {
                return e && e / 1e3 + "k" || e
            },
            "do": function(e, t) {
                return this.serenity >= e && this.serenity <= t
            },
            category: i[t.MOOD].id
        }, {
            id: "fatigue",
            name: s("ui.common.tire"),
            min: 0,
            max: 100,
            interval: 50,
            criticalValues: [0, 50, 100],
            formatValue: function(e) {
                return e + "%"
            },
            "do": function(e, t) {
                return this.boostLimiter >= e && this.boostLimiter <= t
            },
            category: i[t.MOOD].id
        }],
        this.on("ready", this._buildFilterMap),
        this._setupAbilities(function() {
            e._setupTypes(function() {
                e.ready = !0,
                e.emit("ready")
            })
        })
    }
    var o = i(16).EventEmitter
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(36)
      , l = 1e4
      , c = 2e3
      , u = 5
      , h = [-1, 20]
      , d = 7500;
    a(n, o),
    e.exports = n,
    n.prototype._setupAbilities = function(e) {
        function t(e, t) {
            for (var i = !1, o = 0; o < this.behaviors.length && !(i = n + this.behaviors[o] === t); o += 1)
                ;
            return i && e || !i && !e
        }
        var i = this
          , n = this.categories[this.catEnum.ABILITY].id;
        r.getAllDataTable("MountBehaviors", function(o, s) {
            if (o)
                return console.error(o);
            for (var a = 0; a < s.length; a += 1) {
                var r = s[a]
                  , l = {
                    id: n + r.id,
                    name: r.nameId,
                    "do": t,
                    category: n
                };
                i.filters.push(l)
            }
            i.emit("setupAbilities"),
            e && e()
        })
    }
    ,
    n.prototype._setupTypes = function(e) {
        function t(e) {
            var t = n + this.model === e;
            return t
        }
        var i = this
          , n = this.categories[this.catEnum.TYPE].id;
        r.getAllDataTable("Mounts", function(o, s) {
            if (o)
                return console.error(o);
            i.allTypeIds = [];
            for (var a = 0; a < s.length; a += 1) {
                var r = s[a]
                  , l = {
                    id: n + r.id,
                    name: r.nameId.replace("Dragoturkey", ""),
                    "do": t,
                    category: n
                };
                i.filters.push(l),
                i.allTypeIds.push(r.id)
            }
            i.emit("updateTypes"),
            e && e()
        })
    }
    ,
    n.prototype._buildFilterMap = function() {
        for (var e = 0; e < this.filters.length; e += 1) {
            var t = this.filters[e];
            this.filterMap[t.id] = t
        }
    }
}
, function(e, t, i) {
    function n(e) {
        a.call(this, "div", {
            className: "SnapSlider",
            name: e.name || ""
        }),
        e = e || {},
        this.isRange = !!e.isRange,
        this.isRange && this.addClassNames("range"),
        this.numSnaps = e.numSnaps || c,
        this.numGrips = e.numGrips || u,
        this.rail = {},
        this.grips = {},
        this.snaps = {},
        this._setupRail(),
        this._setupSnaps()
    }
    i(679);
    var o = i(26).inherits
      , s = i(33).getPosition
      , a = i(190)
      , r = i(204)
      , l = i(47)
      , c = 3
      , u = 1
      , h = 7
      , d = 14
      , p = 5;
    o(n, a),
    e.exports = n,
    n.prototype._setupRail = function() {
        function e() {
            if (u && (u = !1,
            n.removeListener("dom.touchmove", t),
            c)) {
                c = !1,
                n.delClassNames("sliding");
                var e = n.activeGrip;
                if (e) {
                    var i = n.getClosestSnap(e);
                    n.setGrip(i.id, e.id)
                }
            }
        }
        function t(t) {
            if (u) {
                var i = n.activeGrip;
                if (i) {
                    var h = s(t).x - n._railBox.left;
                    if (!c) {
                        if (Math.abs(r - h) < p)
                            return;
                        if (!l.requestInteractionHandle(n))
                            return e();
                        n.addClassNames("sliding"),
                        c = !0
                    }
                    h < o ? h = o : h > a && (h = a),
                    i.delClassNames("transition"),
                    i.setStyle("webkitTransform", "translate3d(" + h + "px, 0, 0)"),
                    i.x = h,
                    i.snapId = n.getClosestSnap(i).id,
                    n.isRange && n._updateRangeDisplay(),
                    n.emit("slideGrip", i.id, h)
                }
            }
        }
        function i(e) {
            if (!u) {
                u = !0,
                n._railBox = n.rail.rootElement.getBoundingClientRect(),
                r = s(e).x - n._railBox.left,
                n.activeGrip = n._getClosestGrip(r);
                var i = n.grips[n.activeGrip.id - 1];
                o = i && i.x + d || 0;
                var l = n.grips[n.activeGrip.id + 1];
                a = l && l.x + d || n._railBox.width,
                n.on("dom.touchmove", t)
            }
        }
        var n = this;
        this.rail = this.createChild("div", {
            className: "rail"
        }),
        this._railBox = null ;
        var o, a, r, c, u;
        this.allowDomEvents(),
        this.on("dom.touchstart", i),
        this.on("dom.touchend", e)
    }
    ,
    n.prototype._setupSnaps = function() {
        function e() {
            if (l.isHandleFree()) {
                var e = i._getClosestGrip(this.x);
                i.setGrip(this.id, e.id)
            }
        }
        var t, i = this, n = 100 / (this.numSnaps - 1);
        for (t = 0; t < this.numSnaps; t += 1) {
            var o = this.snaps[t] = this.rail.appendChild(new r({
                className: "snap"
            },e));
            o.createChild("div", {
                className: "display"
            }),
            o.id = t,
            o.x = 0,
            o.setStyle("left", n * t + "%")
        }
        for (t = 0; t < this.numGrips; t += 1) {
            var s = this.grips[t] = this.createChild("div", {
                className: "grip",
                name: "grip" + t
            });
            s.createChild("div", {
                className: "display"
            }),
            s.id = t,
            s.x = 0
        }
    }
    ,
    n.prototype._getClosestGrip = function(e) {
        var t, i = this._railBox.width;
        for (var n in this.grips) {
            var o = this.grips[n]
              , s = Math.abs(o.x - e);
            (s <= i || !t) && (i = s,
            t = o)
        }
        return t
    }
    ,
    n.prototype._initSlider = function() {
        this._railBox = this.rail.rootElement.getBoundingClientRect();
        var e = this._railBox.width / (this.numSnaps - 1);
        for (var t in this.snaps) {
            var i = this.snaps[t];
            i.x = Math.floor(e * i.id),
            i.setStyle("left", i.x - h + "px")
        }
    }
    ,
    n.prototype.setGrip = function(e, t, i) {
        if (!(e < 0 || e > this.numSnaps - 1)) {
            this._railBox || this._initSlider(),
            t = void 0 !== t ? t : 0;
            var n = this.grips[t]
              , o = this.snaps[e];
            n.addClassNames("transition"),
            n.x = o.x,
            n.setStyle("webkitTransform", "translate3d(" + n.x + "px, 0, 0)"),
            this.grips[t].snapId = e,
            this.isRange && this._updateRangeDisplay(),
            i || this.emit("setGrip", e, t),
            n === this.activeGrip && delete this.activeGrip
        }
    }
    ,
    n.prototype.labelSnap = function(e, t) {
        var i = this.snaps[e];
        e < 0 || e > this.numSnaps - 1 || !i || (i.label || (i.label = i.createChild("div", {
            className: "label"
        })),
        i.label.setText(t))
    }
    ,
    n.prototype.getClosestSnap = function(e) {
        if (e) {
            var t = this._railBox.width / (this.numSnaps - 1)
              , i = Math.floor((e.x - t / 2) / t) + 1;
            return this.snaps[i]
        }
    }
    ,
    n.prototype._updateRangeDisplay = function() {
        for (var e = 0 === this.grips[0].snapId && this.grips[1].snapId === this.numSnaps - 1, t = 0; t < this.numSnaps; t += 1) {
            var i = !e && t >= this.grips[0].snapId && t <= this.grips[1].snapId;
            this.snaps[t].toggleClassName("inRange", i)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i, n) {
        c.call(this),
        this.breedingWindow = e,
        this.id = t,
        this.name = i || "",
        this.capacity = n || Number.POSITIVE_INFINITY,
        this.box = null ,
        this.reset()
    }
    function o() {
        var e = this.room;
        e.scrollStartTime = Date.now(),
        e.isScrolling = !0,
        e.refreshInterval || (e.refreshInterval = window.setInterval(r, v, e))
    }
    function s() {
        this.room.isScrolling = !1
    }
    function a() {
        var e = this.room;
        e.isScrolling = !1,
        e._stopTicker()
    }
    function r(e) {
        Date.now() - e.scrollStartTime < y || (e._refreshView(),
        e.isRefreshComplete && !e.isScrolling && e._stopTicker())
    }
    function l(e, t, i, n, o, s) {
        if (n <= i)
            return 0;
        var a, r, l;
        o ? (l = -1,
        a = n - 1,
        r = i - 1) : (l = 1,
        a = i,
        r = n);
        for (var c = 0, u = a; u !== r && (!t[u].prepareToShow(u, e) || (c++,
        !s || c !== s)); u += l)
            ;
        return c
    }
    i(681);
    var c = i(16)
      , u = i(26).inherits
      , h = i(605).isEmptyObject
      , d = i(673)
      , p = i(302)
      , m = 4
      , f = 37
      , g = 14
      , _ = 1.5
      , v = 90
      , y = 100
      , w = 2;
    u(n, c),
    e.exports = n,
    n.prototype.reset = function() {
        this.delayedSetup = 0,
        this._stopTicker(),
        this.refreshInterval = null ,
        this.lastRenderedScrollY = -1,
        this.scrollStartTime = 0,
        this.isScrolling = !1,
        this.isRefreshComplete = !0,
        this.numMounts = 0,
        this.mountMap = {},
        this.selectedTiles = {},
        this.numSelected = 0,
        this.isLocked = !1,
        this.needsScrollerRefresh = !1,
        this.needRefilter = !1,
        this.hasNoFilter = !0,
        this.hasNoSorter = !0,
        this.currentSorter = "",
        this.tilesPerPage = 0,
        this.allTiles = [],
        this.allVisibleTiles = [],
        this.box && (this.box.clearContent(),
        this.scroller.goToTop())
    }
    ,
    n.prototype.createBox = function(e) {
        var t = this.scroller = e.appendChild(new p(null ,{
            maxSpeed: _,
            bounce: !0
        }));
        t.room = this,
        t.setStyle("maxHeight", e.rootElement.clientHeight + "px"),
        t.on("scrollStart", o),
        t.on("scrollEnd", s),
        t.on("scrollCancel", a);
        var i = t.content.createChild("div", {
            className: ["roomBox", this.id]
        });
        return this.box = i.createChild("div", {
            className: "tileRoom"
        }),
        this.scrollGrip = i.createChild("div", {
            className: "scrollGrip"
        }),
        t
    }
    ,
    n.prototype.getTile = function(e) {
        return this.box.getChild(e)
    }
    ,
    n.prototype.setMountSelected = function(e, t) {
        var i = this.getTile(e);
        return i ? (t ? i.selected || (this.selectedTiles[e] = i,
        this.numSelected++) : i.selected && (delete this.selectedTiles[e],
        this.numSelected--),
        i.setTileSelected(t),
        i) : console.error("Invalid tileId:", e)
    }
    ,
    n.prototype.setHightlightedMount = function(e) {
        var t = this.setMountSelected(e, !0);
        t.highlightTile()
    }
    ,
    n.prototype.selectAll = function() {
        for (var e = this.allVisibleTiles, t = 0; t < e.length; t++) {
            var i = e[t];
            i.selected || (this.selectedTiles[i.id] = i,
            i.setTileSelected(!0))
        }
        this.numSelected = e.length
    }
    ,
    n.prototype.unselectAll = function() {
        for (var e in this.selectedTiles) {
            var t = this.selectedTiles[e];
            t.setTileSelected(!1)
        }
        this.selectedTiles = {},
        this.numSelected = 0
    }
    ,
    n.prototype.getSelection = function() {
        return Object.keys(this.selectedTiles)
    }
    ,
    n.prototype.getNumSelected = function() {
        return this.numSelected
    }
    ,
    n.prototype.getNumHiddenMounts = function() {
        return this.allTiles.length - this.allVisibleTiles.length
    }
    ,
    n.prototype.addMount = function(e) {
        this.mountMap[e.id] = e,
        this.numMounts++;
        var t = new d(e,this);
        this.box.appendChild(t),
        this.allTiles.push(t),
        this.hasNoSorter ? this.allVisibleTiles.push(t) : this.currentSorter = null ,
        this.needsScrollerRefresh = !0
    }
    ,
    n.prototype.removeMount = function(e) {
        var t = this.mountMap[e];
        if (!t)
            return console.warn("removeMount: invalid ID:", e);
        var i = this.box.getChild(e);
        delete this.mountMap[e],
        this.numMounts--,
        i.selected && (delete this.selectedTiles[e],
        this.numSelected--);
        var n = this.allTiles.indexOf(i);
        this.allTiles.splice(n, 1);
        var o = this.allVisibleTiles;
        n = o.indexOf(i),
        o.splice(n, 1);
        for (var s = o.length - 1; s >= n; s--)
            o[s].markForReorder();
        i.hideTile(),
        this.box.removeChild(e),
        this.needsScrollerRefresh = !0
    }
    ,
    n.prototype._sortByProperty = function(e) {
        function t(t, i) {
            var o = t.mountData
              , s = i.mountData;
            return o.receivedData && (o = o.receivedData),
            s.receivedData && (s = s.receivedData),
            o[e] > s[e] ? n : o[e] < s[e] ? -n : o.id > s.id ? n : -n
        }
        if (e !== this.currentSorter) {
            this.currentSorter = e,
            this.hasNoSorter = !1;
            var i = !1
              , n = i ? -1 : 1;
            this._hideAllTiles(),
            this.needRefilter = !0,
            this.allTiles.sort(t);
            for (var o = this.allTiles, s = 0; s < o.length; s++)
                this.box.appendChild(o[s])
        }
    }
    ,
    n.prototype._filter = function(e) {
        e = e || {};
        var t = h(e);
        if (!t || !this.hasNoFilter || this.needRefilter) {
            this.needsScrollerRefresh = !0,
            this.hasNoFilter = t,
            this.needRefilter = !1,
            this._hideAllTiles(),
            this.allVisibleTiles = [];
            for (var i = this.allTiles, n = 0; n < i.length; n++) {
                var o = i[n]
                  , s = !0;
                for (var a in e) {
                    var r = e[a];
                    if (!this._filterTile(o.mountData, r["do"], r.args)) {
                        s = !1;
                        break
                    }
                }
                s && (this.allVisibleTiles.push(o),
                o.showTile())
            }
        }
    }
    ,
    n.prototype._filterTile = function(e, t, i) {
        return null === i || void 0 === i || (i = Array.isArray(i) ? i : [i],
        e.receivedData && (e = e.receivedData),
        t.apply(e, i))
    }
    ,
    n.prototype.toggleDisplay = function(e) {
        this.scroller.toggleDisplay(e)
    }
    ,
    n.prototype.lockRoom = function() {
        this.isLocked = !0,
        this.scroller.hide(),
        this._hideAllTiles()
    }
    ,
    n.prototype.refreshDisplay = function(e, t) {
        return this.isLocked && (this.isLocked = !1,
        this._showAllTiles()),
        this.scroller.show(),
        t && this._sortByProperty(t),
        this._filter(e),
        this.tilesPerPage ? (this.needsScrollerRefresh && (this.scroller.refresh(),
        this.needsScrollerRefresh = !1),
        void this._refreshView(!0)) : this._setupLayout()
    }
    ,
    n.prototype._setupLayout = function() {
        if (this.allVisibleTiles.length) {
            var e = this.scroller.getParent().rootElement
              , t = e.clientWidth
              , i = e.clientHeight
              , n = this.allVisibleTiles[0];
            n.setStyle("opacity", 0);
            var o = n.rootElement.clientWidth
              , s = this.columnWidth = o + 2 * m;
            this.rowHeight = n.rootElement.clientHeight + 2 * m,
            n.setStyle("opacity", null );
            var a = Math.floor(t / s)
              , r = t - a * s - g;
            r < f && a > 1 && (a--,
            r += s),
            this.numColumns = a;
            var l = Math.ceil(i / this.rowHeight) + 1;
            this.tilesPerPage = l * this.numColumns,
            this.extraTilesTopOrBottom = this.tilesPerPage,
            d.prepareTilePool(this, Math.min(this.numMounts, this.tilesPerPage + 2 * this.extraTilesTopOrBottom)),
            this.scrollGrip.setStyle("width", r + "px"),
            this.scroller.refresh(),
            this._refreshView(!0)
        }
    }
    ,
    n.prototype._stopTicker = function() {
        window.clearInterval(this.refreshInterval),
        this.refreshInterval = null
    }
    ,
    n.prototype._refreshView = function(e) {
        var t = Math.min(0, this.scroller.iScroll.y);
        if (!(this.isRefreshComplete && !e && Math.abs(t - this.lastRenderedScrollY) < this.rowHeight)) {
            var i = t - this.lastRenderedScrollY > 0;
            this.isRefreshComplete = !1;
            for (var n = this.allVisibleTiles, o = n.length, s = Math.floor(-t / this.rowHeight) * this.numColumns, a = s, r = Math.min(s + this.tilesPerPage, o), c = this.extraTilesTopOrBottom, u = Math.max(0, s - c), h = Math.min(s + this.tilesPerPage + c, o), d = 0; d < o; d++)
                d >= u && d < h || n[d].prepareToGoOffScreen();
            var p = e ? 1 / 0 : this.numColumns * w
              , m = l(1, n, a, r, i, p);
            p -= m,
            m && !e || (m = l(2, n, a, r, i, p)),
            e && (m += l(1, n, u, h)),
            0 === m && (this.isRefreshComplete = !0,
            this.lastRenderedScrollY = t)
        }
    }
    ,
    n.prototype._hideAllTiles = function() {
        for (var e = this.allVisibleTiles, t = 0; t < e.length; t++)
            e[t].hideTile();
        d.hidePoolTiles(this)
    }
    ,
    n.prototype._showAllTiles = function() {
        for (var e = this.allVisibleTiles, t = 0; t < e.length; t++)
            e[t].showTile()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: "tabs"
        }),
        e = e || {},
        this.addClassNames(e.className),
        this.options = e,
        this.tabsMap = {},
        this.tabsOrderIds = [],
        this.curentTabId = null ,
        this.nextId = 0
    }
    i(683);
    var o = i(26).inherits
      , s = i(190)
      , a = i(32)
      , r = i(84).playUiSound;
    o(n, s),
    e.exports = n,
    n.prototype.addTab = function(e, t, i) {
        var n = this
          , o = i
          , s = !1;
        o || (o = this.nextId,
        this.nextId += 1,
        s = !0);
        var l = s ? "tab" + o : o
          , c = this.createChild("div", {
            className: ["tab", l],
            text: e
        });
        return a(c),
        c.on("tap", function() {
            n.options.closable && o === n.curentTabId ? n.close() : (n.openTab(o),
            r("TAB"))
        }),
        c.on("enable", function(e) {
            this._isDisable = !e,
            this.toggleClassName("disabled", !e),
            e || n.curentTabId !== o || n.openFirstTab()
        }),
        this.tabsMap[o] = {
            tab: c,
            target: t
        },
        this.tabsOrderIds.push(o),
        t && t.hide(),
        o
    }
    ,
    n.prototype.toggleTabDisplay = function(e, t) {
        var i = this.tabsMap[e];
        if (i && i.tab.toggleDisplay(t),
        this.curentTabId === e && !i.tab.isVisible()) {
            var n = this.tabsOrderIds[0];
            e === n ? this.close() : this.openTab(n)
        }
    }
    ,
    n.prototype.openTab = function(e, t, i) {
        i = i || {},
        t = t || {};
        var n = this.curentTabId === e;
        if (i.forceOpen || !n) {
            "number" == typeof e && (e = this.tabsOrderIds[e]);
            var o = this.tabsMap[e];
            if (!o)
                return console.error("openTab - invalid tab ID given: " + e);
            n || this.close(),
            o.tab.addClassNames("on"),
            this.toggleTabNotification(e, !1);
            var s = o.target;
            s && (s.emit("open", t),
            s.show(),
            i.delayOpenedEvent || s.emit("opened", t)),
            this.curentTabId = e,
            this.emit("openTab", e)
        }
    }
    ,
    n.prototype.openFirstTab = function() {
        this.openTab(this.tabsOrderIds[0])
    }
    ,
    n.prototype.getTabsMap = function() {
        return this.tabsMap
    }
    ,
    n.prototype.getFirstTab = function() {
        return this.tabsMap[this.tabsOrderIds[0]]
    }
    ,
    n.prototype.getCurrentTabId = function() {
        return this.curentTabId
    }
    ,
    n.prototype.getCurrentTab = function() {
        return this.tabsMap[this.curentTabId]
    }
    ,
    n.prototype.getTabTarget = function(e) {
        var t = this.tabsMap[e] || {};
        return t.target
    }
    ,
    n.prototype.close = function() {
        if (this.curentTabId || "number" == typeof this.curentTabId) {
            var e = this.tabsMap[this.curentTabId];
            e.tab.delClassNames("on");
            var t = e.target;
            t && (t.hide(),
            t.emit("close"))
        }
        this.curentTabId = null
    }
    ,
    n.prototype.setClosable = function(e) {
        this.options.closable = e
    }
    ,
    n.prototype.toggleTabNotification = function(e, t) {
        var i = this.tabsMap[e];
        i && i.tab.toggleClassName("notification", t)
    }
    ,
    n.prototype.toggleTabAvailability = function(e, t) {
        var i = this.tabsMap[e];
        if (i) {
            var n = i.tab;
            void 0 === t && (t = !n._isDisable),
            n.setEnable(t)
        }
    }
    ,
    n.prototype.emitOnCurrentTab = function(e, t) {
        t = t || {};
        var i = this.getCurrentTab();
        i && i.target.emit(e, t)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        a.call(this, "div", {
            className: ["waitingGauge", "spinner"],
            hidden: !0
        }),
        e = e || {};
        var t = this.createChild("div", {
            className: "verticalCenterDiv"
        })
          , i = this.gauge = t.createChild("div", {
            className: "gauge"
        });
        this.progressCircle = i.appendChild(new s({
            size: e.size || r,
            thickness: e.thickness || l,
            color: e.color || c,
            bgColor: e.bgColor || u
        })),
        this.valueElt = i.createChild("div", {
            className: "value",
            text: ""
        }),
        this.labelElt = t.createChild("div", {
            className: "label",
            text: ""
        })
    }
    i(685);
    var o = i(26).inherits
      , s = i(665)
      , a = i(190)
      , r = 70
      , l = 7
      , c = "#58b"
      , u = "#555";
    o(n, a),
    e.exports = n,
    n.prototype.setLabel = function(e) {
        this.labelElt.setText(e)
    }
    ,
    n.prototype.showGauge = function(e, t, i) {
        this.goal = e,
        i = i || 1,
        e > i ? (this.progressCircle.setValue(0, 1),
        this.valueElt.setText("0%"),
        this.labelElt.setText(t ? t : ""),
        this.delClassNames("spinner"),
        this.gauge.show(),
        this.labelElt.show()) : this.labelElt.hide(),
        this.show()
    }
    ,
    n.prototype.refreshGauge = function(e) {
        if (this.gauge.isVisible()) {
            var t = (this.goal - e) / this.goal;
            this.progressCircle.setValue(t, 1),
            this.valueElt.setText(Math.round(100 * t) + "%")
        }
        0 === e && this.hideGauge()
    }
    ,
    n.prototype.hideGauge = function() {
        this.goal = 0,
        this.addClassNames("spinner"),
        this.gauge.hide(),
        this.hide()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        v.call(this, {
            title: b("ui.common.caracteristics"),
            className: "characteristics",
            positionInfo: {
                left: 40,
                top: "c",
                width: 320,
                height: 630
            }
        });
        var e = this;
        this.on("open", this.alignWithEquipment),
        this.infos = this.windowBody.createChild("div", {
            className: "infos"
        }),
        this.logoWrapper = this.infos.createChild("div", {
            className: "logoWrapper"
        }),
        this.logo = this.logoWrapper.appendChild(new x({
            className: "logo"
        },function() {
            I.open("grimoire", {
                tabId: "alignment"
            })
        }
        )),
        this.playerName = this.infos.createChild("div", {
            className: "playerName"
        }),
        this.infosSup = this.infos.createChild("div", {
            className: "infosSup"
        }),
        this.stats = this.windowBody.createChild("div", {
            className: "stats"
        });
        var t = window.gui;
        t.on("CharacterStatsListMessage", function(t) {
            window.gui.playerData.characterBreed && e.updateStats(t.stats)
        }),
        g = {
            maxLifePoints: b("ui.help.life"),
            actionPoints: b("ui.help.AP"),
            movementPoints: b("ui.help.MP"),
            initiative: b("ui.help.initiative"),
            prospecting: b("ui.help.prospecting"),
            range: b("ui.help.range"),
            summonableCreaturesBoost: b("ui.help.summonableCreatures"),
            vitality: b("ui.help.vitality"),
            wisdom: b("ui.help.wisdom"),
            strength: b("ui.help.strength"),
            intelligence: b("ui.help.intelligence"),
            chance: b("ui.help.chance"),
            agility: b("ui.help.agility"),
            level: b("ui.help.level"),
            red: b("ui.help.energy"),
            blue: b("ui.help.xp"),
            characteristics: b("ui.help.boostPoints")
        },
        window.gui.playerData.alignment.on("alignmentChanged", function() {
            var t = window.gui.playerData.characterBaseInformations
              , i = window.gui.playerData.alignment;
            i.getAlignmentImageUrl(function(t) {
                e.logo.setStyle("backgroundImage", t)
            }),
            e.playerName.setText(t.name),
            window.gui.playerData.characterBreed && e.infosSup.setText(window.gui.playerData.characterBreed.shortNameId + ", " + b("ui.common.level") + " " + t.level),
            T(e.infosSup, g.level)
        })
    }
    function o(e) {
        return e.createChild("div", {
            className: "panel"
        })
    }
    function s(e, t) {
        return e.createChild("table", {
            className: t
        })
    }
    function a(e, t, i, n, o) {
        var s = e.createChild("div", {
            className: "barWrapper"
        })
          , a = s.createChild("div", {
            className: "label",
            text: t
        })
          , r = s.appendChild(new w({
            className: i,
            value: n / o
        }));
        T(a, g[i]),
        T(r, n + " / " + o)
    }
    function r(e) {
        return e || "-"
    }
    function l(e) {
        return e.base + e.alignGiftBonus + e.objectsAndMountBonus + e.contextModif
    }
    function c(e, t, i) {
        var n;
        T(t, function() {
            if (!n) {
                var t = e[i]
                  , o = b("ui.common.base") + b("ui.common.colon") + r(t.base)
                  , s = b("ui.common.equipement") + b("ui.common.colon") + r(t.objectsAndMountBonus)
                  , a = b("ui.common.gifts") + "+" + b("ui.common.boost") + b("ui.common.colon");
                a += r(t.alignGiftBonus + t.contextModif),
                n = new S("div",{
                    className: "toolTipLabelBlock"
                }),
                n.createChild("div", {
                    className: "toolTipLabel",
                    text: o
                }),
                n.createChild("div", {
                    className: "toolTipLabel",
                    text: s
                }),
                n.createChild("div", {
                    className: "toolTipLabel",
                    text: a
                })
            }
            return n
        })
    }
    function u(e, t, i, n, o) {
        var s = e.createChild("tr")
          , a = s.createChild("td", {
            className: ["label", o],
            text: t
        });
        T(a, g[i]),
        s.createChild("td", {
            className: "value",
            text: r(n)
        })
    }
    function h(e, t, i) {
        i = i || 4;
        var n = e.createChild("tr");
        return n.createChild("td", {
            className: "tableTitle",
            text: t,
            attr: {
                colspan: i
            }
        }),
        n
    }
    function d(e, t, i, n) {
        var o = r(i.base)
          , s = r(i.alignGiftBonus + i.objectsAndMountBonus + i.contextModif)
          , a = r(i.base + i.alignGiftBonus + i.objectsAndMountBonus + i.contextModif)
          , l = e.createChild("tr");
        l.createChild("td", {
            className: ["label", n],
            text: t
        }),
        l.createChild("td", {
            className: "base",
            text: o
        }),
        l.createChild("td", {
            className: "bonus",
            text: s
        }),
        l.createChild("td", {
            className: "total",
            text: a
        })
    }
    function p(e, t, i, n, o) {
        var s = e.createChild("tr")
          , a = s.createChild("td", {
            className: ["label", o],
            text: i
        });
        T(a, g[n]);
        var u = t[n]
          , h = s.createChild("td", {
            className: "value",
            text: r(l(u))
        });
        c(t, h, n);
        var d = s.createChild("td", {
            className: "upgrade"
        })
          , p = d.createChild("div", {
            className: "upgradeButton"
        });
        C(p);
        var m = "statsPointsFor" + n[0].toUpperCase() + n.substr(1)
          , f = window.gui.playerData.characterBreed[m];
        p.on("tap", function() {
            E("PLUS_BUTTON"),
            I.open("characUpdate", {
                label: i,
                characteristicName: n,
                initialLevel: t[n].base,
                pointsRemaining: t.statsPoints,
                costSteps: f
            })
        });
        var _ = A(f, u.base);
        t.statsPoints < _ && (p.disable(),
        p.addClassNames("disabled"))
    }
    function m(e, t, i) {
        var n = e.createChild("tr");
        n.createChild("td", {
            className: ["label", "pointCapital"],
            text: t
        }),
        n.createChild("td", {
            className: ["value", "pointCapital"],
            text: i
        }),
        T(n, g.characteristics)
    }
    function f(e) {
        var t = e.createChild("tr");
        t.createChild("td", {
            className: "label",
            text: b("ui.common.caracteristics")
        }),
        t.createChild("td", {
            className: "base",
            text: b("ui.common.base")
        }),
        t.createChild("td", {
            className: "bonus",
            text: b("ui.fightend.bonus")
        }),
        t.createChild("td", {
            className: "total",
            text: b("ui.common.total")
        })
    }
    i(687);
    var g, _ = i(26).inherits, v = i(402), y = i(682), w = i(643), b = i(35).getText, C = i(32), I = i(22), T = i(206).addTooltip, S = i(190), A = i(688).getStatCost, E = i(84).playUiSound, x = i(204);
    _(n, v),
    e.exports = n,
    n.prototype.alignWithEquipment = function() {
        var e = I.getWindow("equipment");
        e.openState && (this.setStyles({
            top: e.getStyle("top"),
            height: e.getStyle("height")
        }),
        I.arrangeOpeningWindow(this.id, {
            leftOf: e.id
        }))
    }
    ,
    n.prototype.updateStats = function(e) {
        this.stats.clearContent(),
        this.tabs = new y,
        this.stats.appendChild(this.tabs),
        this.panels = this.stats.createChild("div", {
            className: "panels"
        }),
        this.panelSummary = o(this.panels),
        a(this.panelSummary, b("ui.common.energy"), "red", e.energyPoints, e.maxEnergyPoints),
        a(this.panelSummary, b("ui.common.experiment"), "blue", e.experience - e.experienceLevelFloor, e.experienceNextLevelFloor - e.experienceLevelFloor);
        var t = s(this.panelSummary, "summaryTable");
        u(t, b("ui.stats.lifePoints"), "maxLifePoints", e.lifePoints + " / " + e.maxLifePoints, "iconLifePoints"),
        u(t, b("ui.stats.shortAP"), "actionPoints", l(e.actionPoints), "iconActionPoints"),
        u(t, b("ui.stats.shortMP"), "movementPoints", l(e.movementPoints), "iconMovementPoints");
        var i = l(e.initiative)
          , n = Math.floor(i * e.lifePoints / e.maxLifePoints);
        u(t, b("ui.stats.initiative"), "initiative", n + " / " + i, "iconInitiative"),
        u(t, b("ui.stats.prospecting"), "prospecting", l(e.prospecting), "iconProspecting"),
        u(t, b("ui.stats.range"), "range", l(e.range), "iconRange"),
        u(t, b("ui.stats.summonableCreatures"), "summonableCreaturesBoost", l(e.summonableCreaturesBoost), "iconSummon");
        var r = s(this.panelSummary, "characTable");
        h(r, b("ui.common.caracteristics"), 3),
        p(r, e, b("ui.stats.vitality"), "vitality", "iconVitality"),
        p(r, e, b("ui.stats.wisdom"), "wisdom", "iconWisdom"),
        p(r, e, b("ui.stats.strength"), "strength", "iconStrength"),
        p(r, e, b("ui.stats.intelligence"), "intelligence", "iconIntelligence"),
        p(r, e, b("ui.stats.chance"), "chance", "iconChance"),
        p(r, e, b("ui.stats.agility"), "agility", "iconAgility"),
        m(r, b("ui.stats.statPoints"), e.statsPoints),
        this.panelAdvanced = o(this.panels);
        var c = s(this.panelAdvanced, "advancedTable");
        f(c),
        h(c, b("ui.charaSheet.primaryStats")),
        d(c, b("ui.stats.vitality"), e.vitality, "iconVitality"),
        d(c, b("ui.stats.wisdom"), e.wisdom, "iconWisdom"),
        d(c, b("ui.stats.strength"), e.strength, "iconStrength"),
        d(c, b("ui.stats.intelligence"), e.intelligence, "iconIntelligence"),
        d(c, b("ui.stats.chance"), e.chance, "iconChance"),
        d(c, b("ui.stats.agility"), e.agility, "iconAgility"),
        d(c, b("ui.stats.shortAP"), e.actionPoints, "iconActionPoints"),
        d(c, b("ui.stats.shortMP"), e.movementPoints, "iconMovementPoints"),
        d(c, b("ui.stats.initiative"), e.initiative, "iconInitiative"),
        d(c, b("ui.stats.prospecting"), e.prospecting, "iconProspecting"),
        d(c, b("ui.stats.range"), e.range, "iconRange"),
        d(c, b("ui.stats.summonableCreatures"), e.summonableCreaturesBoost, "iconSummon"),
        h(c, b("ui.charaSheet.secondaryStats")),
        d(c, b("ui.stats.PAAttack"), e.PAAttack, "iconAttackAP"),
        d(c, b("ui.stats.dodgeAP"), e.dodgePALostProbability, "iconDodgeAP"),
        d(c, b("ui.stats.PMAttack"), e.PMAttack, "iconAttackMP"),
        d(c, b("ui.stats.dodgeMP"), e.dodgePMLostProbability, "iconDodgeMP"),
        d(c, b("ui.stats.criticalHit"), e.criticalHit, "iconCriticalHit"),
        d(c, b("ui.stats.healBonus"), e.healBonus, "iconHeal"),
        d(c, b("ui.stats.takleBlock"), e.tackleBlock, "iconTackle"),
        d(c, b("ui.stats.takleEvade"), e.tackleEvade, "iconEvade"),
        h(c, b("ui.stats.damagesBonus")),
        d(c, b("ui.stats.damagesBonus"), e.allDamagesBonus, "iconDamage"),
        d(c, b("ui.stats.damagesBonusPercent"), e.damagesBonusPercent, "iconDamagePercent"),
        d(c, b("ui.stats.criticalDamageBonus"), e.criticalDamageBonus, "iconCriticalDamage"),
        d(c, b("ui.stats.neutralDamageBonus"), e.neutralDamageBonus, "iconYinyang"),
        d(c, b("ui.stats.earthDamageBonus"), e.earthDamageBonus, "iconStrength"),
        d(c, b("ui.stats.fireDamageBonus"), e.fireDamageBonus, "iconIntelligence"),
        d(c, b("ui.stats.waterDamageBonus"), e.waterDamageBonus, "iconChance"),
        d(c, b("ui.stats.airDamageBonus"), e.airDamageBonus, "iconAgility"),
        d(c, b("ui.stats.return"), e.reflect, "iconReturn"),
        d(c, b("ui.stats.weaponDamagesPercent"), e.weaponDamagesBonusPercent, "iconWeaponDamage"),
        d(c, b("ui.stats.trapBonus"), e.trapBonus, "iconTrap"),
        d(c, b("ui.stats.trapBonusPercent"), e.trapBonusPercent, "iconTrapPercent"),
        d(c, b("ui.stats.pushDamageBonus"), e.pushDamageBonus, "iconPushDamage"),
        h(c, b("ui.common.resistances")),
        d(c, b("ui.stats.neutralReduction"), e.neutralElementReduction, "iconYinyang"),
        d(c, b("ui.stats.neutralReductionPercent"), e.neutralElementResistPercent, "iconYinyang"),
        d(c, b("ui.stats.earthReduction"), e.earthElementReduction, "iconStrength"),
        d(c, b("ui.stats.earthReductionPercent"), e.earthElementResistPercent, "iconStrength"),
        d(c, b("ui.stats.fireReduction"), e.fireElementReduction, "iconIntelligence"),
        d(c, b("ui.stats.fireReductionPercent"), e.fireElementResistPercent, "iconIntelligence"),
        d(c, b("ui.stats.waterReduction"), e.waterElementReduction, "iconChance"),
        d(c, b("ui.stats.waterReductionPercent"), e.waterElementResistPercent, "iconChance"),
        d(c, b("ui.stats.airReduction"), e.airElementReduction, "iconAgility"),
        d(c, b("ui.stats.airReductionPercent"), e.airElementResistPercent, "iconAgility"),
        d(c, b("ui.stats.criticalDamageReduction"), e.criticalDamageReduction, "iconCriticalReduction"),
        d(c, b("ui.stats.pushDamageReduction"), e.pushDamageReduction, "iconPushDamageReduction"),
        h(c, b("ui.common.resistancesPvp")),
        d(c, b("ui.stats.neutralReduction"), e.pvpNeutralElementReduction, "iconYinyang"),
        d(c, b("ui.stats.neutralReductionPercent"), e.pvpNeutralElementResistPercent, "iconYinyang"),
        d(c, b("ui.stats.earthReduction"), e.pvpEarthElementReduction, "iconStrength"),
        d(c, b("ui.stats.earthReductionPercent"), e.pvpEarthElementResistPercent, "iconStrength"),
        d(c, b("ui.stats.fireReduction"), e.pvpFireElementReduction, "iconIntelligence"),
        d(c, b("ui.stats.fireReductionPercent"), e.pvpFireElementResistPercent, "iconIntelligence"),
        d(c, b("ui.stats.waterReduction"), e.pvpWaterElementReduction, "iconChance"),
        d(c, b("ui.stats.waterReductionPercent"), e.pvpWaterElementResistPercent, "iconChance"),
        d(c, b("ui.stats.airReduction"), e.pvpAirElementReduction, "iconAgility"),
        d(c, b("ui.stats.airReductionPercent"), e.pvpAirElementResistPercent, "iconAgility"),
        this.tabs.addTab(b("ui.stats.summary"), this.panelSummary),
        this.tabs.addTab(b("ui.stats.advanced"), this.panelAdvanced),
        this.tabs.openTab(0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "characUpdateWindow",
            title: "Characteristic Update",
            positionInfo: {
                top: "c",
                left: "c",
                width: 410,
                height: 300
            }
        }),
        this.on("open", function(e) {
            var t = l.getWindow("characteristics");
            t.openState && (l.arrangeOpeningWindow(this.id, {
                rightOf: t.id
            }),
            this.updateContent(e))
        }),
        this.on("close", function() {
            h.hide()
        }),
        this.closeButton.on("tap", function() {
            u("CANCEL_BUTTON")
        })
    }
    i(689);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204)
      , r = i(485)
      , l = i(22)
      , c = i(35).getText
      , u = i(84).playUiSound
      , h = i(301)
      , d = i(208)
      , p = {
        vitality: 11,
        wisdom: 12,
        strength: 10,
        intelligence: 15,
        chance: 13,
        agility: 14
    }
      , m = 0
      , f = 1;
    o(n, s),
    e.exports = n,
    n.prototype.updateContent = function(e) {
        var t = this;
        this.pointsRemaining = e.pointsRemaining,
        this.initialLevel = e.initialLevel,
        this.characteristicName = e.characteristicName,
        this.costSteps = e.costSteps,
        this.pointsSpent = this.addedLevel = 0,
        this.findCurrentCostStep(),
        this.windowTitle.setText(e.label),
        this.windowBody.clearContent();
        var i = this.windowBody.createChild("div", {
            className: "points"
        });
        i.createChild("span", {
            text: c("ui.charaSheet.boostPoints") + c("ui.common.colon")
        }),
        this.pointsRemainingElt = i.createChild("span", {
            className: "pointsRemaining",
            text: this.pointsRemaining
        }),
        this.container = this.windowBody.createChild("div", {
            className: "containerBlock"
        });
        var n = this.container.createChild("div", {
            className: "additionBlock"
        });
        n.appendChild(new a({
            className: "minusButton",
            repeatDelay: 50,
            scaleOnPress: !0
        },function() {
            t.updatePoints(-1) && t.displayValues()
        }
        )),
        this.pointsLineAdded = new d({
            className: "pointsInput",
            minValue: 0,
            maxValue: this.pointsRemaining
        }),
        this.pointsLineAdded.on("change", function(e) {
            t.updatePointsUntil(e)
        }),
        n.appendChild(this.pointsLineAdded),
        n.appendChild(new a({
            className: "plusButton",
            repeatDelay: 50,
            scaleOnPress: !0
        },function() {
            t.updatePoints(1) && t.displayValues()
        }
        ));
        var o = n.createChild("div", {
            className: "additionLine"
        });
        o.createChild("span", {
            text: "+ "
        }),
        this.levelAddedElt = o.createChild("span", {
            text: 0
        }),
        o.createChild("span", {
            text: " " + e.label
        });
        var s = n.createChild("div", {
            className: "totalLine"
        });
        this.finalLevelElt = s.createChild("span", {
            text: this.initialLevel
        }),
        s.createChild("span", {
            text: " " + e.label
        }),
        this.createCostLevelTable(),
        this.container.appendChild(new a({
            text: c("ui.common.validation"),
            className: "button"
        },function() {
            if (t.pointsSpent <= 0)
                return u("GEN_BUTTON");
            u("OK_BUTTON");
            var e = p[t.characteristicName];
            window.dofus.sendMessage("StatsUpgradeRequestMessage", {
                statId: e,
                boostPoint: t.pointsSpent
            }),
            l.close(t.id)
        }
        )),
        this.displayValues()
    }
    ,
    n.prototype.createCostLevelTable = function() {
        for (var e = ["title"], t = ["Level"], i = ["Cost"], n = this.costSteps, o = 0; o < n.length; o++)
            e.push("l" + o),
            t.push("> " + n[o][m]),
            i.push(n[o][f]);
        this.table = this.container.appendChild(new r({
            colIds: e,
            colCount: n.length,
            headerContent: t
        })),
        this.costRow = this.table.addRow(i)
    }
    ,
    n.prototype.displayValues = function() {
        if (this.pointsRemainingElt.setText(this.pointsRemaining - this.pointsSpent),
        this.pointsLineAdded.setValue(this.pointsSpent),
        this.levelAddedElt.setText(this.addedLevel),
        this.finalLevelElt.setText(this.initialLevel + this.addedLevel),
        this.currentCostStep !== this.previousCostStep) {
            if (void 0 !== this.previousCostStep) {
                var e = this.table.getHeaderCol("l" + this.previousCostStep)
                  , t = this.table.getCol(0, "l" + this.previousCostStep);
                e.delClassNames("selected"),
                t.delClassNames("selected")
            }
            this.previousCostStep = this.currentCostStep;
            var i = this.table.getHeaderCol("l" + this.currentCostStep)
              , n = this.table.getCol(0, "l" + this.currentCostStep);
            i.addClassNames("selected"),
            n.addClassNames("selected")
        }
    }
    ,
    n.prototype.findCurrentCostStep = function() {
        var e = this.costSteps;
        this.previousCostStep = void 0,
        this.currentCostStep = 0;
        for (var t = 0; t < e.length; t++)
            this.initialLevel >= e[t][m] && (this.currentCostStep = t)
    }
    ,
    n.prototype.updatePointsUntil = function(e) {
        if (e - this.pointsSpent > 0)
            for (; this.pointsSpent < e; ) {
                var t = this.costSteps[this.currentCostStep][f];
                if (this.pointsSpent + t > e)
                    break;
                if (!this.updatePoints(1))
                    break
            }
        else
            for (; this.pointsSpent > e && this.updatePoints(-1); )
                ;
        this.displayValues()
    }
    ,
    n.prototype.updatePoints = function(e) {
        var t = this.costSteps[this.currentCostStep]
          , i = t[f];
        if (e > 0) {
            if (this.pointsSpent + i > this.pointsRemaining)
                return !1;
            this.pointsSpent += i,
            this.addedLevel++;
            var n = this.costSteps[this.currentCostStep + 1];
            n && this.initialLevel + this.addedLevel >= n[m] && this.currentCostStep++
        } else {
            if (!this.pointsSpent)
                return !1;
            this.initialLevel + this.addedLevel <= t[m] && (this.currentCostStep--,
            t = this.costSteps[this.currentCostStep],
            i = t[f]),
            this.pointsSpent -= i,
            this.addedLevel--
        }
        return !0
    }
    ,
    e.exports.getStatCost = function(e, t) {
        for (var i = 0, n = e.length - 1; n >= 0; n--)
            if (t >= e[n][m])
                return e[n][f];
        return i
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            c.close("deleteCharacterConfirm");
            var t = e.data;
            n.setText(t.name),
            o.setText(u("ui.common.level") + " " + t.level),
            r.selectedCharacter = t,
            r.characterDisplay.setLook(t.entityLook, {
                boneType: "characters/",
                skinType: "characters/"
            }),
            r.xpSticker.setClassNames(["xpSticker", "x" + t.bonusXp])
        }
        function t() {
            var e = b.playerData.identification.secretQuestion
              , t = r.selectedCharacter.level
              , i = r.selectedCharacter.id
              , n = r.selectedCharacter.name;
            t >= y && e ? c.open("deleteCharacterConfirm", {
                id: i,
                name: n,
                secretQuestion: e
            }) : b.openConfirmPopup({
                title: u("ui.popup.warning"),
                message: u("ui.popup.warnBeforeDelete", n),
                cb: function(e) {
                    if (e) {
                        var t = h(i + "~000000000000000000");
                        window.dofus.sendMessage("CharacterDeletionRequestMessage", {
                            characterId: i,
                            secretAnswerHash: t
                        })
                    }
                }
            })
        }
        function i(e) {
            var t = "default"
              , i = {
                TooManyDeletion: u("ui.charSel.deletionErrorTooManyDeletion"),
                WrongAnswer: u("ui.charSel.deletionErrorWrongAnswer"),
                UnsecureMode: u("ui.charSel.deletionErrorUnsecureMode"),
                "default": u("ui.charSel.deletionError")
            };
            e.reason === _.DEL_ERR_TOO_MANY_CHAR_DELETION ? t = "TooManyDeletion" : e.reason === _.DEL_ERR_BAD_SECRET_ANSWER ? t = "WrongAnswer" : e.reason === _.DEL_ERR_RESTRICED_ZONE && (t = "UnsecureMode"),
            b.openSimplePopup(i[t])
        }
        l.call(this, {
            className: "CharacterSelectionWindow",
            title: u("ui.charsel.title"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 650,
                height: 520,
                isFullScreen: !0
            }
        });
        var n, o, r = this, v = 7, y = 20, w = this.windowBody, b = window.gui;
        this.selectedCharacter = null ;
        var C = this.leftColumn = w.createChild("div", {
            className: "leftColumn"
        });
        this.charactersTable = C.appendChild(new m({
            className: "characterTable",
            minRows: v,
            highlightable: !0,
            colIds: ["name", "bonusXp"],
            headerContent: [""],
            onRowTap: function(t) {
                t.data && e(t)
            }
        }));
        var I = C.createChild("div", {
            className: "buttonsDiv"
        });
        this.btnCreate = I.appendChild(new d({
            text: u("ui.charsel.createCharacter"),
            className: ["newCharacterBtn", "button"],
            sound: "OK_BUTTON"
        },function() {
            c.close("deleteCharacterConfirm"),
            c.close(r.id),
            c.open("characterCreation")
        }
        )),
        I.createChild("div", {
            className: "xpBubble"
        });
        var T = I.appendChild(new d({
            text: u("ui.charsel.changeServer"),
            className: ["changeServerBtn", "button"],
            sound: "CANCEL_BUTTON"
        },function() {
            c.close(r.id),
            f.goBackToSelectionOf("server")
        }
        ))
          , S = w.createChild("div", {
            className: "centerPanel"
        })
          , A = S.createChild("div", {
            className: ["line", "nameLine"]
        })
          , E = A.createChild("div", {
            className: "nameDiv"
        });
        n = E.createChild("div", {
            className: "name"
        }),
        this.btnDelete = E.appendChild(new d({
            className: "delCharacterBtn",
            text: "X"
        },t));
        var x = S.createChild("div", {
            className: ["line", "levelLine"]
        });
        o = x.createChild("div", {
            className: "level"
        });
        var M = S.appendChild(new g({
            scale: 2.3
        }));
        this.characterDisplay = M;
        var N = M.createChild("div", {
            className: "leftButton"
        });
        p(N, {
            repeatDelay: 100
        }),
        N.on("tap", function() {
            M.rotateCharacter(!1)
        });
        var R = M.createChild("div", {
            className: "rightButton"
        });
        p(R, {
            repeatDelay: 100
        }),
        R.on("tap", function() {
            M.rotateCharacter(!0)
        }),
        this.xpSticker = M.createChild("div", {
            className: "xpSticker"
        }),
        s(this.xpSticker, u("ui.information.xpFamilyBonus"));
        var O = this.btnPlay = S.appendChild(new d({
            text: u("ui.common.play"),
            className: ["btnPlay", "button"],
            sound: "PLAY_BUTTON"
        },function() {
            this.disable(),
            a.selectCharacter(r.selectedCharacter.id)
        }
        ));
        this.closeButton.on("tap", function() {
            T.emit("tap")
        }),
        this.on("open", function(e) {
            return e = e.length ? e : null ,
            this.charactersList = e || this.charactersList,
            this.charactersList ? (r.updateCharacterList(this.charactersList),
            void O.enable()) : console.error("CharacterSelectionWindow opened without character list info")
        }),
        this.on("close", function() {
            c.close("deleteCharacterConfirm"),
            M.release()
        }),
        b.on("CharacterDeletionErrorMessage", this.localizeEvent(i))
    }
    function o(e) {
        for (var t = 1, i = 0, n = e.length; i < n; i++) {
            for (var o = 1, s = 0; s < n; s++)
                e[s].id !== e[i].id && e[s].level > e[i].level && o < 4 && o++;
            e[i].bonusXp = o,
            e[i].level > 1 && t++
        }
        return Math.min(t, 4)
    }
    i(691);
    var s = i(206).addTooltip
      , a = i(442)
      , r = i(26).inherits
      , l = i(402)
      , c = i(22)
      , u = i(35).getText
      , h = i(692)
      , d = i(204)
      , p = i(32)
      , m = i(485)
      , f = i(50)
      , g = i(238)
      , _ = i(696);
    r(n, l),
    e.exports = n,
    n.prototype.updateCharacterList = function(e) {
        var t = o(e);
        this.leftColumn.setClassNames(["leftColumn", "x" + t + "Bubble"]),
        this.charactersTable.clearContent();
        var i = this.charactersTable.header.getChildren()[0].getChild("name");
        i.setHtml(u("ui.connection.listCharacterLabel", e.length));
        for (var n = window.gui.databases.Breeds, s = 0; s < e.length; s++) {
            var a = e[s]
              , r = a.breed || 0
              , l = a.name + " (" + n[r].shortNameId + " " + a.level + ")"
              , c = this.charactersTable.addRow({
                name: l
            }, {
                data: a
            })
              , h = a.bonusXp;
            h > 1 && c.getChildren()[1].addClassNames(["x" + h]);
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    !function() {
        var t = i(693)
          , n = i(694).utf8
          , o = i(695)
          , s = i(694).bin
          , a = function(e, i) {
            e.constructor == String ? e = i && "binary" === i.encoding ? s.stringToBytes(e) : n.stringToBytes(e) : o(e) ? e = Array.prototype.slice.call(e, 0) : Array.isArray(e) || (e = e.toString());
            for (var r = t.bytesToWords(e), l = 8 * e.length, c = 1732584193, u = -271733879, h = -1732584194, d = 271733878, p = 0; p < r.length; p++)
                r[p] = 16711935 & (r[p] << 8 | r[p] >>> 24) | 4278255360 & (r[p] << 24 | r[p] >>> 8);
            r[l >>> 5] |= 128 << l % 32,
            r[(l + 64 >>> 9 << 4) + 14] = l;
            for (var m = a._ff, f = a._gg, g = a._hh, _ = a._ii, p = 0; p < r.length; p += 16) {
                var v = c
                  , y = u
                  , w = h
                  , b = d;
                c = m(c, u, h, d, r[p + 0], 7, -680876936),
                d = m(d, c, u, h, r[p + 1], 12, -389564586),
                h = m(h, d, c, u, r[p + 2], 17, 606105819),
                u = m(u, h, d, c, r[p + 3], 22, -1044525330),
                c = m(c, u, h, d, r[p + 4], 7, -176418897),
                d = m(d, c, u, h, r[p + 5], 12, 1200080426),
                h = m(h, d, c, u, r[p + 6], 17, -1473231341),
                u = m(u, h, d, c, r[p + 7], 22, -45705983),
                c = m(c, u, h, d, r[p + 8], 7, 1770035416),
                d = m(d, c, u, h, r[p + 9], 12, -1958414417),
                h = m(h, d, c, u, r[p + 10], 17, -42063),
                u = m(u, h, d, c, r[p + 11], 22, -1990404162),
                c = m(c, u, h, d, r[p + 12], 7, 1804603682),
                d = m(d, c, u, h, r[p + 13], 12, -40341101),
                h = m(h, d, c, u, r[p + 14], 17, -1502002290),
                u = m(u, h, d, c, r[p + 15], 22, 1236535329),
                c = f(c, u, h, d, r[p + 1], 5, -165796510),
                d = f(d, c, u, h, r[p + 6], 9, -1069501632),
                h = f(h, d, c, u, r[p + 11], 14, 643717713),
                u = f(u, h, d, c, r[p + 0], 20, -373897302),
                c = f(c, u, h, d, r[p + 5], 5, -701558691),
                d = f(d, c, u, h, r[p + 10], 9, 38016083),
                h = f(h, d, c, u, r[p + 15], 14, -660478335),
                u = f(u, h, d, c, r[p + 4], 20, -405537848),
                c = f(c, u, h, d, r[p + 9], 5, 568446438),
                d = f(d, c, u, h, r[p + 14], 9, -1019803690),
                h = f(h, d, c, u, r[p + 3], 14, -187363961),
                u = f(u, h, d, c, r[p + 8], 20, 1163531501),
                c = f(c, u, h, d, r[p + 13], 5, -1444681467),
                d = f(d, c, u, h, r[p + 2], 9, -51403784),
                h = f(h, d, c, u, r[p + 7], 14, 1735328473),
                u = f(u, h, d, c, r[p + 12], 20, -1926607734),
                c = g(c, u, h, d, r[p + 5], 4, -378558),
                d = g(d, c, u, h, r[p + 8], 11, -2022574463),
                h = g(h, d, c, u, r[p + 11], 16, 1839030562),
                u = g(u, h, d, c, r[p + 14], 23, -35309556),
                c = g(c, u, h, d, r[p + 1], 4, -1530992060),
                d = g(d, c, u, h, r[p + 4], 11, 1272893353),
                h = g(h, d, c, u, r[p + 7], 16, -155497632),
                u = g(u, h, d, c, r[p + 10], 23, -1094730640),
                c = g(c, u, h, d, r[p + 13], 4, 681279174),
                d = g(d, c, u, h, r[p + 0], 11, -358537222),
                h = g(h, d, c, u, r[p + 3], 16, -722521979),
                u = g(u, h, d, c, r[p + 6], 23, 76029189),
                c = g(c, u, h, d, r[p + 9], 4, -640364487),
                d = g(d, c, u, h, r[p + 12], 11, -421815835),
                h = g(h, d, c, u, r[p + 15], 16, 530742520),
                u = g(u, h, d, c, r[p + 2], 23, -995338651),
                c = _(c, u, h, d, r[p + 0], 6, -198630844),
                d = _(d, c, u, h, r[p + 7], 10, 1126891415),
                h = _(h, d, c, u, r[p + 14], 15, -1416354905),
                u = _(u, h, d, c, r[p + 5], 21, -57434055),
                c = _(c, u, h, d, r[p + 12], 6, 1700485571),
                d = _(d, c, u, h, r[p + 3], 10, -1894986606),
                h = _(h, d, c, u, r[p + 10], 15, -1051523),
                u = _(u, h, d, c, r[p + 1], 21, -2054922799),
                c = _(c, u, h, d, r[p + 8], 6, 1873313359),
                d = _(d, c, u, h, r[p + 15], 10, -30611744),
                h = _(h, d, c, u, r[p + 6], 15, -1560198380),
                u = _(u, h, d, c, r[p + 13], 21, 1309151649),
                c = _(c, u, h, d, r[p + 4], 6, -145523070),
                d = _(d, c, u, h, r[p + 11], 10, -1120210379),
                h = _(h, d, c, u, r[p + 2], 15, 718787259),
                u = _(u, h, d, c, r[p + 9], 21, -343485551),
                c = c + v >>> 0,
                u = u + y >>> 0,
                h = h + w >>> 0,
                d = d + b >>> 0
            }
            return t.endian([c, u, h, d])
        };
        a._ff = function(e, t, i, n, o, s, a) {
            var r = e + (t & i | ~t & n) + (o >>> 0) + a;
            return (r << s | r >>> 32 - s) + t
        }
        ,
        a._gg = function(e, t, i, n, o, s, a) {
            var r = e + (t & n | i & ~n) + (o >>> 0) + a;
            return (r << s | r >>> 32 - s) + t
        }
        ,
        a._hh = function(e, t, i, n, o, s, a) {
            var r = e + (t ^ i ^ n) + (o >>> 0) + a;
            return (r << s | r >>> 32 - s) + t
        }
        ,
        a._ii = function(e, t, i, n, o, s, a) {
            var r = e + (i ^ (t | ~n)) + (o >>> 0) + a;
            return (r << s | r >>> 32 - s) + t
        }
        ,
        a._blocksize = 16,
        a._digestsize = 16,
        e.exports = function(e, i) {
            if ("undefined" != typeof e) {
                var n = t.wordsToBytes(a(e, i));
                return i && i.asBytes ? n : i && i.asString ? s.bytesToString(n) : t.bytesToHex(n)
            }
        }
    }()
}
, function(e, t) {
    !function() {
        var t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
          , i = {
            rotl: function(e, t) {
                return e << t | e >>> 32 - t
            },
            rotr: function(e, t) {
                return e << 32 - t | e >>> t
            },
            endian: function(e) {
                if (e.constructor == Number)
                    return 16711935 & i.rotl(e, 8) | 4278255360 & i.rotl(e, 24);
                for (var t = 0; t < e.length; t++)
                    e[t] = i.endian(e[t]);
                return e
            },
            randomBytes: function(e) {
                for (var t = []; e > 0; e--)
                    t.push(Math.floor(256 * Math.random()));
                return t
            },
            bytesToWords: function(e) {
                for (var t = [], i = 0, n = 0; i < e.length; i++,
                n += 8)
                    t[n >>> 5] |= e[i] << 24 - n % 32;
                return t
            },
            wordsToBytes: function(e) {
                for (var t = [], i = 0; i < 32 * e.length; i += 8)
                    t.push(e[i >>> 5] >>> 24 - i % 32 & 255);
                return t
            },
            bytesToHex: function(e) {
                for (var t = [], i = 0; i < e.length; i++)
                    t.push((e[i] >>> 4).toString(16)),
                    t.push((15 & e[i]).toString(16));
                return t.join("")
            },
            hexToBytes: function(e) {
                for (var t = [], i = 0; i < e.length; i += 2)
                    t.push(parseInt(e.substr(i, 2), 16));
                return t
            },
            bytesToBase64: function(e) {
                for (var i = [], n = 0; n < e.length; n += 3)
                    for (var o = e[n] << 16 | e[n + 1] << 8 | e[n + 2], s = 0; s < 4; s++)
                        8 * n + 6 * s <= 8 * e.length ? i.push(t.charAt(o >>> 6 * (3 - s) & 63)) : i.push("=");
                return i.join("")
            },
            base64ToBytes: function(e) {
                e = e.replace(/[^A-Z0-9+\/]/gi, "");
                for (var i = [], n = 0, o = 0; n < e.length; o = ++n % 4)
                    0 != o && i.push((t.indexOf(e.charAt(n - 1)) & Math.pow(2, -2 * o + 8) - 1) << 2 * o | t.indexOf(e.charAt(n)) >>> 6 - 2 * o);
                return i
            }
        };
        e.exports = i
    }()
}
, function(e, t) {
    var i = {
        utf8: {
            stringToBytes: function(e) {
                return i.bin.stringToBytes(unescape(encodeURIComponent(e)))
            },
            bytesToString: function(e) {
                return decodeURIComponent(escape(i.bin.bytesToString(e)))
            }
        },
        bin: {
            stringToBytes: function(e) {
                for (var t = [], i = 0; i < e.length; i++)
                    t.push(255 & e.charCodeAt(i));
                return t
            },
            bytesToString: function(e) {
                for (var t = [], i = 0; i < e.length; i++)
                    t.push(String.fromCharCode(e[i]));
                return t.join("")
            }
        }
    };
    e.exports = i
}
, function(e, t) {
    e.exports = function(e) {
        return !(null == e || !e.constructor || "function" != typeof e.constructor.isBuffer || !e.constructor.isBuffer(e))
    }
}
, function(e, t) {
    e.exports = {
        DEL_ERR_NO_REASON: 1,
        DEL_ERR_TOO_MANY_CHAR_DELETION: 2,
        DEL_ERR_BAD_SECRET_ANSWER: 3,
        DEL_ERR_RESTRICED_ZONE: 4
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "GiftSelectionWindow",
            title: a("ui.connection.giftReceived"),
            noCloseButton: !0,
            positionInfo: {
                left: "c",
                top: "c",
                width: 800,
                height: 520
            }
        });
        var e = this;
        this._giftList = [],
        this._giftListIndex = 0,
        this._hasDom = !1,
        this._itemSpace = null ,
        this._charactersSpace = null ,
        this._selectedCharaId = null ,
        this.on("open", function(t) {
            e._characterList = window.gui.gifts.getCharaListMinusDeadPeople(),
            e._giftList = t || [],
            e._createDom(),
            e._setupEvents(),
            e._updateCharactersSpace(),
            e._updateGift()
        }),
        this.on("open", function() {
            window.foreground.lock("giftAttribution")
        }),
        this.on("close", function() {
            window.foreground.unlock("giftAttribution"),
            e._reset()
        })
    }
    i(698);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(699)
      , l = i(705)
      , c = i(204).DofusButton
      , u = i(31);
    o(n, s),
    e.exports = n,
    n.prototype._reset = function() {
        this.windowBody.clearContent(),
        this._hasDom = !1,
        this._giftListIndex = 0,
        this._giftList = [],
        this._itemSpace = null ,
        this._charactersSpace = null
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this;
        window.gui.gifts.on("giftAssignRequestResult", function(t) {
            if (e.openState) {
                var i = e._giftList[e._giftListIndex];
                i && t.actionId === i.uid && (e._charactersSpace.setAssignLoading(!1),
                e._nextGift())
            }
        })
    }
    ,
    n.prototype._createDom = function() {
        var e = this;
        if (!this._hasDom) {
            var t = this.windowBody
              , i = t.createChild("div", {
                className: "left"
            });
            this._itemSpace = i.appendChild(new r);
            var n = t.createChild("div", {
                className: "right"
            });
            this._charactersSpace = n.appendChild(new l),
            this._charactersSpace.on("selectTile", function(t) {
                e._selectedCharaId = t,
                e._assignBtn.enable()
            });
            var o = t.createChild("div", {
                className: "buttonSpace"
            });
            o.appendChild(new c(a("ui.connection.notNow"),{
                scaleOnPress: !0,
                className: "buttonSpaceButton"
            },function() {
                e._nextGift()
            }
            )),
            this._assignBtn = o.appendChild(new c(a("ui.connection.assignGift"),{
                disable: !0,
                scaleOnPress: !0,
                className: "buttonSpaceButton"
            },function() {
                e._assignBtn.disable(),
                e._charactersSpace.setAssignLoading(!0),
                e._assignGift()
            }
            )),
            this._hasDom = !0
        }
    }
    ,
    n.prototype._nextGift = function() {
        var e = this
          , t = this._giftListIndex + 1 >= this._giftList.length;
        if (t)
            return this.close();
        this._giftListIndex += 1,
        this._selectedCharaId = null ,
        this._charactersSpace.reset();
        var i = this.position.x
          , n = this.position.y;
        u.tween(this, {
            opacity: 0,
            webkitTransform: "translate3d(" + i + "px," + n + "px,0) scale(0.8)"
        }, {
            time: 150,
            delay: 0,
            easing: "ease-out"
        }, function() {
            u.tween(e, {
                opacity: 1,
                webkitTransform: "translate3d(" + i + "px," + n + "px,0)  scale(1)"
            }, {
                time: 150,
                delay: 0,
                easing: "ease-out"
            }, function() {
                e._updateGift()
            })
        })
    }
    ,
    n.prototype._assignGift = function() {
        if (this._selectedCharaId) {
            var e = this._giftList[this._giftListIndex];
            e && window.gui.gifts.assignGift(e.uid, this._selectedCharaId)
        }
    }
    ,
    n.prototype._updateGift = function() {
        var e = this._giftList[this._giftListIndex] || {};
        this._itemSpace.update(e)
    }
    ,
    n.prototype._updateCharactersSpace = function() {
        this._charactersSpace.update(this._characterList)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "ItemSpace"
        });
        var e = this
          , t = this.createChild("div", {
            className: "topContainer"
        })
          , i = t.createChild("div", {
            className: "top"
        });
        this._title = i.createChild("div", {
            className: "title"
        }),
        this._description = i.createChild("div", {
            className: "description"
        }),
        i.createChild("div", {
            className: "contentText",
            text: l("ui.connection.contents")
        }),
        this._rewardBoxes = i.appendChild(new r({
            nbRewards: 8
        })),
        this._itemBox = this.appendChild(new a({
            showTitle: !0
        })),
        this._rewardBoxes.on("tapSlot", function(t) {
            e._updateItemBox(t)
        })
    }
    i(700);
    var o = i(26).inherits
      , s = i(190)
      , a = i(701)
      , r = i(703)
      , l = i(35).getText;
    o(n, s),
    e.exports = n,
    n.prototype.update = function(e) {
        e = e || {},
        this._title.setText(e.title),
        this._description.setText(e.text);
        var t = e.items || []
          , i = t[0];
        i ? this._updateItemBox(i) : this._itemBox.hide(),
        this._rewardBoxes.reset();
        for (var n = 0, o = t.length; n < o; n += 1) {
            var s = t[n];
            this._rewardBoxes.addItemInstance(s)
        }
    }
    ,
    n.prototype._updateItemBox = function(e) {
        this._itemBox.displayItem(e),
        this._itemBox.show()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        window.gui.openContextualMenuAround("item", this, {
            item: this.myWindow.itemInstance || this.myWindow.item,
            enableActions: !0,
            enableSet: !1,
            enableRecipe: !1,
            enableInsertRecipe: !0,
            enableSell: !1,
            enableDestroy: !1
        })
    }
    function o() {
        g.openBidHouse(!1, null , this.myWindow.itemId)
    }
    function s() {
        g.openBidHouse(!0, null , this.myWindow.itemInstance)
    }
    function a() {
        P.open("itemRecipes", {
            itemData: this.myWindow.item
        })
    }
    function r() {
        var e = this.myWindow
          , t = e.itemInstance;
        return 1 === t.quantity ? void window.gui.playerData.inventory.confirmDestroyItem(t, 1) : void e._minMaxSelector.openAround(this, {
            min: 1,
            max: t.quantity
        })
    }
    function l() {
        P.open("itemSets", this.myWindow.itemInstance)
    }
    function c(e) {
        O.call(this, "div", {
            className: "ItemBox"
        }),
        this.itemInstance = null ,
        this.item = null ;
        var t = this;
        e = e || {},
        this.showTitle = !!e.showTitle,
        this.showItemActions = !!e.hasOwnProperty("showItemActions") && e.showItemActions,
        this.showDescription = !!e.hasOwnProperty("showDescription") && e.showDescription;
        var i = this._itemTitle = this.createChild("div", {
            className: "itemBox-title"
        });
        this._name = i.createChild("div", {
            className: "itemBox-name"
        }),
        this._level = i.createChild("div", {
            className: "itemBox-level"
        });
        var c = this.createChild("div", {
            className: "infoContainer"
        })
          , u = c.createChild("div", {
            className: "topLeftInfoContainer"
        });
        this.weight = u.createChild("div", {
            className: "weight"
        }),
        this.twoHandedIcon = u.createChild("div", {
            className: "twoHandedIcon"
        }),
        m(this.twoHandedIcon, w("ui.common.twoHandsWeapon"));
        var h = u.createChild("div", {
            className: "itemContainer"
        });
        this.image = h.createChild("div", {
            className: "itemImage"
        }),
        this.durabilityBar = h.appendChild(new S({
            className: ["durabilityBar", "red"]
        })),
        this.durabilityBarDescription = new O("div"),
        m(this.durabilityBar, this.durabilityBarDescription),
        this.tooltipItemDescription = new b,
        m(this.image, this.tooltipItemDescription),
        L(this.image),
        this.image.on("tap", function() {
            t.item && window.gui.openContextualMenuAround("item", this, {
                item: t.item.getItemInstance() || t.item.getItem(),
                enableCertificate: !0
            })
        });
        var d = [{
            title: w("ui.common.effects", 2),
            name: "effects"
        }, {
            title: w("ui.common.conditions"),
            name: "conditions"
        }, {
            title: w("ui.common.short.caracteristic"),
            name: "characteristics"
        }];
        this.panelCollection = {},
        this.topRightInfoContainer = c.createChild("div", {
            className: "topRightInfoContainer"
        }),
        this.itemInfoTabs = new x,
        this.topRightInfoContainer.appendChild(this.itemInfoTabs),
        this.itemInfoPanels = this.topRightInfoContainer.createChild("div", {
            className: "itemInfoPanels"
        });
        for (var p = {
            colIds: ["info"],
            minRows: isNaN(e.minRows) ? k : e.minRows
        }, f = 0, g = d.length; f < g; f += 1) {
            var _ = d[f];
            this.panelCollection[_.name] = this.itemInfoPanels.appendChild(new E(p)),
            this.itemInfoTabs.addTab(_.title, this.panelCollection[_.name])
        }
        var v = this.itemActionContainer = this.createChild("div", {
            className: "actionContainer"
        })
          , y = this.actionBtn = v.appendChild(new M({
            text: w("tablet.itemAction"),
            className: "actionButton"
        },n));
        y.myWindow = this,
        y = this.bidHouseSellBtn = v.appendChild(new M({
            className: ["bidHouseSellButton", "greenButton"],
            addIcon: !0,
            tooltip: w("tablet.itemSellInBidHouse")
        },s)),
        y.myWindow = this,
        y = this.setButton = v.appendChild(new M({
            className: "setButton",
            tooltip: w("ui.common.set")
        },l)),
        y.myWindow = this;
        var C = e.withCraftBtn ? this.image : v;
        y = this.recipeButton = C.appendChild(new M({
            className: "recipeButton",
            tooltip: w("ui.craft.associateReceipts")
        },a)),
        y.myWindow = this,
        e.withBidHouseBtn && (y = this.image.appendChild(new M({
            className: ["bidHouseButton", "greenButton"],
            addIcon: !0,
            tooltip: w("tablet.itemSearchInBidHouse")
        },o)),
        y.myWindow = this);
        var I = this._minMaxSelector = window.gui.windowsContainer.appendChild(new D);
        I.on("confirm", function(e) {
            window.gui.playerData.inventory.confirmDestroyItem(t.itemInstance, e)
        }),
        y = this.destroyButton = v.appendChild(new M({
            className: "destroyButton",
            tooltip: w("ui.common.destroyThisItem")
        },r)),
        y.myWindow = this,
        this.itemDescriptionContainer = this.appendChild(new R({
            className: "itemDescriptionContainer"
        })),
        this.categoryText = this.itemDescriptionContainer.content.createChild("div", {
            className: "category"
        }),
        this.descriptionText = this.itemDescriptionContainer.content.createChild("div", {
            className: "description"
        }),
        this.itemInfoTabs.openTab(0),
        window.gui.playerData.inventory.on("itemModified", function(e) {
            t.itemInstance && t.itemInstance.objectUID === e.objectUID && t.displayItem(e)
        })
    }
    function u(e, t) {
        if (t)
            for (var i = 0; i < t.length; i += 1) {
                var n = t[i]
                  , o = n.effect
                  , s = n.description
                  , a = n.monsterCount;
                a && (s += a);
                var r = e.addRow([s]);
                o.bonusType === -1 ? r.addClassNames("malus") : 1 === o.bonusType && r.addClassNames("bonus")
            }
    }
    function h(e, t, i) {
        var n = i.addRow([e]);
        t && n.addClassNames("malus")
    }
    function d(e, t) {
        for (var i = 0; i < e.length; i++) {
            var n = e[i]
              , o = n.text;
            if ("string" == typeof o)
                h(o, n.isMalus, t);
            else
                for (var s = 0; s < o.length; s++) {
                    var a = o[s];
                    h(a, n.isMalus, t)
                }
        }
    }
    function p(e, t) {
        for (var i = 0; i < e.length; i++)
            t.addRow([e[i]])
    }
    i(702);
    var m = i(206).addTooltip
      , f = i(5)
      , g = i(311)
      , _ = i(224)
      , v = i(399)
      , y = i(206).enableTooltip
      , w = i(35).getText
      , b = i(395)
      , C = i(323)
      , I = C.Item
      , T = C.ItemInstance
      , S = i(643)
      , A = i(36)
      , E = i(485)
      , x = i(682)
      , M = i(204)
      , N = i(26)
      , R = i(302)
      , O = i(190)
      , P = i(22)
      , D = i(201)
      , L = i(32)
      , B = 812
      , k = 5;
    N.inherits(c, O),
    c.prototype._toggleItemActions = function(e) {
        if (this.showItemActions) {
            var t = !(!e || !e.getItemInstance());
            this.actionBtn.setEnable(t),
            this.bidHouseSellBtn.setEnable(!!e),
            e && e.getProperty("itemSetId") !== -1 ? this.setButton.enable() : this.setButton.disable(),
            this.recipeButton.setEnable(!!e),
            this.destroyButton.setEnable(t)
        } else
            this.itemActionContainer.hide()
    }
    ,
    c.prototype._canDisplayDescription = function() {
        return this.showDescription && ("auto" !== this.showDescription || this.itemDescriptionContainer.rootElement.clientHeight > 30)
    }
    ,
    c.prototype.displayMount = function(e, t) {
        t = t || {},
        this.item = null ,
        this.itemInstance = null ,
        this.showTitle = t.hasOwnProperty("showTitle") ? t.showTitle : this.showTitle,
        this.showDescription = t.hasOwnProperty("showDescription") ? t.showDescription : this.showDescription,
        this.weight.setText(w("ui.common.short.weight", 0)),
        this.twoHandedIcon.hide(),
        this.durabilityBar.hide();
        var i = this;
        if (f.preloadImage("gfx/mounts/" + e.model + ".png", function(e) {
            i.image.setStyle("backgroundImage", e)
        }),
        y(this.image, !1),
        this._toggleItemActions(),
        this._canDisplayDescription()) {
            this.categoryText.setText(w("ui.common.category") + w("ui.common.colon") + w("ui.common.ride"));
            var n = w("ui.mount.description", e.name, e.level, e.xpRatio);
            this.descriptionText.setText(n),
            this.itemDescriptionContainer.show(),
            this.itemDescriptionContainer.refresh()
        } else
            this.itemDescriptionContainer.hide();
        this._itemTitle.toggleDisplay(!!this.showTitle),
        this.showTitle && (A.getData("Mounts", e.model, function(e, t) {
            return e ? console.error(e) : void i._name.setText(t.nameId)
        }),
        this._level.setText(w("ui.common.short.level") + " " + e.level));
        for (var o in this.panelCollection)
            this.panelCollection[o].clearContent();
        this.itemInfoTabs.toggleTabDisplay(2, !1),
        _.createEffectInstances(e.effectList, function(e, t) {
            if (e)
                return console.error(e);
            var n = v.sortEffects(t);
            u(i.panelCollection.effects, n)
        })
    }
    ,
    c.prototype.displayItem = function(e, t) {
        if (!(e instanceof I || e instanceof T))
            return console.error(new Error("ItemBox: item is not Item or ItemInstance"));
        if (t = t || {},
        this.showTitle = t.hasOwnProperty("showTitle") ? t.showTitle : this.showTitle,
        this.showDescription = t.hasOwnProperty("showDescription") ? t.showDescription : this.showDescription,
        this.itemInstance = e.getItemInstance(),
        this.item = e,
        this.itemId = e.getProperty("id"),
        this.weight.setText(w("ui.common.short.weight", e.getProperty("weight"))),
        this.twoHandedIcon.toggleDisplay(!!e.getProperty("twoHanded")),
        this.image.setStyle("backgroundImage", e.getProperty("image")),
        y(this.image, !0),
        this.tooltipItemDescription.updateUI(e),
        this._toggleItemActions(e),
        this._canDisplayDescription()) {
            var i = C.getItemTypeMap()[e.getProperty("typeId")].nameId;
            this.categoryText.setText(w("ui.common.category") + w("ui.common.colon") + i),
            this.descriptionText.setText(e.getProperty("descriptionId")),
            this.itemDescriptionContainer.show(),
            this.itemDescriptionContainer.refresh()
        } else
            this.itemDescriptionContainer.hide();
        this._itemTitle.toggleDisplay(!!this.showTitle),
        this.showTitle && (this._name.setText(e.getProperty("nameId")),
        this._level.setText(w("ui.common.short.level") + " " + e.getProperty("level")));
        for (var n in this.panelCollection)
            this.panelCollection[n].clearContent();
        if (e.getProperty("hideEffects"))
            this.panelCollection.effects.addRow([w("ui.set.secretBonus")]);
        else {
            var o = v.getSortedEffectInstances(e);
            u(this.panelCollection.effects, o)
        }
        d(e.getProperty("conditionsFormatted"), this.panelCollection.conditions),
        d(e.getProperty("targetConditionsFormatted"), this.panelCollection.conditions),
        e.getProperty("isWeapon") ? (p(e.getProperty("statsFormatted"), this.panelCollection.characteristics),
        this.itemInfoTabs.toggleTabDisplay(2, !0)) : this.itemInfoTabs.toggleTabDisplay(2, !1);
        var s = this.itemInstance && this.itemInstance.effectsMap[B];
        this.durabilityBar.toggleDisplay(!!s),
        s && (this.durabilityBar.setValue(s.diceNum / s.value),
        this.durabilityBarDescription.setText(s.description))
    }
    ,
    e.exports = c
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        a.call(this, "div", {
            className: "RewardBoxes"
        }),
        e = e || {},
        this._NB_REWARDS = e.nbRewards || 6,
        this._slotList = [],
        this._rewardNextSlot = 0,
        this._content = this.createChild("div", {
            className: "rewardContent"
        }),
        this.reset()
    }
    i(704);
    var o = i(569)
      , s = i(402)
      , a = i(190)
      , r = i(26).inherits
      , l = i(567);
    r(n, s),
    e.exports = n,
    n.prototype.reset = function() {
        this._slotList = [],
        this._rewardNextSlot = 0,
        this._content.clearContent();
        for (var e = 0; e < this._NB_REWARDS; e += 1)
            this._slotList.push(this._content.appendChild(new o))
    }
    ,
    n.prototype.addItemInstance = function(e) {
        var t = this;
        if (!(this._rewardNextSlot >= this._NB_REWARDS)) {
            var i = this._slotList[this._rewardNextSlot];
            i.addClassNames("spinner"),
            this._rewardNextSlot += 1;
            var n = new l({
                itemData: e,
                quantity: e.quantity
            });
            n.on("tap", function() {
                t.emit("tapSlot", e)
            }),
            n.insertBefore(i),
            i.destroy()
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "CharactersSpace"
        }),
        this._tiles = [],
        this.createChild("div", {
            className: "title",
            text: l("ui.connection.whosGift")
        });
        var e = this.createChild("div", {
            className: "content"
        });
        this._scroll = e.appendChild(new r({
            className: "scroll"
        })),
        this._scrollContent = this._scroll.content.createChild("div", {
            className: "scrollContent"
        });
        var t = this.createChild("div", {
            className: "characterContainer"
        });
        this._characterDisplayWebGL = t.appendChild(new c({
            scale: "fitin",
            horizontalAlign: "center"
        })),
        this._loadingOverlay = t.createChild("div", {
            className: "loadingOverlay",
            hidden: !0,
            text: l("ui.connection.assignGift")
        })
    }
    i(706);
    var o = i(26).inherits
      , s = i(190)
      , a = i(707)
      , r = i(302)
      , l = i(35).getText
      , c = i(238);
    o(n, s),
    e.exports = n,
    n.prototype.update = function(e) {
        function t(e) {
            i._deselecteAll(),
            this.addClassNames("selected"),
            i.emit("selectTile", e.id),
            i._characterDisplayWebGL.release(),
            i._characterDisplayWebGL.setLook(e.entityLook, {
                boneType: "characters/",
                skinType: "characters/"
            })
        }
        var i = this;
        this._scrollContent.clearContent(),
        this._tiles = [];
        for (var n = 0, o = e.length; n < o; n += 1) {
            var s = e[n]
              , r = this._scrollContent.appendChild(new a(s.id,s.name,s.level,s.entityLook));
            i._tiles.push(r),
            r.on("select", t)
        }
        this._scroll.refresh()
    }
    ,
    n.prototype._deselecteAll = function() {
        for (var e = 0, t = this._tiles.length; e < t; e += 1) {
            var i = this._tiles[e];
            i.delClassNames("selected")
        }
    }
    ,
    n.prototype.setAssignLoading = function(e) {
        this._loadingOverlay.toggleDisplay(e),
        this._loadingOverlay.addClassNames("spinner")
    }
    ,
    n.prototype.reset = function() {
        this._deselecteAll(),
        this._characterDisplayWebGL.release()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i, n) {
        s.call(this, {
            className: "CharacterTile",
            scaleOnPress: !0
        }, function() {
            o.emit("select", {
                id: e,
                entityLook: n
            })
        });
        var o = this
          , r = a("ui.common.name") + a("ui.common.colon") + t;
        this.createChild("div", {
            className: "name",
            text: r
        });
        var l = a("ui.common.level") + a("ui.common.colon") + i;
        this.createChild("div", {
            className: "level",
            text: l
        })
    }
    i(708);
    var o = i(26).inherits
      , s = i(204)
      , a = i(35).getText;
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "DeleteCharacterConfirmWindow",
            title: l("ui.popup.delete"),
            positionInfo: {
                left: "c",
                top: "c",
                width: p.w,
                height: p.h
            },
            noCloseButton: !0
        });
        var e, t, i, n, o = 50, m = this, f = this.windowBody, g = "";
        this.once("open", function() {
            f.createChild("div", {
                text: l("ui.charSel.secretQuestion"),
                className: "explications"
            });
            var s = function() {
                window.gui.openConfirmPopup({
                    title: l("ui.popup.warning"),
                    message: l("ui.popup.warnBeforeDelete", n),
                    cb: function(e) {
                        e && window.dofus.sendMessage("CharacterDeletionRequestMessage", {
                            characterId: i,
                            secretAnswerHash: u(i + "~" + g)
                        }),
                        a.close(m.id)
                    }
                })
            };
            t = f.createChild("div", {
                className: "secretQuestionDiv"
            }),
            e = f.appendChild(new c({
                attr: {
                    maxlength: o,
                    value: ""
                },
                onEnter: function() {
                    e.blur(),
                    s()
                }
            })),
            e.addClassNames("inputSecretAnswer"),
            e.on("change", function(e) {
                g = e
            });
            var d = f.createChild("div", {
                className: "buttonContainer"
            })
              , p = d.appendChild(new r(l("ui.common.ok")));
            p.on("tap", s);
            var _ = d.appendChild(new r(l("ui.common.cancel")));
            _.on("tap", function() {
                a.close(m.id)
            }),
            this.keyboardHeight = .6 * h.screenHeight
        }),
        this.on("open", function(e) {
            d.disableScroll(!0),
            e = e || {},
            i = e.id,
            n = e.name,
            e.secretQuestion || console.error("DeleteCharacterConfirmWindow: missing secretQuestion for characterId", i),
            t.setText(e.secretQuestion)
        }),
        this.on("opened", function() {
            e.focus()
        }),
        this.on("close", function() {
            e.setValue(""),
            g = "",
            e.blur(),
            d.disableScroll(!1)
        }),
        d.on("show", function(e) {
            m.setPosition(e)
        })
    }
    i(710);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(391)
      , u = i(692)
      , h = i(24).dimensions
      , d = i(301)
      , p = {
        w: 380,
        h: 250
    };
    o(n, s),
    e.exports = n,
    n.prototype.setPosition = function(e) {
        var t = h.screenHeight - e
          , i = {
            left: "c",
            top: (t - p.h) / 2,
            width: p.w,
            height: p.h
        };
        a.positionWindow(this.id, i)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            r.close(o.id),
            l("CLOSE_DOCUMENT")
        }
        function t(e) {
            r.openDialog(o.id),
            a.getData("Documents", e.documentId, function(e, t) {
                return e ? (r.close(o.id),
                console.warn("Documents error", e)) : (t.typeId === u && n.open(t),
                t.typeId === h && c.open(t),
                void l("OPEN_DOCUMENT"))
            })
        }
        s.call(this, {
            className: "documentWindow",
            noTitle: !0,
            noCloseButton: !0,
            positionInfo: {
                left: "c",
                top: "c",
                width: "90%",
                height: "90%"
            }
        });
        var n, o = this;
        window.gui.once("DocumentReadingBeginMessage", function(s) {
            n = i(716),
            o.windowBody.appendChild(c),
            o.windowBody.appendChild(n),
            c.on("close", e),
            n.on("close", e),
            window.gui.on("DocumentReadingBeginMessage", t),
            t(s)
        })
    }
    i(712);
    var o = i(26).inherits
      , s = i(402)
      , a = i(36)
      , r = i(22)
      , l = i(84).playUiSound
      , c = i(713)
      , u = 1
      , h = 2;
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, {
            className: "Scroll"
        }),
        this.setClassNames("Scroll"),
        this.btnClose = this.appendChild(new l({
            className: "btnClose"
        })),
        this.lblTitle = this.createChild("div", {
            className: "lblTitle"
        }),
        this.createChild("div", {
            className: "scrollOrnament"
        }),
        this.lblContent = this.createChild("div", {
            className: "lblContent"
        }),
        this.txIllu = this.createChild("div", {
            className: "scrollImage"
        }),
        this._image = null ,
        this._illuUri = null ,
        this._styleSheet = new c,
        this._hasText = !0;
        var e = this;
        this.btnClose.on("tap", function() {
            e.close()
        })
    }
    function o(e) {
        var t = new RegExp(h).exec(e);
        return null !== t
    }
    function s(e) {
        var t = parseInt(this.getComputedStyle("width"), 10)
          , i = parseInt(this.getComputedStyle("height"), 10)
          , n = (e.height || 539 / p) * t
          , o = (e.width || 354 / d) * i
          , s = {
            backgroundImage: "url(" + e.src + ")",
            backgroundSize: n + "px " + o + "px"
        };
        return s
    }
    var a = i(26).inherits
      , r = i(714)
      , l = i(204)
      , c = i(715)
      , u = i(5)
      , h = /(<[a-zA-Z]+\s*[^>]*>)+([^<].*?)/gi
      , d = 829
      , p = 1150;
    a(n, r),
    e.exports = new n,
    n.prototype.open = function(e) {
        return this._title = e.titleId,
        this._page = e.contentId,
        this._image = this._getImageData(this._page),
        this._page ? (e.contentCSS && this._styleSheet.create(this._formatText(e.contentCSS), ".Scroll"),
        this._preInitData(),
        void this.show()) : (console.warn("Scroll does not exist", e.id),
        this.close())
    }
    ,
    n.prototype._preInitData = function() {
        if (this._hasText = o(this._page),
        !this._image)
            return void this._initScroll();
        var e = this;
        u.preloadImageUrl(this._image.imageId, function(t) {
            e._image && (e._image.src = t,
            e._initScroll())
        })
    }
    ,
    n.prototype.close = function() {
        this.hide(),
        this.lblTitle.clearContent(),
        this.lblContent.clearContent(),
        this._image = null ,
        this.txIllu.setStyle("backgroundImage", ""),
        this._styleSheet.destroy(),
        r.prototype.close.call(this)
    }
    ,
    n.prototype._initScroll = function() {
        var e;
        this.lblTitle.setHtml(this._title);
        var t = "";
        if (t = this._styleSheet ? this._formatText(this._page) : this._page,
        this.lblContent.clearContent(),
        !this._hasText && this._image)
            this.lblContent.hide(),
            e = s.call(this, this._image),
            e.backgroundPosition = "center center",
            e.width = "100%",
            this.txIllu.setStyles(e);
        else {
            this.lblContent.show();
            var i = !!this._image;
            this.lblContent.toggleClassName("small", i),
            this.txIllu.toggleDisplay(i),
            i && (t = t.replace(this._image.regExpResult, ""),
            e = s.call(this, this._image),
            e.width = "",
            this.txIllu.setStyles(e)),
            this.lblContent.appendChild(this._formatLinks(t))
        }
    }
}
, function(e, t, i) {
    function n() {
        o.call(this, "div", {
            hidden: !0
        }),
        this._styleSheet = null ,
        this._title = null ,
        this._author = null ,
        this._subTitle = null ,
        this._pages = null
    }
    var o = i(190)
      , s = i(452)
      , a = i(26).inherits
      , r = i(33).events
      , l = i(210)
      , c = /(.*?)(<img.*?\/?>)/gi
      , u = /#+/g
      , h = /<a\shref=['"](.*?)['"]\s*>(.*?)<\/a>/gi
      , d = /([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))/g
      , p = "startquest"
      , m = "validateobjective"
      , f = "map"
      , g = "url";
    a(n, o),
    e.exports = n,
    n.prototype._linkHandler = function(e) {
        var t = e.split(",");
        t[0] === p ? (window.dofus.sendMessage("QuestStartRequestMessage", {
            questId: t[1]
        }),
        this.close()) : t[0] === m ? (window.dofus.sendMessage("QuestObjectiveValidationMessage", {
            questId: t[1],
            objectiveId: t[2]
        }),
        this.close()) : t[0] === f && window.gui.emit("CompassUpdateMessage", {
            type: s.COMPASS_TYPE_SIMPLE,
            worldX: ~~t[1],
            worldY: ~~t[2]
        })
    }
    ,
    n.prototype.close = function() {
        this.emit("close")
    }
    ,
    n.prototype._getImageData = function(e) {
        var t = new RegExp(c)
          , i = t.exec(e);
        if (!i)
            return null ;
        for (var n, o = i[2], s = new RegExp(d), a = {}; null !== (n = s.exec(o)); )
            n.index === s.lastIndex && s.lastIndex++,
            a[n[1]] = n[2] || n[3];
        var r = {};
        r.regExpResult = i[0],
        r.before = i[1];
        var l = a.src.replace(u, "")
          , h = l.split(",");
        return l = "swf" === h[0] ? "gfx/documents/swf/" + h[1] + ".png" : "gfx/documents/" + h[1] + "." + h[0],
        r.imageId = l,
        r.width = parseInt(a.width, 10),
        r.height = parseInt(a.height, 10),
        r.hspace = parseInt(a.hspace, 10),
        r.align = a.align || "",
        r
    }
    ,
    n.prototype._getAllImagesData = function(e) {
        for (var t, i = [], n = new RegExp(c); null !== (t = n.exec(e)); )
            i.push(this._getImageData(t[0]));
        return i
    }
    ,
    n.prototype._getAllLinks = function(e) {
        for (var t, i = [], n = new RegExp(h); null !== (t = n.exec(e)); )
            i.push({
                text: t[2],
                href: t[1].replace("event:", ""),
                original: t[0]
            });
        return i
    }
    ,
    n.prototype._formatText = function(e) {
        var t = e;
        return t = t.replace(/\n/g, " "),
        t = t.replace(/\r/g, " "),
        t = t.replace(/\t/g, ""),
        t = t.replace(/<p><\/p>/g, "<br/>")
    }
    ,
    n.prototype._formatLinks = function(e) {
        function t(e, t, n) {
            n ? e.addEventListener(r.end, function(e) {
                l.openUrlInAppBrowser(t),
                e.preventDefault()
            }) : e.addEventListener(r.end, function(e) {
                i._linkHandler(t),
                e.preventDefault()
            })
        }
        var i = this
          , n = new o("div");
        n.setHtml(e);
        for (var s = n.rootElement.getElementsByTagName("a"), a = 0, c = s.length; a < c; a++) {
            var u = s[a]
              , h = u.href.replace("event:", "");
            h.indexOf(g) !== -1 ? t(u, h.split(",")[1], !0) : (t(u, h),
            u.href = "#")
        }
        return n
    }
}
, function(e, t) {
    function i() {
        var e = document.createElement("style");
        return e.appendChild(document.createTextNode("")),
        document.head.appendChild(e),
        e
    }
    function n(e, t, i, n) {
        "insertRule"in e ? e.insertRule(t + "{" + i + "}", n) : "addRule"in e && e.addRule(t, i, n)
    }
    function o() {
        this.styleTag = null
    }
    var s = /(\.*?[a-z0-9_\-]+?)[ ]*{[ ]*(.*?\/?)[ ]*}/gi;
    e.exports = o,
    o.prototype.destroy = function() {
        this.styleTag && (document.head.removeChild(this.styleTag),
        this.styleTag = null )
    }
    ,
    o.prototype.create = function(e, t) {
        this.styleTag || (this.styleTag = i());
        for (var o, a = this.styleTag.sheet, r = new RegExp(s); null !== (o = r.exec(e)); )
            o.index === r.lastIndex && r.lastIndex++,
            t && ("body" === o[1] ? o[1] = t : o[1] = t + " " + o[1]),
            n(a, o[1], o[2], 0)
    }
}
, function(e, t, i) {
    function n() {
        o.call(this),
        this.setClassNames("ReadingBook"),
        this.btnClose = this.appendChild(new r({
            className: "btnClose"
        })),
        this.btnHome = this.appendChild(new r({
            className: "btnHome"
        })),
        this.pageLeft = this.createChild("div", {
            className: ["page", "pageLeft"]
        }),
        this.pageRight = this.createChild("div", {
            className: ["page", "pageRight"]
        }),
        this.pageTitle = this.createChild("div", {
            className: ["pageTitle", "page", "pageRight"]
        }),
        this.lblTitle = this.pageTitle.createChild("div", {
            className: "lblTitle"
        }),
        this.lblSubtitle = this.pageTitle.createChild("div", {
            className: "lblSubtitle"
        }),
        this.pageTitle.createChild("div", {
            className: "bookOrnament"
        }),
        this.lblAuthor = this.pageTitle.createChild("div", {
            className: "lblAuthor"
        }),
        this.txDeco = {},
        this.lblPageNumberLeft = this.appendChild(new r({
            className: ["pageNumber", "left"]
        })),
        this.lblPageNumberRight = this.appendChild(new r({
            className: ["pageNumber", "right"]
        })),
        this.btnPrevious = this.appendChild(new r({
            className: ["btnNav", "previous"]
        })),
        this.btnNext = this.appendChild(new r({
            className: ["btnNav", "next"]
        })),
        this._lastIndex = null ,
        this._currentIndex = null ,
        this._nbPages = null ,
        this._styleSheet = new s;
        var e = this
          , t = this.appendChild(new l);
        this.btnClose.on("tap", function() {
            e.close()
        }),
        this.btnHome.on("tap", function() {
            e._currentIndex = -1,
            e._updateButtons(),
            e._updateBook(),
            u("BACK_TO_BEGINNING_DOCUMENT")
        }),
        this.btnPrevious.on("tap", function() {
            e._currentIndex -= 2,
            e._updateButtons(),
            e._updateBook(),
            u("TURN_PAGE_DOCUMENT_1")
        }),
        this.btnNext.on("tap", function() {
            e._currentIndex += 2,
            e._updateButtons(),
            e._updateBook(),
            u("TURN_PAGE_DOCUMENT_2")
        }),
        this.lblPageNumberLeft.on("tap", function() {
            t.setStyles({
                left: "15%",
                right: "initial"
            }),
            t.open({
                min: 1,
                max: e._nbPages + 1,
                placeholder: e._currentIndex + 1
            })
        }),
        this.lblPageNumberRight.on("tap", function() {
            t.setStyles({
                right: "15%",
                left: "initial"
            }),
            t.open({
                min: 1,
                max: e._nbPages + 1,
                placeholder: e._currentIndex + 2
            })
        }),
        t.on("confirm", function(t) {
            e._selectPage(parseInt(t, 10) - 2),
            u("TURN_PAGE_DOCUMENT_3")
        })
    }
    var o = i(714)
      , s = i(715)
      , a = i(26).inherits
      , r = i(204)
      , l = i(201)
      , c = i(5)
      , u = i(84).playUiSound
      , h = "linkpage"
      , d = 840;
    a(n, o),
    e.exports = new n,
    n.prototype.open = function(e) {
        this._title = e.titleId,
        this._author = e.authorId,
        this._subTitle = e.subTitleId,
        e.contentCSS && this._styleSheet.create(this._formatText(e.contentCSS), ".ReadingBook"),
        this._pages = e.contentId.split("<pagefeed/>"),
        this._lastIndex = -1,
        this._currentIndex = -1,
        this._nbPages = this._pages.length,
        this._initBook();
        var t = this._getAllImagesData(e.contentId);
        this.imageMap = {};
        var i = t.map(function(e) {
            return e.imageId
        });
        this.show();
        var n = this;
        c.preloadImageUrls(i, function(e) {
            for (var i = 0; i < t.length; i++)
                n.imageMap[t[i].imageId] = e[i];
            n._selectPage(n._currentIndex)
        })
    }
    ,
    n.prototype.close = function() {
        this._clearPages(),
        this.hide(),
        this._styleSheet.destroy(),
        o.prototype.close.call(this)
    }
    ,
    n.prototype._clearPages = function(e) {
        e && "left" !== e || this.pageLeft.clearContent(),
        e && "right" !== e || this.pageRight.clearContent()
    }
    ,
    n.prototype._initBook = function() {
        this.lblTitle.setHtml(this._title),
        this.lblSubtitle.setHtml(this._subTitle),
        this.lblAuthor.setHtml(this._author || "")
    }
    ,
    n.prototype._updateBook = function() {
        var e = this._currentIndex === -1;
        this.pageTitle.toggleDisplay(e),
        this.pageRight.toggleDisplay(!e),
        this.lblPageNumberLeft.toggleDisplay(!e),
        this.lblPageNumberRight.show(),
        this._clearPages(),
        e ? (this._updatePageLeft(),
        this.lblPageNumberRight.setText(this._currentIndex + 2)) : (this._updatePageLeft(),
        this._updatePageRight()),
        this._lastIndex = this._currentIndex
    }
    ,
    n.prototype._updatePageLeft = function() {
        var e = "";
        e = this._styleSheet && this._currentIndex !== -1 ? this._formatText(this._pages[this._currentIndex - 1]) : this._pages[this._currentIndex - 1] || "",
        this._insertContent(this.pageLeft, e),
        this.lblPageNumberLeft.setText(this._currentIndex + 1)
    }
    ,
    n.prototype._updatePageRight = function() {
        if (this._currentIndex < this._nbPages) {
            this.pageRight.isVisible() || this.pageRight.show();
            var e = "";
            e = this._styleSheet && this._currentIndex !== -1 ? this._formatText(this._pages[this._currentIndex]) : this._pages[this._currentIndex],
            this._insertContent(this.pageRight, e),
            this.lblPageNumberRight.setText(this._currentIndex + 2)
        } else
            this.pageRight.hide(),
            this.lblPageNumberRight.setText("")
    }
    ,
    n.prototype._updateButtons = function() {
        var e = this._currentIndex === -1
          , t = this._currentIndex + 1 >= this._nbPages;
        this.btnHome.toggleDisplay(!e),
        this.btnPrevious.toggleDisplay(!e),
        this.btnNext.toggleDisplay(!t)
    }
    ,
    n.prototype._selectPage = function(e) {
        this._currentIndex = e % 2 ? e : e + 1,
        this._updateButtons(),
        this._updateBook()
    }
    ,
    n.prototype._linkHandler = function(e) {
        if (e.indexOf(h) !== -1) {
            var t = parseInt(e.substr(h.length), 10);
            return this._selectPage(t)
        }
        o.prototype._linkHandler.call(this, e)
    }
    ,
    n.prototype._insertContent = function(e, t) {
        var i = this._getAllImagesData(t);
        if (i.length) {
            for (var n = 0; n < i.length; n++) {
                var o = i[n];
                o.before && e.appendChild(this._formatLinks(o.before)),
                this._addTextureOnPage(e, o),
                t = t.replace(o.regExpResult, "")
            }
            t && e.appendChild(this._formatLinks(t))
        } else
            e.appendChild(this._formatLinks(t))
    }
    ,
    n.prototype._addTextureOnPage = function(e, t) {
        var i = e.createChild("div", {
            className: "image"
        })
          , n = parseInt(this.getComputedStyle("height"), 10)
          , o = t.height / d * n
          , s = {
            height: o + "px",
            width: "100%",
            backgroundImage: "url(" + this.imageMap[t.imageId] + ")"
        };
        "center" === t.align && (s.backgroundPosition = t.align),
        i.setStyles(s)
    }
}
, function(e, t, i) {
    function n(e) {
        function t() {
            var e = i.drawer;
            e.updateCharacter()
        }
        u.call(this, {
            title: a("ui.common.inventory"),
            className: "EquipmentWindow",
            plusButton: !1,
            positionInfo: {
                left: "10%",
                top: "c",
                width: 636,
                height: "90%",
                minHeight: 550
            },
            openingSound: "OPEN_INVENTORY",
            closingSound: "CLOSE_INVENTORY"
        }),
        this.storageView = e,
        this.storageView.registerView(this, {
            manualOpening: !0,
            enableAveragePrice: !1,
            enableSlotContext: !1,
            contextParams: {
                enableActions: !0
            },
            filters: {
                quest: !0,
                preset: !0
            }
        }),
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        }),
        this.once("opened", function() {
            this.drawer.setEquipment()
        }),
        this.on("open", function() {
            this.alignWithCharacteristics(),
            this.storageBox.appendChild(this.storageView.storageUI),
            this.drawer.resetItem()
        });
        var i = this
          , n = window.gui;
        n.on("connected", function() {
            i.once("opened", t)
        }),
        n.on("disconnect", function() {
            i.removeListener("opened", t),
            i.drawer && i.drawer.disconnect()
        })
    }
    i(718);
    var o = i(186)
      , s = i(719)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(323)
      , c = o.setDroppable
      , u = i(402)
      , h = i(22);
    r(n, u),
    e.exports = n,
    n.prototype.alignWithCharacteristics = function() {
        var e = h.getWindow("characteristics");
        e.openState && (this.setStyle("top", e.getStyle("top")),
        h.arrangeOpeningWindow(this.id, {
            rightOf: e.id,
            sameHeight: !0
        }))
    }
    ,
    n.prototype.getEquipmentSlots = function() {
        if (this.drawer)
            return this.drawer.getSlots()
    }
    ,
    n.prototype._setupEvents = function() {
        function e() {
            t.drawer.removePossiblePositionsHighlight()
        }
        var t = this
          , i = window.gui;
        this.on("slot-tap", function(e) {
            e.itemInstance && this.drawer.displayItem(e.itemInstance)
        }),
        this.on("slot-dragStart", function(t) {
            var i = t.dbItem.type.possiblePositions;
            i.length && this.drawer.highlightPossiblePositions(i),
            o.once("dragEnd", e)
        }),
        this.on("focus", function() {
            i.shortcutBar.openPanel("item")
        }),
        this.drawer.on("equippableHighlighted", function(e) {
            t.emit("equippableHighlighted", e)
        }),
        this.drawer.on("itemDropped", function(e, i) {
            t.emit("itemDropped", e, i)
        })
    }
    ,
    n.prototype._createDom = function() {
        this.storageBox = this.windowBody.createChild("div", {
            className: "storageBox"
        }),
        c(this.storageBox, ["characterBox"]),
        this.storageBox.on("drop", function(e) {
            window.dofus.sendMessage("ObjectSetPositionMessage", {
                objectUID: e.itemInstance.objectUID,
                position: l.positions.notEquipped,
                quantity: 1
            })
        }),
        this.drawer = this.windowBody.appendChild(new s)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        m.call(this, "div", {
            className: "EquipmentDrawer"
        }),
        this.content = this.createChild("div", {
            className: "drawerContent"
        }),
        this._slots = {},
        this._createDom(),
        this._setupEvents()
    }
    function o() {
        this.data && window.gui.playerData.inventory.unEquipItem(this.data.objectUID)
    }
    i(720);
    var s = i(238)
      , a = i(32)
      , r = i(186)
      , l = i(35).getText
      , c = i(26).inherits
      , u = i(701)
      , h = i(323)
      , d = i(567)
      , p = i(5)
      , m = i(190)
      , f = h.positions
      , g = {
        bottom: [f.amulet, f.shield, f.ringLeft, f.ringRight, f.belt, f.boots],
        left: [f.dofus1, f.dofus2, f.dofus3, f.dofus4, f.dofus5, f.dofus6],
        right: [f.hat, f.weapon, f.cape, f.pets, f.mount]
    };
    c(n, m),
    e.exports = n,
    n.prototype._createSlot = function(e, t) {
        function i(e) {
            window.gui.playerData.inventory.equipItem(e.data.objectUID, this.position),
            n.emit("itemDropped", e.data, this.position)
        }
        var n = this
          , s = this._slots[t] = e.appendChild(new d({
            scaleOnPress: !0
        }));
        s.addClassNames("pos" + t),
        s.position = t,
        r.setDroppable(s, ["characterBox", "equipment"], {
            matchPositionOnDrop: !0
        }),
        s.on("drop", i),
        s.itemUI = {},
        r.setDraggable(s, s.itemUI, "characterBox"),
        s.on("tap", function() {
            this.data && (n.displayItem(this.data),
            n.emit("itemSelect", this.data))
        }),
        s.on("doubletap", o)
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            window.gui.playerData.inventory.equipItem(e.itemInstance.objectUID)
        }
        var t = this.content.createChild("div", {
            className: "characterBox"
        })
          , i = {};
        i.left = t.createChild("div", {
            className: "leftSlotBox"
        });
        var n = t.createChild("div", {
            className: "rightContainer"
        })
          , o = n.createChild("div", {
            className: "topBox"
        })
          , c = this._character = o.appendChild(new s({
            scale: "fitin",
            horizontalAlign: "center"
        }));
        r.setDroppable(c, ["equipment"]),
        c.on("drop", e);
        var h = c.createChild("div", {
            className: "leftButton"
        });
        a(h, {
            repeatDelay: 100
        }),
        h.on("tap", function() {
            c.rotateCharacter(!1)
        });
        var d = c.createChild("div", {
            className: "rightButton"
        });
        a(d, {
            repeatDelay: 100
        }),
        d.on("tap", function() {
            c.rotateCharacter(!0)
        }),
        i.right = o.createChild("div", {
            className: "rightSlotBox"
        }),
        i.bottom = n.createChild("div", {
            className: "bottomSlotBox"
        });
        for (var p in g)
            for (var m = g[p], f = i[p], _ = 0, v = m.length; _ < v; _ += 1)
                this._createSlot(f, m[_]);
        this._placeHolder = this.content.createChild("div", {
            className: "itemBoxPlaceHolder",
            text: l("ui.common.selectItem")
        }),
        this._itemBox = this.content.appendChild(new u({
            showTitle: !0,
            showItemActions: !0,
            minRows: 7
        }))
    }
    ,
    n.prototype._setSlot = function(e, t) {
        var i = this._slots[e];
        if (i)
            if (t.mountLocation)
                i.setData(t),
                p.preloadImage("gfx/mounts/" + t.model + ".png", function(e) {
                    i.setImage(e)
                });
            else {
                i.setItem(t),
                i.itemUI.backgroundImage = i.getImage(),
                r.enableDrag(i);
                var n = this._slots[f.weapon]
                  , o = this._slots[f.shield]
                  , s = n.itemInstance && n.itemInstance.item;
                s && s.twoHanded ? o.lock() : o.itemInstance || o.unset()
            }
    }
    ,
    n.prototype._unsetSlot = function(e) {
        var t = this._slots[e];
        t && (t.unset(),
        r.disableDrag(t))
    }
    ,
    n.prototype.updateCharacterLook = function(e) {
        this._character.setLook(e, {
            riderOnly: !0,
            boneType: "characters/",
            skinType: "characters/",
            keepDirection: !0,
            keepModels: !0
        })
    }
    ,
    n.prototype.updateCharacter = function() {
        var e = window.gui.playerData.characterBaseInformations;
        this.updateCharacterLook(e.entityLook);
        var t = this._character;
        p.preloadImage("gfx/illusUi/symboles_classe/FichePerso_tx_symboleClasse_frame" + (e.breed - 1) + ".png", function(e) {
            t.setStyle("backgroundImage", e)
        })
    }
    ,
    n.prototype.disconnect = function() {
        this._character.release()
    }
    ,
    n.prototype.setEquipment = function() {
        var e, t = window.gui.playerData, i = t.inventory.equippedItems;
        for (e in this._slots) {
            var n = i[e];
            n ? this._setSlot(e, n) : this._unsetSlot(e)
        }
        t.isRiding && this._setSlot(f.pets, t.equippedMount)
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui
          , i = t.playerData
          , n = i.inventory;
        n.on("itemMoved", function(t, i, n) {
            n === f.notEquipped ? e._unsetSlot(i) : e._setSlot(n, t)
        }),
        n.on("itemAdded", function(t) {
            t.position !== f.notEquipped && e._setSlot(t.position, t)
        }),
        n.on("itemDeleted", function(t, i) {
            var n = e._itemBox.item;
            n && n === i && e.resetItem(),
            i.position !== f.notEquipped && e._unsetSlot(i.position)
        }),
        n.on("itemModified", function(t) {
            t.position !== f.notEquipped && e._setSlot(t.position, t)
        }),
        n.on("listUpdate", function() {
            e.setEquipment()
        }),
        i.on("lookUpdate", function(t) {
            e.updateCharacterLook(t)
        }),
        i.on("mountRiding", function() {
            i.isRiding ? e._setSlot(f.pets, i.equippedMount) : e._unsetSlot(f.pets)
        }),
        i.on("setMount", function() {
            i.isRiding && e._setSlot(f.pets, i.equippedMount)
        })
    }
    ,
    n.prototype.displayItem = function(e) {
        this._placeHolder.hide(),
        this._itemBox.show(),
        e.mountLocation ? this._itemBox.displayMount(e) : this._itemBox.displayItem(e)
    }
    ,
    n.prototype.resetItem = function() {
        this._placeHolder.show(),
        this._itemBox.hide()
    }
    ,
    n.prototype.getSlots = function() {
        return this._slots
    }
    ,
    n.prototype.highlightPossiblePositions = function(e) {
        e = e || [];
        for (var t = 0; t < e.length; t += 1) {
            var i = e[t];
            this._slots[i].addClassNames("selected")
        }
        this.emit("equippableHighlighted", e)
    }
    ,
    n.prototype.removePossiblePositionsHighlight = function() {
        for (var e in this._slots)
            this._slots[e].delClassNames("selected")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, {
            className: "EstateForSellWindow",
            title: _("ui.estate.agency"),
            positionInfo: {
                top: "c",
                left: "c",
                width: "82%",
                height: "94%",
                maxHeight: 660
            }
        });
        var e = this;
        this.once("open", function() {
            e.setupContainer1(),
            e.setupContainer2(),
            e.setupContainer3()
        }),
        this.on("open", function() {
            e.resetFilterData()
        }),
        this.on("close", function() {
            e.table.clearContent(),
            d.close("estateInformation")
        }),
        this.setupSocketEvents()
    }
    function o(e, t) {
        for (var i = {}, n = {}, o = 0; o < e.length; o++)
            i[e[o].modelId] = !0,
            n[e[o].subAreaId] = !0;
        h.getDataMap("Houses", Object.keys(i), function(i, o) {
            return i ? t(i) : void h.getDataMap("SubAreas", Object.keys(n), function(i, n) {
                if (i)
                    return t(i);
                for (var s = window.gui.databases.Areas, a = [], r = 0; r < e.length; r++) {
                    var l = e[r]
                      , c = n[l.subAreaId]
                      , u = o[l.modelId];
                    a.push({
                        type: "house",
                        gfxId: u.gfxId,
                        name: u.nameId,
                        areaName: s[c.areaId].nameId,
                        price: p.kamasToString(l.price),
                        rooms: l.nbRoom,
                        chests: l.nbChest,
                        skillsCount: l.skillListIds.length,
                        subAreaName: c.nameId,
                        ownerName: l.ownerName,
                        ownerConnected: l.ownerConnected,
                        worldX: l.worldX,
                        worldY: l.worldY
                    })
                }
                return t(null , a)
            })
        })
    }
    function s(e, t) {
        for (var i = {}, n = 0; n < e.length; n++)
            i[e[n].subAreaId] = !0;
        h.getDataMap("SubAreas", Object.keys(i), function(i, n) {
            if (i)
                return t(i);
            for (var o = [], s = window.gui.databases.Areas, a = 0; a < e.length; a++) {
                var r = e[a]
                  , l = n[r.subAreaId];
                o.push({
                    type: "paddock",
                    name: _("ui.mount.paddockWithRoom", r.nbObject),
                    areaName: s[l.areaId].nameId,
                    price: p.kamasToString(r.price),
                    mounts: r.nbMount,
                    objects: r.nbObject,
                    subAreaName: l.nameId,
                    ownerName: r.guildOwner ? r.guildOwner : "?",
                    worldX: r.worldX,
                    worldY: r.worldY
                })
            }
            return t(null , o)
        })
    }
    function a() {
        d.open("estateInformation", this.data)
    }
    i(722);
    var r = i(26).inherits
      , l = i(402)
      , c = i(204).DofusButton
      , u = i(208)
      , h = i(36)
      , d = i(22)
      , p = i(210)
      , m = i(393)
      , f = i(723)
      , g = i(485)
      , _ = i(35).getText;
    r(n, l),
    e.exports = n,
    n.prototype.setupRoomSelector = function() {
        var e = this
          , t = 4;
        this.roomSelector.addOption(_("ui.estate.filter.atLeastNbRoom"), 0);
        for (var i = 1; i <= t; i++)
            this.roomSelector.addOption(_("ui.estate.filter.nbRoom", i), i);
        this.roomSelector.on("change", function(t) {
            e.houseToSellFilter.atLeastNbRoom = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupChestSelector = function() {
        var e = this
          , t = 4;
        this.chestSelector.addOption(_("ui.estate.filter.atLeastNbChest"), 0);
        for (var i = 1; i <= t; i++)
            this.chestSelector.addOption(_("ui.estate.filter.nbChest", i), i);
        this.chestSelector.on("change", function(t) {
            e.houseToSellFilter.atLeastNbChest = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupMountSelector = function() {
        var e = this
          , t = 20
          , i = 5;
        this.mountSelector.addOption(_("ui.estate.filter.atLeastNbMount"), 0);
        for (var n = i; n <= t; n += i)
            this.mountSelector.addOption(_("ui.estate.filter.nbMount", n), n);
        this.mountSelector.on("change", function(t) {
            e.paddockToSellFilter.atLeastNbMount = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupBreedingSelector = function() {
        var e = this
          , t = 20
          , i = 5;
        this.breedingSelector.addOption(_("ui.estate.filter.atLeastNbMachine"), 0);
        for (var n = i; n <= t; n += i)
            this.breedingSelector.addOption(_("ui.estate.filter.nbMachine", n), n);
        this.breedingSelector.on("change", function(t) {
            e.paddockToSellFilter.atLeastNbMachine = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupHousingAreaSelector = function() {
        var e = this;
        this.housingAreaSelector.addOption(_("ui.estate.filter.areaRequested"), -1);
        for (var t = f.getAreasWithHouseOrPaddock("house"), i = 0; i < t.length; i++)
            e.housingAreaSelector.addOption(t[i].nameId, t[i].id);
        this.housingAreaSelector.on("change", function(t) {
            e.houseToSellFilter.areaId = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupPaddockAreaSelector = function() {
        var e = this;
        this.paddocksAreaSelector.addOption(_("ui.estate.filter.areaRequested"), -1);
        for (var t = f.getAreasWithHouseOrPaddock("paddock"), i = 0; i < t.length; i++)
            e.paddocksAreaSelector.addOption(t[i].nameId, t[i].id);
        this.paddocksAreaSelector.on("change", function(t) {
            e.paddockToSellFilter.areaId = parseInt(t, 10)
        })
    }
    ,
    n.prototype.setupSkillSelector = function() {
        var e = this;
        this.skillSelector.addOption(_("ui.estate.filter.skillRequested"), 0),
        f.getSkillsAvailableInHouse(function(t, i) {
            if (t)
                return console.error("Failed to retrieve skill list", t);
            for (var n = 0; n < i.length; n++)
                e.skillSelector.addOption(i[n].nameId, i[n].id)
        }),
        this.skillSelector.on("change", function(t) {
            e.houseToSellFilter.skillRequested = parseInt(t, 10)
        })
    }
    ,
    n.prototype.changeDialogType = function(e) {
        this.dialogType = e,
        "house" === e ? (this.roomSelector.show(),
        this.chestSelector.show(),
        this.housingAreaSelector.show(),
        this.skillSelector.show(),
        this.mountSelector.hide(),
        this.breedingSelector.hide(),
        this.paddocksAreaSelector.hide()) : (this.roomSelector.hide(),
        this.chestSelector.hide(),
        this.housingAreaSelector.hide(),
        this.skillSelector.hide(),
        this.mountSelector.show(),
        this.breedingSelector.show(),
        this.paddocksAreaSelector.show())
    }
    ,
    n.prototype.setupContainer1 = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: "container1"
        });
        t.createChild("div", {
            className: ["text", "inline"],
            text: _("ui.estate.typeChoice")
        }),
        this.propertySelector = t.appendChild(new m({
            className: "propertySelector"
        })),
        this.propertySelector.addOption(_("ui.common.housesWord"), "house"),
        this.propertySelector.addOption(_("ui.common.mountPark"), "paddock"),
        this.propertySelector.on("change", function(t) {
            e.changeDialogType(t),
            e.searchButton.emit("tap")
        })
    }
    ,
    n.prototype.setupContainer2 = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: ["wrapper", "container2"]
        });
        t.createChild("div", {
            className: "text",
            text: _("ui.search.criteria")
        });
        var i = t.createChild("div", {
            className: "priceContainer"
        });
        i.createChild("div", {
            className: ["text", "inline"],
            text: _("ui.estate.filter.maxPrice")
        });
        var n = i.createChild("div", {
            className: "inputContainer"
        });
        this.priceInput = n.appendChild(new u({
            minValue: 0,
            title: _("ui.estate.filter.maxPrice")
        })),
        n.createChild("div", {
            className: "kamaUnit",
            text: _("ui.common.short.kama")
        });
        var o = t.createChild("div", {
            className: "col1"
        });
        this.roomSelector = o.appendChild(new m({
            className: "roomSelector"
        })),
        this.setupRoomSelector(),
        this.chestSelector = o.appendChild(new m({
            className: "chestsSelector"
        })),
        this.setupChestSelector(),
        this.mountSelector = o.appendChild(new m({
            className: "mountsSelector"
        })),
        this.setupMountSelector(),
        this.breedingSelector = o.appendChild(new m({
            className: "breedingSelector"
        })),
        this.setupBreedingSelector(),
        this.housingAreaSelector = o.appendChild(new m({
            className: "areaSelector"
        })),
        this.setupHousingAreaSelector(),
        this.paddocksAreaSelector = o.appendChild(new m({
            className: "areaSelector"
        })),
        this.setupPaddockAreaSelector(),
        this.skillSelector = o.appendChild(new m({
            className: "skillSelector"
        })),
        this.setupSkillSelector(),
        this.searchButton = t.appendChild(new c(_("ui.search.search"),{
            className: ["searchButton", "inline"]
        })),
        this.searchButton.on("tap", function() {
            var t = e.priceInput.getValue();
            return "house" === e.dialogType ? (e.houseToSellFilter.maxPrice = t,
            window.dofus.sendMessage("HouseToSellFilterMessage", e.houseToSellFilter),
            void window.dofus.sendMessage("HouseToSellListRequestMessage", {
                pageIndex: 1
            })) : (e.paddockToSellFilter.maxPrice = t,
            window.dofus.sendMessage("PaddockToSellFilterMessage", e.paddockToSellFilter),
            void window.dofus.sendMessage("PaddockToSellListRequestMessage", {
                pageIndex: 1
            }))
        })
    }
    ,
    n.prototype.setupContainer3 = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: ["wrapper", "container3"]
        });
        this.table = t.appendChild(new g({
            colIds: ["name", "subarea", "price", "button"],
            headerContent: [_("ui.common.name"), _("ui.map.subarea"), _("ui.common.price")]
        }));
        var i = t.createChild("div", {
            className: "navigator"
        });
        this.leftButton = i.appendChild(new c("",{
            className: ["leftButton", "inline"]
        })),
        this.pages = i.createChild("div", {
            className: ["pages", "inline"]
        }),
        this.rightButton = i.appendChild(new c("",{
            className: ["rightButton", "inline"]
        })),
        this.leftButton.on("tap", function() {
            var t = {
                pageIndex: e.currentPageIndex - 1
            };
            return "house" === e.dialogType ? void window.dofus.sendMessage("HouseToSellListRequestMessage", t) : void window.dofus.sendMessage("PaddockToSellListRequestMessage", t)
        }),
        this.rightButton.on("tap", function() {
            var t = {
                pageIndex: e.currentPageIndex + 1
            };
            return "house" === e.dialogType ? void window.dofus.sendMessage("HouseToSellListRequestMessage", t) : void window.dofus.sendMessage("PaddockToSellListRequestMessage", t)
        })
    }
    ,
    n.prototype.updateList = function(e) {
        var t = this;
        this.table.clearContent();
        var i = "house" === t.dialogType ? o : s;
        i(e, function(e, i) {
            if (e)
                return console.error("Failed to retrieve data", e);
            for (var n = 0; n < i.length; n++) {
                var o = i[n]
                  , s = new c("...",{
                    name: "infoButton"
                });
                s.data = o,
                s.on("tap", a),
                t.table.addRow({
                    name: o.name,
                    subarea: o.areaName,
                    price: o.price,
                    button: s
                })
            }
        })
    }
    ,
    n.prototype.resetFilterData = function() {
        this.houseToSellFilter = {
            areaId: -1,
            atLeastNbRoom: 0,
            atLeastNbChest: 0,
            skillRequested: 0,
            maxPrice: 0
        },
        this.paddockToSellFilter = {
            areaId: -1,
            atLeastNbMount: 0,
            atLeastNbMachine: 0,
            maxPrice: 0
        },
        this.roomSelector.setValue(0),
        this.chestSelector.setValue(0),
        this.mountSelector.setValue(0),
        this.breedingSelector.setValue(0),
        this.housingAreaSelector.setValue(-1),
        this.paddocksAreaSelector.setValue(-1),
        this.skillSelector.setValue(0),
        this.priceInput.setValue(0),
        window.dofus.sendMessage("HouseToSellFilterMessage", this.houseToSellFilter),
        window.dofus.sendMessage("PaddockToSellFilterMessage", this.paddockToSellFilter)
    }
    ,
    n.prototype.updateDisplay = function(e, t) {
        this.currentPageIndex = t.pageIndex,
        this.currentPageIndex <= 1 ? this.leftButton.disable() : this.leftButton.enable(),
        this.currentPageIndex >= t.totalPage ? this.rightButton.disable() : this.rightButton.enable(),
        this.pages.setText(t.pageIndex + "/" + t.totalPage),
        this.propertySelector.setValue(e),
        this.changeDialogType(e)
    }
    ,
    n.prototype.setupSocketEvents = function() {
        var e = this;
        window.gui.on("HouseToSellListMessage", function(t) {
            d.openDialog(e.id),
            e.updateDisplay("house", t),
            e.updateList(t.houseList)
        }),
        window.gui.on("PaddockToSellListMessage", function(t) {
            d.openDialog(e.id),
            e.updateDisplay("paddock", t),
            e.updateList(t.paddockList)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    var n = i(210)
      , o = i(36)
      , s = null
      , a = null
      , r = null ;
    e.exports.getAreasWithHouseOrPaddock = function(e) {
        var t = "paddock" === e;
        if (s)
            return t ? a : s;
        var i = window.gui.databases.Areas;
        a = [],
        s = [];
        for (var o in i) {
            var r = i[o];
            if (r.containPaddocks || r.containHouses) {
                var l = {
                    id: o,
                    nameId: r.nameId
                };
                r.containPaddocks && a.push(l),
                r.containHouses && s.push(l)
            }
        }
        return n.sortObjectInArray(a, "nameId"),
        n.sortObjectInArray(s, "nameId"),
        t ? a : s
    }
    ,
    e.exports.getSkillsAvailableInHouse = function(e) {
        return r ? e(null , r) : void o.getAllDataMap("Skills", function(t, i) {
            if (t)
                return e(t);
            r = [];
            for (var o in i) {
                var s = i[o];
                s.availableInHouse && r.push({
                    id: s.id,
                    nameId: s.nameId
                })
            }
            return n.sortObjectInArray(r, "nameId"),
            e(null , r)
        })
    }
}
, function(e, t, i) {
    function n() {
        r.call(this, {
            className: "EstateInformationWindow",
            title: a("ui.popup.information"),
            positionInfo: {
                top: "c",
                left: "c",
                width: 580,
                height: 355
            }
        });
        var e = this;
        this.worldX = 0,
        this.worldY = 0,
        this.once("open", function() {
            e.setupDom()
        }),
        this.on("open", function(t) {
            return t ? (e.windowBody.show(),
            void e.updateData(t)) : void e.windowBody.hide()
        })
    }
    i(725);
    var o = i(26).inherits
      , s = i(204).DofusButton
      , a = i(35).getText
      , r = i(402)
      , l = i(22)
      , c = i(5);
    o(n, r),
    e.exports = n,
    n.prototype.setupDom = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: ["container", "container1"]
        })
          , i = t.createChild("div", {
            className: "imageContainer"
        });
        this.image = i.createChild("div", {
            className: "image"
        });
        var n = t.createChild("div", {
            className: "houseDetails"
        });
        this.name = n.createChild("div", {
            className: "name"
        });
        var o = n.createChild("div", {
            className: ["textContainer", "price"]
        });
        o.createChild("div", {
            className: "left",
            text: a("ui.common.price")
        }),
        this.price = o.createChild("div", {
            className: "right"
        }),
        n.createChild("div", {
            className: "message",
            text: a("ui.estate.visit")
        }),
        this.roomsContainer = n.createChild("div", {
            className: ["textContainer", "clear"]
        }),
        this.roomsContainer.createChild("div", {
            className: "left",
            text: a("ui.estate.nbRoom")
        }),
        this.roomCount = this.roomsContainer.createChild("div", {
            className: "right"
        }),
        this.chestContainer = n.createChild("div", {
            className: "textContainer"
        }),
        this.chestContainer.createChild("div", {
            className: "left",
            text: a("ui.estate.nbChest")
        }),
        this.chestCount = this.chestContainer.createChild("div", {
            className: "right"
        }),
        this.mountsContainer = n.createChild("div", {
            className: ["textContainer", "clear"]
        }),
        this.mountsContainer.createChild("div", {
            className: "left",
            text: a("ui.estate.nbMount")
        }),
        this.mountCount = this.mountsContainer.createChild("div", {
            className: "right"
        }),
        this.breedingContainer = n.createChild("div", {
            className: "textContainer"
        }),
        this.breedingContainer.createChild("div", {
            className: "left",
            text: a("ui.estate.nbMachine")
        }),
        this.breedingCount = this.breedingContainer.createChild("div", {
            className: "right"
        }),
        this.skills = n.createChild("div", {
            className: "message"
        });
        var r = this.windowBody.createChild("div", {
            className: ["container", "container2"]
        })
          , c = r.createChild("div", {
            className: "textContainer"
        });
        c.createChild("div", {
            className: ["titleText", "text"],
            text: a("ui.common.localisation")
        }),
        this.coordinate = c.createChild("div", {
            className: "text"
        });
        var u = c.appendChild(new s("",{
            className: "positionBtn"
        }));
        this.locationName = r.createChild("div", {
            className: "locationName"
        });
        var h = this.windowBody.createChild("div", {
            className: ["container", "container3"]
        })
          , d = h.createChild("div", {
            className: "textContainer"
        });
        d.createChild("div", {
            className: ["titleText", "text"],
            text: a("ui.common.ownerWord")
        }),
        this.ownerName = d.createChild("div", {
            className: "text"
        }),
        this.ownerStatus = d.createChild("div", {
            className: "text"
        }),
        this.chatButton = d.appendChild(new s("",{
            className: "chatBtn"
        })),
        u.on("tap", function() {
            isNaN(e.worldX) || isNaN(e.worldY) || (window.gui.emit("CompassUpdateMessage", {
                type: -1,
                worldX: e.worldX,
                worldY: e.worldY
            }),
            l.open("worldMap", {
                x: e.worldX,
                y: e.worldY
            }))
        }),
        this.chatButton.on("tap", function() {
            window.gui.chat.startPrivateMessage(e.ownerName.getText(), !0)
        })
    }
    ,
    n.prototype.updateData = function(e) {
        var t = this;
        if (this.worldX = e.worldX,
        this.worldY = e.worldY,
        this.price.setText(e.price),
        this.coordinate.setText(e.worldX + "," + e.worldY),
        this.ownerName.setText("?" === e.ownerName ? a("ui.common.none") : e.ownerName),
        "?" !== e.ownerName && e.hasOwnProperty("ownerConnected")) {
            var i = a(e.ownerConnected ? "ui.server.state.online" : "ui.server.state.offline");
            this.ownerStatus.setText(" (" + i + ")")
        } else
            this.ownerStatus.setText("");
        this.locationName.setText(e.areaName + " ( " + e.subAreaName + " )"),
        this.chatButton.toggleDisplay("?" !== e.ownerName && e.ownerConnected);
        var n = "gfx/illusUi/enclos_tx_illuEnclos.png"
          , o = "house" === e.type ? "gfx/houses/" + e.gfxId + ".png" : n;
        if (this.image.setStyle("backgroundImage", "none"),
        c.preloadImage(o, function(e) {
            t.image.setStyle("backgroundImage", e)
        }),
        "house" === e.type) {
            this.mountsContainer.hide(),
            this.breedingContainer.hide(),
            this.roomsContainer.show(),
            this.chestContainer.show(),
            this.name.setText(e.name),
            this.roomCount.setText(e.rooms),
            this.chestCount.setText(e.chests);
            var s;
            return s = e.skillsCount > 0 ? a("ui.estate.houseSkills", e.skillsCount) : a("ui.estate.noSkill"),
            this.skills.setText(s),
            void this.skills.show()
        }
        this.name.setText(a("ui.common.mountPark")),
        this.skills.hide(),
        this.roomsContainer.hide(),
        this.chestContainer.hide(),
        this.mountsContainer.show(),
        this.breedingContainer.show(),
        this.mountCount.setText(e.mounts),
        this.breedingCount.setText(e.objects)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        u.call(this, {
            className: "FightEndWindow",
            title: g("ui.fightend.gameResult"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 780,
                height: T + "%"
            }
        });
        var e = this;
        this.once("open", function() {
            function t(e, t) {
                var i = e.outcome
                  , n = [];
                if (i === m.RESULT_LOST || i === m.RESULT_VICTORY ? (n.push("outcome", "outcome" + i),
                t.addClassNames("title")) : "dead" === i && n.push(i),
                n.length)
                    return new h("div",{
                        className: n
                    })
            }
            function i(e) {
                var t = new h("div",{
                    className: "nameBox"
                });
                return t.createChild("div", {
                    className: "nameText",
                    text: e.name
                }),
                e.id === window.gui.playerData.id && t.createChild("div", {
                    className: "isMeArrow"
                }),
                t
            }
            function n(e) {
                var t = "";
                return e.showExperienceFightDelta && (t += g("ui.fightend.xp") + g("ui.common.colon") + v.intToString(e.experienceFightDelta),
                e.isIncarnationExperience && (t += " (" + g("ui.common.incarnation") + ")")),
                e.showExperienceForGuild && (t += "\n" + g("ui.common.guild") + g("ui.common.colon") + v.intToString(e.experienceForGuild)),
                e.showExperienceForMount && (t += "\n" + g("ui.common.ride") + g("ui.common.colon") + v.intToString(e.experienceForMount)),
                t
            }
            function r(e) {
                var t = e.additional || [];
                if (t.length && t[0]) {
                    var i = t[0]
                      , o = i.experienceLevelFloor
                      , s = i.experience - o
                      , r = i.experienceNextLevelFloor - o
                      , l = s / r
                      , c = new h("div",{
                        className: "xpElements"
                    })
                      , u = c.appendChild(new d({
                        value: l
                    }))
                      , p = Math.floor(100 * l) + "% (" + v.intToString(s) + " / " + v.intToString(r) + ")";
                    a(u, p);
                    var m = c.createChild("div", {
                        className: "xpText",
                        text: v.intToString(i.experienceFightDelta)
                    });
                    a(m, n(i));
                    var f = i.rerollExperienceMul;
                    if (f > 1) {
                        var _ = c.createChild("div", {
                            className: ["xpBonusIcon", "bonus" + f]
                        });
                        a(_, g("ui.common.experiencePoint") + " x " + f + "\n\n" + g("ui.information.xpFamilyBonus"))
                    }
                    return c
                }
            }
            function l(e) {
                var t = e.drops || [];
                if (t.length) {
                    for (var i, n, o = [], s = {}, r = 0; r < t.length; r += 1)
                        r % 2 === 0 && (i = t[r],
                        n = t[r + 1] || 0,
                        o.push(i),
                        s[i] = n);
                    if (o.length) {
                        var l = new h("div",{
                            className: ["dropRow", "spinner"]
                        });
                        return f(o, function(t, i) {
                            if (t)
                                return console.warn("Error while getting items", t);
                            if (l.rootElement) {
                                i.sort(function(e, t) {
                                    var i = e.averagePrice * s[e.id]
                                      , n = t.averagePrice * s[t.id];
                                    return n - i
                                });
                                var n, o;
                                for (n = 0; n < i.length && (o = i[n],
                                n !== I); n += 1)
                                    l.appendChild(new y({
                                        itemData: o,
                                        quantity: s[o.id]
                                    }));
                                if (i.length > I) {
                                    var r = l.appendChild(new b({
                                        className: "moreButton"
                                    },function() {
                                        p.getWindow("fightEndRewards").updateContent(e.name, i, s),
                                        p.open("fightEndRewards")
                                    }
                                    ))
                                      , c = "";
                                    for (n = 0; n < i.length; n += 1)
                                        o = i[n],
                                        c += s[o.id] + " x " + o.nameId + "\n";
                                    a(r, c)
                                }
                                l.delClassNames("spinner")
                            }
                        }),
                        l
                    }
                }
            }
            o = {
                0: g("ui.fightend.losers"),
                2: g("ui.fightend.winners"),
                5: g("ui.common.taxCollector")
            },
            s = {
                0: g("ui.fightend.loss"),
                2: g("ui.fightend.victory")
            },
            e.summary = e.windowBody.createChild("div", {
                className: "summary"
            });
            var c = e.summary.createChild("div", {
                className: ["summaryBlock", "block1"]
            })
              , u = e.summary.createChild("div", {
                className: ["summaryBlock", "block2"]
            });
            e.block3 = e.summary.createChild("div", {
                className: ["summaryBlock", "block3"]
            }),
            e.outcomeSummary = c.createChild("div", {
                className: "outcomeSummary"
            });
            var C = u.createChild("div", {
                className: "labels"
            });
            C.createChild("div", {
                text: g("ui.fightend.duration") + g("ui.common.colon")
            }),
            C.createChild("div", {
                text: g("ui.fightend.bonus") + g("ui.common.colon")
            });
            var T = u.createChild("div", {
                className: "values"
            });
            e.duration = T.createChild("div", {
                className: "duration"
            }),
            e.starCounter = T.appendChild(new _),
            a(e.starCounter, function() {
                var t = e.ageBonus || 0;
                return t ? g("ui.fightend.bonus") + g("ui.common.colon") + t + "%" : g("ui.fightend.noBonus")
            }),
            e.table = e.windowBody.appendChild(new w([{
                id: "icon",
                format: t
            }, {
                id: "name",
                header: g("ui.common.name"),
                format: i
            }, {
                id: "level",
                header: g("ui.common.short.level")
            }, {
                id: "xp",
                header: g("ui.fightend.xp"),
                format: r
            }, {
                id: "kamas",
                header: g("ui.common.kamas")
            }, {
                id: "drops",
                header: g("ui.fightend.objects"),
                format: l
            }],null ,{
                clickable: !1
            }))
        }),
        this.on("open", function(t) {
            e._updateResultList(t.msg, t.fighters),
            e._resize()
        }),
        this.on("close", function() {
            e._reset()
        })
    }
    i(727);
    var o, s, a = i(206).addTooltip, r = i(84), l = i(24).dimensions, c = i(26).inherits, u = i(402), h = i(190), d = i(643), p = i(22), m = i(602), f = i(323).getItems, g = i(35).getText, _ = i(284), v = i(210), y = i(567), w = i(400), b = i(204), C = {
        0: 29099,
        2: 29098
    }, I = 5, T = 80;
    c(n, u),
    e.exports = n,
    n.prototype.addChallenge = function(e) {
        function t() {
            s.clearContent(),
            s.createChild("div", {
                className: "challengeName",
                text: e._name
            }),
            s.createChild("div", {
                className: "challengeDesc",
                text: e._description
            }),
            s.createChild("div", {
                className: "challengeLoot",
                text: g("ui.common.loot") + " +" + e.dropBonus + "%"
            }),
            s.createChild("div", {
                className: "challengeXp",
                text: g("ui.common.xp") + " +" + e.xpBonus + "%"
            });
            var t = s.createChild("div", {
                className: "challengeStatus"
            });
            return n ? (t.addClassNames("success"),
            t.setText(g("ui.fight.challenge.complete"))) : (t.addClassNames("fail"),
            t.setText(g("ui.fight.challenge.failed"))),
            s
        }
        var i = e.iconUrl
          , n = e.success
          , o = this.block3.createChild("div", {
            className: ["challenge", n ? "success" : "fail"]
        });
        o.setStyle("backgroundImage", i);
        var s = new h("div",{
            className: "challengeDetails",
            name: "challengeDetails"
        });
        a(o, t)
    }
    ,
    n.prototype._updateResultList = function(e, t) {
        var i = v.durationToString(e.duration / 1e3)
          , n = " (" + g("ui.fight.turnCount", window.gui.fightManager.getTurnCount() + 1) + ")";
        this.duration.setText(i + n),
        this.ageBonus = e.ageBonus || 0,
        this.starCounter.setValue(e.ageBonus);
        var a = window.gui.challengeIndicator.challenges;
        for (var l in a)
            this.addChallenge(a[l].data);
        v.sortObjectInArray(e.results, "outcome", !0);
        for (var c, u, h, d = [], p = [], f = 0; f < e.results.length; f += 1)
            if (c = e.results[f],
            u = c.id,
            h = c.outcome,
            h !== m.RESULT_DEFENDER_GROUP) {
                if (u === window.gui.playerData.id) {
                    this.outcomeSummary.setText(s[h] || "");
                    var _ = C[h];
                    _ && r.playSound("ui", _)
                }
                d[h] || (p.push({
                    outcome: h,
                    name: o[h]
                }),
                d[h] = !0);
                var y = t[u].name;
                p.push({
                    id: c.id,
                    outcome: c.alive ? "" : "dead",
                    name: y,
                    level: c.level || t[c.id].level,
                    additional: c.additional,
                    kamas: v.intToString(c.rewards.kamas),
                    drops: c.rewards.objects
                })
            } else
                console.warn("Hardcode loots not handled (skipped)", c.rewards);
        this.table.addList(p)
    }
    ,
    n.prototype._resize = function() {
        var e = this.table
          , t = e.rows.rootElement.offsetHeight
          , i = e.header.rootElement.offsetHeight
          , n = 123
          , o = Math.round(l.windowFullScreenHeight * T / 100)
          , s = t + i + n;
        s = s < o ? s : o,
        p.positionWindow(this.id, {
            left: "c",
            top: "c",
            width: this.position.width,
            height: s
        }),
        e.scroller.refresh();
        var a = window.device;
        a && "iOS" === a.platform && 0 === a.version.indexOf("10.") && (this.hide(),
        v.forceReflow(this),
        this.show())
    }
    ,
    n.prototype._reset = function() {
        this.block3.clearContent(),
        this.table.clearContent()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e, t) {
            var i = "gfx/heads/SmallHead_" + e.breed + (e.sex ? 1 : 0) + ".png";
            t.setStyle("backgroundImage", "none"),
            v.preloadImage(i, function(e) {
                t.rootElement && t.setStyle("backgroundImage", e)
            })
        }
        function t(e, t) {
            var i = "";
            if (t.teamSide >= 0)
                switch (t.teamSide) {
                case r.ALIGNMENT_NEUTRAL:
                    i += "Neutre";
                    break;
                case r.ALIGNMENT_ANGEL:
                    i += "Bonta";
                    break;
                case r.ALIGNMENT_EVIL:
                    i += "Brakmar";
                    break;
                case r.ALIGNMENT_MERCENARY:
                    i += "Seriane"
                }
            else
                switch (t.teamTypeId) {
                case f.TEAM_TYPE_MONSTER:
                    i += "Monstre";
                    break;
                case f.TEAM_TYPE_TAXCOLLECTOR:
                    i += "Perco";
                    break;
                default:
                    i += "Neutre"
                }
            i += 0 === t.teamId ? "G" : "D",
            i = "gfx/illusUi/fightersType/spectator_tx_Picto" + i + ".png",
            v.preloadImage(i, function(t) {
                e.rootElement && e.setStyle("backgroundImage", t)
            })
        }
        function i() {
            for (var e = q.fightListTable.getRows(), t = 0; t < e.length; t += 1)
                e[t].durationTimeoutId && clearTimeout(e[t].durationTimeoutId)
        }
        function n(e, t) {
            var i = e.getChild("duration");
            if (!t)
                return i.setText("-");
            var o = ~~(Date.now() / 1e3) - t
              , s = p.durationToString(o)
              , a = s.split(":")
              , r = a[0] + ":" + a[1];
            i.setText(r);
            var l = ~~o % 60
              , c = 60 - l;
            e.durationTimeoutId = setTimeout(function() {
                n(e, t)
            }, 1e3 * (c + 1))
        }
        function o(e) {
            for (var t = q.fightListTable.getRows(), i = 0; i < t.length; i += 1) {
                var n = t[i].fight || {};
                if (e === n.fightId)
                    return i
            }
        }
        function y(e) {
            var t = o(e);
            return q.fightListTable.getRow(t)
        }
        function w(e, i) {
            var n = e.createChild("div", {
                className: "nbPlayers"
            });
            n.createChild("div", {
                className: "num",
                text: i.teamMembersCount
            });
            var o = new s("div",{
                className: "fighterTypeIcon"
            });
            0 === i.teamId ? n.insertAsFirstChild(o) : n.appendChild(o),
            t(o, i)
        }
        function b(e, t) {
            var i = new s("div",{
                className: "relation"
            });
            return i.addClassNames(e),
            a(i, t),
            i
        }
        function C(e) {
            var t = e.fightTeams[0]
              , i = e.fightTeams[1]
              , n = ""
              , o = e.fightType
              , r = "";
            o === u.FIGHT_TYPE_PVP_ARENA ? (n += " fightType1",
            r += d("ui.common.koliseum")) : o === u.FIGHT_TYPE_CHALLENGE ? (n += " fightType2",
            r += d("ui.fight.challenge")) : o === u.FIGHT_TYPE_AGRESSION ? (n += " fightType3",
            r += d("ui.alert.event.11")) : o === u.FIGHT_TYPE_PvT && (n += " fightType3",
            r += d("ui.spectator.taxcollectorAttack"));
            var l = ("nbPlayersLine" + n).split(" ")
              , c = new s("div",{
                className: l
            });
            w(c, t),
            w(c, i),
            r && a(c, r);
            var h, p = t.meanLevel * t.teamMembersCount + i.meanLevel * i.teamMembersCount, m = Math.round(p / (t.teamMembersCount + i.teamMembersCount));
            t.hasGroupMember || i.hasGroupMember ? h = b("relation1", d("ui.spectator.isGroup")) : t.hasFriend || i.hasFriend ? h = b("relation2", d("ui.spectator.isFriend")) : (t.hasGuildMember || i.hasGuildMember) && (h = b("relation3", d("ui.spectator.isGuild")));
            var f = new s("div",{
                className: "spectatorLocked",
                name: "spectatorLocked"
            });
            return f.toggleDisplay(e.fightSpectatorLocked),
            {
                spectatorLocked: f,
                nbPlayers: c,
                level: m,
                duration: new s("div",{
                    name: "duration"
                }),
                friend: h || ""
            }
        }
        function I(t, i) {
            var n;
            i.breed > 0 && (n = new s("div",{
                className: "classIcon"
            }),
            e(i, n)),
            t.table.addRow({
                name: i.enrichData.name,
                "class": n || "",
                level: i.level
            })
        }
        function T(e) {
            var t = new s("div",{
                className: ["option", "option" + e],
                hidden: !0
            })
              , i = "";
            return e === c.FIGHT_OPTION_SET_TO_PARTY_ONLY ? i = d("ui.fight.option.blockJoinerExceptParty") : e === c.FIGHT_OPTION_SET_CLOSED ? i = d("ui.fight.option.blockJoiner") : e === c.FIGHT_OPTION_ASK_FOR_HELP && (i = d("ui.fight.option.help")),
            i && a(t, i),
            t
        }
        function S(e, t, i) {
            var n = new s("div",{
                className: t
            })
              , o = n.createChild("div", {
                className: "colTop"
            })
              , a = o.createChild("div", {
                className: "titleContainer"
            });
            a.createChild("div", {
                className: "title",
                text: i
            });
            var r = a.createChild("div", {
                className: "gameFightOptions"
            });
            n.gameFightOptions = {};
            for (var c = 0; c < z.length; c += 1) {
                var u = z[c]
                  , h = T(u);
                r.appendChild(h),
                n.gameFightOptions[u] = h
            }
            n.averageLevelContainer = o.createChild("div", {
                className: "averageLevelContainer"
            });
            var p = d("ui.common.averageLevel") + d("ui.common.colon");
            return n.averageLevelContainer.createChild("span", {
                text: p
            }),
            n.averageLevel = n.averageLevelContainer.createChild("span", {
                className: "averageLevel"
            }),
            n.table = n.appendChild(new m({
                colIds: ["name", "class", "level"],
                colCount: 3,
                highlightable: !1,
                headerContent: [d("ui.common.name"), d("ui.charcrea.breed"), d("ui.common.short.level")]
            })),
            n.joinBtn = n.appendChild(new l(d("ui.common.join"))),
            n.joinBtn.on("tap", function() {
                if (W && W.fightId) {
                    var e = W.fightTeams[n.teamId].leaderId;
                    window.dofus.sendMessage("GameFightJoinRequestMessage", {
                        fightId: W.fightId,
                        fighterId: e
                    }),
                    _.close(q.id)
                }
            }),
            n.teamId = e,
            n
        }
        function A(e) {
            var t = e.gameFightOptions;
            for (var i in t)
                D(e.teamId, i, !1)
        }
        function E() {
            i(),
            q.fightListTable.clearContent()
        }
        function x() {
            q.col1.table.clearContent(),
            q.col1.averageLevelContainer.hide(),
            q.col2.table.clearContent(),
            q.col2.averageLevelContainer.hide(),
            A(q.col1),
            A(q.col2)
        }
        function M() {
            q.col1.joinBtn.disable(),
            q.col2.joinBtn.disable(),
            q.buttonSpectate.disable()
        }
        function N() {
            W = null ,
            E(),
            x(),
            M()
        }
        function R(e) {
            var t = e.joinBtn;
            if (!W)
                return void t.disable();
            var i = e.teamId
              , n = W.fightTeamsOptions[i] || {}
              , o = n.isClosed
              , s = (i + 1) % 2
              , a = W.fightTeams[i] || {}
              , r = W.fightTeams[s] || {}
              , l = o || W.fightStart || a.teamTypeId === f.TEAM_TYPE_MONSTER || a.teamTypeId === f.TEAM_TYPE_TAXCOLLECTOR && !a.hasMyTaxCollector || r.teamTypeId === f.TEAM_TYPE_TAXCOLLECTOR && r.hasMyTaxCollector;
            l ? t.disable() : t.enable()
        }
        function O() {
            var e = window.gui.playerData.identification.hasRights;
            !e && W && W.fightSpectatorLocked ? q.buttonSpectate.disable() : q.buttonSpectate.enable()
        }
        function P() {
            R(q.col1),
            R(q.col2),
            O()
        }
        function D(e, t, i) {
            if (t) {
                var n = q["col" + (e + 1)]
                  , o = n.gameFightOptions[t];
                o && n && o.toggleDisplay(i)
            }
        }
        function L(e, t, i) {
            if (W)
                for (var n in V)
                    if (V[n] === t) {
                        var o = W.fightTeamsOptions[e];
                        o[n] = i;
                        break
                    }
        }
        function B(e) {
            var t = o(e.fightId);
            if (t >= 0) {
                var i = q.fightListTable.getRow(t);
                i.fight.fightSpectatorLocked = e.state;
                var n = q.fightListTable.getCol(t, "spectatorLocked")
                  , s = n.getChild("spectatorLocked");
                s.toggleDisplay(e.state)
            }
        }
        function k(e) {
            0 === e.option && B(e),
            W && W.fightId === e.fightId && (L(e.teamId, e.option, e.state),
            D(e.teamId, e.option, e.state),
            P())
        }
        function F(e, t) {
            if (t = t || [],
            e.table.clearContent(),
            e.averageLevelContainer.toggleDisplay(!!t.length),
            A(e),
            t.length) {
                var i = e.teamId
                  , n = W.fightTeamsOptions[i];
                for (var o in n)
                    if (V.hasOwnProperty(o)) {
                        var s = V[o]
                          , a = n[o];
                        D(i, s, a)
                    }
                for (var r = 0, l = t.length, c = 0; c < l; c++) {
                    var u = t[c];
                    I(e, u),
                    r += u.level
                }
                e.averageLevel.setText(Math.round(r / l))
            }
        }
        function H(e) {
            e = e || {},
            F(q.col1, e.attackers),
            F(q.col2, e.defenders)
        }
        function G(e) {
            e = e || {};
            var t = e.fights || [];
            if (t.length < 1)
                return void N();
            i();
            var s, a, r, l = q.fightListTable.getRows(), c = [];
            l.forEach(function(e) {
                c.push(e.fight.fightId)
            });
            var u = [];
            for (t.forEach(function(e) {
                u.push(e.fightId)
            }),
            s = 0; s < c.length; s += 1) {
                var h = c[s];
                u.indexOf(h) < 0 && (r = o(h),
                q.fightListTable.delRow(r))
            }
            for (s = 0; s < t.length; s++) {
                var d = t[s]
                  , p = C(d);
                r = o(d.fightId),
                a = r >= 0 ? q.fightListTable.updateRow(r, p, {
                    fight: d
                }) : q.fightListTable.addRow(p, {
                    fight: d
                }),
                n(a, d.fightStart)
            }
            if (W && W.fightId) {
                var m = y(W.fightId);
                if (m)
                    return void m.tap()
            }
            var f = q.fightListTable.getRows()[0];
            f.tap()
        }
        function U() {
            window.dofus.sendMessage("MapRunningFightDetailsRequestMessage", {
                fightId: W.fightId
            })
        }
        function j() {
            window.dofus.sendMessage("MapRunningFightListRequestMessage")
        }
        var q = this;
        g.call(this, {
            className: "FightListWindow",
            title: d("ui.spectator.fightList"),
            positionInfo: {
                left: "c",
                top: "c",
                width: "680px",
                height: "96%",
                maxHeight: 630
            }
        });
        var W, V = h.FIGHT_OPTION_KEY_TO_ENUM, z = h.FIGHT_OPTION_ICON_ID;
        this.once("open", function() {
            this.fightListTable = this.windowBody.appendChild(new m({
                colIds: ["spectatorLocked", "nbPlayers", "level", "duration", "friend"],
                colCount: 4,
                highlightable: !0,
                disableAutoSelect: !0,
                headerContent: ["", d("ui.common.numberOfPlayers"), d("ui.common.level"), d("ui.fightend.duration"), d("ui.common.friends")],
                onRowTap: function(e) {
                    W = e.fight,
                    U()
                }
            })),
            this.fightListTable.addClassNames("fightListTable");
            var e = this.windowBody.createChild("div", {
                className: "colsWrapper"
            });
            this.col1 = S(0, ["colTeam", "col1"], d("ui.common.attackers")),
            this.col2 = S(1, ["colTeam", "col2"], d("ui.common.defenders")),
            e.appendChild(this.col1),
            e.appendChild(this.col2),
            this.buttonSpectate = new l(d("ui.common.tospectate"),{
                className: "buttonSpectate"
            }),
            this.buttonSpectate.on("tap", function() {
                W && W.fightId && (window.dofus.sendMessage("GameFightJoinRequestMessage", {
                    fightId: W.fightId,
                    fighterId: 0
                }),
                _.close(q.id))
            }),
            this.windowBody.appendChild(this.buttonSpectate)
        }),
        this.on("open", function() {
            N(),
            j()
        }),
        this.on("close", function() {
            window.dofus.sendMessage("StopToListenRunningFightRequestMessage")
        });
        var Y = window.gui;
        Y.on("MapFightCountMessage", function() {
            q.isVisible() && j()
        }),
        Y.on("MapRunningFightListMessage", G),
        Y.on("MapRunningFightDetailsMessage", function(e) {
            H(e),
            P()
        }),
        Y.on("GameRolePlayRemoveChallengeMessage", function() {
            q.isVisible() && j()
        }),
        Y.on("GameFightOptionStateUpdateMessage", function(e) {
            q.isVisible() && k(e)
        }),
        Y.playerData.position.on("mapChanged", function() {
            _.close(q.id)
        })
    }
    i(729);
    var o = i(26).inherits
      , s = i(190)
      , a = i(206).addTooltip
      , r = i(292)
      , l = i(204).DofusButton
      , c = i(219)
      , u = i(502)
      , h = i(217)
      , d = i(35).getText
      , p = i(210)
      , m = i(485)
      , f = i(730)
      , g = i(402)
      , _ = i(22)
      , v = i(5);
    o(n, g),
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        TEAM_TYPE_PLAYER: 0,
        TEAM_TYPE_MONSTER: 1,
        TEAM_TYPE_MUTANT: 2,
        TEAM_TYPE_TAXCOLLECTOR: 3,
        TEAM_TYPE_BAD_PLAYER: 4
    }
}
, function(e, t, i) {
    function n() {
        a.call(this, {
            className: "globalWindow",
            title: c("ui.common.mainMenu"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 300,
                height: 235
            }
        }),
        this.once("open", function() {
            this._createContent()
        }),
        this.on("open", function() {
            this._buildVersion.setText(window.gui.getBuildVersion()),
            this.buttonChangeCharacter.setEnable(!window.gui.playerData.isFighting);
            var e = h.getCharacterList();
            this.setupSelectorOptions(e),
            this.multiCharacterSelector.setEnable(!window.gui.playerData.isFighting && e.length >= 2)
        })
    }
    i(732);
    var o = i(26).inherits
      , s = i(50)
      , a = i(402)
      , r = i(22)
      , l = i(204).DofusButton
      , c = i(35).getText
      , u = i(393)
      , h = i(442);
    o(n, a),
    e.exports = n,
    n.prototype._createContent = function() {
        this.buttonOptions = this.windowBody.appendChild(new l(c("ui.common.options"))),
        this.buttonOptions.on("tap", function() {
            r.close("global"),
            r.open("options")
        }),
        this.container = this.windowBody.createChild("div", {
            className: "container"
        });
        var e = this;
        this.multiCharacterSelector = this.container.appendChild(new u({
            className: "multiCharacterSelector"
        })),
        this.multiCharacterSelector.on("change", function(t) {
            e._lastMultiCharacterSelection = t,
            s.reconnectByCharId(t),
            r.close("global")
        }),
        this.buttonChangeCharacter = this.container.appendChild(new l(c("ui.common.changeCharacter"),{
            className: "changeCharacterButton"
        })),
        this.buttonChangeCharacter.on("tap", function() {
            window.gui.openConfirmPopup({
                title: c("ui.common.confirm"),
                message: c("ui.common.confirmChangeCharacter"),
                cb: function(e) {
                    e && (r.close("global"),
                    s.goBackToSelectionOf("character"))
                }
            })
        }),
        this.buttonDisconnect = this.windowBody.appendChild(new l(c("ui.common.disconnect"))),
        this.buttonDisconnect.on("tap", function() {
            window.gui.openConfirmPopup({
                title: c("ui.common.confirm"),
                message: c("ui.common.confirmDisconnect"),
                cb: function(e) {
                    e && (r.close("global"),
                    window.dofus.disconnect())
                }
            })
        }),
        this.buttonReturnToGame = this.windowBody.appendChild(new l(c("ui.common.returnToGame"))),
        this.buttonReturnToGame.on("tap", function() {
            r.close("global")
        }),
        this._buildVersion = this.windowBody.createChild("div", {
            className: "buildVersion"
        })
    }
    ,
    n.prototype.setupSelectorOptions = function(e) {
        var t = window.gui.databases.Breeds;
        this.multiCharacterSelector.clearContent();
        for (var i = 0; i < e.length; i++) {
            var n = e[i]
              , o = n.name + " (" + t[n.breed].shortNameId + " " + n.level + ")";
            this.multiCharacterSelector.addOption(o, n.id)
        }
        if (this._lastMultiCharacterSelection) {
            var s = !0;
            this.multiCharacterSelector.select(this._lastMultiCharacterSelection, s)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            t.setTitle(t.tabsDefinitions[this.tabId].title)
        }
        s.call(this, {
            className: "GrimoireWindow",
            positionInfo: {
                top: "c",
                left: "c+20px",
                width: "90%",
                height: "97%",
                maxWidth: 905,
                maxHeight: 620,
                mustAvoidToolbar: !0
            }
        });
        var t = this
          , i = ["spells", "quests", "alignment", "jobs", "almanax", "achievements", "ornaments", "bestiary"]
          , n = this.tabsDefinitions = {
            spells: {
                target: new m
            },
            quests: {
                target: new p
            },
            alignment: {
                target: new l
            },
            jobs: {
                target: new f
            },
            almanax: {
                target: new c
            },
            achievements: {
                target: new u
            },
            ornaments: {
                target: new d
            },
            bestiary: {
                target: new h
            }
        }
          , o = this.windowBody;
        this.tabs = o.appendChild(new r);
        for (var a = 0; a < i.length; a += 1) {
            var g = i[a]
              , _ = n[g]
              , v = o.appendChild(_.target);
            v.tabId = g,
            this.tabs.addTab("", v, g),
            v.on("open", e)
        }
        this._initTabs(),
        this.on("open", function(e) {
            this.tabs.openTab(e.tabId, e.tabParams, {
                delayOpenedEvent: !0,
                forceOpen: !0
            })
        }),
        this.on("opened", function() {
            this.tabs.emitOnCurrentTab("opened")
        }),
        this.on("focus", function() {
            this.tabs.emitOnCurrentTab("focus")
        }),
        this.on("close", function() {
            this._resetTabs()
        }),
        window.gui.uiLocker.on("updated", function(e) {
            if ("grimoire" === e.windowId && e.tabId)
                return n[e.tabId] ? void t.tabs.toggleTabAvailability(e.tabId, !e.locked) : console.error(new Error("Unknown tab id `" + e.tabId + "` in grimoire window."))
        }),
        window.gui.on("disconnect", function() {
            t._resetTabs(),
            t._initTabs()
        })
    }
    i(734);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(735)
      , l = i(737)
      , c = i(739)
      , u = i(741)
      , h = i(745)
      , d = i(747)
      , p = i(749)
      , m = i(752)
      , f = i(754);
    o(n, s),
    e.exports = n,
    n.prototype._initTabs = function() {
        var e = this.tabsDefinitions;
        e.spells.title = a("ui.grimoire.mySpell"),
        e.quests.title = a("ui.common.quests"),
        e.alignment.title = a("ui.common.alignment"),
        e.jobs.title = a("ui.common.myJobs"),
        e.almanax.title = a("ui.almanax.almanax"),
        e.achievements.title = a("ui.achievement.achievement"),
        e.ornaments.title = a("ui.common.titles"),
        e.bestiary.title = a("ui.common.bestiary");
        for (var t in e) {
            var i = window.gui.uiLocker.isTabAvailable("grimoire", t);
            this.tabs.toggleTabAvailability(t, i)
        }
    }
    ,
    n.prototype.getOpenedTabId = function() {
        return this.tabs.getCurrentTabId()
    }
    ,
    n.prototype._resetTabs = function() {
        this.tabs.close()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "WindowSideTabs"
        }),
        this.delClassNames("tabs")
    }
    i(736);
    var o = i(26).inherits
      , s = i(682);
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "AlignmentWindow",
            name: "alignment"
        });
        var e = this;
        this._setupEvents(),
        this.once("opened", function() {
            e._createDom(),
            e._updateDisplay(),
            e.on("open", function() {
                e._updateDisplay()
            }),
            e.on("opened", function() {
                e.updateCharacter()
            })
        }),
        this.on("closed", function() {
            this.characterDisplay.release()
        })
    }
    i(738);
    var o = i(26).inherits
      , s = i(190)
      , a = i(485)
      , r = i(643)
      , l = i(204).DofusButton
      , c = i(35).getText
      , u = i(238)
      , h = i(279)
      , d = i(206).addTooltip;
    o(n, s),
    e.exports = n,
    n.prototype.updateCharacter = function() {
        var e = window.gui.playerData.characterBaseInformations.entityLook;
        this.characterDisplay.setLook(e, {
            riderOnly: !0,
            direction: h.DIRECTION_SOUTH,
            animation: "AnimStatique",
            boneType: "characters/",
            skinType: "characters/"
        })
    }
    ,
    n.prototype._createDom = function() {
        function e() {
            return window.gui.playerData.isPvpAggressable() ? window.gui.playerData.alignment.alignmentInfos.honor + " / " + window.gui.playerData.alignment.alignmentInfos.honorNextGradeFloor : "0"
        }
        var t = this.createChild("div", {
            className: "leftColumn"
        })
          , i = this.rightColumn = this.createChild("div", {
            className: "rightColumn"
        })
          , n = t.createChild("div", {
            className: "topRow"
        })
          , o = n.createChild("div", {
            className: "thumbnail"
        });
        this.alignmentImage = o.createChild("div", {
            className: "alignmentImage"
        }),
        this.characterDisplay = n.appendChild(new u({
            scale: 2,
            verticalAlign: "top",
            horizontalAlign: "center"
        }));
        var h = new s("div",{
            className: "alignmentWingsWrapper"
        });
        this.characterDisplay.insertAsFirstChild(h),
        this.alignmentWingsContainer = h.createChild("div", {
            className: "alignmentWingsContainer"
        });
        var p = t.createChild("div", {
            className: "alignmentInfo"
        });
        this.alignmentName = p.createChild("div", {
            className: "title"
        }),
        this.alignmentLevel = p.createChild("div", {
            className: "level"
        });
        var m = t.createChild("div", {
            className: "pvpBox"
        });
        m.createChild("div", {
            className: "title",
            text: c("ui.pvp.pvpMode")
        });
        var f = this.pvpContainer = m.createChild("div", {
            className: "pvpContainer"
        })
          , g = f.createChild("div", {
            className: "rankContainer"
        });
        g.createChild("div", {
            className: "rank",
            text: c("ui.pvp.rank")
        }),
        this.alignmentGrade = g.createChild("div", {
            className: "value"
        });
        var _ = f.createChild("div", {
            className: "progress"
        });
        _.createChild("div", {
            className: "text",
            text: c("ui.pvp.honourPoints")
        }),
        this.honorPoints = _.appendChild(new r({
            className: "yellow"
        })),
        d(this.honorPoints, e),
        f.createChild("div", {
            className: "text"
        }),
        f.appendChild(new a({
            className: "balance",
            headerContent: [c("ui.pvp.alignedAreaModificators")],
            colIds: ["modifier"]
        })),
        this.pvpButton = m.appendChild(new l(c("ui.pvp.enabled", {
            className: "pvpButton"
        }))),
        this.pvpButton.on("tap", function() {
            window.dofus.sendMessage("SetEnablePVPRequestMessage", {
                enable: !window.gui.playerData.isPvpAggressable()
            })
        });
        var v = i.createChild("div", {
            className: "headerRow"
        });
        this.icon = v.createChild("div", {
            className: ["icon", "image"]
        }),
        this.title = v.createChild("div", {
            className: "title"
        }),
        this.specialisations = i.appendChild(new a({
            className: "specialisations",
            headerContent: [c("ui.pvp.allSpecializations")],
            colIds: ["spec", "minimumAlignment"]
        })),
        i.createChild("div", {
            className: "arrow"
        }),
        i.appendChild(new a({
            className: "abilities",
            headerContent: [c("ui.common.feats")],
            colIds: ["ability"]
        }))
    }
    ,
    n.prototype._displayPvpInformations = function() {
        var e = this
          , t = window.gui.playerData.alignment
          , i = window.gui.playerData.isPvpAggressable();
        i ? (this.pvpButton.setText(c("ui.pvp.disabled")),
        this.pvpContainer.delClassNames("disabled"),
        t.getTopWings(t.alignmentInfos, function(t) {
            e.alignmentWingsContainer.setStyles({
                backgroundImage: t.backgroundImage,
                left: t.left,
                top: t.top,
                width: t.width,
                height: t.height
            })
        }),
        this.alignmentGrade.setText(t.getAlignmentGradeString()),
        this.honorPoints.setValue(t.getHonor())) : (this.pvpButton.setText(c("ui.pvp.enabled")),
        this.pvpContainer.addClassNames("disabled"),
        this.alignmentWingsContainer.setStyle("backgroundImage", "none"),
        this.alignmentGrade.setText("-"),
        this.honorPoints.setValue(0))
    }
    ,
    n.prototype._displaySpecialisations = function(e) {
        var t = window.gui.playerData.alignment
          , i = t.alignmentInfos;
        if (this.specialisations.clearContent(),
        0 !== i.alignmentSide)
            for (var n = 0; n < t.alignmentRanks.length; n++) {
                var o = t.alignmentRanks[n];
                o.orderId === e && this.specialisations.addRow([o.nameId, o.minimumAlignment])
            }
    }
    ,
    n.prototype._updateDisplay = function() {
        var e = window.gui.playerData.alignment
          , t = e.alignmentInfos;
        if (this.characterDisplay) {
            var i = this;
            0 === t.alignmentSide ? (this.rightColumn.addClassNames("disabled"),
            this.pvpButton.hide()) : (this.rightColumn.delClassNames("disabled"),
            this.pvpButton.show()),
            this._displayPvpInformations();
            var n = e.getNameId();
            i.alignmentName.setText(c("ui.common.alignment") + " " + n),
            e.getRank(function(n, o) {
                return n ? console.error("Failed to get alignment rank", n) : (i.alignmentLevel.setText(o.nameId + " - " + c("ui.common.level") + " " + t.alignmentValue),
                i._displaySpecialisations(o.orderId),
                void e.getOrder(o, function(t, n) {
                    return t ? console.error("Failed to get AlignmentOrder", t) : (i.title.setText(n.nameId),
                    e.getAlignmentImageUrl(function(e) {
                        i.alignmentImage.setStyle("backgroundImage", e)
                    }),
                    void e.getOrderImageUrl(n.id, function(e) {
                        i.icon.setStyle("backgroundImage", e)
                    }))
                }))
            })
        }
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui
          , i = window.gui.playerData.alignment;
        i.on("alignmentChanged", function() {
            e._updateDisplay()
        }),
        t.playerData.on("lookUpdate", function() {
            e.characterDisplay && e.updateCharacter()
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, "div", {
            className: "AlmanaxWindow",
            name: "almanax"
        }),
        this._calendarDate = -1,
        this.lastUpdate = 0,
        this.isRefreshPending = !1;
        var e = window.dofus.connectionManager
          , t = this;
        this.on("open", this._refreshIfNeeded),
        e.on("_AlmanaxDataErrorMessage", function() {
            t._handleError()
        }),
        e.on("_AlmanaxDataMessage", function(e) {
            var i = window.gui.databases.AlmanaxCalendars[t._calendarDate]
              , n = i.npcId;
            g.getData("Npcs", n, function(i, o) {
                return i ? console.warn("AlmanaxWindow getNpcData for npcId:", n, "error:", i) : (e.meryde = o,
                t._setDefaultData(e),
                t.lastUpdate = (new Date).getUTCDate(),
                t._createContent(),
                t._updateQuestProgress(),
                t._updateAlmanaxData(e),
                t.delClassNames("spinner"),
                void (t.isRefreshPending = !1))
            })
        }),
        e.on("AlmanachCalendarDateMessage", function(e) {
            t._calendarDate = e.date,
            t._showAlmanaxNotification(e.date, e._merydeName)
        })
    }
    i(740);
    var o = i(26).inherits
      , s = i(643)
      , a = i(204)
      , r = i(190)
      , l = i(210)
      , c = i(206)
      , u = c.addTooltip
      , h = c.enableTooltip
      , d = i(35).getText
      , p = i(323)
      , m = i(452)
      , f = i(451)
      , g = i(36)
      , _ = i(5)
      , v = i(22)
      , y = i(30)
      , w = 365
      , b = 954
      , C = -4
      , I = -24
      , T = 13344
      , S = 13345;
    o(n, r),
    e.exports = n,
    n.prototype._refreshIfNeeded = function() {
        var e = (new Date).getUTCDate();
        return e === this.lastUpdate ? this._updateQuestProgress() : void (this.isRefreshPending || (this.isRefreshPending = !0,
        this.clearContent(),
        this.addClassNames("spinner"),
        window.dofus.send("almanaxDataRequest")))
    }
    ,
    n.prototype._handleError = function() {
        this._createRetryButton(),
        this.delClassNames("spinner"),
        this.isRefreshPending = !1
    }
    ,
    n.prototype._createRetryButton = function() {
        var e = this.createChild("div", {
            className: "failureBox"
        });
        e.createChild("div", {
            text: d("ui.common.error") + "..."
        });
        var t = e.appendChild(new a({
            className: "greenButton",
            text: d("tablet.common.retry")
        }))
          , i = this;
        t.on("tap", function() {
            i._refreshIfNeeded()
        })
    }
    ,
    n.prototype._createContent = function() {
        var e = this.createChild("div", {
            className: "col1"
        })
          , t = e.createChild("div", {
            className: "dateBlock"
        });
        this.monthText = t.createChild("div", {
            className: "monthText"
        });
        var i = t.createChild("div", {
            className: "dayBg"
        });
        this.dayNumber = i.createChild("div", {
            className: "dayNumber"
        }),
        this.yearText = t.createChild("div", {
            className: "yearText"
        });
        var n = t.createChild("div", {
            className: "illusWrapper"
        });
        this.astro = n.createChild("div", {
            className: "smallIllus"
        }),
        this.monthGod = n.createChild("div", {
            className: "smallIllus"
        });
        var o = t.createChild("div", {
            className: "bottomIllusWrapper"
        });
        this.bottomIllus = o.createChild("div", {
            className: "bottomIllus"
        }),
        this.linkToCalendar = e.appendChild(f.newExternalLink(d("ui.almanax.link"), d("ui.almanax.calendar")));
        var l, c = this.createChild("div", {
            className: "col2"
        });
        l = c.createChild("div");
        var h = l.createChild("div", {
            className: ["block", "saintBlock"]
        })
          , g = h.createChild("div", {
            className: "saintBg"
        });
        this.merydeIllus = g.createChild("div", {
            className: "saintIllus"
        }),
        this.merydeTitle = h.createChild("div", {
            className: "title"
        }),
        this.merydeDesc = h.createChild("div", {
            className: "description"
        }),
        this.instructionText = h.createChild("div", {
            className: "instructionText"
        }),
        l = c.createChild("div");
        var _ = l.createChild("div", {
            className: ["block", "bonusBlock"]
        });
        _.createChild("div", {
            className: ["smallIllus", "bonusIllus"]
        }),
        this.bonusTitle = _.createChild("div", {
            className: "title"
        }),
        this.bonusDesc = _.createChild("div", {
            className: "description"
        }),
        l = c.createChild("div");
        var v = l.createChild("div", {
            className: ["block", "questBlock"]
        })
          , y = v.createChild("div", {
            className: "questContent"
        })
          , w = y.createChild("div", {
            className: "dolmanaxBg"
        })
          , b = w.createChild("div", {
            className: "dolmanaxIllus"
        });
        p.getItems([T], function(e) {
            return e ? console.error(e) : void b.setStyle("backgroundImage", p.items[T].image)
        }),
        y.createChild("div", {
            className: "title",
            text: d("ui.almanax.dolmanaxQuest")
        }),
        this.questDesc = y.createChild("div", {
            className: "description"
        });
        var S = y.createChild("div", {
            className: "buttonContainer"
        });
        this.locateButton = S.createChild("div", {
            className: "locateButton"
        });
        var A = S.appendChild(new a({
            className: "greenButton",
            text: d("ui.almanax.localizeSanctuary")
        }));
        A.on("tap", function() {
            window.gui.emit("CompassUpdateMessage", {
                type: m.COMPASS_TYPE_SIMPLE,
                worldX: C,
                worldY: I
            })
        });
        var E = y.createChild("div", {
            className: "progression"
        });
        this.questProgressTitle = E.createChild("div", {
            className: "questProgressTitle"
        }),
        this.questProgressBar = E.appendChild(new s({
            className: "questProgressBar"
        })),
        this.astroTooltipTx = new r("div"),
        u(this.astro, this.astroTooltipTx),
        this.monthGodTooltipTx = new r("div"),
        u(this.monthGod, this.monthGodTooltipTx),
        this.merydeTootipTx = new r("div"),
        u(this.merydeIllus, this.merydeTootipTx),
        this.questTooltipTx = new r("div"),
        u(this.questProgressBar, this.questTooltipTx),
        u(this.linkToCalendar, d("ui.almanax.goToWebsite"))
    }
    ,
    n.prototype._setDefaultData = function(e) {
        function t(e) {
            return e && "false" !== e
        }
        var i = e.event
          , n = e.zodiac
          , o = e.month
          , s = ["gfx/almanax/jour.jpg", "gfx/almanax/protecteur.jpg", "gfx/almanax/constellation.jpg"];
        _.preloadImageUrls(s, function(e) {
            t(i.imageurl) || (i.bossText = i.bossText || d("ui.almanax.default.boss"),
            i.ephemeris = i.ephemeris || d("ui.almanax.default.ephemeris"),
            i.imageurl = i.imageurl || e[0]),
            t(o.protectorimageurl) || (o.protectorDescription = o.protectorDescription || d("ui.almanax.default.protector"),
            o.protectorimageurl = o.protectorimageurl || e[1]),
            t(n.imageurl) || (n.description = n.description || d("ui.almanax.default.zodiac"),
            n.imageurl = n.imageurl || e[2])
        })
    }
    ,
    n.prototype._updateAlmanaxData = function(e) {
        var t = window.gui.databases.AlmanaxCalendars[this._calendarDate]
          , i = l.getAlmanaxDate();
        this.dayNumber.setText(i.day),
        this.monthText.setText(i.monthName),
        this.yearText.setText(d("ui.common.year", i.year));
        var n = e.event
          , o = e.zodiac
          , s = e.month
          , a = e.meryde;
        this.astro.setStyle("backgroundImage", "url(" + o.imageurl + ")"),
        this.monthGod.setStyle("backgroundImage", "url(" + s.protectorimageurl + ")"),
        this.bottomIllus.setStyle("backgroundImage", "url(" + n.imageurl + ")"),
        this.merydeTitle.setText(d("ui.almanax.dayMeryde", a.nameId)),
        this.merydeDesc.setText(n.ephemeris),
        this.instructionText.setText(d("ui.almanax.offeringTo", a.nameId)),
        this.bonusTitle.setText(d("ui.almanax.dayBonus") + d("ui.common.colon") + t.nameId),
        this.bonusDesc.setHtml(t.descId),
        this.merydeIllus.setStyle("backgroundImage", "url(" + n.bossimageurl + ")"),
        this.astroTooltipTx.setText(o.description),
        h(this.astro, !!o.description),
        this.monthGodTooltipTx.setText(s.protectordesc),
        h(this.monthGod, !!s.protectordesc),
        this.merydeTootipTx.setText(n.bosstext),
        h(this.merydeIllus, !!n.bosstext)
    }
    ,
    n.prototype._updateQuestProgress = function() {
        if (window.gui.playerData.quests.finished[b])
            return this.questDesc.setText(d("ui.almanax.dolmanaxQuestDone")),
            this.questProgressTitle.setText(d("ui.almanax.questDone")),
            void this.questProgressBar.setValue(1);
        this.questDesc.setText(d("ui.almanax.dolmanaxQuestDesc")),
        this.questProgressTitle.setText(d("ui.almanax.questProgress"));
        var e = window.gui.playerData.inventory.quantityList[S] || 0
          , t = Math.min(e, w);
        this.questProgressBar.setValue(t / w),
        this.questTooltipTx.setText(d("ui.almanax.calendarSheetsCollected", t, w))
    }
    ,
    n.prototype._showAlmanaxNotification = function(e, t) {
        if (y.getValue("almanaxLastNotif") !== e) {
            y.setValue("almanaxLastNotif", e);
            var i = l.getAlmanaxDate()
              , n = window.gui.notificationBar;
            n.newNotification("almanax", {
                type: n.notificationType.INVITATION,
                title: i.day + " " + i.monthName + " " + i.year,
                text: d("ui.almanax.offeringTo", t),
                buttons: [{
                    label: d("ui.almanax.almanax"),
                    action: function() {
                        v.open("grimoire", {
                            tabId: "almanax"
                        })
                    }
                }]
            })
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        var e = this;
        r.call(this, "div", {
            className: "AchievementsWindow",
            name: "achievements"
        }),
        this.achievementToOpen = null ,
        this.achievementDataFromServer = null ,
        this._createMinimumContent(),
        e.setupSocketEvents(),
        this.once("opened", function() {
            this._createRemainingContent(function() {
                e.setupListUpdateEvents(),
                e.selectFirstTab(),
                e.on("open", function() {
                    e.selectFirstTab()
                })
            })
        }),
        window.gui.on("disconnect", function() {
            e.achievementsList && e.achievementsList.empty()
        })
    }
    function o(e, t) {
        function i(e, t, i, n, o) {
            var s = []
              , a = t.length
              , r = 0;
            l.getData(e, t, function(e, t) {
                return e ? o(e) : r === a ? o(null , s, t) : void t.forEach(function(e) {
                    var l = null !== n ? i + "/" + e[n] + ".png" : i;
                    if (s.push(l),
                    r += 1,
                    r === a)
                        return _.preloadImages(s, function(e) {
                            o(null , e, t)
                        })
                })
            })
        }
        var n = []
          , o = [];
        return e.rewardIds.length ? void l.getData("AchievementRewards", e.rewardIds, function(e, s) {
            function a(e, i, s) {
                return e ? t(e) : (n = n.concat(i),
                o = o.concat(s),
                l += o.length,
                c += 1,
                void (l === r && c === u.length && t(null , n, o)))
            }
            if (e)
                return t(e);
            var r = 0
              , l = 0
              , c = 0
              , u = ["Ornaments", "Items", "Spells", "Titles"];
            s.forEach(function(e) {
                r += e.itemsReward.length + e.ornamentsReward.length + e.spellsReward.length + e.titlesReward.length,
                i(u[0], e.ornamentsReward, "gfx/ornaments", "iconId", a),
                i(u[1], e.itemsReward, "gfx/items", "iconId", a),
                i(u[2], e.spellsReward, "gfx/spells", "iconId", a),
                i(u[3], e.titlesReward, "gfx/illusUi/genericTitleIcon.png", null , a)
            })
        }) : t(null , n, o)
    }
    function s() {
        window.dofus.sendMessage("AchievementRewardRequestMessage", {
            achievementId: this.achievementId
        })
    }
    i(742);
    var a = i(26).inherits
      , r = i(190)
      , l = i(36)
      , c = i(743)
      , u = i(204)
      , h = i(391)
      , d = i(569)
      , p = i(32)
      , m = i(448)
      , f = i(643)
      , g = i(35).getText
      , _ = i(5)
      , v = i(210);
    a(n, r),
    e.exports = n,
    n.prototype.selectFirstTab = function() {
        this.categoriesList.activate(this.categoriesList.items.mainProgressBar)
    }
    ,
    n.prototype.showRightSideDisplay = function(e) {
        this.text.hide(),
        "mainProgressBar" === e ? (this.achievementsScroll.hide(),
        this.hideUnlockedCheckbox.hide(),
        this.summary.show()) : (this.achievementsScroll.show(),
        this.hideUnlockedCheckbox.show(),
        this.summary.hide())
    }
    ,
    n.prototype.hideRightSideDisplay = function() {
        this.text.show(),
        this.achievementsScroll.hide(),
        this.hideUnlockedCheckbox.hide()
    }
    ,
    n.prototype._createMinimumContent = function() {}
    ,
    n.prototype._createRemainingContent = function(e) {
        if (this.col1)
            return e();
        var t = this;
        this.col1 = this.createChild("div", {
            className: "col1"
        }),
        this.col2 = this.createChild("div", {
            className: "col2"
        }),
        this.categoriesScroll = this.col1.createChild("div", {
            className: "scroll"
        }),
        this.categoriesList = this.categoriesScroll.appendChild(new c),
        this.categoriesList.addClassNames("tree"),
        this.categoriesList.on("activate", function(e) {
            var i = e.getWuiName();
            t.showRightSideDisplay(i),
            "mainProgressBar" !== i && e.sublist && e.data && (e.sublist.show(),
            t.addAchievements(e.data.achievementIds))
        }),
        this.categoriesList.on("deactivate", function(e) {
            e.sublist && (e.sublist.hide(),
            e.sublist.deactivate())
        }),
        this.searchBar = this.col2.createChild("div", {
            className: "searchBar"
        }),
        this.searchBar.createChild("div", {
            className: "label",
            text: g("ui.search.search")
        });
        var i = new h({
            className: "searchInput"
        });
        this.searchBar.appendChild(i),
        i.disable(),
        i.addClassNames("disabled"),
        this.searchBar.appendChild(new u({
            className: ["closeButton", "disabled"],
            disable: !0
        })),
        this.searchBar.appendChild(new u({
            className: ["settingButton", "disabled"],
            disable: !0
        })),
        this.text = this.col2.createChild("div", {
            className: "noResult",
            text: g("ui.search.noResult")
        }),
        this.summary = this.col2.createChild("div", {
            className: "summary"
        }),
        this.achievementsScroll = this.col2.createChild("div", {
            className: "achievementsScroll"
        }),
        this.achievementsList = this.achievementsScroll.appendChild(new c),
        this.achievementsList.addClassNames("achievementsList"),
        this.achievementsList.on("activate", function(e) {
            e.more.show()
        }),
        this.achievementsList.on("deactivate", function(e) {
            e.more.hide()
        }),
        this.hideUnlockedCheckbox = this.col2.appendChild(new m(g("ui.achievement.hideAchieved"))),
        this.hideUnlockedCheckbox.on("activate", function() {
            t.addClassNames("hideUnlocked")
        }),
        this.hideUnlockedCheckbox.on("deactivate", function() {
            t.delClassNames("hideUnlocked")
        }),
        this._createContentProgressBars(e)
    }
    ,
    n.prototype._createContentProgressBars = function(e) {
        var t = this;
        this.banners = [];
        var i = new r("div",{
            className: ["label", "noPadding"]
        });
        i.createChild("div", {
            className: "icon"
        }),
        i.createChild("div", {
            className: "text",
            text: g("ui.achievement.synthesis")
        }),
        l.getAllDataBulk("AchievementCategories", function(n, o) {
            if (n)
                return console.error("AchievementCategories error", n);
            o.sort(function(e, t) {
                return e.order - t.order
            });
            var s = t.col2.rootElement.getBoundingClientRect().width;
            t.bannerHeight = s / 8,
            t.total = t.summary.createChild("div", {
                className: "total",
                text: window.gui.playerData.achievements.points
            }),
            t.total.setStyles({
                height: s / 12 + "px",
                fontSize: .05 * s + "px"
            }),
            t.addSummaryBar({
                id: "mainProgressBar",
                nameId: g("ui.tutorial.progress")
            }),
            t.categoriesList.addItem("mainProgressBar", i);
            var a = []
              , l = "gfx/illusUi/illu_"
              , u = [l + "cat_0.png"];
            o.forEach(function(e) {
                if (0 === e.parentId) {
                    var i = new r("div",{
                        className: ["label", "noPadding"]
                    });
                    i.createChild("div", {
                        className: ["icon", e.icon]
                    }),
                    i.createChild("div", {
                        className: "text",
                        text: e.nameId
                    }),
                    u.push(l + e.icon + ".png"),
                    t.addSummaryBar(e);
                    var n = t.categoriesList.addItem(e.id, i, e);
                    n.sublist = n.appendChild(new c),
                    n.sublist.addClassNames("tree"),
                    n.sublist.hide(),
                    n.sublist.on("activate", function(e) {
                        e.data && t.addAchievements(e.data.achievementIds)
                    })
                } else
                    a.push(e)
            }),
            _.preloadImages(u, function(e) {
                for (var i = 0; i < t.banners.length; i += 1)
                    t.banners[i].setStyle("backgroundImage", e[i])
            }),
            a.forEach(function(e) {
                var i = new r("div",{
                    className: "label",
                    text: e.nameId
                });
                t.categoriesList.items[e.parentId].sublist.addItem(e.id, i, e)
            }),
            e()
        })
    }
    ,
    n.prototype.setupSocketEvents = function() {
        function e(e, t, n) {
            var o = []
              , s = i.achievementsList.getChild(e);
            if (s) {
                for (var a = s.getChild("more").getChild("progression"), r = s.getChild("more").getChild("objectives"), l = s.getChild("more").getChild("spinner"), c = 0; c < t.length; c += 1) {
                    var u = t[c]
                      , h = n || u.maxValue && u.value === u.maxValue;
                    if (h && o.push(u.id),
                    1 === u.maxValue)
                        a.hide(),
                        r.show();
                    else {
                        var d = h ? u.maxValue : u.value;
                        a.getChild("text").setText(d + "/" + u.maxValue),
                        a.getChild("progressBar").setValue(d / u.maxValue),
                        a.show(),
                        r.hide()
                    }
                }
                var p = s.getChild("more").getChild("objectives");
                for (c = 0; c < o.length; c += 1) {
                    var m = p.getChild(o[c]);
                    m && m.addClassNames("completed")
                }
                l.hide()
            }
        }
        function t(t) {
            var i = t.startedObjectives
              , n = t.finishedObjective;
            e(t.id, i),
            e(t.id, n, !0)
        }
        var i = this;
        window.gui.on("AchievementDetailedListMessage", function(e) {
            var i, n = e.startedAchievements, o = e.finishedAchievements;
            for (i = 0; i < n.length; i += 1)
                t(n[i]);
            for (i = 0; i < o.length; i += 1)
                t(o[i])
        }),
        window.gui.playerData.achievements.on("achievementListUpdated", function() {
            var e = window.gui.playerData.achievements;
            i.achievementDataFromServer = e,
            i.total && i.total.setText(this.points)
        })
    }
    ,
    n.prototype.setupListUpdateEvents = function() {
        var e = this;
        window.gui.playerData.achievements.on("achievementFinished", function(t) {
            e.total && e.total.setText(this.points);
            var i = e.achievementsList.getChild(t.id);
            if (!i)
                return console.warn("Achievement not found: ", t.id);
            i.addClassNames("completed");
            var n = i.getChild("more").getChild("rewards").getChild("claimButton");
            n.show(),
            n.enable()
        }),
        window.gui.playerData.achievements.on("achievementRewardSuccess", function(t) {
            var i = e.achievementsList.getChild(t);
            if (!i)
                return console.warn("Achievement not found: ", t);
            var n = i.getChild("more").getChild("rewards").getChild("claimButton");
            n.hide(),
            n.disable()
        })
    }
    ,
    n.prototype.addSummaryBar = function(e) {
        var t = this
          , i = this.summary.createChild("div", {
            className: "summaryBar",
            name: e.id
        })
          , n = i.createChild("div", {
            className: "banner"
        });
        n.setStyles({
            height: this.bannerHeight + "px"
        }),
        this.banners.push(n),
        n.createChild("div", {
            className: "text",
            text: e.nameId
        });
        var o = "yellow";
        switch (e.id) {
        case 15:
            o = "orange";
            break;
        case 6:
            o = "green";
            break;
        case 3:
            o = "blue";
            break;
        case 25:
            o = "red";
            break;
        case 8:
            o = "lightGreen";
            break;
        case 7:
            o = "yellow";
            break;
        case 5:
            o = "yellow";
            break;
        case 9:
            o = "yellow"
        }
        return i.appendChild(new f({
            className: o,
            name: "progressBar"
        })),
        "mainProgressBar" === e.id ? i.addClassNames("mainProgressBar") : (p(n),
        void n.on("tap", function() {
            t.showRightSideDisplay(e.id),
            t.categoriesList.activate(t.categoriesList.items[e.id])
        }))
    }
    ,
    n.prototype.addAchievements = function(e) {
        var t = this;
        l.getData("Achievements", e, function(e, i) {
            if (e)
                return console.error("Achievements with data error", e);
            i.sort(function(e, t) {
                return e.order - t.order
            });
            var n = i.length && i[0].categoryId;
            n ? t.showRightSideDisplay(n) : t.hideRightSideDisplay(),
            t.achievementsList.empty();
            for (var o = [], s = [], a = {}, r = 0; r < i.length; r++)
                for (var c = i[r].objectiveIds, u = 0; u < c.length; u++) {
                    var h = c[u];
                    a[h] = !0
                }
            a = Object.keys(a),
            l.getDataMap("AchievementObjectives", a, function(e, a) {
                if (e)
                    return console.error("unable to retrieve data from AchievementObjectives", e);
                n && window.dofus.sendMessage("AchievementDetailedListRequestMessage", {
                    categoryId: n
                });
                for (var r = 0; r < i.length; r++)
                    o.push("gfx/achievements/" + i[r].iconId + ".png"),
                    s.push(t.addAchievement(i[r], a));
                null !== t.achievementToOpen && void 0 !== t.achievementsList.items[t.achievementToOpen] && (t.isCompleted(t.achievementToOpen) && t.hideUnlockedCheckbox.deactivate(),
                t.achievementsList.activate(t.achievementsList.items[t.achievementToOpen]),
                t.achievementToOpen = null ),
                _.preloadImages(o, function(e) {
                    for (var t = 0; t < e.length; t += 1) {
                        var i = s[t].getChild("icon");
                        i ? i.setImage(e[t]) : console.warn("Missing icon for achievement #" + t, s[t])
                    }
                })
            })
        })
    }
    ,
    n.prototype.addAchievement = function(e, t) {
        function i() {
            l.activateAchievement(this.achievementId)
        }
        function n(e) {
            var t = window.gui.playerData.characterBaseInformations.sex
              , i = t ? e.nameMaleId : e.nameFemaleId;
            return i
        }
        var a, l = this, c = window.gui.playerData.achievements, h = new r("div",{
            className: "infos"
        });
        h.appendChild(new d({
            name: "icon"
        }));
        var m = h.createChild("div", {
            className: "infosGroupRight"
        })
          , _ = m.createChild("div", {
            className: "cf"
        });
        _.createChild("div", {
            className: "title",
            text: e.nameId
        }),
        _.createChild("div", {
            className: "points",
            text: e.points
        }),
        m.createChild("div", {
            className: "description",
            text: e.descriptionId
        });
        var y = this.achievementsList.addItem(e.id, h, e);
        y.addClassNames("achievement"),
        y.more = y.createChild("div", {
            className: "more",
            name: "more"
        });
        var w = y.more.createChild("div", {
            className: "progression",
            name: "progression"
        });
        w.hide(),
        w.appendChild(new f({
            className: "green",
            name: "progressBar"
        })),
        w.createChild("div", {
            className: "text",
            name: "text"
        });
        var b = y.more.createChild("div", {
            className: "objectives",
            name: "objectives"
        });
        b.hide(),
        y.more.createChild("div", {
            className: "spinner",
            name: "spinner"
        });
        var C = y.more.createChild("div", {
            className: "rewards",
            name: "rewards"
        });
        C.createChild("div", {
            className: "text",
            text: g("ui.grimoire.quest.rewards")
        });
        var I = C.createChild("div", {
            className: "rewardList"
        })
          , T = 6;
        for (a = 0; a < T; a++)
            I.appendChild(new d({
                name: "icon" + a
            }));
        var S = C.appendChild(new u({
            name: "claimButton"
        }));
        S.achievementId = e.id,
        S.hide(),
        S.disable(),
        S.on("tap", s);
        var A = c.completedData(e.id)
          , E = A.finishedlevel;
        A.isCompleted && (y.addClassNames("completed"),
        this.isAchievementRewardClaimed(e.id) || (S.show(),
        S.enable()));
        var x = C.createChild("div", {
            className: "kamasXP"
        })
          , M = v.kamasToString(c.getAchievementExperienceReward(e, E), "")
          , N = v.kamasToString(c.getAchievementKamasReward(e, E), "")
          , R = x.createChild("div", {
            className: "line"
        });
        R.createChild("div", {
            className: "text",
            text: M
        }),
        R.createChild("div", {
            className: ["icon", "xp"]
        });
        var O = x.createChild("div", {
            className: "line"
        });
        for (O.createChild("div", {
            className: "text",
            text: N
        }),
        O.createChild("div", {
            className: ["icon", "kamas"]
        }),
        y.more.hide(),
        a = 0; a < e.objectiveIds.length; a++) {
            var P = e.objectiveIds[a]
              , D = t[P];
            if (D && b.rootElement) {
                var L = b.createChild("div", {
                    className: ["objective", D.id],
                    name: D.id,
                    text: D.nameId
                })
                  , B = 0 === D.criterion.indexOf("OA");
                if (B) {
                    var k = Number(D.criterion.substr(3, D.criterion.length));
                    isNaN(k) ? console.warn("Failed parsing achievementId of objective.criterion: " + D.criterion) : (L.achievementId = k,
                    p(L),
                    L.on("tap", i))
                }
                var F = L.createChild("span", {
                    className: "text"
                });
                F.setHtml(D.nameId + (B ? " " + g("ui.common.fakeLinkSee") : ""))
            }
        }
        return o(e, function(e, t, i) {
            if (e)
                return console.error("Loaded static achievement data error", e);
            if (t.length !== i.length)
                return console.error(new Error("AchievementsWindow: Missing rewards data or images"));
            for (var o = 0; o < t.length; o += 1) {
                var s = I.getChild("icon" + o);
                if (!s)
                    return console.warn("AchievementsWindow: Missing icon" + o);
                s.setImage(t[o]);
                var a = new r("div");
                a.createChild("div", {
                    text: i[o].nameId || n(i[o])
                }),
                i[o].descriptionId && a.createChild("div", {
                    text: i[o].descriptionId,
                    style: {
                        color: "#b9e154"
                    }
                }),
                s.setTooltip(a)
            }
        }),
        h
    }
    ,
    n.prototype.activateAchievement = function(e) {
        var t = this;
        this.achievementToOpen = e,
        l.getData("Achievements", e, function(i, n) {
            if (i || !n)
                return console.error("Failed getting Achievements #" + e + " error: " + i + " res: " + n);
            var o = t.categoriesList.items;
            if (o[n.categoryId])
                return void t.categoriesList.activate(o[n.categoryId]);
            for (var s in o) {
                var a = o[s].sublist;
                if (a.items[n.categoryId])
                    return t.categoriesList.activate(o[s]),
                    void a.activate(a.items[n.categoryId])
            }
        })
    }
    ,
    n.prototype.isCompleted = function(e) {
        for (var t = this.achievementDataFromServer.finishedAchievementsIds.indexOf(e) !== -1, i = this.achievementDataFromServer.rewardableAchievements, n = 0; n < i.length; n += 1)
            if (i[n].id === e) {
                t = !0;
                break
            }
        return t
    }
    ,
    n.prototype.isAchievementRewardClaimed = function(e) {
        return this.achievementDataFromServer.finishedAchievementsIds.indexOf(e) !== -1
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "ul", {
            className: "List"
        }),
        e = e || {},
        this.addClassNames(e.className),
        e.cannotActivate && (this._cannotActivate = e.cannotActivate),
        this.activeItem = null ,
        this.items = {}
    }
    i(744);
    var o = i(26).inherits
      , s = i(190)
      , a = i(210)
      , r = i(32)
      , l = i(84).playUiSound;
    o(n, s),
    e.exports = n,
    n.prototype.addItem = function(e, t, i) {
        var n = this
          , o = this.createChild("li", {
            name: e,
            className: e
        });
        return o.appendChild(t),
        o.element = t,
        i && (o.data = i),
        r(t),
        t.on("tap", function() {
            o === n.activeItem ? n.deactivate() : n.activate(o)
        }),
        this.items[e] = o,
        o
    }
    ,
    n.prototype.removeItem = function(e) {
        var t = this.items[e];
        t && (t.destroy(),
        delete this.items[e])
    }
    ,
    n.prototype.selectItem = function(e) {
        var t = this.items[e];
        if (t)
            return this.activate(t),
            t
    }
    ,
    n.prototype.activate = function(e) {
        this._cannotActivate || (this.deactivate(!0),
        e.addClassNames("on"),
        this.emit("activate", e),
        this.activeItem = e,
        l("GEN_BUTTON"))
    }
    ,
    n.prototype.deactivate = function(e) {
        this.activeItem && (this.activeItem.delClassNames("on"),
        this.emit("deactivate", this.activeItem),
        this.activeItem = null ,
        e || l("GEN_BUTTON"))
    }
    ,
    n.prototype.empty = function() {
        this.clearContent(),
        this.activeItem = null ,
        this.items = {}
    }
    ,
    n.prototype.sort = function(e, t) {
        a.sortObjectInArray(this.items, e, t)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        return e.nameId < t.nameId ? -1 : e.nameId > t.nameId ? 1 : 0
    }
    function o() {
        function e(e) {
            e.search && t._search(e.search)
        }
        h.call(this, "div", {
            className: "BestiaryWindow",
            name: "bestiary"
        });
        var t = this;
        this.subAreas = {},
        this.monsters = {},
        this.col1 = this.createChild("div", {
            className: "col1"
        }),
        this.col2 = this.createChild("div", {
            className: "col2"
        }),
        this.tabs = new u,
        this.col1.appendChild(this.tabs),
        this.panels = this.col1.createChild("div", {
            className: "panels"
        });
        var i = this.panels.createChild("div", {
            className: "panel"
        })
          , o = this.areaList = i.appendChild(new p);
        o.addClassNames("tree"),
        o.on("activate", function(e) {
            e.sublist.show(),
            y("TAB")
        }),
        o.on("deactivate", function(e) {
            e.sublist.hide(),
            e.sublist.deactivate()
        });
        var s = this.panels.createChild("div", {
            className: "panel"
        })
          , a = s.appendChild(new p);
        a.addClassNames("tree"),
        a.on("activate", function(e) {
            e.sublist.show(),
            y("TAB")
        }),
        a.on("deactivate", function(e) {
            e.sublist.hide(),
            e.sublist.deactivate()
        }),
        this.searchBlock = this.col2.createChild("div", {
            className: "searchBlock"
        }),
        this.searchBox = this.searchBlock.appendChild(new b),
        this.searchBox.on("search", function(e) {
            t._search(e)
        }),
        this.monsterList = this.col2.appendChild(new m),
        this.monsterList.on("selected", function(e) {
            e.more ? (e.more.show(),
            this.refresh()) : t._createMonsterMoreInfo(e)
        }),
        this.monsterList.on("deselected", function(e) {
            e.more.hide(),
            this.refresh()
        }),
        this.noResultText = this.monsterList.createChild("div", {
            className: "noResultText",
            text: _("ui.search.noResult")
        }),
        this.errorText = this.monsterList.createChild("div", {
            className: "errorText",
            text: _("ui.secureMode.error.default")
        }),
        t.errorText.hide(),
        this.tabs.addTab(_("ui.monster.areas"), i),
        this.tabs.addTab(_("ui.monster.families"), s),
        this.tabs.openTab(0),
        this.once("open", function(i) {
            d.getAllDataBulk(["Areas", "SubAreas", "MonsterSuperRaces", "MonsterRaces"], function(s, r) {
                if (s)
                    return console.error("Bestiary: getAllDataAreas error", s);
                var l = r.Areas
                  , c = r.SubAreas
                  , u = r.MonsterSuperRaces
                  , d = r.MonsterRaces;
                l.sort(n),
                l.forEach(function(e) {
                    t.addToList(o, e)
                }),
                c.sort(n),
                c.forEach(function(e) {
                    if (e.monsters.length > 0) {
                        var i = new h("div",{
                            className: "label",
                            text: e.nameId
                        });
                        o.items[e.areaId].sublist.addItem(e.id, i, e),
                        t.subAreas[e.id] = e
                    }
                }),
                u.sort(n),
                u.forEach(function(e) {
                    t.addToList(a, e)
                }),
                d.sort(n),
                d.forEach(function(e) {
                    if (e.monsters.length > 0) {
                        var t = new h("div",{
                            className: "label",
                            text: e.nameId
                        });
                        a.items[e.superRaceId].sublist.addItem(e.id, t, e)
                    }
                }),
                t.on("open", e),
                e(i)
            })
        })
    }
    function s(e) {
        return e.base + e.alignGiftBonus + e.objectsAndMountBonus + e.contextModif
    }
    function a(e, t) {
        return e === t ? e : e + " " + _("ui.chat.to") + " " + t
    }
    function r(e) {
        return Math.round(1e3 * e) / 1e3
    }
    function l() {
        var e = this.data.nameId
          , t = _("ui.item.averageprice") + " : "
          , i = this.itemDataElement.getProperty("averagePrice");
        t += i === -1 ? _("ui.item.averageprice.unavailable") : w.kamasToString(i),
        e += "\n" + t;
        var n = s(window.gui.playerData.characters.mainCharacter.characteristics.prospecting)
          , o = n;
        o < 100 && (n = 100);
        var l = r(this.dropInfo.percentDropForGrade1)
          , c = r(this.dropInfo.percentDropForGrade5)
          , u = Math.min(100, r(this.dropInfo.percentDropForGrade1 * n / 100))
          , h = Math.min(100, r(this.dropInfo.percentDropForGrade5 * n / 100));
        return e += "\n" + _("ui.monster.obtaining"),
        e += " (" + o + " " + _("ui.short.prospection") + ") : ",
        e += a(u, h) + "%",
        e += "\n" + _("ui.monster.obtaining"),
        e += " (" + _("ui.common.base") + ") : ",
        e += a(l, c) + "%",
        this.dropInfo.findCeil && (e += "\n" + _("ui.monster.prospectionThreshold") + " : " + this.dropInfo.findCeil),
        e
    }
    i(746);
    var c = i(26).inherits
      , u = i(682)
      , h = i(190)
      , d = i(36)
      , p = i(743)
      , m = i(315).SingleSelectionList
      , f = i(323)
      , g = i(567)
      , _ = i(35).getText
      , v = i(5)
      , y = i(84).playUiSound
      , w = i(210)
      , b = i(405)
      , C = i(206);
    c(o, h),
    e.exports = o,
    o.prototype.addToList = function(e, t) {
        var i = this
          , n = new h("div",{
            className: "label"
        });
        n.createChild("div", {
            className: "arrow"
        }),
        n.createChild("div", {
            className: "text",
            text: t.nameId
        });
        var o = e.addItem(t.id, n, t);
        o.sublist = o.appendChild(new p),
        o.sublist.addClassNames("tree"),
        o.sublist.hide(),
        o.sublist.on("activate", function(e) {
            i._showMonsters(e.data.monsters)
        })
    }
    ,
    o.prototype._search = function(e) {
        var t = this;
        return this.searchBox.setValue(e),
        null === e || "" === e ? this._cancelSearch(!0) : e.length < 3 ? C.showNotification(_("ui.common.searchFilterTooltip"), this.searchBox) : (e = w.simplifyString(e),
        this.searching = !0,
        this.monsterList.clearContent(),
        this.monsterList.addClassNames("spinner"),
        t.errorText.hide(),
        t.noResultText.hide(),
        void d.searchDataMap("Items", {
            match: e
        }, function(i, n) {
            if (i)
                return t.monsterList.delClassNames("spinner"),
                t.errorText.show(),
                console.error("BestiaryWindow items search", i);
            var o = [];
            for (var s in n) {
                var a = n[s];
                if (a.dropMonsterIds.length)
                    for (var r = 0; r < a.dropMonsterIds.length; r++) {
                        var l = a.dropMonsterIds[r];
                        o.indexOf(l) === -1 && o.push(l)
                    }
            }
            d.searchDataMap("Monsters", {
                match: e
            }, function(e, i) {
                if (e)
                    return t.monsterList.delClassNames("spinner"),
                    t.errorText.show(),
                    console.error("BestiaryWindow monsters search", e);
                for (var n in i) {
                    var s = i[n];
                    o.indexOf(s.id) === -1 && o.push(s.id)
                }
                t.searching && t._showMonsters(o)
            })
        }))
    }
    ,
    o.prototype._showMonsters = function(e) {
        var t = this;
        this.searching = !1,
        t.errorText.hide(),
        t.noResultText.hide(),
        d.getData("Monsters", e, function(e, i) {
            if (e)
                return t.monsterList.delClassNames("spinner"),
                t.errorText.show(),
                console.error("BestiaryWindow showMonsters error", e);
            i.sort(n),
            t.monsterList.clearContent(),
            t.monsterList.delClassNames("spinner");
            var o = []
              , s = i.length;
            0 === s && t.noResultText.show();
            for (var a = 0; a < s; a += 1)
                o.push("gfx/monsters/" + i[a].id + ".png");
            v.preloadImages(o, function(e) {
                for (var n = 0; n < s; n += 1)
                    t.addMonster(i[n], e[n]);
                t.monsterList.refresh()
            })
        })
    }
    ,
    o.prototype.addMonster = function(e, t) {
        var i = new h("div",{
            className: "infos"
        })
          , n = i.createChild("div", {
            className: "gfx"
        });
        n.setStyle("backgroundImage", t);
        var o = i.createChild("div", {
            className: "infosGroupRight"
        })
          , s = o.createChild("div", {
            className: "cf"
        })
          , a = ["name"];
        e.isBoss && a.push("boss"),
        e.isMiniBoss && a.push("miniBoss"),
        e.isQuestMonster && a.push("questMonster");
        var r = window.gui.playerData.isModeratorOrMore()
          , l = e.nameId;
        r && (l += " (" + e.id + ")"),
        s.createChild("div", {
            className: a,
            text: l
        });
        var c = e.grades[0].level
          , u = e.grades[e.grades.length - 1].level
          , d = _("ui.common.short.level") + " " + c;
        if (c !== u && (d += " " + _("ui.chat.to") + " " + u),
        s.createChild("div", {
            className: "level",
            text: d
        }),
        0 !== e.favoriteSubareaId) {
            var p = this.subAreas[e.favoriteSubareaId].nameId
              , m = this.areaList.items[this.subAreas[e.favoriteSubareaId].areaId].data.nameId;
            o.createChild("div", {
                className: "favoriteSubarea",
                text: p + " (" + m + ")"
            })
        }
        var f = this.monsterList.addItem({
            id: e.id,
            element: i,
            data: e
        }, {
            noRefresh: !0
        });
        f.addClassNames("monster"),
        f.monsterData = e
    }
    ,
    o.prototype._createMonsterMoreInfo = function(e) {
        function t(e, t) {
            var i = o.grades[0][t]
              , n = o.grades[o.grades.length - 1][t]
              , a = e + ": " + i;
            i !== n && (a += " " + _("ui.chat.to") + " " + n),
            s.createChild("div", {
                className: "stat",
                text: a
            })
        }
        function i(e) {
            var t = o.grades[0][e]
              , i = o.grades[o.grades.length - 1][e]
              , n = t;
            t !== i && (n += " " + _("ui.chat.to") + " " + i),
            a.createChild("div", {
                className: ["stat", "resistance", e],
                text: n
            })
        }
        e.more = e.createChild("div", {
            className: "more"
        });
        var n = e.more.createChild("div", {
            className: "cf"
        })
          , o = e.monsterData
          , s = n.createChild("div", {
            className: ["col", "colLeft"]
        });
        s.createChild("div", {
            className: "subtitle",
            text: _("ui.common.caracteristics")
        }),
        t(_("ui.short.lifePoints"), "lifePoints"),
        t(_("ui.short.actionPoints"), "actionPoints"),
        t(_("ui.short.movementPoints"), "movementPoints");
        var a = n.createChild("div", {
            className: ["col", "colRight"]
        });
        a.createChild("div", {
            className: "subtitle",
            text: _("ui.common.resistances")
        }),
        i("neutralResistance"),
        i("earthResistance"),
        i("fireResistance"),
        i("waterResistance"),
        i("airResistance"),
        this._createMonsterDrops(e, o.drops)
    }
    ,
    o.prototype._createMonsterDrops = function(e, t) {
        if (0 !== t.length) {
            e.more.createChild("div", {
                className: "subtitle",
                text: _("ui.common.loot")
            }),
            this.monsterList.refresh();
            for (var i = t.length - 1; i >= 0; i--) {
                var n = t[i];
                n.hasCriteria && t.splice(i, 1)
            }
            var o = t.map(function(e) {
                return e.objectId
            })
              , s = this;
            f.getItems(o, function(i) {
                if (i)
                    return console.error("Failed to get items", i);
                for (var n = 0; n < o.length; n += 1) {
                    var a = o[n]
                      , r = f.items[a];
                    if (r) {
                        var c = e.more.appendChild(new g);
                        c.itemDataElement = r,
                        c.dropInfo = t[n],
                        c.setTooltip(l),
                        c.toggleClassName("special", t[n].hasCriteria),
                        c.setItem(r),
                        c.setContextMenu("item", {
                            item: r
                        }),
                        t[n].percentDropForGrade1 < 2 ? c.addClassNames("rareDrop") : t[n].percentDropForGrade1 < 10 && c.addClassNames("okDrop")
                    } else
                        console.warn("monster", e.monsterData.id, "contains invalid drop item in pos ", n)
                }
                s.monsterList.refresh()
            })
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            return t._ornamentIdToSelect = ~~e.ornamentId,
            t._titleIdToSelect = ~~e.titleId,
            t._titlesAndOrnamentsListRequested ? void t._selectOnceReady() : (t._displayLoading(!0),
            t._titlesAndOrnamentsListRequested = !0,
            void window.dofus.sendMessage("TitlesAndOrnamentsListRequestMessage"))
        }
        f.call(this, "div", {
            className: "OrnamentsWindow",
            name: "ornaments"
        });
        var t = this;
        this._titlesAndOrnaments = null ,
        this._currentTitleId = null ,
        this._currentOrnamentId = null ,
        this._titlesAndOrnamentsListRequested = !1,
        this.once("open", function(i) {
            t._createDom(),
            t._displayLoading(!0),
            t._loadContent(function() {
                t._setupEvents(),
                t.on("opened", e),
                e(i)
            });
            var n = window.gui.playerData.characterBaseInformations.entityLook;
            t._updateCharacter(n)
        })
    }
    i(748);
    var o = i(5)
      , s = i(204).DofusButton
      , a = i(238)
      , r = i(448)
      , l = i(35).getText
      , c = i(26).inherits
      , u = i(287)
      , h = i(315).SingleSelectionList
      , d = i(36)
      , p = i(682)
      , m = i(30)
      , f = i(190);
    c(n, f),
    e.exports = n,
    n.prototype._selectOnceReady = function() {
        this._ornamentIdToSelect ? (this.tabs.openTab("ornaments"),
        this.ornamentList.selectItem(this._ornamentIdToSelect)) : this._titleIdToSelect ? (this.tabs.openTab("titles"),
        this.titleList.selectItem(this._titleIdToSelect)) : this._selectActiveTitleAndOrnament()
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this;
        window.gui.on("disconnect", function() {
            e._titlesAndOrnamentsListRequested = !1,
            e.tabs && e.tabs.openFirstTab()
        }),
        window.gui.on("TitlesAndOrnamentsListMessage", function(t) {
            e._titlesAndOrnaments = t,
            e._titlesAndOrnaments.titles.push(0),
            e._titlesAndOrnaments.ornaments.push(0),
            e._updateOrnamentList(),
            e._updateTitleList(),
            e._displayLoading(!1);
            var i = m.getValue("dofus_titleOrnaments_display_all", !1);
            e.showAllCheckbox.toggleActivation(i),
            e._selectOnceReady()
        }),
        window.gui.on("OrnamentSelectedMessage", function(t) {
            e._titlesAndOrnaments && (e._titlesAndOrnaments.activeOrnament = t.ornamentId)
        }),
        window.gui.on("TitleSelectedMessage", function(t) {
            e._titlesAndOrnaments && (e._titlesAndOrnaments.activeTitle = t.titleId)
        }),
        window.gui.on("OrnamentSelectErrorMessage", function() {}),
        window.gui.on("TitleSelectErrorMessage", function() {}),
        window.gui.on("TitleGainedMessage", function(t) {
            var i = t.titleId;
            e._titlesAndOrnaments.titles.push(i),
            e._updateTitleList(),
            e._displayObtainedTitles()
        }),
        window.gui.on("TitleLostMessage", function(t) {
            var i = t.titleId
              , n = e._titlesAndOrnaments.titles.indexOf(i);
            n !== -1 && e._titlesAndOrnaments.titles.splice(n, 1),
            e._updateTitleList(),
            e._displayObtainedTitles()
        }),
        window.gui.on("OrnamentGainedMessage", function(t) {
            var i = t.ornamentId;
            e._titlesAndOrnaments.ornaments.push(i),
            e._updateOrnamentList(),
            e._displayObtainedOrnaments()
        }),
        window.gui.playerData.on("lookUpdate", function(t) {
            e.character && e._updateCharacter(t)
        })
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "col1"
        });
        this.col2 = this.createChild("div", {
            className: "col2"
        });
        var i = this.tabs = t.appendChild(new p);
        this.titleList = t.appendChild(new h({
            className: "titleList"
        },{
            disableSelectionToggle: !0
        })),
        this.titleList.on("selected", function(t) {
            e._setCharacterTitle(t.data.id),
            this.showElement(t)
        }),
        this.ornamentList = t.appendChild(new h({
            className: "ornamentList"
        },{
            disableSelectionToggle: !0
        })),
        this.ornamentList.on("selected", function(t) {
            e._setCharacterOrnament(t.data.id),
            this.showElement(t)
        });
        var n = i.addTab(l("ui.ornament.titles"), this.titleList, "titles")
          , o = i.getTabTarget(n);
        o.on("opened", function() {
            e.titleList.refresh()
        }),
        n = i.addTab(l("ui.ornament.ornaments"), this.ornamentList, "ornaments");
        var c = i.getTabTarget(n);
        c.on("opened", function() {
            e.ornamentList.refresh()
        }),
        i.openFirstTab(),
        this.showAllCheckbox = t.appendChild(new r(l("ui.ornament.displayAll"))),
        this.showAllCheckbox.on("change", function(t) {
            m.setValue("dofus_titleOrnaments_display_all", t),
            e._displayObtainedTitlesOrnaments()
        }),
        this.container = this.col2.createChild("div", {
            className: "container"
        }),
        this.character = this.container.appendChild(new a({
            scale: "cover",
            verticalAlign: "bottom"
        })),
        this.ornamentContainer = this.container.createChild("div", {
            className: "ornamentContainer"
        }),
        this.ornament = this.ornamentContainer.appendChild(new u),
        this.ornament.on("sizeChanged", function() {
            e.ornament.setStyle("marginTop", "0px");
            var t = e.ornamentContainer.rootElement.offsetHeight - this.getHeight();
            t < 0 && (t = 0),
            e.ornament.setStyle("marginTop", t + "px"),
            e.ornament.setStyle("marginLeft", "0px");
            var i = 0;
            e.ornament._canvas.rootElement.offsetWidth > e.ornamentContainer.rootElement.offsetWidth && (i = .5 * -(e.ornament._canvas.rootElement.offsetWidth - e.ornamentContainer.rootElement.offsetWidth)),
            e.ornament.setStyle("marginLeft", i + "px")
        }),
        this.warningWings = this.col2.createChild("div", {
            className: "warningWings",
            text: l("ui.ornament.warningWings"),
            hidden: !0
        });
        var d = this.col2.createChild("div", {
            className: "buttons"
        })
          , f = d.appendChild(new s(l("ui.common.reset")));
        this.saveButton = d.appendChild(new s(l("ui.common.save"))),
        this.saveButton.disable(),
        f.on("tap", function() {
            e._selectActiveTitleAndOrnament(),
            e.saveButton.disable()
        }),
        this.saveButton.on("tap", function() {
            var t = e._getActiveTitleId()
              , i = e._getActiveOrnamentId();
            t !== e._currentTitleId && window.dofus.sendMessage("TitleSelectRequestMessage", {
                titleId: e._currentTitleId
            }),
            i !== e._currentOrnamentId && window.dofus.sendMessage("OrnamentSelectRequestMessage", {
                ornamentId: e._currentOrnamentId
            }),
            this.disable()
        })
    }
    ,
    n.prototype._addTitleElement = function(e) {
        var t = this._getTitleText(e)
          , i = new f("div",{
            className: "row",
            text: t || l("ui.common.none")
        });
        this.titleList.addItem({
            id: e.id,
            element: i,
            data: e
        }, {
            noRefresh: !0
        })
    }
    ,
    n.prototype._getTitleText = function(e) {
        var t = window.gui.playerData.characterBaseInformations.sex;
        return t ? e.femaleText : e.maleText
    }
    ,
    n.prototype._addOrnamentElement = function(e, t) {
        var i = new f("div",{
            className: "row"
        })
          , n = i.createChild("div", {
            className: "icon"
        });
        n.setStyle("backgroundImage", t),
        i.createChild("div", {
            text: e.nameId || l("ui.common.none"),
            className: "name"
        }),
        this.ornamentList.addItem({
            id: e.id,
            element: i,
            data: {
                id: e.id,
                assetId: e.assetId,
                visible: e.visible
            }
        }, {
            noRefresh: !0
        })
    }
    ,
    n.prototype._loadContent = function(e) {
        for (var t = this, i = ["ui/slot.png", "gfx/illusUi/tx_bgTitleOrnament.png"], n = 0; n < 6; n++)
            i.push("gfx/ornaments/" + n + ".png");
        o.preloadImages(i, function(i) {
            d.getAllDataTable(["Titles", "Ornaments"], function(n, o) {
                if (n)
                    return console.error("Titles and Ornaments: failed getting data", n),
                    e(n);
                var s = o.Titles
                  , a = o.Ornaments;
                t.container.setStyle("backgroundImage", i[1]),
                t._addTitleElement({
                    id: 0
                }),
                t._addOrnamentElement({
                    id: 0
                }, i[0]);
                var r, l;
                for (r = 0; r < s.length; r += 1)
                    l = s[r],
                    t._addTitleElement({
                        id: l.id,
                        maleText: l.nameMaleId,
                        femaleText: l.nameFemaleId,
                        visible: l.visible
                    });
                for (r = 0; r < a.length; r += 1)
                    l = a[r],
                    t._addOrnamentElement(l, i[l.iconId + 2]);
                e()
            })
        })
    }
    ,
    n.prototype._displayLoading = function(e) {
        this.titleList.toggleClassName("spinner", e),
        this.ornamentList.toggleClassName("spinner", e),
        this.titleList.getContentElement().toggleDisplay(!e),
        this.ornamentList.getContentElement().toggleDisplay(!e)
    }
    ,
    n.prototype._getActiveOrnamentId = function() {
        return this._titlesAndOrnaments && this._titlesAndOrnaments.activeOrnament
    }
    ,
    n.prototype._getActiveTitleId = function() {
        return this._titlesAndOrnaments && this._titlesAndOrnaments.activeTitle
    }
    ,
    n.prototype._getOwnedOrnaments = function() {
        return this._titlesAndOrnaments && this._titlesAndOrnaments.ornaments
    }
    ,
    n.prototype._getOwnedTitles = function() {
        return this._titlesAndOrnaments && this._titlesAndOrnaments.titles
    }
    ,
    n.prototype._updateCharacter = function(e) {
        console.log("Setting character's look", e),
        this.character.setLook(e, {
            riderOnly: !0,
            direction: 2,
            boneType: "characters/",
            skinType: "characters/"
        })
    }
    ,
    n.prototype._selectActiveTitleAndOrnament = function() {
        if (this._titlesAndOrnaments) {
            var e = this._getActiveTitleId()
              , t = this._getActiveOrnamentId();
            this._currentTitleId = e,
            this._currentOrnamentId = t,
            this.titleList.deselectAll(),
            this.ornamentList.deselectAll(),
            this.titleList.selectItem(e, {
                noEvent: !0,
                noSound: !0
            }),
            this.ornamentList.selectItem(t, {
                noEvent: !0,
                noSound: !0
            }),
            this._setCharacterTitleAndOrnament(e, t)
        }
    }
    ,
    n.prototype._displayObtainedTitles = function() {
        for (var e = m.getValue("dofus_titleOrnaments_display_all", !1), t = this.titleList.getItems(), i = 0, n = 0; n < t.length; n += 1) {
            var o = t[n]
              , s = e && o.data.visible;
            o.toggleDisplay(s || o.data.isAvailable),
            o.isVisible() && (o.toggleClassName("odd", i % 2 === 0),
            i += 1)
        }
        if (this.titleList.refresh(),
        null !== this._currentTitleId) {
            var a = this.titleList.getItem(this._currentTitleId);
            a.data.isAvailable || this.titleList.selectItem(this._getActiveTitleId(), {
                noSound: !0
            })
        }
    }
    ,
    n.prototype._displayObtainedOrnaments = function() {
        for (var e = m.getValue("dofus_titleOrnaments_display_all", !1), t = this.ornamentList.getItems(), i = 0, n = 0; n < t.length; n += 1) {
            var o = t[n]
              , s = e && o.data.visible;
            o.toggleDisplay(s || o.data.isAvailable),
            o.isVisible() && (o.toggleClassName("odd", i % 2 === 0),
            i += 1)
        }
        if (this.ornamentList.refresh(),
        null !== this._currentOrnamentId) {
            var a = this.ornamentList.getItem(this._currentOrnamentId);
            a.data.isAvailable || this.ornamentList.selectItem(this._getActiveOrnamentId(), {
                noSound: !0
            })
        }
    }
    ,
    n.prototype._displayObtainedTitlesOrnaments = function() {
        this._displayObtainedTitles(),
        this._displayObtainedOrnaments()
    }
    ,
    n.prototype._updateTitleList = function() {
        for (var e = this._getOwnedTitles(), t = this.titleList.getItems(), i = 0; i < t.length; i += 1) {
            var n = t[i]
              , o = n.data.id
              , s = this._getTitleText(n.data);
            if (s) {
                var a = n.getChildren();
                a[0].setText(s)
            }
            var r = e.indexOf(o) >= 0;
            n.data.isAvailable = r,
            n.toggleClassName("unavailable", !r)
        }
    }
    ,
    n.prototype._updateOrnamentList = function() {
        for (var e = this._getOwnedOrnaments(), t = this.ornamentList.getItems(), i = 0; i < t.length; i += 1) {
            var n = t[i]
              , o = n.data.id
              , s = e.indexOf(o) >= 0;
            n.data.isAvailable = s,
            n.toggleClassName("unavailable", !s)
        }
    }
    ,
    n.prototype._isSavable = function(e, t) {
        var i = this._getOwnedTitles()
          , n = this._getOwnedOrnaments()
          , o = this._getActiveTitleId()
          , s = this._getActiveOrnamentId();
        return (o !== e || s !== t) && i.indexOf(e) >= 0 && n.indexOf(t) >= 0
    }
    ,
    n.prototype._setCharacterTitle = function(e) {
        var t = this.titleList.getItem(e);
        this._currentTitleId = e;
        var i = this._isSavable(this._currentTitleId, this._currentOrnamentId);
        this.saveButton.setEnable(i),
        this.ornament.changeAttributes({
            title: this._getTitleText(t.data) || ""
        }),
        this.ornament.display()
    }
    ,
    n.prototype._setCharacterOrnament = function(e) {
        var t = this.ornamentList.getItem(e);
        this._currentOrnamentId = e;
        var i = this._isSavable(this._currentTitleId, this._currentOrnamentId);
        this.saveButton.setEnable(i),
        this.ornament.changeAttributes({
            ornamentAssetId: t.data.assetId
        }),
        this.ornament.display()
    }
    ,
    n.prototype._setCharacterTitleAndOrnament = function(e, t) {
        var i, n = window.gui.playerData, o = this.titleList.getItem(e), s = this.ornamentList.getItem(t);
        o && (i = this._getTitleText(o.data)),
        this.ornament.setAttributes({
            charName: window.gui.playerData.characterBaseInformations.name,
            title: i,
            ornamentAssetId: s && s.data && s.data.assetId,
            guild: n.guild && n.guild.current,
            alliance: n.alliance && n.alliance.current,
            alignmentInfos: window.gui.playerData.alignment.alignmentInfos
        }),
        this.ornament.display(),
        0 !== window.gui.playerData.alignment.alignmentInfos.alignmentGrade ? this.warningWings.show() : this.warningWings.hide()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        I.call(this, "div", {
            className: "QuestsWindow",
            name: "quests"
        });
        var e = this
          , t = !1;
        S = window.gui.playerData.quests,
        this.currentQuest = null ,
        this.selectedQuestElement = null ,
        this.updateRequired = !0,
        this.questsListUpdated = !1,
        this.params = {},
        this.locateButtonMap = {},
        S.on("listUpdated", function() {
            e.updateRequired = !0,
            e.questsListUpdated = !0,
            e.isVisible() && (e.emit("open", e.params),
            e.questsList.delClassNames("spinner"))
        }),
        this.once("open", function() {
            this._createDom(),
            this._setupEvents(),
            this._getQuestCategoryStaticData(function() {
                e._createQuestCategories(),
                t = !0,
                e.emit("initialized")
            })
        }),
        this.on("open", function(e) {
            return this.questsList.toggleClassName("spinner", !this.questsListUpdated),
            t ? void this._onOpen(e) : this.once("initialized", this._onOpen.bind(this, e))
        })
    }
    function o(e, t) {
        if (t.length) {
            for (var i = {}, n = 0, o = t.length; n < o; n += 1) {
                var s = t[n];
                i[s[0]] = s[1]
            }
            var a = Object.keys(i);
            h.getItems(a, function(t, n) {
                return t ? console.error("Failed to retrieve items", a) : void n.forEach(function(t) {
                    if (t) {
                        var n = e.appendChild(new d);
                        n.addClassNames("rewardSlot"),
                        n.setItem(t),
                        n.setQuantity(i[t.id]),
                        n.on("tap", function() {
                            C.open("itemBox", {
                                itemData: t
                            })
                        })
                    }
                })
            })
        }
    }
    function s(e, t) {
        t.length && y.getData("Emoticons", t, function(t, i) {
            if (t)
                return console.error(t);
            var n = []
              , o = [];
            i.forEach(function(t) {
                if (t) {
                    var i = e.appendChild(new v);
                    i.addClassNames("rewardSlot"),
                    o.push(i),
                    i.icon.addClassNames("spinner"),
                    n.push("gfx/emotes/" + t.id + ".png"),
                    i.setTooltip(t.nameId)
                }
            }),
            a.preloadImages(n, function(e) {
                for (var t = 0, i = e.length; t < i; t += 1) {
                    var n = o[t];
                    n.rootElement && (n.icon.delClassNames("spinner"),
                    n.setImage(e[t]))
                }
            })
        })
    }
    i(750);
    var a = i(5)
      , r = i(448)
      , l = i(35).getText
      , c = i(451)
      , u = i(26).inherits
      , h = i(323)
      , d = i(567)
      , p = i(315)
      , m = i(84).playUiSound
      , f = i(751)
      , g = i(302)
      , _ = i(393)
      , v = i(569)
      , y = i(36)
      , w = i(32)
      , b = i(30)
      , C = i(22)
      , I = i(190)
      , T = i(206).addTooltip
      , S = {}
      , A = [];
    u(n, I),
    e.exports = n,
    n.prototype._onOpen = function(e) {
        var t = this;
        this.params = e || {};
        var i = !0
          , n = b.getValue("showCompletedQuest", !1);
        this.showCompletedCheckbox.toggleActivation(n, i),
        this.updateRequired && this._updateQuestList();
        var o = this.params.categoryId || this.currentQuest && this.currentQuest.dbQuest.categoryId
          , s = this.params.questId || this.currentQuest && this.currentQuest.questId;
        setTimeout(function() {
            t._selectQuest(o, s)
        }, 0)
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "col1"
        })
          , i = this.createChild("div", {
            className: "col2"
        });
        this.counter = t.createChild("div", {
            className: ["header", "counter"]
        }),
        this.questsList = t.appendChild(new p({
            className: "tree"
        })),
        this.showCompletedCheckbox = t.appendChild(new r(l("ui.grimoire.displayFinishedQuests")));
        var n = i.createChild("div", {
            className: ["header", "steps"]
        })
          , o = n.createChild("div", {
            className: "followedQuest"
        });
        this.questFollowed = o.appendChild(new I("div",{
            className: "followedQuestButton"
        })),
        T(o, l("tablet.ui.grimoire.followQuest")),
        this.questFollowed.createChild("div", {
            className: "locateBackground"
        }),
        this.questFollowed.createChild("div", {
            className: "locateIcon"
        }),
        w(o),
        o.on("tap", function() {
            var t = window.gui.GPS
              , i = e.currentQuest.questId
              , n = !t.questFollower.isQuestFollowed(i);
            e._updateQuestFollow(i, n, !0)
        }),
        this.questFollowed.toggleClassName("selected", !0),
        this.questFollowed.hide(),
        this.stepTitle = n.createChild("div", {
            className: "stepTitle"
        }),
        this.stepSelector = n.appendChild(new _({
            className: "stepSelector"
        }));
        var s = i.createChild("div", {
            className: "descWrapper"
        });
        s.createChild("div", {
            className: "image"
        }),
        this.description = s.createChild("div", {
            className: "description"
        }),
        i.createChild("div", {
            className: "header",
            text: l("ui.grimoire.quest.objectives")
        }),
        this.objectivePlaceHolder = new I("div",{
            text: l("ui.grimoire.quest.objectivesNonAvailable"),
            name: "objectivePlaceHolder",
            className: "objectiveRow"
        }),
        this.objectivesScroller = i.appendChild(new g({
            className: "objectiveList"
        })),
        this.objectives = this.objectivesScroller.content;
        var a = this.rewardHeader = i.createChild("div", {
            className: "header"
        });
        a.createChild("div", {
            className: "rewardTitle",
            text: l("ui.grimoire.quest.rewards")
        });
        var c = this.xpPoint = a.createChild("div", {
            className: "point"
        });
        this.xp = c.createChild("div", {
            className: "text"
        }),
        c.createChild("div", {
            className: ["xp", "icon"]
        }),
        c.hide();
        var u = this.kamasPoint = a.createChild("div", {
            className: "point"
        });
        this.kamas = u.createChild("div", {
            className: "text"
        }),
        u.createChild("div", {
            className: ["kamas", "icon"]
        }),
        u.hide(),
        this.rewardList = i.createChild("div", {
            className: "rewardList"
        }),
        this.stepSelector.on("change", function(t) {
            var i = e.currentQuest.dbSteps[t]
              , n = e.currentQuest.dbQuest.stepIds.indexOf(parseInt(t, 10));
            n <= this.index ? e._displayStepData(i) : e._displayUnknownStep(i)
        }),
        this.questsList.on("selected", function(t) {
            t.sublist.show(),
            e._updateQuestItemsStyle(),
            e.questsList.refresh(),
            e.questsList.scrollToElement(t)
        }),
        this.questsList.on("deselected", function(t) {
            t.sublist.hide(),
            e._updateQuestItemsStyle(),
            e.questsList.refresh()
        }),
        this.showCompletedCheckbox.on("change", function(t) {
            b.setValue("showCompletedQuest", t),
            e._showCompletedQuest()
        })
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui
          , i = t.GPS;
        S.on("questUpdate", function(t) {
            e.isVisible() && e.currentQuest && t === e.currentQuest.questId && e._selectQuest(e.currentQuest.dbQuest.categoryId, e.currentQuest.questId)
        }),
        S.on("questFinished", function(t) {
            e._endQuest(t.questId),
            e._sortSublist(t.questId),
            e._showCompletedQuest(),
            e._updateQuestCounter(),
            e.currentQuest && t.questId === e.currentQuest.questId && e._reset()
        }),
        S.on("questStarted", function(t) {
            e._addQuest(t),
            e._sortSublist(t),
            e._showCompletedQuest(),
            e._updateQuestCounter(),
            e.currentQuest || (e.currentQuest = S.all[t],
            e.isVisible() && e._selectQuest(e.currentQuest.dbQuest.categoryId, e.currentQuest.questId))
        }),
        t.on("disconnect", function() {
            e.currentQuest = null ,
            e.selectedQuestElement = null ,
            e.updateRequired = !0,
            e.questsListUpdated = !1,
            e.params = {},
            e.locateButtonMap = {}
        }),
        i.on("addDestination", function(t) {
            var i = e.locateButtonMap[t.id];
            i && i.rootElement && i.addClassNames("selected")
        }),
        i.on("removeDestination", function(t) {
            var i = e.locateButtonMap[t];
            i && i.rootElement && i.delClassNames("selected")
        })
    }
    ,
    n.prototype._getQuestCategoryStaticData = function(e) {
        y.getAllDataTable("QuestCategory", function(t, i) {
            return t ? console.error(t) : (A = i || [],
            A.sort(function(e, t) {
                return e.order - t.order
            }),
            void e())
        })
    }
    ,
    n.prototype._createQuestCategories = function() {
        for (var e = this, t = 0, i = A.length; t < i; t += 1) {
            var n = A[t]
              , o = new I("div",{
                className: "label"
            });
            o.createChild("div", {
                className: "arrow"
            }),
            o.createChild("div", {
                className: "text",
                text: n.nameId
            });
            var s = e.questsList.addItem({
                id: n.id,
                element: o
            }, {
                noRefresh: !0
            });
            s.hide(),
            s.sublist = s.appendChild(new I("div",{
                className: "sublist"
            })),
            s.sublist.hide()
        }
    }
    ,
    n.prototype._updateQuestList = function() {
        this.updateRequired = !1,
        this._reset(),
        this._generateQuestList(),
        this._updateQuestCounter()
    }
    ,
    n.prototype._reset = function() {
        this.currentQuest = null ,
        this._resetSelectedQuestElement(),
        this.stepTitle.setText(""),
        this.description.setText(""),
        this._resetObjectives(),
        this.rewardList.clearContent(),
        this.kamas.setText(""),
        this.kamasPoint.hide(),
        this.xp.setText(""),
        this.xpPoint.hide(),
        this.questsList.deselectAll(),
        this.stepSelector.clearContent(),
        this.stepSelector.hide(),
        this.questFollowed.hide()
    }
    ,
    n.prototype._resetSelectedQuestElement = function() {
        this.selectedQuestElement && (this.selectedQuestElement.delClassNames("selected"),
        this.selectedQuestElement = null )
    }
    ,
    n.prototype._generateQuestList = function() {
        for (var e = this.questsList.getItems(), t = 0; t < e.length; t += 1) {
            var i = e[t].sublist;
            i.clearContent()
        }
        var n = Object.keys(S.active).sort()
          , o = Object.keys(S.finished).sort();
        for (t = 0; t < n.length; t += 1)
            this._addQuest(n[t]);
        for (t = 0; t < o.length; t += 1)
            this._addQuest(o[t]);
        this._showCompletedQuest()
    }
    ,
    n.prototype._updateQuestCounter = function() {
        var e = l("ui.grimoire.pendingQuests", Object.keys(S.active).length)
          , t = l("ui.grimoire.completedQuests", Object.keys(S.finished).length);
        this.counter.setText(e + " - " + t)
    }
    ,
    n.prototype._selectQuest = function(e, t) {
        if (e) {
            var i = this.questsList.getItem(e);
            if (i) {
                this.questsList.selectItem(e);
                var n = i.sublist.getChild(t);
                n.hasClassName("completed") || (n.tap(),
                this.questsList.scrollToElement(n))
            }
        }
    }
    ,
    n.prototype._updateQuestItemsStyle = function() {
        for (var e, t, i, n = this.questsList.getItems(), o = 0, s = 0; s < n.length; s += 1)
            if (e = n[s],
            e.isVisible() && (e.toggleClassName("odd", o % 2 === 0),
            o += 1,
            e.sublist.isVisible())) {
                t = e.sublist.getChildren();
                for (var a = 0; a < t.length; a += 1)
                    i = t[a],
                    i.isVisible() && (i.toggleClassName("odd", o % 2 === 0),
                    o += 1)
            }
    }
    ,
    n.prototype._showCompletedQuest = function() {
        for (var e, t, i, n, o = b.getValue("showCompletedQuest", !1), s = this.questsList.getItems(), a = !0, r = 0; r < s.length; r += 1) {
            t = s[r],
            i = t.sublist.getChildren(),
            a = !0;
            for (var l = 0; l < i.length; l += 1)
                n = i[l],
                e = n.getWuiName(),
                o || !S.finished[e] ? (a = !1,
                n.show()) : n.hide();
            a ? t.hide() : t.show()
        }
        this._updateQuestItemsStyle(),
        this.questsList.refresh()
    }
    ,
    n.prototype._resetObjectives = function() {
        this.locateButtonMap = {},
        this._removeObjectivePlaceHolder(),
        this.objectives.clearContent(),
        this.objectives.appendChild(this.objectivePlaceHolder),
        this.objectivesScroller.refresh()
    }
    ,
    n.prototype._removeObjectivePlaceHolder = function() {
        var e = this.objectives.getChild("objectivePlaceHolder");
        e && this.objectives.removeChild(e)
    }
    ,
    n.prototype._createLocateButton = function(e, t, i, n) {
        var o = this
          , s = window.gui.GPS
          , a = e.appendChild(new I("div",{
            className: "locateButton"
        }));
        a.createChild("div", {
            className: "locateBackground"
        }),
        a.createChild("div", {
            className: "locateIcon"
        });
        var r = s.getQuestObjectivePoiId(i.objectiveId);
        this.locateButtonMap[r] = a,
        w(e),
        e.on("tap", function() {
            s.getPOI(r) ? (s.removePOI(r),
            s.isAtLeastOneQuestObjectiveFollowed(n) || o._updateQuestFollow(n, !1, !1)) : (s.addQuestObjectiveFromObjective({
                objectiveDb: t,
                objectiveId: i.objectiveId,
                questId: n
            }),
            s.questFollower.isQuestFollowed(n) || o._updateQuestFollow(n, !0, !1))
        }),
        a.toggleClassName("selected", !!s.getPOI(r))
    }
    ,
    n.prototype._createObjectiveElement = function(e, t, i) {
        var n = new I("div",{
            className: "objectiveRow"
        })
          , o = n.createChild("div", {
            className: "description"
        });
        o.appendChild(c.process(t.text));
        var s = t.objectiveStatus;
        return n.toggleClassName("complete", !s),
        n.toggleClassName("disabled", !s),
        s && (e.coords || e.mapId) ? (this._createLocateButton(n, e, t, i),
        n) : n
    }
    ,
    n.prototype._displayStepObjectives = function(e) {
        this._resetObjectives();
        var t = this.currentQuest.objectives;
        if ((!this.currentQuest || this.currentQuest.questId !== e.questId || this.currentQuest.stepId === e.id) && t.length) {
            this._removeObjectivePlaceHolder();
            for (var i, n = 0, o = t.length; n < o; n += 1)
                i = t[n],
                this.objectives.appendChild(this._createObjectiveElement(this.currentQuest.dbObjectives[i.objectiveId], i, e.questId));
            this.objectivesScroller.refresh()
        }
    }
    ,
    n.prototype._displayStepRewards = function(e) {
        this.rewardList.clearContent();
        for (var t = window.gui.playerData.characterBaseInformations.level, i = 0, n = e.length; i < n; i += 1) {
            var a = this.currentQuest.dbRewards[e[i]];
            !a || a.levelMin !== -1 && t < a.levelMin || a.levelMax !== -1 && t > a.levelMax || (o(this.rewardList, a.itemsReward),
            s(this.rewardList, a.emotesReward))
        }
    }
    ,
    n.prototype._setKamas = function(e) {
        var t = f.calculateStepKamasRatio(e);
        return t ? (this.kamasPoint.show(),
        void this.kamas.setText(t)) : void this.kamasPoint.hide()
    }
    ,
    n.prototype._setXp = function(e) {
        var t = f.calculateStepXpRatio(e);
        return t ? (this.xpPoint.show(),
        void this.xp.setText(t)) : void this.xpPoint.hide()
    }
    ,
    n.prototype._displayStepData = function(e) {
        var t = window.gui.GPS;
        this.stepTitle.setText(e.nameId),
        this.description.clearContent(),
        this.description.appendChild(c.process(e.descriptionId)),
        this.questFollowed.show(),
        this.questFollowed.toggleClassName("selected", t.questFollower.isQuestFollowed(this.currentQuest.questId)),
        this._displayStepObjectives(e),
        this._displayStepRewards(e.rewardsIds),
        this._setKamas(e),
        this._setXp(e)
    }
    ,
    n.prototype._displayUnknownStep = function(e) {
        this.stepTitle.setText(e.nameId),
        this.description.setText(l("ui.grimoire.quest.descriptionNonAvailable")),
        this._resetObjectives(),
        this._displayStepRewards(e.rewardsIds),
        this._setKamas(e),
        this._setXp(e)
    }
    ,
    n.prototype._updateStepList = function() {
        var e = this.currentQuest;
        this.stepSelector.clearContent(),
        this.stepSelector.index = 0;
        for (var t = e.dbQuest.stepIds, i = 0, n = t.length; i < n; i += 1) {
            var o = t[i];
            this.stepSelector.addOption(l("ui.grimoire.quest.step") + " " + (i + 1), o),
            e.stepId === o && (this.stepSelector.index = i)
        }
        this.stepSelector.select(e.stepId),
        this.stepSelector.show()
    }
    ,
    n.prototype._getQuestCategoryElement = function(e) {
        var t = S.all[e];
        return this.questsList.getItem(t.dbQuest.categoryId)
    }
    ,
    n.prototype._sortSublist = function(e) {
        var t = this._getQuestCategoryElement(e)
          , i = t.sublist.getChildren();
        i.sort(function(e, t) {
            return parseInt(e.getWuiName(), 10) - parseInt(t.getWuiName(), 10)
        }),
        i.sort(function(e, t) {
            return e.hasClassName("completed") ? 1 : t.hasClassName("completed") ? -1 : void 0
        });
        for (var n = 0; n < i.length; n += 1)
            t.sublist.appendChild(i[n])
    }
    ,
    n.prototype._addQuest = function(e) {
        var t = this
          , i = window.gui.GPS
          , n = S.all[e]
          , o = this._getQuestCategoryElement(e);
        o.show();
        var s = o.sublist.getChild(e);
        if (!s) {
            var a = new I("div",{
                className: "label",
                name: e
            });
            a.hourglass = a.createChild("div", {
                className: "icon"
            }),
            i.questFollower.isQuestFollowed(e) || a.hourglass.addClassNames("notFollowed"),
            a.createChild("div", {
                className: "text",
                text: n.dbQuest.nameId
            }),
            w(a),
            a.on("tap", function() {
                m("GEN_BUTTON");
                var e = a.getWuiName();
                t.currentQuest = S.all[e],
                t._updateStepList(),
                t._resetSelectedQuestElement(),
                a.addClassNames("selected"),
                t.selectedQuestElement = a
            }),
            s = o.sublist.appendChild(a)
        }
        S.active[e] ? (s.delClassNames("completed"),
        s.enable()) : (s.addClassNames("completed"),
        s.disable())
    }
    ,
    n.prototype._endQuest = function(e) {
        var t = window.gui.GPS
          , i = this._getQuestCategoryElement(e)
          , n = i.sublist.getChild(e);
        n && (n.addClassNames("completed"),
        n.disable(),
        t.questFollower.unfollowQuest(e, !1))
    }
    ,
    n.prototype._updateQuestFollow = function(e, t, i) {
        var n = window.gui.GPS
          , o = n.questFollower.isQuestFollowed(e);
        t && !o ? n.questFollower.followQuest(e, i) : !t && o && n.questFollower.unfollowQuest(e, i),
        this.questFollowed.toggleClassName("selected", t),
        this._updateHourglass(e, t)
    }
    ,
    n.prototype._updateHourglass = function(e, t) {
        var i = this._getQuestCategoryElement(e)
          , n = i.sublist.getChild(e);
        n && n.hourglass.toggleClassName("notFollowed", !t)
    }
}
, function(e, t) {}
, function(e, t) {
    function i(e, t) {
        return Math.floor(e * Math.pow(100 + 2 * e, 2) / 20 * t.duration * t.xpRatio)
    }
    t.calculateStepKamasRatio = function(e) {
        var t = window.gui.playerData.characterBaseInformations.level
          , i = e.kamasScaleWithPlayerLevel ? t : e.optimalLevel;
        return Math.floor((Math.pow(i, 2) + 20 * i - 20) * e.kamasRatio * e.duration)
    }
    ,
    t.calculateStepXpRatio = function(e) {
        var t = 1.5
          , n = .7
          , o = window.gui.playerData.characterBaseInformations.level
          , s = 1 + window.gui.playerData.experienceFactor / 100
          , a = e.optimalLevel;
        if (o > a) {
            var r = Math.floor(Math.min(o, a * t))
              , l = (1 - n) * i(a, e)
              , c = n * i(r, e);
            return Math.floor((l + c) * s)
        }
        return Math.floor(i(o, e) * s)
    }
}
, function(e, t, i) {
    function n(e, t) {
        if (e.isItem)
            return -1;
        if (t.isItem)
            return 1;
        var i = e.getProperty("minPlayerLevel", 1)
          , n = t.getProperty("minPlayerLevel", 1);
        return i < n ? -1 : i > n ? 1 : e.id > t.id ? 1 : e.id < t.id ? -1 : 0
    }
    function o(e, t) {
        return e.isItem ? -1 : t.isItem ? 1 : e.level > t.level ? 1 : e.level < t.level ? -1 : e.id > t.id ? 1 : e.id < t.id ? -1 : 0
    }
    function s(e, t) {
        return e.id === g.WEAPON_SPELL_ID || (void 0 === t && (t = e.level),
        e.getProperty("minPlayerLevel", t) <= window.gui.playerData.characterBaseInformations.level)
    }
    function a() {
        p.call(this, "div", {
            className: "SpellsWindow",
            name: "spells"
        }),
        this.mustRefreshAll = !0,
        this.characterIdOnOpen = 0,
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        });
        var e = window.gui;
        this.on("open", function() {
            var t = e.playerData.characters.controlledCharacterId;
            this.characterIdOnOpen !== t && (this.characterIdOnOpen = t,
            this.updateRemainingPoints(),
            this.mustRefreshAll = !0),
            this.mustRefreshAll ? this._refreshAllContent() : (this.table.sort(n),
            this.table.selectFirstRow()),
            e.shortcutBar.openPanel("spell")
        }),
        this.on("focus", function() {
            e.shortcutBar.openPanel("spell")
        })
    }
    i(753);
    var r = i(26).inherits
      , l = i(32)
      , c = i(35).getText
      , u = i(204).DofusButton
      , h = i(400)
      , d = i(393)
      , p = i(190)
      , m = i(576)
      , f = i(186)
      , g = i(281)
      , _ = i(5)
      , v = i(84).playUiSound;
    r(a, p),
    e.exports = a,
    a.prototype._createDom = function() {
        function e(e) {
            var t = new p("div",{
                className: "icon"
            })
              , i = e.getIconUrl();
            return i && t.setStyle("backgroundImage", i),
            t
        }
        function t(e) {
            var t = new u("",{
                name: "addButton"
            });
            return t.spell = e,
            t.on("tap", function() {
                var e = this.rootElement.getBoundingClientRect();
                window.gui.openContextualMenu("spellUpgrade", {
                    spell: this.spell,
                    remainingPoints: i.remainingPoints
                }, {
                    x: e.left + e.width,
                    y: e.top
                }),
                v("PLUS_BUTTON")
            }),
            i._refreshAddButtonState(t),
            t
        }
        var i = this
          , s = this.createChild("div", {
            className: "col1"
        });
        this.col2 = this.createChild("div", {
            className: "col2"
        }),
        this.selector = s.appendChild(new d),
        this.table = s.appendChild(new h([{
            id: "icon",
            format: e,
            sort: n
        }, {
            id: "name",
            header: c("ui.common.spellName"),
            getContent: function(e) {
                return e.getName()
            },
            sort: !0
        }, {
            id: "rank",
            header: c("ui.common.level"),
            format: function(e) {
                return e.isItem || e.id === g.WEAPON_SPELL_ID ? "-" : e.level
            },
            sort: o
        }, {
            id: "add",
            format: t
        }],"id")),
        this.table.on("rowTap", function(e, t) {
            i.displaySpell({
                spell: t,
                imageUri: e.icon.content.getStyle("backgroundImage")
            }),
            v("GEN_BUTTON")
        });
        var a, r = !0;
        this.table.addFilter(function(e) {
            return r || e.getProperty("typeId") === a
        }),
        this.selector.on("change", function(e) {
            r = !1,
            "-" === e ? r = !0 : a = parseInt(e, 10),
            i.table.filter()
        });
        var l = s.createChild("div", {
            className: "pointsBox"
        });
        l.createChild("div", {
            text: c("ui.grimoire.spellCapital"),
            className: "label"
        }),
        this.remainingPointsBox = l.createChild("div", {
            className: "remainingPoints"
        })
    }
    ,
    a.prototype._setupEvents = function() {
        var e = this
          , t = window.gui;
        t.on("SpellUpgradeFailureMessage", function() {
            window.gui.openPopup({
                title: c("ui.common.error"),
                message: c("ui.grimoire.popup.upgradeSpellFailMessage")
            })
        }),
        t.on("CharacterLevelUpMessage", function() {
            e.characterIdOnOpen === t.playerData.characters.mainCharacterId && e.enableSpellsOnLevelUp()
        }),
        t.on("disconnect", function() {
            e.mustRefreshAll = !0
        }),
        t.playerData.characters.mainCharacter.on("weaponChanged", function() {
            e.characterIdOnOpen === t.playerData.characters.mainCharacterId && e.updateWeaponSpell()
        });
        var i = t.playerData.characters;
        i.mainCharacter.on("spellUpgrade", function(i, n) {
            if (e.characterIdOnOpen === t.playerData.characters.mainCharacterId)
                return e.table.getRow(i) ? void e._updateDisplayedSpellLevel(i, n) : console.error(new Error("spell " + i + " does not exist in spell window"))
        }),
        i.mainCharacter.on("newSpellLearned", function(i) {
            if (e.characterIdOnOpen === t.playerData.characters.mainCharacterId && !e.table.getRow(i)) {
                var n = window.gui.playerData.characters.mainCharacter.spellData.spells[i];
                if (!n)
                    return console.error(new Error("spell " + i + " is not loaded"));
                var o = {};
                o[n.id] = n,
                e.table.addMap(o),
                n.getIconUrl() || _.preloadImage(n.getIconUri(), function(t) {
                    n.spell.image = t;
                    var i = e.table.getCell(n.id, "icon");
                    i.setStyle("backgroundImage", t),
                    e.currentSpellId === n.id && e.displaySpell({
                        spell: n,
                        imageUri: t
                    }),
                    e.refreshAllSpellState()
                })
            }
        }),
        t.playerData.on("spellsPointsUpdated", function() {
            e.characterIdOnOpen === this.characters.controlledCharacterId && (e.updateRemainingPoints(),
            e._refreshAllAddButtonState())
        }),
        i.on("spellList", function() {
            e.characterIdOnOpen === this.controlledCharacterId && e._askForRefresh()
        }),
        i.on("switchControlledCharacter", function() {
            e.characterIdOnOpen !== this.controlledCharacterId && f.cancelDragFromSource("spellsWindow")
        })
    }
    ,
    a.prototype._refreshAllContent = function() {
        this.mustRefreshAll = !1;
        var e = window.gui.playerData.characters
          , t = e.getControlledCharacter();
        this._onMainCharacter = e.isMainCharacterControlled(),
        this.table.setSorter(n),
        this._loadAllSpells(t.spellData.spells),
        this.setupSelectorOptions(),
        this.table.selectFirstRow()
    }
    ,
    a.prototype._askForRefresh = function() {
        this.isVisible() ? this._refreshAllContent() : this.mustRefreshAll = !0
    }
    ,
    a.prototype.updateRemainingPoints = function() {
        var e = window.gui.playerData.characters.getControlledCharacter()
          , t = e.characteristics.spellsPoints;
        this.remainingPoints !== t && (this.remainingPointsBox.setText(t),
        this.remainingPoints = t)
    }
    ,
    a.prototype.setupSelectorOptions = function() {
        var e = this;
        this.selector.clearContent(),
        this.selector.addOption(c("ui.common.allTypes"), "-"),
        this.selector.setValue("-");
        var t = {}
          , i = window.gui.playerData.characters.getControlledCharacter();
        for (var n in i.spellData.spells) {
            var o = i.spellData.spells[n]
              , s = o.getProperty("typeId");
            t[s] || (e.selector.addOption(o.getHumanReadableSpellType(), s),
            t[s] = !0)
        }
    }
    ,
    a.prototype.updateWeaponSpell = function() {
        var e = this
          , t = window.gui.playerData.characters.mainCharacter.spellData.spells[g.WEAPON_SPELL_ID];
        _.preloadImage(t.getIconUri(), function(i) {
            e.table.updateRow(t);
            var n = e.table.getCell(t.id, "icon");
            n.setStyle("backgroundImage", i),
            e.refreshSpellState(t.id),
            e.currentSpellId === t.id && e.displaySpell({
                spell: t,
                imageUri: i
            })
        })
    }
    ,
    a.prototype._loadAllSpells = function(e) {
        this.spellMap = e,
        this.table.clearContent(),
        this.table.addMap(e);
        var t = []
          , i = [];
        for (var n in e) {
            var o = e[n];
            o.getIconUrl() || (i.push(o),
            t.push(o.getIconUri()))
        }
        var s = this;
        _.preloadImages(t, function(e) {
            for (var t = 0; t < e.length; t++) {
                var n = i[t]
                  , o = n.spell.image = e[t]
                  , a = s.table.getCell(n.id, "icon");
                a.setStyle("backgroundImage", o),
                s.currentSpellId === n.id && s.displaySpell({
                    spell: n,
                    imageUri: o
                })
            }
            s.refreshAllSpellState()
        })
    }
    ,
    a.prototype.setSpellDraggable = function(e, t) {
        var i = this.table.getCell(e, "icon");
        if (f.isDraggable(i))
            return void (t ? f.enableDrag(i) : f.disableDrag(i));
        if (t) {
            var n = this.spellMap[e].getIconUrl();
            n && f.setDraggable(i, {
                backgroundImage: n
            }, "spellsWindow", {
                spellId: e
            }, {
                dragOnTouchstart: !0
            })
        }
    }
    ,
    a.prototype.setSpellEnabled = function(e, t) {
        this.table.getRow(e).toggleClassName("grayed", !t)
    }
    ,
    a.prototype.refreshSpellState = function(e) {
        var t = this.spellMap[e]
          , i = t.isItem || s(t)
          , n = i && this._onMainCharacter;
        this.setSpellEnabled(e, i),
        this.setSpellDraggable(e, n)
    }
    ,
    a.prototype.refreshAllSpellState = function() {
        for (var e in this.spellMap)
            this.refreshSpellState(e)
    }
    ,
    a.prototype._updateDisplayedSpellLevel = function(e, t) {
        if (this.table.hasRow(e)) {
            var i = this.table.getCell(e, "rank");
            i.setText(t)
        }
    }
    ,
    a.prototype.enableSpellsOnLevelUp = function() {
        this.table.getRowCount() && (this.refreshAllSpellState(),
        this._refreshAllAddButtonState())
    }
    ,
    a.prototype._refreshAllAddButtonState = function() {
        for (var e in this.spellMap)
            if (this.table.hasRow(e)) {
                var t = this.table.getCell(e, "add");
                this._refreshAddButtonState(t)
            }
    }
    ,
    a.prototype._refreshAddButtonState = function(e) {
        var t = e.spell
          , i = t.level;
        if (0 === i || i === t.getMaxLevel())
            return void e.hide();
        if (!s(t, i + 1))
            return void e.hide();
        e.show();
        var n = t.getUpgradeCost();
        return this.remainingPoints < n ? void e.disable() : void e.enable()
    }
    ,
    a.prototype.displaySpell = function(e) {
        function t(t, o) {
            var a = Number(o) + 1
              , r = t.createChild("div", {
                className: "tab",
                text: a
            });
            r.rankNum = o,
            i.getSpellLevelId(a) === s && r.addClassNames("on"),
            l(r),
            r.on("tap", function() {
                n.displaySpell({
                    spell: e.spell,
                    imageUri: e.imageUri,
                    spellLevel: a
                }),
                v("TAB")
            })
        }
        var i, n = this;
        e.spellLevel && e.spellLevel !== e.spell.level ? (i = e.spell.clone(),
        i.setLevel(e.spellLevel)) : i = e.spell;
        var o = i.level
          , s = i.getSpellLevelId(o)
          , a = e.imageUri;
        if (this.currentSpellLevelId === s)
            return void this.tabIcon.setStyle("backgroundImage", a);
        this.col2.clearContent(),
        this.currentSpellLevelId = s,
        this.currentSpellId = i.id;
        for (var r = n.col2.createChild("div", {
            className: "tabs"
        }), u = i.getMaxLevel(), h = 0; h < u; h++)
            t(r, h.toString());
        var d = n.col2.createChild("div", {
            className: "panel"
        })
          , p = d.createChild("div", {
            className: "header"
        })
          , f = this.tabIcon = p.createChild("div", {
            className: "icon"
        });
        f.setStyle("backgroundImage", a);
        var g = p.createChild("div", {
            className: "panelTop"
        });
        g.createChild("div", {
            className: "spellName",
            text: i.getName()
        }),
        g.createChild("div", {
            className: "minPlayerLevel",
            text: c("ui.spell.requiredLevel") + " " + (i.getProperty("minPlayerLevel", o) || 1)
        }),
        d.appendChild(new m({
            spell: i,
            level: o
        },{
            spellTooltipAll: !0
        }))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, "div", {
            className: "jobsWindow",
            name: "jobs"
        });
        var e = this;
        this.jobButtons = [],
        this.jobSelectButtons = [],
        this.jobSelectSpecialButtons = [],
        this._expBarTooltip = new l("div"),
        this.mustRefreshJobs = !0,
        this.numRefreshTasks = 0,
        this._setupEvents(),
        this.on("open", function(t) {
            e.jobListElement || e._createDom();
            var i = t ? t.jobId : null ;
            return e.mustRefreshJobs ? e._refreshJobs(i) : void (i && e.selectJob(i))
        }),
        this.on("close", function() {
            e.mustRefreshJobs = !0,
            _.getWindow("jobOptions").openState && _.close("jobOptions"),
            e.recipeList.reset()
        })
    }
    function o(e, t) {
        var i = e.getChild("level");
        i && (t = t ? p("ui.common.short.level") + " " + t : "",
        i.setText(t))
    }
    function s(e) {
        var t = e.jobId ? I[e.jobId] : null ;
        e.getChild("jobIcon").setImage(t)
    }
    function a(e, t) {
        var i, n;
        null === t ? (i = null ,
        n = null ) : (i = t.id,
        n = t.experience ? t.experience.jobLevel : 1),
        e.jobId = i,
        s(e),
        o(e, n)
    }
    i(755);
    var r = i(26).inherits
      , l = i(190)
      , c = i(36)
      , u = i(643)
      , h = i(204).DofusButton
      , d = i(743)
      , p = i(35).getText
      , m = i(323)
      , f = i(569)
      , g = i(567)
      , _ = i(22)
      , v = i(756)
      , y = i(5)
      , w = i(206).addTooltip
      , b = 3
      , C = 3
      , I = {};
    r(n, l),
    e.exports = n,
    n.prototype._reset = function() {
        this.mustRefreshJobs = !0,
        this.numRefreshTasks = 0
    }
    ,
    n.prototype._refreshJobs = function(e) {
        this.mustRefreshJobs = !1;
        var t = window.gui.playerData.jobs;
        this.jobMap = t.list;
        var i = Object.keys(this.jobMap);
        if (i.length) {
            this._updateJobButtons(t.jobOriginalOrder);
            var n = this;
            this._getJobImages(function() {
                n._updateJobIcons()
            }),
            e = e || t.jobOriginalOrder[0],
            this.selectJob(e, !0)
        }
    }
    ,
    n.prototype._getJobImages = function(e) {
        var t = []
          , i = []
          , n = this.jobMap;
        for (var o in n) {
            var s = n[o];
            s.info.iconId === -1 || I[o] || (t.push("gfx/jobs/" + s.info.iconId + ".png"),
            i.push(o))
        }
        return t.length ? void y.preloadImages(t, function(t) {
            for (var n = 0; n < t.length; n++)
                I[i[n]] = t[n];
            return e()
        }) : e()
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "col1"
        });
        this.jobListElement = t.createChild("div", {
            className: "jobsList"
        });
        for (var i = 0; i < b; i++)
            this._createJobIcon(i);
        var n = this.jobListElement.createChild("div", {
            className: "specialisation"
        });
        for (n.createChild("div", {
            className: "text",
            text: p("ui.common.specializations")
        }); i < b + C; i++)
            this._createJobIcon(i, n);
        this.jobExpBlock = t.createChild("div", {
            className: "jobExpBlock"
        }),
        this.jobWrapper = this.jobExpBlock.createChild("div", {
            className: "jobWrapper"
        }),
        this.jobName = this.jobWrapper.createChild("div", {
            className: "jobName"
        }),
        this.jobLevel = this.jobWrapper.createChild("div", {
            className: "jobLevel"
        }),
        this._jobExpBar = this.jobExpBlock.appendChild(new u({
            className: "jobExpBar"
        })),
        w(this._jobExpBar, this._expBarTooltip),
        this.skillsBlock = t.createChild("div", {
            className: "skillsBlock"
        }),
        this.skillsTitle = this.skillsBlock.createChild("div", {
            className: "skillsTitle",
            text: p("ui.common.abilities")
        });
        var o = t.appendChild(new h(p("ui.craft.jobOptions")));
        o.on("tap", function() {
            _.open("jobOptions", {
                jobId: e.selectedJobId
            })
        }),
        this.skillsList = this.skillsBlock.appendChild(new d({
            className: "skillsList",
            cannotActivate: !0
        })),
        this.recipeList = this.appendChild(new v)
    }
    ,
    n.prototype._createJobIcon = function(e, t) {
        var i = this
          , n = t || this.jobListElement
          , o = n.createChild("div", {
            className: "job"
        });
        o.itemSlot = o.appendChild(new f({
            name: "jobIcon"
        })),
        this.jobButtons.push(o),
        t ? this.jobSelectSpecialButtons.push(o) : (this.jobSelectButtons.push(o),
        o.createChild("div", {
            className: "level",
            name: "level"
        })),
        o.itemSlot.on("tap", function() {
            o.jobId && i.selectJob(o.jobId)
        })
    }
    ,
    n.prototype._updateJobButtons = function(e) {
        for (var t = 0; t < this.jobButtons.length; t++)
            a(this.jobButtons[t], null );
        var i = 0
          , n = 0;
        for (t = 0; t < e.length; t++) {
            var o = this.jobMap[e[t]]
              , s = o.info.specializationOfId ? this.jobSelectSpecialButtons[n++] : this.jobSelectButtons[i++];
            a(s, o)
        }
    }
    ,
    n.prototype._updateJobIcons = function() {
        for (var e = 0; e < this.jobButtons.length; e++)
            s(this.jobButtons[e])
    }
    ,
    n.prototype._getJobButton = function(e) {
        for (var t = this.jobButtons, i = 0; i < t.length; i++)
            if (t[i].jobId === e)
                return t[i];
        return console.error("_getJobButton: invalid Job ID: " + e),
        null
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui.playerData.jobs;
        window.gui.on("disconnect", function() {
            e._reset()
        }),
        t.on("jobListUpdated", function() {
            var i = 0 !== Object.keys(t.list).length;
            i && (e.mustRefreshJobs = !0,
            e.isVisible() && e._refreshJobs())
        }),
        t.on("jobLevelUp", function(t, i) {
            if (!e.mustRefreshJobs) {
                var n = e._getJobButton(t.id);
                if (n)
                    return o(n, i),
                    e.isVisible() && t.id === e.selectedJobId ? e._refreshJobs(t.id) : void 0
            }
        }),
        t.on("jobExperienceUpdate", function(t) {
            e.isVisible() && t.jobId === e.selectedJobId && e._updateJobInfo(t)
        })
    }
    ,
    n.prototype._updateJobInfo = function(e) {
        var t = "";
        t = 100 !== e.currentLevel ? e.percentage + "% (" + e.currentExperience + " / " + e.levelExperienceCeil + ")" : e.percentage + "% (" + e.currentExperience + ")",
        this._expBarTooltip.setText(t),
        this._jobExpBar.setValue(e.percentage / 100),
        this.jobName.setText(this.jobMap[e.jobId].info.nameId),
        this.jobLevel.setText(p("ui.common.level") + " " + e.currentLevel)
    }
    ,
    n.prototype._selectJobButton = function(e) {
        var t = this._getJobButton(e);
        if (!t)
            return !1;
        if (this.currentJobBtn) {
            if (this.currentJobBtn.jobId === e)
                return !1;
            this.currentJobBtn.itemSlot.select(!1)
        }
        return t.itemSlot.select(),
        this.currentJobBtn = t,
        !0
    }
    ,
    n.prototype.selectJob = function(e, t) {
        if (this._selectJobButton(e) || t) {
            var i = this;
            window.setTimeout(function() {
                i._refreshCurrentJob(e)
            }, 50)
        }
    }
    ,
    n.prototype._afterRefreshTask = function() {
        if (this.numRefreshTasks--,
        this.numRefreshTasks > 0)
            return !this.lastJobIdRequested;
        if (!this.lastJobIdRequested)
            return !0;
        var e = this.lastJobIdRequested;
        return this.lastJobIdRequested = null ,
        this._refreshCurrentJob(e),
        !1
    }
    ,
    n.prototype._refreshCurrentJob = function(e) {
        if (this.numRefreshTasks)
            return void (this.lastJobIdRequested = e);
        this.selectedJobId = e;
        var t = window.gui.playerData.jobs
          , i = 2
          , n = []
          , o = this.jobMap[e]
          , s = o.description.skills;
        this._updateJobInfo(t.getJobExperience(e)),
        this.skillsList.empty();
        for (var a = [], r = [], u = [], h = [], d = [], f = 0; f < s.length; f++) {
            var _ = s[f]
              , v = _.skillId
              , y = _.info;
            if (y) {
                var w = new l("div",{
                    className: "label"
                });
                this.skillsList.addItem(v, w);
                var b = w.appendChild(new g);
                b.addClassNames("skillIcon"),
                d.push(b);
                var C = w.createChild("div", {
                    className: "skillLeft"
                });
                C.createChild("div", {
                    className: "skillName",
                    text: y.nameId
                }),
                u.push(C.createChild("div", {
                    className: "skillDetail"
                })),
                h.push(y.interactiveId);
                var I = w.createChild("div", {
                    className: "skillRight"
                })
                  , T = I.createChild("div", {
                    className: "skillStats"
                });
                if ("SkillActionDescriptionCollect" === _._type) {
                    T.setText(p("ui.jobs.collectSkillInfos", _.time / 10, _.min, _.max)),
                    r.push(y.gatheredRessourceItem);
                    var S = I.appendChild(new g({
                        descriptionOptions: {
                            effects: !1
                        }
                    }));
                    a.push(S)
                }
                if ("SkillActionDescriptionCraft" === _._type) {
                    var A = p("ui.jobs.slotPercents", _.maxSlots, _.probability);
                    T.setText(A),
                    n = n.concat(y.recipes),
                    T.addClassNames("bottom")
                }
            }
        }
        this.numRefreshTasks += 4;
        var E = this;
        window.gui.playerData.jobs.getToolFromJob(e, function(t, i) {
            if (t)
                return E._afterRefreshTask(),
                console.error("JobsWindow: Failed to get tools image for jobId", e, t);
            if (E._afterRefreshTask())
                for (var n = 0, o = d.length; n < o; n += 1) {
                    var s = d[n];
                    s.setItem(i)
                }
        }),
        m.getItems(r, function(e, t) {
            if (e)
                return E._afterRefreshTask(),
                console.error("JobsWindow: Failed to get ingredients", e);
            if (E._afterRefreshTask())
                for (var i = 0; i < t.length; i++) {
                    var n = t[i];
                    a[i].setItem(n)
                }
        }),
        c.getDataMap("Interactives", h, function(e, t) {
            if (e)
                return E._afterRefreshTask(),
                console.error("JobsWindow: Failed to get interactive data", e);
            if (E._afterRefreshTask())
                for (var i = 0; i < h.length; i++) {
                    var n = h[i]
                      , o = t[n];
                    o ? u[i].setText(o.nameId) : console.error(new Error("JobsWindow: no interactive for id " + n))
                }
        }),
        this.recipeList.reset();
        var x = window.gui.playerData.jobs.getMaxSlotsByJobId(e) || i;
        this.recipeList.addRecipes(n, {
            nbCase: x
        }, function() {
            E._afterRefreshTask()
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e, t) {
            function n(e) {
                i.filterNbSlots[o.slotNumber] = e,
                i.filterRecipes()
            }
            var o = i.filterCheckboxes.appendChild(new l(e,t));
            return o.slotNumber = e,
            o.on("change", n),
            o
        }
        e = e || {};
        var i = this;
        s.call(this, "div", {
            className: "RecipeList"
        }),
        this._filterCraftableOnly = !1,
        this.selectedRecipe = null ,
        this.tappedRecipe = null ;
        var n = this.createChild("div", {
            className: "searchBar"
        })
          , o = n.createChild("div", {
            className: "searchLine"
        });
        o.createChild("div", {
            className: "label",
            text: r("ui.common.recipes", 2)
        });
        var u = new c({
            className: "searchInput"
        });
        u.on("change", function(e) {
            i._checkOnInput(e)
        }),
        this.searchInput = o.appendChild(u);
        var h = n.createChild("div", {
            className: "searchLine"
        });
        h.createChild("div", {
            className: "label",
            text: r("ui.common.ingredients")
        }),
        this.filterNbSlots = {},
        this.filterText = "",
        this.filterCheckboxes = {},
        this.filterCheckboxes = h.createChild("div", {
            className: "filterCheckboxes"
        });
        for (var d = 1; d <= g; d += 1)
            this.filterCheckboxes[d] = t(d, !0),
            i.filterNbSlots[d] = !0;
        this.recipesWrapper = this.appendChild(new a({
            className: ["recipesWrapper", "spinner"]
        })),
        this._recipesPlaceholder = this.recipesWrapper.createChild("div", {
            className: "recipesPlaceholder",
            hidden: !0
        }),
        this._recipesPlaceholder.createChild("div", {
            className: "recipesPlaceholderText",
            text: r("ui.craft.noCraftAvailable")
        }),
        this.recipesList = this.recipesWrapper.content,
        this._showCraftableCheckbox = this.appendChild(new l(r("ui.craft.possibleRecipes"))),
        this._showCraftableCheckbox.toggleDisplay(!!e.showCraftableFilter),
        this._showCraftableCheckbox.on("change", function(e) {
            i.filterCraftable(e)
        }),
        this._checkOnInput = function(e) {
            e.length >= 3 ? (i.filterText = f(e),
            i.filterRecipes()) : "" !== i.filterText && (i.filterText = "",
            i.filterRecipes())
        }
    }
    i(757);
    var o = i(26).inherits
      , s = i(190)
      , a = i(302)
      , r = i(35).getText
      , l = i(448)
      , c = i(391)
      , u = i(323)
      , h = i(12)
      , d = i(32)
      , p = i(758)
      , m = i(186)
      , f = i(210).simplifyString
      , g = 8
      , _ = 3;
    o(n, s),
    e.exports = n,
    n.prototype.addRecipes = function(e, t, i) {
        t = t || {},
        this._recipesPlaceholder.hide(),
        this.recipesList.clearContent();
        var n = this;
        this._nbCase = t.nbCase || (Object.keys(this.filterNbSlots).length ? null : g),
        i = i || function() {}
        ;
        var o = (new Date).getTime();
        this._timestamp = o;
        var s = {}
          , a = [];
        if (0 === e.length)
            return this._recipesPlaceholder.show(),
            this.recipesWrapper.delClassNames("spinner"),
            i();
        for (var r = 0, l = e.length; r < l; r += 1) {
            var c = e[r];
            if (c) {
                a.push(c);
                var d = c.ingredientIds;
                s[c.resultId] = !0;
                for (var p = 0, m = d.length; p < m; p += 1) {
                    var f = d[p];
                    s[f] = !0
                }
            }
        }
        s = Object.keys(s),
        u.getItems(s, function(e) {
            return e ? (console.error("Failed to get ingredients", e),
            i(e)) : n._timestamp !== o ? i() : h.eachSeries(a, function(e, t) {
                n._addRecipe(e, t)
            }, function(e) {
                if (e)
                    return console.error(e),
                    i(e);
                if (n._nbCase)
                    for (var t = 1; t <= g; t += 1) {
                        var o = t <= n._nbCase;
                        n.filterNbSlots[t] = o,
                        n.filterCheckboxes[t].toggleActivation(o)
                    }
                return n.recipesWrapper.delClassNames("spinner"),
                n.recipesList.show(),
                n.filterRecipes(),
                i()
            })
        })
    }
    ,
    n.prototype._addRecipe = function(e, t) {
        function i() {
            var e = window.gui.playerData.inventory.quantityList
              , t = n.recipesList.getChild(o);
            for (var i in t.quantityList)
                if (!e[i] || e[i] < t.quantityList[i])
                    return void n.emit("notEnoughIngredient");
            n.emit("recipeSelected", o)
        }
        var n = this
          , o = e.resultId
          , s = new p(e,{
            nbCases: this._nbCase
        });
        return n.recipesList.appendChild(s),
        d(s),
        s.on("tap", function() {
            if (n.tappedRecipe && n.tappedRecipe.rootElement) {
                if (n.tappedRecipe === this)
                    return void i();
                n.tappedRecipe.delClassNames("tapped")
            }
            this.addClassNames("tapped"),
            n.tappedRecipe = this
        }),
        s.on("doubletap", function() {
            i()
        }),
        s.on("itemTapped", function(e) {
            n.emit("itemTapped", e)
        }),
        s.on("craftButtonTapped", function() {
            i()
        }),
        s.setupRecipe(function(e, n) {
            if (e)
                return console.error(new Error("Cannot setup recipe for recipeId " + o)),
                t(e);
            var a = s.getItemSlot();
            m.setDraggable(a, {
                backgroundImage: a.image
            }, "recipeList", {
                selectRecipe: i,
                source: "recipeList"
            }),
            a.on("doubletap", i),
            t(null , n)
        })
    }
    ,
    n.prototype.filterCraftable = function(e) {
        this._filterCraftableOnly = e,
        this.filterRecipes()
    }
    ,
    n.prototype.filterRecipes = function() {
        for (var e = window.gui.playerData.inventory.quantityList, t = this.filterText.length, i = this.recipesList.getChildren(), n = 0, o = i.length; n < o; n += 1) {
            var s = i[n]
              , a = s.quantityList
              , r = !0;
            s.craftButton.enable();
            for (var l in a)
                if (!e[l] || e[l] < a[l]) {
                    s.craftButton.disable(),
                    this._filterCraftableOnly && (r = !1);
                    break
                }
            r && this.filterNbSlots[s.nbIngredients] ? t >= _ && s.searchString.indexOf(this.filterText) === -1 && (r = !1) : r = !1,
            s.toggleDisplay(r)
        }
        this.recipesWrapper.refresh()
    }
    ,
    n.prototype.highlightRecipe = function(e) {
        if (this.selectedRecipe && this.selectedRecipe.rootElement && this.selectedRecipe.delClassNames("selected"),
        null !== e) {
            var t = this.recipesList.getChild(e);
            t && (t.addClassNames("selected"),
            this.selectedRecipe = t)
        }
    }
    ,
    n.prototype.reset = function() {
        this.selectedRecipe = null ,
        this.tappedRecipe = null ,
        this._recipesPlaceholder.hide(),
        this.recipesList.hide(),
        this.recipesList.clearContent(),
        this.recipesWrapper.addClassNames("spinner"),
        this.filterNbSlots = {},
        this.filterText = "",
        this.searchInput.setValue(""),
        this._showCraftableCheckbox.deactivate()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        var i = this;
        l.call(this, "div", {
            className: "RecipeBox",
            name: e.resultId
        }),
        t = t || {},
        this.rawRecipe = e,
        this.isMain = t.isMain,
        this.nbCases = t.nbCases || 0;
        var n = i.createChild("div", {
            className: "recipeTitle"
        });
        this._item = n.appendChild(new a),
        this._recipeLeft = n.createChild("div", {
            className: "recipeLeft"
        }),
        this._recipeLeft.createChild("div", {
            className: "recipeName",
            text: e.resultNameId
        });
        var s = n.createChild("div", {
            className: "recipeRight"
        });
        s.createChild("div", {
            className: "recipeLevel",
            text: o("ui.common.short.level") + " " + e.resultLevel
        });
        var r = e.ingredientIds.length
          , u = t.nbCases - r >= 4
          , d = u ? 0 : h[r]
          , p = s.createChild("div", {
            className: "recipeXP",
            text: o("ui.tooltip.monsterXpAlone", d)
        });
        u && p.addClassNames("warningText"),
        this._ingredientsList = i.createChild("div", {
            className: "ingredientsList"
        }),
        this.craftButton = this._ingredientsList.appendChild(new c({
            className: "recipeButton",
            scaleOnPress: !0
        })),
        this.craftButton.on("tap", function() {
            i.emit("craftButtonTapped")
        })
    }
    i(759);
    var o = i(35).getText
      , s = i(323)
      , a = i(567)
      , r = i(26).inherits
      , l = i(190)
      , c = i(204)
      , u = i(210).simplifyString
      , h = {
        1: 1,
        2: 10,
        3: 25,
        4: 50,
        5: 100,
        6: 250,
        7: 500,
        8: 1e3
    };
    r(n, l),
    e.exports = n,
    n.prototype.setupRecipe = function(e) {
        function t() {
            i.emit("itemTapped", this.dbItem)
        }
        var i = this
          , n = this.rawRecipe
          , o = window.gui.playerData.inventory
          , r = n.resultId
          , l = [r].concat(n.ingredientIds)
          , c = n.ingredientIds.length;
        s.getItems(l, function(l) {
            if (l)
                return console.error(l),
                e(l);
            var h = s.items[r];
            if (!h)
                return e();
            i._item.setItem(h),
            i._item.on("tap", t),
            i._recipeLeft.createChild("div", {
                className: "recipeSkillName",
                text: h.nameId
            });
            for (var d = h.nameId, p = {}, m = 0; m < c; m += 1) {
                var f = s.items[n.ingredientIds[m]];
                if (f) {
                    d += " " + f.nameId;
                    var g = n.quantities[m]
                      , _ = null ;
                    if (i.isMain) {
                        var v = o.getGenericItemCount(f.id);
                        _ = v >= g ? "quantityGood" : "quantityNoGood",
                        g = v + "/" + g
                    }
                    var y = new a({
                        itemData: f,
                        quantity: g,
                        forceQuantity: !0
                    });
                    _ && y.addClassNames(_),
                    i._ingredientsList.appendChild(y),
                    y.on("tap", t),
                    p[f.id] = g
                }
            }
            return i.nbIngredients = c,
            i.searchString = u(d),
            i.quantityList = p,
            e(null , i)
        })
    }
    ,
    n.prototype.getItemSlot = function() {
        return this._item
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this, {
            title: s("ui.zaap.prism"),
            className: "PrismVulnerabilityDateWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 400,
                height: 256
            }
        });
        var e, t, i, n, o, p, m, f, g;
        this.once("open", function() {
            e = this.windowBody.createChild("div", {
                className: "subAreaName"
            }),
            t = this.windowBody.createChild("div", {
                className: "explanation"
            });
            var r = this.windowBody.createChild("div", {
                className: "selectorBox"
            });
            i = r.appendChild(new a({
                className: "hours"
            })),
            i.on("change", function(e) {
                f = e
            });
            for (var c = 0; c < 10; c += 1)
                i.addOption("0" + c, c);
            for (c = 10; c < 24; c += 1)
                i.addOption(c, c);
            n = r.appendChild(new a({
                className: "minutes"
            })),
            n.on("change", function(e) {
                g = e
            }),
            n.addOption("00", d[0]),
            n.addOption("30", d[30]);
            var _ = this
              , v = this.windowBody.createChild("div", {
                className: "buttonBox"
            });
            o = v.appendChild(new l(s("ui.common.save"))),
            o.on("tap", function() {
                var e = u.time.timezoneOffset
                  , t = e / 1e3 * 60 % 60
                  , i = e / 36e5 % 24
                  , n = 4 * (f - i) + (g - t);
                n < 0 && (n += 96),
                window.dofus.sendMessage("PrismSettingsRequestMessage", {
                    subAreaId: m.subAreaId,
                    startDefenseTime: n
                }),
                h.close(_.id)
            }),
            p = v.appendChild(new l(s("ui.common.cancel"))),
            p.on("tap", function() {
                h.close(_.id)
            })
        }),
        this.on("open", function(o) {
            m = o.prism;
            var a = o.vulnerableTime.getServerDate()
              , l = a.toString()
              , c = m.enrichData;
            e.setText(c.subAreaName + " (" + c.areaName + ")");
            var u = window.gui.serversData.sessionConstants[r.SERVER_CONST_KOH_DURATION];
            t.setText(s("ui.prism.vulnerabilityHourInfos", Math.round(u / 1e3 / 360) / 10, l.hour, l.minute)),
            i.select(a.hour),
            n.select(d[a.minute] || d[0])
        })
    }
    i(761);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(393)
      , r = i(481).serverConstants
      , l = i(204).DofusButton
      , c = i(402)
      , u = i(211)
      , h = i(22)
      , d = {
        0: 0,
        30: 2
    };
    o(n, c),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, {
            className: "SocialGroupCreationWindow",
            title: "",
            positionInfo: {
                left: "c",
                top: "c",
                width: "80%",
                height: "90%"
            }
        });
        var e = this;
        this._isModeratorOrMore = !1,
        this.once("open", function() {
            e.addClassNames("spinner"),
            e.windowBody.hide(),
            e._createDom(),
            b.preloadImage("ui/slot.png", function(t) {
                e.slotIconImage = t
            }),
            f.getAllDataTable(["EmblemSymbolCategories", "EmblemSymbols", "EmblemBackgrounds"], function(t, i) {
                return t ? console.error("SocialGroupCreationWindow: Failed to retrieve emblem data", t) : (e.emblemBackgrounds = i.EmblemBackgrounds,
                e.emblemSymbols = i.EmblemSymbols,
                e.emblemSymbolCategories = i.EmblemSymbolCategories,
                e._generateSelectorOptions(),
                e._displayEmblemBackgrounds(i.EmblemBackgrounds),
                e._displayEmblemSymbols(i.EmblemSymbols),
                e._setupUI(),
                e.delClassNames("spinner"),
                e.windowBody.show(),
                e._updateUISize(),
                e.on("open", function() {
                    e.addClassNames("spinner"),
                    e._generateSelectorOptions(),
                    e.windowBody.hide(),
                    e.tabs.openTab("background"),
                    e._setupUI(),
                    e.delClassNames("spinner"),
                    e.windowBody.show()
                }),
                void e.on("opened", function() {
                    e._updateUISize()
                }))
            })
        });
        var t = window.gui;
        t.on("GuildCreationStartedMessage", function() {
            e.mode = "guild",
            e.modification = !1,
            u.openDialog(e.id)
        }),
        t.on("GuildModificationStartedMessage", function(t) {
            e.mode = "guild",
            t.canChangeName && t.canChangeEmblem ? e.modification = "all" : t.canChangeName ? e.modification = "name" : e.modification = "emblem",
            u.openDialog(e.id)
        }),
        t.on("AllianceCreationStartedMessage", function() {
            e.mode = "alliance",
            e.modification = !1,
            u.openDialog(e.id)
        }),
        t.on("AllianceModificationStartedMessage", function(t) {
            e.mode = "alliance",
            t.canChangeName && t.canChangeEmblem && t.canChangeTag ? e.modification = "all" : t.canChangeName ? e.modification = "name" : e.modification = "emblem",
            u.openDialog(e.id)
        })
    }
    function o(e, t, i, n) {
        var o = e.length;
        return !(o < t || o > i) || (window.gui.openSimplePopup(c(n, t, i)),
        !1)
    }
    i(763);
    var s = i(206).addTooltip
      , a = i(26).inherits
      , r = i(402)
      , l = i(35).getText
      , c = i(35).processText
      , u = i(22)
      , h = i(393)
      , d = i(204).DofusButton
      , p = i(515)
      , m = i(391)
      , f = i(36)
      , g = i(204)
      , _ = i(302)
      , v = i(509)
      , y = i(289)
      , w = i(212)
      , b = i(5)
      , C = i(190)
      , I = 250
      , T = 110
      , S = 20;
    a(n, r),
    e.exports = n,
    n.prototype._setupUI = function() {
        if ("alliance" === this.mode ? (this.tagNameBox.show(),
        this.tagInput.show(),
        this.nameLabel.setText(l("ui.alliance.name") + l("ui.common.colon")),
        this.setTitle(l("ui.alliance.creation"))) : (this.tagNameBox.hide(),
        this.tagInput.hide(),
        this.nameLabel.setText(l("ui.social.guildName") + l("ui.common.colon")),
        this.setTitle(l("ui.social.guildCreation"))),
        !this.modification)
            return this._generateRandomEmblem(),
            this.nameInput.enable(),
            this.nameInput.setValue(""),
            this.tagInput.enable(),
            this.tagInput.setValue(""),
            void this.cover.hide();
        var e = window.gui.playerData[this.mode].current;
        switch ("alliance" === this.mode ? (this.nameInput.setValue(e.allianceName),
        this.tagInput.setValue(e.allianceTag),
        this._setEmblem(e.allianceEmblem)) : (this.nameInput.setValue(e.guildName),
        this._setEmblem(e.guildEmblem)),
        this.modification) {
        case "all":
            this.nameInput.enable(),
            this.tagInput.enable(),
            this.cover.hide();
            break;
        case "name":
            this.nameInput.enable(),
            this.tagInput.enable(),
            this.cover.show();
            break;
        case "emblem":
            this.nameInput.disable(),
            this.tagInput.disable(),
            this.cover.hide()
        }
    }
    ,
    n.prototype._setEmblem = function(e) {
        this.emblem.setValue(e, !0),
        this.bgColor = e.backgroundColor,
        this.bgId = e.backgroundShape,
        this.symbolColor = e.symbolColor,
        this.symbolId = e.symbolShape,
        this.selector.select(this.emblemSymbols[e.symbolShape].categoryId)
    }
    ,
    n.prototype._generateSelectorOptions = function() {
        if (this.emblemSymbolCategories) {
            this.selector.clearContent(),
            this._isModeratorOrMore = window.gui.playerData.isModeratorOrMore();
            for (var e = 0; e < this.emblemSymbolCategories.length; e++) {
                var t = this.emblemSymbolCategories[e];
                (this._isModeratorOrMore || 13 !== t.id) && this.selector.addOption(t.nameId, t.id)
            }
            this.selector.select(1)
        }
    }
    ,
    n.prototype._generateRandomEmblem = function() {
        this.bgColorPicker.generateRandomColor(),
        this.motifColorPicker.generateRandomColor();
        var e = Math.round(Math.random() * (this.emblemBackgrounds.length - 1))
          , t = Math.round(Math.random() * (this.emblemSymbols.length - (this._isModeratorOrMore ? 2 : 1)));
        this._setBackgroundShape(this.emblemBackgrounds[e].id),
        this._setSymbolShape(this.emblemSymbols[t].iconId)
    }
    ,
    n.prototype._setBackgroundShape = function(e) {
        this.emblem.setValue({
            backgroundShape: e
        }),
        this.bgId = e
    }
    ,
    n.prototype._setSymbolShape = function(e) {
        this.emblem.setValue({
            symbolShape: e
        }),
        this.symbolId = e
    }
    ,
    n.prototype._displayEmblemBackgrounds = function(e) {
        function t() {
            i._setBackgroundShape(this.id)
        }
        for (var i = this, n = [], o = 0; o < e.length; o++)
            n.push("gfx/emblems/icons/back/" + e[o].id + ".png");
        b.preloadImages(n, function(n) {
            for (var o = 0; o < n.length; o++) {
                var s = i.backgroundScroller.content.appendChild(new g({
                    className: "icon"
                },t));
                s.setStyle("backgroundImage", n[o] + ", " + i.slotIconImage),
                s.id = e[o].id
            }
            i.backgroundScroller.refresh()
        })
    }
    ,
    n.prototype._displayEmblemSymbols = function(e) {
        function t() {
            i._setSymbolShape(this.id)
        }
        var i = this
          , n = [];
        i.notColorizable = [];
        for (var o = 0; o < e.length; o++)
            n.push("gfx/emblems/icons/up/" + e[o].iconId + ".png"),
            e[o].colorizable || i.notColorizable.push(e[o].id);
        b.preloadImages(n, function(n) {
            for (var o = 0; o < n.length; o++) {
                var s = i.symbolScroller.content.appendChild(new g({
                    className: ["icon", "white"]
                },t));
                s.setStyle("backgroundImage", n[o] + ", " + i.slotIconImage),
                s.categoryId = e[o].categoryId,
                s.id = e[o].id
            }
            i.selector.select(1)
        })
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            i.bgColor !== e.hex.substr(1) && (i.bgColor = parseInt(e.hex.substr(1), 16),
            i.emblem.setValue({
                backgroundColor: e.rgb
            }))
        }
        function t(e) {
            i.symbolColor !== e.hex.substr(1) && (i.symbolColor = parseInt(e.hex.substr(1), 16),
            i.notColorizable.indexOf(i.symbolId) === -1 && i.emblem.setValue({
                symbolColor: e.rgb
            }))
        }
        var i = this
          , n = this.windowBody.createChild("div", {
            className: "guildNameBox"
        });
        this.nameLabel = n.createChild("div", {
            className: "label"
        });
        var a = n.createChild("div", {
            className: "info"
        });
        s(a, l("ui.social.nameRules"), {
            openOnTap: !0
        });
        var r = this.nameInput = this.windowBody.appendChild(new m({
            className: "socialInputBox",
            attr: {
                type: "text",
                maxlength: 30
            }
        }))
          , c = this.tagNameBox = this.windowBody.createChild("div", {
            className: "tagNameBox"
        });
        c.createChild("div", {
            className: "label",
            text: l("ui.alliance.tagInfo") + l("ui.common.colon")
        }),
        a = c.createChild("div", {
            className: "info"
        }),
        s(a, l("ui.alliance.tagRules"), {
            openOnTap: !0
        });
        var u = this.tagInput = this.windowBody.appendChild(new m({
            className: "socialInputBox",
            attr: {
                type: "text",
                maxlength: 30
            }
        }));
        this.emblem = this.windowBody.appendChild(new y),
        this.windowBody.createChild("div", {
            className: "text",
            text: l("ui.social.createEmblem") + l("ui.common.colon")
        });
        var f = this.tabs = this.windowBody.appendChild(new v);
        this.cover = f.content.createChild("div", {
            className: "cover"
        });
        var g = new C("div",{
            className: "backgroundTab"
        })
          , b = new C("div",{
            className: "motifTab"
        });
        f.addTab(l("ui.social.emblemBack"), g, "background"),
        f.addTab(l("ui.social.emblemUp"), b, "motif"),
        f.openTab("background"),
        this.backgroundScroller = g.appendChild(new _({
            className: "iconScroller"
        })),
        this.bgColorPicker = g.appendChild(new p({
            tintWidth: I,
            tintHeight: T,
            lumWidth: S
        })),
        this.bgColorPicker.on("colorChanged", e),
        this.bgColorPicker.on("newColor", e);
        var A = b.createChild("div", {
            className: "motifContainer"
        });
        this.selector = A.appendChild(new h),
        this.selector.on("change", function(e) {
            var t = i.symbolScroller.content.getChildren();
            e = parseInt(e, 10);
            for (var n = 0; n < t.length; n++)
                e !== t[n].categoryId ? t[n].hide() : t[n].show();
            i.symbolScroller.refresh()
        }),
        this.symbolScroller = A.appendChild(new _({
            className: "iconScroller"
        })),
        b.once("opened", function() {
            i.symbolScroller.refresh()
        }),
        this.motifColorPicker = b.appendChild(new p({
            tintWidth: I,
            tintHeight: T,
            lumWidth: S
        })),
        this.motifColorPicker.on("colorChanged", t),
        this.motifColorPicker.on("newColor", t);
        var E = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , x = E.appendChild(new d(l("ui.common.validation")));
        x.on("tap", function() {
            var e = r.getValue()
              , t = {
                symbolShape: i.symbolId,
                symbolColor: i.symbolColor,
                backgroundShape: i.bgId,
                backgroundColor: i.bgColor
            };
            if ("alliance" === i.mode) {
                if (!o(e, w.MIN_ALLIANCENAME_LEN, w.MAX_ALLIANCENAME_LEN, l("ui.alliance.invalidLengthName")))
                    return;
                var n = u.getValue();
                if (!o(n, w.MIN_ALLIANCETAG_LEN, w.MAX_ALLIANCETAG_LEN, l("ui.alliance.invalidLengthTag")))
                    return;
                if (!i.modification)
                    return window.dofus.sendMessage("AllianceCreationValidMessage", {
                        allianceName: e,
                        allianceTag: n,
                        allianceEmblem: t
                    });
                switch (i.modification) {
                case "all":
                    window.dofus.sendMessage("AllianceModificationValidMessage", {
                        allianceName: e,
                        allianceTag: n,
                        Alliancemblem: t
                    });
                    break;
                case "emblem":
                    window.dofus.sendMessage("AllianceModificationEmblemValidMessage", {
                        Alliancemblem: t
                    });
                    break;
                case "name":
                    window.dofus.sendMessage("AllianceModificationNameAndTagValidMessage", {
                        allianceName: e,
                        allianceTag: n
                    })
                }
            } else {
                if (!o(e, w.MIN_GUILDNAME_LEN, w.MAX_GUILDNAME_LEN, l("ui.alliance.invalidLengthName")))
                    return;
                if (!i.modification)
                    return window.dofus.sendMessage("GuildCreationValidMessage", {
                        guildName: e,
                        guildEmblem: t
                    });
                switch (i.modification) {
                case "all":
                    window.dofus.sendMessage("GuildModificationValidMessage", {
                        guildName: e,
                        guildEmblem: t
                    });
                    break;
                case "emblem":
                    window.dofus.sendMessage("GuildModificationEmblemValidMessage", {
                        guildEmblem: t
                    });
                    break;
                case "name":
                    window.dofus.sendMessage("GuildModificationNameValidMessage", {
                        guildName: e
                    })
                }
            }
        })
    }
    ,
    n.prototype._updateUISize = function() {
        var e = this.bgColorPicker.rootElement.clientHeight
          , t = this.bgColorPicker.rootElement.clientWidth;
        0 !== e && 0 !== t && (this.bgColorPicker.updateDimensions(t, e, S),
        this.motifColorPicker.updateDimensions(t, e, S))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        h.call(this, {
            className: "AllianceCardWindow",
            positionInfo: {
                top: "c",
                left: "c",
                width: 400,
                height: 380
            }
        }),
        this.once("open", function() {
            this._createDom()
        }),
        this.on("open", function(e) {
            this._setAlliance(e)
        })
    }
    function o(e) {
        var t = new a({
            width: 25,
            height: 25
        });
        t.setValue(e.guildEmblem, !0);
        var i = new d("div",{
            text: e.guildName
        });
        return m(i),
        i.on("tap", function() {
            r.openGuildCard(e.guildId)
        }),
        [t, i, e.guildLevel]
    }
    i(765);
    var s = i(211).DofusDate
      , a = i(289)
      , r = i(339)
      , l = i(35).getText
      , c = i(26).inherits
      , u = i(485)
      , h = i(402)
      , d = i(190)
      , p = i(22)
      , m = i(32);
    c(n, h),
    n.prototype._createDom = function() {
        var e = this.windowBody.createChild("div", {
            className: "description"
        });
        this.emblem = e.appendChild(new a({
            width: 70,
            height: 70
        }));
        var t = e.createChild("div", {
            className: "labelBox"
        });
        t.createChild("div", {
            className: "label",
            text: l("ui.alliance.tag") + l("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: l("ui.social.guilds") + l("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: l("ui.common.members") + l("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: l("ui.common.creationDate") + l("ui.common.colon")
        });
        var i = e.createChild("div", {
            className: "valueBox"
        });
        this.tag = i.createChild("div", {
            className: "value"
        }),
        this.guilds = i.createChild("div", {
            className: "value"
        }),
        this.members = i.createChild("div", {
            className: "value"
        }),
        this.creationDate = i.createChild("div", {
            className: "value"
        }),
        this.prisms = this.windowBody.createChild("div", {
            className: "prisms"
        }),
        this.guildList = this.windowBody.appendChild(new u({
            colCount: 3,
            headerContent: ["", l("ui.common.name"), l("ui.common.level")]
        }))
    }
    ,
    n.prototype.display = function(e) {
        this.openState ? (this._setAlliance(e),
        p.focusWindow("allianceCard")) : p.open("allianceCard", e)
    }
    ,
    n.prototype._setAlliance = function(e) {
        var t = e.infos
          , i = e.guilds;
        this.setTitle(l("ui.common.alliance") + " - " + t.allianceName),
        this.emblem.setValue(t.allianceEmblem, !0),
        this.tag.setText("[" + t.allianceTag + "]"),
        this.guilds.setText(i.length);
        var n = new s(t.creationDate).getServerDate().toString(!0);
        this.creationDate.setText(n.day + " " + n.monthName + " " + n.year),
        this.prisms.setText(l("ui.prism.nbPrisms", e.controlledSubareaIds.length)),
        this.guildList.clearContent();
        for (var a = 0, r = 0, c = i.length; r < c; r += 1) {
            var u = i[r];
            a += u.nbMembers,
            this.guildList.addRow(o(u))
        }
        this.members.setText(a)
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        d.call(this, {
            className: "GuildCardWindow",
            positionInfo: {
                top: "c",
                left: "c",
                width: 400,
                height: 380
            }
        }),
        this.once("open", function() {
            this._createDom()
        }),
        this.on("open", function(e) {
            this._setGuild(e)
        })
    }
    function o(e) {
        var t = new p("div",{
            text: e.name
        });
        return f(t),
        t.on("tap", function() {
            window.gui.openContextualMenu("player", {
                playerName: e.name,
                playerId: e.id,
                hasGuild: !0
            })
        }),
        [t, e.level]
    }
    i(767);
    var s = i(423)
      , a = i(206).addTooltip
      , r = i(211).DofusDate
      , l = i(289)
      , c = i(35).getText
      , u = i(26).inherits
      , h = i(485)
      , d = i(402)
      , p = i(190)
      , m = i(22)
      , f = i(32);
    u(n, d),
    n.prototype._createDom = function() {
        var e = this.windowBody.createChild("div", {
            className: "description"
        });
        this.emblem = e.appendChild(new l({
            width: 70,
            height: 70
        }));
        var t = e.createChild("div", {
            className: "labelBox"
        });
        t.createChild("div", {
            className: "label",
            text: c("ui.common.level") + c("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: c("ui.guild.right.leader") + c("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: c("ui.common.members") + c("ui.common.colon")
        }),
        t.createChild("div", {
            className: "label",
            text: c("ui.common.creationDate") + c("ui.common.colon")
        });
        var i = this
          , n = e.createChild("div", {
            className: "valueBox"
        });
        this.level = n.createChild("div", {
            className: "value"
        }),
        this.leader = n.createChild("div", {
            className: ["value", "link"]
        }),
        f(this.leader),
        this.leader.on("tap", function() {
            window.gui.openContextualMenu("player", {
                playerName: i._leaderName,
                playerId: i._leaderId,
                hasGuild: !0
            })
        }),
        this.members = n.createChild("div", {
            className: "value"
        }),
        this.creationDate = n.createChild("div", {
            className: "value"
        }),
        this.perceptors = this.windowBody.createChild("div", {
            className: "perceptors"
        }),
        this.memberList = this.windowBody.appendChild(new h({
            colCount: 2,
            headerContent: [c("ui.common.name"), c("ui.common.level")]
        }));
        var o = this.windowBody.createChild("div", {
            className: "alliance"
        })
          , r = o.createChild("div", {
            className: "value"
        });
        this.allianceLabel = r.createChild("span"),
        this.allianceName = r.createChild("span", {
            className: "link"
        }),
        f(r),
        r.on("tap", function() {
            s.openAllianceCard(i._allianceId)
        }),
        this.allianceInvite = o.createChild("div", {
            className: "inviteBtn"
        }),
        this.allianceInviteTooltip = new p("div"),
        a(this.allianceInvite, this.allianceInviteTooltip),
        this.allianceInvite.on("tap", function() {
            window.dofus.sendMessage("AllianceInvitationMessage", {
                targetId: i._leaderId
            })
        })
    }
    ,
    n.prototype.display = function(e) {
        this.openState ? (this._setGuild(e),
        m.focusWindow("guildCard")) : m.open("guildCard", e)
    }
    ,
    n.prototype._setGuild = function(e) {
        var t = e.infos
          , i = e.members;
        this.setTitle(c("ui.common.guild") + " - " + t.guildName),
        this.emblem.setValue(t.guildEmblem, !0),
        this.level.setText(t.guildLevel),
        this.members.setText(t.nbMembers);
        var n = new r(e.creationDate).getServerDate().toString(!0);
        this.creationDate.setText(n.day + " " + n.monthName + " " + n.year),
        this._leaderId = t.leaderId,
        this._leaderName = i[0].name,
        this.leader.setText(this._leaderName),
        this.perceptors.setText(c("ui.guild.taxcollectorsCurrentlyCollecting", e.nbTaxCollectors, e.nbTaxCollectors)),
        this.memberList.clearContent();
        for (var s = 0, a = i.length; s < a; s += 1)
            this.memberList.addRow(o(i[s]));
        var l = e.allianceInfos;
        if (l)
            this.allianceLabel.setText(c("ui.common.alliance") + c("ui.common.colon")),
            this.allianceName.setText(l.allianceName),
            this._allianceId = l.allianceId,
            this.allianceInvite.hide();
        else {
            this.allianceLabel.setText(c("ui.alliance.noAllianceForThisGuild")),
            this.allianceName.setText("");
            var u = window.gui.playerData.alliance;
            this.allianceInviteTooltip.setText(c("ui.alliance.inviteLeader", this._leaderName)),
            this.allianceInvite.toggleDisplay(u.hasAlliance() && u.isBoss())
        }
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "guildHouseInfoWindow",
            positionInfo: {
                top: "c",
                left: "c",
                width: 450,
                height: 380
            }
        }),
        this.rights = [],
        this.rightsText = [a("ui.guildHouse.Right1"), a("ui.guildHouse.Right2"), a("ui.guildHouse.Right4"), a("ui.guildHouse.Right8"), a("ui.guildHouse.Right16"), a("ui.guildHouse.Right32"), a("ui.guildHouse.Right64"), a("ui.guildHouse.Right128"), a("ui.guildHouse.Right256")],
        this.setupDom(),
        this.on("open", this.open)
    }
    i(769);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(682)
      , l = i(485)
      , c = i(36)
      , u = 9;
    o(n, s),
    e.exports = n,
    n.prototype.setupDom = function() {
        this.tabs = this.windowBody.appendChild(new r({
            className: "tabs"
        }));
        var e = {
            colIds: ["content"],
            minRows: 10
        };
        this.rights = this.windowBody.appendChild(new l(e)),
        this.skills = this.windowBody.appendChild(new l(e)),
        this.tabs.addTab(a("ui.social.guildHouseRights"), this.rights),
        this.tabs.addTab(a("ui.common.abilities"), this.skills),
        this.tabs.openTab(0)
    }
    ,
    n.prototype.open = function(e) {
        var t, i = this, n = e.guildshareParams, o = e.skillListIds;
        for (this.windowTitle.setText(e.houseName),
        this.tabs.openTab(0),
        this.rights.clearContent(),
        this.skills.clearContent(),
        t = 0; t < u; t++)
            n >> t & 1 && this.rights.addRow({
                content: this.rightsText[t]
            });
        c.getData("Skills", o, function(e, n) {
            for (e && console.error("Failed to retrieve skills data", e),
            t = 0; t < n.length; t++)
                i.skills.addRow([n[t].nameId])
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "GuildHouseSettingWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 490
            }
        });
        var e = this;
        this.checkboxes = [],
        this.once("open", function() {
            e._setupDom(),
            e.setupSockets()
        }),
        this.on("open", function() {
            var t = window.gui.playerData.guild.current;
            t && e.emblemLogo.setValue({
                guild: t
            })
        })
    }
    i(771);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(448)
      , c = i(35).getText
      , u = i(289);
    o(n, s),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: ["container", "topContainer"]
        });
        this.emblemLogo = t.appendChild(new u({
            width: 100,
            height: 100
        }));
        var i = t.createChild("div", {
            className: "content"
        });
        this.checkboxes.push(i.appendChild(new l(c("ui.common.guildHouseEnabledForThisHouse")))),
        i.createChild("div", {
            className: "description",
            text: c("ui.common.guildHouseNotice")
        });
        var n = this.windowBody.createChild("div", {
            className: ["container", "bottomContainer"]
        })
          , o = n.createChild("div", {
            className: "wrapper"
        })
          , s = this.doorEmblem = o.createChild("div", {
            className: "section"
        });
        s.createChild("div", {
            className: "title",
            text: c("ui.common.guildHouseDisplayEmblemOnDoorTitle") + ":"
        }),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseDisplayEmblemForGuild")))),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseDisplayEmblemForOthers")))),
        s = this.houseAccess = o.createChild("div", {
            className: "section"
        }),
        s.createChild("div", {
            className: "title",
            text: c("ui.common.guildHouseHouseAccessTitle") + ":"
        }),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseAccessHouseAllowGuildmates")))),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseAccessHouseDenyOthers")))),
        s = this.chests = o.createChild("div", {
            className: "section"
        }),
        s.createChild("div", {
            className: "title",
            text: c("ui.common.guildHouseSafesAccessTitle") + ":"
        }),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseRight32")))),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseRight64")))),
        s = this.miscellaneous = o.createChild("div", {
            className: "section"
        }),
        s.createChild("div", {
            className: "title",
            text: c("ui.common.guildHouseOtherTitle") + ":"
        }),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseAllowRespawn")))),
        this.checkboxes.push(s.appendChild(new l(c("ui.common.guildHouseAllowTeleport"))));
        var h = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , d = h.appendChild(new r(c("ui.common.validation")));
        d.on("tap", function() {
            for (var t = 0, i = 0; i < e.checkboxes.length; i++)
                e.checkboxes[i].isActivate() && (t += 1 << i);
            var n = e.checkboxes[0].isActivate();
            window.dofus.sendMessage("HouseGuildShareRequestMessage", {
                enable: n,
                rights: t
            }),
            a.close(e.id)
        }),
        this.checkboxes[0].on("activate", function() {
            e.enableContainers()
        }),
        this.checkboxes[0].on("deactivate", function() {
            e.disableContainers()
        })
    }
    ,
    n.prototype.updateCheckboxes = function(e) {
        for (var t = 0; t < this.checkboxes.length; t++)
            e >> t & 1 ? this.checkboxes[t].activate() : this.checkboxes[t].deactivate()
    }
    ,
    n.prototype.enableContainers = function() {
        this.doorEmblem.delClassNames("disabled"),
        this.houseAccess.delClassNames("disabled"),
        this.chests.delClassNames("disabled"),
        this.miscellaneous.delClassNames("disabled");
        for (var e = 0; e < this.checkboxes.length; e++)
            this.checkboxes[e].enable()
    }
    ,
    n.prototype.disableContainers = function() {
        this.doorEmblem.addClassNames("disabled"),
        this.houseAccess.addClassNames("disabled"),
        this.chests.addClassNames("disabled"),
        this.miscellaneous.addClassNames("disabled");
        for (var e = 1; e < this.checkboxes.length; e++)
            this.checkboxes[e].disable()
    }
    ,
    n.prototype.setupSockets = function() {
        var e = this;
        window.gui.on("HouseGuildRightsMessage", function(t) {
            e.windowTitle.setText(c("ui.common.houseOwnerName", t.guildInfo.guildName));
            var i = t.guildInfo.guildEmblem;
            e.emblemLogo.setValue(i, !0),
            e.updateCheckboxes(t.rights),
            e.enableContainers()
        }),
        window.gui.on("HouseGuildNoneMessage", function() {
            for (var t = 0; t < e.checkboxes.length; t++)
                e.checkboxes[t].deactivate();
            e.disableContainers()
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            t.windowTitle.setText(e.name + " - " + a("ui.common.short.level") + " " + e.level),
            t._updateContent(e)
        }
        var t = this;
        o.call(this, {
            className: "GuildMemberRightsWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 450,
                height: 490
            }
        }),
        this.rightCheckboxes = [],
        this.rightNames = [{
            right: m.GUILD_RIGHT_BOSS,
            label: a("ui.social.guildRightsAllRights")
        }, {
            right: m.GUILD_RIGHT_MANAGE_GUILD_BOOSTS,
            label: a("ui.social.guildRightsBoost")
        }, {
            right: m.GUILD_RIGHT_MANAGE_RIGHTS,
            label: a("ui.social.guildRightsRights")
        }, {
            right: m.GUILD_RIGHT_INVITE_NEW_MEMBERS,
            label: a("ui.social.guildRightsInvit")
        }, {
            right: m.GUILD_RIGHT_BAN_MEMBERS,
            label: a("ui.social.guildRightsBann")
        }, {
            right: m.GUILD_RIGHT_MANAGE_XP_CONTRIBUTION,
            label: a("ui.social.guildRightsPercentXP")
        }, {
            right: m.GUILD_RIGHT_MANAGE_MY_XP_CONTRIBUTION,
            label: a("ui.social.guildRightManageOwnXP")
        }, {
            right: m.GUILD_RIGHT_MANAGE_RANKS,
            label: a("ui.social.guildRightsRank")
        }, {
            right: m.GUILD_RIGHT_DEFENSE_PRIORITY,
            label: a("ui.social.guildRightsPrioritizeMe")
        }, {
            right: m.GUILD_RIGHT_HIRE_TAX_COLLECTOR,
            label: a("ui.social.guildRightsHiretax")
        }, {
            right: m.GUILD_RIGHT_COLLECT,
            label: a("ui.social.guildRightsCollect")
        }, {
            right: m.GUILD_RIGHT_COLLECT_MY_TAX_COLLECTOR,
            label: a("ui.social.guildRightsCollectMy")
        }, {
            right: m.GUILD_RIGHT_USE_PADDOCKS,
            label: a("ui.social.guildRightsMountParkUse")
        }, {
            right: m.GUILD_RIGHT_ORGANIZE_PADDOCKS,
            label: a("ui.social.guildRightsMountParkArrange")
        }, {
            right: m.GUILD_RIGHT_TAKE_OTHERS_MOUNTS_IN_PADDOCKS,
            label: a("ui.social.guildRightsManageOtherMount")
        }, {
            right: m.GUILD_RIGHT_SET_ALLIANCE_PRISM,
            label: a("ui.social.guildRightsSetAlliancePrism")
        }, {
            right: m.GUILD_RIGHT_TALK_IN_ALLIANCE_CHAN,
            label: a("ui.social.guildRightsTalkInAllianceChannel")
        }],
        this.minXpGivenPercentage = 0,
        this.maxXpGivenPercentage = 90,
        this.once("open", function(i) {
            var n = []
              , o = window.gui.databases.RankNames;
            for (var s in o)
                n.push(o[s]);
            u.sortObjectInArray(n, "order"),
            t.rankNames = n,
            t._setupDom(),
            e(i),
            this.on("open", e)
        })
    }
    i(773);
    var o = i(402)
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(204).DofusButton
      , l = i(448)
      , c = i(393)
      , u = i(210)
      , h = i(485)
      , d = i(201)
      , p = i(22)
      , m = i(339).GuildRightsBitEnum;
    s(n, o),
    e.exports = n,
    n.prototype._updateContent = function(e) {
        var t = this.selector;
        if (t) {
            var i = this.rank
              , n = window.gui.playerData
              , o = n.guild
              , s = e.id === n.id
              , a = e.id === o.current.leaderId
              , r = n.id === o.current.leaderId
              , l = !s && !a;
            this.memberInfo = {
                memberId: e.id,
                experienceGivenPercent: e.experienceGivenPercent,
                name: e.name,
                rank: e.rank
            },
            t.toggleOption(0, r),
            t.setValue(e.rank),
            i.setText(window.gui.databases.RankNames[e.rank].nameId),
            this.xpContributionLabel.setText(e.experienceGivenPercent + "%");
            for (var c, u = o.checkRight(m.GUILD_RIGHT_BOSS, e.rights), h = o.hasRight(m.GUILD_RIGHT_MANAGE_RIGHTS), d = 0; d < this.rightNames.length; d++) {
                var p = this.rightNames[d].right;
                c = this.rightCheckboxes[d],
                c && (a || u || o.checkRight(p, e.rights) ? c.activate() : c.deactivate(),
                c.disable(),
                (p !== m.GUILD_RIGHT_MANAGE_RIGHTS || r) && (r || h && l && o.hasRight(p)) && c.enable())
            }
            if (this.setXpButton.disable(),
            (o.hasRight(m.GUILD_RIGHT_MANAGE_XP_CONTRIBUTION) || o.hasRight(m.GUILD_RIGHT_MANAGE_MY_XP_CONTRIBUTION)) && this.setXpButton.enable(),
            !a && o.hasRight(m.GUILD_RIGHT_MANAGE_RANKS) || u)
                return t.show(),
                i.hide(),
                void this.rankTitleText.delClassNames("noMargin");
            t.hide(),
            i.show(),
            this.rankTitleText.addClassNames("noMargin")
        }
    }
    ,
    n.prototype._setupDom = function() {
        var e, t, i = this, n = this.windowBody.createChild("div", {
            className: "upperPanel"
        }), o = n.createChild("div", {
            className: "container"
        });
        this.rankTitleText = o.createChild("div", {
            className: "text",
            text: a("ui.social.guildRank")
        }),
        this.rank = o.createChild("div", {
            className: "rank"
        }),
        this.selector = o.appendChild(new c);
        var s = this.rankNames;
        for (e = 0,
        t = s.length; e < t; e += 1)
            this.selector.addOption(s[e].nameId, s[e].id);
        this.selector.on("change", function(e, t) {
            return 1 === parseInt(e, 10) ? window.gui.openConfirmPopup({
                title: a("ui.popup.warning"),
                message: a("ui.social.doUGiveRights", i.memberInfo.name),
                cb: function(n) {
                    return n ? void (i.memberInfo.rank = e) : void i.selector.setValue(t)
                }
            }) : void (i.memberInfo.rank = e)
        });
        var u = n.createChild("div", {
            className: ["container", "XpToGuild"]
        });
        u.createChild("div", {
            className: "text",
            text: a("ui.social.percentXpFull")
        }),
        this.setXpButton = u.appendChild(new r("",{
            className: "setXpButton"
        }));
        var m = u.appendChild(new d);
        m.on("confirm", function(e) {
            i.xpContributionLabel.setText(e + "%"),
            i.memberInfo.experienceGivenPercent = e
        }),
        this.setXpButton.on("tap", function() {
            m.open({
                min: i.minXpGivenPercentage,
                max: i.maxXpGivenPercentage,
                defaultValue: parseInt(i.xpContributionLabel.getText(), 10)
            })
        }),
        this.xpContributionLabel = u.createChild("div", {
            className: "xpLabel",
            text: "0%"
        });
        for (var f = this.windowBody.appendChild(new h({
            colIds: ["name", "checkbox"]
        })), g = 0; g < this.rightNames.length; g++) {
            var _ = this.rightNames[g]
              , v = new l("");
            this.rightCheckboxes.push(v),
            f.addRow({
                name: _.label,
                checkbox: v
            })
        }
        var y = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , w = y.appendChild(new r(a("ui.common.validation")));
        w.on("tap", function() {
            i.memberInfo.rights = i.getRightsMask(),
            window.dofus.sendMessage("GuildChangeMemberParametersMessage", i.memberInfo),
            p.close(i.id)
        }),
        this.on("close", function() {
            m.hide()
        })
    }
    ,
    n.prototype.getRightsMask = function() {
        for (var e = 0, t = 0; t < this.rightNames.length; t++) {
            var i = this.rightCheckboxes[t];
            i && i.isActivate() && (e += this.rightNames[t].right)
        }
        return e
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "houseBuySellWindow",
            title: "house",
            positionInfo: {
                left: "c",
                top: "c",
                width: 450,
                height: 335
            }
        });
        var e = this;
        this.currency = g,
        this.once("open", function() {
            var t = this.windowBody.createChild("div", {
                className: "container"
            })
              , i = t.createChild("div", {
                className: "imageContainer"
            });
            e.image = i.createChild("div", {
                className: "image"
            }),
            e.image.setStyle("backgroundImage", e.imageUrl),
            e.title = t.createChild("div", {
                className: ["text", "title"],
                text: e.titleText
            }),
            e.description = t.createChild("div", {
                className: ["text", "description"],
                text: e.descriptionText
            });
            var n = this.windowBody.createChild("div", {
                className: "priceContainer"
            });
            n.createChild("div", {
                className: "priceText",
                text: u("ui.common.price") + u("ui.common.colon")
            }),
            e.price = n.appendChild(new r({
                title: u("ui.common.price")
            })),
            e.currencyIcon = n.createChild("div", {
                className: ["currencyIcon", "soft"]
            }),
            e.price.on("change", function(t) {
                e.proposedPrice = t
            });
            var o = this.windowBody.createChild("div", {
                className: "footer"
            });
            e.cancelSaleButton = o.appendChild(new a(u("ui.common.cancelTheSale"),{
                className: "cancelSaleButton"
            })),
            e.confirmButton = o.appendChild(new a(u("ui.common.validation"),{
                className: "confirmButton"
            })),
            e.switchButton = o.appendChild(new p),
            e.switchButton.on("switchToHard", function() {
                e._setCurrency(_),
                e.updateDisplay(e.houseInfo)
            }),
            e.switchButton.on("switchToSoft", function() {
                e._setCurrency(g),
                e.updateDisplay(e.houseInfo)
            }),
            e.cancelSaleButton.on("tap", function() {
                if (!e.houseInfo || !e.houseInfo.buyOrSell)
                    return e.fromInside ? (window.dofus.sendMessage("HouseSellFromInsideRequestMessage", {
                        amount: 0
                    }),
                    void l.close(e.id)) : void window.dofus.sendMessage("HouseSellRequestMessage", {
                        amount: 0
                    })
            }),
            e.confirmButton.on("tap", function() {
                if (e.houseInfo && e.houseInfo.buyOrSell) {
                    var t;
                    return t = e.currency === _ ? u("tablet.price.hard", e.price.getFormattedValue()) : u("tablet.price.soft", e.price.getFormattedValue()),
                    window.gui.openConfirmPopup({
                        title: u("ui.common.housePurchase"),
                        message: u("tablet.ui.common.doUBuyHouse", e.houseOwner, t),
                        cb: function(t) {
                            if (t) {
                                if (e.currency === g)
                                    return window.dofus.sendMessage("HouseBuyRequestMessage", {
                                        proposedPrice: e.proposedPrice
                                    });
                                var i = e.proposedPriceHard - window.gui.playerData.inventory.goultines;
                                return i > 0 ? f.openNotEnoughHardCurrencyPopup(i) : window.dofus.send("houseBuyRequest", {
                                    houseId: e.houseInfo.purchasableId,
                                    amountHard: e.proposedPriceHard,
                                    amountSoft: e.proposedPrice
                                })
                            }
                        }
                    }, {
                        isModal: !0
                    })
                }
                return e.fromInside ? (window.dofus.sendMessage("HouseSellFromInsideRequestMessage", {
                    amount: e.proposedPrice
                }),
                void l.close(e.id)) : void window.dofus.sendMessage("HouseSellRequestMessage", {
                    amount: e.proposedPrice
                })
            })
        }),
        this.on("open", function(t) {
            return t = t || {},
            e.fromInside = t.fromInside,
            e.switchButton.setCurrency(g),
            e.fromInside ? void e.fromInsideUpdateDisplay(t.myHouse) : void e.updateDisplay(t.msg)
        }),
        this.setupSocketEvents()
    }
    i(775);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204).DofusButton
      , r = i(208)
      , l = i(22)
      , c = i(210)
      , u = i(35).getText
      , h = i(36)
      , d = i(5)
      , p = i(776)
      , m = i(548)
      , f = i(633)
      , g = "soft"
      , _ = "hard";
    o(n, s),
    e.exports = n,
    n.prototype.setupSocketEvents = function() {
        var e = this
          , t = window.gui
          , i = window.dofus.connectionManager;
        t.on("PurchasableDialogMessage", function(t) {
            l.openDialog(e.id, {
                fromInside: !1,
                msg: t
            })
        }),
        t.on("HouseBuyResultMessage", function(i) {
            i.bought ? t.openPopup({
                title: u("ui.popup.information"),
                message: u("ui.common.houseBuy", e.houseOwner, c.kamasToString(i.realPrice, ""))
            }) : t.openPopup({
                title: u("ui.popup.information"),
                message: u("ui.common.cantBuyHouse", c.kamasToString(i.realPrice, ""))
            })
        }),
        t.on("HouseSoldMessage", function(e) {
            if (t.playerData.identification.nickname === e.buyerName) {
                var i = u("ui.house.homeOf", e.buyerName);
                0 === e.realPrice ? t.openPopup({
                    title: u("ui.popup.information"),
                    message: u("ui.common.houseNosell", "'" + i + "'")
                }) : t.openPopup({
                    title: u("ui.popup.information"),
                    message: u("ui.common.houseSell", "'" + i + "'", c.kamasToString(e.realPrice, ""))
                })
            }
        }),
        m.on("computedHardPricesChange", function() {
            e.currency === _ && e.updateDisplay(e.houseInfo)
        }),
        i.on("houseBuyError", function() {
            this.send("moneyGoultinesAmountRequest")
        }),
        i.on("houseBuySuccess", function() {
            this.send("moneyGoultinesAmountRequest")
        })
    }
    ,
    n.prototype._setCurrency = function(e) {
        if (this.currency !== e) {
            var t = this.currency;
            this.currency = e,
            this.currencyIcon && this.currencyIcon.replaceClassNames([t], [e])
        }
    }
    ,
    n.prototype.prepareDialog = function(e) {
        var t = this;
        h.getData("Houses", e.modelId, function(i, n) {
            return i || !n ? console.warn("Houses Id: " + e.modelId + " not found!", i) : void d.preloadImage("gfx/houses/" + n.gfxId + ".png", function(i) {
                t.houseOwner = "?" === e.ownerName ? u("ui.common.houseWithNoOwner") : u("ui.house.homeOf", e.ownerName);
                var o = n.nameId;
                return t.image ? (delete t.imageUrl,
                delete t.titleText,
                delete t.descriptionText,
                t.image.setStyle("backgroundImage", i),
                t.title.setText(t.houseOwner),
                void t.description.setText(o)) : (t.imageUrl = i,
                t.titleText = t.houseOwner,
                void (t.descriptionText = o))
            })
        })
    }
    ,
    n.prototype.updateDisplay = function(e) {
        if (!e)
            return console.warn("Missing purchaseMsg from PurchasableDialogMessage.");
        this.proposedPrice = e.price,
        this.proposedPriceHard = m.computeHardPrice(e.price),
        this.houseInfo = e;
        var t = this.currency === _
          , i = t ? this.proposedPriceHard : e.price;
        if (e.buyOrSell) {
            this.switchButton.show(),
            this.price.disable(),
            this.windowTitle.setText(u("ui.common.housePurchase")),
            this.cancelSaleButton.disable();
            var n = window.gui.playerData.inventory
              , o = t || i && i <= n.kamas;
            o ? this.confirmButton.enable() : this.confirmButton.disable()
        } else
            this.switchButton.hide(),
            this.price.enable(),
            this.windowTitle.setText(u("ui.common.houseSale")),
            this.cancelSaleButton.enable(),
            this.confirmButton.enable();
        return i ? void this.price.setValue(c.kamasToString(i, "")) : this.price.setValue(u("ui.item.averageprice.unavailable"))
    }
    ,
    n.prototype.fromInsideUpdateDisplay = function(e) {
        var t = this;
        return this.switchButton.hide(),
        this.confirmButton.enable(),
        e ? (this.price.enable(),
        this.windowTitle.setText(u("ui.common.houseSale")),
        e.price ? (this.cancelSaleButton.enable(),
        this.proposedPrice = e.price,
        void this.price.setValue(c.kamasToString(e.price, ""))) : (this.cancelSaleButton.disable(),
        void h.getData("Houses", e.modelId, function(i, n) {
            return i || !n ? console.warn("Houses Id: " + e.modelId + " not found!", i) : (t.proposedPrice = n.defaultPrice,
            void t.price.setValue(c.kamasToString(t.proposedPrice, "")))
        }))) : console.warn("Missing current house info.")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        var t = this;
        e = e || {},
        this.currency = a,
        s.call(this, e, function() {
            t.toggleCurrency()
        }),
        this.addClassNames("button", "SwitchCurrencyButton", a)
    }
    i(777);
    var o = i(26).inherits
      , s = i(204)
      , a = "soft"
      , r = "hard";
    o(n, s),
    e.exports = n,
    n.prototype.toggleCurrency = function() {
        this.setCurrency(this.currency === a ? r : a)
    }
    ,
    n.prototype.setCurrency = function(e) {
        if (this.currency !== e) {
            var t = this.currency;
            return this.currency = e,
            this.replaceClassNames([t], [this.currency]),
            this.currency === r ? this.emit("switchToHard") : this.emit("switchToSoft")
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            u.close("itemAppearance")
        }
        function t() {
            var t = a.itemSlots.indexOf(a.selectedSlot) + 1;
            return a.itemInstance.livingObjectSkin === t ? e() : (this.disable(),
            void window.dofus.sendMessage("LivingObjectChangeSkinRequestMessage", {
                livingUID: a.itemInstance.objectUID,
                livingPosition: a.itemInstance.position,
                skinId: t
            }))
        }
        function i() {
            a.delClassNames("spinner"),
            a.confirmButton.enable(),
            a.selectedSlot && (a.selectedSlot.select(!1),
            delete a.selectedSlot)
        }
        function n() {
            var e = a.itemSlots.indexOf(this) + 1;
            this === a.selectedSlot || a.itemInstance.livingObjectLevel < e || (a.selectedSlot && a.selectedSlot.select(!1),
            this.select(),
            a.selectedSlot = this)
        }
        c.call(this, {
            className: "ItemAppearanceWindow",
            title: s("ui.item.chooseSkin"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 450,
                height: 200
            }
        });
        var a = this;
        this.itemSlots = [],
        this.selectedSlot = null ,
        this.itemInstance = null ,
        this.once("open", function() {
            this.itemSlotsBox = this.windowBody.createChild("div", {
                className: "itemSlotsBox"
            });
            for (var i = 0; i < d; i += 1) {
                var l = this.itemSlotsBox.appendChild(new r);
                l.on("tap", n),
                a.itemSlots.push(l)
            }
            this.confirmButton = this.windowBody.appendChild(new o(s("ui.common.validation"))),
            this.confirmButton.on("tap", t),
            window.gui.playerData.inventory.on("itemModified", function(t) {
                a.itemInstance && t.objectUID === a.itemInstance.objectUID && e()
            })
        }),
        this.on("open", function(e) {
            return e.itemInstance && e.itemInstance.livingObjectCategory ? void this._displayItem(e.itemInstance) : console.error("Must provide a living object or living object associated itemInstance")
        }),
        this.on("close", function() {
            i()
        })
    }
    i(779);
    var o = i(204).DofusButton
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(569)
      , l = i(36)
      , c = i(402)
      , u = i(22)
      , h = i(5)
      , d = 20;
    a(n, c),
    e.exports = n,
    n.prototype._displayItem = function(e) {
        this.itemInstance = e;
        var t = this;
        this.addClassNames("spinner"),
        this.confirmButton.disable(),
        t.itemSlots[e.livingObjectSkin - 1].emit("tap");
        var i = e.livingObjectId || e.objectGID;
        l.getData("LivingObjectSkinJntMood", i, function(i, n) {
            if (i)
                return console.error(i);
            var o, s = [];
            for (o = 0; o < n.moods[e.livingObjectMood].length; o += 1) {
                var a = n.moods[e.livingObjectMood][o];
                s.push("gfx/items/" + a + ".png")
            }
            h.preloadImages(s, function(e) {
                for (var i = 0; i < t.itemSlots.length; i += 1) {
                    var n = t.itemSlots[i];
                    i >= t.itemInstance.livingObjectLevel ? n.unset() : n.setImage(e[i])
                }
                t.delClassNames("spinner"),
                t.confirmButton.enable()
            })
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e, t) {
            return t = t || {},
            t.showDescription = !0,
            t.showTitle = !0,
            e ? (n.setTitle(e.getName()),
            n._itemBox.displayItem(e, t),
            n._itemBox.show(),
            void n.windowBody.delClassNames("spinner")) : console.error("ItemBoxWindow: openWithItemData have not itemData")
        }
        function t(e, t) {
            r.getItems([e], function(i) {
                if (i)
                    return t(i);
                var n = r.items[e];
                return n ? void t(null , n) : t(new Error("itemData not found for GID: " + e))
            })
        }
        function i(e) {
            var t = o.playerData.inventory.objects[e];
            return t ? t : console.error("ItemBoxWindow: inventory have not itemUID", e)
        }
        s.call(this, {
            className: "ItemBoxWindow",
            title: "",
            positionInfo: {
                top: "c",
                left: "c",
                width: 500,
                height: 380
            }
        });
        var n = this
          , o = window.gui;
        this._itemBox = null ,
        this._domCreated = !1,
        this.on("open", function(o) {
            o = o || {},
            n._domCreated || n._createDom();
            var s = o.itemData
              , a = o.objectUID
              , r = o.objectGID
              , l = o.options || {};
            n.setTitle(""),
            n._itemBox.hide(),
            n.windowBody.addClassNames("spinner"),
            s ? e(s, l) : a && window.gui.playerData.inventory.objects[a] ? (s = i(a),
            e(s, l)) : r ? t(r, function(t, i) {
                return t ? console.error("ItemBoxWindow: error retrieveItemFromDB", t) : void e(i, l)
            }) : console.error("ItemBoxWindow need itemData or objectUID or objectGID")
        }),
        this.on("close", function() {
            n._itemBox.hide(),
            n.windowBody.delClassNames("spinner")
        })
    }
    i(781);
    var o = i(26).inherits
      , s = i(402)
      , a = i(701)
      , r = i(323);
    o(n, s),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this.windowBody;
        this._itemBox = e.appendChild(new a),
        this._itemBox.hide(),
        this._domCreated = !0
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            var e = h.getWindow("feed");
            return e.possessFeedItemForLivingObject(n.itemInstance) ? void h.open("feed", {
                mode: "livingObject",
                item: n.itemInstance
            }) : window.gui.openSimplePopup(a("ui.item.errorNoFoodLivingItem", n.itemInstance.item.nameId))
        }
        function t() {
            n.lastLivingObjectId = n.itemInstance.livingObjectId,
            window.dofus.sendMessage("LivingObjectDissociateMessage", {
                livingUID: n.itemInstance.objectUID,
                livingPosition: n.itemInstance.position
            })
        }
        function i() {
            h.open("itemAppearance", {
                itemInstance: n.itemInstance
            })
        }
        u.call(this, {
            className: "ItemManageWindow",
            title: a("ui.item.manageItem"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 300,
                height: 300
            }
        });
        var n = this;
        this.itemInstance = null ,
        this.lastLivingObjectId = "",
        this.once("open", function() {
            var r = this.windowBody.createChild("div", {
                className: "topRow"
            });
            this.itemSlot = r.appendChild(new l);
            var u = r.createChild("div", {
                className: "buttons"
            });
            this.feedButton = u.appendChild(new s(a("ui.item.feed"))),
            this.feedButton.on("tap", e),
            this.dissociateButton = u.appendChild(new s(a("ui.item.dissociate"))),
            this.dissociateButton.on("tap", t),
            this.appearanceButton = u.appendChild(new s(a("ui.item.skin"))),
            this.appearanceButton.on("tap", i);
            var h = this.windowBody.createChild("div", {
                className: "botRow"
            })
              , p = h.createChild("div", {
                className: "statsBox"
            });
            p.createChild("div", {
                className: "label",
                text: a("ui.common.state") + a("ui.common.colon")
            }),
            this.moodBox = p.createChild("div", {
                className: "value"
            }),
            this.lastFedBox = p.createChild("div", {
                className: ["label", "lastFedBox"]
            });
            var m = a("ui.common.level") + a("ui.common.colon");
            p.createChild("div", {
                className: "label",
                text: m
            }),
            this.levelBox = p.createChild("div", {
                className: "value"
            }),
            m = a("ui.common.experiment") + a("ui.common.colon"),
            p.createChild("div", {
                className: "label",
                text: m
            }),
            this.expBar = p.appendChild(new c),
            this.expBar.addClassNames("expBar", "blue", "value"),
            this.expTooltip = new d("div",{
                className: "expTooltip"
            }),
            o(this.expBar, this.expTooltip),
            window.gui.playerData.inventory.on("itemAdded", function(e) {
                if (e.objectGID === n.lastLivingObjectId) {
                    var t = window.gui.playerData.inventory.objects[e.objectUID];
                    n._displayItem(t)
                }
            }),
            window.gui.playerData.inventory.on("itemModified", function(e) {
                e && n.itemInstance && (e.livingObjectId && e.livingObjectId === n.itemInstance.objectGID ? n._displayItem(e) : e.objectUID === n.itemInstance.objectUID && n._displayItem(e))
            })
        }),
        this.on("open", function(e) {
            return e.itemInstance && e.itemInstance.livingObjectCategory ? void this._displayItem(e.itemInstance) : console.error("Must provide a living object or living object associated itemInstance")
        })
    }
    i(783);
    var o = i(206).addTooltip
      , s = i(204).DofusButton
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(567)
      , c = i(643)
      , u = i(402)
      , h = i(22)
      , d = i(190)
      , p = {
        MOOD_LEAN: 0,
        MOOD_SATISFIED: 1,
        MOOD_FAT: 2
    };
    r(n, u),
    e.exports = n,
    n.prototype._updateMood = function(e) {
        var t;
        switch (e.livingObjectMood) {
        case p.MOOD_LEAN:
            t = a("ui.common.lean");
            break;
        case p.MOOD_SATISFIED:
            t = a("ui.common.satisfied");
            break;
        case p.MOOD_FAT:
            t = a("ui.common.fat")
        }
        this.moodBox.setText(t)
    }
    ,
    n.prototype._updateLastFed = function(e) {
        this.lastFedBox.setText(e.livingObjectFoodDate)
    }
    ,
    n.prototype._updateExp = function(e) {
        this.levelBox.setText(e.livingObjectLevel);
        var t = e.livingObjectXp
          , i = e.livingObjectMaxXp;
        this.expBar.setValue(0 !== i ? t / i : 1),
        this.expTooltip.setText(t + " / " + i)
    }
    ,
    n.prototype._displayItem = function(e) {
        this.itemInstance = e,
        this.itemSlot.setItem(e),
        this.itemSlot.setQuantity(1),
        e.livingObjectId && e.objectGID ? (this.feedButton.enable(),
        this.dissociateButton.enable()) : (this.feedButton.disable(),
        this.dissociateButton.disable()),
        this._updateMood(e),
        this._updateLastFed(e),
        this._updateExp(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        p.call(this, {
            className: "ItemRecipesWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 800,
                height: 525
            }
        }),
        this.dbItemId = null ,
        this.itemBox = null ,
        this.itemHistory = [],
        this.on("open", this._onOpen),
        this.on("close", this._onClose)
    }
    function o(e) {
        this.myWindow._displayNextItem(e)
    }
    function s() {
        var e = this.myWindow;
        e.itemHistory.pop();
        var t = c.items[e.itemHistory[e.itemHistory.length - 1]];
        e._displayItem(t)
    }
    i(785);
    var a = i(35).getText
      , r = i(26).inherits
      , l = i(701)
      , c = i(323)
      , u = i(758)
      , h = i(756)
      , d = i(36)
      , p = i(402)
      , m = i(204);
    r(n, p),
    e.exports = n,
    n.prototype._onOpen = function(e) {
        this.itemBox || this._createContent();
        var t = e.itemData && e.itemData.item ? e.itemData.item : e.itemData;
        this._displayNextItem(t)
    }
    ,
    n.prototype._onClose = function() {
        this.dbItemId = null ,
        this.itemHistory = [],
        this.windowBody.clearContent(),
        this.itemBox = null ,
        this.itemRecipeBox = null ,
        this.recipeList = null ,
        this.windowHeadWrapper.removeChild(this.backButton),
        this.backButton = null
    }
    ,
    n.prototype._displayNextItem = function(e) {
        e.id !== this.dbItemId && (this.itemHistory.push(e.id),
        this._displayItem(e))
    }
    ,
    n.prototype._createContent = function() {
        var e = this.windowBody.createChild("div", {
            className: "leftCol"
        });
        this.itemBox = new l({
            showDescription: !0,
            showTitle: !0,
            withBidHouseBtn: !0
        }),
        e.appendChild(this.itemBox),
        this.itemRecipeBox = e.createChild("div", {
            className: "itemRecipeBox"
        }),
        this.itemRecipeBox.createChild("div", {
            className: "title",
            name: "title"
        }),
        this.itemRecipeBox.on("itemTapped", o),
        this.itemRecipeBox.myWindow = this;
        var t = this.windowBody.createChild("div", {
            className: "rightCol"
        });
        this.recipeList = new h,
        this.recipeList.on("itemTapped", o),
        this.recipeList.myWindow = this,
        t.appendChild(this.recipeList);
        var i = this.backButton = new m({
            className: "backButton"
        },s);
        i.insertBefore(this.windowTitle),
        i.myWindow = this
    }
    ,
    n.prototype._displayItem = function(e) {
        this.dbItemId = e.id;
        var t = this;
        this.windowTitle.setText(e.nameId),
        this.backButton.toggleDisplay(this.itemHistory.length > 1),
        this.itemBox.displayItem(e);
        var i = [e.id].concat(e.recipeIds);
        d.getDataMap("Recipes", i, function(n, s) {
            if (n)
                return console.error(n);
            for (var r = s[i[0]], l = [], c = 1; c < i.length; c++) {
                var h = s[i[c]];
                h && l.push(h)
            }
            t.recipeBox && t.recipeBox.destroy();
            var d = !e.getProperty("secretRecipe");
            t.itemRecipeBox.toggleClassName("empty", !r || d),
            r ? (t.itemRecipeBox.getChild("title").setText(a("ui.item.utilityReceipt")),
            t.recipeBox = new u(r,{
                isMain: !0
            }),
            t.recipeBox.on("itemTapped", o),
            t.recipeBox.myWindow = t,
            t.recipeBox.setupRecipe(function() {
                t.itemRecipeBox.appendChild(t.recipeBox)
            })) : d ? t.itemRecipeBox.getChild("title").setText(a("ui.item.secretReceipt")) : t.itemRecipeBox.getChild("title").setText(a("ui.item.utilityNoReceipt")),
            t.recipeList.recipesWrapper.addClassNames("spinner"),
            t.recipeList.addRecipes(l, function() {
                t.recipeList.recipesWrapper.delClassNames("spinner")
            })
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            i.selectedItemIds = [];
            for (var e = i.itemListBox.getChildren(), t = 0; t < e.length; t += 1) {
                var n = e[t];
                n.select(!1)
            }
        }
        function t() {
            for (var e, t = [].concat(i.itemSet.items), n = i.itemListBox.getChildren(), o = 0; o < n.length; o += 1)
                e = n[o],
                e.select(!0);
            i.selectedItemIds = t
        }
        m.call(this, {
            className: "ItemSetsWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 800,
                height: 525
            }
        });
        var i = this;
        this.selectedItemIds = [],
        this.once("open", function() {
            var n = this.windowBody.createChild("div", {
                className: "leftCol"
            });
            this.itemListBox = n.createChild("div", {
                className: "itemListBox"
            }),
            this.itemBox = new l({
                showDescription: !0,
                showTitle: !0,
                withBidHouseBtn: !0
            }),
            n.appendChild(this.itemBox);
            var s = this.windowBody.createChild("div", {
                className: "rightCol"
            })
              , r = s.createChild("div", {
                className: "selectorContainer"
            });
            r.createChild("div", {
                className: "tableTitle",
                text: a("ui.set.bonus")
            }),
            this.bonusSelector = r.appendChild(new h),
            this.bonusSelector.on("change", function(e) {
                i._updateBonusTable(e, i.combineBonusesCheckbox.isActivate())
            }),
            this.combineBonusesCheckbox = r.appendChild(new o(a("ui.set.addObjectBonus"))),
            this.combineBonusesCheckbox.on("change", function(n) {
                n ? t() : e();
                var o = i.selectedItemIds.length;
                i.bonusSelector.select(n ? o : f),
                i.bonusSelector.toggleOption(o, n),
                i.bonusSelector.setEnable(!n),
                i.bonusSelector.toggleClassName("disabled", n)
            });
            var c = s.createChild("div", {
                className: "tableContainer"
            });
            this.bonusTable = c.appendChild(new p([{
                id: "description"
            }],null ,{
                clickable: !1
            })),
            window.gui.on("SetUpdateMessage", function(e) {
                i._updateEquippedItems(e.setObjects)
            })
        }),
        this.on("open", function(e) {
            var t = e.item ? e.item : e;
            this._displayItemSet(t)
        })
    }
    i(787);
    var o = i(448)
      , s = i(224)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(701)
      , c = i(567)
      , u = i(323)
      , h = i(393)
      , d = i(36)
      , p = i(400)
      , m = i(402)
      , f = 1
      , g = -1;
    r(n, m),
    e.exports = n,
    n.prototype._getEquippedItemById = function(e) {
        var t = window.gui.playerData.inventory.equippedItems;
        for (var i in t) {
            var n = t[i];
            if (n.item.id === e)
                return n
        }
    }
    ,
    n.prototype._updateEquippedItems = function(e) {
        for (var t = this.itemListBox.getChildren(), i = 0; i < t.length; i += 1) {
            var n = t[i];
            n.delClassNames("equipped"),
            e.indexOf(n.dbItem.id) > -1 && n.addClassNames("equipped"),
            n.dbItem.id === this.itemBox.itemId && this._updateItemBox(u.items[n.dbItem.id]);
            var o = this._getEquippedItemById(n.dbItem.id);
            n.setItem(o || n.dbItem)
        }
        this.combineBonusesCheckbox.isActivate() && this.bonusSelector.select(this.selectedItemIds.length)
    }
    ,
    n.prototype._displayItemSet = function(e) {
        if (e.itemSetId) {
            var t = this;
            this._updateItemBox(e),
            d.getData("ItemSets", e.itemSetId, function(e, i) {
                return e ? console.error(e) : (t.itemSet = i,
                t.windowTitle.setText(i.nameId),
                t.itemListBox.clearContent(),
                t.bonusSelector.clearContent(),
                void u.getItems(i.items, function(e) {
                    if (e)
                        return console.error(e);
                    t.bonusSelector.addOption("0 " + a("ui.common.objects"), 0),
                    t.bonusSelector.toggleOption(0, !1);
                    for (var n = 0; n < i.items.length; n += 1) {
                        var o = i.items[n]
                          , s = u.items[o]
                          , r = t._createItemSlot(t._getEquippedItemById(o) || s);
                        t.itemListBox.appendChild(r),
                        t.bonusSelector.addOption(n + 1 + " " + a("ui.common.objects"), n + 1)
                    }
                    t.combineBonusesCheckbox.deactivate()
                }))
            })
        }
    }
    ,
    n.prototype._createItemSlot = function(e) {
        var t = this
          , i = new c({
            itemData: e
        });
        return i.createChild("div", {
            className: "equippedIcon"
        }),
        i.toggleClassName("equipped", !!i.itemInstance),
        i.on("tap", function() {
            if (t.itemBox.displayItem(this.itemInstance || this.dbItem),
            t.combineBonusesCheckbox.isActivate()) {
                var e = t.selectedItemIds.indexOf(i.dbItem.id);
                e < 0 ? (t.selectedItemIds.push(i.dbItem.id),
                this.select()) : (t.selectedItemIds.splice(e, 1),
                this.select(!1)),
                t.bonusSelector.select(t.selectedItemIds.length)
            }
        }),
        i
    }
    ,
    n.prototype._updateItemBox = function(e) {
        var t = this._getEquippedItemById(e.id);
        this.itemBox.displayItem(t || e)
    }
    ,
    n.prototype._getEffectInstanceIntegerOrDie = function(e) {
        var t = {};
        for (var i in e)
            e.hasOwnProperty(i) && (t[i] = e[i]);
        return t.diceNum = t.diceNum || 0,
        t.diceSide = t.diceSide || 0,
        t.value = t.value || 0,
        e.diceSide ? e.diceNum && e.diceSide && (t._type = "EffectInstanceDice",
        t.diceNum += t.value,
        t.diceSide += t.value,
        t.value = 0) : (t._type = "ObjectEffectInteger",
        e.diceNum && (t.value += e.diceNum),
        t.diceNum = 0,
        t.diceSide = 0),
        t
    }
    ,
    n.prototype._getMergedEffectInstances = function(e, t) {
        for (var i, n = [], o = {}, a = 0; a < e.length; a += 1) {
            var r = e[a];
            r && (i = o[r.effectId],
            i ? i.effect.useDice && (i.diceNum += r.diceNum || 0,
            i.diceSide += r.diceSide || 0,
            i.value += r.value || 0) : (i = this._getEffectInstanceIntegerOrDie(r),
            o[r.effectId] = i))
        }
        for (var l in o)
            i = this._getEffectInstanceIntegerOrDie(o[l]),
            n.push(i);
        s.createEffectInstances(n, t)
    }
    ,
    n.prototype._updateBonusTable = function(e, t) {
        var i = this;
        this.bonusTable.clearContent();
        var n, o = [];
        if (i.itemSet.effects.length && !i.itemSet.isBonusSecret) {
            var a = i.itemSet.effects[Math.max(e - 1, 0)];
            for (n = 0; n < a.length; n += 1) {
                var r = a[n];
                r && Object.keys(r).length && o.push(r)
            }
        }
        if (t && i.selectedItemIds.length) {
            var l = [];
            for (n = 0; n < i.selectedItemIds.length; n += 1) {
                var c = i.selectedItemIds[n]
                  , h = i._getEquippedItemById(c)
                  , d = h ? h.effectsMap : u.items[c].possibleEffectsMap;
                for (var p in d)
                    d[p].effect.showInSet && l.push(d[p])
            }
            o = o.concat(l)
        }
        s.createEffectInstances(o, function(e, t) {
            return e ? console.error("_updateBonusTable createEffectInstances", e) : void i._getMergedEffectInstances(t, function(e, t) {
                return e ? console.error("_updateBonusTable _getMergedEffectInstances", e) : void i._addEffectsToTable(t)
            })
        })
    }
    ,
    n.prototype._addEffectsToTable = function(e) {
        if (this.itemSet.bonusIsSecret && !e.length)
            return void this.bonusTable.addRow({
                description: a("ui.set.secretBonus")
            });
        for (var t = 0; t < e.length; t += 1) {
            var i = e[t];
            if (i) {
                var n = this.bonusTable.addRow({
                    description: i.description
                });
                n.toggleClassName("negative", i.effect.bonusType === g)
            }
        }
        this.bonusTable.scroller.goToTop()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, {
            className: "LevelUpWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 260
            }
        });
        var e = this;
        this.once("open", function() {
            e._createDom()
        }),
        this.on("open", function() {
            var t = window.gui.playerData.characterBaseInformations.entityLook;
            e._characterDisplay.setLook(t, {
                direction: d.DIRECTION_SOUTH_EAST,
                animation: "AnimStatique",
                boneType: "characters/",
                skinType: "characters/"
            })
        }),
        this._setupEvents()
    }
    function o(e) {
        e.sort(function(e, t) {
            var i = e.getProperty("minPlayerLevel")
              , n = t.getProperty("minPlayerLevel");
            return i < n ? -1 : i > n ? 1 : void 0
        })
    }
    i(789);
    var s = i(26).inherits
      , a = i(402)
      , r = i(22)
      , l = i(35).getText
      , c = i(576)
      , u = i(206).addTooltip
      , h = i(238)
      , d = i(279)
      , p = i(5)
      , m = i(261).Delay;
    s(n, a),
    e.exports = n,
    n.prototype._setupSpellData = function() {
        var e = window.gui.playerData.characters.mainCharacter.spellData.spells
          , t = window.gui.playerData.characterBaseInformations.level;
        this.spells = [];
        for (var i in e)
            t <= e[i].getProperty("minPlayerLevel") && this.spells.push(e[i]);
        o(this.spells)
    }
    ,
    n.prototype._createDom = function() {
        this._characterDisplay = this.windowBody.appendChild(new h({
            scale: "fitin",
            horizontalAlign: "center"
        }));
        var e = this.windowBody.createChild("div", {
            className: "info"
        })
          , t = e.createChild("div", {
            className: "spellBlock"
        })
          , i = e.createChild("div", {
            className: "pointBlock"
        });
        this.spellText = t.createChild("div", {
            className: "spellText"
        }),
        this.spellIcon = t.createChild("div", {
            className: "spellIcon"
        }),
        this.spellDescription = new c,
        u(this.spellIcon, this.spellDescription);
        var n = i.createChild("div", {
            className: ["healthPoints", "points"]
        })
          , o = i.createChild("div", {
            className: ["spellPoints", "points"]
        })
          , s = i.createChild("div", {
            className: ["charaPoints", "points"]
        });
        n.createChild("div", {
            className: "icon"
        }),
        n.createChild("div", {
            className: "text",
            text: l("ui.levelUp.LifePoints")
        }),
        this.health = n.createChild("div", {
            className: "point"
        }),
        o.createChild("div", {
            className: "icon"
        }),
        o.createChild("div", {
            className: "text",
            text: l("ui.levelUp.SpellPoints")
        }),
        this.spell = o.createChild("div", {
            className: "point"
        }),
        s.createChild("div", {
            className: "icon"
        }),
        s.createChild("div", {
            className: "text",
            text: l("ui.levelUp.CaracPoints")
        }),
        this.charac = s.createChild("div", {
            className: "point"
        })
    }
    ,
    n.prototype.updateSpellIcon = function(e) {
        var t = this;
        this.spellDescription.updateUI({
            spell: e
        }),
        p.preloadImage("gfx/spells/sort_" + e.spell.iconId + ".png", function(e) {
            t.spellIcon.setStyle("backgroundImage", e)
        })
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui.playerData;
        t.on("characterLevelUp", function(t) {
            window.gui.tutorialManager.inTutorial || m(37, function() {
                e._levelUp(t.newLevel, t.previousLevel)
            }).start()
        })
    }
    ,
    n.prototype._levelUp = function(e, t) {
        r.open(this.id),
        this._setupSpellData(),
        this.windowTitle.setText(l("ui.levelUp.TitleLevel", e));
        for (var i = this.spells, n = 0; n < i.length; n++) {
            var o = i[n]
              , s = o.getProperty("minPlayerLevel");
            if (e === s) {
                this.updateSpellIcon(o),
                this.spellText.setText(l("ui.levelUp.newSpell"));
                break
            }
            if (e < s) {
                this.updateSpellIcon(o),
                this.spellText.setText(l("ui.levelUp.nextSpell") + " " + l("ui.levelUp.nextSpellLevel", s));
                break
            }
        }
        var a = e - t;
        this.health.setText("+ " + 5 * a),
        this.spell.setText("+ " + a),
        this.charac.setText("+ " + 5 * a)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "padLockWindow",
            title: l("ui.common.typeCode"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 400,
                height: 360
            }
        });
        var e = this;
        this.padlockInfo = {
            codeSize: 8
        },
        this.once("open", function() {
            function t() {
                e.enterCode(this.id)
            }
            var i, n = 9, o = {};
            e.currentCodeDigit = 0,
            e.codeDigitContainer = [],
            e.codeDigit = [];
            var s = e.windowBody.createChild("div", {
                className: "codeContainer"
            });
            for (i = 0; i < e.padlockInfo.codeSize; i++)
                e.codeDigitContainer.push(s.createChild("div", {
                    className: "codeDigitContainer"
                })),
                e.codeDigit.push(e.codeDigitContainer[i].createChild("div", {
                    className: "codeDigit"
                }));
            var c = e.windowBody.createChild("div", {
                className: "container"
            })
              , u = c.createChild("div", {
                className: "leftPanel"
            })
              , h = l("ui.common.unlockInfos");
            u.createChild("div", {
                className: "text",
                text: h
            }),
            e.resetButton = u.createChild("div", {
                className: "resetButton"
            }),
            e.resetButton.createChild("div", {
                className: "resetButtonIcon"
            }),
            e.resetButton.createChild("div", {
                className: "resetButtonText",
                text: l("ui.common.resetCode")
            }),
            a(e.resetButton);
            var d = c.createChild("div", {
                className: "keypadContainer"
            });
            for (i = n; i >= 0; i--)
                o[i] = d.appendChild(new r(i,{
                    className: ["keypad", "num" + i]
                })),
                o[i].id = i,
                o[i].on("tap", t);
            var p = this.windowBody.createChild("div", {
                className: "confirmPanel"
            });
            e.confirmButton = p.appendChild(new r(l("ui.common.validation"),{
                className: "confirmButton"
            })),
            e.setupButtonEvents()
        }),
        this.on("open", function(t) {
            t = t || {},
            e.fromInside = t.fromInside,
            e.resetCode()
        }),
        e.setupListeners()
    }
    i(791);
    var o = i(26).inherits
      , s = i(402)
      , a = i(32)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(22);
    o(n, s),
    e.exports = n,
    n.prototype.setupButtonEvents = function() {
        var e = this;
        this.confirmButton.on("tap", function() {
            for (var t = "", i = 0; i < e.padlockInfo.codeSize; i++)
                t += isNaN(parseInt(e.codeDigit[i].getText(), 10)) ? "_" : e.codeDigit[i].getText();
            var n = {
                code: t
            };
            return e.fromInside ? (window.dofus.sendMessage("HouseLockFromInsideRequestMessage", n),
            void c.close(e.id)) : e.padlockInfo.changeOrUse ? void window.dofus.sendMessage("LockableChangeCodeMessage", n) : void window.dofus.sendMessage("LockableUseCodeMessage", n)
        }),
        this.resetButton.on("tap", function() {
            e.resetCode()
        }),
        this.resetButton.on("tapstart", function() {
            this.addClassNames("pressed")
        }),
        this.resetButton.on("tapend", function() {
            this.delClassNames("pressed")
        })
    }
    ,
    n.prototype.setupListeners = function() {
        var e = this
          , t = {
            0: l("ui.house.codeChanged"),
            1: l("ui.error.badCode")
        };
        window.gui.on("LockableShowCodeDialogMessage", function(t) {
            e.padlockInfo = t,
            c.openDialog(e.id, {
                fromInside: !1
            })
        }),
        window.gui.on("LockableCodeResultMessage", function(e) {
            window.gui.openPopup({
                title: l("ui.common.code"),
                message: t[e.result]
            })
        })
    }
    ,
    n.prototype.enterCode = function(e) {
        var t = this.currentCodeDigit % this.padlockInfo.codeSize;
        this.codeDigit[t].setText(e),
        this.codeDigit[t].show(),
        this.currentCodeDigit++,
        this.highlightDigit()
    }
    ,
    n.prototype.resetCode = function() {
        for (var e = 0; e < this.codeDigit.length; e++)
            this.codeDigit[e].setText(""),
            this.codeDigit[e].hide();
        this.currentCodeDigit = 0,
        this.highlightDigit()
    }
    ,
    n.prototype.highlightDigit = function() {
        for (var e = this.currentCodeDigit % this.padlockInfo.codeSize, t = 0; t < this.codeDigitContainer.length; t++)
            t === e ? this.codeDigitContainer[t].addClassNames("highlight") : this.codeDigitContainer[t].delClassNames("highlight")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "PartyInviteDetailsWindow",
            positionInfo: y
        }),
        this.partyMap = {},
        this.numParties = 0,
        this.partyId = null ;
        var e = this;
        window.gui.on("disconnect", function() {
            e._closeAll()
        })
    }
    i(793);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(32)
      , c = i(35).getText
      , u = i(412)
      , h = i(212)
      , d = i(238)
      , p = i(279)
      , m = i(302)
      , f = 3
      , g = h.MAX_MEMBERS_PER_PARTY
      , _ = 563
      , v = 904
      , y = {
        left: "c",
        top: "c",
        minWidth: _,
        height: 375
    };
    o(n, s),
    e.exports = n,
    n.prototype.showPartyDetails = function(e) {
        return e === this.partyId ? a.open(this.id) : (window.dofus.sendMessage("PartyInvitationDetailsRequestMessage", {
            partyId: e
        }),
        this.partyMap[e] || (this.partyMap[e] = !0,
        this.numParties++,
        1 === this.numParties && this._setupListeners(!0)),
        void (this.text ? this._resetDom() : this._setupDom()))
    }
    ,
    n.prototype._closeAll = function() {
        for (var e in this.partyMap)
            this._closePartyInvitation(e);
        this.partyMap = {},
        this.numParties = 0,
        this.partyId = null
    }
    ,
    n.prototype._closePartyInvitation = function(e) {
        this.partyMap[e] && (delete this.partyMap[e],
        this.numParties--,
        0 === this.numParties && this._setupListeners(!1),
        window.gui.notificationBar.removeNotification("party" + e),
        e === this.partyId && (this.partyId = null ,
        a.close(this.id),
        this.windowBody.clearContent(),
        this.text = null ,
        this.characters = [],
        this.members = null ,
        this.scroller = null ,
        this.slotList = null ))
    }
    ,
    n.prototype._setupDom = function() {
        var e = this;
        this.text = this.windowBody.createChild("div", {
            className: "text"
        });
        var t = this.windowBody.createChild("div", {
            className: "container"
        });
        this.scroller = t.appendChild(new m({
            className: "slotList"
        },{
            isHorizontal: !0
        })),
        this.slotList = this.scroller.content,
        this.characters = [];
        var i = this.windowBody.createChild("div", {
            className: "buttons"
        })
          , n = i.appendChild(new r(c("ui.common.accept"),{
            className: "acceptButton"
        }))
          , o = i.appendChild(new r(c("ui.common.refuse"),{
            className: "refuseButton"
        }))
          , s = i.appendChild(new r(c("ui.social.blackListTemporarly"),{
            className: "ignoreButton"
        }));
        n.on("tap", function() {
            window.dofus.sendMessage("PartyAcceptInvitationMessage", {
                partyId: e.partyId
            }),
            e._closePartyInvitation(e.partyId)
        }),
        o.on("tap", function() {
            window.dofus.sendMessage("PartyRefuseInvitationMessage", {
                partyId: e.partyId
            }),
            e._closePartyInvitation(e.partyId)
        }),
        s.on("tap", function() {
            window.dofus.sendMessage("IgnoredAddRequestMessage", {
                name: e.fromName,
                session: !0
            }),
            e._closePartyInvitation(e.partyId)
        })
    }
    ,
    n.prototype._newCharacterSlot = function() {
        var e = this.slotList.createChild("div", {
            className: "character"
        });
        e.createChild("div", {
            className: "background",
            name: "background"
        }),
        e.appendChild(new d({
            name: "characterDisplay",
            scale: 1.4,
            verticalAlign: "bottom"
        })),
        e.createChild("div", {
            className: "name",
            name: "name"
        }),
        e.createChild("div", {
            className: "breed",
            name: "breed"
        }),
        e.createChild("div", {
            className: "level",
            name: "level"
        }),
        l(e);
        var t = this;
        return e.on("tap", function() {
            if (e.characterId) {
                var i = t.members[e.characterId];
                window.gui.openContextualMenu("player", {
                    playerId: i.id,
                    playerName: i.name
                })
            }
        }),
        e
    }
    ,
    n.prototype._resetDom = function() {
        this.characters = [],
        this.slotList.clearContent()
    }
    ,
    n.prototype._removeMember = function(e, t) {
        if (e === this.partyId) {
            var i = this.members[t];
            if (i) {
                var n = i.index
                  , o = this.characters.splice(n, 1)[0];
                this.slotList.removeChild(o),
                this.characters.push(this._newCharacterSlot());
                for (var s in this.members)
                    i = this.members[s],
                    i.index > n && i.index--;
                delete this.members[t],
                this.scroller.refresh()
            }
        }
    }
    ;
    var w = ["PartyGuestInformations", "PartyInvitationMemberInformations", "PartyMemberInformations"];
    n.prototype._addOrUpdateMember = function(e, t, i) {
        if (e === this.partyId) {
            if (w.indexOf(t._type) === -1)
                return console.error("Unhandled type for character: " + t._type);
            var n = this.members[t.id];
            n ? t.index = n.index : t.index = Object.keys(this.members).length,
            this.members[t.id] = t,
            this._updateCharacterSlot(t),
            i || this.scroller.refresh()
        }
    }
    ,
    n.prototype._updateCharacterSlot = function(e) {
        var t = this.characters[e.index];
        t || (t = this.characters[e.index] = this._newCharacterSlot()),
        t.characterId = e.id,
        t.getChild("name").setText(e.name),
        t.getChild("level").setText(c("ui.common.level") + " " + e.level),
        t.getChild("breed").setText(window.gui.databases.Breeds[e.breed].shortNameId);
        var i = t.getChild("characterDisplay");
        i.setLook(e.entityLook, {
            direction: p.DIRECTION_SOUTH_EAST,
            animation: "AnimStatique",
            boneType: "characters/",
            skinType: "characters/",
            riderOnly: !0
        }),
        this._toggleGuest(e.id, e.isGuest)
    }
    ,
    n.prototype._toggleGuest = function(e, t) {
        var i = this.members[e];
        if (i) {
            var n = this.characters[i.index];
            n.getChild("background").toggleClassName("guestFrame", !!t)
        }
    }
    ,
    n.prototype._toggleLeader = function(e, t) {
        var i = this.members[e];
        if (i) {
            var n = this.characters[i.index];
            n.getChild("background").toggleClassName("leaderIcon", !!t)
        }
    }
    ,
    n.prototype._setLeader = function(e, t) {
        e === this.partyId && (this._toggleLeader(this.leaderId, !1),
        this._toggleLeader(t, !0),
        this.leaderId = t)
    }
    ,
    n.prototype._joinParty = function(e) {
        var t = e.partyId;
        this.partyId = t;
        var i = e.partyType === u.PARTY_TYPE_ARENA;
        y.width = i ? _ : v,
        this.position = null ,
        a.open(this.id),
        this.windowTitle.setText(c(i ? "ui.common.invitationArena" : "ui.common.invitationGroupe")),
        this.slotList.toggleClassName("arena", i),
        this.slotList.toggleClassName("classic", !i);
        for (var n = i ? f : g; n > 0; n--)
            this.characters.push(this._newCharacterSlot());
        for (this.text.setText(c("ui.common.invitationPresentation", e.fromName) + "."),
        this.fromName = e.fromName,
        this.members = {},
        n = 0; n < e.members.length; n++)
            this._addOrUpdateMember(t, e.members[n], !0);
        for (n = 0; n < e.guests.length; n++)
            this._addOrUpdateMember(t, e.guests[n], !0);
        this._setLeader(t, e.leaderId),
        this.scroller.refresh()
    }
    ,
    n.prototype._setupListeners = function(e) {
        var t = window.gui.playerData.partyData;
        this.joinPartyHandler || (this.joinPartyHandler = this._joinParty.bind(this),
        this.closePartyInvitationHandler = this._closePartyInvitation.bind(this),
        this.setLeaderHandler = this._setLeader.bind(this),
        this.addOrUpdateMemberHandler = this._addOrUpdateMember.bind(this),
        this.removeMemberHandler = this._removeMember.bind(this)),
        e ? (t.on("partyInvitationDetails", this.joinPartyHandler),
        t.on("partyInvitationCancelled", this.closePartyInvitationHandler),
        t.on("partyLeaderUpdated", this.setLeaderHandler),
        t.on("partyNewGuest", this.addOrUpdateMemberHandler),
        t.on("partyNewMember", this.addOrUpdateMemberHandler),
        t.on("partyUpdateMember", this.addOrUpdateMemberHandler),
        t.on("partyMemberLeft", this.removeMemberHandler),
        t.on("partyGuestLeft", this.removeMemberHandler)) : (t.removeListener("partyInvitationDetails", this.joinPartyHandler),
        t.removeListener("partyInvitationCancelled", this.closePartyInvitationHandler),
        t.removeListener("partyLeaderUpdated", this.setLeaderHandler),
        t.removeListener("partyNewGuest", this.addOrUpdateMemberHandler),
        t.removeListener("partyNewMember", this.addOrUpdateMemberHandler),
        t.removeListener("partyUpdateMember", this.addOrUpdateMemberHandler),
        t.removeListener("partyMemberLeft", this.removeMemberHandler),
        t.removeListener("partyGuestLeft", this.removeMemberHandler))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            l.close("presetChooseIcon", c.YES)
        }
        r.call(this, {
            className: "PresetChooseIconWindow",
            title: s("ui.option.tabPic"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 460,
                height: 250
            }
        }),
        this.once("open", function(t) {
            this.windowBody.appendChild(t),
            this.saveButton = this.windowBody.appendChild(new o(s("ui.common.save"))),
            this.saveButton.on("tap", function() {
                e()
            })
        })
    }
    var o = i(204).DofusButton
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(402)
      , l = i(22)
      , c = i(641).actionsEnum;
    a(n, r),
    e.exports = n
}
, function(e, t, i) {
    function n() {
        var e = this;
        a.call(this, {
            title: r("ui.achievement.rewardsWaiting"),
            className: "rewardsPending",
            positionInfo: {
                left: "c",
                top: "c-32px",
                width: 500,
                height: 300
            }
        }),
        this.rewards = {},
        this.isInFight = !1,
        this.isInTutorial = !1,
        this.rewardsList = this.windowBody.createChild("div", {
            className: "rewardsList"
        }),
        this.counter = this.windowBody.createChild("div", {
            className: "counter"
        }),
        this.acceptAllButton = this.windowBody.appendChild(new l(r("ui.common.acceptAll"))),
        this.acceptAllButton.on("tap", function() {
            e.collectAll()
        });
        var t = window.gui;
        t.playerData.achievements.on("achievementFinished", function(t) {
            e.addReward(t.id, t.finishedlevel)
        }),
        t.playerData.achievements.on("achievementListUpdated", function(t) {
            for (var i = 0; i < t.rewardableAchievements.length; i += 1) {
                var n = t.rewardableAchievements[i];
                e.addReward(n.id, n.finishedlevel)
            }
        }),
        t.playerData.achievements.on("achievementRewardSuccess", function(t) {
            e.removeReward(t)
        }),
        t.on("disconnect", function() {
            e.reset()
        }),
        t.fightManager.on("fightStart", function() {
            e.isInFight = !0,
            e.handleRewardsIndicatorDisplay()
        }),
        t.fightManager.on(p.FIGHT_END, function() {
            e.isInFight = !1,
            e.handleRewardsIndicatorDisplay()
        }),
        t.tutorialManager.on("inTutorialStateChanged", function(t) {
            e.isInTutorial = t,
            e.handleRewardsIndicatorDisplay()
        })
    }
    i(796);
    var o = i(12)
      , s = i(26).inherits
      , a = i(402)
      , r = i(35).getText
      , l = i(204).DofusButton
      , c = i(569)
      , u = i(32)
      , h = i(22)
      , d = i(36)
      , p = i(218)
      , m = i(5)
      , f = i(210);
    s(n, a),
    e.exports = n,
    n.prototype.addReward = function(e, t) {
        function i(t) {
            d.getData("Achievements", e, function(e, i) {
                return e ? t(e) : (S = i.nameId,
                x = i.categoryId,
                N = i.rewardIds,
                A = i,
                t())
            })
        }
        function n(e) {
            if (y.rootElement) {
                var i = window.gui.playerData.achievements.getAchievementKamasReward(A, t);
                y.kamas.setText(f.kamasToString(i, ""));
                var n = window.gui.playerData.achievements.getAchievementExperienceReward(A, t);
                return y.xp.setText(f.kamasToString(n, "")),
                e()
            }
        }
        function s(e) {
            d.getData("AchievementCategories", x, function(t, i) {
                return t ? e(t) : (E = i.parentId,
                M = i.nameId,
                e())
            })
        }
        function a(e) {
            return 0 === E ? e() : void d.getData("AchievementCategories", E, function(t, i) {
                return t ? e(t) : (M = i.nameId,
                e())
            })
        }
        function r(e) {
            return 0 === N.length ? e() : void d.getData("AchievementRewards", N, function(i, n) {
                if (i)
                    return e(i);
                for (var o = 0; o < n.length; o += 1) {
                    var s = n[o];
                    if ((s.levelMin === -1 || s.levelMin <= t) && (s.levelMax === -1 || s.levelMax >= t))
                        return R = s.itemsReward,
                        O = s.itemsQuantityReward,
                        P = s.emotesReward,
                        D = s.titlesReward,
                        L = s.ornamentsReward,
                        e()
                }
                return e(new Error("rewardNotFound"))
            })
        }
        function l(e) {
            return 0 === R.length ? e() : void d.getData("Items", R, function(t, i) {
                if (t)
                    return e(t);
                for (var n = 0; n < i.length; n += 1)
                    B.push("gfx/items/" + i[n].iconId + ".png");
                return e()
            })
        }
        function h(e) {
            for (var t = 0; t < P.length; t += 1)
                B.push("gfx/emotes/" + P[t] + ".png");
            return e()
        }
        function p(e) {
            for (var t = 0; t < D.length; t += 1)
                B.push("gfx/illusUi/genericTitleIcon.png");
            return e()
        }
        function g(e) {
            return 0 === L.length ? e() : void d.getData("Ornaments", L, function(t, i) {
                if (t)
                    return e(t);
                for (var n = 0; n < i.length; n += 1)
                    B.push("gfx/ornaments/" + i[n].iconId + ".png");
                return e()
            })
        }
        function _(e) {
            return 0 === B.length ? e() : void m.preloadImages(B, function(t) {
                for (var i = 0; i < t.length; i += 1) {
                    var n = I[i];
                    n.rootElement && (n.setImage(t[i]),
                    n.setQuantity(O[i]))
                }
                return e()
            })
        }
        var v = this
          , y = this.rewardsList.createChild("div", {
            className: "reward"
        });
        y.id = e,
        y.left = y.createChild("div", {
            className: "rewardLeft"
        }),
        y.right = y.createChild("div", {
            className: "rewardRight"
        }),
        y.nameText = y.left.createChild("div", {
            className: "rewardName"
        }),
        y.category = y.right.createChild("div", {
            className: "rewardCategory"
        }),
        y.numbers = y.right.createChild("div", {
            className: "rewardNumbers"
        }),
        y.xp = y.numbers.createChild("div", {
            className: "rewardXp"
        }),
        y.kamas = y.numbers.createChild("div", {
            className: "rewardKamas"
        }),
        y.collectButton = y.right.createChild("div", {
            className: "collectButton"
        }),
        u(y.collectButton),
        y.collectButton.on("tap", function() {
            v.collectReward(y.id)
        });
        for (var w = y.left.createChild("div", {
            className: "rewards",
            name: "rewards"
        }), b = w.createChild("div", {
            className: "rewardList"
        }), C = 6, I = [], T = 0; T < C; T += 1)
            I[T] = b.appendChild(new c({
                name: "icon" + T
            }));
        this.rewards[e] = y,
        this.updateCounter(),
        this.handleRewardsIndicatorDisplay();
        var S, A, E, x, M, N, R = [], O = [], P = [], D = [], L = [], B = [];
        o.series([i, n, s, a, r, l, h, p, g, _], function(e) {
            return e ? console.error(e) : void (y.rootElement && (y.nameText.setText(S),
            y.category.setText(M)))
        })
    }
    ,
    n.prototype.removeReward = function(e) {
        var t = this.rewards[e];
        t.destroy(),
        delete this.rewards[e],
        this.updateCounter(),
        this.handleRewardsIndicatorDisplay()
    }
    ,
    n.prototype.collectAll = function() {
        window.dofus.sendMessage("AchievementRewardRequestMessage", {
            achievementId: -1
        })
    }
    ,
    n.prototype.collectReward = function(e) {
        window.dofus.sendMessage("AchievementRewardRequestMessage", {
            achievementId: e
        })
    }
    ,
    n.prototype.updateCounter = function() {
        var e = Object.keys(this.rewards).length;
        this.counter.setText(r("ui.achievement.rewardsRemaining", e))
    }
    ,
    n.prototype.handleRewardsIndicatorDisplay = function() {
        var e = Object.keys(this.rewards).length;
        0 === e && h.close("rewardsPending"),
        window.gui.rewardsIndicator.toggleDisplay(e > 0 && !this.isInFight && !this.isInTutorial)
    }
    ,
    n.prototype.reset = function() {
        this.rewards = {},
        this.isInFight = !1,
        this.isInTutorial = !1,
        this.rewardsList.clearContent()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, {
            className: "ServerDetailsWindow",
            title: c("ui.sersel.suggestedServer"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 350,
                height: 350
            },
            hidden: !0
        });
        var e, t = this, i = this.windowBody, n = i.appendChild(new s), o = i.createChild("div", {
            className: "buttonsDiv"
        }), u = o.appendChild(new l(c("ui.common.ok"),{
            className: "okBtn"
        })), h = o.appendChild(new l(c("ui.common.cancel"),{
            className: "cancelBtn"
        }));
        u.on("tap", function() {
            return e ? (u.disable(),
            window.gui.serversData.selectServer(e.id),
            void r.close(t.id)) : console.error("No server")
        }),
        h.on("tap", function() {
            r.close(t.id)
        }),
        this.on("open", function(t) {
            e = t,
            n.setServer(e),
            3 === e.status ? u.enable() : u.disable()
        })
    }
    i(798);
    var o = i(26).inherits
      , s = i(799)
      , a = i(402)
      , r = i(22)
      , l = i(204).DofusButton
      , c = i(35).getText;
    o(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            var t = c.createChild("div", {
                className: ["detail", e]
            });
            t.createChild("div", {
                className: ["line", "label"],
                text: n[e]
            }),
            i._detailsBlock[e] = t.createChild("div", {
                className: ["line", "text"]
            })
        }
        function t(e) {
            u !== e && ("description" === e ? (d.addClassNames("selected"),
            p.delClassNames("selected"),
            u = "description",
            i._descContent.show(),
            i._rulesContent.hide()) : (d.delClassNames("selected"),
            p.addClassNames("selected"),
            u = "rules",
            i._descContent.hide(),
            i._rulesContent.show()))
        }
        s.call(this, "div", {
            className: "ServerDetails"
        });
        var i = this
          , n = {
            name: r("ui.common.name") + ":",
            community: r("ui.sersel.community") + ":",
            population: r("ui.sersel.population") + ":",
            type: r("ui.sersel.type") + ":",
            status: r("ui.sersel.state") + ":",
            openingDate: r("ui.sersel.date") + ":"
        }
          , o = this.createChild("div", {
            className: "content"
        })
          , l = o.createChild("div", {
            className: "top"
        });
        this._image = l.createChild("div", {
            className: "image"
        });
        var c = l.createChild("div", {
            className: "details"
        });
        this._detailsBlock = {},
        e("name"),
        e("empty"),
        e("community"),
        e("population"),
        e("type"),
        e("status"),
        e("openingDate");
        var u = "description"
          , h = o.createChild("div", {
            className: "bottom"
        })
          , d = h.createChild("div", {
            className: "descBtn",
            text: r("ui.common.description")
        })
          , p = h.createChild("div", {
            className: "rulesBtn",
            text: r("ui.sersel.rules")
        });
        a(d),
        a(p),
        d.on("tap", function() {
            t("description")
        }),
        p.on("tap", function() {
            t("rules")
        });
        var m = h.createChild("div", {
            className: "bottomContent"
        });
        this._descContent = m.createChild("div", {
            className: "descContent"
        }),
        this._rulesContent = m.createChild("div", {
            className: "rulesContent"
        }),
        d.addClassNames("selected"),
        this._rulesContent.hide()
    }
    i(800);
    var o = i(26).inherits
      , s = i(190)
      , a = i(32)
      , r = i(35).getText
      , l = i(481);
    o(n, s),
    e.exports = n,
    n.prototype.setServer = function(e) {
        var t = this
          , i = {
            0: r("ui.server.state.unknown"),
            1: r("ui.server.state.offline"),
            2: r("ui.server.state.starting"),
            3: r("ui.server.state.online"),
            4: r("ui.server.state.nojoin"),
            5: r("ui.server.state.saving"),
            6: r("ui.server.state.stoping"),
            7: r("ui.server.state.full")
        }
          , n = {
            0: r("ui.server.rules.0"),
            1: r("ui.server.rules.1")
        };
        window.gui.serversData.syncServerStaticData(function(o) {
            if (o)
                return console.error("ServerDetails setServer error", o);
            l.getServerImage(e.id, function(e, i) {
                return e ? console.error(e) : void t._image.setStyle("backgroundImage", i)
            }),
            t._detailsBlock.status.setText(i[e.status]);
            var s = window.gui.serversData.staticContent
              , a = s.data[e.id] || {}
              , r = s.gameTypes[a.gameTypeId] || {}
              , c = s.populations[a.populationId] || {}
              , u = s.communities[a.communityId] || {};
            t._detailsBlock.name.setText(a.nameId || e.id),
            t._detailsBlock.community.setText(u.nameId || "n/a"),
            t._detailsBlock.population.setText(c.nameId || "n/a"),
            t._detailsBlock.type.setText(r.nameId || "n/a");
            var h = new Date(a.openingDate || 0);
            t._detailsBlock.openingDate.setText(h.getDate() + "/" + (h.getMonth() + 1) + "/" + h.getFullYear()),
            t._descContent.setText(a.commentId),
            t._rulesContent.setText(n[a.gameTypeId] || "")
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e, t, i) {
            var n = e.createChild("div", {
                className: t
            });
            return a(n),
            n.on("tap", i),
            n
        }
        function t() {
            b && (b.delClassNames("selected"),
            b = null ),
            D.hide(),
            H.disable()
        }
        function i() {
            t();
            var e = m;
            y && (e = e.filter(function(e) {
                return e.charactersCount > 0
            })),
            v || (e = e.filter(function(e) {
                return C.indexOf(e.id) !== -1
            })),
            _ && (e = e.filter(function(e) {
                return _.indexOf(e.id) !== -1
            })),
            window.gui.serversData.syncServerStaticData(function(t) {
                if (t)
                    return console.error("ServerRow getServerStaticData error", t);
                var i = window.gui.serversData.staticContent;
                e.sort(function(e, t) {
                    var n = i.data[e.id].populationId
                      , o = i.data[t.id].populationId
                      , s = i.populations[n].weight
                      , a = i.populations[o].weight
                      , r = s - a;
                    return 0 !== r ? r : t.id - e.id
                });
                for (var o = 0, s = Math.max(e.length, I.length); o < s; o += 1) {
                    var a = e[o]
                      , r = I[o];
                    a ? r ? (r.setServer(a),
                    r.show()) : n(a, I.length % 2) : r && r.hide()
                }
                !b && e[0] && I[0].emit("tap")
            })
        }
        function n(e, t) {
            var i = R.appendChild(new r(e,t));
            I.push(i),
            i.on("tap", function() {
                b && b.delClassNames("selected"),
                i.addClassNames("selected"),
                b = i,
                D.setServer(i.data),
                D.show(),
                3 === i.data.status ? H.enable() : H.disable()
            })
        }
        function o() {
            v ? (v = !1,
            B.delClassNames("selected")) : (v = !0,
            B.addClassNames("selected"))
        }
        function p() {
            y ? (y = !1,
            k.delClassNames("selected")) : (y = !0,
            k.addClassNames("selected"))
        }
        s.call(this, {
            className: "ServerListSelectionWindow",
            title: u("ui.sersel.choseServer"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 700,
                height: 510
            },
            hidden: !0
        });
        var m, f, g, _, v, y, w = this, b = null , C = [], I = [], T = {
            0: u("ui.sersel.searchError.unknown"),
            1: u("ui.sersel.searchError.unavailable"),
            2: u("ui.sersel.searchError.no_result"),
            3: u("ui.sersel.searchError.flood")
        }, S = this.windowBody, A = S.createChild("div", {
            className: "findFriendDiv"
        });
        A.createChild("div", {
            className: "findFriendLabel",
            text: u("ui.sersel.findFriend") + ": "
        });
        var E = A.appendChild(new d({
            className: "inputFriend",
            attr: {
                type: "text",
                id: "inputFriend"
            }
        }));
        e(A, ["okBtn", "btn"], function() {
            E.rootElement.value && (f = E.rootElement.value,
            window.dofus.sendMessage("AcquaintanceSearchMessage", {
                nickname: f
            }))
        }),
        e(A, ["clearBtn", "btn"], function() {
            E.rootElement.value = "",
            _ = null ,
            i()
        });
        var x = S.createChild("div", {
            className: "middleDiv"
        })
          , M = x.createChild("div", {
            className: "leftFrame"
        })
          , N = M.createChild("div", {
            className: "serverList"
        })
          , R = N.createChild("div", {
            className: "div-table"
        })
          , O = R.createChild("div", {
            className: ["listHead", "listRow", "odd"]
        });
        O.createChild("div", {
            className: ["listHeadBox", "empty"]
        }),
        O.createChild("div", {
            className: ["listHeadBox", "name"],
            text: u("ui.common.name")
        }),
        O.createChild("div", {
            className: ["listHeadBox", "population"],
            text: u("ui.sersel.population")
        }),
        O.createChild("div", {
            className: ["listHeadBox", "status"],
            text: u("ui.sersel.state")
        });
        var P = x.createChild("div", {
            className: "rightFrame"
        });
        P.createChild("div", {
            className: "title",
            text: u("ui.sersel.suggestedServer") + ":"
        });
        var D = P.appendChild(new l)
          , L = M.createChild("div", {
            className: "filtersBtn"
        })
          , B = e(L, "allServersBtn", function() {
            o(),
            i()
        })
          , k = e(L, "myServersBtn", function() {
            p(),
            i()
        })
          , F = S.createChild("div", {
            className: "topBtnDiv"
        })
          , H = F.appendChild(new c(u("ui.common.validation"),{
            className: "confirmBtn"
        }));
        H.on("tap", function() {
            b && (H.disable(),
            window.gui.serversData.selectServer(b.data.id))
        });
        var G = S.createChild("div", {
            className: "bottomLeftBtnDiv"
        })
          , U = G.appendChild(new c(u("ui.common.back"),{
            className: "returnBtn"
        }));
        U.on("tap", function() {
            h.close(w.id)
        });
        var j = S.createChild("div", {
            className: "bottomRightBtnDiv"
        })
          , q = j.appendChild(new c(u("ui.sersel.autochoice"),{
            className: "autochooseBtn"
        }));
        q.on("tap", function() {
            window.gui.serversData.pickUpOneServerForMe()
        }),
        this.on("open", function() {
            m = window.gui.serversData.serversRawData,
            t(),
            window.gui.serversData.getAutoChosenServers(function(e, t) {
                e && console.warn(e),
                g = t || [],
                v = !1,
                B.delClassNames("selected"),
                y = !1,
                k.delClassNames("selected"),
                C = [];
                for (var n = 0, o = g.length; n < o; n += 1)
                    C.push(g[n].id);
                i(),
                window.gui.on("serversUpdate", i)
            })
        }),
        this.on("close", function() {
            window.gui.removeListener("serversUpdate", i)
        }),
        window.gui.on("AcquaintanceSearchErrorMessage", function(e) {
            var t = e.reason;
            t && window.gui.openPopup({
                title: u("ui.common.error"),
                message: T[t].replace("%1", f)
            })
        }),
        window.gui.on("AcquaintanceServerListMessage", function(e) {
            _ = e.servers,
            i()
        }),
        window.gui.on("TrustStatusMessage", function() {
            h.close(w.id)
        })
    }
    i(802);
    var o = i(26).inherits
      , s = i(402)
      , a = i(32)
      , r = i(803)
      , l = i(799)
      , c = i(204).DofusButton
      , u = i(35).getText
      , h = i(22)
      , d = i(391);
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, "div", {
            className: ["ServerRow", "listRow"]
        }),
        a(this),
        t && this.addClassNames("odd"),
        this._DEFAULT_POPULATION_CLASSES = ["listBox", "listCell", "population"],
        this._DEFAULT_NAME_CLASSES = ["listBox", "listCell", "name"];
        var i = this.createChild("div", {
            className: ["listBox", "listCell", "flag"]
        });
        this._flag = i.createChild("div", {
            className: "flagImage"
        }),
        this._serverName = this.createChild("div", {
            className: this._DEFAULT_NAME_CLASSES
        }),
        this._population = this.createChild("div", {
            className: this._DEFAULT_POPULATION_CLASSES
        });
        var n = this.createChild("div", {
            className: ["listBox", "listCell", "status"]
        });
        this._status = n.createChild("div", {
            className: "statusImage"
        }),
        this.setServer(e)
    }
    i(804);
    var o = i(26).inherits
      , s = i(190)
      , a = i(32)
      , r = i(5);
    o(n, s),
    e.exports = n,
    n.prototype.setServer = function(e) {
        if (!e)
            return this._flag.hide(),
            this._serverName.setText(""),
            this._population.setText(""),
            void this._status.hide();
        var t = this;
        this.id = e.id,
        this.data = e;
        var i = window.gui.serversData.staticContent
          , n = window.gui.serversData.staticContent.data[this.id] || {};
        this._flag.show(),
        this._status.show(),
        this._serverName.setText(n.nameId || e.id),
        this._serverName.setClassNames(this._DEFAULT_NAME_CLASSES),
        1 === n.gameTypeId && this._serverName.setClassNames(this._DEFAULT_NAME_CLASSES, "heroic"),
        this._population.setClassNames(this._DEFAULT_POPULATION_CLASSES, "popu_", n.populationId);
        var o = i.populations[n.populationId] || {};
        this._population.setText(o.nameId || "n/a"),
        this._status.setClassNames(["statusImage", "status_" + e.status]),
        r.preloadImage("gfx/flags/flag_" + n.communityId + ".png", function(e) {
            t._flag.setStyle("backgroundImage", e)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            d = o.filter(function(e) {
                return e.charactersCount > 0
            }),
            d.sort(function(e, t) {
                return e.isSelectable === t.isSelectable ? t.date - e.date : !e.isSelectable
            })
        }
        function t(e) {
            p && p.delClassNames("selected"),
            p = e,
            e && (e.addClassNames("selected"),
            g = e.data.id,
            m.selectBtn.enable())
        }
        function i() {
            e(),
            t(null );
            for (var i = 0; i < f; i += 1) {
                var n = v[i]
                  , o = d[i + _];
                n.setServer(o),
                o && o.id === g && o.status === u.ONLINE && t(n)
            }
            _ <= 0 ? w.disable() : w.enable(),
            _ >= d.length - f ? C.disable() : C.enable()
        }
        function n(e) {
            var i = b.appendChild(new l(e));
            i.on("tap", function() {
                t(this)
            }),
            v.push(i)
        }
        a.call(this, {
            className: "ServerSelectionWindow",
            title: c("ui.sersel.choseServer"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 700,
                height: 445
            },
            hidden: !0
        });
        var o, d, p, m = this, f = 4, g = null , _ = 0, v = [];
        this.closeButton.on("tap", function() {
            window.dofus.disconnect()
        });
        var y = this.windowBody
          , w = y.appendChild(new s({
            className: ["arrow", "arrowLeft"]
        },function() {
            _ <= 0 || (w.disable(),
            _ -= 1,
            i())
        }
        ));
        w.on("disabled", function() {
            this.addClassNames("disabled")
        }),
        w.on("enabled", function() {
            this.delClassNames("disabled")
        });
        var b = y.createChild("div", {
            className: "serverBoxesDiv"
        })
          , C = y.appendChild(new s({
            className: ["arrow", "arrowRight"]
        },function() {
            _ >= d.length - f || (C.disable(),
            _ += 1,
            i())
        }
        ));
        C.on("disabled", function() {
            this.addClassNames("disabled")
        }),
        C.on("enabled", function() {
            this.delClassNames("disabled")
        });
        for (var I = 0; I < f; I += 1)
            n();
        var T = y.appendChild(new s({
            className: ["greenButton", "selectServerBtn"],
            text: c("ui.common.select")
        },function() {
            T.disable(),
            window.gui.serversData.connectedServerId === g ? (window.dofus.sendMessage("CharactersListRequestMessage"),
            r.close(m.id)) : window.gui.serversData.selectServer(g)
        }
        ));
        this.selectBtn = T,
        T.disable();
        var S = y.createChild("div", {
            className: "createCharacterDiv"
        });
        S.appendChild(new s({
            className: ["greenButton", "createCharacterBtn"],
            text: c("ui.charsel.createCharacter")
        },function() {
            r.close(m.id),
            r.open("serverSimpleSelection")
        }
        )),
        window.gui.on("TrustStatusMessage", function() {
            r.close(m.id)
        }),
        this.on("open", function() {
            o = window.gui.serversData.serversRawData,
            e(),
            g || (g = h.getValue("lastServerId")),
            _ = 0,
            w.disable(),
            d.length <= f && C.disable(),
            i(),
            window.gui.on("serversUpdate", i),
            m.consoleButton.toggleDisplay(window.gui.playerData.identification.hasRights)
        }),
        this.on("close", function() {
            window.gui.removeListener("serversUpdate", i)
        }),
        this.consoleButton = y.appendChild(new s({
            className: ["consoleButton"],
            hidden: !0
        },function() {
            r["switch"]("adminConsole")
        }
        ))
    }
    i(806);
    var o = i(26).inherits
      , s = i(204)
      , a = i(402)
      , r = i(22)
      , l = i(807)
      , c = i(35).getText
      , u = i(482)
      , h = i(30);
    o(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: "ServerBox"
        }),
        a(this),
        this._SERVER_STATUS = {
            0: r("ui.server.state.unknown"),
            1: r("ui.server.state.offline"),
            2: r("ui.server.state.starting"),
            3: r("ui.server.state.online"),
            4: r("ui.server.state.nojoin"),
            5: r("ui.server.state.saving"),
            6: r("ui.server.state.stoping"),
            7: r("ui.server.state.full")
        },
        this._completions = [],
        this._title = this.createChild("div", {
            className: "title"
        }),
        this._content = this.createChild("div", {
            className: "content"
        }),
        this._placeholder = this.createChild("div", {
            className: "placeholderDiv"
        }),
        this._content.createChild("div", {
            className: "selection"
        }),
        this._image = this._content.createChild("div", {
            className: "image"
        });
        for (var t = 0; t < 5; t += 1)
            this._completions.push(this._content.createChild("div", {
                className: "completion"
            }));
        this._heroicIcon = this._content.createChild("div", {
            className: "heroicIcon"
        });
        var i = this._content.createChild("div", {
            className: "statusBlock"
        });
        this._statusIcon = i.createChild("div", {
            className: "statusIcon"
        }),
        this._statusText = i.createChild("div", {
            className: "statusText"
        }),
        this.setServer(e)
    }
    i(808);
    var o = i(26).inherits
      , s = i(190)
      , a = i(32)
      , r = i(35).getText
      , l = i(481)
      , c = i(482);
    o(n, s),
    e.exports = n,
    n.prototype.setServer = function(e) {
        var t = this;
        if (this.delClassNames("placeHolder"),
        this._placeholder.hide(),
        !e)
            return this.addClassNames("placeHolder"),
            this.disable(),
            this._content.hide(),
            this._placeholder.show(),
            void this._title.setText("");
        this._title.setText(e._name || "");
        for (var i = 0, n = this._completions.length; i < n; i += 1) {
            var o = this._completions[i];
            i < e.charactersCount ? o.addClassNames("on") : o.delClassNames("on")
        }
        var s = 1 === e._gameTypeId;
        this._heroicIcon.toggleDisplay(s),
        this.data = e,
        e.status === c.ONLINE ? this.enable() : this.disable(),
        this._statusIcon.setClassNames(["statusIcon", "status_" + e.status]),
        this._statusText.setText(this._SERVER_STATUS[e.status || 0]),
        this._content.show(),
        l.getServerImage(e.id, function(e, i) {
            return e ? console.error(e) : void t._image.setStyle("backgroundImage", i)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "ServerSimpleSelectionWindow",
            title: l("ui.sersel.choseServer"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 700,
                height: 400
            },
            hidden: !0
        }),
        this.once("open", n.prototype._createContent)
    }
    i(810);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(5);
    o(n, s),
    e.exports = n,
    n.prototype._createContent = function() {
        var e = this
          , t = this.windowBody
          , i = t.createChild("div", {
            className: "bg"
        });
        c.preloadImage("gfx/illusUi/simpleServerChoiceIllu.png", function(e) {
            i.setStyle("backgroundImage", e)
        });
        var n = t.appendChild(new r(l("ui.sersel.autoChoice"),{
            className: "autoSelectServerBtn"
        }));
        n.on("tap", function() {
            window.gui.serversData.pickUpOneServerForMe()
        });
        var o = t.createChild("div", {
            className: "manualCreationDiv"
        })
          , s = o.appendChild(new r(l("ui.sersel.manualChoice"),{
            className: "manualCreationBtn"
        }));
        s.on("tap", function() {
            a.open("serverListSelection")
        }),
        this.on("close", function(e) {
            e && e.validated || a.open("serverSelection")
        }),
        window.gui.on("TrustStatusMessage", function() {
            a.close(e.id, {
                validated: !0
            })
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, {
            className: "teleporterListWindow",
            title: "_",
            positionInfo: {
                left: "c",
                top: "c",
                width: "600",
                height: "440"
            }
        });
        var e = this;
        this.parentBody = null ,
        this.zaapBody = this.windowBody.createChild("div", {
            className: ["teleporterBody", "zaapBody"]
        }),
        this.subwayBody = this.windowBody.createChild("div", {
            className: ["teleporterBody", "subwayBody"]
        }),
        this.createTabs(this.zaapBody, [{
            title: p("ui.zaap.zaap"),
            name: "Zaap"
        }, {
            title: p("ui.zaap.prism"),
            name: "Prism"
        }]),
        this.createTabs(this.subwayBody, [{
            title: p("ui.map.craftHouse"),
            name: "CraftHouse"
        }, {
            title: p("ui.map.bidHouse"),
            name: "BidHouse"
        }, {
            title: p("ui.common.misc"),
            name: "Misc"
        }]),
        this.createFooter(),
        window.gui.on("ZaapListMessage", function(t) {
            e.setContent(t)
        }),
        window.gui.on("TeleportDestinationsListMessage", function(t) {
            e.setContent(t)
        })
    }
    i(812);
    var o, s, a, r = i(26).inherits, l = i(402), c = i(190), u = i(204), h = i(32), d = i(22), p = i(35).getText, m = i(210), f = i(682), g = i(485), _ = i(813), v = 3, y = 2;
    r(n, l),
    e.exports = n,
    n.prototype.createTabs = function(e, t) {
        e.tabs = new f,
        e.appendChild(e.tabs),
        e.panels = e.createChild("div", {
            className: "panels"
        }),
        e.panelCollection = {};
        for (var i = 0, n = t.length; i < n; i += 1) {
            var o = t[i].name;
            e.panelCollection[o] = e.panels.createChild("div", {
                className: ["panel"]
            }),
            e.tabs.addTab(t[i].title, e.panelCollection[o]),
            this.createTable(e.panelCollection[o])
        }
    }
    ,
    n.prototype.createTable = function(e) {
        function t(t) {
            e.selectedTeleporterType = t.teleporterType,
            e.selectedMapId = t.mapId
        }
        var i = p("ui.zaap.destination") + p("ui.common.colon")
          , n = p("ui.common.area") + " (" + p("ui.common.subarea") + ")";
        e.table = e.appendChild(new g({
            colIds: ["saved", "destination", "coordinates", "cost"],
            colCount: 4,
            highlightable: !0,
            headerContent: ["", i + n, p("ui.common.coordinatesSmall"), p("ui.common.cost")],
            onRowTap: t
        }))
    }
    ,
    n.prototype.createFooter = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: "footer"
        })
          , i = t.appendChild(new u({
            className: "greenButton",
            text: p("ui.common.validation")
        }));
        i.on("tap", function() {
            var t = e.parentBody.tabs.getCurrentTab().target;
            window.dofus.sendMessage("TeleportRequestMessage", {
                teleporterType: t.selectedTeleporterType,
                mapId: t.selectedMapId
            })
        }),
        this.nbKamas = t.createChild("div", {
            className: "nbKamas"
        })
    }
    ,
    n.prototype.setContent = function(e) {
        switch (d.openDialog(this.id),
        this.setClassNames("window", "teleporterListWindow"),
        o = window.gui.playerData.inventory.kamas,
        s = window.gui.playerData.position.mapId,
        a = window.gui.playerData.position.subArea.nameId,
        e.teleporterType) {
        case _.TELEPORTER_ZAAP:
        case _.TELEPORTER_PRISM:
            this.setupZaapBody(e);
            break;
        case _.TELEPORTER_SUBWAY:
            this.setupSubwayBody(e)
        }
        this.nbKamas.setText(m.kamasToString(o, ""))
    }
    ,
    n.prototype.setupZaapBody = function(e) {
        var t, i, n;
        n = p(e.teleporterType === _.TELEPORTER_ZAAP ? "ui.zaap.zaap" : "ui.zaap.prism"),
        this.windowTitle.setText(n + " - " + a),
        s === e.spawnMapId ? this.windowTitle.addClassNames("saved") : this.windowTitle.delClassNames("saved"),
        this.parentBody = this.zaapBody,
        this.zaapBody.show(),
        this.subwayBody.hide();
        for (t in this.zaapBody.panelCollection)
            i = this.zaapBody.panelCollection[t],
            i.table && i.table.clearContent();
        var o = e._subAreas.length
          , r = [];
        for (t = 0; t < o; t += 1) {
            var l = e._subAreas[t]
              , c = e._maps[t]
              , u = e.destTeleporterType[t];
            r.push({
                name: l.areaName + " (" + l.name + ")",
                type: u,
                posX: c.posX,
                posY: c.posY,
                mapId: c.id,
                teleporterCost: e.costs[t],
                saved: c.id === e.spawnMapId
            })
        }
        for (r.sort(function(e, t) {
            return e.name > t.name ? 1 : -1
        }),
        t = 0; t < o; t += 1) {
            var h = r[t]
              , d = h.type === _.TELEPORTER_ZAAP || h.type === _.TELEPORTER_PRISM;
            if (h.mapId !== s && d) {
                var m;
                h.type === _.TELEPORTER_ZAAP && (m = this.zaapBody.panelCollection.Zaap),
                h.type === _.TELEPORTER_PRISM && (m = this.zaapBody.panelCollection.Prism),
                this.addTeleporter({
                    parentPanel: m,
                    teleporterType: h.type,
                    destinationName: h.name,
                    posX: h.posX,
                    posY: h.posY,
                    mapId: h.mapId,
                    teleporterCost: h.teleporterCost,
                    saved: h.saved
                })
            }
        }
        this.setupTabs()
    }
    ,
    n.prototype.setupSubwayBody = function(e) {
        var t, i, n;
        this.windowTitle.setText(p("ui.zaap.zaapi") + " - " + a),
        s === e.spawnMapId ? this.windowTitle.addClassNames("saved") : this.windowTitle.delClassNames("saved"),
        this.parentBody = this.subwayBody,
        this.zaapBody.hide(),
        this.subwayBody.show();
        for (t in this.subwayBody.panelCollection)
            i = this.subwayBody.panelCollection[t],
            i.table && i.table.clearContent();
        var o = e._hints.length
          , r = [];
        for (t = 0; t < o; t += 1)
            n = e._hints[t],
            r.push({
                name: n.nameId,
                category: n.categoryId,
                posX: n.x,
                posY: n.y,
                mapId: n.mapId,
                teleporterCost: n.teleporterCost,
                saved: n.mapId === e.spawnMapId
            });
        for (r.sort(function(e, t) {
            return e.name > t.name ? 1 : -1
        }),
        t = 0; t < o; t += 1)
            if (n = r[t],
            n.mapId !== s) {
                var l;
                l = n.category === v ? this.subwayBody.panelCollection.CraftHouse : n.category === y ? this.subwayBody.panelCollection.BidHouse : this.subwayBody.panelCollection.Misc,
                this.addTeleporter({
                    parentPanel: l,
                    teleporterType: _.TELEPORTER_SUBWAY,
                    destinationName: n.name,
                    posX: n.posX,
                    posY: n.posY,
                    mapId: n.mapId,
                    teleporterCost: n.teleporterCost,
                    saved: n.saved
                })
            }
        this.setupTabs()
    }
    ,
    n.prototype.addTeleporter = function(e) {
        var t = new c("div");
        t.createChild("div", {
            className: "destinationName",
            text: e.destinationName
        });
        var i = t.appendChild(new u({
            className: "btnMapLocation"
        }))
          , n = e.teleporterCost
          , s = e.parentPanel.table.addRow({
            saved: e.saved ? new c("div",{
                className: "saved"
            }) : "",
            destination: t,
            coordinates: e.posX + "," + e.posY,
            cost: m.kamasToString(n)
        }, {
            teleporterType: e.teleporterType,
            mapId: e.mapId
        });
        h(i),
        o < n && s.addClassNames("disabled"),
        i.on("tap", function() {
            window.gui.emit("CompassUpdateMessage", {
                type: "zaap",
                worldX: e.posX,
                worldY: e.posY
            }),
            d.open("worldMap", {
                x: e.posX,
                y: e.posY
            })
        })
    }
    ,
    n.prototype.setupTabs = function() {
        var e = this.parentBody.tabs
          , t = e.getTabsMap()
          , i = !1;
        for (var n in t) {
            var o = t[n];
            o.target.table.getRows().length <= 0 ? o.tab.disable() : (o.tab.enable(),
            i || (e.openFirstTab(),
            i = !0))
        }
        if (!i) {
            var s = e.getFirstTab();
            s.tab.enable(),
            e.openFirstTab()
        }
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        TELEPORTER_ZAAP: 0,
        TELEPORTER_SUBWAY: 1,
        TELEPORTER_PRISM: 2
    }
}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: n.objectUID,
                quantity: m ? -e : e
            })
        }
        function i(e, i, o, s) {
            return m = s || !1,
            n = e.itemInstance,
            1 === n.quantity ? t(1, m) : (r = "items",
            void g.open({
                min: 1,
                max: n.quantity,
                x: i,
                y: o
            }))
        }
        d.call(this, {
            title: a("ui.common.inventory"),
            className: "ExchangeInventoryWindow",
            positionInfo: {
                right: "0.5%",
                bottom: "3%",
                width: "30%",
                height: "94%"
            }
        });
        var n, r, m, f;
        e.registerView(this, {
            leftArrow: !0
        });
        var g = this.minMaxSelector = window.gui.windowsContainer.appendChild(new c);
        g.on("confirm", function(e) {
            "items" === r ? t(e) : window.dofus.sendMessage("ExchangeObjectMoveKamaMessage", {
                quantity: e
            })
        });
        var _ = this.windowBody.appendChild(new o(a("tablet.exchange.deposit")));
        _.addClassNames("depositButton"),
        _.on("tap", function() {
            var t = e.kamasValue;
            if (t) {
                var i = p.getWindow("exchangeStorage");
                i.closeMinMaxSelector(),
                u.positionNextTo(g, _),
                r = "kamas",
                g.open({
                    min: 1,
                    max: t
                })
            }
        }),
        this.on("open", function(t) {
            f = t.exchangeType,
            f === s.STORAGE && e.addFilters([l.unlinkedItemsFilter]),
            e.filterList(),
            e.resetDisplay(),
            this.windowBody.appendChild(_),
            _.toggleDisplay(t.exchangeType !== s.MOUNT),
            _.setEnable(!!e.kamasValue)
        }),
        this.on("close", function() {
            f === s.STORAGE && e.removeFilter(l.unlinkedItemsFilter),
            g.closeMinMax(),
            f = null
        }),
        this.on("kamasUpdated", function(e) {
            _.isVisible() && _.setEnable(!!e)
        }),
        this.on("slot-doubletap", i),
        this.on("leftArrow-tap", function(t) {
            window.gui.openContextualMenu("storage", {
                toInventory: !1,
                viewer: e
            }, {
                x: t.x,
                y: t.y
            })
        }),
        h(this, ["exchangeStorage"]),
        this.on("drop", function(e, t, n) {
            i(e, n.x, n.y, !0)
        })
    }
    i(815);
    var o = i(204).DofusButton
      , s = i(418)
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(323)
      , c = i(201)
      , u = i(203)
      , h = i(186).setDroppable
      , d = i(402)
      , p = i(22);
    r(n, d),
    e.exports = n,
    n.prototype.closeMinMaxSelector = function() {
        this.minMaxSelector.closeMinMax()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: l.objectUID,
                quantity: f ? e : -e
            })
        }
        function i(e, i, n, o) {
            return f = o || !1,
            l = e.itemInstance,
            1 === l.quantity ? t(1) : (m = "items",
            void _.open({
                min: 1,
                max: l.quantity,
                x: i,
                y: n
            }))
        }
        function n(e) {
            c.createItemInstances(e, function(e, t) {
                return e ? console.error(e) : (g.addItems(t.map),
                void g.setWeight(Object.keys(g.itemList).length))
            })
        }
        d.call(this, {
            className: "ExchangeStorageWindow",
            positionInfo: {
                left: "0.5%",
                bottom: "3%",
                width: "30%",
                height: "94%"
            }
        });
        var l, m, f, g = e;
        g.registerView(this, {
            rightArrow: !0
        });
        var _ = this.minMaxSelector = window.gui.windowsContainer.appendChild(new u);
        _.on("confirm", function(e) {
            "items" === m ? t(e) : window.dofus.sendMessage("ExchangeObjectMoveKamaMessage", {
                quantity: -e
            })
        });
        var v = this.windowBody.appendChild(new o({
            className: "greenButton",
            text: r("tablet.exchange.withdraw")
        }));
        v.addClassNames("withdrawButton"),
        v.on("tap", function() {
            var e = g.kamasValue;
            if (e) {
                var t = p.getWindow("exchangeInventory");
                t.closeMinMaxSelector(),
                h.positionNextTo(_, v),
                m = "kamas",
                _.open({
                    min: 1,
                    max: e
                })
            }
        }),
        this.on("open", function(e) {
            var t;
            switch (e.exchangeType) {
            case a.TAXCOLLECTOR:
                t = r("ui.common.taxCollector");
                break;
            case a.STORAGE:
                t = r("ui.common.storage");
                break;
            case a.MOUNT:
                t = r("ui.common.ride");
                break;
            default:
                console.warn("Unexpected exchangeType value:", e.exchangeType),
                t = r("ui.common.storage")
            }
            this.setTitle(t),
            this.windowBody.appendChild(v),
            v.setEnable(!!g.kamasValue),
            v.toggleDisplay(e.exchangeType !== a.MOUNT)
        }),
        this.on("close", function() {
            _.closeMinMax()
        }),
        this.on("kamasUpdated", function(e) {
            v.isVisible() && v.setEnable(!!e)
        }),
        this.on("rightArrow-tap", function(e) {
            window.gui.openContextualMenu("storage", {
                toInventory: !0,
                viewer: g
            }, {
                x: e.x,
                y: e.y
            })
        }),
        this.on("slot-doubletap", i),
        s(this, ["exchangeInventory"]),
        this.on("drop", function(e, t, n) {
            i(e, n.x, n.y, !0)
        });
        var y = window.gui;
        y.on("ExchangeStartedWithStorageMessage", function(e) {
            g.setMaxWeight(e.storageMaxSlot),
            p.openDialog(["exchangeInventory", "exchangeStorage"], e)
        }),
        y.on("ExchangeStartedMountStockMessage", function(e) {
            p.openDialog(["exchangeInventory", "exchangeStorage"], {
                exchangeType: a.MOUNT
            }),
            c.createItemInstances(e.objectsInfos, function(e, t) {
                return e ? console.error(e) : void g.setItemList(t.map)
            })
        }),
        y.on("ExchangeStartedMessage", function(e) {
            e.exchangeType === a.TAXCOLLECTOR && p.openDialog(["exchangeInventory", "exchangeStorage"], e)
        }),
        y.on("StorageInventoryContentMessage", function(e) {
            g.setKamas(e.kamas),
            g.setWeight(e.objects.length),
            c.createItemInstances(e.objects, function(e, t) {
                return e ? console.error(e) : void g.setItemList(t.map)
            })
        }),
        y.on("StorageKamasUpdateMessage", function(e) {
            g.setKamas(e.kamasTotal)
        }),
        y.on("ExchangeWeightMessage", function(e) {
            g.setWeight(e.currentWeight, e.maxWeight)
        }),
        y.on("StorageObjectUpdateMessage", function(e) {
            n([e.object])
        }),
        y.on("StorageObjectsUpdateMessage", function(e) {
            n(e.objectList)
        }),
        y.on("StorageObjectRemoveMessage", function(e) {
            g.removeItem(e.objectUID),
            g.setWeight(g.weight - 1)
        }),
        y.on("StorageObjectsRemoveMessage", function(e) {
            g.removeItems(e.objectUIDList),
            g.setWeight(g.weight - e.objectUIDList.length)
        })
    }
    i(817);
    var o = i(204)
      , s = i(186).setDroppable
      , a = i(418)
      , r = i(35).getText
      , l = i(26).inherits
      , c = i(323)
      , u = i(201)
      , h = i(203)
      , d = i(402)
      , p = i(22);
    l(n, d),
    e.exports = n,
    n.prototype.closeMinMaxSelector = function() {
        this.minMaxSelector.closeMinMax()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        g.call(this, {
            className: "tradeItemWindow",
            noCloseButton: !0,
            fixed: !0,
            positionInfo: {
                width: y,
                height: w
            }
        }),
        this._setupEvents(),
        this.mode = "",
        this.item = null ,
        this.msg = null ,
        this.itemDescription = null ,
        this.settingBox = null ,
        this.selection = null ,
        this.tradeItemConfirm = null ,
        this.isTradePending = !1,
        this.tradeTimeout = null ,
        this.on("open", function(e) {
            switch (this.tradeItemConfirm = null ,
            this.isTradePending = !1,
            this.tradeTimeout = null ,
            this.itemDescription || this._createDom(),
            this.buyHardSoftDiv.hide(),
            this.msg._messageType) {
            case "ExchangeStartOkNpcShopMessage":
            case "ExchangeStartOkHumanVendorMessage":
            case "ExchangeShopStockStartedMessage":
                this.settingBox = this.exchangeBox,
                "buy-human" === e.mode && this.buyHardSoftDiv.show(),
                _.arrangeOpeningWindow(this.id, {
                    rightOf: "tradeStorage",
                    height: w
                });
                break;
            case "ExchangeStartedBidSellerMessage":
                this.settingBox = this.bidHouseSellerBox,
                this.settingBox.setDescriptorData(this.msg.sellerDescriptor),
                _.arrangeOpeningWindow(this.id, {
                    rightOf: "tradeStorage",
                    height: b
                });
                break;
            case "ExchangeStartedBidBuyerMessage":
                this.settingBox = this.bidHouseBuyerBox,
                this.settingBox.setDescriptorData(this.msg.buyerDescriptor),
                this.buyHardSoftDiv.show(),
                _.arrangeOpeningWindow(this.id, {
                    rightOf: "bidHouseShop",
                    height: "100%"
                });
                break;
            default:
                return
            }
            this._setContent(e.mode, e.item, e.currency)
        }),
        this.on("close", function() {
            this.item = null ,
            this.selection = null ,
            this.isTradePending = !1,
            window.clearTimeout(this.tradeTimeout),
            this._closeTradeConfirmWindow()
        }),
        this.on("closed", function() {
            this.settingBox.hide()
        })
    }
    function o(e, t) {
        return e ? void m.getItems([e], function(i, n) {
            return i ? console.error("Failed to get token " + e + " for trade: " + i) : t(n[0])
        }) : t(null )
    }
    i(819);
    var s = i(820)
      , a = i(821)
      , r = i(204)
      , l = i(49)
      , c = i(822)
      , u = i(35).getText
      , h = i(210)
      , d = i(26).inherits
      , p = i(701)
      , m = i(323)
      , f = i(530)
      , g = i(402)
      , _ = i(22)
      , v = i(633)
      , y = 410
      , w = 392
      , b = 424
      , C = 1e4;
    d(n, g),
    e.exports = n,
    n.minWidth = y,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui;
        l.on("ExchangeStartOkNpcShopMessage", function(t) {
            e.msg = t,
            o(t.tokenId, function(e) {
                e && (t.token = e),
                _.openDialog(["tradeInventory", "tradeStorage"], t)
            })
        }),
        l.on("ExchangeStartOkHumanVendorMessage", function(t) {
            e.msg = t,
            _.openDialog(["wallet", "tradeStorage"], t)
        }),
        l.on("ExchangeShopStockStartedMessage", function(t) {
            e.msg = t,
            _.openDialog(["tradeInventory", "tradeStorage", "tradeMode"], t)
        }),
        l.on("ExchangeStartedBidSellerMessage", function(t) {
            e.msg = t,
            _.openDialog(["tradeInventory", "tradeStorage"], t)
        }),
        l.on("ExchangeStartedBidBuyerMessage", function(t) {
            e.msg = t,
            _.openDialog(["wallet", "bidHouseShop"], t)
        });
        var i = {
            1: u("ui.exchange.cantExchange"),
            2: u("ui.exchange.cantExchangeCharacterOccupied"),
            3: u("ui.exchange.cantExchangeCharacterJobNotEquiped"),
            4: u("ui.craft.notNearCraftTable"),
            5: u("ui.exchange.cantExchangeCharacterOverloaded"),
            6: u("ui.exchange.cantExchangeCharacterNotSuscriber"),
            7: u("ui.exchange.cantExchangeCharacterRestricted"),
            8: u("ui.exchange.cantExchangeBuyError"),
            9: u("ui.exchange.cantExchangeSellError"),
            10: u("ui.exchange.cantExchangeMountPaddockError"),
            11: u("ui.bidhouse.itemNotInBigStore")
        };
        l.on("ExchangeErrorMessage", function(n) {
            var o = i[n.errorType];
            e._concludeTrade(!1, o) || t.openSimplePopup(o)
        }),
        l.on("ObjectErrorMessage", function(t) {
            t.reason === f.INVENTORY_FULL && e._concludeTrade(!1)
        }),
        l.on("exchangeBidHouseBuyError", function() {
            e._concludeTrade(!1, u("tablet.purchaseInHardCcyError"))
        }),
        l.on("exchangeHumanBuyError", function() {
            e._concludeTrade(!1, u("tablet.purchaseInHardCcyError"))
        }),
        l.on("exchangeBidHouseBuySuccess", function() {
            this.send("moneyGoultinesAmountRequest")
        }),
        l.on("exchangeHumanBuySuccess", function() {
            this.send("moneyGoultinesAmountRequest")
        }),
        l.on("ExchangeBidHouseBuyResultMessage", function(t) {
            e._concludeTrade(t.bought, u("tablet.tradeItemFailed"))
        }),
        l.on("ExchangeBuyOkMessage", function() {
            e._concludeTrade(!0),
            _.close(e.id)
        }),
        l.on("ExchangeSellOkMessage", function() {
            e._concludeTrade(!0),
            _.close(e.id)
        }),
        l.on("ExchangeBidHouseItemAddOkMessage", function() {
            e._concludeTrade(!0)
        })
    }
    ,
    n.prototype._beginTrade = function() {
        this.isTradePending = !0,
        this.tradeTimeout = window.setTimeout(function(e) {
            e._tradeTimedOut()
        }, C, this)
    }
    ,
    n.prototype._concludeTrade = function(e, t) {
        return !!this.tradeTimeout && (this.isTradePending = !1,
        window.clearTimeout(this.tradeTimeout),
        this.tradeTimeout = null ,
        this._closeTradeConfirmWindow(),
        !e && t && window.gui.openSimplePopup(t),
        !0)
    }
    ,
    n.prototype._tradeTimedOut = function() {
        this._concludeTrade(!1, u("tablet.tradeItemTimeout"))
    }
    ,
    n.prototype.getCurrentItem = function() {
        return this.selection ? this.selection.item : this.item
    }
    ,
    n.prototype.updateSelection = function(e) {
        if (e) {
            var t = window.gui.playerData.inventory;
            this.buySoftBtn.setEnable(t.kamas >= e.amountSoft),
            this.buySoftBtnLabel.setText(h.intToString(e.amountSoft)),
            this.buyHardBtn.setEnable(!!e.amountHard),
            this.buyHardBtnLabel.setText(e.amountHard ? h.intToString(e.amountHard) : ""),
            e.item !== this.itemDescription.item && this.itemDescription.displayItem(e.item)
        } else {
            this.buySoftBtn.disable(),
            this.buyHardBtn.disable();
            var i = u("ui.common.buy");
            this.buySoftBtnLabel.setText(i),
            this.buyHardBtnLabel.setText(i),
            this._closeTradeConfirmWindow()
        }
        this.selection = e
    }
    ,
    n.prototype.updateHumanBuyQuantityRealtime = function(e) {
        if (!(this.isTradePending || e >= this.selection.qty)) {
            var t = this.selection.item;
            window.gui.chat.logMsg(u("tablet.tradeItemQtyChanged", t.getName(), e)),
            e ? (t.quantity = e,
            this.settingBox.updateSettingBox(this, t),
            this._closeTradeConfirmWindow()) : _.close(this.id)
        }
    }
    ,
    n.prototype.updateBidHouseBuyPriceRealtime = function(e, t) {
        if (this.tradeItemConfirm && !this.isTradePending) {
            var i = this.isHardCcyTrade ? t : e;
            if (i > this.initialPrice)
                return this._closeTradeConfirmWindow();
            this.currentPrice = i,
            this.tradeItemConfirm.updatePriceRealtime(i)
        }
    }
    ,
    n.prototype._confirmTrade = function(e, t) {
        this.isHardCcyTrade = !!e.amountHard,
        this.initialPrice = this.currentPrice = e.amountHard || e.amountSoft,
        this.tradeItemConfirm = _.getWindow("tradeItemConfirm");
        var i = this;
        this.tradeItemConfirm.confirmTrade(e, function(e) {
            e && (i._beginTrade(),
            t())
        })
    }
    ,
    n.prototype._closeTradeConfirmWindow = function() {
        this.tradeItemConfirm && (this.tradeItemConfirm = null ,
        _.close("tradeItemConfirm"))
    }
    ,
    n.prototype._buyInGoultines = function() {
        var e = this.selection
          , t = e.item
          , i = e.amountHard
          , n = e.amountSoft
          , o = e.qty
          , s = "buy-human" === this.mode
          , a = i - window.gui.playerData.inventory.goultines;
        return a > 0 ? v.openNotEnoughHardCurrencyPopup(a) : void this._confirmTrade({
            itemInstance: t,
            amountHard: i,
            qty: o
        }, function() {
            window.dofus.send(s ? "exchangeHumanBuyRequest" : "exchangeBidHouseBuyRequest", {
                uid: t.objectUID,
                qty: o,
                amountHard: i,
                amountSoft: n
            })
        })
    }
    ,
    n.prototype._buyInKamas = function() {
        var e = this.selection
          , t = e.item
          , i = e.qty
          , n = "buy-human" === this.mode
          , o = this;
        this._confirmTrade({
            itemInstance: t,
            amountSoft: e.amountSoft,
            qty: i
        }, function() {
            n ? window.dofus.sendMessage("ExchangeBuyMessage", {
                objectToBuyId: t.objectUID,
                quantity: i
            }) : window.dofus.sendMessage("ExchangeBidHouseBuyMessage", {
                uid: t.objectUID,
                qty: i,
                price: o.currentPrice
            })
        })
    }
    ,
    n.prototype.buyItemFromNpc = function(e, t, i) {
        i = i || e.item.price,
        this._confirmTrade({
            itemInstance: e,
            amountSoft: i * t,
            qty: t,
            token: this.msg.token
        }, function() {
            window.dofus.sendMessage("ExchangeBuyMessage", {
                objectToBuyId: e.item.id,
                quantity: t
            })
        })
    }
    ,
    n.prototype.sellItemToNpc = function(e, t, i) {
        i = i || e.item.price,
        this._confirmTrade({
            isSell: !0,
            itemInstance: e,
            amountSoft: i * t,
            qty: t
        }, function() {
            window.dofus.sendMessage("ExchangeSellMessage", {
                objectToSellId: e.objectUID,
                quantity: t
            })
        })
    }
    ,
    n.prototype.sellItemInMyShop = function(e, t, i) {
        window.dofus.sendMessage("ExchangeObjectMovePricedMessage", {
            objectUID: e.objectUID,
            quantity: t,
            price: i
        })
    }
    ,
    n.prototype.removeItemQuantityFromMyShop = function(e, t) {
        window.dofus.sendMessage("ExchangeObjectMoveMessage", {
            objectUID: e.objectUID,
            quantity: -t
        })
    }
    ,
    n.prototype.modifyItemPriceInMyShop = function(e, t, i) {
        window.dofus.sendMessage("ExchangeObjectModifyPricedMessage", {
            objectUID: e.objectUID,
            quantity: t,
            price: i
        })
    }
    ,
    n.prototype.sellInBidHouse = function(e, t, i, n) {
        return t <= 0 ? window.gui.openSimplePopup(u("ui.error.invalidPrice")) : void this._confirmTrade({
            isSell: !0,
            itemInstance: e,
            amountSoft: t,
            qty: i,
            fee: n
        }, function() {
            window.dofus.sendMessage("ExchangeObjectMovePricedMessage", {
                objectUID: e.objectUID,
                quantity: i,
                price: t
            })
        })
    }
    ,
    n.prototype.removeFromBidHouse = function(e, t, i) {
        window.gui.openConfirmPopup({
            title: u("ui.popup.warning"),
            message: u("ui.bidhouse.doUWithdrawItemBigStore", i + " x " + e.item.nameId, h.kamasToString(t / i)),
            cb: function(n) {
                n && window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                    objectUID: e.objectUID,
                    quantity: -i,
                    price: t
                })
            }
        })
    }
    ,
    n.prototype._createDom = function() {
        this.itemDescription = this.windowBody.appendChild(new p({
            showTitle: !0,
            withCraftBtn: !0
        })),
        _.makeMovable(this, this.itemDescription.getChildren()[0]),
        this.exchangeBox = this.windowBody.appendChild(new c),
        this.bidHouseSellerBox = this.windowBody.appendChild(new s),
        this.bidHouseBuyerBox = this.windowBody.appendChild(new a),
        this._createBuyHardSoftButtons(),
        this.errorBox = this.windowBody.createChild("div", {
            className: "errorBox"
        }),
        this.errorText = this.errorBox.createChild("div", {
            className: "errorText"
        })
    }
    ,
    n.prototype._createBuyHardSoftButtons = function() {
        var e = this.buyHardSoftDiv = this.windowBody.createChild("div", {
            className: "buyHardSoftButtons"
        })
          , t = this;
        this.buyHardBtn = e.appendChild(new r({
            className: ["button", "buyHardBtn"],
            text: u("ui.common.buy"),
            addIcon: !0
        },function() {
            t._buyInGoultines()
        }
        )),
        this.buyHardBtnLabel = this.buyHardBtn.getChildren()[0],
        this.buySoftBtn = e.appendChild(new r({
            className: ["greenButton", "buySoftBtn"],
            text: u("ui.common.buy"),
            addIcon: !0
        },function() {
            t._buyInKamas()
        }
        )),
        this.buySoftBtnLabel = this.buySoftBtn.getChildren()[0]
    }
    ,
    n.prototype.displayItem = function(e, t, i) {
        this.openState ? this._setContent(e, t, i) : _.open(this.id, {
            mode: e,
            item: t,
            currency: i
        })
    }
    ,
    n.prototype._setContent = function(e, t, i) {
        if (e !== this.mode || t !== this.item) {
            this.mode = e,
            this.item = t;
            var n = t.item || t
              , o = n.nameId + " (" + n.id + ") " + u("ui.common.short.level") + " " + n.level;
            this.errorBox.hide(),
            this.setTitle(o),
            this.itemDescription.displayItem(t),
            this.settingBox.updateSettingBox(this, t, i),
            this.errorBox.isVisible() || this.settingBox.show()
        }
    }
    ,
    n.prototype.showError = function(e) {
        this.errorText.setHtml(e),
        this.errorBox.show(),
        this.settingBox.hide()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        p.call(this, "div", {
            className: "BidHouseSellerBox",
            hidden: !0
        }),
        this.tradeItemWindow = null ,
        this.item = {},
        this.mode = null ,
        this.descriptor = null ,
        this.quantity = 0,
        this.price = 0,
        this.fees = 0,
        this._createDom(),
        this._setupEvents()
    }
    function o(e, t, i) {
        m[e.objectGID + "x" + t] = i,
        f[e.objectGID] = t
    }
    function s(e, t) {
        return m[e.objectGID + "x" + t] || 0
    }
    var a = i(26).inherits
      , r = i(208)
      , l = i(35).getText
      , c = i(204)
      , u = i(210)
      , h = i(323)
      , d = i(393)
      , p = i(190)
      , m = {}
      , f = {};
    a(n, p),
    e.exports = n,
    n.prototype.updateSettingBox = function(e, t) {
        var i = this;
        this.tradeItemWindow = e;
        var n = this.mode = e.mode;
        switch (this.item = t,
        this._hideAll(),
        n) {
        case "modify-bidHouse":
            this.priceLabel.setText(u.kamasToString(t.objectPrice)),
            this.priceLabel.show(),
            this.quantityLabel.setText(u.intToString(t.quantity)),
            this.quantityLabel.show(),
            this.quantity = t.quantity,
            this.removeBtn.show(),
            this.timeLeft.setText(t.unsoldDelay + " " + l("ui.common.hourShort")),
            this.timeLeftBox.show();
            break;
        case "sell-bidHouse":
            if (this.descriptor.types.indexOf(t.item.typeId) === -1)
                return e.showError(l("ui.bidhouse.badType"));
            if (t.isLinked())
                return e.showError(l("ui.bidhouse.badExchange"));
            if (t.item.level > this.descriptor.maxItemLevel)
                return e.showError(l("ui.bidhouse.badLevel"));
            this.sellBtn.show(),
            this.sellBtn.disable();
            var o = this.descriptor.quantities;
            this.quantitySelect.clearContent();
            for (var a = 1, r = 0, c = o.length; r < c; r += 1) {
                var d = o[r];
                t.quantity >= d && (this.quantitySelect.addOption(d, d),
                a = d)
            }
            var p = f[t.objectGID]
              , m = p ? Math.min(p, a) : a;
            this.quantitySelect.select(m),
            this.quantitySelect.show();
            var g = s(t, m);
            this.priceInput.setValue(g),
            this.price = g,
            this.priceInput.show(),
            this._updateFees()
        }
        this.quantityBox.show(),
        this.averagePriceBox.show(),
        this.priceBox.show(),
        this._displayAveragePrice(t.item.averagePrice),
        h.getFreshAveragePrice(t.objectGID, function(e) {
            i._displayAveragePrice(e)
        })
    }
    ,
    n.prototype._hideAll = function() {
        this.quantityBox.hide(),
        this.averagePriceBox.hide(),
        this.quantitySelect.hide(),
        this.quantityLabel.hide(),
        this.priceBox.hide(),
        this.priceLabel.hide(),
        this.priceInput.hide(),
        this.timeLeftBox.hide(),
        this.saleFeeBox.hide(),
        this.sellBtn.hide(),
        this.removeBtn.hide()
    }
    ,
    n.prototype.setDescriptorData = function(e) {
        this.descriptor = e
    }
    ,
    n.prototype._displayAveragePrice = function(e) {
        e === -1 ? this.averagePrice.setText(l("ui.item.averageprice.unavailable")) : this.averagePrice.setText(u.kamasToString(e))
    }
    ,
    n.prototype._updateFees = function() {
        this.fees = Math.max(1, Math.round(this.descriptor.taxPercentage * (this.price - (this.item.objectPrice || 0)) / 100)),
        this.saleFee.setText(u.kamasToString(this.fees)),
        this.saleFeeBox.show();
        var e = window.gui.playerData.inventory.kamas >= this.fees;
        this.saleFee.toggleClassName("red", !e),
        this.sellBtn.setEnable(e)
    }
    ,
    n.prototype._setupEvents = function() {
        window.gui.on("disconnect", function() {
            m = {},
            f = {}
        })
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "settingBox"
        })
          , i = this.quantityBox = t.createChild("div", {
            className: ["setting", "quantity"]
        });
        i.createChild("div", {
            className: "label",
            text: l("ui.common.quantity") + l("ui.common.colon")
        }),
        this.quantitySelect = i.appendChild(new d),
        this.quantitySelect.on("change", function(t) {
            e.quantity = t,
            e.price = s(e.item, t),
            e.priceInput.setValue(e.price),
            e._updateFees()
        }),
        this.quantityLabel = i.createChild("div", {
            className: "value"
        });
        var n = this.priceBox = t.createChild("div", {
            className: ["setting", "batchPrice"]
        });
        n.createChild("div", {
            className: "label",
            text: l("ui.bidhouse.setPrice") + l("ui.common.colon")
        }),
        this.priceLabel = n.createChild("div", {
            className: "value"
        }),
        this.priceInput = n.appendChild(new r({
            title: l("ui.bidhouse.setPrice"),
            attr: {
                placeholder: l("tablet.price.placeHolder")
            }
        })),
        this.priceInput.on("change", function(t) {
            e.price = t,
            e._updateFees()
        });
        var a = this.averagePriceBox = t.createChild("div", {
            className: ["setting", "averagePrice"]
        });
        a.createChild("div", {
            className: "label",
            text: l("ui.bidhouse.bigStoreAveragePrice") + l("ui.common.colon")
        }),
        this.averagePrice = a.createChild("div", {
            className: "value"
        });
        var u = this.saleFeeBox = t.createChild("div", {
            className: ["setting", "saleFee"]
        });
        u.createChild("div", {
            className: "label",
            text: l("ui.bidhouse.bigStoreTax") + l("ui.common.colon")
        }),
        this.saleFee = u.createChild("div", {
            className: ["value", "text"]
        });
        var h = this.timeLeftBox = t.createChild("div", {
            className: ["setting", "timeLeft"]
        });
        h.createChild("div", {
            className: "label",
            text: l("ui.bidhouse.bigStoreTime") + l("ui.common.colon")
        }),
        this.timeLeft = h.createChild("div", {
            className: "value"
        });
        var p = this.createChild("div", {
            className: "buttonBox"
        });
        this.sellBtn = p.appendChild(new c({
            className: "greenButton",
            text: l("ui.common.putOnSell")
        },function() {
            return 0 === e.price ? e.priceInput.promptForValue() : (o(e.item, e.quantity, e.price),
            void e.tradeItemWindow.sellInBidHouse(e.item, e.price, e.quantity, e.fees))
        }
        )),
        this.removeBtn = p.appendChild(new c({
            className: "greenButton",
            text: l("ui.common.remove")
        },function() {
            e.tradeItemWindow.removeFromBidHouse(e.item, e.item.objectPrice, e.quantity)
        }
        ))
    }
}
, function(e, t, i) {
    function n() {
        f.call(this, "div", {
            className: "BidHouseBuyerBox",
            hidden: !0
        }),
        this._createDom(),
        this._setupEvents(),
        this.tradeItemWindow = null ,
        this.item = {},
        this.currentOffer = null ,
        this.descriptor = null ,
        this.table = null ,
        this._averagePrice = -1
    }
    function o(e) {
        return e.amountHard = p.computeHardPrice(e.amountSoft),
        e.amountHard ? u.intToString(e.amountHard) : null
    }
    function s(e) {
        return u.intToString(e.amountSoft)
    }
    function a(e, t) {
        var i = this.id;
        switch (i) {
        case "qty":
        case "amountSoft":
        case "amountHard":
            return e[i] - t[i];
        default:
            return 0
        }
    }
    function r(e, t) {
        var i = this.bidHouseBuyerBox;
        i.currentOffer = t,
        i.tradeItemWindow.updateSelection(t)
    }
    var l = i(659)
      , c = i(35).getText
      , u = i(210)
      , h = i(26).inherits
      , d = i(323)
      , p = i(548)
      , m = i(400)
      , f = i(190);
    h(n, f),
    e.exports = n,
    n.prototype.updateDisplay = function() {
        this.tradeItemWindow.updateSelection(null ),
        this.table && (this.table.refreshRows(),
        this.table.unSelectRow()),
        this._setAveragePrice(this._averagePrice)
    }
    ,
    n.prototype.updateSettingBox = function(e, t) {
        var i = this;
        this.tradeItemWindow = e,
        this.item = t,
        e.updateSelection(null ),
        "list" === e.mode ? window.dofus.sendMessage("ExchangeBidHouseListMessage", {
            id: t.id
        }) : window.dofus.sendMessage("ExchangeBidHouseSearchMessage", {
            type: t.typeId,
            genId: t.id
        }),
        this._setAveragePrice(t.averagePrice),
        d.getFreshAveragePrice(t.id, function(e) {
            i._setAveragePrice(e)
        }),
        this.table.clearContent(),
        this.addClassNames("spinner")
    }
    ,
    n.prototype._updateOffer = function(e, t) {
        if (this.currentOffer && e === this.currentOffer.id) {
            if (t > this.currentOffer.amountSoft)
                return this.tradeItemWindow.updateSelection(null );
            this.table.selectRow(e, !0),
            this.tradeItemWindow.updateBidHouseBuyPriceRealtime(t, p.computeHardPrice(t))
        }
    }
    ,
    n.prototype._removeOffer = function(e) {
        this.currentOffer && e === this.currentOffer.id && this.tradeItemWindow.updateSelection(null )
    }
    ,
    n.prototype.setDescriptorData = function(e) {
        function t(e) {
            var t = new f("div",{
                className: "icon"
            });
            return t.setStyle("backgroundImage", e.item.getProperty("image")),
            t
        }
        this.descriptor = e;
        var i = new f("div",{
            className: ["currencyIcon", "soft"]
        })
          , n = new f("div",{
            className: ["currencyIcon", "hard"]
        })
          , l = [{
            id: "icon",
            format: t
        }, {
            id: "qty",
            header: c("ui.common.quantity"),
            sort: a
        }, {
            id: "amountHard",
            header: n,
            format: o,
            sort: a
        }, {
            id: "amountSoft",
            header: i,
            format: s,
            sort: a,
            defaultSorter: !0
        }];
        this.item = null ,
        this.tableBox.clearContent(),
        this.table = this.tableBox.appendChild(new m(l,"id")),
        this.table.bidHouseBuyerBox = this,
        this.table.on("rowTap", r)
    }
    ,
    n.prototype._setupEvents = function() {
        function e(e, t) {
            for (var i = n.descriptor.quantities, o = 0; o < i.length; o++) {
                var s = e.prices[o];
                s && t.push({
                    id: e.getProperty("objectUID") + "x" + i[o],
                    item: e,
                    qty: i[o],
                    amountSoft: s,
                    amountHard: null
                })
            }
        }
        function t(t, i) {
            d.createItemInstances(t, function(t, o) {
                if (t)
                    return console.warn(t);
                var s = o.map
                  , a = [];
                for (var r in s)
                    e(s[r], a);
                if (n.table.addList(a),
                i)
                    for (var l = 0; l < a.length; l++) {
                        var c = a[l];
                        n._updateOffer(c.id, c.amountSoft)
                    }
            })
        }
        function i(e, t) {
            for (var i = n.descriptor.quantities, o = 0; o < i.length; o++) {
                var s = e + "x" + i[o];
                n.table.delRow(s),
                t || n._removeOffer(s)
            }
        }
        var n = this
          , o = window.dofus.connectionManager;
        o.on("ExchangeErrorMessage", function(e) {
            e.errorType === l.BID_SEARCH_ERROR && n.delClassNames("spinner")
        }),
        o.on("ExchangeBidHouseInListUpdatedMessage", function(e) {
            if (e.objGenericId === n.item.id) {
                i(e.itemUID, !0);
                var o = {
                    objectUID: e.itemUID,
                    objectGID: e.objGenericId,
                    prices: e.prices,
                    effects: e.effects,
                    quantity: 1
                };
                t([o], !0)
            }
        }),
        o.on("ExchangeBidHouseInListAddedMessage", function(e) {
            if (e.objGenericId === n.item.id) {
                var i = {
                    objectUID: e.itemUID,
                    objectGID: e.objGenericId,
                    prices: e.prices,
                    effects: e.effects,
                    quantity: 1
                };
                t([i])
            }
        }),
        o.on("ExchangeTypesItemsExchangerDescriptionForUserMessage", function(e) {
            n.table.clearContent(),
            n.delClassNames("spinner");
            for (var i = [], o = e.itemTypeDescriptions, s = n.item.id, a = 0, r = o.length; a < r; a += 1) {
                var l = o[a];
                i.push({
                    objectUID: l.objectUID,
                    objectGID: s,
                    prices: l.prices,
                    effects: l.effects,
                    quantity: 1
                })
            }
            t(i)
        }),
        o.on("ExchangeBidHouseInListRemovedMessage", function(e) {
            i(e.itemUID)
        }),
        p.on("computedHardPricesChange", function() {
            n.table && n.table.refreshRows()
        })
    }
    ,
    n.prototype._setAveragePrice = function(e) {
        if (this._averagePrice = e,
        e === -1)
            return this.averagePrice.setText(c("ui.item.averageprice.unavailable"));
        var t = p.computeHardPrice(e);
        this.averagePrice.setText(u.hardAndSoftToString(t, e))
    }
    ,
    n.prototype._createDom = function() {
        this.tableBox = this.createChild("div", {
            className: "tableBox"
        });
        var e = this.createChild("div", {
            className: ["setting", "averagePrice"]
        });
        e.createChild("div", {
            className: "label",
            text: c("ui.bidhouse.bigStoreAveragePrice") + c("ui.common.colon")
        }),
        this.averagePrice = e.createChild("div", {
            className: "value"
        })
    }
}
, function(e, t, i) {
    function n() {
        u.call(this, "div", {
            className: "ExchangeBox",
            hidden: !0
        }),
        this._createDom(),
        this.mode = null ,
        this.current = {},
        this.tradeItemWindow = null ,
        this.currency = "",
        this.tokenItem = null
    }
    var o = i(26).inherits
      , s = i(208)
      , a = i(35).getText
      , r = i(204)
      , l = i(210)
      , c = i(548)
      , u = i(190)
      , h = 10;
    o(n, u),
    e.exports = n,
    n.prototype._createDom = function() {
        function e() {
            var e = t.current.quantity
              , i = t.current.unitPrice;
            t._updatePrices();
            var n = t.current.quantity !== e || t.current.unitPrice !== i;
            t.modifyButton.setEnable(n)
        }
        var t = this
          , i = this.createChild("div", {
            className: "settingBox"
        })
          , n = i.createChild("div", {
            className: "setting"
        });
        n.createChild("div", {
            className: "label",
            text: a("ui.common.quantity") + a("ui.common.colon")
        });
        var o = this.quantityValue = n.appendChild(new s({
            minValue: 1,
            title: a("ui.common.quantity")
        }));
        o.on("focus", function() {
            o.maxValue = t._getMaxQuantity()
        }),
        o.on("change", e);
        var l = i.createChild("div", {
            className: "setting"
        });
        l.createChild("div", {
            className: "label",
            text: a("ui.common.unitPrice") + a("ui.common.colon")
        }),
        this.unitPriceInput = l.appendChild(new s({
            minValue: 1,
            title: a("ui.common.unitPrice")
        })),
        this.unitPriceInput.on("change", e),
        this.unitPriceValue = l.createChild("div", {
            className: "value"
        });
        var c = this.totalPrice = i.createChild("div", {
            className: "setting"
        });
        c.createChild("div", {
            className: "label",
            text: a("ui.common.totalPrice") + a("ui.common.colon")
        }),
        this.totalPriceValue = c.createChild("div", {
            className: "value"
        });
        var u = this.createChild("div", {
            className: "buttonBox"
        });
        this.removeButton = u.appendChild(new r({
            text: a("ui.common.remove"),
            className: ["greenButton", "removeButton"]
        },function() {
            this.disable(),
            t._updatePrices();
            var e = t.current;
            t.tradeItemWindow.removeItemQuantityFromMyShop(e.item, e.quantity)
        }
        )),
        this.modifyButton = u.appendChild(new r({
            text: a("ui.common.modify"),
            className: "greenButton"
        },function() {
            this.disable(),
            t._updatePrices();
            var e = t.current;
            t.tradeItemWindow.modifyItemPriceInMyShop(e.item, e.quantity, e.unitPrice)
        }
        )),
        this.onSaleButton = u.appendChild(new r({
            text: a("ui.common.putOnSell"),
            className: "greenButton"
        },function() {
            var e = t.current;
            return 0 === e.unitPrice ? t.unitPriceInput.promptForValue() : void t.tradeItemWindow.sellItemInMyShop(e.item, e.quantity, e.unitPrice)
        }
        )),
        this.sellButton = u.appendChild(new r({
            text: a("ui.common.sell"),
            className: "greenButton"
        },function() {
            var e = t.current;
            t.tradeItemWindow.sellItemToNpc(e.item, e.quantity, e.unitPrice)
        }
        )),
        this.buyButton = u.appendChild(new r({
            text: a("ui.common.buy"),
            className: "greenButton"
        },function() {
            var e = t.current;
            t.tradeItemWindow.buyItemFromNpc(e.item, e.quantity, e.unitPrice)
        }
        ))
    }
    ,
    n.prototype._updatePrices = function() {
        var e = "sell-myShop" === this.mode || "modify-myShop" === this.mode
          , t = "buy-human" === this.mode
          , i = e ? this.unitPriceInput.getValue() : this.pricePerUnit
          , n = this.quantityValue.getValue();
        this.current.quantity = n,
        this.current.unitPrice = i;
        var o = n * i
          , s = null ;
        if (this.totalPrice.toggleDisplay(!t),
        t ? (s = c.computeHardPrice(o),
        this.totalPrice.hide(),
        this.tradeItemWindow.updateSelection({
            item: this.current.item,
            amountHard: s,
            amountSoft: o,
            qty: n
        })) : (this.totalPrice.show(),
        this.currency ? this.totalPriceValue.setText(this.currency + " x " + l.intToString(o)) : this.totalPriceValue.setText(l.kamasToString(o))),
        this.buyButton.isVisible()) {
            var a = window.gui.playerData.inventory
              , r = this.tokenItem ? a.getGenericItemCount(this.tokenItem.id) : a.kamas;
            o > r ? (this.buyButton.disable(),
            this.totalPriceValue.addClassNames("red")) : (this.buyButton.enable(),
            this.totalPriceValue.delClassNames("red"))
        }
    }
    ,
    n.prototype._getMaxQuantity = function() {
        var e = window.gui.playerData
          , t = this.current.item;
        return "modify-myShop" === this.mode ? e.myShop.getItemSellableAmount(t.objectGID) : t.quantity
    }
    ,
    n.prototype.updateSettingBox = function(e, t, i) {
        this.tradeItemWindow = e,
        this.current.item = t;
        var n = this.mode = e.mode;
        this.tokenItem = e.msg.token,
        this.currency = i;
        var o = !1
          , s = !1;
        this.totalPriceValue.delClassNames("red"),
        this._hideButtons();
        var r, c = t.getProperty("quantity"), u = 1;
        switch (n) {
        case "modify-myShop":
            o = !0,
            this.removeButton.show(),
            this.removeButton.enable(),
            this.modifyButton.show(),
            this.modifyButton.disable(),
            r = t.getProperty("objectPrice"),
            u = c;
            break;
        case "sell-myShop":
            s = !0,
            o = !0,
            this.onSaleButton.show(),
            r = 0,
            u = c;
            break;
        case "sell-npc":
            s = !0,
            this.sellButton.show();
            var d = t.getProperty("price");
            r = d > 0 ? Math.max(1, Math.floor(d / h)) : 0;
            break;
        case "buy-npc":
            this.buyButton.show(),
            r = t.getProperty("objectPrice") || t.getProperty("price");
            break;
        case "buy-human":
            r = t.getProperty("objectPrice");
            break;
        default:
            throw new Error("Invalid exchange mode: " + n)
        }
        return s && t.isLinked() ? e.showError(a("ui.bidhouse.badExchange")) : (this.pricePerUnit = r,
        this.quantityValue.setValue(u),
        this.quantityValue.setReadonly(1 === c),
        o ? this.unitPriceInput.setValue(r) : this.unitPriceValue.setText(i ? i + " x " + l.intToString(r) : l.kamasToString(r)),
        this.unitPriceInput.toggleDisplay(o),
        this.unitPriceValue.toggleDisplay(!o),
        void this._updatePrices())
    }
    ,
    n.prototype._hideButtons = function() {
        this.removeButton.hide(),
        this.modifyButton.hide(),
        this.onSaleButton.hide(),
        this.sellButton.hide(),
        this.buyButton.hide()
    }
}
, function(e, t, i) {
    function n() {
        l.call(this, {
            title: s("ui.common.confirm"),
            className: "TradeItemConfirmWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 350,
                height: 300,
                isModal: !0
            }
        }),
        this._reset(),
        this.on("open", this._onOpen),
        this.on("close", this._onClose)
    }
    i(824);
    var o = i(204)
      , s = i(35).getText
      , a = i(210)
      , r = i(26).inherits
      , l = i(402)
      , c = i(22)
      , u = i(190);
    r(n, l),
    e.exports = n,
    n.prototype._reset = function() {
        this.cb = null ,
        this.itemLabel = null ,
        this.itemImg = null ,
        this.itemQuantity = null ,
        this.buyBtn = null ,
        this.buyBtnLabel = null
    }
    ,
    n.prototype._onOpen = function() {
        this.itemLabel || this._createContent()
    }
    ,
    n.prototype._onClose = function() {
        this.cb(!1)
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this._reset()
    }
    ,
    n.prototype._createContent = function() {
        var e = this.windowBody.createChild("div", {
            className: "itemLabelBox"
        })
          , t = this.windowBody.createChild("div", {
            className: "twoColumns"
        });
        this.itemLabel = e.createChild("div", {
            className: "itemLabel"
        });
        var i = t.createChild("div", {
            className: "leftCol"
        })
          , n = i.createChild("div", {
            className: "itemContainer"
        });
        this.itemImg = n.createChild("div", {
            className: "itemImg"
        }),
        this.itemQuantity = n.createChild("div", {
            className: "itemQuantity"
        });
        var s = t.createChild("div", {
            className: "rightCol"
        })
          , a = this
          , r = s.createChild("div", {
            className: "btnAndFee"
        });
        this.buyBtn = r.appendChild(new o({
            addIcon: !0,
            className: ["buyBtn", "greenButton"]
        },function() {
            this.disable(),
            a.cb(!0)
        }
        ));
        var l = this.buyBtnIcon = this.buyBtn.getChildren()[0];
        this.buyBtnLabel = this.buyBtn.insertChildBefore(new u("div",{
            className: "btnLabel"
        }), l),
        this.buyBtnAmount = this.buyBtn.insertChildBefore(new u("div",{
            className: "btnAmount"
        }), l),
        this.feeAmount = r.createChild("div", {
            className: "feeAmount"
        })
    }
    ,
    n.prototype.confirmTrade = function(e, t) {
        c.open(this.id);
        var i = e.itemInstance;
        this.itemLabel.setText(i.getName()),
        this.itemImg.setStyle("backgroundImage", i.getProperty("image")),
        this.itemQuantity.setText(1 !== e.qty ? "x" + e.qty : ""),
        this.buyBtnLabel.setText(s(e.isSell ? "ui.common.sell" : "ui.common.buy").toUpperCase()),
        this.buyBtnAmount.setText(a.intToString(e.amountHard || e.amountSoft)),
        this.buyBtn.toggleClassName("hardCcy", !!e.amountHard),
        this.buyBtn.toggleClassName("softCcy", !e.amountHard);
        var n = e.token ? e.token.getProperty("image") : null ;
        this.buyBtnIcon.setStyle("backgroundImage", n),
        this.feeAmount.setText(e.fee ? s("tablet.salesFee") + s("ui.common.colon") + a.kamasToString(e.fee) : ""),
        this.cb = t
    }
    ,
    n.prototype.updatePriceRealtime = function(e) {
        this.buyBtnAmount.setText(a.intToString(e))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, {
            className: "TradeModeWindow",
            noCloseButton: !0,
            noTitle: !0
        });
        var e;
        this.once("open", function() {
            e = this.windowBody.appendChild(new u({
                className: "greenButton",
                text: c("ui.humanVendor.switchToMerchantMode")
            })),
            e.on("tap", function() {
                window.dofus.sendMessage("ExchangeShowVendorTaxMessage")
            })
        }),
        this.on("open", function(e) {
            switch (e._messageType) {
            case "ExchangeShopStockStartedMessage":
                var t = a.minWidth - d
                  , i = o.minWidth + d / 2;
                l.positionWindow(this.id, {
                    left: i,
                    bottom: "5%",
                    width: t,
                    height: 70
                });
                break;
            default:
                throw new Error("Invalid open msg: " + e._messageType)
            }
        }),
        window.gui.on("ExchangeReplyTaxVendorMessage", function(e) {
            return window.gui.openConfirmPopup({
                title: c("ui.humanVendor.poupTitleTaxMessage"),
                message: c("ui.humanVendor.taxPriceMessage", h.kamasToString(e.totalTaxValue)),
                cb: function(e) {
                    e && (l.close("tradeStorage"),
                    window.dofus.sendMessage("ExchangeStartAsVendorMessage"),
                    window.gui.connectionGonnaBeClosed("SWITCHING_TO_HUMAN_VENDOR"))
                }
            })
        })
    }
    i(826);
    var o = i(311)
      , s = i(26).inherits
      , a = i(818)
      , r = i(402)
      , l = i(22)
      , c = i(35).getText
      , u = i(204)
      , h = i(210)
      , d = 20;
    s(n, r),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            return m.types.indexOf(e.item.typeId) !== -1 && (!e.isLinked() && !(e.item.level > m.maxItemLevel))
        }
        function i(i) {
            i !== f && (f = i,
            i ? e.addFilters([t]) : e.removeFilter(t),
            e.filterList())
        }
        function n(e) {
            r._selectItem(e)
        }
        c.call(this, {
            title: h("ui.common.inventory"),
            className: "TradeInventoryWindow"
        });
        var r = this;
        this.mode = null ,
        this.openOnItem = null ,
        this.storageView = e,
        e.registerView(this);
        var m, f = !1, g = new s(h("ui.bidhouse.bigStoreFilter"));
        g.on("change", function(e) {
            i(e)
        }),
        this.on("open", function(t) {
            var n = this.mode = d[t._messageType]
              , s = a.windowFullScreenWidth - o.minWidth - l.minWidth;
            s = Math.max(s, p),
            u.positionWindow(this.id, {
                right: 0,
                top: 0,
                width: s,
                height: "100%"
            }),
            "sell-bidHouse" === n && (e.storageUI.appendChild(g),
            m = t.sellerDescriptor || t.buyerDescriptor,
            i(!0),
            g.activate(!0),
            this.openOnItem && this.navigateToItem(this.openOnItem)),
            t.token && (e.filter.toggleCategoryDisplay(t.token.type.category, !0),
            e.filter.selectCategory(t.token.type.category))
        }),
        this.on("closed", function() {
            "sell-bidHouse" === this.mode && (e.storageUI.removeChild(g),
            i(!1))
        }),
        this.on("slot-tap", function(e) {
            this.mode && u.getWindow("tradeItem").displayItem(this.mode, e.itemInstance)
        }),
        this.on("itemAdded", n),
        this.on("itemQuantity", n),
        this.on("itemRemoved", function(e) {
            var t = u.getWindow("tradeItem")
              , i = t.getCurrentItem();
            i && e === i.getProperty("objectUID") && u.close("tradeItem")
        })
    }
    i(828);
    var o = i(311)
      , s = i(448)
      , a = i(24).dimensions
      , r = i(26).inherits
      , l = i(818)
      , c = i(402)
      , u = i(22)
      , h = i(35).getText
      , d = {
        ExchangeStartOkNpcShopMessage: "sell-npc",
        ExchangeShopStockStartedMessage: "sell-myShop",
        ExchangeStartedBidSellerMessage: "sell-bidHouse"
    }
      , p = 198;
    r(n, c),
    e.exports = n,
    n.prototype.isMyShopOpen = function() {
        return this.openState && "sell-myShop" === this.mode
    }
    ,
    n.prototype.navigateToItem = function(e) {
        this.openOnItem = null ;
        var t, i;
        return "number" == typeof e ? t = e : (t = e.getProperty("id"),
        i = e.getItemInstance()),
        !(!i || !this._selectItem(i, !0)) || !!(i = this.storageView.selectAndShowSlotByGID(t)) && (this._selectItem(i, !0),
        !0)
    }
    ,
    n.prototype._selectItem = function(e, t) {
        return !(!this.mode || "sell-myShop" === this.mode) && (!!this.storageView.selectAndShowSlotByUID(e.objectUID) && (t && u.getWindow("tradeStorage").setFilter(e.getProperty("typeId")),
        u.getWindow("tradeItem").displayItem(this.mode, e),
        !0))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        d.call(this, {
            className: "TradeStorageWindow",
            positionInfo: g
        }),
        this.openOnItem = null ,
        this.mode = null ,
        this.currentItem = null ,
        this.on("open", this._onOpen),
        this.on("closed", this._onClose)
    }
    i(830);
    var o = i(311)
      , s = i(204)
      , a = i(35).getText
      , r = i(210)
      , l = i(26).inherits
      , c = i(323)
      , u = i(387)
      , h = i(206)
      , d = i(402)
      , p = i(22)
      , m = i(190)
      , f = {
        ExchangeStartOkNpcShopMessage: "buy-npc",
        ExchangeShopStockStartedMessage: "modify-myShop",
        ExchangeStartedBidSellerMessage: "modify-bidHouse",
        ExchangeStartOkHumanVendorMessage: "buy-human"
    }
      , g = {
        left: 0,
        top: 0,
        width: 300,
        height: "100%"
    };
    l(n, d),
    e.exports = n,
    n.prototype.navigateToItem = function(e) {
        this.openOnItem = null ;
        var t, i;
        "number" == typeof e ? t = e : (t = e.getProperty("id"),
        i = e.getItemInstance());
        var n = p.getWindow("tradeInventory");
        if (!(n.navigateToItem(e) || i && this._selectItemByUID(i.objectUID, !0))) {
            var o = this.shopViewer.findItemByGID(t);
            o && this._selectItemByUID(o, !0)
        }
    }
    ,
    n.prototype._onOpen = function(e) {
        if (this.mode = f[e._messageType],
        !this.mode)
            return console.error(new Error("Unexpected msg type for TradeStorageWindow: " + e._messageType));
        this.shopViewer || (this._createContent(),
        this._setupEventListeners());
        var t = this
          , i = !1
          , n = !1;
        switch (this.mode) {
        case "buy-npc":
            this.setTitle(a("ui.common.shop")),
            this.shopViewer.table.setSlideEnable(!1);
            break;
        case "modify-myShop":
            this.setTitle(a("ui.common.shop")),
            this.shopViewer.table.setSlideEnable(!0),
            this._slideBack.modify.show(),
            this._slideBack.remove.hide();
            break;
        case "modify-bidHouse":
            this.setTitle(a("ui.common.shopStock"));
            var o = this.descriptor = e.sellerDescriptor;
            this.npcId = o.npcContextualId,
            i = !0,
            this.infoContent.setHtml(this._getBidHouseInfoHtml(o)),
            this._updateItemCount(e.objectsInfos.length),
            this.switchToBuyModeBtn.enable(),
            this.shopViewer.table.setSlideEnable(!0),
            this._slideBack.modify.hide(),
            this._slideBack.remove.show();
            break;
        case "buy-human":
            n = !0,
            window.actorManager.getActorData(e.sellerId, function(e, i) {
                return e ? (console.error(e),
                t.setTitle("")) : void t.setTitle(i.name)
            }),
            this.shopViewer.table.setSlideEnable(!1)
        }
        n ? p.arrangeOpeningWindowVertically(this.id, {
            below: "wallet",
            fullHeight: !0
        }) : p.positionWindow(this.id, g),
        this.headerRow.toggleDisplay(i),
        this.shopViewer.table.setContentLoading(!0),
        c.createItemInstances(e.objectsInfos, function(i, n) {
            return i ? console.error(i) : (t.currency = e.tokenId,
            t.token = e.token || null ,
            t.shopViewer.table.setContentLoading(!1),
            t.shopViewer.setItemList(n.array),
            void (t.openOnItem && t.navigateToItem(t.openOnItem)))
        }),
        this.lastOpenMode !== this.mode && (this.lasOpenMode && this.delClassNames(this.lasOpenMode),
        this.addClassNames(this.mode)),
        this.lasOpenMode = this.mode
    }
    ,
    n.prototype._onClose = function() {
        this.currentItem = null ,
        this.shopViewer.clearContent(),
        p.close("tradeItem")
    }
    ,
    n.prototype._createContent = function() {
        this._createHeader(),
        this._createViewer()
    }
    ,
    n.prototype._createHeader = function() {
        var e = this.headerRow = this.windowBody.createChild("div", {
            className: "headerRow"
        });
        this.itemCountElt = e.createChild("div", {
            className: "itemCount"
        }),
        this.itemCountTooltip = new m("div"),
        h.addTooltip(this.itemCountElt, this.itemCountTooltip),
        this._createInfoButton(),
        this._createSwitchToBuyModeButton()
    }
    ,
    n.prototype._updateItemCount = function(e) {
        this.itemCount = e,
        this.itemCountElt.setText(e + "/" + this.descriptor.maxItemPerAccount),
        this.itemCountTooltip.setText(a("ui.bidhouse.quantityObjectSold", e, this.descriptor.maxItemPerAccount));
    }
    ,
    n.prototype._getBidHouseInfoHtml = function(e) {
        var t = a("ui.common.colon")
          , i = "";
        return e.maxItemLevel < 1e3 && (i += a("ui.common.maxLevel") + t + e.maxItemLevel + "<br/>"),
        i + a("ui.bidhouse.bigStoreTax") + t + e.taxPercentage + "%<br/>" + a("ui.bidhouse.bigStoreMaxSellTime") + t + e.unsoldDelay + " " + a("ui.time.hours", e.unsoldDelay)
    }
    ,
    n.prototype._createInfoButton = function() {
        var e = this.infoContent = new m("div")
          , t = this.headerRow.createChild("div", {
            className: "infoButton"
        });
        h.addTooltip(t, e, {
            openOnTap: !0
        })
    }
    ,
    n.prototype._createSwitchToBuyModeButton = function() {
        var e = this;
        this.switchToBuyModeBtn = this.headerRow.appendChild(new s({
            addIcon: !0,
            className: ["buyModeBtn", "greenButton"],
            tooltip: a("ui.bidhouse.bigStoreModeBuy")
        },function() {
            o.switchBuySellMode(!1, e.npcId),
            this.disable()
        }
        ))
    }
    ,
    n.prototype._createViewer = function() {
        function e(e, t) {
            return e.objectPrice - t.objectPrice
        }
        function t(e) {
            window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: e.objectUID,
                quantity: -e.quantity
            })
        }
        var i = this
          , n = [{
            id: "icon",
            format: function(e) {
                var t = new m("div",{
                    className: "slot"
                })
                  , i = t.createChild("div", {
                    className: "icon"
                });
                return i.setStyle("backgroundImage", e.item.image),
                i.createChild("div", {
                    className: "quantity",
                    text: e.quantity > 1 ? e.quantity : ""
                }),
                t
            }
        }, {
            id: "name",
            header: a("ui.common.name"),
            getContent: function(e) {
                return e.item.nameId
            },
            sort: !0
        }, {
            id: "price",
            header: a("ui.common.price"),
            format: function(e) {
                var t;
                if (i.currency) {
                    t = new m("div",{
                        className: "token"
                    });
                    var n = t.createChild("div", {
                        className: "icon"
                    });
                    n.setStyle("backgroundImage", i.token.image),
                    t.createChild("div", {
                        className: "quantity",
                        text: "x" + e.objectPrice
                    })
                } else
                    t = r.kamasToString(e.objectPrice);
                return t
            },
            sort: e,
            defaultSorter: !0
        }]
          , o = this._slideBack = new m("div",{
            className: "slideBack"
        });
        o.modify = o.createChild("div", {
            className: "modify",
            text: a("ui.common.modify")
        }),
        o.remove = o.createChild("div", {
            className: "remove",
            text: a("ui.common.remove")
        }),
        o.createChild("div", {
            className: ["remove", "right"],
            text: a("ui.common.remove")
        }),
        this.shopViewer = this.windowBody.appendChild(new u(n,function(e) {
            return e.hasOwnProperty("objectUID") ? e.objectUID : e.hasOwnProperty("objectGID") ? e.objectGID : 0
        }
        ,{
            tableOption: {
                slidable: o
            }
        })),
        this.shopViewer.on("itemSelected", function(e) {
            i._showCurrentItem(e)
        }),
        this.shopViewer.on("rowSlidedRight", function(e, i) {
            t(i)
        }),
        this.shopViewer.on("rowSlidedLeft", function(e, n) {
            "modify-myShop" === i.mode ? (i._showCurrentItem(n),
            e.slideBack()) : t(n)
        })
    }
    ,
    n.prototype._showCurrentItem = function(e) {
        this.currentItem = e,
        p.getWindow("tradeItem").displayItem(this.mode, e, this.token && this.token.nameId)
    }
    ,
    n.prototype._selectItemByUID = function(e, t) {
        var i = this.shopViewer.getItem(e);
        return !!i && (t && this.setFilter(i.getProperty("typeId")),
        this.shopViewer.selectItem(e),
        this._showCurrentItem(i),
        !0)
    }
    ,
    n.prototype.setFilter = function(e) {
        return this.shopViewer.selectFilter(e)
    }
    ,
    n.prototype._updateHumanBuyQuantity = function(e) {
        var t = p.getWindow("tradeItem");
        t.updateHumanBuyQuantityRealtime(e),
        e || (this.currentItem = null )
    }
    ,
    n.prototype._setupEventListeners = function() {
        function e(e, t) {
            if ("buy-human" === n.mode && n.currentItem)
                for (var i = n.currentItem.objectUID, o = 0; o < e.length; o++)
                    if (e[o].objectUID === i) {
                        n._updateHumanBuyQuantity(e[o].quantity);
                        break
                    }
            c.createItemInstances(e, function(e, i) {
                return e ? console.error(e) : void (t ? n.shopViewer.addItemsAndHighlightThem(i.array) : n.shopViewer.addItems(i.array))
            })
        }
        function t(e) {
            n.currentItem && e.indexOf(n.currentItem.objectUID) >= 0 && ("buy-human" === n.mode ? n._updateHumanBuyQuantity(0) : "modify-bidHouse" !== n.mode && "modify-myShop" !== n.mode || p.close("tradeItem"));
            for (var t = 0; t < e.length; t++)
                n.shopViewer.table.endSlide(e[t]);
            n.shopViewer.removeItems(e)
        }
        var i = window.dofus.connectionManager
          , n = this;
        i.on("ExchangeShopStockMultiMovementUpdatedMessage", function(t) {
            e(t.objectInfoList)
        }),
        i.on("ExchangeShopStockMovementUpdatedMessage", function(t) {
            var i = "modify-myShop" === n.mode;
            e([t.objectInfo], i)
        }),
        i.on("ExchangeShopStockMultiMovementRemovedMessage", function(e) {
            t(e.objectIdList)
        }),
        i.on("ExchangeShopStockMovementRemovedMessage", function(e) {
            t([e.objectId])
        }),
        i.on("ExchangeBidHouseItemAddOkMessage", function(t) {
            e([t.itemInfo], !1),
            n._updateItemCount(n.itemCount + 1)
        }),
        i.on("ExchangeBidHouseItemRemoveOkMessage", function(e) {
            t([e.sellerId]),
            n._updateItemCount(n.itemCount - 1)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, {
            className: "WalletWindow",
            positionInfo: {
                left: 0,
                top: 0,
                width: r,
                height: l
            },
            noCloseButton: !0,
            noTitle: !0
        }),
        this.wallet = null ,
        this.on("open", this._onOpen)
    }
    i(832);
    var o = i(26).inherits
      , s = i(833)
      , a = i(402)
      , r = 300
      , l = 62;
    o(n, a),
    e.exports = n,
    n.height = l,
    n.width = r,
    n.prototype._onOpen = function() {
        this.wallet || (this.wallet = this.windowBody.appendChild(new s({
            className: "small"
        })))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        c.call(this, "div", e),
        this.addClassNames("wallet"),
        this.goultineAmount = 0,
        this.kamaAmount = 0,
        this.emitTap = e.emitTap,
        this._createContent(),
        this._initialize()
    }
    function o() {
        var e = this.myWallet;
        return e.emitTap ? e.emit("moreGoultinesTap") : void l.open("market", {
            tabId: "shop",
            tabParams: {
                category: "goultines"
            }
        })
    }
    i(834);
    var s = i(204)
      , a = i(210)
      , r = i(26).inherits
      , l = i(22)
      , c = i(190);
    r(n, c),
    e.exports = n,
    n.prototype._initialize = function() {
        this._setupListeners();
        var e = window.gui.playerData.inventory;
        this._setSoftAmount(e.kamas),
        this._setHardAmount(e.goultines)
    }
    ,
    n.prototype._setHardAmount = function(e) {
        this.goultineAmount = e,
        this.hardAmountElt.setText(a.intToString(e))
    }
    ,
    n.prototype._setSoftAmount = function(e) {
        this.kamaAmount = e,
        this.softAmountElt.setText(a.intToString(e))
    }
    ,
    n.prototype._createContent = function() {
        var e = this.createChild("div", {
            className: ["currency", "goultines"]
        });
        this.hardAmountElt = e.createChild("div", {
            className: "text"
        }),
        e.createChild("div", {
            className: "currencyIcon"
        }),
        this.goultinesBtn = e.appendChild(new s({
            className: "moreButton"
        },o)),
        this.goultinesBtn.myWallet = this;
        var t = this.createChild("div", {
            className: ["currency", "kamas"]
        });
        this.softAmountElt = t.createChild("div", {
            className: "text"
        }),
        t.createChild("div", {
            className: "currencyIcon"
        })
    }
    ,
    n.prototype._setupListeners = function() {
        function e(e) {
            n._setHardAmount(e)
        }
        function t(e) {
            n._setSoftAmount(e)
        }
        var i = window.gui.playerData.inventory
          , n = this;
        i.on("goultinesUpdated", e),
        i.on("kamasUpdated", t),
        this.on("destroy", function() {
            i.removeListener("goultinesUpdated", e),
            i.removeListener("kamasUpdated", t)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, {
            className: "WorldMapWindow",
            plusButton: !0,
            minusButton: !0,
            positionInfo: {
                width: "w",
                height: "h",
                isDefault: !0
            },
            title: c("ui.cartography.title")
        }),
        this.status = {
            isWorldMapRefreshing: !1,
            isLoading: !1,
            lastOpenCoord: {},
            lastWindowInfo: {
                x: null ,
                y: null ,
                w: null ,
                h: null
            }
        },
        this._worldMap = null ,
        this._conquestController = new m,
        this._poi = null ,
        this._buttonBox = null ,
        this._optionButtons = null ,
        this._maxContentSize = null ,
        this.minusButton.hide(),
        this.plusButton.hide(),
        this._isOpened = !1,
        this.once("open", function(e) {
            this._addSpinner();
            var t = {
                x: h.mapLeft,
                y: h.mapTop,
                width: Math.round(h.mapWidth / 2),
                height: Math.round(h.mapHeight / 2)
            };
            d.positionWindow(this.id, t),
            this.status.lastWindowInfo.x = this.position.x,
            this.status.lastWindowInfo.y = this.position.y,
            this.status.lastWindowInfo.w = this.position.width,
            this.status.lastWindowInfo.h = this.position.height;
            var i = this;
            this._createWorldMap(function(t) {
                return t ? (i._removeSpinner(),
                console.error(t)) : (i._createDom(),
                i._setEvents(),
                i._poi = new r(i._worldMap),
                i._cropWorldMapToWindow(),
                i.on("open", i._onOpen),
                void (i.openState && i._onOpen(e)))
            })
        }),
        this.on("close", this._onClose)
    }
    i(836);
    var o = i(206).addTooltip
      , s = i(26).inherits
      , a = i(837)
      , r = i(854)
      , l = i(402)
      , c = i(35).getText
      , u = i(204)
      , h = i(24).dimensions
      , d = i(22)
      , p = i(459)
      , m = i(855)
      , f = 216
      , g = {
        temples: 1,
        markets: 2,
        workshops: 3,
        miscellaneous: 4,
        dungeons: 6,
        possessions: 7
    };
    s(n, l),
    e.exports = n,
    n.prototype._onClose = function() {
        this.status.isWorldMapRefreshing && this._worldMap.stopRefreshing(),
        this._buttonBox && this._buttonBox.addClassNames("hidden"),
        this._isOpened = !1
    }
    ,
    n.prototype._onOpen = function(e) {
        var t = this
          , i = window.gui
          , n = {
            posX: i.playerData.position.coordinates.posX,
            posY: i.playerData.position.coordinates.posY
        };
        return e && void 0 !== e.x && void 0 !== e.y && (n.posX = e.x,
        n.posY = e.y),
        this.status.lastOpenCoord = n,
        this._isOpened ? void t._worldMap.centerToPosition(t.status.lastOpenCoord) : void (this.status.isLoading || (this.status.isLoading = !0,
        this._addSpinner(),
        this._worldMap.initialize(n, function() {
            if (t.status.isWorldMapRefreshing = !0,
            t._removeSpinner(),
            t.status.isLoading = !1,
            t._isOpened = !0,
            !t.openState)
                return t._onClose();
            t._worldMap.centerToPosition(t.status.lastOpenCoord);
            var e = i.playerData.position.coordinates;
            t._worldMap.setIconPosition("userPosition", e.posX, e.posY),
            t._poi.update(),
            t._conquestController.setWorldMap(t._worldMap)
        })))
    }
    ,
    n.prototype._addSpinner = function() {
        this.windowBodyWrapper.addClassNames("spinner")
    }
    ,
    n.prototype._removeSpinner = function() {
        this.windowBodyWrapper.delClassNames("spinner")
    }
    ,
    n.prototype._getMaxContentSize = function() {
        if (!this._maxContentSize) {
            var e = this._getCurrentInnerBoundaries();
            this._maxContentSize = {
                width: h.windowFullScreenWidth - (this.position.width - e.width),
                height: h.windowFullScreenHeight - (this.position.height - e.height)
            }
        }
        return this._maxContentSize
    }
    ,
    n.prototype._getCurrentInnerBoundaries = function() {
        var e = this.windowBody.getComputedStyles("width", "height");
        return {
            width: parseInt(e.width, 10),
            height: parseInt(e.height, 10)
        }
    }
    ,
    n.prototype._cropWorldMapToWindow = function() {
        var e = this._getMaxContentSize()
          , t = this._getCurrentInnerBoundaries();
        this._worldMap.crop((e.width - t.width) / 2, (e.height - t.height) / 2, t.width, t.height)
    }
    ,
    n.prototype._exitFullScreen = function() {
        this.setStyles({
            width: this.status.lastWindowInfo.w + "px",
            height: this.status.lastWindowInfo.h + "px",
            webkitTransform: "translate3d(" + this.status.lastWindowInfo.x + "px," + this.status.lastWindowInfo.y + "px,0)"
        }),
        this.position.x = this.status.lastWindowInfo.x,
        this.position.y = this.status.lastWindowInfo.y,
        this.position.width = this.status.lastWindowInfo.w,
        this.position.height = this.status.lastWindowInfo.h,
        this.emit("resize")
    }
    ,
    n.prototype._setEvents = function() {
        var e = this
          , t = window.gui;
        t.playerData.position.on("mapUpdate", function() {
            if (e.openState) {
                if (e._worldMap.isLoading()) {
                    var t = this.coordinates.posX
                      , i = this.coordinates.posY;
                    e._worldMap.once("loaded", function() {
                        e._worldMap.setIconPosition("userPosition", t, i),
                        e._worldMap.centerToMyPosition()
                    })
                } else
                    e._worldMap.setIconPosition("userPosition", this.coordinates.posX, this.coordinates.posY),
                    e._worldMap.centerToMyPosition();
                e.status.isLoading && (e.status.lastOpenCoord = this.coordinates)
            }
        }),
        this.on("repositioned", function() {
            e.emit("resize", !0)
        }),
        this.on("positioned", function() {
            e.status.lastWindowInfo.x = e.position.x,
            e.status.lastWindowInfo.y = e.position.y,
            e._updateMySize()
        }),
        t.playerData.position.on("worldMapUpdate", function() {
            e._onOpen(),
            e._poi.update()
        }),
        t.on("disconnect", function() {
            e._conquestController.clear(),
            e._worldMap.clear(),
            e._resetOptionsButtons(),
            e.close()
        })
    }
    ,
    n.prototype._createToggleButton = function(e, t, i, n) {
        var s = new u({
            className: ["mapBtn", e]
        },function() {
            s.selected = !s.selected,
            s.toggleClassName("selected", this.selected),
            n.call(this)
        }
        );
        return t ? (s.selected = !0,
        s.addClassNames("selected")) : s.selected = !1,
        s.defaultSelected = t,
        this._optionButtons[e] = s,
        o(s, i),
        s
    }
    ,
    n.prototype._createWorldMap = function(e) {
        var t = this._worldMap = this.windowBody.appendChild(new a);
        t.setupUI(this);
        var i = this._getMaxContentSize();
        t.setDimensions(i.width, i.height),
        this._cropWorldMapToWindow(),
        this._worldMap.addClassNames("centerMap"),
        this._worldMap.preloadGenericAssets(e)
    }
    ,
    n.prototype._createOptionsButtons = function() {
        function e(e, n) {
            return t._createToggleButton(e, !0, n, function() {
                i.setVisibilityOfIconType(g[e], this.selected)
            })
        }
        var t = this
          , i = this._worldMap;
        this._optionButtons = {};
        var n = this._buttonBox = this.windowBody.createChild("div", {
            className: ["buttonsSpace", "hidden"]
        });
        n.appendChild(t._createToggleButton("grid", !1, c("ui.option.displayGrid"), function() {
            i.setGridVisibility(this.selected)
        })),
        n.appendChild(t._createToggleButton("landmarks", !0, c("ui.cartography.flags"), function() {
            i.setVisibilityOfIconType("customFlag", this.selected),
            i.setVisibilityOfIconType("userPosition", this.selected),
            i.setVisibilityOfIconType("questObjective", this.selected),
            i.setVisibilityOfIconType("hint", this.selected)
        })),
        n.appendChild(e("possessions", !0, c("ui.common.possessions"), function() {})),
        n.appendChild(e("temples", c("ui.map.temple"))),
        n.appendChild(e("markets", c("ui.map.bidHouse"))),
        n.appendChild(e("workshops", c("ui.map.craftHouse"))),
        n.appendChild(e("miscellaneous", c("ui.common.misc"))),
        n.appendChild(t._createToggleButton("conquests", !0, c("ui.map.conquest"), function() {
            i.setVisibilityOfIconType("prisms", this.selected)
        })),
        n.appendChild(e("dungeons", c("ui.map.dungeon"))),
        this.optionButton = new u({
            className: "optionButton",
            scaleOnPress: !0
        },function() {
            n.toggleClassName("hidden")
        }
        ),
        this.optionButton.insertBefore(this.windowTitle)
    }
    ,
    n.prototype._createDom = function() {
        var e = this;
        this._createOptionsButtons(),
        this.centerButton = new u({
            className: "centerButton",
            scaleOnPress: !0
        },function() {
            e._worldMap.centerToMyPosition()
        }
        ),
        o(this.centerButton, c("ui.map.player")),
        this.centerButton.insertBefore(this.windowTitle),
        p(this, {
            minWidth: f,
            minHeight: f
        }),
        this.on("resizeStart", function() {
            var t = e._getMaxContentSize();
            e._worldMap.crop(0, 0, t.width, t.height)
        }),
        this.on("resize", function(t) {
            e._cropWorldMapToWindow(),
            e._updateMySize(t)
        }),
        this.plusButton.on("tap", function() {
            d.positionWindow("worldMap")
        }),
        this.plusButton.show(),
        this.minusButton.on("tap", function() {
            e._exitFullScreen()
        })
    }
    ,
    n.prototype._updateMySize = function(e) {
        if (this.plusButton.toggleDisplay(!e),
        this.minusButton.toggleDisplay(!!e),
        !e) {
            var t = parseInt(this.getStyle("width"), 10)
              , i = parseInt(this.getStyle("height"), 10);
            t > .9 * h.windowFullScreenWidth && i > .9 * h.windowFullScreenHeight || (this.status.lastWindowInfo.w = this.position.width = t,
            this.status.lastWindowInfo.h = this.position.height = i)
        }
    }
    ,
    n.prototype._resetOptionsButtons = function() {
        for (var e in this._optionButtons) {
            var t = this._optionButtons[e];
            t.selected = t.defaultSelected,
            t.toggleClassName("selected", t.selected)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "WorldMap"
        }),
        this.canvas = this.createChild("canvas", {
            className: ["WorldMap", "canvas"]
        }).rootElement,
        this._scene = new r({
            canvas: this.canvas,
            name: "worldMapScene",
            l: 0,
            t: 0,
            w: 1,
            h: 1,
            pixelRatio: l.PIXEL_RATIO,
            textureRatio: l.PRERENDER_RATIO_WORLDMAP,
            nbCacheableSprites: l.MAX_SPRITES_BUFFER_WORLDMAP,
            textureMemoryCacheSize: l.MAX_TEXTURE_MEMORY_WORLDMAP,
            prerenderQualityRatio: l.PRERENDER_RATIO_WORLDMAP
        }),
        this._nZonesHorizontally = 0,
        this._nZonesVertically = 0,
        this._worldMapWidth = 1,
        this._worldMapHeight = 1,
        this.cropPosition = {
            x: 0,
            y: 0,
            width: 1,
            height: 1
        },
        this._topLeftZoneCoordinate = null ,
        this._worldMapId = 0,
        this._worldMapData = null ,
        this._isLoadingWorldMapData = !1,
        this._zoomLevels = [],
        this._chunkSprites = {},
        this._chunkBatchIndexes = {},
        this._chunkBatchCurrent = 0,
        this._fullMapSprite = null ,
        this._subAreaSprite = null ,
        this._subAreaData = {},
        this._subAreaIdPerCoordinate = {},
        this._gridSprite = null ,
        this._zoneHighlight = null ,
        this.dimensions = {
            width: 0,
            height: 0
        },
        this._iconsInfo = {},
        this._iconsImage = null ,
        this._iconBatchData = new A(this)
    }
    i(838);
    var o = i(12)
      , s = i(26).inherits
      , a = i(190)
      , r = i(839)
      , l = i(6)
      , c = i(619)
      , u = i(841)
      , h = i(842)
      , d = i(843)
      , p = i(844)
      , m = i(253)
      , f = i(291)
      , g = i(36)
      , _ = i(261)
      , v = i(845)
      , y = i(846)
      , w = i(847)
      , b = w.SUBAREA_COLOR
      , C = w.VIEW_MARGIN
      , I = w.CHUNK_WIDTH
      , T = w.CHUNK_HEIGHT
      , S = i(848)
      , A = i(849)
      , E = i(853)
      , x = i(852)
      , M = i(206).addTooltip
      , N = i(336)
      , R = i(296)
      , O = i(33).getPosition
      , P = i(210)
      , D = i(286)
      , L = i(33).position
      , B = i(32)
      , k = i(409)
      , F = _.Tween
      , H = _.easing;
    s(n, a),
    e.exports = n,
    n.prototype.preloadGenericAssets = function(e) {
        var t = this;
        g.getAllDataMap(["SubAreaIdPerCoordinate", "SubAreasWorldMapData", "Hints"], function(i, n) {
            return i ? e(i) : (t._subAreaIdPerCoordinate = n.SubAreaIdPerCoordinate,
            t._subAreaData = n.SubAreasWorldMapData,
            t._iconsInfo = n.Hints,
            void f.loadModel("icon", "assets", function(i, n) {
                t._iconsImage = n;
                var o = t._scene.createTexture(n, "worldMapIcons", "linear", "permanent");
                t._iconBatchData.createIconModels(i, o),
                e()
            }))
        })
    }
    ,
    n.prototype.stopMovingWorldMap = function() {
        this._scene.camera.stopMoving(),
        this._loadChunksInView()
    }
    ,
    n.prototype.centerToPosition = function(e) {
        if (this._worldMapData) {
            var t = this._convertGridToSceneCoordinate(e.posX, e.posY);
            this._scene.camera.follow(t),
            this._loadChunksInView()
        }
    }
    ,
    n.prototype.centerToMyPosition = function() {
        if (this._worldMapData) {
            var e = window.gui.playerData.position.coordinates;
            this.centerToPosition(e)
        }
    }
    ,
    n.prototype.setDimensions = function(e, t) {
        this.dimensions.width = e,
        this.dimensions.height = t,
        this.cropPosition.width = e,
        this.cropPosition.height = t,
        this.setStyles({
            width: e + "px",
            height: t + "px"
        }),
        this.setCanvasDimensions(e, t)
    }
    ,
    n.prototype.initialize = function(e, t) {
        var i = window.gui.playerData.position.worldmapId;
        if (this._worldMapId === i)
            return this._isLoadingWorldMapData ? console.warn("[WorldMap.initialize]", "Initialisation already launched") : this._display(),
            t();
        if (this._isLoadingWorldMapData)
            return console.warn("[WorldMap.initialize]", "Initialisation of a world map of another id is already launched", "Asked ", i, "Loading", this._worldMapId),
            t();
        null !== this._fullMapSprite && (console.warn("[WorldMap.initialize]", "Loading data for a new world map while previous map was not cleared.", "Automatically clearing the previous world map."),
        this.clear()),
        this._worldMapId = i || 1,
        this._isLoadingWorldMapData = !0;
        var n = this._worldMapData = window.gui.databases.WorldMaps[this._worldMapId];
        if (window.gui.playerData.position.worldmapId !== this._worldMapId)
            return this.initialize(e, t);
        this._worldMapData = n,
        3 === this._worldMapId ? (this._worldMapWidth = n.totalWidth / 2,
        this._worldMapHeight = n.totalHeight / 2) : (this._worldMapWidth = n.totalWidth,
        this._worldMapHeight = n.totalHeight),
        this._zoneWidth = n.mapWidth,
        this._zoneHeight = n.mapHeight;
        var o = window.gui.playerData.position.coordinates
          , s = e.posX || o.posX
          , a = e.posY || o.posY
          , r = this._convertGridToSceneCoordinate(s, a)
          , u = n.zoom
          , h = parseFloat(u[0])
          , d = parseFloat(u[1]);
        this._zoomLevels = [h];
        for (var p = 2; p < u.length; p += 1) {
            var f = parseFloat(u[p]);
            2 * f < h ? (this._zoomLevels.push(d),
            h = d,
            d = f) : d = f
        }
        this._zoomLevels.push(d),
        this._scene.camera.setZoomMax(this._zoomLevels[0]),
        this._scene.setDimensions(0, 0, this._worldMapWidth, this._worldMapHeight),
        this._scene.camera.setZoom(this._zoomLevels[0]),
        this._scene.camera.setPosition(r.x, r.y),
        this._topLeftZoneCoordinate = this.convertSceneToGridCoordinate(0, 0);
        var g = this
          , _ = l.WORLDMAP_PATH + this._worldMapId + "-full.jpg";
        m.loadTexture(_, function(e) {
            g._fullMapSprite = new c({
                scene: g._scene,
                x: 0,
                y: 0,
                w: g._worldMapWidth,
                h: g._worldMapHeight,
                layer: -1
            },e),
            g._prepareGrid(),
            g._prepareIcons(),
            g._display(),
            g._isLoadingWorldMapData = !1,
            t(),
            g.emit("loaded")
        }, this._scene.renderer, "linear")
    }
    ,
    n.prototype.isLoading = function() {
        return this._isLoadingWorldMapData
    }
    ,
    n.prototype._display = function() {
        this._loadChunksInView(),
        v.addScene(this._scene)
    }
    ,
    n.prototype._prepareGrid = function() {
        null !== this._gridSprite && this._gridSprite.remove();
        var e = this._zoneWidth
          , t = this._zoneHeight
          , i = this._worldMapData.origineX % e
          , n = this._worldMapData.origineY % t
          , o = Math.floor((this._worldMapWidth - i) / e)
          , s = Math.floor((this._worldMapHeight - n) / t);
        this._nZonesHorizontally = o,
        this._nZonesVertically = s;
        for (var a = o + 1, r = s + 1, c = a * e, h = r * t, p = [], m = 0; m < a; m += 1) {
            var f = m * e;
            p.push(new u(f,(-n),f,h - n))
        }
        for (var g = 0; g < r; g += 1) {
            var _ = g * t;
            p.push(new u((-i),_,c - i,_))
        }
        this._gridSprite = new d({
            scene: this._scene,
            x: i,
            y: n,
            lines: p,
            alpha: 0,
            lineWidth: 1 * l.PIXEL_RATIO,
            hue: [.85, .85, .85, .8],
            layer: 2,
            id: "worldMapGrid" + this._worldMapId
        }),
        this._gridSprite.hide(),
        this._gridTween = new F(this._gridSprite,["alpha"]);
        var v = window.gui.playerData.position.coordinates
          , y = this._convertGridToSceneCoordinate(v.posX, v.posY)
          , w = [{
            x0: -e / 2,
            y0: -t / 2,
            x1: -e / 2,
            y1: -t / 4
        }, {
            x0: -e / 2,
            y0: -t / 2,
            x1: -e / 4,
            y1: -t / 2
        }, {
            x0: e / 2,
            y0: t / 4,
            x1: e / 2,
            y1: t / 2
        }, {
            x0: e / 4,
            y0: t / 2,
            x1: e / 2,
            y1: t / 2
        }, {
            x0: e / 2,
            y0: -t / 4,
            x1: e / 2,
            y1: -t / 2
        }, {
            x0: e / 2,
            y0: -t / 2,
            x1: e / 4,
            y1: -t / 2
        }, {
            x0: -e / 2,
            y0: t / 4,
            x1: -e / 2,
            y1: t / 2
        }, {
            x0: -e / 4,
            y0: t / 2,
            x1: -e / 2,
            y1: t / 2
        }];
        this._zoneHighlight = new d({
            scene: this._scene,
            x: y.x,
            y: y.y,
            w: e,
            h: t,
            lines: w,
            lineWidth: 4 * l.PIXEL_RATIO,
            hue: [.1, .1, .1, 1],
            layer: 3,
            id: "worldMapHighlight" + this._worldMapId
        }),
        this._zoneHighlight.hide(),
        this._zoneHighlightTween = new F(this._zoneHighlight,["x", "y"])
    }
    ,
    n.prototype.setHighlightOn = function(e, t) {
        if (!this._isLoadingWorldMapData) {
            var i = this._convertGridToSceneCoordinate(e, t);
            this._zoneHighlight.isDisplayed ? ((this._zoneHighlightTween.starting || this._zoneHighlightTween.playing) && this._zoneHighlightTween.stop(),
            this._zoneHighlightTween.reset().from({
                x: this._zoneHighlight.x,
                y: this._zoneHighlight.y
            }).to({
                x: i.x,
                y: i.y
            }, 16, H.polyOut, 9).start()) : (this._zoneHighlight.show(),
            this._zoneHighlight.x = i.x,
            this._zoneHighlight.y = i.y)
        }
    }
    ,
    n.prototype.hideHighlight = function() {
        this._zoneHighlight && ((this._zoneHighlightTween.starting || this._zoneHighlightTween.playing) && this._zoneHighlightTween.stop(),
        this._zoneHighlight.hide())
    }
    ,
    n.prototype.setGridVisibility = function(e) {
        if (this._gridTween) {
            this._gridTween.playing && this._gridTween.stop(),
            this._gridTween.removeOnFinish();
            var t = this._gridSprite.isDisplayed ? this._gridSprite.alpha : 0;
            if (e)
                this._gridSprite.show(),
                this._gridTween.reset().from({
                    alpha: t
                }).to({
                    alpha: 1
                }, 4);
            else {
                this._gridTween.reset().from({
                    alpha: t
                }).to({
                    alpha: 0
                }, 4);
                var i = this._gridSprite;
                this._gridTween.onFinish(function() {
                    i.hide()
                })
            }
            this._gridTween.start()
        }
    }
    ,
    n.prototype.getSubAreaAtGridCoordinate = function(e, t) {
        for (var i = this._convertGridCoordinateToCompressedCoordinate(e, t), n = this._subAreaIdPerCoordinate[this._worldMapId][i]; void 0 === n; )
            i -= 1,
            n = this._subAreaIdPerCoordinate[this._worldMapId][i];
        if (null !== n)
            return this._subAreaData[n]
    }
    ,
    n.prototype.convertGridCoordinateToZoneId = function(e, t) {
        return (t - this._topLeftZoneCoordinate.j) * this._nZonesHorizontally + (e - this._topLeftZoneCoordinate.i)
    }
    ,
    n.prototype.convertSceneToGridCoordinate = function(e, t) {
        return {
            i: Math.floor((e - this._worldMapData.origineX) / this._zoneWidth),
            j: Math.floor((t - this._worldMapData.origineY) / this._zoneHeight)
        }
    }
    ,
    n.prototype.convertCanvasToGridCoordinate = function(e, t) {
        var i = this._scene.convertCanvasToSceneCoordinate(e, t);
        return this.convertSceneToGridCoordinate(i.x, i.y)
    }
    ,
    n.prototype.setVisibilityOfSubArea = function(e, t, i) {
        var n = this._subAreaData[e];
        if (void 0 === n)
            return void console.warn("[WorldMap.setVisbilityOfSubArea] Trying to set visibility of undefined sub-area.");
        if (!t) {
            if (null === this._subAreaSprite)
                return;
            var o = this._subAreaSprite;
            return this._subAreaSprite = null ,
            void F(o, ["alpha"]).from({
                alpha: 1
            }).to({
                alpha: 1
            }, 5).start().onFinish(function() {
                o.remove()
            })
        }
        var s = "subAreaOverlay" + e;
        if (null === this._subAreaSprite || this._subAreaSprite.id !== s) {
            for (var a = [], r = 1 / 0, l = 1 / 0, c = -(1 / 0), u = -(1 / 0), d = {}, m = n.gridPositions[this._worldMapId] || [], f = 0; f < m.length; f += 2) {
                var g = m[f]
                  , _ = m[f + 1]
                  , v = g + ":" + _;
                if (void 0 === d[v]) {
                    d[v] = !0;
                    var y = this._convertGridToSceneCoordinate(g, _)
                      , w = y.x - this._zoneWidth / 2
                      , C = y.y - this._zoneHeight / 2;
                    a.push(new h(w,C,w + this._zoneWidth,C,w + this._zoneWidth,C + this._zoneHeight,w,C + this._zoneHeight)),
                    w < r && (r = w),
                    w > c && (c = w),
                    C < l && (l = C),
                    C > u && (u = C)
                }
            }
            null !== this._subAreaSprite && this._subAreaSprite.remove(),
            this._subAreaSprite = new p({
                scene: this._scene,
                x: 0,
                y: 0,
                boxes: a,
                hue: i || b,
                layer: 1,
                id: "subAreaOverlay" + e
            }),
            F(this._subAreaSprite, ["alpha"]).from({
                alpha: 0
            }).to({
                alpha: 1
            }, 4).start()
        }
    }
    ,
    n.prototype.move = function(e, t, i, n, o) {
        this._scene.move(e, t, i, n, o),
        this._loadChunksInView()
    }
    ,
    n.prototype.addInertia = function(e, t) {
        this._scene.camera.addInertia(e, t, .8),
        this._loadChunksInView()
    }
    ,
    n.prototype._getZoomLevel = function(e) {
        for (var t, i = this._zoomLevels[0], n = 1; n < this._zoomLevels.length && (t = this._zoomLevels[n],
        !(e >= 1.2 * t)); n += 1)
            i = t;
        return i
    }
    ,
    n.prototype._loadChunksInView = function() {
        function e(e, t) {
            var i = j._chunkBatchIndexes[e.id];
            return i !== j._chunkBatchCurrent ? (delete j._chunkBatchIndexes[e.id],
            t()) : void m.loadTexture(e.path, function(i) {
                var n = j._chunkBatchIndexes[e.id];
                return delete j._chunkBatchIndexes[e.id],
                n !== j._chunkBatchCurrent ? (i.release(),
                t()) : (e.texture = i,
                j._createChunkGraphic(e),
                void t())
            }, j._scene.renderer, "linear")
        }
        var t = this._scene.camera.zoomTarget;
        if (void 0 !== t) {
            if (0 === this._zoomLevels.length || 1.5 * t <= this._zoomLevels[this._zoomLevels.length - 1])
                return void this._clearChunks();
            this._chunkBatchCurrent += 1;
            var i, n, s, a, r = this._getZoomLevel(t), c = this._scene.camera, u = c.followee.x - c.fovW / 2 * C;
            if (u < 0)
                i = 0,
                n = Math.min(c.fovW * C, this._worldMapWidth);
            else {
                var h = c.followee.x + c.fovW / 2 * C;
                h > this._worldMapWidth ? (i = Math.max(this._worldMapWidth - c.fovW * C, 0),
                n = this._worldMapWidth) : (i = u,
                n = h)
            }
            var d = c.followee.y - c.fovH / 2 * C;
            if (d < 0)
                s = 0,
                a = Math.min(c.fovH * C, this._worldMapHeight);
            else {
                var p = c.followee.y + c.fovH / 2 * C;
                p > this._worldMapHeight ? (s = Math.max(this._worldMapHeight - c.fovH * C, 0),
                a = this._worldMapHeight) : (s = d,
                a = p)
            }
            var f = this._convertSceneToChunkCoordinate(r, i, s)
              , g = this._convertSceneToChunkCoordinate(r, n, a)
              , _ = f.k
              , v = g.k
              , w = f.l
              , b = g.l
              , S = []
              , A = r * this._worldMapWidth / I
              , E = r * this._worldMapHeight / T
              , x = Math.ceil(A)
              , M = Math.ceil(E);
            v === A && A === x && (v -= 1),
            b === E && E === M && (b -= 1);
            var N, R, O, P = Object.keys(this._chunkSprites);
            for (O = 0; O < P.length; O += 1)
                this._chunkSprites[P[O]].id = null ;
            for (var D = w; D <= b; D += 1)
                for (var L = _; L <= v; L += 1)
                    if (N = this._worldMapId + "-" + r + "-" + (D * x + L + 1).toString(),
                    R = this._chunkSprites[N],
                    void 0 === R)
                        if (void 0 === this._chunkBatchIndexes[N]) {
                            var B = l.WORLDMAP_PATH + N + ".jpg"
                              , k = D - (w + b) / 2
                              , F = L - (_ + v) / 2
                              , H = Math.sqrt(k * k + F * F)
                              , G = this._scene.holdTexture(N)
                              , U = new y(L,D,r,N,B,G,this._scene,H);
                            void 0 === G ? (S.push(U),
                            this._chunkBatchIndexes[N] = this._chunkBatchCurrent) : this._createChunkGraphic(U)
                        } else
                            this._chunkBatchIndexes[N] = this._chunkBatchCurrent;
                    else
                        R.id = N;
            for (O = 0; O < P.length; O += 1)
                N = P[O],
                R = this._chunkSprites[N],
                null === R.id && (R.remove(),
                delete this._chunkSprites[N]);
            S.sort(function(e, t) {
                return e.distToViewCenter - t.distToViewCenter
            });
            var j = this;
            o.eachLimit(S, 5, e, function(e) {
                e && console.error("Chunk textures not loaded correctly", e)
            })
        }
    }
    ,
    n.prototype._createChunkGraphic = function(e) {
        e.w *= e.texture.element.width / I,
        e.h *= e.texture.element.height / T,
        this._chunkSprites[e.id] = new c(e,e.texture)
    }
    ,
    n.prototype._clearChunks = function() {
        for (var e = Object.keys(this._chunkSprites), t = 0; t < e.length; t += 1) {
            var i = this._chunkSprites[e[t]];
            i.remove()
        }
        this._chunkSprites = {}
    }
    ,
    n.prototype._convertGridCoordinateToCompressedCoordinate = function(e, t) {
        return ((e < 0 ? 32768 | 32767 & e : 32767 & e) << 16) + (t < 0 ? 32768 | 32767 & t : 32767 & t)
    }
    ,
    n.prototype._convertGridToSceneCoordinate = function(e, t) {
        var i = this._worldMapData.origineX + e * this._zoneWidth + this._zoneWidth / 2
          , n = this._worldMapData.origineY + t * this._zoneHeight + this._zoneHeight / 2;
        return {
            x: i,
            y: n
        }
    }
    ,
    n.prototype._convertSceneToChunkCoordinate = function(e, t, i) {
        var n = Math.floor(e * t / I)
          , o = Math.floor(e * i / T);
        return {
            k: n,
            l: o
        }
    }
    ,
    n.prototype.setCanvasDimensions = function(e, t) {
        this._scene.setCanvasDimensions(e, t),
        this._loadChunksInView()
    }
    ,
    n.prototype.stopRefreshing = function() {
        v.removeScene(this._scene)
    }
    ,
    n.prototype.crop = function(e, t, i, n) {
        this.cropPosition.x = e,
        this.cropPosition.y = t,
        this.cropPosition.width = i,
        this.cropPosition.height = n,
        this._scene.crop(e, t, i, n),
        this._loadChunksInView()
    }
    ,
    n.prototype.resetCropping = function() {
        this.cropPosition.x = this.cropPosition.y = 0,
        this.cropPosition.width = this.dimensions.width,
        this.cropPosition.height = this.dimensions.height,
        this._scene.resetCropping(),
        this._loadChunksInView()
    }
    ,
    n.prototype.clear = function() {
        this._scene.clean(),
        this._scene.clear(),
        this._worldMapId = 0,
        this._fullMapSprite = null ,
        this._chunkSprites = {},
        this._zoomLevels = [],
        this._worldMapData = null ,
        this._iconBatchData.clearIconBatch()
    }
    ,
    n.prototype._prepareIcons = function() {
        this._iconBatchData.reset(),
        this._iconBatchData.createIconsFromInfo(this._iconsInfo, this._worldMapId),
        this._iconBatchData.iconBatch = new E({
            id: "iconWorldMap_" + this._worldMapId,
            x: 0,
            y: 0,
            w: this._worldMapWidth,
            h: this._worldMapHeight,
            layer: 4,
            scene: this._scene,
            iconsData: this._iconBatchData
        });
        var e = window.gui.playerData.position.coordinates
          , t = this._convertGridToSceneCoordinate(e.posX, e.posY)
          , i = "userPosition"
          , n = new S(i,i,{
            color: [1, 1.1, 2, 1],
            clusterId: i
        },this._iconBatchData.iconDimensions.myPosition)
          , o = new x(i,t.x,t.y);
        this._iconBatchData.addCluster(o),
        o.add(n),
        n.cluster = o,
        this._iconBatchData.addIcon(n),
        this.emit("iconsPrepared")
    }
    ,
    n.prototype.hasIcon = function(e) {
        return this._iconBatchData.hasIcon(e)
    }
    ,
    n.prototype.getIcon = function(e) {
        return this._iconBatchData.getIcon(e)
    }
    ,
    n.prototype.addIcon = function(e, t) {
        return this._iconBatchData.createIcon(e, t)
    }
    ,
    n.prototype.removeIcon = function(e) {
        if (null === this._iconBatchData) {
            var t = this;
            return void this.on("iconsPrepared", function() {
                t._iconBatchData.removeIcon(e)
            })
        }
        this._iconBatchData.removeIcon(e)
    }
    ,
    n.prototype.setVisibilityOfIconType = function(e, t) {
        if (null === this._iconBatchData) {
            var i = this;
            return void this.on("iconsPrepared", function() {
                i._iconBatchData.setVisibilityOfIconType(e, t)
            })
        }
        this._iconBatchData.setVisibilityOfIconType(e, t)
    }
    ,
    n.prototype.setIconPosition = function(e, t, i) {
        if (null === this._iconBatchData) {
            var n = this;
            return void this.on("iconsPrepared", function() {
                n._iconBatchData.setIconPosition(e, t, i)
            })
        }
        this._iconBatchData.setIconPosition(e, t, i)
    }
    ,
    n.prototype.convertZoneIdToGridCoordinate = function(e) {
        var t = Math.floor(e / this._nZonesHorizontally)
          , i = this._topLeftZoneCoordinate;
        return {
            i: e - t * this._nZonesHorizontally + i.i,
            j: t + i.j
        }
    }
    ,
    n.prototype.getSubAreaAtCanvasCoordinate = function(e, t) {
        var i = this.convertCanvasToGridCoordinate(e, t);
        return this.getSubAreaAtGridCoordinate(i.i, i.j)
    }
    ,
    n.prototype.getIconsAtCanvasCoordinate = function(e, t) {
        var i = this.convertCanvasToGridCoordinate(e, t)
          , n = this.convertGridCoordinateToZoneId(i.i, i.j);
        return this._iconBatchData.getClusterIcons(n)
    }
    ,
    n.prototype.setupUI = function(e) {
        this._setupMapTransform(),
        this._setupMapTooltip(e)
    }
    ,
    n.prototype._setupMapTransform = function() {
        D(this, "HIGH");
        var e, t = 0, i = 0;
        this.on("transformStart", function() {
            e = Date.now(),
            t = 0,
            i = 0
        }),
        this.on("transform", function(n, o, s, a, r) {
            e = Date.now(),
            t = .5 * t + .5 * -s,
            i = .5 * i + .5 * -a,
            this.move(n, o, -s, -a, r)
        }),
        this.on("transformEnd", function() {
            Date.now() - e > 100 || this.addInertia(t, i)
        })
    }
    ,
    n.prototype._setupMapTooltip = function(e) {
        function t(e) {
            if (d || (d = f.rootElement.getBoundingClientRect()),
            a = e.x,
            r = e.y,
            l = a - d.left,
            c = r - d.top,
            p) {
                var t = null
                  , i = null
                  , n = l - f.cropPosition.x
                  , o = Math.min(.1 * f.cropPosition.width, 50)
                  , s = 0;
                n < o ? (t = 0,
                s = n) : n > f.cropPosition.width - o && (t = f._worldMapWidth,
                s = f.cropPosition.width - n);
                var u = c - f.cropPosition.y
                  , h = 0;
                if (u < o ? (i = 0,
                h = u) : u > f.cropPosition.height - o && (i = f._worldMapHeight,
                h = f.cropPosition.height - u),
                null === t && null === i)
                    w.playing && (w.stop(),
                    f._loadChunksInView());
                else {
                    y.x = f._scene.camera.x,
                    y.y = f._scene.camera.y,
                    f._scene.camera.follow(y);
                    var m = {
                        x: y.x,
                        y: y.y
                    }
                      , g = {}
                      , _ = 0
                      , v = b;
                    null === t ? g.x = y.x : (g.x = t,
                    Math.abs(t - y.x) > _ && (_ = Math.abs(t - y.x),
                    v = b * (o - s) / o)),
                    null === i ? g.y = y.y : (g.y = i,
                    Math.abs(i - y.y) > _ && (_ = Math.abs(i - y.y),
                    v = b * (o - h) / o)),
                    w.playing || w.start(!1),
                    w.reset().from(m).to(g, _ / v),
                    f._loadChunksInView()
                }
            }
        }
        function i() {
            d = f.rootElement.getBoundingClientRect()
        }
        function n(e, t, i) {
            var n = e.subAreaData
              , o = f.getSubAreaAtGridCoordinate(t, i);
            if (e.setCoordinates(t, i),
            o) {
                if (o && o !== n) {
                    n && f.setVisibilityOfSubArea(n.id, !1),
                    e.subAreaData = n = o,
                    e.setSubArea(n);
                    var s = N.entities.prism[n.id];
                    if (s && s.prism) {
                        var a = s.getAlliance();
                        e.setAlliance(a);
                        var r = P.hexToRgb((+a.allianceEmblem.backgroundColor).toString(16));
                        f.setVisibilityOfSubArea(n.id, !0, [r[0] / 255, r[1] / 255, r[2] / 255, .25])
                    } else
                        e.unsetAlliance(),
                        f.setVisibilityOfSubArea(n.id, !0, [1, 0, 0, .25])
                }
            } else
                n && (f.setVisibilityOfSubArea(n.id, !1),
                n = null ),
                e.unsetSubArea();
            var l = f._iconBatchData.getClusterIcons(f.convertGridCoordinateToZoneId(t, i));
            l ? (e.setIcons(l, f._iconsImage),
            e.displayIcons()) : n ? e.displaySubArea() : e.displayCoordinates()
        }
        function o() {
            if (!w.playing) {
                var e = f.convertCanvasToGridCoordinate(l, c);
                if (u === e.i && h === e.j || !p)
                    return g.positionAt(a, r);
                u = e.i,
                h = e.j,
                f.setHighlightOn(u, h),
                n(_, u, h),
                g.positionAt(a, r)
            }
        }
        function s(e) {
            t(O(e)),
            o()
        }
        B(this);
        var a, r, l, c, u, h, d, p, m = window.gui, f = this, g = m.tooltipBox, _ = new k;
        this.on("tap", function() {
            if (f._worldMapData) {
                var e = f.convertCanvasToGridCoordinate(l, c)
                  , t = this.convertGridCoordinateToZoneId(e.i, e.j);
                e.icons = this._iconBatchData.getClusterIcons(t),
                m.openContextualMenu("map", e),
                f.setHighlightOn(e.i, e.j)
            }
        });
        var v = R.getContextMenu("map");
        v.on("open", function(e) {
            n(v.worldMapTooltip, e.i, e.j)
        }),
        v.on("close", function(e) {
            "reopen" !== e && f.hideHighlight()
        });
        var y = {}
          , w = new F(y,["x", "y"]);
        w.onFinish(function() {
            f._loadChunksInView()
        });
        var b = 50;
        this.on("dom.touchstart", function(e) {
            this.stopMovingWorldMap(),
            t(O(e))
        }),
        e.on("positioned", i),
        e.on("resize", i),
        M(this, _, {
            position: L
        }),
        this.on("tooltipOn", function() {
            p = !0,
            f.stopMovingWorldMap(),
            t(L),
            o(),
            m.wBody.on("dom.touchmove", s);
        }),
        this.on("tooltipOut", function() {
            p = !1,
            m.wBody.removeListener("dom.touchmove", s);
            var e = _.subAreaData;
            e && f.setVisibilityOfSubArea(e.id, !1),
            f.hideHighlight(),
            w.playing && w.stop(),
            e = u = h = null
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        return e._layer === t._layer ? e._position - t._position : e._layer - t._layer
    }
    function o() {
        var e = document.createElement("canvas");
        e.width = 128,
        e.height = 128;
        var t = e.getContext("2d");
        return t.fillStyle = "rgba(200, 100, 30, 0.27)",
        t.fillRect(0, 0, 128, 128),
        t.lineWidth = 2,
        t.strokeStyle = "rgba(200, 100, 30, 0.9)",
        t.strokeRect(0, 0, 128, 128),
        e
    }
    function s(e) {
        void 0 === e.name && console.error("[Scene] Parameter `name` required."),
        void 0 === e.canvas && console.error("[Scene] Parameter `canvas` required."),
        void 0 === e.pixelRatio && console.error("[Scene] Parameter `pixelRatio` required."),
        void 0 === e.textureRatio && e.usePrecisionRendering && console.error("[Scene] Parameter `textureRatio` required."),
        void 0 === e.w && console.error("[Scene] Parameter `w` required."),
        void 0 === e.h && console.error("[Scene] Parameter `h` required."),
        void 0 === e.t && console.error("[Scene] Parameter `t` required."),
        void 0 === e.l && console.error("[Scene] Parameter `l` required."),
        void 0 === e.nbCacheableSprites && console.error("[Scene] Parameter `nbCacheableSprites` required."),
        void 0 === e.textureMemoryCacheSize && console.error("[Scene] Parameter `textureMemoryCacheSize` required."),
        void 0 === e.prerenderQualityRatio && console.error("[Scene] Parameter `prerenderQualityRatio` required."),
        this.name = e.name,
        this.canvas = e.canvas,
        this.canvas.id = this.name + "-canvas",
        this.maxZoom = e.maxZoom || 1,
        this.pixelRatio = e.pixelRatio,
        this.sceneTextureRatio = e.textureRatio,
        this.viewWidth = this.canvas.width,
        this.viewHeight = this.canvas.height,
        this.adjustToCanvasRatio = e.adjustToCanvasRatio || !1,
        this.w = e.w,
        this.h = e.h,
        this.l = e.l,
        this.t = e.t,
        this.r = this.l + this.w,
        this.b = this.t + this.h;
        var t = this.w / 2 + this.l
          , i = this.h / 2 + this.t;
        this.camera = new a(t,i,1,this.l,this.r,this.t,this.b,this.canvas.width,this.canvas.height,this.maxZoom),
        e.cameraAcceleration && this.camera.setDefaultAcceleration(e.cameraAcceleration),
        this.cropping = {
            x: -(1 / 0),
            y: -(1 / 0),
            w: 1 / 0,
            h: 1 / 0
        },
        this.displayList = new r(n),
        this.hudDisplayList = new r(n),
        this.staticElements = {
            sprite: null ,
            render: function(e, t) {
                null !== this.sprite && this.sprite.draw(e, t)
            },
            add: function(e) {
                return this.sprite = e,
                e
            },
            removeByRef: function(e) {
                e === this.sprite && (this.sprite = null )
            },
            reposition: function() {},
            clear: function() {
                null !== this.sprite && this.sprite.remove()
            }
        },
        this.updateList = [],
        this.renderer = new l(this.canvas,0,0,e.nbCacheableSprites,e.textureMemoryCacheSize,e.prerenderQualityRatio,(!1)),
        this._debug = !1,
        this._textureDebug = this.createTexture(o(), "mapDebug", "linear", "permanent"),
        this.usePrecisionRendering = e.usePrecisionRendering || !1,
        this.usePrecisionRendering ? (this.areasToRefresh = [],
        this.sceneRendering = this.renderer.startTextureUsage(this.r - this.l, this.b - this.t, this.sceneTextureRatio, this.name),
        this.renderingProgram = this.renderer._programFiltering,
        this.renderingParams = {
            ratio: .15,
            resolution: 250
        },
        this.refresh = this._refreshPrecisionRendering,
        this.render = this._compositePrecisionRendering,
        this.clear = this._clearPrecisionRendering) : (this.refresh = this._refresh,
        this.render = this._composite,
        this.clear = this._clear),
        this.setCanvasDimensions(this.canvas.width, this.canvas.height)
    }
    var a = i(840)
      , r = i(272)
      , l = i(267);
    e.exports = s,
    s.prototype.togglePixelArt = function() {
        this.renderingProgram === this.renderer._programPixelArt ? this.renderingProgram = this.renderer._programFiltering : this.renderingProgram = this.renderer._programPixelArt
    }
    ,
    s.prototype.setShader = function(e) {
        switch (e) {
        case "pixelArt":
            this.renderingProgram = this.renderer._programPixelArt;
            break;
        case "mapTransition":
            this.renderingProgram = this.renderer._programMapTransition;
            break;
        default:
            this.renderingProgram = this.renderer._programFiltering
        }
    }
    ,
    s.prototype._setSceneTransform = function() {
        var e = this.canvas.width / this.w
          , t = this.canvas.height / this.h
          , i = Math.max(e, t)
          , n = Math.max(0, this.cropping.x) * this.pixelRatio
          , o = Math.max(0, this.cropping.y) * this.pixelRatio;
        this.renderer.setTransform(i, 0, 0, i, n, o)
    }
    ,
    s.prototype._setFieldOfView = function() {
        this.viewWidth = Math.min(this.cropping.w, this.canvas.width / this.pixelRatio),
        this.viewHeight = Math.min(this.cropping.h, this.canvas.height / this.pixelRatio),
        this.camera.setFieldOfView(this.viewWidth, this.viewHeight),
        this._setSceneTransform()
    }
    ,
    s.prototype.setCanvasDimensions = function(e, t, i, n, o) {
        if (void 0 !== o && (this.canvas.style.position = o),
        this._viewWidth !== e || this._viewHeight !== t || this._viewLeft !== i || this._viewTop !== n) {
            this._viewWidth = e,
            this._viewHeight = t,
            this._viewLeft = i,
            this._viewTop = n,
            this.canvas.style.width = e.toString() + "px",
            this.canvas.style.height = t.toString() + "px",
            void 0 !== i && (this.canvas.style.left = i + "px"),
            void 0 !== n && (this.canvas.style.top = n + "px");
            var s = e * this.pixelRatio
              , a = t * this.pixelRatio;
            if (this.canvas.width = s,
            this.canvas.height = a,
            this.renderer.resetDimension(s, a),
            this.adjustToCanvasRatio) {
                var r = this.h * s / a;
                this.setDimensions(this.l, this.t, r, this.h)
            }
            return this._setFieldOfView(),
            !0
        }
        return !1
    }
    ,
    s.prototype.setDimensions = function(e, t, i, n) {
        this.w = i,
        this.h = n,
        this.l = e,
        this.t = t,
        this.r = this.l + this.w,
        this.b = this.t + this.h,
        this.camera.setBounds(this.l, this.r, this.t, this.b),
        this._setSceneTransform()
    }
    ,
    s.prototype.requireCompleteRefresh = function() {
        this.areasToRefresh.push([this.l, this.r, this.t, this.b])
    }
    ,
    s.prototype._refresh = function(e) {
        var t = this.camera.updatePosition(e);
        0 === this.updateList.length && t === !1 || (this.renderer.clear(),
        this._composite())
    }
    ,
    s.prototype._composite = function() {
        for (var e = 0; e < this.updateList.length; e += 1)
            this.updateList[e].refreshAnimation();
        this.updateList.length = 0;
        var t = this.pixelRatio * this.camera.zoom * Math.min(this.w / this.canvas.width, this.h / this.canvas.height);
        this.renderer.save(),
        this.renderer.translate(t / this.camera.zoom * this.viewWidth / 2, t / this.camera.zoom * this.viewHeight / 2),
        this.renderer.scale(t, t),
        this.renderer.translate(-this.camera.x, -this.camera.y);
        for (var i = this.displayList.first; null !== i; i = i.next)
            i.object.render();
        this._debug && this._renderDebug(),
        this.renderer.restore()
    }
    ,
    s.prototype._renderDebug = function() {
        for (var e = this.displayList.first; null !== e; e = e.next) {
            var t = e.object;
            this.renderer.drawImage(this._textureDebug, t.x, t.y, t.w, t.h)
        }
    }
    ,
    s.prototype._refreshPrecisionRendering = function(e) {
        var t = this.camera.updatePosition(e);
        if (0 !== this.updateList.length) {
            for (var i = 0; i < this.updateList.length; i += 1)
                this.updateList[i].refreshAnimation(this.areasToRefresh);
            this.updateList.length = 0
        }
        if (0 !== this.areasToRefresh.length) {
            for (var n = 0; n < this.areasToRefresh.length; n += 1) {
                var o = this.areasToRefresh[n];
                if (o[1] <= o[0] || o[3] <= o[2])
                    this.areasToRefresh.splice(n, 1),
                    n -= 1;
                else
                    for (var s = 0; s < this.areasToRefresh.length; s += 1)
                        if (n !== s) {
                            var a = this.areasToRefresh[s]
                              , r = (o[0] - a[1]) * (a[0] - o[1]) > 0
                              , l = (o[2] - a[3]) * (a[2] - o[3]) > 0;
                            r && l && (o[0] = Math.min(o[0], a[0]),
                            o[1] = Math.max(o[1], a[1]),
                            o[2] = Math.min(o[2], a[2]),
                            o[3] = Math.max(o[3], a[3]),
                            this.areasToRefresh.splice(s, 1),
                            s -= 1,
                            s < n && (n -= 1))
                        }
            }
            this._refreshAreas(),
            t = !0
        }
        (t || this.hudDisplayList.count > 0) && (this._compositePrecisionRendering(),
        this._debug && this._renderDebugPrecisionRendering(this.areasToRefresh),
        this.areasToRefresh.length = 0),
        this.areasToRefresh.length > 0 && (this.areasToRefresh.length = 0)
    }
    ;
    var c = {
        layer: -(1 / 0)
    }
      , u = {
        layer: 1 / 0
    };
    s.prototype._refreshAreas = function() {
        this.renderer.startTextureRendering(this.sceneRendering, this.l, this.r, this.t, this.b);
        for (var e = c, t = 0; t < this.areasToRefresh.length; t += 1) {
            var i = this.areasToRefresh[t]
              , n = Math.floor(this.sceneTextureRatio * (i[0] - this.l - 1))
              , o = Math.floor(this.sceneTextureRatio * (i[2] - this.t - 1))
              , s = Math.ceil(this.sceneTextureRatio * (i[1] - i[0] + 2))
              , a = Math.ceil(this.sceneTextureRatio * (i[3] - i[2] + 2));
            this.renderer.enableScissor(n, o, s, a);
            for (var r = this.displayList.first; null !== r; r = r.next) {
                var l = r.object
                  , h = l.bbox;
                if (!(h[0] >= h[1])) {
                    var d = (i[0] - h[1]) * (h[0] - i[1]) >= 0
                      , p = (i[2] - h[3]) * (h[2] - i[3]) >= 0;
                    d && p && (this.staticElements.render(e, l),
                    e = l,
                    l.render())
                }
            }
            this.staticElements.render(e, u)
        }
        this.renderer.stopTextureRendering(),
        this.renderer.disableScissor()
    }
    ,
    s.prototype._compositePrecisionRendering = function() {
        var e = this.pixelRatio * this.camera.zoom * Math.min(this.w / this.canvas.width, this.h / this.canvas.height);
        if (this.renderer.disableBlending(),
        this.renderer.useProgram(this.renderingProgram, this.renderingParams),
        this.renderer.drawImage(this.sceneRendering.texture, this.w / 2 - (this.camera.x - this.l) * e, this.h / 2 - (this.camera.y - this.t) * e, e * this.w, e * this.h),
        this.renderer.stopProgram(),
        this.renderer.enableBlending(),
        this.hudDisplayList.count > 0) {
            this.renderer.useProgram(this.renderer._programRegular);
            for (var t = this.hudDisplayList.first; null !== t; t = t.next)
                t.object.render();
            this.renderer.stopProgram()
        }
    }
    ,
    s.prototype._renderDebugPrecisionRendering = function(e) {
        var t = this.camera.zoom * this.pixelRatio * this.w / this.canvas.width;
        this.renderer.save(),
        this.renderer.translate(this.w / 2, this.h / 2),
        this.renderer.scale(t, t),
        this.renderer.translate(-(this.camera.x - this.l), -(this.camera.y - this.t)),
        this.renderer.enableBlending();
        for (var i = 0; i < e.length; i += 1) {
            var n = e[i]
              , o = n[0] - this.l
              , s = n[2] - this.t
              , a = n[1] - n[0]
              , r = n[3] - n[2];
            this.renderer.drawImage(this._textureDebug, o, s, a, r)
        }
        this.renderer.restore()
    }
    ,
    s.prototype.crop = function(e, t, i, n) {
        this.cropping.x = e,
        this.cropping.y = t,
        this.cropping.w = i,
        this.cropping.h = n;
        var o = this.pixelRatio;
        e = Math.ceil(o * e),
        t = Math.ceil(o * t),
        i = Math.ceil(o * i),
        n = Math.ceil(o * n),
        t = this.canvas.height - n - t,
        this.renderer.enableScissor(e, t, i, n),
        this._setFieldOfView()
    }
    ,
    s.prototype.resetCropping = function() {
        this.cropping.x = -(1 / 0),
        this.cropping.y = -(1 / 0),
        this.cropping.w = 1 / 0,
        this.cropping.h = 1 / 0,
        this.renderer.disableScissor(),
        this._setFieldOfView()
    }
    ,
    s.prototype.convertSceneToCanvasCoordinate = function(e, t) {
        var i = Math.max(0, this.cropping.x)
          , n = Math.max(0, this.cropping.y);
        return {
            x: (e - this.camera.x + this.camera.fovW / 2) * this.camera.zoom + i,
            y: (t - this.camera.y + this.camera.fovH / 2) * this.camera.zoom + n
        }
    }
    ,
    s.prototype.convertCanvasToSceneCoordinate = function(e, t) {
        var i = Math.max(0, this.cropping.x)
          , n = Math.max(0, this.cropping.y);
        return {
            x: (e - i) / this.camera.zoom + this.camera.x - this.camera.fovW / 2,
            y: (t - n) / this.camera.zoom + this.camera.y - this.camera.fovH / 2
        }
    }
    ,
    s.prototype.move = function(e, t, i, n, o) {
        e -= Math.max(0, this.cropping.x),
        t -= Math.max(0, this.cropping.y),
        this.camera.transform(e, t, i, n, o)
    }
    ,
    s.prototype.toggleDebugMode = function() {
        this._debug = !this._debug
    }
    ,
    s.prototype.showSprites = function(e) {
        for (var t = 0; t < e.length; t++)
            e[t].show()
    }
    ,
    s.prototype.hideSprites = function(e) {
        for (var t = 0; t < e.length; t++)
            e[t].hide()
    }
    ,
    s.prototype.createTexture = function(e, t, i, n) {
        return this.renderer.createTexture(e, t, i, n)
    }
    ,
    s.prototype.useTexture = function(e) {
        return this.renderer.useTexture(e)
    }
    ,
    s.prototype.holdTexture = function(e) {
        return this.renderer.holdTexture(e)
    }
    ,
    s.prototype.clean = function() {
        for (var e = this.displayList.first; null !== e; ) {
            var t = e.next;
            e.object.remove(),
            e = t
        }
        this.staticElements.clear()
    }
    ,
    s.prototype._clear = function(e, t, i, n) {
        this.renderer.setClearColor(e, t, i, n),
        this.renderer.clear(),
        this.renderer.resetClearColor()
    }
    ,
    s.prototype._clearPrecisionRendering = function(e, t, i, n) {
        this.renderer.startTextureRendering(this.sceneRendering, this.l, this.r, this.t, this.b),
        this.renderer.setClearColor(e, t, i, n),
        this.renderer.clear(),
        this.renderer.stopTextureRendering(),
        this.renderer.clear(),
        this.renderer.resetClearColor()
    }
}
, function(e, t, i) {
    function n(e, t, i, n, s, a, l, c, u, h) {
        o.call(this),
        this.l = n,
        this.r = s,
        this.t = a,
        this.b = l,
        this.w = s - n,
        this.h = l - a,
        this.min = {
            x: 0,
            y: 0
        },
        this.max = {
            x: 0,
            y: 0
        },
        this.fovWAbsolute = c,
        this.fovHAbsolute = u,
        this.setZoomMax(h),
        this._updateZoomBounds(),
        this.setZoom(i),
        this.setPosition(e, t),
        this.acceleration = r,
        this.a = this.acceleration,
        this._frozen = !1,
        this.emitAtDestination = !1
    }
    var o = i(29).EventEmitter
      , s = i(26).inherits
      , a = .005
      , r = 1.25
      , l = 3e3
      , c = .008
      , u = .013;
    s(n, o),
    e.exports = n,
    n.prototype.setAcceleration = function(e) {
        this.a = e
    }
    ,
    n.prototype.setDefaultAcceleration = function(e) {
        this.acceleration = e
    }
    ,
    n.prototype.freeze = function() {
        this._frozen = !0
    }
    ,
    n.prototype.unfreeze = function() {
        this._frozen = !1
    }
    ,
    n.prototype.stopMoving = function() {
        this.followee = {
            x: this.x,
            y: this.y
        },
        this.zoomTarget = this.zoom,
        this.z = l / this.zoom
    }
    ,
    n.prototype.setZoom = function(e) {
        e = Math.max(this.minZoom, Math.min(this.maxZoom, e)),
        this.z = l / e,
        this.zoom = e,
        this.zoomTarget = e,
        this._updatePositionBounds()
    }
    ,
    n.prototype.setZoomMax = function(e) {
        this.maxZoom = e
    }
    ,
    n.prototype.setPosition = function(e, t) {
        this.x = Math.min(this.max.x, Math.max(this.min.x, e)),
        this.y = Math.min(this.max.y, Math.max(this.min.y, t)),
        this.followee = {
            x: e,
            y: t
        }
    }
    ,
    n.prototype._updateZoomBounds = function() {
        var e = this.fovWAbsolute / this.w
          , t = this.fovHAbsolute / this.h;
        this.minZoom = Math.max(e, t),
        this.zoom < this.minZoom && (this.zoom = this.minZoom),
        this.zoomTarget < this.minZoom && (this.zoomTarget = this.minZoom),
        this.z = l / this.zoom
    }
    ,
    n.prototype._updatePositionBounds = function() {
        this.fovW = this.fovWAbsolute / this.zoomTarget,
        this.fovH = this.fovHAbsolute / this.zoomTarget,
        this.min.x = this.l + this.fovW / 2,
        this.min.y = this.t + this.fovH / 2,
        this.max.x = this.r - this.fovW / 2,
        this.max.y = this.b - this.fovH / 2,
        this.min.x > this.max.x && (this.min.x = this.max.x = (this.min.x + this.max.x) / 2),
        this.min.y > this.max.y && (this.min.y = this.max.y = (this.min.y + this.max.y) / 2)
    }
    ,
    n.prototype.zoomTo = function(e) {
        this.zoomTarget = Math.min(Math.max(e, this.minZoom), this.maxZoom),
        this._updatePositionBounds()
    }
    ,
    n.prototype.moveTo = function(e, t, i) {
        this.followee = {
            x: e,
            y: t
        },
        null !== i && void 0 !== i && (this.emitAtDestination = !0)
    }
    ,
    n.prototype.transform = function(e, t, i, n, o) {
        var s = this.zoomTarget;
        e /= s,
        t /= s,
        i /= s,
        n /= s;
        var a = Math.max(this.minZoom, Math.min(this.maxZoom, s * o))
          , r = 1 - s / a
          , l = Math.min(this.max.x, Math.max(this.min.x, this.followee.x))
          , c = Math.min(this.max.y, Math.max(this.min.y, this.followee.y))
          , u = l + (e - this.fovW / 2) * r + i
          , h = c + (t - this.fovH / 2) * r + n;
        this.zoomTo(a),
        this.moveTo(u, h)
    }
    ,
    n.prototype.addInertia = function(e, t, i) {
        e /= this.zoom,
        t /= this.zoom;
        var n = Math.sqrt(e * e + t * t);
        if (0 !== n) {
            this.a = Math.pow(this.acceleration, 1 - i);
            var o = Math.log(n / a) / Math.log(this.a) - 1
              , s = a * (1 - Math.pow(this.a, o)) / (1 - this.a);
            this.moveTo(this.x + s * e / n, this.y + t * s / n)
        }
    }
    ,
    n.prototype.setFieldOfView = function(e, t) {
        this.fovWAbsolute = e,
        this.fovHAbsolute = t,
        this._updateZoomBounds(),
        this._updatePositionBounds()
    }
    ,
    n.prototype.setBounds = function(e, t, i, n) {
        this.l = e,
        this.r = t,
        this.t = i,
        this.b = n,
        this.w = t - e,
        this.h = n - i,
        this._updateZoomBounds(),
        this._updatePositionBounds()
    }
    ,
    n.prototype.follow = function(e) {
        this.followee = e
    }
    ,
    n.prototype.updatePosition = function(e) {
        if (!this._frozen) {
            this.a += (this.acceleration - this.a) * (u * e);
            var t = this.min.x
              , i = this.max.x
              , n = this.min.y
              , o = this.max.y
              , s = Math.min(i, Math.max(t, this.followee.x))
              , a = Math.min(o, Math.max(n, this.followee.y))
              , r = l / this.zoomTarget
              , h = this.x
              , d = this.y
              , p = this.z
              , m = s - h
              , f = a - d
              , g = r - p;
            if (Math.abs(m) < .5 && Math.abs(f) < .5 && Math.abs(g) < .5)
                return this.x = s,
                this.y = a,
                this.z = r,
                this.zoom = this.zoomTarget,
                this.emitAtDestination && (this.emitAtDestination = !1,
                this.emit("reached")),
                this.a += (1 - this.a) * c,
                !1;
            var _ = 1 - Math.pow(2 - this.a, e);
            this.x += _ * m,
            this.y += _ * f,
            this.z += _ * g,
            this.zoom = l / this.z;
            var v = this.fovWAbsolute / this.zoom
              , y = this.fovHAbsolute / this.zoom;
            return t = this.l + v / 2,
            n = this.t + y / 2,
            i = this.r - v / 2,
            o = this.b - y / 2,
            this.x < t ? this.x = t : this.x > i && (this.x = i),
            this.y < n ? this.y = n : this.y > o && (this.y = o),
            !0
        }
    }
}
, function(e, t) {
    function i(e, t, i, n) {
        this.x0 = e,
        this.y0 = t,
        this.x1 = i,
        this.y1 = n
    }
    e.exports = i
}
, function(e, t) {
    function i(e, t, i, n, o, s, a, r) {
        this.x0 = e,
        this.y0 = t,
        this.x1 = i,
        this.y1 = n,
        this.x2 = o,
        this.y2 = s,
        this.x3 = a,
        this.y3 = r,
        this.cellId = null
    }
    e.exports = i
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e),
        this._lines = e.lines,
        this._lineWidth = e.lineWidth * a.PIXEL_RATIO,
        this._lineByteSize = this.renderer.getNbBytesPerLine(),
        this._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this._createVertexBuffer()
    }
    var o = i(26).inherits
      , s = i(244)
      , a = i(6);
    o(n, s),
    e.exports = n,
    n.prototype._createVertexBuffer = function() {
        var e = this._lines.length;
        this._vertexBuffer = new ArrayBuffer(e * this._lineByteSize),
        this._positions = new Float32Array(this._vertexBuffer),
        this._colorView = new Uint32Array(this._vertexBuffer);
        for (var t = 0; t < e; t += 1) {
            var i = this._lines[t];
            this._expandToFitLine(i);
            var n = t * this._lineByteSize / 4;
            this._positions[n + 0] = i.x0,
            this._positions[n + 1] = i.y0,
            this._positions[n + 5] = i.x1,
            this._positions[n + 6] = i.y1,
            this._colorView[n + 3] = this._colorView[n + 8] = 1077952576
        }
        this.renderer.releaseBuffer(this.id),
        this.forceRefresh()
    }
    ,
    n.prototype.draw = function() {
        this.renderer.drawLineBatch(this.id, this._lineWidth)
    }
    ,
    n.prototype._expandToFitPoint = function(e, t) {
        this._bbox[0] > e && (this._bbox[0] = e),
        this._bbox[2] > t && (this._bbox[2] = t),
        this._bbox[1] < e && (this._bbox[1] = e),
        this._bbox[3] < t && (this._bbox[3] = t)
    }
    ,
    n.prototype._expandToFitLine = function(e) {
        this._expandToFitPoint(e.x0, e.y0),
        this._expandToFitPoint(e.x1, e.y1)
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this._positions
              , i = !1;
            this.renderer.loadLineBuffer(this.id, t, this._bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e),
        this._boxes = e.boxes,
        this._boxByteSize = this.renderer.getNbBytesPerBox(),
        this._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this._createVertexBuffer()
    }
    var o = i(26).inherits
      , s = i(244);
    o(n, s),
    e.exports = n,
    n.prototype._createVertexBuffer = function() {
        var e = this._boxes.length;
        this._vertexBuffer = new ArrayBuffer(e * this._boxByteSize),
        this._positions = new Float32Array(this._vertexBuffer),
        this._colorView = new Uint32Array(this._vertexBuffer);
        for (var t = 1077952576, i = 0; i < e; i += 1) {
            var n = this._boxes[i];
            this._expandToFitBox(n);
            var o = i * this._boxByteSize / 4;
            this._positions[o + 0] = n.x0,
            this._positions[o + 1] = n.y0,
            this._colorView[o + 3] = t,
            this._positions[o + 5] = n.x2,
            this._positions[o + 6] = n.y2,
            this._colorView[o + 8] = t,
            this._positions[o + 10] = n.x3,
            this._positions[o + 11] = n.y3,
            this._colorView[o + 13] = t,
            this._positions[o + 15] = n.x0,
            this._positions[o + 16] = n.y0,
            this._colorView[o + 18] = t,
            this._positions[o + 20] = n.x1,
            this._positions[o + 21] = n.y1,
            this._colorView[o + 23] = t,
            this._positions[o + 25] = n.x2,
            this._positions[o + 26] = n.y2,
            this._colorView[o + 28] = t
        }
        this._bbox[0] += this._x,
        this._bbox[1] += this._x,
        this._bbox[2] += this._y,
        this._bbox[3] += this._y,
        this.renderer.releaseBuffer(this.id),
        this.forceRefresh()
    }
    ,
    n.prototype.draw = function() {
        this.renderer.drawBoxBatch(this.id)
    }
    ,
    n.prototype._expandToFitPoint = function(e, t) {
        this._bbox[0] > e && (this._bbox[0] = e),
        this._bbox[2] > t && (this._bbox[2] = t),
        this._bbox[1] < e && (this._bbox[1] = e),
        this._bbox[3] < t && (this._bbox[3] = t)
    }
    ,
    n.prototype._expandToFitBox = function(e) {
        this._expandToFitPoint(e.x0, e.y0),
        this._expandToFitPoint(e.x1, e.y1),
        this._expandToFitPoint(e.x2, e.y2),
        this._expandToFitPoint(e.x3, e.y3)
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this.id
              , i = this._positions
              , n = !1;
            this.renderer.loadSpriteBuffer(t, i, null , this._bbox, n),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t, i) {
    var n = i(6)
      , o = i(261)
      , s = 1e3 / n.FPS
      , a = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(e) {
        window.setTimeout(e, s)
    }
      , r = {
        gameScenes: [],
        previousUpdate: Date.now(),
        addScene: function(e) {
            var t = this.gameScenes.indexOf(e);
            t === -1 ? this.gameScenes.push(e) : console.warn("[animationController.addScene] Scene already in the animation controller")
        },
        removeScene: function(e) {
            var t = this.gameScenes.indexOf(e);
            t !== -1 ? this.gameScenes.splice(t, 1) : console.warn("[animationController.removeScene] Scene not in the animation controller")
        },
        start: function() {
            function e() {
                o.update();
                var i = Date.now()
                  , n = Math.min(i - t.previousUpdate, 200)
                  , r = n > s;
                if (r) {
                    t.previousUpdate = i - n % s,
                    n /= s;
                    for (var l = t.gameScenes, c = 0; c < l.length; c += 1)
                        l[c].refresh(n)
                }
                a(e)
            }
            var t = this;
            e()
        },
        stop: function() {
            o.stop()
        }
    };
    e.exports = r
}
, function(e, t, i) {
    function n(e, t, i, n, o, r, l, c) {
        var u = s / i
          , h = a / i;
        this.x = e * u,
        this.y = t * h,
        this.w = u,
        this.h = h,
        this.id = n,
        this.path = o,
        this.texture = r,
        this.scene = l,
        this.distToViewCenter = c
    }
    var o = i(847)
      , s = o.CHUNK_WIDTH
      , a = o.CHUNK_HEIGHT;
    e.exports = n
}
, function(e, t, i) {
    t.WORLDMAP_PATH = i(6).WORLDMAP_PATH,
    t.SUBAREA_COLOR = [16 / 255, 186 / 255, 105 / 255, .25],
    t.VIEW_MARGIN = 1.1,
    t.CHUNK_WIDTH = 250,
    t.CHUNK_HEIGHT = 250,
    t.ICON_DIAMETER = 28
}
, function(e, t) {
    function i(e, t, i, n) {
        this.id = e,
        this.visible = !0,
        this.color = null ,
        this.categoryId = t,
        this.infoData = i,
        this.dimensions = n,
        this.cluster = null ,
        this.vertexBufferSlot = null
    }
    e.exports = i,
    i.prototype.setVisibility = function(e) {
        return this.visible !== e && (this.visible = e,
        this.cluster && (e ? this.cluster.nVisibleIcons += 1 : this.cluster.nVisibleIcons -= 1),
        !0)
    }
}
, function(e, t, i) {
    function n(e) {
        this.texture = null ,
        this.iconDimensions = null ,
        this.iconBatch = null ,
        this.worldMap = e,
        this.reset()
    }
    var o = i(850).clusterOrdering
      , s = i(852)
      , a = i(848);
    e.exports = n,
    n.prototype.getClusterIcons = function(e) {
        var t = this.iconClusters[e];
        if (t)
            return t.icons
    }
    ,
    n.prototype.reset = function() {
        this.icons = {},
        this.iconClusters = {},
        this.iconsPerCategory = {},
        this.zIndexedIconClusters = []
    }
    ,
    n.prototype.addCluster = function(e) {
        this.iconClusters[e.id] = e,
        this.zIndexedIconClusters.push(e),
        this.zIndexedIconClusters.sort(o)
    }
    ,
    n.prototype.removeCluster = function(e) {
        var t = this.zIndexedIconClusters.indexOf(e);
        return t === -1 ? void console.error(new Error("[IconBatchData.removeCluster] Trying to remove inexistent cluster")) : (delete this.iconClusters[e.id],
        void this.zIndexedIconClusters.splice(t, 1))
    }
    ,
    n.prototype.createIconModels = function(e, t) {
        for (var i = {}, n = Object.keys(e), o = 0; o < n.length; o += 1) {
            var s = e[n[o]];
            i[s.className] = s
        }
        this.texture = t,
        this.iconDimensions = i
    }
    ,
    n.prototype.clearIconBatch = function() {
        null !== this.iconBatch && (this.iconBatch.clear(),
        this.iconBatch = null )
    }
    ,
    n.prototype.addIcon = function(e) {
        var t = e.id;
        if (void 0 !== this.icons[t])
            return void console.error("An icon of id", t, "already exists.");
        this.icons[t] = e;
        var i = e.categoryId;
        void 0 === this.iconsPerCategory[i] ? this.iconsPerCategory[i] = [e] : this.iconsPerCategory[i].push(e),
        null !== this.iconBatch && this.iconBatch.addIcon(e)
    }
    ,
    n.prototype.removeIcon = function(e) {
        var t = this.icons[e];
        if (void 0 !== t) {
            delete this.icons[e];
            var i = t.cluster;
            i.remove(t),
            0 === i.icons.length && this.removeCluster(i);
            var n = this.iconsPerCategory[t.categoryId]
              , o = n.indexOf(t.id);
            n.splice(o, 1),
            null !== this.iconBatch && this.iconBatch.removeIcon(t)
        }
    }
    ,
    n.prototype._addIconToZoneCluster = function(e, t, i) {
        var n = this.worldMap.convertGridCoordinateToZoneId(t, i)
          , o = this.iconClusters[n];
        if (void 0 === o) {
            var a = this.worldMap._convertGridToSceneCoordinate(t, i);
            o = new s(n,a.x,a.y),
            this.addCluster(o)
        }
        o.add(e),
        e.cluster = o
    }
    ,
    n.prototype.createIcon = function(e, t) {
        var i = e.x
          , n = e.y
          , o = e.categoryId
          , s = new a(e.id,o,e,this.iconDimensions[t]);
        return this._addIconToZoneCluster(s, i, n),
        this.addIcon(s),
        s
    }
    ,
    n.prototype.createIconsFromInfo = function(e, t) {
        for (var i = Object.keys(e), n = 0; n < i.length; n += 1) {
            var o = e[i[n]];
            o.worldMapId === t && this.createIcon(o, "icon_" + o.gfx)
        }
    }
    ,
    n.prototype.hasIcon = function(e) {
        return this.icons.hasOwnProperty(e)
    }
    ,
    n.prototype.getIcon = function(e) {
        return this.icons[e]
    }
    ,
    n.prototype.setVisibilityOfIconType = function(e, t) {
        var i = this.iconsPerCategory[e];
        if (void 0 !== i) {
            for (var n = [], o = 0; o < i.length; o += 1) {
                var s = i[o]
                  , a = s.setVisibility(t);
                a && n.push(s)
            }
            null !== this.iconBatch && this.iconBatch.setVisibility(n, t)
        }
    }
    ,
    n.prototype.setIconPosition = function(e, t, i) {
        var n = this.icons[e];
        if (void 0 !== n) {
            var s = n.cluster;
            if ("userPosition" === e) {
                var a = this.worldMap._convertGridToSceneCoordinate(t, i);
                s.position.x = a.x,
                s.position.y = a.y,
                this.zIndexedIconClusters.sort(o)
            } else
                s.remove(n),
                this._addIconToZoneCluster(n, t, i);
            null !== this.iconBatch && this.iconBatch.updateIconPosition(n)
        }
    }
}
, function(e, t, i) {
    var n = i(847).ICON_DIAMETER
      , o = i(851);
    t.positionOrdering = function(e, t) {
        var i = e.y - t.y;
        return 0 === i ? e.x - t.x : i
    }
    ,
    t.clusterOrdering = function(e, t) {
        var i = e.position
          , n = t.position
          , o = i.y - n.y;
        return 0 === o ? i.x - n.x : o
    }
    ;
    var s = [];
    t.computeRelativePositions = function(e) {
        for (var i = [], a = e <= 1 ? 0 : n / (2 * Math.sin(Math.PI / e)), r = 0; r < e; r += 1) {
            var l = 2 * Math.PI * r / e;
            i[r] = new o(Math.cos(l) * a,Math.sin(l) * a)
        }
        return i.sort(t.positionOrdering),
        i.push(new o(0,0)),
        s[e] = i,
        i
    }
    ,
    t.getRelativePositions = function(e) {
        var i = s[e];
        return void 0 === i && (i = t.computeRelativePositions(e)),
        i
    }
}
, function(e, t) {
    function i(e, t) {
        this.x = e,
        this.y = t
    }
    e.exports = i,
    i.prototype.plus = function(e) {
        return new i(this.x + e.x,this.y + e.y)
    }
    ,
    i.prototype.copy = function() {
        return new i(this.x,this.y)
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        this.id = e,
        this.position = new o(t,i),
        this.icons = [],
        this.nVisibleIcons = 0
    }
    var o = i(851)
      , s = i(850).getRelativePositions;
    e.exports = n,
    n.prototype.getIconPosition = function(e) {
        var t = s(this.nVisibleIcons);
        return this.position.plus(t[e])
    }
    ,
    n.prototype.add = function(e) {
        this.icons.unshift(e),
        e.visible && (this.nVisibleIcons += 1)
    }
    ,
    n.prototype.remove = function(e) {
        var t = this.icons.indexOf(e);
        t === -1 ? console.error(new Error("[IconCluster.remove] Icon not in cluster: " + e.id)) : (this.icons.splice(t, 1),
        e.visible && (this.nVisibleIcons -= 1))
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.icon = e,
        this.index = t,
        this.reference = null
    }
    function o(e) {
        a.call(this, e),
        this._bbox = [0, e.w, 0, e.h],
        this._iconsData = e.iconsData,
        this._texture = this._iconsData.texture,
        this._textureWidth = this._texture.element.width,
        this._textureHeight = this._texture.element.height,
        this._iconByteSize = this.renderer.getNbBytesPerSprite(),
        this._vertexBufferSlots = new l,
        this._populateVertexBuffer()
    }
    var s = i(26).inherits
      , a = i(244)
      , r = i(261)
      , l = i(252)
      , c = r.Tween
      , u = 3.3
      , h = .2
      , d = 9;
    s(o, a),
    e.exports = o,
    o.prototype._createVertexBuffer = function() {
        this._vertexBuffer = new ArrayBuffer(this._vertexBufferSlots.length * this._iconByteSize),
        this._floatView = new Float32Array(this._vertexBuffer),
        this._longView = new Uint32Array(this._vertexBuffer),
        this._shortView = new Uint16Array(this._vertexBuffer),
        this._byteView = new Uint8Array(this._vertexBuffer)
    }
    ,
    o.prototype._assignVertexBufferSlots = function() {
        for (var e = 0, t = this._iconsData.zIndexedIconClusters, i = 0; i < t.length; i += 1)
            for (var o = t[i], s = o.icons, a = 0; a < s.length; a += 1) {
                var r = s[a]
                  , l = new n(r,e);
                l.reference = this._vertexBufferSlots.addBack(l),
                r.vertexBufferSlot = l,
                e += 1
            }
    }
    ,
    o.prototype._populateVertexBuffer = function() {
        this._assignVertexBufferSlots(),
        this._createVertexBuffer();
        for (var e = this._iconsData.zIndexedIconClusters, t = 0; t < e.length; t++)
            this._populateClusterVertexBuffer(e[t]);
        this.renderer.releaseBuffer(this.id),
        this.forceRefresh()
    }
    ,
    o.prototype._populateClusterVertexBuffer = function(e) {
        for (var t = 0, i = e.icons, n = 0; n < i.length; n += 1)
            t = this._populateIconVertexBuffer(i[n], t)
    }
    ,
    o.prototype._populateIconVertexBuffer = function(e, t) {
        var i = this._floatView
          , n = this._longView
          , o = this._longView
          , s = e.cluster.getIconPosition(t)
          , a = e.vertexBufferSlot.index * this._iconByteSize / 4;
        i[a + 0] = i[a + 5] = i[a + 10] = s.x,
        i[a + 15] = i[a + 20] = i[a + 25] = s.x,
        i[a + 1] = i[a + 6] = i[a + 11] = s.y,
        i[a + 16] = i[a + 21] = i[a + 26] = s.y;
        var r = e.dimensions
          , l = r.sx / this._textureWidth
          , c = r.sy / this._textureHeight
          , u = (r.sx + r.sw) / this._textureWidth
          , d = (r.sy + r.sh) / this._textureHeight
          , p = 65535 & 65535 * l
          , m = 65535 & 65535 * u
          , f = 4294901760 & 4294901760 * c
          , g = 4294901760 & 4294901760 * d;
        n[a + 2] = p + f,
        n[a + 7] = p + g,
        n[a + 12] = m + g,
        n[a + 17] = p + f,
        n[a + 22] = m + g,
        n[a + 27] = m + f;
        var _ = e.infoData.color || [1, 1, 1, 1]
          , v = Math.max(-128, Math.min(127, 64 * _[0]))
          , y = Math.max(-128, Math.min(127, 64 * _[1]))
          , w = Math.max(-128, Math.min(127, 64 * _[2]))
          , b = e.visible ? Math.max(-128, Math.min(127, 64 * _[3])) : 0
          , C = (b << 24 & 4278190080) + (w << 16 & 16711680) + (y << 8 & 65280) + (255 & v);
        n[a + 3] = n[a + 8] = n[a + 13] = C,
        n[a + 18] = n[a + 23] = n[a + 28] = C;
        var I = r.x
          , T = r.w + I
          , S = r.y
          , A = r.h + S
          , E = 255 & I
          , x = 255 & T
          , M = (255 & S) << 8
          , N = (255 & A) << 8
          , R = 127 * (1 - h) & 255
          , O = (R << 24) + (R << 16);
        return o[a + 4] = E + M + O,
        o[a + 9] = E + N + O,
        o[a + 14] = x + N + O,
        o[a + 19] = E + M + O,
        o[a + 24] = x + N + O,
        o[a + 29] = x + M + O,
        e.visible ? t + 1 : t
    }
    ,
    o.prototype.setVisibility = function(e, t, i, n) {
        for (var o, s, a = n || {}, r = 0; r < e.length; r += 1)
            s = e[r].cluster,
            void 0 === a[s.id] && (a[s.id] = s);
        for (var l = [], u = {}, p = Object.keys(a), m = 0; m < p.length; m += 1) {
            var f = p[m];
            s = a[f];
            var g = s.icons
              , _ = 0;
            for (r = 0; r < g.length; r += 1)
                if (o = g[r],
                o.visible) {
                    var v = o.vertexBufferSlot.index * this._iconByteSize / 4;
                    l.push(o),
                    u[o.id] = {
                        origin: {
                            x: this._floatView[v],
                            y: this._floatView[v + 1]
                        },
                        destination: s.getIconPosition(_)
                    },
                    _ += 1
                }
        }
        var y = {
            ease: 0
        }
          , w = this
          , b = new c(y,["ease"]);
        b.onUpdate(function() {
            var i = w._floatView
              , n = w._shortView
              , o = w._byteView
              , s = y.ease
              , a = t ? s : 1 - s
              , r = 64 * a & 255
              , c = a - 1
              , d = 2
              , p = c * c * ((d + 1) * c + d) + 1 - h;
            p = 127 * p & 255,
            p += p << 8;
            for (var m = 0; m < e.length; m += 1) {
                var f = e[m]
                  , g = f.vertexBufferSlot.index * w._iconByteSize
                  , _ = g / 2;
                n[_ + 9] = n[_ + 19] = n[_ + 29] = p,
                n[_ + 39] = n[_ + 49] = n[_ + 59] = p,
                o[g + 15] = o[g + 35] = o[g + 55] = r,
                o[g + 75] = o[g + 95] = o[g + 115] = r
            }
            var v = 1 - Math.pow((1 - s) / 1, 4);
            for (m = 0; m < l.length; m += 1) {
                var b = l[m]
                  , C = u[b.id]
                  , I = C.origin.x * (1 - v) + C.destination.x * v
                  , T = C.origin.y * (1 - v) + C.destination.y * v
                  , S = b.vertexBufferSlot.index * w._iconByteSize / 4;
                i[S + 0] = i[S + 5] = i[S + 10] = I,
                i[S + 15] = i[S + 20] = i[S + 25] = I,
                i[S + 1] = i[S + 6] = i[S + 11] = T,
                i[S + 16] = i[S + 21] = i[S + 26] = T
            }
            w.renderer.releaseBuffer(w.id),
            w.forceRefresh()
        }),
        b.from({
            ease: 0
        }),
        b.to({
            ease: 1
        }, d),
        b.onFinish(i),
        b.start()
    }
    ,
    o.prototype.getSlotWhereIconShouldFit = function(e) {
        var t = e.cluster
          , i = this._iconsData.zIndexedIconClusters
          , n = i
          , o = n.indexOf(t);
        if (o === -1)
            return void console.error(new Error("[IconBatch.addIconToVertexBuffer] Icon cluster not present in ordered list"));
        var s = t.icons
          , a = s.indexOf(e);
        if (a === -1)
            return void console.error(new Error("[IconBatch.addIconToVertexBuffer] Icon not present in its cluster"));
        var r;
        if (a === s.length - 1)
            if (o === i.length - 1)
                if (0 === o) {
                    if (!this._vertexBufferSlots.first)
                        return null ;
                    r = this._vertexBufferSlots.first.object
                } else {
                    var l = i[o - 1].icons;
                    r = l[l.length - 1].vertexBufferSlot
                }
            else
                r = i[o + 1].icons[0].vertexBufferSlot;
        else
            r = s[a + 1].vertexBufferSlot;
        var c = e.vertexBufferSlot;
        return null !== e.vertexBufferSlot && c.index < r.index && (r = r.reference.previous.object),
        r
    }
    ,
    o.prototype.addIcon = function(e) {
        if (null !== e.vertexBufferSlot)
            return void console.warn("[IconBatch.addIconToVertexBuffer] Trying to add an icon already present in the vertex buffer");
        var t, i, o = this.getSlotWhereIconShouldFit(e);
        if (null === o) {
            var s = new n(e,0);
            s.reference = this._vertexBufferSlots.add(s),
            e.vertexBufferSlot = s,
            i = null ,
            t = 0
        } else {
            t = o.index;
            var a = new n(e,t);
            for (a.reference = this._vertexBufferSlots.addBefore(o.reference, a),
            e.vertexBufferSlot = a,
            i = o.reference; null !== i && null !== i.icon; )
                i.object.index += 1,
                i = i.next
        }
        if (null === i) {
            var r = this._floatView;
            this._createVertexBuffer();
            var l = t * this._iconByteSize / 4
              , c = r.subarray(0, l)
              , u = r.subarray(l);
            this._floatView.set(c, 0),
            this._floatView.set(u, l + this._iconByteSize / 4)
        } else {
            var h = t * this._iconByteSize / 4
              , d = i.object.index * this._iconByteSize / 4;
            this._vertexBufferSlots.removeByReference(i);
            var p = this._floatView.subarray(h, d);
            this._floatView.set(p, h + this._iconByteSize / 4)
        }
        this._populateIconVertexBuffer(e, 0),
        this.setVisibility([e], !0)
    }
    ,
    o.prototype.updateIconPosition = function(e) {
        var t = e.vertexBufferSlot;
        if (null === t)
            return void console.error(new Error("[IconBatch.updateIconPosition] Given icon is not present in the vertex buffer"));
        var i = this.getSlotWhereIconShouldFit(e);
        if (t.index !== i.index) {
            var n, o, s, a, r, l = t.index * this._iconByteSize / 4, c = l + this._iconByteSize / 4, u = new Float32Array(this._floatView.subarray(l, c));
            if (t.index < i.index)
                for (n = c,
                o = i.index * this._iconByteSize / 4 + this._iconByteSize / 4,
                this._floatView.set(this._floatView.subarray(n, o), l),
                r = t.reference; null !== r && r.object !== i; )
                    s = r.object,
                    r = r.next,
                    a = r.object.icon,
                    a.vertexBufferSlot = s,
                    s.icon = a;
            else
                for (n = i.index * this._iconByteSize / 4,
                o = l,
                this._floatView.set(this._floatView.subarray(n, o), n + this._iconByteSize / 4),
                r = t.reference; null !== r && r.object !== i; )
                    s = r.object,
                    r = r.previous,
                    a = r.object.icon,
                    a.vertexBufferSlot = s,
                    s.icon = a;
            i.icon = e,
            e.vertexBufferSlot = i,
            this._floatView.set(u, i.index * this._iconByteSize / 4)
        }
        var h = {}
          , d = e.cluster;
        h[d.id] = d,
        this.setVisibility([], !0, null , h)
    }
    ,
    o.prototype.removeIcon = function(e) {
        this.setVisibility([e], !1, function() {
            e.visible === !1 && (e.vertexBufferSlot.icon = null ,
            e.vertexBufferSlot = null )
        })
    }
    ,
    o.prototype.render = function() {
        this.renderer.drawSpriteBatchAbsoluteScale(this.id, u * this.scene.pixelRatio)
    }
    ,
    o.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this.id
              , i = this._floatView
              , n = this._texture
              , o = !1;
            this.renderer.loadSpriteBuffer(t, i, n, this._bbox, o),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    o.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t) {
    function i(e) {
        var t = this
          , i = window.gui
          , n = i.GPS;
        this._lastWorld = null ,
        this._worldMap = e,
        n.on("addPOI", function(e, n) {
            n && n !== i.playerData.position.worldmapId || t._worldMap.hasIcon(e.id) || (t._worldMap.isLoading() ? t._worldMap.once("loaded", function() {
                t._worldMap.addIcon(e, e.iconId)
            }) : t._worldMap.addIcon(e, e.iconId))
        }),
        n.on("removePOI", function(e, n) {
            n && n !== i.playerData.position.worldmapId || t._worldMap.hasIcon(e) && t._worldMap.removeIcon(e)
        }),
        n.on("updatePOI", function(e, n) {
            n && n !== i.playerData.position.worldmapId || t._worldMap.hasIcon(e.id) && (t._worldMap.removeIcon(e.id),
            t._worldMap.addIcon(e, e.iconId))
        })
    }
    e.exports = i,
    i.prototype.update = function() {
        var e = window.gui
          , t = e.GPS
          , i = e.playerData.position.worldmapId;
        if (this._lastWorld !== i) {
            var n = t.getPOIs(this._lastWorld);
            for (var o in n)
                this._worldMap.hasIcon(o) && this._worldMap.removeIcon(o);
            n = t.getPOIs();
            for (o in n)
                if (!this._worldMap.hasIcon(o)) {
                    var s = n[o];
                    this._worldMap.addIcon(s, s.iconId)
                }
            this._lastWorld = i
        }
    }
}
, function(e, t, i) {
    function n() {
        this._prisms = {},
        this._emptyPrisms = {},
        this._activePrisms = {},
        this._changingPrisms = {},
        this._worldMap = null ,
        this._worldMapLoaded = !1,
        this._updateQueue = [];
        var e = this;
        window.gui.on("PrismsListMessage", function(t) {
            function i() {
                e._changingPrisms = t.prisms;
                var i = Object.keys(t.prisms);
                for (var n in i) {
                    var o = t.prisms[i[n]];
                    e._prisms[o.subAreaId] = o,
                    "PrismGeolocalizedInformation" === o._type ? e._activePrisms[o.subAreaId] = o : e._emptyPrisms[o.subAreaId] = o
                }
                e._updateWorldMapIcons()
            }
            e._worldMapLoaded ? i() : e._updateQueue.push(i)
        }),
        window.gui.on("PrismsListUpdateMessage", function(t) {
            function i() {
                e._changingPrisms = {};
                for (var i in t.prisms) {
                    var n = t.prisms[i]
                      , o = n.subAreaId
                      , s = e._prisms[n.subAreaId];
                    "PrismGeolocalizedInformation" === n._type ? ((!s || s.mapId !== n.mapId || s.worldX !== n.worldX || s.worldY !== n.worldY || s.subAreaId !== n.subAreaId || s.prism.state !== n.prism.state || s.prism.alliance && n.prism.alliance && s.prism.alliance.allianceTag !== n.prism.alliance.allianceTag) && (e._changingPrisms[n.subAreaId] = n),
                    e._activePrisms[o] = n,
                    delete e._emptyPrisms[o]) : (e._emptyPrisms[o] = n,
                    delete e._activePrisms[o]),
                    e._prisms[n.subAreaId] = n
                }
                e._updateWorldMapIcons()
            }
            e._worldMapLoaded ? i() : e._updateQueue.push(i)
        })
    }
    function o(e, t) {
        return function() {
            var i = new Date;
            return i.setTime(1e3 * e.prism.nextVulnerabilityDate - Date.now()),
            t + " " + a(i)
        }
    }
    function s(e, t) {
        return function() {
            var i = new Date;
            i.setTime(1e3 * e.prism.nextVulnerabilityDate);
            var n = {
                month: "numeric",
                day: "numeric",
                hour: "numeric",
                minute: "numeric",
                second: "numeric"
            };
            return t + " " + i.toLocaleString(window.Config.language, n)
        }
    }
    function a(e) {
        return e.getHours().toString() + ":" + r(e.getMinutes().toString()) + ":" + r(e.getSeconds().toString())
    }
    function r(e) {
        return e < 10 ? "0" + e : e
    }
    var l = i(346)
      , c = i(35).getText
      , u = 436
      , h = 421
      , d = 420;
    e.exports = n,
    n.prototype.clear = function() {
        this._worldMap = null ,
        this._worldMapLoaded = !1,
        this._updateQueue = []
    }
    ,
    n.prototype.setWorldMap = function(e) {
        if (1 === e._worldMapId && (this._worldMap = e,
        this._worldMapLoaded = !0,
        this._updateQueue.length > 0))
            for (var t in this._updateQueue) {
                var i = this._updateQueue[t];
                i(),
                delete this._updateQueue[t]
            }
    }
    ,
    n.prototype._updateWorldMapIcons = function() {
        for (var e in this._emptyPrisms) {
            var t = this._emptyPrisms[e];
            this._worldMap.removeIcon(t.subAreaId)
        }
        var i = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_INVULNERABLE))
          , n = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_ATTACKED))
          , a = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_FIGHTING))
          , r = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_NORMAL))
          , p = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_WEAKENED))
          , m = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_VULNERABLE))
          , f = c("ui.prism.prismInState", c("ui.prism.state" + l.PRISM_STATE_DEFEATED))
          , g = c("ui.prism.startVulnerability") + c("ui.common.colon")
          , _ = c("ui.prism.vulnerabilityHour")
          , v = Object.keys(this._changingPrisms);
        for (var y in v) {
            var w = this._changingPrisms[v[y]];
            if (this._activePrisms[w.subAreaId]) {
                var b, C, I;
                switch (w.prism.state) {
                case l.PRISM_STATE_INVULNERABLE:
                    b = d,
                    C = i + "\n" + _,
                    I = o(w, C);
                    break;
                case l.PRISM_STATE_NORMAL:
                    b = d,
                    C = r + "\n" + _,
                    I = o(w, C);
                    break;
                case l.PRISM_STATE_ATTACKED:
                    b = d,
                    C = n + "\n" + _,
                    I = o(w, C);
                    break;
                case l.PRISM_STATE_FIGHTING:
                    b = d,
                    C = a + "\n" + _,
                    I = o(w, C);
                    break;
                case l.PRISM_STATE_WEAKENED:
                    b = h,
                    C = p + "\n" + g,
                    I = s(w, C);
                    break;
                case l.PRISM_STATE_VULNERABLE:
                    b = u,
                    C = m,
                    I = function(e) {
                        return function() {
                            return e
                        }
                    }(C);
                    break;
                case l.PRISM_STATE_DEFEATED:
                    b = u,
                    C = f,
                    I = function(e) {
                        return function() {
                            return e
                        }
                    }(C);
                    break;
                default:
                    b = u,
                    C = f,
                    I = function(e) {
                        return function() {
                            return e
                        }
                    }(C)
                }
                var T = {
                    id: w.subAreaId,
                    x: w.worldX,
                    y: w.worldY,
                    subAreaId: w.subAreaId,
                    categoryId: "prisms",
                    gfx: b,
                    nameIdOverRideFunc: I
                };
                this._worldMapLoaded ? (this._worldMap.removeIcon(T.id),
                this._worldMap.addIcon(T, "icon_" + T.gfx)) : console.error("map not loaded!")
            }
        }
    }
}
, function(e, t, i) {
    function n() {
        function e() {
            t.setTitle(t.tabsDefinitions[this.tabId].title)
        }
        s.call(this, {
            className: "SocialWindow",
            positionInfo: {
                top: 40,
                left: 80,
                right: 40,
                bottom: 40
            }
        });
        var t = this;
        this.closedWithGuildFightLeaveRequest = !1;
        var i = ["friends", "guild", "alliance", "spouse", "directory"]
          , n = this.tabsDefinitions = {
            friends: {
                target: new u
            },
            guild: {
                target: new d
            },
            alliance: {
                target: new l
            },
            spouse: {
                target: new p
            },
            directory: {
                target: new m
            }
        }
          , o = this.windowBody;
        this.tabs = o.appendChild(new g);
        for (var a = 0; a < i.length; a += 1) {
            var c = i[a]
              , h = n[c]
              , f = o.appendChild(h.target);
            f.tabId = c,
            this.tabs.addTab("", f, c),
            f.on("open", e)
        }
        this._initTabs(),
        this.on("open", function(e) {
            this.tabs.openTab(e.tabId, e.tabParams, {
                delayOpenedEvent: !0,
                forceOpen: !0
            })
        }),
        this.on("opened", function() {
            this.tabs.emitOnCurrentTab("opened")
        }),
        this.on("close", function() {
            var e, t = window.gui.playerData.id;
            e = r.isPlayerDefending(r.entityType.taxCollector, t),
            e && r.playerAutoKick(r.entityType.taxCollector, e),
            e = r.isPlayerDefending(r.entityType.prism, t),
            e && r.playerAutoKick(r.entityType.prism, e),
            this._resetTabs()
        }),
        this._setupEvents()
    }
    i(857);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(336)
      , l = i(858)
      , c = i(869)
      , u = i(870)
      , h = i(85)
      , d = i(872)
      , p = i(884)
      , m = i(886)
      , f = i(22)
      , g = i(735);
    o(n, s),
    e.exports = n,
    n.prototype._initTabs = function() {
        var e = this.tabsDefinitions;
        e.friends.title = a("ui.common.friends"),
        e.guild.title = a("ui.common.guild"),
        e.alliance.title = a("ui.common.alliance"),
        e.spouse.title = a("ui.common.spouse"),
        e.directory.title = a("ui.common.directory");
        for (var t in e) {
            var i = window.gui.uiLocker.isTabAvailable("social", t);
            this.tabs.toggleTabAvailability(t, i)
        }
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = this.tabs
          , i = window.gui;
        window.gui.uiLocker.on("updated", function(t) {
            if ("social" === t.windowId && t.tabId)
                return e.tabsDefinitions[t.tabId] ? void e.tabs.toggleTabAvailability(t.tabId, !t.locked) : console.error(new Error("Unknown tab id `" + t.tabId + "` in social window."))
        }),
        i.on("GameContextCreateMessage", function(t) {
            t.context === h.FIGHT && f.close(e.id)
        }),
        i.on("ClientUIOpened", function(n) {
            if (i.playerData.guild.hasGuild()) {
                var o, s, a = n.type;
                a === c.CLIENT_UI_TELEPORT_GUILD_PADDOCK ? (o = "guild",
                s = "paddocks") : a === c.CLIENT_UI_TELEPORT_GUILD_HOUSE && (o = "guild",
                s = "houses"),
                o && (e.openState ? (t.openTab(o, {
                    tabId: s
                }),
                f.focusWindow(e.id)) : f.open(e.id, {
                    tabId: o,
                    tabParams: {
                        tabId: s
                    }
                }))
            }
        }),
        i.on("disconnect", function() {
            e._resetTabs(),
            e._initTabs()
        })
    }
    ,
    n.prototype.updateWindowTitle = function(e, t) {
        var i = this.tabsDefinitions[e];
        if (i) {
            i.title = t;
            var n = this.tabs.getCurrentTabId();
            n === e && this.setTitle(t)
        }
    }
    ,
    n.prototype.getOpenedTabId = function() {
        return this.tabs.getCurrentTabId()
    }
    ,
    n.prototype._resetTabs = function() {
        this.tabs.close()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, "div", {
            className: "AllianceTab",
            name: "alliance"
        });
        var e = this;
        this.once("open", function() {
            this._createDom(),
            window.gui.playerData.alliance.on("allianceUpdated", function(t) {
                e._updateAllianceInformation();
                var i = e.tabs.tabMap;
                for (var n in i)
                    i[n].content.emit("allianceUpdated", t)
            })
        }),
        this.on("open", function(e) {
            e = e || {};
            var t = e.tabId || "guilds";
            this.tabs.openTab(t),
            this._guilds.emit("allianceUpdateRequested"),
            window.dofus.sendMessage("AllianceInsiderInfoRequestMessage"),
            window.dofus.sendMessage("PrismsListRegisterMessage", {
                listen: h.PRISM_LISTEN_MINE
            })
        }),
        this.on("close", function() {
            this.tabs.close()
        })
    }
    i(859);
    var o = i(423)
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(509)
      , l = i(190)
      , c = i(289)
      , u = i(210)
      , h = i(860)
      , d = i(32)
      , p = i(22)
      , m = i(861)
      , f = i(863)
      , g = i(865);
    s(n, l),
    e.exports = n,
    n.prototype._updateAllianceInformation = function() {
        var e = window.gui.playerData.alliance.current;
        this._updateAllianceCreationData(e),
        this.emblem.setValue(e.allianceEmblem, !0);
        var t = p.getWindow("social");
        t.updateWindowTitle("alliance", a("ui.common.alliance") + " - " + e.allianceName),
        this.tag.setText("[" + e.allianceTag + "]"),
        this.members.setText(a("ui.alliance.membersInGuilds", e.nbMembers, e.guildCount, e.guildCount))
    }
    ,
    n.prototype._updateAllianceCreationData = function(e) {
        var t = u.getAlmanaxDate(1e3 * e.creationDate);
        this.creationDate.setText(t.day + " " + t.monthName + " " + t.year)
    }
    ,
    n.prototype._createDom = function() {
        this._buildHeader(),
        this._buildTabs()
    }
    ,
    n.prototype._buildHeader = function() {
        var e = this.createChild("div", {
            className: "description"
        })
          , t = e.createChild("div", {
            className: ["column", "title"]
        })
          , i = e.createChild("div", {
            className: ["column", "content"]
        })
          , n = e.createChild("div", {
            className: ["column", "emblem"]
        });
        this.emblem = n.appendChild(new c({
            width: 70,
            height: 70
        })),
        t.createChild("div", {
            text: a("ui.alliance.tag") + ":"
        }),
        this.tag = i.createChild("div", {
            className: "link"
        }),
        d(this.tag),
        this.tag.on("tap", function() {
            o.openAllianceCard(window.gui.playerData.alliance.current.allianceId)
        }),
        t.createChild("div", {
            text: a("ui.common.creationDate") + ":"
        }),
        this.creationDate = i.createChild("div"),
        t.createChild("div", {
            text: a("ui.common.members") + ":"
        }),
        this.members = i.createChild("div")
    }
    ,
    n.prototype._buildTabs = function() {
        var e = this.tabs = this.appendChild(new r);
        this._guilds = new m,
        e.addTab(a("ui.social.guilds"), this._guilds, "guilds"),
        e.addTab(a("ui.common.conquest"), new f, "conquests"),
        e.addTab(a("ui.common.attacks"), new g, "attacks")
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        PRISM_LISTEN_NONE: 0,
        PRISM_LISTEN_MINE: 1,
        PRISM_LISTEN_ALL: 2
    }
}
, function(e, t, i) {
    function n() {
        _.call(this, "div", {
            className: "GuildsTab"
        }),
        this._createDom(),
        this.on("allianceUpdated", function(e) {
            this.table.clearContent(),
            this.table.addList(e.guilds),
            this.table.setContentLoading(!1)
        }),
        this.on("allianceUpdateRequested", function() {
            this.table.setContentLoading(!0)
        });
        var e = this;
        window.gui.playerData.alliance.on("guildLeft", function(t) {
            e.table.delRow(t)
        }),
        this.on("open", function() {
            this._updateAvaMode()
        })
    }
    function o(e, t, i) {
        var n = new g({
            className: "kick"
        },function() {
            if (t.allianceLeader && e.guildCount > 1)
                return window.gui.openSimplePopup(h("ui.alliance.guildLeaderCantBeBanned"));
            var n = i ? h("ui.alliance.quitConfirm") : h("ui.alliance.kickConfirm", t.guildName);
            window.gui.openConfirmPopup({
                title: h("ui.popup.warning"),
                message: n,
                cb: function(e) {
                    e && window.dofus.sendMessage("AllianceKickRequestMessage", {
                        kickedId: t.guildId
                    })
                }
            })
        }
        );
        return l(n, h("ui.alliance.kickGuild")),
        n
    }
    function s(e) {
        var t = new g({
            className: "leader"
        },function() {
            window.gui.openConfirmPopup({
                title: h("ui.popup.warning"),
                message: h("ui.alliance.giveLeadershipConfirm", e.guildName),
                cb: function(t) {
                    t && window.dofus.sendMessage("AllianceChangeGuildRightsMessage", {
                        guildId: e.guildId,
                        rights: r.ALLIANCE_RIGHT_BOSS
                    })
                }
            })
        }
        );
        return l(t, h("ui.alliance.giveLeadership")),
        t
    }
    i(862);
    var a = i(335)
      , r = i(349)
      , l = i(206).addTooltip
      , c = i(448)
      , u = i(289)
      , h = i(35).getText
      , d = i(339)
      , p = i(26).inherits
      , m = i(400)
      , f = i(32)
      , g = i(204)
      , _ = i(190);
    p(n, _),
    e.exports = n,
    n.prototype._updateAvaMode = function() {
        var e = window.gui.playerData.characterBaseInformations
          , t = !1;
        if (e.level >= 50) {
            this.avaMode.enable();
            var i = window.gui.playerData.characters.mainCharacter.characteristics.alignmentInfos.aggressable;
            t = i === a.AvA_ENABLED_AGGRESSABLE || i === a.AvA_ENABLED_NON_AGGRESSABLE || i === a.AvA_DISQUALIFIED || i === a.AvA_PREQUALIFIED_AGGRESSABLE;
            var n = this.avaMode.isActivate();
            this.avaMode.setText(h(n ? "ui.alliance.disableAvA" : "ui.alliance.activateAvA")),
            n !== t && this.avaMode.toggleActivation(t)
        } else
            this.avaMode.disable()
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            var t = new _("div",{
                className: "nameBox"
            })
              , i = t.createChild("div", {
                text: e.guildName,
                className: "link"
            });
            f(i),
            i.on("tap", function() {
                d.openGuildCard(e.guildId)
            });
            var n = t.createChild("div");
            return f(n),
            n.on("tap", function() {
                window.gui.openContextualMenu("player", {
                    playerName: e.leaderName,
                    playerId: e.leaderId,
                    hasGuild: !0
                })
            }),
            n.createChild("span", {
                text: h("ui.guild.leadBy", "")
            }),
            n.createChild("span", {
                text: e.leaderName,
                className: "link"
            }),
            t
        }
        function t(e) {
            var t = new _("div",{
                className: "memberBox"
            })
              , i = t.createChild("div", {
                text: h("ui.guild.onlineMembers", e.nbConnectedMembers, e.nbMembers)
            });
            if (0 === e.nbConnectedMembers && e.lastActivity > 0) {
                var n, o = e.getHoursSinceLastConnection(), s = Math.floor(o / 720), a = Math.floor((o - 720 * s) / 24);
                n = s > 0 ? a > 0 ? h("ui.social.monthsAndDaysSinceLastConnection", s, a, a) : h("ui.social.monthsSinceLastConnection", s, s) : a > 0 ? h("ui.social.daysSinceLastConnection", a, a) : h("ui.social.lessThanADay"),
                l(i, h("ui.social.lastConnection", n))
            }
            return t.createChild("div", {
                text: e.nbTaxCollectors + " " + h("ui.social.guildTaxCollectors")
            }),
            t
        }
        function i(e) {
            var t, i = e.leaderId === g;
            return p ? (t = new _("div",{
                className: "buttonBox"
            }),
            t.appendChild(o(r, e, i)),
            i || t.appendChild(s(e))) : i ? (t = new _("div",{
                className: "buttonBox"
            }),
            t.appendChild(o(r, e, !0))) : t = "",
            t
        }
        function n(e) {
            var t = new u({
                width: 50,
                height: 50
            });
            return t.setValue({
                guild: e
            }),
            t
        }
        var a = window.gui.playerData
          , r = a.alliance.current
          , p = a.alliance.isBoss()
          , g = a.id;
        this.table = this.appendChild(new m([{
            id: "emblem",
            format: n
        }, {
            id: "guildName",
            header: h("ui.common.name"),
            format: e,
            defaultSorter: !0,
            sort: !0
        }, {
            id: "guildLevel",
            header: h("ui.common.level"),
            sort: !0
        }, {
            id: "nbMembers",
            header: h("ui.common.members"),
            format: t,
            sort: !0
        }, {
            id: "actions",
            format: i
        }],"guildId",{
            clickable: !1
        })),
        this.avaMode = this.appendChild(new c("")),
        this.avaMode.on("change", function(e) {
            window.dofus.sendMessage("SetEnableAVARequestMessage", {
                enable: e
            })
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        g.call(this, "div", {
            className: "ConquestsTab"
        }),
        this.once("open", function() {
            this._createDom(),
            this._setupEvents(),
            this._updateConquests()
        })
    }
    function o(e, t) {
        var i = new f({
            className: "settings"
        },function() {
            m.open("prismVulnerabilityDate", {
                prism: e,
                vulnerableTime: t
            })
        }
        );
        return s(i, null , l("ui.prism.changeVulnerabilityHour")),
        i
    }
    i(864);
    var s = i(206).addTooltip
      , a = i(423)
      , r = i(339)
      , l = i(35).getText
      , c = i(339).GuildRightsBitEnum
      , u = i(26).inherits
      , h = i(346)
      , d = i(400)
      , p = i(211)
      , m = i(22)
      , f = i(204)
      , g = i(190);
    u(n, g),
    e.exports = n,
    n.prototype._setupEvents = function() {
        function e() {
            var e = window.gui.playerData.position.subAreaId;
            t.table.hasRow(e) ? t.table.selectRow(e) : t.table.unSelectRow()
        }
        var t = this;
        this.on("open", e);
        var i = window.gui.playerData.alliance;
        i.on("prismUpdatedList", function(i) {
            t.table.updateRows(i),
            t._updateConquests(),
            e()
        }),
        i.on("prismDeletedList", function(i) {
            t.table.delRows(i),
            t._updateConquests(),
            e()
        }),
        this.on("allianceUpdated", function(t) {
            this.table.clearContent(),
            this.table.addMap(t.prisms),
            this._updateConquests(),
            this.table.setContentLoading(!1),
            e()
        }),
        this.on("allianceUpdateRequested", function() {
            this.table.setContentLoading(!0)
        }),
        this.table.addMap(i.current.prisms),
        e()
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            var t, i = e.prism, a = new p.DofusDate(i.nextVulnerabilityDate), u = a.getServerDate(), d = u.toString().time, m = n.guild.hasRight(c.GUILD_RIGHT_SET_ALLIANCE_PRISM);
            if (i.state !== h.PRISM_STATE_INVULNERABLE && i.state !== h.PRISM_STATE_NORMAL || !m)
                t = d;
            else {
                t = new g("div",{
                    className: "timeSetting"
                });
                var f = t.createChild("div", {
                    text: d
                })
                  , _ = r.guilds[i.lastTimeSlotModificationAuthorGuildId];
                _ && s(f, l("ui.prism.lastVulnerabilityChange", new p.DofusDate(i.lastTimeSlotModificationDate).getLocalDate().toString().date, i.lastTimeSlotModificationAuthorName, _.guildName) + "\n" + l("ui.prism.serverVulnerabilityHour") + " : " + d + "\n" + l("ui.prism.localVulnerabilityHour") + " : " + a.getLocalDate().toString().time),
                t.appendChild(o(e, a))
            }
            return t
        }
        function t(e) {
            var t = e.prism
              , i = new g("div",{
                text: a.prismState[t.state]
            })
              , n = a.getPrismStateInfo(t.state, 1e3 * t.nextVulnerabilityDate - Date.now());
            return s(i, n),
            i
        }
        function i(e) {
            var t = e.enrichData
              , i = new g("div",{
                text: t.subAreaName + " (" + t.areaName + ")"
            });
            return s(i, l(t.isConquestVillage ? "ui.zaap.village" : "ui.zaap.prism")),
            i
        }
        this.conquestsInfo = this.createChild("div", {
            className: "conquestsInfo"
        });
        var n = window.gui.playerData;
        this.table = this.appendChild(new d([{
            id: "subArea",
            header: l("ui.map.subarea"),
            format: i,
            getContent: function(e) {
                return e.enrichData.subAreaName
            },
            sort: !0,
            defaultSorter: !0
        }, {
            id: "worldX",
            header: l("ui.common.coordinatesSmall"),
            format: function(e) {
                return e.worldX + "," + e.worldY
            },
            sort: !0
        }, {
            id: "placementDate",
            header: l("ui.social.guild.taxStartDate"),
            format: function(e) {
                return new p.DofusDate(e.prism.placementDate).getServerDate().toString().date
            },
            getContent: function(e) {
                return e.prism.placementDate
            },
            sort: !0
        }, {
            id: "state",
            header: l("ui.common.state"),
            format: t,
            getContent: function(e) {
                return e.prism.state
            },
            sort: !0
        }, {
            id: "nextVulnerabilityDate",
            header: l("ui.prism.startVulnerability"),
            format: e,
            getContent: function(e) {
                return e.prism.nextVulnerabilityDate
            },
            sort: !0
        }],"subAreaId",{
            clickable: !1
        }))
    }
    ,
    n.prototype._updateConquests = function() {
        var e = window.gui.playerData
          , t = e.alliance.current.prisms
          , i = 0
          , n = 0;
        for (var o in t) {
            var s = t[o];
            s.mapId <= -1 || (s.enrichData.isConquestVillage ? n += 1 : i += 1)
        }
        0 === i && 0 === n ? this.conquestsInfo.setText(l("ui.alliance.noArea")) : i > 0 && 0 === n ? this.conquestsInfo.setText(l("ui.alliance.nbAreas", i, i)) : 0 === i && n > 0 ? this.conquestsInfo.setText(l("ui.alliance.nbVillages", n, n)) : this.conquestsInfo.setText(l("ui.alliance.nbAreasAndVillages", i, n, n + i))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        v.call(this, "div", {
            className: "AttacksTab"
        }),
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        }),
        this.on("open", function() {
            this._loadCurrentPrismFight(),
            this._updateFightCount(),
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: p.INFO_TAX_COLLECTOR_ALLIANCE
            })
        }),
        this.on("close", function() {
            this.table.clearContent(),
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: p.INFO_TAX_COLLECTOR_LEAVE
            })
        })
    }
    function o(e) {
        var t = e.remainSeconds
          , i = e.totalWaitTime
          , n = i - t;
        e.setValue(n / i)
    }
    function s(e) {
        clearInterval(e.intervalId),
        e.intervalId = null
    }
    function a(e, t) {
        e.totalWaitTime = Math.round(t.waitTimeForPlacement / 10) || 1,
        e.remainSeconds = Math.round(t.timeLeftBeforeFight / 10) || 0,
        e.intervalId = setInterval(function() {
            e.remainSeconds -= 1,
            e.remainSeconds > 0 ? o(e) : s(e)
        }, 1e3),
        o(e)
    }
    function r(e) {
        var t;
        if (e.type === y.prism) {
            var i = h.getAttackedEntity(e)
              , n = i.enrichData;
            t = n.isConquestVillage ? "village" : "prism"
        } else
            t = e.type;
        return new v("div",{
            className: ["type", t]
        })
    }
    function l(e) {
        var t = h.getAttackedEntity(e)
          , i = t.enrichData
          , n = new v("div",{
            className: "target"
        });
        return n.createChild("div", {
            text: t.getName()
        }),
        n.createChild("div", {
            text: i.subAreaName + " " + t.getPosition()
        }),
        e.type === y.prism ? n.createChild("div", {
            text: d("ui.prism.placed", t.getPlacementDate())
        }) : n.createChild("div", {
            className: "owner",
            text: d("ui.common.guild") + d("ui.common.colon") + t.getGuild().guildName
        }),
        n
    }
    function c(e) {
        var t = new f({
            vertical: !0,
            className: ["green", "timer"]
        });
        return e.waitingForHelpInfo && a(t, e.waitingForHelpInfo),
        t.on("destroy", function() {
            s(t)
        }),
        t
    }
    function u(e) {
        var t = h.getAttackedEntity(e)
          , i = new m;
        return i.setFight(e.type, e),
        t.look && i.setTarget({
            id: e.id,
            entityLook: t.look,
            name: t.getName(),
            level: t.level
        }),
        i.on("slotTap", C[e.type]),
        i
    }
    i(866);
    var h = i(336)
      , d = i(35).getText
      , p = i(476)
      , m = i(867)
      , f = i(643)
      , g = i(26).inherits
      , _ = i(400)
      , v = i(190)
      , y = h.entityType
      , w = h.fightingSide
      , b = h.fightState;
    g(n, v);
    var C = {};
    C[y.prism] = function(e) {
        var t = this.fight;
        if (t.state === h.fightState.waitingForHelp) {
            var i = t.id
              , n = window.gui.playerData.id;
            h.isPlayerFightingFor(n, y.prism, i, w.allies) ? e && n === e.id && window.dofus.sendMessage("PrismFightJoinLeaveRequestMessage", {
                subAreaId: i,
                join: !1
            }) : e && 5 === t.fighters[w.allies].length ? window.dofus.sendMessage("PrismFightSwapRequestMessage", {
                subAreaId: i,
                targetId: e.id
            }) : window.dofus.sendMessage("PrismFightJoinLeaveRequestMessage", {
                subAreaId: i,
                join: !0
            })
        }
    }
    ,
    C[y.taxCollector] = function(e) {
        var t = this.fight;
        if (t.state === h.fightState.waitingForHelp) {
            var i = t.id
              , n = window.gui.playerData.id;
            h.isPlayerFightingFor(n, y.taxCollector, i, w.allies) ? e && n === e.id && window.dofus.sendMessage("GuildFightLeaveRequestMessage", {
                taxCollectorId: i,
                characterId: n
            }) : e && 5 === t.fighters[w.allies].length ? window.dofus.sendMessage("GuildFightTakePlaceRequestMessage", {
                taxCollectorId: i,
                replacedCharacterId: e.id
            }) : window.dofus.sendMessage("GuildFightJoinRequestMessage", {
                taxCollectorId: i
            })
        }
    }
    ,
    n.prototype._createDom = function() {
        this.table = this.appendChild(new _([{
            id: "type",
            format: r
        }, {
            id: "target",
            header: d("ui.common.name") + " / " + d("ui.common.localisation"),
            format: l
        }, {
            id: "timer",
            format: c
        }, {
            id: "fightersInfo",
            header: d("ui.common.defenders") + " / " + d("ui.common.attackers"),
            format: u
        }],"id",{
            clickable: !1
        })),
        this.currentFights = this.createChild("div", {
            className: "currentFights"
        }),
        this.createChild("div", {
            className: "howTo",
            text: d("ui.alliance.howToDefend")
        })
    }
    ,
    n.prototype._updateFightCount = function() {
        var e = this.table.getRowCount();
        this.currentFights.setText(d("ui.alliance.currentFights", e, e))
    }
    ,
    n.prototype._loadCurrentPrismFight = function() {
        var e = h.fights.prism;
        for (var t in e) {
            var i = e[t];
            i.state === b.waitingForHelp && (this.table.hasRow(i.id) || this.table.addRow(i))
        }
    }
    ,
    n.prototype._setupEvents = function() {
        function e(e) {
            t.isVisible() && t.table.hasRow(e) && (t.table.delRow(e),
            t._updateFightCount())
        }
        var t = this;
        h.on("fightStarted", function(e, i) {
            t.isVisible() && i.state === b.waitingForHelp && (t.table.addRow(i),
            t._updateFightCount())
        }),
        h.on("fighting", function(t, i) {
            e(i.id)
        }),
        h.on("fightEnded", function(t, i) {
            e(i)
        }),
        h.on("fighterList", function(e, i, n, o) {
            t.isVisible() && t.table.hasRow(i) && t.table.getCell(i, "fightersInfo").setFighters(n, o)
        }),
        h.on("fighterJoined", function(e, i, n, o, s) {
            t.isVisible() && t.table.hasRow(i) && t.table.getCell(i, "fightersInfo").setFighter(n, o, s)
        }),
        h.on("fightTarget", function(e, i, n) {
            t.isVisible() && e === y.prism && t.table.hasRow(i) && t.table.getCell(i, "fightersInfo").setTarget({
                id: n.id,
                entityLook: n.look,
                name: n.getName(),
                level: n.level
            })
        }),
        h.on("fighterLeft", function(e, i, n, o, s) {
            t.isVisible() && t.table.hasRow(i) && t.table.getCell(i, "fightersInfo").removeFighter(n, s)
        })
    }
    ,
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        l.call(this, "div", {
            className: "FightersInfo"
        });
        var e, t = this.allies = {}, i = this.enemies = {}, n = this.createChild("div", {
            className: "fighterRow"
        }), o = this.createChild("div", {
            className: "fighterRow"
        });
        e = t.icon = n.createChild("div", {
            className: ["fightMode", "defend", "hidden"]
        }),
        this._addFightModeToolTip(e, h("ui.common.defenders"), "allies"),
        e = i.icon = o.createChild("div", {
            className: ["fightMode", "attack", "hidden"]
        }),
        this._addFightModeToolTip(e, h("ui.common.attackers"), "enemies");
        var s = t.slotContainer = n.createChild("div", {
            className: "fighterList"
        })
          , a = i.slotContainer = o.createChild("div", {
            className: "fighterList"
        });
        this.targetSlot = s.appendChild(this._createTargetDisplay());
        for (var r, c = t.slots = [], u = i.slots = [], d = 0; d < m; d += 1)
            r = s.appendChild(this._createFighterSlot(!0)),
            c.push(r),
            r = a.appendChild(this._createFighterSlot()),
            u.push(r)
    }
    function o(e) {
        var t = e.name + " (" + h("ui.common.short.level") + " " + e.level + ") ";
        switch (e._type) {
        case "CharacterMinimalAllianceInformations":
            t += e.guild.guildName + " - [" + e.alliance.allianceTag + "]";
            break;
        case "CharacterMinimalGuildInformations":
            t += e.guild.guildName
        }
        return t
    }
    function s(e, t) {
        e.fighter = t,
        d.enableTooltip(e, !0),
        e.setLook(t.entityLook, {
            riderOnly: !0,
            direction: u.DIRECTION_SOUTH_WEST,
            animation: "AnimArtwork",
            boneType: "timeline/",
            skinType: "timeline/"
        })
    }
    function a(e) {
        e.fighter = null ,
        e.clear(),
        console.log("CLEARING SLOT!"),
        d.enableTooltip(e, !1)
    }
    i(868);
    var r = i(26).inherits
      , l = i(190)
      , c = i(238)
      , u = i(279)
      , h = i(35).getText
      , d = i(206)
      , p = i(336).fightingSide
      , m = 5;
    r(n, l),
    e.exports = n,
    n.prototype._addFightModeToolTip = function(e, t, i) {
        var n = this;
        d.addTooltip(e, function() {
            var e = t + h("ui.common.colon") + "\n"
              , s = n[i].slots;
            if ("allies" === i) {
                var a = n.targetSlot.fighter;
                e += a.name + " (" + h("ui.common.short.level") + " " + a.level + ")\n"
            }
            for (var r = 0; r < s.length; r += 1) {
                var c = s[r].fighter;
                c && (e += o(c) + "\n")
            }
            return new l("div",{
                text: e
            })
        })
    }
    ,
    n.prototype._createTargetDisplay = function() {
        var e = new c({
            className: "fighterIcon",
            scale: "fitin"
        });
        return d.addTooltip(e, function() {
            var t = e.fighter;
            return new l("div",{
                text: t.name + " (" + h("ui.common.short.level") + " " + t.level + ")"
            })
        }),
        d.enableTooltip(e, !1),
        e
    }
    ,
    n.prototype._createFighterSlot = function(e) {
        var t = new c({
            className: "fighterIcon",
            scale: "fitin"
        });
        if (d.addTooltip(t, function() {
            return new l("div",{
                text: o(t.fighter)
            })
        }),
        d.enableTooltip(t, !1),
        !e)
            return t;
        var i = this;
        return t.on("tap", function() {
            i.fight && i.emit("slotTap", this.fighter)
        }),
        t
    }
    ,
    n.prototype.reset = function() {
        this.fight = null ,
        this.allies.icon.addClassNames("hidden"),
        this.enemies.icon.addClassNames("hidden"),
        a(this.targetSlot);
        for (var e = this.allies.slots, t = this.enemies.slots, i = 0; i < m; i += 1)
            a(e[i]),
            a(t[i])
    }
    ,
    n.prototype.setTarget = function(e) {
        s(this.targetSlot, e)
    }
    ,
    n.prototype.setFight = function(e, t) {
        this.type = e,
        this.fight = t,
        this.allies.icon.delClassNames("hidden"),
        this.enemies.icon.delClassNames("hidden");
        var i = t.fighters;
        this.setFighters(p.allies, i.allies),
        this.setFighters(p.enemies, i.enemies)
    }
    ,
    n.prototype.setFighter = function(e, t, i) {
        s(this[e].slots[i], t)
    }
    ,
    n.prototype.removeFighter = function(e, t) {
        var i = this[e].slots
          , n = i.splice(t, 1)[0];
        a(n),
        this[e].slotContainer.appendChild(n),
        i.push(n)
    }
    ,
    n.prototype.setFighters = function(e, t) {
        for (var i = this[e].slots, n = 0; n < m; n += 1) {
            var o = t[n];
            o ? s(i[n], o) : a(i[n])
        }
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        CLIENT_UI_UNDEFINED: 0,
        CLIENT_UI_TELEPORT_GUILD_HOUSE: 1,
        CLIENT_UI_TELEPORT_GUILD_PADDOCK: 2,
        CLIENT_UI_OBJECT_MIMICRY: 3
    }
}
, function(e, t, i) {
    function n() {
        l.call(this, "div", {
            className: "FriendsWindow",
            name: "friends"
        });
        var e = this;
        this.ListAddFailureEnum = {
            0: u("ui.common.unknownFail"),
            1: u("ui.social.friend.addFailureListFull"),
            2: u("ui.social.friend.addFailureNotFound"),
            3: u("ui.social.friend.addFailureEgocentric"),
            4: u("ui.social.friend.addFailureAlreadyInList")
        },
        this.tables = {},
        this.tableParams = {
            colIds: ["playerIcon", "name", "level", "guild", "achievement", "stateIcon", "button"],
            headerContent: ["", u("ui.common.name"), u("ui.common.level"), u("ui.common.guild"), u("ui.achievement.achievement")],
            onRowTap: function() {
                window.gui.tooltipBox.close()
            }
        },
        this.deleteTapCallback = {
            friends: function() {
                window.dofus.sendMessage("FriendDeleteRequestMessage", {
                    accountId: this.accountId
                })
            },
            enemies: function() {
                window.dofus.sendMessage("IgnoredDeleteRequestMessage", {
                    accountId: this.accountId,
                    session: !1
                })
            },
            ignored: function() {
                window.dofus.sendMessage("IgnoredDeleteRequestMessage", {
                    accountId: this.accountId,
                    session: !0
                })
            }
        },
        this.once("open", function() {
            e._createDom(),
            e._setupEvents();
            var t = window.gui.playerData.socialData;
            for (var i in t.ignoredList)
                e.addPlayer(t.ignoredList[i], "ignored")
        }),
        this.on("open", function(t) {
            t = t || {},
            e.tabs.openTab(t.tabId || 0),
            e.tables.friends.clearContent(),
            e.tables.enemies.clearContent(),
            window.dofus.sendMessage("FriendsGetListMessage"),
            window.dofus.sendMessage("IgnoredGetListMessage")
        })
    }
    function o(e, t, i) {
        var n = e.createChild("div", {
            className: "addCharacter"
        })
          , o = n.createChild("div", {
            text: u("ui.common.addSomeone"),
            className: "addLabel"
        })
          , s = n.appendChild(new d(u("ui.common.add"),{
            className: "addButton"
        }))
          , a = n.appendChild(new f({
            className: "addInput",
            attr: {
                type: "text"
            }
        }));
        return s.on("tap", function() {
            var e = a.rootElement.value;
            if (e) {
                var n = {
                    name: e
                };
                i && (n.session = i),
                window.dofus.sendMessage(t, n),
                a.rootElement.value = ""
            }
        }),
        {
            addCharacterArea: n,
            label: o,
            textInput: a,
            button: s
        }
    }
    function s(e, t) {
        if (t)
            return e.showRows();
        for (var i = e.getRowCount(), n = [], o = 0; o < i; o++) {
            var s = e.getRow(o);
            s.isConnected || (s.hide(),
            n.push(o))
        }
        e.hideRows(n)
    }
    function a(e, t) {
        if (!e.hasOwnProperty("breed"))
            return console.error(new Error("Friends loadHeadImage: player has no breed")),
            void t.setStyle("backgroundImage", null );
        var i = "gfx/heads/SmallHead_" + e.breed + (e.sex ? 1 : 0) + ".png";
        g.preloadImage(i, function(e) {
            t.setStyle("backgroundImage", e)
        })
    }
    i(871);
    var r = i(26).inherits
      , l = i(190)
      , c = i(509)
      , u = i(35).getText
      , h = i(204)
      , d = h.DofusButton
      , p = i(485)
      , m = i(448)
      , f = i(391)
      , g = i(5)
      , _ = i(30)
      , v = i(458)
      , y = i(292);
    r(n, l),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this.tabs = this.appendChild(new c);
        this.friendsPanel = this.createChild("div", {
            className: ["mainPanel", "friendsPanel"]
        }),
        this.enemiesPanel = this.createChild("div", {
            className: ["mainPanel", "enemiesPanel"]
        }),
        this.ignoredPanel = this.createChild("div", {
            className: ["mainPanel", "ignoredPanel"]
        }),
        e.addTab(u("ui.common.friends"), this.friendsPanel, "friends"),
        e.addTab(u("ui.common.enemies"), this.enemiesPanel, "enemies"),
        e.addTab(u("ui.common.ignoreds"), this.ignoredPanel, "ignoreds"),
        e.openTab(0),
        this._buildFriendsPanel(),
        this._buildEnemiesPanel(),
        this._buildIgnoredPanel()
    }
    ,
    n.prototype._buildFriendsPanel = function() {
        var e = this
          , t = this.friendsPanel;
        o(t, "FriendAddRequestMessage"),
        this.tables.friends = t.appendChild(new p(this.tableParams));
        var i = _.getValue("showFriendOffline", !0)
          , n = t.createChild("div", {
            className: "checkBoxes"
        });
        this.showFriendOfflineCheckbox = n.appendChild(new m(u("ui.social.showOfflinePerson"),i));
        var a = n.appendChild(new m(u("ui.social.warnWhenFriendsComeOnline"),window.gui.playerData.socialData.onConnectNotification));
        this.showFriendOfflineCheckbox.on("change", function(t) {
            s(e.tables.friends, t),
            _.setValue("showFriendOffline", t)
        }),
        a.on("change", function(e) {
            window.dofus.sendMessage("FriendSetWarnOnConnectionMessage", {
                enable: e
            })
        })
    }
    ,
    n.prototype._buildEnemiesPanel = function() {
        var e = this
          , t = this.enemiesPanel;
        o(t, "IgnoredAddRequestMessage", !1),
        this.tables.enemies = t.appendChild(new p(this.tableParams));
        var i = _.getValue("showEnemyOffline", !0)
          , n = t.createChild("div", {
            className: "checkBoxes"
        });
        this.showEnemyOfflineCheckbox = n.appendChild(new m(u("ui.social.showOfflinePerson"),i)),
        this.showEnemyOfflineCheckbox.on("change", function(t) {
            s(e.tables.enemies, t),
            _.setValue("showEnemyOffline", t)
        })
    }
    ,
    n.prototype._buildIgnoredPanel = function() {
        o(this.ignoredPanel, "IgnoredAddRequestMessage", !0),
        this.tables.ignored = this.ignoredPanel.appendChild(new p(this.tableParams))
    }
    ,
    n.prototype._updateStateIcon = function(e, t) {
        var i = e.getChild("stateIcon").getChild("stateIcon");
        if (i.delClassNames("offline", "fight", "smiley"),
        i.getStyle("backgroundImage") && i.setStyle("backgroundImage", ""),
        i.clearContent(),
        i.hide(),
        !e.isConnected)
            return i.addClassNames("offline"),
            void i.show();
        var n;
        if (t.hasOwnProperty("moodSmileyId") && t.moodSmileyId > 0) {
            n = t.moodSmileyId;
            var o = window.gui.databases.Smileys[n];
            if (!o)
                return console.error("Smiley " + n + " details are not available, it could not be displayed");
            i.addClassNames("smiley"),
            g.preloadImage("gfx/smilies/" + o.gfxId + ".png", function(e) {
                i.rootElement && (i.setStyle("backgroundImage", e),
                i.show())
            })
        }
        t.playerState === v.GAME_TYPE_FIGHT && (n ? i.appendChild(new l("div",{
            className: "smallFight"
        })) : (i.addClassNames("fight"),
        i.show()))
    }
    ,
    n.prototype._updatePlayerRow = function(e, t) {
        for (var i = this.tables[e], n = i.getRows(), o = 0; o < n.length; o++) {
            var s = n[o];
            if (s.accountId === t.accountId) {
                var r = s.getChild("name").getChild("name");
                r.setText(t.accountName + (t.playerName && t.breed ? " (" + t.playerName + ")" : "")),
                r.isConnected = "FriendOnlineInformations" === t._type,
                i.updateRow(o, {
                    level: t.level || "?",
                    guild: t.guildInfo ? t.guildInfo.guildName : "?",
                    achievement: t.achievementPoints > 0 ? t.achievementPoints : "-"
                }, {
                    isConnected: r.isConnected
                });
                var l = s.getChild("playerIcon").getChild("playerIcon");
                if (t.status) {
                    var c = l.getChild("onlineStatusIcon");
                    c.setClassNames("onlineStatusIcon", "status" + t.status.statusId)
                }
                l.toggleDisplay(!!s.isConnected);
                var u = l.getChild("alignmentSide").getChild("headIcon");
                return s.isConnected && !u.getStyle("backgroundImage") && a(t, u),
                void this._updateStateIcon(s, t)
            }
        }
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui.playerData.socialData;
        window.gui.on("disconnect", function() {
            e.tables.ignored.clearContent()
        }),
        t.on("friendUpdate", function(t) {
            e._updatePlayerRow("friends", t)
        }),
        t.on("ignoredUpdate", function(t) {
            e._updatePlayerRow("ignored", t)
        }),
        t.on("enemyUpdate", function(t) {
            e._updatePlayerRow("enemies", t)
        }),
        t.on("newFriendList", function() {
            var i = t.friendsList;
            for (var n in i)
                e.addPlayer(i[n], "friends");
            var o = e.showFriendOfflineCheckbox;
            o.isActivate() ? o.activate() : o.deactivate()
        }),
        t.on("newEnemyList", function() {
            var i = t.enemiesList;
            for (var n in i)
                e.addPlayer(i[n], "enemies");
            var o = e.showEnemyOfflineCheckbox;
            o.isActivate() ? o.activate() : o.deactivate()
        }),
        t.on("friendAdded", function(t) {
            e.addPlayer(t, "friends")
        }),
        t.on("ignoredAdded", function(t) {
            e.addPlayer(t, "ignored")
        }),
        t.on("enemyAdded", function(t) {
            e.addPlayer(t, "enemies")
        }),
        t.on("friendDeleted", function(t) {
            e.deletePlayer(t, "friends")
        }),
        t.on("ignoredDeleted", function(t) {
            e.deletePlayer(t, "ignored")
        }),
        t.on("enemyDeleted", function(t) {
            e.deletePlayer(t, "enemies")
        })
    }
    ,
    n.prototype.addPlayer = function(e, t) {
        var i = this.tables[t]
          , n = e.guildInfo ? e.guildInfo.guildName : "?"
          , o = new d("",{
            name: "deleteButton"
        })
          , s = window.gui.playerData.alignment;
        o.on("tap", this.deleteTapCallback[t]),
        o.accountId = e.accountId;
        var r = e.achievementPoints > 0 ? e.achievementPoints : "-"
          , c = new l("div",{
            name: "playerIcon",
            className: "playerIcon"
        });
        c.createChild("div", {
            name: "onlineStatusIcon",
            className: ["onlineStatusIcon", e.status ? "status" + e.status.statusId : ""]
        });
        var u = c.createChild("div", {
            name: "alignmentSide",
            className: "alignmentSide"
        });
        e.alignmentSide !== y.ALIGNMENT_ANGEL && e.alignmentSide !== y.ALIGNMENT_EVIL || s.getSmallWingsUrl(e.alignmentSide, function(e) {
            u.rootElement && u.setStyle("backgroundImage", e)
        });
        var p = u.createChild("div", {
            className: "playerHead",
            name: "headIcon"
        })
          , m = new h({
            name: "name",
            text: e.accountName + (e.playerName ? " (" + e.playerName + ")" : "")
        },function() {
            this.isConnected ? window.gui.openContextualMenu("player", {
                playerId: this.id,
                accountId: this.accountId,
                playerName: this.name
            }) : window.gui.openContextualMenu("offlinePlayer", {
                playerId: this.id,
                playerName: this.name
            })
        }
        );
        m.id = e.playerId,
        m.name = e.playerName || e.accountName,
        m.accountId = e.accountId,
        m.isConnected = "FriendOnlineInformations" === e._type;
        var f = i.addRow({
            playerIcon: c,
            name: m,
            level: e.level ? e.level : "?",
            guild: n,
            achievement: r,
            stateIcon: new l("div",{
                name: "stateIcon",
                className: "stateIcon"
            }),
            button: o
        }, {
            accountId: e.accountId,
            isConnected: m.isConnected
        });
        this._updateStateIcon(f, e),
        m.isConnected && a(e, p)
    }
    ,
    n.prototype.deletePlayer = function(e, t) {
        var i = this.tables[t]
          , n = i.getRows();
        e = parseInt(e, 10);
        for (var o = 0; o < n.length; o++)
            if (n[o].accountId === e)
                return i.delRow(o)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, "div", {
            className: "GuildWindow",
            name: "guild"
        });
        var e = this;
        this.openedTabId = null ,
        this.once("open", function() {
            e._setupDom(),
            e._setupEvents()
        }),
        this.on("open", function(t) {
            t = t || {},
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: g.INFO_GENERAL
            }),
            this.openedTabId = t.tabId || "members",
            e.tabs.openTab(this.openedTabId, null , {
                forceOpen: !0
            })
        }),
        this.on("close", function() {
            this._resetTabs()
        })
    }
    i(873);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(509)
      , r = i(190)
      , l = i(206).addTooltip
      , c = i(874)
      , u = i(876)
      , h = i(878)
      , d = i(880)
      , p = i(882)
      , m = i(643)
      , f = i(289)
      , g = i(476)
      , _ = i(210)
      , v = i(22);
    o(n, r),
    e.exports = n,
    n.prototype._buildGuildGeneralInfoArea = function() {
        var e = this.createChild("div", {
            className: "guildGeneralInfo"
        })
          , t = e.createChild("div", {
            className: ["column", "title"]
        })
          , i = e.createChild("div", {
            className: ["column", "content"]
        })
          , n = e.createChild("div", {
            className: ["column", "emblem"]
        });
        this.emblem = n.appendChild(new f({
            width: 70,
            height: 70
        })),
        this.level = t.createChild("div"),
        t.createChild("div", {
            className: "member",
            text: s("ui.common.members") + ":"
        }),
        t.createChild("div", {
            text: s("ui.common.creationDate") + ":"
        }),
        this.levelBar = i.appendChild(new m({
            className: "yellow"
        })),
        l(this.levelBar, function() {
            var e = window.gui.playerData.guild.current
              , t = _.intToString(e.experience || 0)
              , i = _.intToString(e.expNextLevelFloor || 0);
            return new r("div",{
                text: t + " / " + i
            })
        }),
        this.membersValue = i.createChild("div", {
            className: "memberValue"
        }),
        this.creationDateValue = i.createChild("div")
    }
    ,
    n.prototype._setupDom = function() {
        function e() {
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: this.id
            })
        }
        this._buildGuildGeneralInfoArea(),
        this.tabs = this.appendChild(new a);
        var t = new c({
            className: "panel"
        })
          , i = new h({
            className: "panel"
        })
          , n = new p
          , o = new d({
            className: "panel"
        })
          , r = new u;
        t.id = g.INFO_MEMBERS,
        i.id = g.INFO_BOOSTS,
        n.id = g.INFO_TAX_COLLECTOR_GUILD_ONLY,
        o.id = g.INFO_PADDOCKS,
        r.id = g.INFO_HOUSES,
        this.tabs.addTab(s("ui.common.members"), t, "members"),
        this.tabs.addTab(s("ui.social.guildBoosts"), i, "customisation"),
        this.tabs.addTab(s("ui.social.guildTaxCollectors"), n, "perceptors"),
        this.tabs.addTab(s("ui.common.mountPark"), o, "paddocks"),
        this.tabs.addTab(s("ui.common.housesWord"), r, "houses"),
        t.on("open", e),
        i.on("open", e),
        o.on("open", e),
        r.on("open", e)
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui.playerData.guild;
        t.on("guildMemberCountUpdate", function() {
            e.isVisible() && e.membersValue.setText(t.current.nbConnectedMembers + " / " + t.current.nbMembers)
        }),
        t.on("GuildGeneralInformationUpdate", function() {
            e.isVisible() && (e._updateEmblemLogoAndWindowTitle(),
            e._updateTabNotification())
        })
    }
    ,
    n.prototype._resetTabs = function() {
        null !== this.openedTabId && (this.openedTabId = null ,
        this.tabs.close()),
        this._updateTabNotification(!0)
    }
    ,
    n.prototype._updateTabNotification = function(e) {
        var t = window.gui.playerData.guild.current
          , i = !e && !!t.abandonnedPaddock;
        this.tabs.toggleTabNotification("paddocks", i)
    }
    ,
    n.prototype._updateGuildCreationData = function() {
        var e = _.getAlmanaxDate(1e3 * window.gui.playerData.guild.current.creationDate);
        this.creationDateValue.setText(e.day + " " + e.monthName + " " + e.year)
    }
    ,
    n.prototype._updateEmblemLogoAndWindowTitle = function() {
        var e = window.gui.playerData.guild.current
          , t = e.guildEmblem
          , i = v.getWindow("social");
        i.updateWindowTitle("guild", s("ui.common.guild") + " - " + e.guildName),
        this.level.setText(s("ui.common.rank", e.level)),
        this.levelBar.setValue(e.experiencePercentage),
        this.membersValue.setText(e.nbConnectedMembers + " / " + e.nbMembers),
        this._updateGuildCreationData(),
        this.emblem.setValue(t, !0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        return e.name < t.name ? -1 : 1
    }
    function o(e, t) {
        return e.rankValue < t.rankValue ? -1 : 1
    }
    function s(e, t) {
        return e.onlineStatus < t.onlineStatus ? -1 : 1
    }
    function a(e) {
        e = e || {},
        r.call(this, "div", {
            className: "GuildMembers"
        }),
        this.addClassNames(e.className),
        this.once("open", function() {
            this._setupDom(),
            this._setupSocketEvents()
        })
    }
    i(875);
    var r = i(190)
      , l = i(26).inherits
      , c = i(400)
      , u = i(35).getText
      , h = i(204)
      , d = i(22)
      , p = i(448)
      , m = i(458)
      , f = i(339).GuildRightsBitEnum
      , g = i(5)
      , _ = i(292)
      , v = i(30)
      , y = {};
    y[m.NOT_CONNECTED] = "offline",
    y[m.GAME_TYPE_ROLEPLAY] = "online",
    y[m.GAME_TYPE_FIGHT] = "online",
    y[m.UNKNOWN_STATE] = "offline",
    l(a, r),
    e.exports = a,
    a.prototype._setupDom = function() {
        var e = this
          , t = [{
            id: "playerIcon",
            sort: s
        }, {
            id: "nameButton",
            header: u("ui.common.name"),
            sort: n
        }, {
            id: "rankName",
            header: u("ui.pvp.rank"),
            sort: o
        }, {
            id: "level",
            header: u("ui.common.short.level"),
            sort: !0
        }, {
            id: "xpPercentage",
            header: "%" + u("ui.common.xp"),
            sort: !0
        }, {
            id: "xp",
            header: u("ui.common.xp"),
            sort: !0
        }, {
            id: "achievement",
            header: u("ui.achievement.achievement"),
            sort: !0
        }, {
            id: "stateIcon",
            sort: s
        }, {
            id: "buttons"
        }];
        this.table = this.appendChild(new c(t,null ,{
            clickable: !1
        })),
        this.table.addFilter(function(t) {
            return !!e.showOfflineCheckbox.isActivate() || "online" === t.onlineStatus
        });
        var i = window.gui.playerData.guild.current.warnMemberOnConnectionState
          , a = v.getValue("showGuildMembersOffline", !1);
        this.showOfflineCheckbox = this.appendChild(new p(u("ui.social.displayOfflineGuildMembers"),a));
        var r = this.appendChild(new p(u("ui.social.warnWhenGuildMembersComeOnline"),i));
        this.averageLevel = this.createChild("div", {
            className: "averageLevel"
        }),
        this.showOfflineCheckbox.on("change", function(t) {
            e.table.filter(),
            v.setValue("showGuildMembersOffline", t)
        }),
        r.on("change", function(e) {
            window.dofus.sendMessage("GuildMemberSetWarnOnConnectionMessage", {
                enable: e
            }),
            window.gui.playerData.guild.current.warnMemberOnConnectionState = e
        })
    }
    ,
    a.prototype._setupSocketEvents = function() {
        var e = this;
        window.gui.playerData.guild.on("guildMember", function(t) {
            e.isVisible() && e._updateMembersList(t)
        }),
        window.gui.playerData.guild.on("guildMemberStatusUpdate", function(t) {
            if (e.isVisible()) {
                var i = e.table.getCell(t.id, "playerIcon")
                  , n = i.getChild("onlineStatusIcon");
                n.setClassNames("onlineStatusIcon", "status" + t.status.statusId)
            }
        })
    }
    ,
    a.prototype._updateMembersList = function(e) {
        function t() {
            d.open("guildMemberRights", this.memberInfo)
        }
        function i() {
            var e = this.memberInfo.id
              , t = 1 === Object.keys(a.members).length;
            if (e === a.leaderId && !t)
                return window.gui.openSimplePopup(u("ui.social.guildBossCantBeBann"), u("ui.popup.warning"));
            var i = l === e ? u("ui.social.doUDeleteYou") : u("ui.social.doUDeleteMember", this.memberInfo.name);
            window.gui.openConfirmPopup({
                title: u("ui.popup.warning"),
                message: i,
                cb: function(t) {
                    t && window.dofus.sendMessage("GuildKickRequestMessage", {
                        kickedId: e
                    })
                }
            })
        }
        function n() {
            this.connected ? window.gui.openContextualMenu("player", {
                playerId: this.id,
                accountId: this.accountId,
                playerName: this.name
            }) : window.gui.openContextualMenu("offlinePlayer", {
                playerId: this.id,
                playerName: this.name,
                hoursSinceLastConnection: this.hoursSinceLastConnection
            })
        }
        function o(e, t) {
            c.getSmallWingsUrl(t, function(t) {
                e.rootElement && e.setStyle("backgroundImage", t)
            })
        }
        var s = window.gui.playerData.guild
          , a = s.current
          , l = window.gui.playerData.id
          , c = window.gui.playerData.alignment
          , p = l === a.leaderId
          , m = []
          , v = []
          , w = []
          , b = [];
        this.table.clearContent(),
        this.averageLevel.setText(u("ui.social.guildAvgMembersLevel") + ": " + a.averageMemberLevel);
        for (var C = p || s.hasRight(f.GUILD_RIGHT_BOSS) || s.hasRight(f.GUILD_RIGHT_MANAGE_GUILD_BOOSTS) || s.hasRight(f.GUILD_RIGHT_MANAGE_RIGHTS) || s.hasRight(f.GUILD_RIGHT_MANAGE_XP_CONTRIBUTION) || s.hasRight(f.GUILD_RIGHT_MANAGE_RANKS), I = s.checkRight(f.GUILD_RIGHT_BOSS, a.members[l].rights), T = window.gui.databases.RankNames, S = 0, A = e.length; S < A; S++) {
            var E = e[S]
              , x = y[E.connected]
              , M = new r("div",{
                className: "buttons"
            })
              , N = l === e[S].id;
            (N || C || I) && (M.appendChild(new h({
                className: ["boxSizing", "rowButton", "rights"]
            },t)).memberInfo = {
                id: E.id,
                name: E.name,
                level: E.level,
                rank: E.rank,
                experienceGivenPercent: E.experienceGivenPercent,
                rights: E.rights
            }),
            (N || p || I || s.hasRight(f.GUILD_RIGHT_BAN_MEMBERS)) && (M.appendChild(new h({
                className: ["boxSizing", "rowButton", "deletion"]
            },i)).memberInfo = {
                id: E.id,
                name: E.name
            });
            var R = new h({
                className: "playerIcon",
                scaleOnPress: !1
            },n);
            R.createChild("div", {
                name: "onlineStatusIcon",
                className: ["onlineStatusIcon", "status" + E.status.statusId]
            });
            var O = R.createChild("div", {
                className: "alignmentSide"
            });
            E.alignmentSide !== _.ALIGNMENT_ANGEL && E.alignmentSide !== _.ALIGNMENT_EVIL || o(O, E.alignmentSide),
            m.push(O.createChild("div", {
                className: "playerHead"
            })),
            v.push("gfx/heads/SmallHead_" + E.breed + (E.sex ? 1 : 0) + ".png"),
            R.id = E.id,
            R.name = E.name,
            R.accountId = E.accountId,
            R.isMySelf = N,
            R.connected = E.connected,
            R.hoursSinceLastConnection = E.hoursSinceLastConnection;
            var P = new h({
                className: "nameButton",
                text: E.name,
                scaleOnPress: !1
            },n);
            P.id = E.id,
            P.name = E.name,
            P.accountId = E.accountId,
            P.isMySelf = N,
            P.connected = E.connected,
            P.hoursSinceLastConnection = E.hoursSinceLastConnection;
            var D = {
                playerIcon: R,
                nameButton: P,
                name: E.name,
                rankName: T[E.rank].nameId,
                rankValue: E.rank,
                level: E.level,
                xpPercentage: E.experienceGivenPercent + "%",
                xp: E.givenExperience,
                achievement: E.achievementPoints,
                buttons: M,
                onlineStatus: x
            };
            if ("offline" === x)
                D.stateIcon = new r("div",{
                    className: ["stateIcon", "offline"]
                });
            else if (E.hasOwnProperty("moodSmileyId") && E.moodSmileyId > 0) {
                var L = E.moodSmileyId
                  , B = window.gui.databases.Smileys[L];
                B ? (D.stateIcon = new r("div",{
                    className: ["stateIcon", "smiley"]
                }),
                w.push(D.stateIcon),
                b.push("gfx/smilies/" + B.gfxId + ".png")) : console.error("Smiley " + L + " details are not available, it could not be displayed")
            }
            this.table.addRow(D, E.id).addClassNames(x)
        }
        this.table.filter(),
        g.preloadImages(v, function(e) {
            for (var t = 0, i = e.length; t < i; t++) {
                var n = m[t];
                n && n.rootElement && n.setStyle("backgroundImage", e[t])
            }
        }),
        b.length && g.preloadImages(b, function(e) {
            if (e.length !== w.length)
                return console.error("Number of smileys preloaded does not match number of state icons");
            for (var t = 0; t < e.length; t++) {
                var i = w[t];
                i && i.rootElement && i.setStyle("backgroundImage", e[t])
            }
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        s.call(this, "div", {
            className: "GuildHousesWindow"
        }),
        this.addClassNames(e.className);
        var t = this;
        this.currentSelectedHouseId = null ,
        this.once("open", function() {
            t._createDom()
        }),
        this.on("open", function() {
            t._resetAll(),
            t.addClassNames("spinner")
        })
    }
    i(877);
    var o = i(26).inherits
      , s = i(190)
      , a = i(206).addTooltip
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(485)
      , u = i(22);
    o(n, s),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this
          , t = {
            colIds: ["houseName", "coordinate", "owner", "detail"],
            headerContent: [l("ui.common.houseWord"), l("ui.common.coordinatesSmall"), l("ui.common.ownerWord")],
            highlightable: !0,
            onRowTap: function(t) {
                e.currentSelectedHouseId = t.houseId
            }
        };
        this.table = this.appendChild(new c(t));
        var i = this.createChild("div", {
            className: "buttonContainer"
        });
        this.joinButton = i.appendChild(new r("Join",{
            className: "joinButton"
        })),
        this.joinButton.on("tap", function() {
            window.dofus.sendMessage("GuildHouseTeleportRequestMessage", {
                houseId: e.currentSelectedHouseId
            }),
            u.close("social")
        }),
        this.joinButton.disable(),
        this._setupSocketEvents()
    }
    ,
    n.prototype._setupSocketEvents = function() {
        var e = this
          , t = window.gui.playerData.guild;
        t.on("guildHouseUpdateAll", function() {
            e.isVisible() && (e.delClassNames("spinner"),
            e._updateHouses(),
            e._updateJoinButton())
        }),
        t.on("guildHouseUpdateInfo", function(t) {
            e.isVisible() && (e._updateHouse(t),
            e._updateJoinButton())
        }),
        t.on("guildHouseRemoved", function(t) {
            e.isVisible() && (e._removeHouse(t),
            e._updateJoinButton())
        })
    }
    ,
    n.prototype._createHouseInfoButton = function(e) {
        var t = this
          , i = new r("?",{
            name: "button"
        });
        return i.on("tap", function() {
            var i = t._getHouseListRowIndexByHouseId(e.houseId);
            t.table.highlight(i),
            u.open("guildHouseInfo", {
                guildshareParams: e.guildshareParams,
                skillListIds: e.skillListIds
            })
        }),
        i
    }
    ,
    n.prototype._resetAll = function() {
        this.currentSelectedHouseId = null ,
        this.table.clearContent(),
        this.joinButton.disable()
    }
    ,
    n.prototype._createHouseListRow = function(e) {
        var t = e.enrichData || {};
        return {
            houseName: t.houseName,
            coordinate: e.worldX + "," + e.worldY,
            owner: e.ownerName,
            detail: this._createHouseInfoButton(e)
        }
    }
    ,
    n.prototype._getHouseListRowIndexByHouseId = function(e) {
        for (var t = this.table.getRows(), i = 0; i < t.length; i += 1) {
            var n = t[i].houseId || {};
            if (e === n)
                return i
        }
    }
    ,
    n.prototype._updateJoinButton = function() {
        var e = window.gui.playerData.guild.current.houses || [];
        e.length ? this.joinButton.enable() : this.joinButton.disable()
    }
    ,
    n.prototype._updateHouses = function() {
        var e = window.gui.playerData.guild.current.houses || [];
        this._resetAll();
        for (var t = 0; t < e.length; t += 1)
            this._addHouse(e[t])
    }
    ,
    n.prototype._addHouse = function(e) {
        var t = this._createHouseListRow(e)
          , i = this.table.addRow(t, {
            houseId: e.houseId
        });
        this._addHouseRowToolTip(i, e)
    }
    ,
    n.prototype._removeHouse = function(e) {
        var t = this._getHouseListRowIndexByHouseId(e);
        t >= 0 && this.table.delRow(t)
    }
    ,
    n.prototype._updateHouse = function(e) {
        var t = e.houseId
          , i = this._getHouseListRowIndexByHouseId(t);
        if (i >= 0) {
            var n = this._createHouseListRow(e);
            this.table.updateRow(i, n, {
                houseId: t
            })
        } else
            this._addHouse(e)
    }
    ,
    n.prototype._addHouseRowToolTip = function(e, t) {
        var i = t.enrichData
          , n = i.areaName + " (" + i.subAreaName + ")";
        a(e, n)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        h.call(this, "div", e),
        this.addClassNames("GuildCustomisationWindow"),
        this._buildDomElements(),
        this._listenGameServerEvents()
    }
    function o() {
        window.dofus.sendMessage("GuildSpellUpgradeRequestMessage", {
            spellId: this.spellId
        })
    }
    function s(e, t) {
        var i = ""
          , n = e.getUpgradeCost();
        return t >= n && e.level < e.getMaxLevel() && (i = new f({
            className: "UpgradeButton"
        },o),
        i.spellId = e.id),
        i
    }
    function a(e, t, i, n) {
        function o(t) {
            for (var i = [], n = 0, o = e.length; n < o; n++)
                i.push("gfx/spells/sort_" + e[n] + ".png");
            _.preloadImages(i, function(e) {
                t(null , e)
            })
        }
        function a(t) {
            m.createSpells(e, t)
        }
        function r(o, a) {
            if (o)
                return console.warn(o);
            for (var r = {}, l = {}, c = 0; c < e.length; c++) {
                var u = e[c];
                r[u] = a.spellUrls[c];
                var d = t[c] ? t[c] : 1;
                l[u] = t[c],
                a.spells[u].setLevel(d)
            }
            for (var m in a.spells) {
                var f = a.spells[m]
                  , _ = new h("div",{
                    className: "spellIcon"
                });
                _.setStyle("backgroundImage", r[m]),
                i.addRow([_, f.getName(), l[m], s(f, n)]),
                g(_, new p({
                    spell: f
                }))
            }
        }
        i.clearContent(),
        u.parallel({
            spells: a,
            spellUrls: o
        }, r)
    }
    function r(e) {
        var t = new f({
            className: "UpgradeButton",
            name: "button"
        },function() {
            window.dofus.sendMessage("GuildCharacsUpgradeRequestMessage", {
                charaTypeTarget: v[t.id]
            })
        }
        );
        return t.id = e,
        t
    }
    i(879);
    var l = i(26).inherits
      , c = i(35).getText
      , u = i(12)
      , h = i(190)
      , d = i(485)
      , p = i(576)
      , m = i(281)
      , f = i(204)
      , g = i(206).addTooltip
      , _ = i(5)
      , v = {
        taxCollectorPods: 0,
        taxCollectorProspecting: 1,
        taxCollectorWisdom: 2,
        maxTaxCollectorsCount: 3
    }
      , y = {
        taxCollectorLifePoints: null ,
        taxCollectorDamagesBonuses: null ,
        taxCollectorProspecting: {
            cost: 1,
            quantity: 1,
            max: 500
        },
        taxCollectorWisdom: {
            cost: 1,
            quantity: 1,
            max: 400
        },
        taxCollectorPods: {
            cost: 1,
            quantity: 20,
            max: 5e3
        },
        maxTaxCollectorsCount: {
            cost: 10,
            quantity: 1,
            max: 50
        }
    };
    l(n, h),
    e.exports = n,
    n.prototype._listenGameServerEvents = function() {
        var e = this;
        window.gui.on("GuildInfosUpgradeMessage", function(t) {
            e._updateUI(t)
        })
    }
    ,
    n.prototype._buildDomElements = function() {
        var e = this.createChild("div", {
            className: ["sidePanel", "leftPanel"],
            name: "leftPanel"
        });
        this.spellsTable = new d({
            colIds: ["icon", "name", "level", "upgrade"],
            headerContent: ["", c("ui.common.name"), c("ui.common.level")],
            className: ["sidePanel", "rightPanel"]
        }),
        this.appendChild(this.spellsTable);
        var t = e.createChild("div", {
            className: "characterImage"
        })
          , i = t.createChild("div", {
            className: "image"
        });
        _.preloadImage("gfx/illusUi/SocialGuildePersonnalisation_tx_IlluPerco.png", function(e) {
            i.setStyle("backgroundImage", e)
        });
        var n = new d({
            colIds: ["label", "value", "upgrade"],
            headerContent: [c("ui.social.guildTaxCharacteristics")]
        });
        n.addRow([c("ui.common.lifePoints"), "0", ""]),
        n.addRow([c("ui.social.damagesBonus"), "0", ""]),
        n.addRow([c("ui.social.discernment"), "0", r("taxCollectorProspecting")]),
        n.addRow([c("ui.stats.wisdom"), "0", r("taxCollectorWisdom")]),
        n.addRow([c("ui.common.weight"), "0", r("taxCollectorPods")]),
        n.addRow([c("ui.social.taxCollectorCount"), "0", r("maxTaxCollectorsCount")]),
        n.addClassNames("perceptorCharacteristicsTable"),
        e.appendChild(n),
        this.perceptorCharacteristicsTable = n;
        var o = e.createChild("div", {
            className: "pointsToDistributePanel",
            name: "pointsToDistributePanel"
        });
        o.createChild("div", {
            className: "pointsToDistributeLabel",
            name: "pointsToDistributeLabel",
            text: c("ui.social.guildBonusPoints")
        }),
        this.pointsToDistributeValue = o.createChild("div", {
            className: "pointsToDistributeValue",
            name: "pointsToDistributeValue",
            text: "0"
        })
    }
    ,
    n.prototype._updateUI = function(e) {
        var t = e.boostPoints
          , i = this.perceptorCharacteristicsTable
          , n = 0;
        for (var o in y) {
            var s = n++;
            if (i.updateRow(s, {
                value: e[o]
            }),
            y[o]) {
                var r = t >= y[o].cost
                  , l = e[o] < y[o].max
                  , c = i.getCol(s, "upgrade").getChild("button");
                r && l ? c.show() : c.hide()
            }
        }
        this.pointsToDistributeValue.setText(e.boostPoints),
        a(e.spellId, e.spellLevel, this.spellsTable, e.boostPoints)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        a.call(this, "div", {
            className: "GuildPaddocksWindow"
        }),
        this.addClassNames(e.className),
        this.selectedPaddock = null ,
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        }),
        this.on("open", function() {
            this._resetAll(),
            this.locationTable.addClassNames("spinner")
        })
    }
    i(881);
    var o = i(26).inherits
      , s = i(204)
      , a = i(190)
      , r = i(206).addTooltip
      , l = i(35).getText
      , c = i(485)
      , u = i(22)
      , h = i(5);
    o(n, a),
    e.exports = n,
    n.prototype._setupEvents = function() {
        var e = window.gui.playerData.guild
          , t = this;
        e.on("guildPaddockUpdate", function() {
            t.isVisible() && (t.locationTable.delClassNames("spinner"),
            t._updatePaddocks(),
            t._updateJoinButton())
        }),
        e.on("guildPaddockBought", function(e) {
            t.isVisible() && (t._addPaddock(e),
            t._updateJoinButton())
        }),
        e.on("guildPaddockRemoved", function(e) {
            t.isVisible() && (t._removePaddock(e),
            t._updateJoinButton())
        })
    }
    ,
    n.prototype._createDom = function() {
        var e = this;
        this.locationTable = this.appendChild(new c({
            className: "locationTable",
            headerContent: [l("ui.common.localisation")],
            colIds: ["location", "abandoned"],
            highlightable: !0,
            onRowTap: function(t) {
                e._updatePaddockDetails(t)
            }
        }));
        var t = this.createChild("div", {
            className: "rightColumn"
        })
          , i = t.createChild("div", {
            className: "infos"
        })
          , n = i.createChild("div", {
            className: "image"
        })
          , o = i.createChild("div", {
            className: "details"
        });
        this.paddockName = o.createChild("div", {
            className: "name"
        }),
        o.createChild("div", {
            className: ["text", "clear"],
            text: l("ui.common.objects")
        }),
        this.maxItems = o.createChild("div", {
            className: ["text", "right"],
            text: "-"
        }),
        o.createChild("div", {
            className: ["text", "clear"],
            text: l("ui.common.mounts")
        }),
        this.maxMounts = o.createChild("div", {
            className: ["text", "right"],
            text: "-"
        }),
        this.joinButton = new s({
            className: ["button", "clear"],
            text: l("ui.common.join")
        },function() {
            e.selectedPaddock && e.selectedPaddock.paddockId && (window.dofus.sendMessage("GuildPaddockTeleportRequestMessage", {
                paddockId: e.selectedPaddock.paddockId
            }),
            u.close("social"))
        }
        ),
        o.appendChild(this.joinButton),
        this.mountTable = t.appendChild(new c({
            className: "mountTable",
            headerContent: [l("ui.common.mountType"), l("ui.common.ownerWord")],
            colIds: ["mount", "owner"]
        })),
        h.preloadImage("gfx/illusUi/IllusDinde.png", function(e) {
            n.setStyle("backgroundImage", e)
        })
    }
    ,
    n.prototype._updatePaddockDetails = function(e) {
        var t = this.selectedPaddock = e.paddock
          , i = t.enrichData || {};
        this.paddockName.setText(l("ui.common.mountPark") + " - " + i.subAreaName),
        this.maxItems.setText(t.maxItems + " " + l("ui.common.maxWord"));
        var n = t.mountsInformations
          , o = n.length;
        if (this.maxMounts.setText(o + " / " + t.maxOutdoorMount),
        this.mountTable.clearContent(),
        o)
            for (var s = 0; s < o; s += 1) {
                var a = n[s]
                  , c = a.enrichData || {}
                  , u = this.mountTable.addRow({
                    mount: c.mountType,
                    owner: a.ownerName
                })
                  , h = a.name || l("ui.common.noName");
                r(u, h)
            }
    }
    ,
    n.prototype._createLocationTableRow = function(e) {
        var t, i = new a("div",{
            className: "locationInfo"
        }), n = i.createChild("div");
        e.abandonned && (t = i.createChild("div", {
            className: "abandonedIcon"
        }),
        r(t, l("ui.social.paddockWithNoOwner")));
        var o = e.enrichData || {}
          , s = isNaN(e.worldX) ? o.worldX : e.worldX
          , c = isNaN(e.worldY) ? o.worldY : e.worldY
          , u = "(" + s + ", " + c + ")";
        return n.setText(o.areaName + " (" + o.subAreaName + ") " + u),
        {
            location: n,
            abandoned: t || ""
        }
    }
    ,
    n.prototype._updateJoinButton = function() {
        var e = window.gui.playerData.guild.current.paddocks || [];
        e.length ? this.joinButton.enable() : this.joinButton.disable()
    }
    ,
    n.prototype._updatePaddocks = function() {
        var e = window.gui.playerData.guild.current.paddocks || [];
        this._resetAll();
        for (var t = 0; t < e.length; t += 1)
            this._addPaddock(e[t])
    }
    ,
    n.prototype._addPaddock = function(e) {
        var t = this._createLocationTableRow(e);
        this.locationTable.addRow(t, {
            paddock: e
        })
    }
    ,
    n.prototype._removePaddock = function(e) {
        for (var t = this.locationTable.getRows(), i = 0; i < t.length; i += 1) {
            var n = t[i];
            if (n.paddock.paddockId === e) {
                this.locationTable.delRow(i);
                break
            }
        }
    }
    ,
    n.prototype._resetAll = function() {
        this.locationTable.clearContent(),
        this.mountTable.clearContent(),
        this.joinButton.disable(),
        this.paddockName.setText(""),
        this.maxItems.setText("-"),
        this.maxMounts.setText("-")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "GuildPerceptorsWindow"
        }),
        this.taxCollectorRows = {},
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        }),
        this.on("open", function() {
            this.table.addClassNames("spinner"),
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: c.INFO_TAX_COLLECTOR_GUILD_ONLY
            })
        }),
        this.on("close", function() {
            this._clearAllFightStartTimers(),
            window.dofus.sendMessage("GuildGetInformationsMessage", {
                infoType: c.INFO_TAX_COLLECTOR_LEAVE
            })
        })
    }
    function o(e) {
        var t = this.fight;
        if (t.state === m.fightState.waitingForHelp) {
            var i = t.id
              , n = window.gui.playerData.id;
            m.isPlayerFightingFor(n, f.taxCollector, i, g.allies) ? e && n === e.id && window.dofus.sendMessage("GuildFightLeaveRequestMessage", {
                taxCollectorId: i,
                characterId: n
            }) : e && 5 === t.fighters.allies.length ? window.dofus.sendMessage("GuildFightTakePlaceRequestMessage", {
                taxCollectorId: i,
                replacedCharacterId: e.id
            }) : window.dofus.sendMessage("GuildFightJoinRequestMessage", {
                taxCollectorId: i
            })
        }
    }
    i(883);
    var s = i(26).inherits
      , a = i(190)
      , r = i(206).addTooltip
      , l = i(35).getText
      , c = i(476)
      , u = i(210)
      , h = i(867)
      , d = i(643)
      , p = i(485)
      , m = i(336)
      , f = m.entityType
      , g = m.fightingSide;
    s(n, a),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this.createChild("div", {
            className: "tableContainer"
        });
        this.table = e.appendChild(new p({
            headerContent: ["", l("ui.common.name") + " / " + l("ui.common.localisation"), "", l("ui.common.defenders") + " / " + l("ui.common.attackers")],
            colIds: ["fightState", "taxCollectorInfo", "timer", "fightersInfo"]
        })),
        this.perceptorAmountText = this.createChild("div", {
            className: "rightAlignText"
        }),
        this._setPerceptorsAmount(0, 0),
        this.createChild("div", {
            className: "rightAlignText",
            text: l("ui.social.guildHowDefendTax")
        })
    }
    ,
    n.prototype._setupEvents = function() {
        function e(e) {
            return i.taxCollectorRows[e] && i.taxCollectorRows[e].fightersInfo
        }
        function t(e) {
            return i.taxCollectorRows[e] && i.taxCollectorRows[e].timer
        }
        var i = this
          , n = 0;
        m.on("entityList", function(e, t, o) {
            if (i.isVisible() && e === f.taxCollector) {
                i.table.delClassNames("spinner"),
                i._resetAll();
                for (var s = 0, a = t.length; s < a; s += 1)
                    i._addTaxCollector(t[s]);
                n = o,
                i._setPerceptorsAmount(t.length, o)
            }
        }),
        m.on("entityAdded", function(e, t) {
            i.isVisible() && e === f.taxCollector && (i._addTaxCollector(t),
            i._setPerceptorsAmount(i.table.getRowCount(), n))
        }),
        m.on("entityRemoved", function(e, t) {
            i.isVisible() && e === f.taxCollector && (i._removeTaxCollector(t),
            i._setPerceptorsAmount(i.table.getRowCount(), n))
        }),
        m.on("fightStarted", function(n, o) {
            if (i.isVisible() && n === f.taxCollector) {
                var s = e(o.id);
                if (s) {
                    var a = m.entities[n][o.id]
                      , r = a.enrichData || {};
                    s.setFight(n, o),
                    s.setTarget({
                        id: o.id,
                        entityLook: a.look,
                        name: r.firstName + " " + r.lastName,
                        level: window.gui.playerData.guild.current.level
                    }),
                    i._updateFightState(o.id, o.state);
                    var l = t(o.id);
                    i._registerFightStartTimer(l, o.waitingForHelpInfo)
                }
            }
        }),
        m.on("fighting", function(e, n) {
            if (i.isVisible() && e === f.taxCollector) {
                var o = t(n.id);
                i._updateFightState(n.id, n.state),
                i._clearFightStartTimer(o)
            }
        }),
        m.on("fightEnded", function(t, n) {
            if (i.isVisible() && t === f.taxCollector) {
                var o = e(n);
                o && (i._updateFightState(n, m.fightState.noFight),
                o.reset())
            }
        }),
        m.on("fighterList", function(t, n, o, s) {
            if (i.isVisible() && t === f.taxCollector) {
                var a = e(n);
                a && a.setFighters(o, s)
            }
        }),
        m.on("fighterJoined", function(t, n, o, s, a) {
            if (i.isVisible() && t === f.taxCollector) {
                var r = e(n);
                r && r.setFighter(o, s, a)
            }
        }),
        m.on("fighterLeft", function(t, n, o, s, a) {
            if (i.isVisible() && t === f.taxCollector) {
                var r = e(n);
                r && r.removeFighter(o, a)
            }
        })
    }
    ,
    n.prototype._setPerceptorsAmount = function(e, t) {
        this.perceptorAmountText.setText(l("ui.social.guild.taxCollectorCount", e, t))
    }
    ,
    n.prototype._setNameLocation = function(e, t) {
        var i = t.enrichData || {}
          , n = e.getChild("name");
        n.setText(i.firstName + " " + i.lastName);
        var o = " (" + t.worldX + " , " + t.worldY + ")"
          , s = e.getChild("location");
        s.setText(i.subAreaName + o);
        var a = t.complements || []
          , r = u.getObjectInArrayById(a, "_type", "TaxCollectorLootInformations") || {}
          , c = l("ui.common.short.weight", u.intToString(r.pods || 0))
          , h = l("ui.social.thingsTaxCollectorGet", c, u.intToString(r.experience || 0))
          , d = e.getChild("resources");
        d.setText(h)
    }
    ,
    n.prototype._addFightStateToolTip = function(e, t) {
        r(e, function() {
            var e = ""
              , i = window.gui.playerData.guild.getPerceptor(t);
            if (i) {
                var n = i.informations
                  , o = n.state || 0;
                e += l(1 === o ? "ui.social.guild.taxInEnterFight" : 2 === o ? "ui.social.guild.taxInFight" : "ui.social.guild.taxInCollect");
                var s = n.additionalInfos || {};
                e += "\n" + l("ui.common.ownerWord") + l("ui.common.colon"),
                e += s.collectorCallerName + "\n",
                e += l("ui.social.guild.taxStartDate") + l("ui.common.colon");
                var r = u.getAlmanaxDate(1e3 * s.date);
                e += r.day + " " + r.monthName + " " + r.year + " " + r.hour + ":" + r.minute
            }
            return new a("div",{
                text: e
            })
        })
    }
    ,
    n.prototype._updateTimerProgressBar = function(e) {
        var t = e.remainSeconds
          , i = e.totalWaitTime
          , n = i - t
          , o = Math.round(n / i * 100) / 100;
        e.setValue(o)
    }
    ,
    n.prototype._registerFightStartTimer = function(e, t) {
        var i = this;
        t && (e.remainSeconds = Math.round(t.timeLeftBeforeFight / 10) || 0,
        e.totalWaitTime = Math.round(t.waitTimeForPlacement / 10) || 1,
        e.intervalId = setInterval(function() {
            e.remainSeconds -= 1,
            e.remainSeconds > 0 ? i._updateTimerProgressBar(e) : i._clearFightStartTimer(e)
        }, 1e3),
        this._updateTimerProgressBar(e))
    }
    ,
    n.prototype._clearFightStartTimer = function(e) {
        clearInterval(e.intervalId),
        e.intervalId = null ,
        e.remainSeconds = 0,
        e.totalWaitTime = 0,
        e.setValue(0)
    }
    ,
    n.prototype._clearAllFightStartTimers = function() {
        for (var e = this.table.getRows() || [], t = 0; t < e.length; t += 1) {
            var i = e[t].timer;
            this._clearFightStartTimer(i)
        }
    }
    ,
    n.prototype._createTaxCollectorRow = function(e) {
        var t = e.uniqueId
          , i = new a("div",{
            className: ["fightState", "state" + e.state]
        });
        this._addFightStateToolTip(i, t);
        var n = new a("div",{
            className: "taxCollectorInfo"
        });
        n.createChild("div", {
            name: "name"
        }),
        n.createChild("div", {
            name: "location"
        }),
        n.createChild("div", {
            name: "resources"
        }),
        this._setNameLocation(n, e);
        var s = new d({
            vertical: !0,
            className: ["green", "timer"]
        })
          , r = new h;
        return r.on("slotTap", o),
        {
            fightState: i,
            taxCollectorInfo: n,
            timer: s,
            fightersInfo: r
        }
    }
    ,
    n.prototype._addTaxCollector = function(e) {
        var t = e.uniqueId
          , i = this.table.addRow(this._createTaxCollectorRow(e), {
            collectorId: t
        });
        this.taxCollectorRows[t] = i
    }
    ,
    n.prototype._updateFightState = function(e, t) {
        var i = this.taxCollectorRows[e];
        i && i.fightState.replaceClassNames(["state0", "state1", "state2"], ["state" + t])
    }
    ,
    n.prototype._removeTaxCollector = function(e) {
        var t = this.taxCollectorRows[e];
        if (t) {
            this._clearFightStartTimer(t.timer),
            delete this.taxCollectorRows[e];
            var i = this.table.getRows().indexOf(t);
            this.table.delRow(i)
        }
    }
    ,
    n.prototype._resetAll = function() {
        this.taxCollectorRows = {},
        this._clearAllFightStartTimers(),
        this.table.clearContent(),
        this._setPerceptorsAmount(0, 0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "SpouseWindow",
            name: "spouse"
        });
        var e = this;
        window.gui.playerData.socialData.once("spouseUpdate", function(t) {
            e._updateSocialWindowTitle(t)
        }),
        this.once("open", function() {
            e._setupDom(),
            e._setupEvents()
        }),
        this.on("open", function() {
            window.dofus.sendMessage("SpouseGetInformationsMessage")
        })
    }
    i(885);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(190)
      , r = i(204)
      , l = i(36)
      , c = i(238)
      , u = i(279)
      , h = i(22)
      , d = i(5);
    o(n, a),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "col1"
        })
          , i = this.createChild("div", {
            className: "col2"
        });
        this.name = t.createChild("div", {
            className: "name"
        });
        var n = this.info = t.createChild("div", {
            className: "info"
        })
          , o = n.createChild("div", {
            className: "line"
        });
        o.createChild("div", {
            className: "title",
            text: s("ui.charcrea.breed") + ":"
        }),
        this["class"] = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: "line"
        }),
        o.createChild("div", {
            className: "title",
            text: s("ui.common.averageLevel") + ":"
        }),
        this.level = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: "line"
        }),
        o.createChild("div", {
            className: "title",
            text: s("ui.common.alignment") + ":"
        }),
        this.alignment = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: ["line", "guild"]
        }),
        o.createChild("div", {
            className: "title",
            text: s("ui.common.guild") + ":"
        }),
        this.guild = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: "line"
        }),
        o.createChild("div", {
            className: "title",
            text: s("ui.common.state") + ":"
        }),
        this.status = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: "line"
        }),
        o.createChild("div", {
            className: "title",
            text: s("ui.common.localisation") + ":"
        }),
        this.location = o.createChild("div", {
            className: "value"
        }),
        o = n.createChild("div", {
            className: "line"
        }),
        this.fightingIcon = o.createChild("div", {
            className: "fightingIcon",
            hidden: !0
        });
        var a = n.createChild("div", {
            className: "buttons"
        });
        this.inviteButton = a.appendChild(new r({
            text: s("ui.party.addToParty"),
            className: "button"
        },function() {
            window.dofus.sendMessage("PartyInvitationRequestMessage", {
                name: e.name.getText()
            })
        }
        )),
        this.followButton = a.appendChild(new r({
            text: s("ui.common.follow"),
            className: "button"
        },function() {
            window.dofus.sendMessage("FriendSpouseFollowWithCompassRequestMessage", {
                enable: !0
            })
        }
        )),
        this.stopFollowingButton = a.appendChild(new r({
            text: s("ui.common.stopFollow"),
            className: "button",
            hidden: !0
        },function() {
            window.dofus.sendMessage("FriendSpouseFollowWithCompassRequestMessage", {
                enable: !1
            })
        }
        )),
        this.joinButton = a.appendChild(new r({
            text: s("ui.common.join"),
            className: "button"
        },function() {
            window.dofus.sendMessage("FriendSpouseJoinRequestMessage")
        }
        ));
        var l = i.createChild("div", {
            className: ["image", "bird"]
        });
        this.character = i.appendChild(new c({
            scale: 3.5,
            verticalAlign: "center"
        })),
        d.preloadImage("gfx/illusUi/tofus_bague.png", function(e) {
            l.setStyle("backgroundImage", e)
        })
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this;
        window.gui.playerData.socialData.on("spouseUpdate", function(t) {
            e._updateSocialWindowTitle(t),
            e.updateDomData(t)
        }),
        window.gui.on("CompassUpdateMessage", function() {
            e.stopFollowingButton.show(),
            e.followButton.hide()
        }),
        window.gui.on("CompassResetMessage", function() {
            e.stopFollowingButton.hide(),
            e.followButton.show()
        })
    }
    ,
    n.prototype.updateDomData = function(e) {
        var t = this
          , i = window.gui.databases;
        this.name.setText(e.spouseName),
        this["class"].setText(i.Breeds[e.breed].shortNameId),
        this.level.setText(e.spouseLevel),
        this.alignment.setText(i.AlignmentSides[e.alignmentSide].nameId);
        var n = e.guildInfo ? e.guildInfo.guildName : "";
        return this.guild.setText("#NONAME#" === n ? s("ui.guild.noName") : n),
        this.stopFollowingButton.toggleDisplay(!!e.followSpouse),
        this.followButton.toggleDisplay(!e.followSpouse),
        this.fightingIcon.toggleDisplay(!!e.inFight),
        t.character.setLook(e.spouseEntityLook, {
            direction: u.DIRECTION_SOUTH_WEST,
            boneType: "characters/",
            skinType: "characters/",
            riderOnly: !0
        }),
        e.subAreaId ? (this.status.setText(s("ui.server.state.online")),
        this.inviteButton.enable(),
        this.followButton.enable(),
        this.stopFollowingButton.enable(),
        this.joinButton.enable(),
        void l.getData("SubAreas", e.subAreaId, function(e, i) {
            e && console.warn("Failed to retrieve subArea data", e),
            t.location.setText(i.nameId)
        })) : (this.status.setText(s("ui.server.state.offline")),
        this.location.setText("-"),
        this.inviteButton.disable(),
        this.followButton.disable(),
        this.stopFollowingButton.disable(),
        void this.joinButton.disable())
    }
    ,
    n.prototype._updateSocialWindowTitle = function(e) {
        var t = h.getWindow("social");
        t.updateWindowTitle("spouse", s("ui.common.spouse", e.sex))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        r.call(this, "div", {
            className: "FellowPagesWindow",
            name: "directory"
        }),
        e = e || {},
        this.addClassNames(e.className);
        var t = this;
        this.once("open", function() {
            t._setupDom()
        })
    }
    i(887);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(509)
      , r = i(190)
      , l = i(888)
      , c = i(890);
    o(n, r),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this.appendChild(new a({
            className: "tabs"
        }));
        e.addTab(s("ui.social.guilds"), new l, "guilds"),
        e.addTab(s("ui.alliance.alliances"), new c, "alliances"),
        e.openTab(0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        o.call(this, "div", {
            className: "FellowGuildsWindow"
        }),
        this.selector = null ,
        this.table = null ;
        var e = this;
        this.once("open", function() {
            e._setupDom()
        })
    }
    i(889);
    var o = i(190)
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(393)
      , l = i(391)
      , c = i(485);
    s(n, o),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this.createChild("div", {
            className: "line"
        });
        e.createChild("div", {
            className: "left",
            text: a("ui.search.criteria")
        }),
        e.createChild("div", {
            className: "right",
            text: a("ui.social.dataUpdate")
        }),
        e = this.createChild("div", {
            className: "line"
        }),
        this.selector = e.appendChild(new r),
        this.selector.addOption(a("ui.common.name"), "name"),
        this.selector.addOption(a("ui.alliance.memberName"), "memberName"),
        e.appendChild(new l),
        this.table = this.appendChild(new c({
            colIds: ["name", "level", "members", "button"],
            headerContent: [a("ui.common.name"), a("ui.common.level"), a("ui.common.members")]
        }))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        o.call(this, "div", {
            className: "FellowAlliancesWindow"
        });
        var e = this;
        this.once("open", function() {
            e._setupDom()
        })
    }
    i(891);
    var o = i(190)
      , s = i(26).inherits
      , a = i(35).getText
      , r = i(393)
      , l = i(391)
      , c = i(485);
    s(n, o),
    e.exports = n,
    n.prototype._setupDom = function() {
        var e = this.createChild("div", {
            className: "line"
        });
        e.createChild("div", {
            className: "left",
            text: a("ui.search.criteria")
        }),
        e.createChild("div", {
            className: "right",
            text: a("ui.social.dataUpdate")
        }),
        e = this.createChild("div", {
            className: "line"
        }),
        this.selector = e.appendChild(new r),
        this.selector.addOption(a("ui.common.name"), "name"),
        this.selector.addOption(a("ui.alliance.memberName"), "memberName"),
        e.appendChild(new l),
        this.table = this.appendChild(new c({
            colIds: ["name", "abbr", "guilds", "members", "territories", "button"],
            headerContent: [a("ui.common.name"), a("ui.alliance.tag"), a("ui.social.guilds"), a("ui.common.members"), a("ui.common.territory")]
        }))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e, t) {
            t ? e.enable() : e.disable()
        }
        function t() {
            P || h.preloadImage("gfx/illusUi/enclos_tx_illuEnclos.png", function(e) {
                P = !0,
                S.setStyle("backgroundImage", e)
            });
            var t = C.currency === _
              , s = t ? n : i;
            if (o)
                M.replaceClassNames(["buy"], ["sell"]),
                O.hide(),
                C.windowTitle.setText(l("ui.mount.paddockSell")),
                N.setText(l("ui.common.cancelTheSale")),
                x.setReadonly(!1),
                e(R, w);
            else {
                M.replaceClassNames(["sell"], ["buy"]),
                O.show(),
                C.windowTitle.setText(l("ui.mount.paddockPurchase")),
                N.setText(l("ui.common.cancel")),
                x.setReadonly(!0);
                var a = window.gui.playerData.inventory
                  , r = t || s && s <= a.kamas;
                e(R, r)
            }
            return A.setText(l("ui.mount.paddockDescription", v, y)),
            s ? void x.setValue(s) : x.setValue(l("ui.item.averageprice.unavailable"))
        }
        s.call(this, {
            className: "PaddockBuyWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 350,
                height: 270
            }
        }),
        this.currency = g;
        var i, n, o, v, y, w, b, C = this, I = this.windowBody.createChild("div", {
            className: "wrapContainer"
        }), T = I.createChild("div", {
            className: "container"
        }), S = T.createChild("div", {
            className: "illus"
        }), A = T.createChild("div", {
            className: "description"
        }), E = this.windowBody.createChild("div", {
            className: "price"
        }), x = E.appendChild(new c({
            className: "priceValue",
            attr: {
                readonly: !0
            },
            title: l("ui.common.price")
        }));
        E.createChild("div", {
            className: "priceLabel",
            text: l("ui.common.price") + ":"
        });
        var M = this.windowBody.createChild("div", {
            className: "buttons"
        })
          , N = M.appendChild(new a(null ,{
            className: "cancel"
        }));
        N.on("tap", function() {
            o ? (m.hide(),
            window.dofus.sendMessage("PaddockSellRequestMessage", {
                price: 0
            })) : u.close(C.id)
        });
        var R = M.appendChild(new a(l("ui.common.validation"),{
            className: "confirm"
        }));
        R.on("tap", function() {
            if (o) {
                m.hide(),
                i = x.getValue();
                var e = x.getFormattedValue();
                window.gui.openConfirmPopup({
                    title: l("ui.mount.paddockSell"),
                    message: l("ui.mount.doUSellPaddock", e),
                    cb: function(e) {
                        e && window.dofus.sendMessage("PaddockSellRequestMessage", {
                            price: i
                        })
                    }
                })
            } else {
                var t, s = C.currency === g;
                t = s ? l("tablet.price.soft", r.kamasToString(i, "")) : l("tablet.price.hard", r.kamasToString(n, "")),
                window.gui.openConfirmPopup({
                    title: l("ui.mount.paddockPurchase"),
                    message: l("tablet.ui.mount.doUBuyPaddock", t),
                    cb: function(e) {
                        if (e) {
                            if (s)
                                return window.dofus.sendMessage("PaddockBuyRequestMessage");
                            var t = n - window.gui.playerData.inventory.goultines;
                            return t > 0 ? f.openNotEnoughHardCurrencyPopup(t) : window.dofus.send("paddockBuyRequest", {
                                amountHard: n,
                                amountSoft: i
                            })
                        }
                    }
                }, {
                    isModal: !0
                })
            }
        }),
        x.on("change", function(t) {
            C.currency === g ? e(R, t !== b) : e(R, !0)
        });
        var O = M.appendChild(new d);
        O.on("switchToHard", function() {
            C._setCurrency(_),
            t()
        }),
        O.on("switchToSoft", function() {
            C._setCurrency(g),
            t()
        });
        var P = !1;
        window.gui.on("PaddockPropertiesMessage", function(e) {
            v = e.properties.maxOutdoorMount,
            y = e.properties.maxItems,
            w = 0 === e.properties.price
        }),
        window.gui.on("PaddockSellBuyDialogMessage", function(e) {
            o = e.bsell,
            i = b = e.price,
            n = p.computeHardPrice(i),
            O.setCurrency(g),
            t(),
            u.openDialog("paddockBuy")
        }),
        p.on("computedHardPricesChange", function() {
            n = p.computeHardPrice(i),
            C.currency === _ && t()
        });
        var D = window.dofus.connectionManager;
        D.on("paddockBuyError", function() {
            this.send("moneyGoultinesAmountRequest")
        }),
        D.on("paddockBuySuccess", function() {
            this.send("moneyGoultinesAmountRequest")
        }),
        this.on("close", function() {
            m.hide()
        })
    }
    i(893);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204).DofusButton
      , r = i(210)
      , l = i(35).getText
      , c = i(208)
      , u = i(22)
      , h = i(5)
      , d = i(776)
      , p = i(548)
      , m = i(301)
      , f = i(633)
      , g = "soft"
      , _ = "hard";
    o(n, s),
    e.exports = n,
    n.prototype._setCurrency = function(e) {
        if (this.currency !== e) {
            var t = this.currency;
            this.currency = e,
            this.currencyIcon && this.currencyIcon.replaceClassNames([t], [e])
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e, i) {
            l.setMount(e, {
                context: i || "equipped"
            }),
            t.windowTitle.setText(l.getName())
        }
        s.call(this, {
            title: "",
            className: "MountWindow",
            positionInfo: {
                right: 30,
                top: "c",
                width: 280,
                height: 525
            }
        });
        var t = this
          , i = this.windowBody
          , n = window.gui.playerData
          , o = window.dofus.connectionManager
          , l = i.appendChild(new a);
        o.on("ExchangeStartOkMountMessage", function() {
            r.close(t.id)
        }),
        l.on("freeMount", function() {
            r.close(t.id)
        }),
        l.on("renameMount", function(e) {
            t.windowTitle.setText(e)
        }),
        n.on("setMount", this.localizeEvent(function(t) {
            e(t.mountData)
        })),
        o.on("MountDataMessage", this.localizeEvent(function(n) {
            if (t.isMountInfoExpected) {
                t.isMountInfoExpected = !1;
                var o = n.mountData;
                o.mountLocation = "certificate",
                e(o, "inventory"),
                i.delClassNames("spinner"),
                l.show()
            }
        })),
        this.on("open", function(t) {
            if (t = t || {},
            this.isMountInfoExpected)
                return l.hide(),
                void i.addClassNames("spinner");
            var o = t.mountData || n.equippedMount;
            e(o)
        }),
        this.on("close", function() {
            r.close("feed")
        })
    }
    i(895);
    var o = i(26).inherits
      , s = i(402)
      , a = i(661)
      , r = i(22)
      , l = 995;
    o(n, s),
    e.exports = n,
    n.prototype.showPaddockMount = function(e) {
        this.isMountInfoExpected = !0,
        r.open(this.id),
        window.dofus.sendMessage("MountInformationInPaddockRequestMessage", {
            mapRideId: e
        })
    }
    ,
    n.prototype.showCertificateMount = function(e) {
        var t = e.effectsMap[l];
        t && (this.isMountInfoExpected = !0,
        r.open(this.id),
        window.dofus.sendMessage("MountInformationRequestMessage", {
            id: t.mountId,
            time: t.date
        }))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        return g.indexOf(e.objectGID) !== -1 || _.indexOf(e.item.typeId) !== -1
    }
    function o(e, t, i) {
        window.dofus.sendMessage("ObjectFeedMessage", {
            objectUID: i.item.objectUID,
            foodUID: t,
            foodQuantity: e
        })
    }
    function s(e, t, i) {
        window.dofus.sendMessage("MountFeedRequestMessage", {
            mountUid: i.mountUid,
            mountLocation: i.mountLocation,
            mountFoodUid: t,
            quantity: e
        })
    }
    function a() {
        return u("ui.item.confirmFoodLivingItem")
    }
    function r(e, t) {
        return u("ui.item.confirmFoodMount", e, t)
    }
    function l(e) {
        function t(e) {
            return d.indexOf(e.objectGID) !== -1 || p.indexOf(e.item.typeId) !== -1
        }
        function i(e) {
            return !e.livingObjectCategory && e.item.type.id === m
        }
        function l() {
            g.quantity.show(),
            g.quantityLabel.setText(u("ui.common.quantity") + u("ui.common.colon")),
            g.maxBtn.show(),
            g.minBtn.show()
        }
        function c() {
            g.quantity.hide(),
            g.quantityLabel.setText(u("ui.common.quantity") + u("ui.common.colon") + " 1"),
            g.maxBtn.hide(),
            g.minBtn.hide()
        }
        function h(e) {
            var t = {}
              , i = window.gui.playerData.inventory.objects;
            for (var n in i) {
                var o = i[n];
                e(o) && (t[n] = o)
            }
            return t
        }
        f.call(this, {
            title: u("ui.common.feed"),
            className: "FeedWindow",
            positionInfo: {
                right: 315,
                bottom: 30,
                width: 400,
                height: 510
            }
        });
        var d, p, m, g = this, _ = {
            mount: {
                handleInput: function() {},
                setupUI: l,
                filter: n,
                confirmMessage: r,
                confirmAction: s
            },
            pet: {
                handleInput: function(e) {
                    var t = e.item.item;
                    d = t.foodItems,
                    p = t.foodTypes
                },
                setupUI: l,
                filter: t,
                confirmMessage: a,
                confirmAction: o
            },
            livingObject: {
                handleInput: function(e) {
                    m = e.item.livingObjectCategory
                },
                setupUI: c,
                filter: i,
                confirmMessage: a,
                confirmAction: o
            }
        };
        this.storageViewer = e,
        this.storageViewer.registerView(this, {
            manualOpening: !0
        }),
        this.on("slot-tap", function(e) {
            this._selectItem(e.itemInstance)
        }),
        this.once("open", function() {
            this._createDom()
        }),
        this.on("open", function(e) {
            e = e || {},
            this._reset(),
            this.mode = e.mode,
            this.params = e,
            this.setting = _[this.mode],
            this.setting.handleInput(e),
            this.setting.setupUI();
            var t = h(this.setting.filter);
            this.storageViewer.setItemList(t),
            this.storageViewer.addFilters([this.setting.filter])
        }),
        this.on("close", function() {
            this.storageViewer.removeFilter(this.setting.filter)
        }),
        this.on("closed", function() {
            this.storageViewer.unloadContent()
        }),
        this.on("itemQuantity", function(e) {
            this._selectItem(e)
        }),
        this.on("itemRemoved", function() {
            this._reset()
        })
    }
    i(897);
    var c = i(204)
      , u = i(35).getText
      , h = i(26).inherits
      , d = i(701)
      , p = i(208)
      , m = i(318)
      , f = i(402)
      , g = [7903, 7904]
      , _ = [41, 62, 63, 64];
    h(l, f),
    l.prototype.possessFeedItemForMount = function() {
        for (var e = window.gui.playerData.inventory.objects, t = Object.keys(e), i = 0, o = t.length; i < o; i += 1)
            if (n(e[t[i]]))
                return !0;
        return !1
    }
    ,
    l.prototype.possessFeedItemForPet = function(e) {
        for (var t = window.gui.playerData.inventory.objects, i = Object.keys(t), n = e.item.foodItems, o = e.item.foodTypes, s = 0, a = i.length; s < a; s += 1) {
            var r = t[i[s]];
            if (n.indexOf(r.objectGID) !== -1 || o.indexOf(r.item.typeId) !== -1)
                return !0
        }
        return !1
    }
    ,
    l.prototype.possessFeedItemForLivingObject = function(e) {
        for (var t = window.gui.playerData.inventory.objects, i = Object.keys(t), n = e.livingObjectCategory, o = 0, s = i.length; o < s; o += 1) {
            var a = t[i[o]];
            if (!a.livingObjectCategory && a.item.type.id === n)
                return !0
        }
        return !1
    }
    ,
    l.prototype._reset = function() {
        this.placeHolder.setText(u("ui.common.selectItem")),
        this.itemBox.hide(),
        this.confirmBtn.disable(),
        this.quantity.setValue(1),
        this.quantity.disable(),
        this.minBtn.disable(),
        this.maxBtn.disable()
    }
    ,
    l.prototype._createDom = function() {
        var e = this;
        this.viewerBox = this.windowBody.createChild("div", {
            className: "viewer"
        }),
        this.viewerBox.appendChild(this.storageViewer.storageUI);
        var t = this.windowBody.createChild("div", {
            className: "itemBox"
        });
        this.itemBox = t.appendChild(new d({
            showTitle: !0
        })),
        this.placeHolder = new m(t);
        var i = this.windowBody.createChild("div", {
            className: "quantityBox"
        });
        this.quantityLabel = i.createChild("div", {
            className: "label"
        });
        var n = this.quantity = i.appendChild(new p({
            title: u("ui.common.quantity")
        }));
        this.minBtn = i.appendChild(new c({
            text: u("ui.common.minWord"),
            className: ["greenButton", "minButton"]
        },function() {
            n.setValue(1)
        }
        )),
        this.maxBtn = i.appendChild(new c({
            text: u("ui.common.maxWord"),
            className: ["greenButton", "minButton"]
        },function() {
            n.setValue(e.item.quantity)
        }
        )),
        this.confirmBtn = this.windowBody.appendChild(new c({
            text: u("ui.common.validation"),
            className: ["greenButton", "confirm"]
        })),
        this.confirmBtn.on("tap", function() {
            var t = n.getValue();
            window.gui.openConfirmPopup({
                title: u("ui.popup.warning"),
                message: e.setting.confirmMessage(t, e.item.item.nameId),
                cb: function(i) {
                    i && e.setting.confirmAction(t, e.item.objectUID, e.params)
                }
            })
        })
    }
    ,
    l.prototype._selectItem = function(e) {
        this.item = e,
        this.itemBox.displayItem(e),
        this.itemBox.show(),
        this.placeHolder.setText(null ),
        this.confirmBtn.enable(),
        this.quantity.setValue(1),
        this.quantity.maxValue = e.quantity,
        this.quantity.enable(),
        this.minBtn.enable(),
        this.maxBtn.enable()
    }
    ,
    e.exports = l
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            title: r("ui.mount.renameTooltip"),
            className: "MountRenameWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: "400px",
                height: "200px"
            }
        });
        var e = this.windowBody.createChild("div", {
            className: "mainContainer"
        });
        e.createChild("div", {
            className: "text",
            text: r("ui.mount.popupRename")
        });
        var t = this._validate.bind(this);
        this._inputName = e.appendChild(new u({
            className: "inputName",
            attr: {
                type: "text",
                maxlength: d
            }
        },t)),
        this._inputName.on("change", function(e) {
            this.setValue(e.replace(/[^a-zA-Z]+/g, ""))
        }),
        e.appendChild(new a(r("ui.common.ok"),{
            className: "okBtn"
        },t)),
        this.on("open", function(e) {
            this._previousName = e.name,
            this._mountId = e.mountId,
            this._inputName.setValue(e.name),
            e.inputBox && this._positionNextTo(e.inputBox)
        }),
        this.on("opened", function() {
            this._inputName.focus()
        })
    }
    i(899);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204).DofusButton
      , r = i(35).getText
      , l = i(212)
      , c = i(22)
      , u = i(391)
      , h = l.MIN_RIDE_NAME_LEN
      , d = l.MAX_RIDE_NAME_LEN
      , p = 153
      , m = 108;
    o(n, s),
    e.exports = n,
    n.prototype._validate = function() {
        var e = this._inputName.rootElement.value;
        this._inputName.rootElement.value = this._inputName.rootElement.value.replace(/[^a-zA-Z]+/g, ""),
        e && this._previousName !== e && e.length >= h && e.length <= d && window.dofus.sendMessage("MountRenameRequestMessage", {
            name: e,
            mountId: this._mountId
        }),
        c.close(this.id)
    }
    ,
    n.prototype._positionNextTo = function(e) {
        var t = e.rootElement.getBoundingClientRect();
        this.position.x = t.left - p,
        this.position.y = t.top - m
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "FamilyTreeWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: "688px",
                height: "511px"
            }
        });
        var e = this.windowBody.createChild("div", {
            className: "tree"
        });
        this._myMount = e.createChild("div", {
            className: ["mountDisplay", "myMount"]
        }),
        this._myMountName = e.createChild("div", {
            className: "myMountName"
        }),
        this._ancestorBoxes = [];
        for (var t = 3, i = 0, n = 1; n <= t; n += 1)
            for (var o = i; i < Math.pow(2, n) + o; i += 1) {
                var a = ["mountDisplay", "ancestor_" + i, "geneMinus" + n];
                this._ancestorBoxes.push(e.createChild("div", {
                    className: a
                }))
            }
        this.on("open", this._setMount)
    }
    i(901);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(5);
    o(n, s),
    e.exports = n,
    n.prototype._setMount = function(e) {
        var t, i, n = this, o = e.ancestor || [], s = e.name || a("ui.common.noName");
        this.windowTitle.setText(a("ui.mount.ancestors", s)),
        this._myMountName.setText(s);
        var l = ["gfx/mounts/" + e.model + ".png"];
        for (t = 0,
        i = o.length; t < i; t += 1)
            o[t] && l.push("gfx/mounts/" + o[t] + ".png");
        r.preloadImages(l, function(e) {
            for (n._myMount.setStyle("backgroundImage", e[0]),
            t = 0,
            i = n._ancestorBoxes.length; t < i; t += 1) {
                var o = n._ancestorBoxes[t]
                  , s = e[t + 1];
                s ? o.setStyle("backgroundImage", s) : o.setStyle("backgroundImage", "none")
            }
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            var e, t = s.freeOnFailCheckbox.isActivate() && s.freeOnFailCheckbox.isVisible();
            e = s.payingCheckbox.isActivate() ? o.CRAFT_OPTION_NOT_FREE : o.CRAFT_OPTION_NONE;
            var i;
            i = t ? o.CRAFT_OPTION_NOT_FREE_EXCEPT_ON_FAIL : o.CRAFT_OPTION_NONE;
            var n;
            return n = s.noResourceCheckbox.isActivate() ? o.CRAFT_OPTION_RESOURCES_REQUIRED : o.CRAFT_OPTION_NONE,
            e + i + n
        }
        function t() {
            s.jobCrafterDirectorySettings = {
                jobId: s.job.id,
                minSlot: p,
                userDefinedParams: e()
            },
            window.dofus.sendMessage("JobCrafterDirectoryDefineSettingsMessage", {
                settings: s.jobCrafterDirectorySettings
            })
        }
        function i(e) {
            var t = window.gui.playerData.jobs.craftersSettings
              , i = {};
            for (var n in t)
                if (t[n].jobId === e) {
                    i = t[n];
                    break
                }
            var a = i.userDefinedParams
              , r = 0 !== (a & o.CRAFT_OPTION_NOT_FREE)
              , l = 0 !== (a & o.CRAFT_OPTION_NOT_FREE_EXCEPT_ON_FAIL)
              , c = 0 !== (a & o.CRAFT_OPTION_RESOURCES_REQUIRED);
            s.payingCheckbox.toggleActivation(r),
            s.freeOnFailCheckbox.toggleActivation(l),
            s.noResourceCheckbox.toggleActivation(c),
            s.selector.clearContent();
            for (var u = window.gui.playerData.jobs.getMaxSlotsByJobId(s.job.id), h = 1; h <= u; h += 1)
                s.selector.addOption(h, h);
            s.selector.setValue(i.minSlot ? i.minSlot : 1)
        }
        function n() {
            window.dofus.sendMessage("JobAllowMultiCraftRequestSetMessage", {
                enabled: !this.isPublicMode
            })
        }
        a.call(this, {
            className: "JobOptionsWindow",
            title: l("ui.craft.jobOptions"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 400,
                height: 240
            }
        });
        var s = this
          , h = l("ui.craft.enablePublicMode")
          , d = l("ui.craft.disablePublicMode")
          , p = 1;
        this.once("open", function() {
            var e = s.windowBody.createChild("div", {
                className: "container"
            });
            e.createChild("div", {
                text: l("ui.craft.referencingOptions")
            }),
            s.payingCheckbox = e.appendChild(new c(l("ui.craft.notFree"))),
            s.freeOnFailCheckbox = e.appendChild(new c(l("ui.craft.freeIfFailed"))),
            s.freeOnFailCheckbox.addClassNames("freeOnFail"),
            s.noResourceCheckbox = e.appendChild(new c(l("ui.craft.ressourcesNeeded")));
            var i = e.createChild("div", {
                className: "selectorWrapper"
            });
            i.createChild("div", {
                className: "selectorLabel",
                text: l("ui.craft.minItemInCraft")
            }),
            s.selector = i.appendChild(new u),
            s.selector.on("change", function(e) {
                p = Number(e)
            });
            var o = s.windowBody.createChild("div", {
                className: "buttons"
            });
            this.publicButton = o.appendChild(new r(h,{
                className: "publicButton"
            })),
            this.publicButton.on("tap", n),
            this.saveButton = o.appendChild(new r(l("ui.common.save"),{
                className: "saveButton"
            })),
            this.saveButton.on("tap", t),
            window.gui.playerData.jobs.on("jobPublicMode", function(e) {
                s.publicButton.setText(e ? d : h),
                s.publicButton.isPublicMode = e
            })
        }),
        this.on("open", function(e) {
            this.job = window.gui.playerData.jobs.list[e.jobId],
            this.freeOnFailCheckbox.toggleDisplay(!!this.job.info.specializationOfId),
            i(e.jobId)
        })
    }
    i(903);
    var o = i(904)
      , s = i(26).inherits
      , a = i(402)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(448)
      , u = i(393);
    s(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        CRAFT_OPTION_NONE: 0,
        CRAFT_OPTION_NOT_FREE: 1,
        CRAFT_OPTION_NOT_FREE_EXCEPT_ON_FAIL: 2,
        CRAFT_OPTION_RESOURCES_REQUIRED: 4
    }
}
, function(e, t, i) {
    function n() {
        function e(e) {
            n.selectedSpellId = e.spellId,
            n.selectedSpellName = e.spellName
        }
        function t(e, t) {
            var i = new c("div",{
                className: "icon",
                name: "icon"
            });
            i.setStyle("backgroundImage", t),
            h(i, function() {
                return new d({
                    spell: e
                })
            }),
            n.table.addRow({
                icon: i,
                name: e.spell.nameId,
                rank: e.level
            }, {
                spellId: e.id,
                spellName: e.spell.nameId
            })
        }
        function i(e) {
            for (var i = [], o = 0; o < e.length; o++) {
                var s = e[o];
                i.push(s.getIconUri())
            }
            p.preloadImages(i, function(i) {
                for (var o = 0; o < e.length; o++)
                    t(e[o], i[o]);
                e.length > 0 ? (n.table.highlight(0),
                n.validButton.enable()) : n.validButton.disable()
            })
        }
        a.call(this, {
            className: "SpellForgetWindow",
            title: l("ui.spellForget.title"),
            positionInfo: {
                left: "c",
                top: "c",
                width: 400,
                height: 350
            }
        });
        var n = this;
        this.selectedSpellId = null ,
        this.selectedSpellName = null ,
        this.table = this.windowBody.appendChild(new u({
            colIds: ["icon", "name", "rank"],
            colCount: 3,
            highlightable: !0,
            headerContent: ["", l("ui.common.spellName"), l("ui.social.guildRank")],
            onRowTap: e
        })),
        this.validButton = this.windowBody.appendChild(new r(l("ui.common.validation"))),
        this.validButton.on("tap", function() {
            n.selectedSpellId && window.gui.openConfirmPopup({
                title: l("ui.popup.warning"),
                message: l("ui.popup.spellForgetConfirm", n.selectedSpellName),
                cb: function(e) {
                    e && window.dofus.sendMessage("ValidateSpellForgetMessage", {
                        spellId: n.selectedSpellId
                    })
                }
            })
        }),
        this.on("open", function() {
            this.table.clearContent();
            var e = window.gui.playerData.characters.mainCharacter.spellData.spells
              , t = [];
            for (var n in e) {
                var o = e[n];
                o.level > 1 && t.push(o)
            }
            i(t)
        }),
        this.on("close", function() {
            this.selectedSpellId = null ,
            this.selectedSpellName = null
        }),
        window.gui.on("SpellForgetUIMessage", function(e) {
            e.open ? s.openDialog("spellForget") : s.close("spellForget")
        })
    }
    i(906);
    var o = i(26).inherits
      , s = i(22)
      , a = i(402)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(190)
      , u = i(485)
      , h = i(206).addTooltip
      , d = i(576)
      , p = i(5);
    o(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i, n, o) {
        var s = new _({
            className: [e, "blackButton"],
            text: t,
            tooltip: i
        },n);
        return o && (t && s.createChild("div", {
            className: "btnText",
            text: t
        }),
        s.createChild("div", {
            className: "btnIcon"
        })),
        s
    }
    function o(e, t, i) {
        F.call(this, "div", {
            className: e
        }),
        this.myWindow = t,
        D(this),
        this.on("tap", i)
    }
    function s() {
        B.call(this, {
            title: "",
            noCloseButton: !0,
            className: "CharacterCreationWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: "85%",
                maxWidth: 950,
                height: "100%",
                isFullScreen: !0
            }
        }),
        this._reset(),
        this.on("open", function() {
            this.addClassNames(["disabled", "spinner"])
        }),
        this.on("opened", this._initialize)
    }
    function a(e, t) {
        for (var i in e) {
            var n = e[i];
            if (~~n.skins === t)
                return n.order
        }
        return 0
    }
    function r() {
        var e = this
          , t = e;
        E.getItems([t.itemId], function(e, i) {
            return e ? console.error(e) : void L.showNotification(T("tablet.charCrea.potionNeeded", i[0].getName()), t)
        })
    }
    function l() {
        var e = this.myWindow;
        if (e.breedId !== this.breedId)
            return Date.now() - e.lastRendering < te ? console.warn("Ignoring hammered button") : void e._selectBreed(this.breedId)
    }
    function c() {
        this.myWindow._selectHead(this.headOrder, !0)
    }
    function u(e) {
        var t = e.substring(1, e.length - 1).split("|");
        return {
            bone: t[0],
            skin: t[1],
            color: t[2],
            scale: t[3]
        }
    }
    function h() {
        window.clearInterval(de),
        de = null ,
        he.setColor(oe, se),
        he.myWindow._updateSprite()
    }
    function d(e) {
        e && (de && h(),
        he = e,
        oe = e.getColor(),
        se = e.isCustomColor(),
        ce = 0,
        ue = Date.now(),
        de = window.setInterval(d, ae));
        var t = le[ce % le.length]
          , i = {
            rgb: t,
            hex: C.colorArrayToHexa(t)
        };
        he.setColor(i),
        he.myWindow._updateSprite(),
        ce++,
        Date.now() - ue >= re && h()
    }
    function p() {
        var e = this.myWindow;
        e._selectColor(this.id),
        d(e.selectedColorBtn)
    }
    function m(e, t) {
        var i = C.parseIndexedColor(t).color
          , n = [i.r, i.g, i.b];
        e.setColor({
            rgb: n,
            hex: C.colorArrayToHexa(n)
        })
    }
    i(908);
    var f = i(5)
      , g = i(6)
      , _ = i(204)
      , v = i(178)
      , y = i(238)
      , w = i(442)
      , b = i(515)
      , C = i(247)
      , I = i(242)
      , T = i(35).getText
      , S = i(26).inherits
      , A = i(391)
      , E = i(323)
      , x = i(909)
      , M = i(212)
      , N = i(302)
      , R = i(210).showProgressively
      , O = i(36)
      , P = i(509)
      , D = i(32)
      , L = i(206)
      , B = i(402)
      , k = i(22)
      , F = i(190)
      , H = [2, 1, 2, 1, 3, 2, 1, 1, 1, 3, 1, 2, 3, 2, 2]
      , G = 13518
      , U = 10860
      , j = 10861
      , q = 10862
      , W = .6
      , V = {
        1: [174, 252],
        2: [173, 252],
        3: [197, 252],
        4: [218, 254],
        5: [172, 253],
        6: [179, 255],
        7: [189, 253],
        8: [194, 254],
        9: [195, 252],
        10: [210, 253],
        11: [200, 256],
        12: [174, 252],
        13: [238, 239],
        14: [213, 208],
        15: [259, 239]
    }
      , z = [200, 252]
      , Y = 0
      , X = 1
      , Q = 2
      , K = 3
      , J = 1e3 / 24
      , Z = 0
      , $ = 1
      , ee = 8
      , te = 500
      , ie = .85
      , ne = 5;
    S(o, F),
    o.prototype.setSelected = function(e) {
        e ? this.addClassNames("selected") : this.delClassNames("selected")
    }
    ,
    S(s, B),
    e.exports = s,
    s.prototype._reset = function() {
        this.step = Y,
        this.relookingParams = null ,
        this.allBreeds = null ,
        this.numBreeds = 0,
        this.headsMap = null ,
        this.loadedHeads = [],
        this.lastRendering = 0,
        this.breedBtns = [],
        this.headContainers = [],
        this.nameInput = null ,
        this.currentIllustration = null ,
        this.breedIllustration = this.breedIllustrationFade = null ,
        this.breedDescription = null ,
        this.breedName = null ,
        this.breedStory = null ,
        this.breedSelector = null ,
        this.headSelector = null ,
        this.colorPicker = null ,
        this.colorButtons = null ,
        this.selectedColor = null ,
        this._assetUrlCache = {},
        this.spriteStatus = {},
        this.breedId = 1,
        this.sex = Z,
        this.cosmeticId = 1,
        this.headOrder = 0
    }
    ,
    s.prototype.freeContent = function() {
        document.activeElement.blur(),
        this.characterDisplay && this.characterDisplay.release(),
        this.characterDisplay = null ,
        this.windowBody.clearContent(),
        this.centeredContent.clearContent(),
        this._reset()
    }
    ,
    s.prototype._initialize = function(e) {
        if (!this.allBreeds) {
            var t = this;
            return void this._createAll(function(i) {
                return i ? console.error("characterCreation: initialize error", i) : (t._initialize(e),
                void t._loadHeadImages())
            })
        }
        this.relookingParams = e && e.relookingParams,
        this.relookingParams ? this._initCharacterForRelooking() : this._initRandomCharacter(),
        this.delClassNames(["disabled", "spinner"])
    }
    ,
    s.prototype._initRandomCharacter = function() {
        this._stepLayoutSetup(X),
        this.nameInput.setValue(""),
        this.sex = Math.random() > .45 ? $ : Z,
        this.breedSexTabs.openTab(this.sex),
        this.headSexTabs.openTab(this.sex);
        var e, t = Math.floor(Math.random() * this.numEasyBreeds), i = 0;
        for (e = 1; e <= this.numBreeds; e++)
            if (!(this.allBreeds[e].complexity > 1)) {
                if (i === t)
                    break;
                i++
            }
        var n = Math.floor(Math.random() * ee);
        this._selectBreed(e, n)
    }
    ,
    s.prototype._initCharacterForRelooking = function() {
        var e, t, i = this.relookingParams;
        i.canRename ? (e = T("ui.connection.rename"),
        t = T("ui.charcrea.titleRename")) : i.canRecolor ? (e = T("ui.connection.recolor"),
        t = T("ui.charcrea.titleRecolor")) : i.canReface && (e = T("ui.connection.relook"),
        t = T("ui.charcrea.titleRelook")),
        e && (window.gui.openSimplePopup(e, T("ui.popup.warning")),
        this.pageTitle.setText(t));
        var n = i.characterToRelook
          , o = I.getLookWithoutMount(n.entityLook)
          , s = a(this.headsMap, o.skins[1]);
        this.nameInput.setValue(n.name),
        this.sex = n.sex ? $ : Z,
        this.headSexTabs.openTab(this.sex),
        this._stepLayoutSetup(Q),
        this._selectBreed(n.breed, s, o.indexedColors),
        this.relookingParams.canRecolor && this._selectColor(0)
    }
    ,
    s.prototype._createAll = function(e) {
        this.allBreeds = window.gui.databases.Breeds,
        this.numBreeds = Object.keys(this.allBreeds).length,
        this.numEasyBreeds = 0;
        for (var t = 1; t <= this.numBreeds; t++) {
            var i = H[t - 1];
            this.allBreeds[t].complexity = i,
            1 === i && this.numEasyBreeds++
        }
        this._leftSideSetup(),
        this._centerSetup(),
        this._rightSideSetup(),
        this._createBreedElements(),
        this._createHeadElements(),
        this._createNavButtons(),
        this._stepLayoutSetup(X),
        this._listenersSetup(),
        this._loadAsyncData(e)
    }
    ,
    s.prototype._leftSideSetup = function() {
        this.breedIllustration = this.windowBody.createChild("div", {
            className: "breedIllustration"
        }),
        this.breedIllustrationFade = this.windowBody.createChild("div", {
            className: "breedIllustration"
        })
    }
    ,
    s.prototype._centerSetup = function() {
        this.centeredContent || (this.centeredContent = this.createChild("div"));
        var e = this.centeredContent;
        this._createTopLabel(e),
        this._createNameSelector(e),
        this.breedSelector = this._createSelector(e, "breedSexTabs"),
        this.headSelector = this._createSelector(e, "headSexTabs", !0),
        this._createBreedDescription(e),
        this._setupColorTool(e)
    }
    ,
    s.prototype._rightSideSetup = function() {
        var e = this.windowBody.createChild("div", {
            className: "rightBar"
        });
        this._setupCharacterOnIsland(e)
    }
    ,
    s.prototype._spreadVerticaly = function(e, t) {
        for (var i = 0, n = 0; n < e.length; n++)
            i += e[n].rootElement.clientHeight;
        var o = this.windowBody.rootElement.clientHeight - i;
        for (n = 0; n < e.length; n++) {
            var s = Math.round(o * t[n] / 100);
            e[n].setStyle("marginBottom", Math.max(s, ne) + "px")
        }
    }
    ,
    s.prototype._stepLayoutSetup = function(e) {
        this.step = e;
        var t = e === Q
          , i = e === X;
        this.breedIllustration.toggleDisplay(i || t),
        this.characterOnIsland.toggleDisplay(i || t),
        this.breedSexTabs.toggleDisplay(i),
        this.breedDescription.toggleDisplay(i),
        this.nextBtn.toggleDisplay(i),
        this.nameSelector.toggleDisplay(t),
        this.createBtn.toggleDisplay(t),
        this.headSexTabs.toggleDisplay(t),
        this.colorTool.toggleDisplay(t),
        i ? (this._spreadVerticaly([this.topLabel, this.breedSexTabs, this.breedDescription], [15, 15, 50]),
        this.backButton.setText(T("ui.common.cancel"))) : t && (this._spreadVerticaly([this.topLabel, this.headSexTabs, this.nameSelector, this.colorTool], [5, 5, 5, 85]),
        this._selectCurrentHeads(),
        this.relookingParams ? (this._allowElement(this.headSexTabs, !1),
        this._allowElement(this.nameSelector, this.relookingParams.canRename, U),
        this._allowElement(this.colorTool, this.relookingParams.canRecolor, j),
        this.createBtn.setText(T("ui.common.validation")),
        this.backButton.setText(T("ui.common.cancel"))) : (this._selectColor(0, !0),
        this.backButton.setText(T("ui.common.back"))))
    }
    ,
    s.prototype._allowElement = function(e, t, i) {
        if (e.toggleTabAvailability) {
            var n = this.sex === Z
              , o = e.header.getChildren()
              , s = o[n ? $ : Z]
              , a = o[this.sex]
              , l = e.content;
            return this._allowElement(s, !1, q),
            this._allowElement(a, this.relookingParams.canReface),
            this._allowElement(l, this.relookingParams.canReface, G),
            e.toggleTabAvailability(Z, n),
            void e.toggleTabAvailability($, !n)
        }
        if (e.setStyle("opacity", t ? 1 : W),
        !t) {
            var c = e.appendChild(new F("div",{
                className: "disabledFeature"
            }));
            i && (c.itemId = i,
            D(c),
            c.on("tap", r))
        }
    }
    ,
    s.prototype._next = function() {
        this._stepLayoutSetup(Q)
    }
    ,
    s.prototype._back = function() {
        this.step === X || this.relookingParams ? (k.close(this.id),
        w.backToSelection()) : this._stepLayoutSetup(X)
    }
    ,
    s.prototype._createSelector = function(e, t, i) {
        var n = {};
        n.females = new F("div",{
            className: "females"
        }),
        n.males = new F("div",{
            className: "males"
        });
        var o = e.appendChild(new P({
            className: ["sexTabs", t],
            tabClassName: "mySwipeTabBtn"
        }));
        i && o.hide(),
        o.addTab("", n.males, Z),
        o.addTab("", n.females, $);
        var s = this;
        return o.on("openTab", function(e) {
            s._updateSex(e)
        }),
        this[t] = o,
        n
    }
    ,
    s.prototype._createBreedButton = function(e, t) {
        var i = new o("breedSelectionButton",this,l);
        i.breedId = e.id;
        var n = t === Z ? this.breedSelector.males : this.breedSelector.females;
        return n = n.getChild(e.complexity),
        n.appendChild(i),
        i
    }
    ,
    s.prototype._createHeadContainer = function(e, t) {
        var i = new F("div",{
            className: "headContainer",
            hidden: !0
        })
          , n = 1 + (e - 1) * ee * 2 + t * ee;
        i.buttons = [];
        for (var s = 0; s < ee; s++) {
            var a = new o("headSelectionButton",this,c);
            i.appendChild(a),
            i.buttons.push(a),
            a.headOrder = s,
            a.cosmeticId = n + s,
            a.gender = t
        }
        var r = t === Z ? this.headSelector.males : this.headSelector.females;
        return r.appendChild(i),
        i
    }
    ,
    s.prototype._createBreedElements = function() {
        for (var e = 1; e <= 3; e++)
            this.breedSelector.males.createChild("div", {
                className: "complexityLevel",
                name: e
            }),
            this.breedSelector.females.createChild("div", {
                className: "complexityLevel",
                name: e
            });
        for (var t = 0; t < this.numBreeds; t++) {
            var i = t + 1
              , n = this.allBreeds[i];
            this.breedBtns[t] = this._createBreedButton(n, Z),
            this.breedBtns[t + this.numBreeds] = this._createBreedButton(n, $)
        }
    }
    ,
    s.prototype._createHeadElements = function() {
        for (var e = 1; e <= this.numBreeds; e++)
            this.headContainers[e] = [this._createHeadContainer(e, Z), this._createHeadContainer(e, $)]
    }
    ,
    s.prototype._loadAsyncData = function(e) {
        var t = this;
        O.getAllDataMap("Heads", function(i, n) {
            if (i)
                return e(i);
            t.headsMap = n;
            for (var o = [], s = 1; s <= t.numBreeds; s++) {
                var a = ("0" + s).slice(-2);
                o.push("gfx/classes/CreaPerso_btn_0" + a + ".png"),
                o.push("gfx/classes/CreaPerso_btn_1" + a + ".png")
            }
            f.preloadImages(o, function(i) {
                for (var n = 0; n < t.numBreeds; n++) {
                    var o = t.breedBtns[n];
                    o.setStyles({
                        backgroundImage: i[2 * n + Z]
                    }),
                    o = t.breedBtns[n + t.numBreeds],
                    o.setStyles({
                        backgroundImage: i[2 * n + $]
                    })
                }
                e()
            })
        })
    }
    ,
    s.prototype._loadHeadImages = function(e, t) {
        if (this.loadedHeads[e])
            return t && t();
        var i, n;
        e ? (i = 1 + (e - 1) * ee * 2,
        n = i + 2 * ee - 1,
        this.loadedHeads[e] = !0) : (i = 1,
        n = this.numBreeds * ee * 2);
        for (var o = this.headsMap, s = [], a = i; a <= n; a++)
            s.push("gfx/cosmetics/" + o[~~a].assetId + ".png");
        var r = this;
        f.preloadImages(s, function(s) {
            if (!e)
                for (var a = 1; a <= r.numBreeds; a++)
                    r.loadedHeads[a] = !0;
            for (var l = 0, c = i; c <= n; c++) {
                var u = o[~~c]
                  , h = r.headContainers[u.breed][u.gender].buttons[u.order];
                h.setStyle("backgroundImage", s[l++])
            }
            t && t()
        })
    }
    ,
    s.prototype._listenersSetup = function() {
        var e = this;
        window.gui.on("CharacterCreationResultMessage", function(t) {
            if (t.result === v.OK)
                return w.confirmNewCharacterCreation(),
                k.close(e.id);
            var i;
            switch (t.result) {
            case v.ERR_INVALID_NAME:
                i = T("ui.charcrea.nameRules");
                break;
            case v.ERR_NAME_ALREADY_EXISTS:
                i = T("ui.popup.charcrea.nameAlreadyExist");
                break;
            case v.ERR_TOO_MANY_CHARACTERS:
                i = T("ui.popup.charcrea.tooManyCharacters");
                break;
            case v.ERR_NOT_ALLOWED:
                i = T("ui.popup.charcrea.notSubscriber");
                break;
            case v.ERR_RESTRICED_ZONE:
                i = T("ui.charSel.deletionErrorUnsecureMode");
                break;
            default:
                i = T("ui.popup.charcrea.noReason")
            }
            L.showNotification(i, e.createBtn),
            e.delClassNames(["disabled", "spinner"])
        }),
        window.gui.on("CharacterNameSuggestionSuccessMessage", function(t) {
            e.nameInput.setValue(t.suggestion)
        })
    }
    ,
    s.prototype._buildColorsArray = function() {
        for (var e = new Array(g.CHARACTER_COLORS), t = 0; t < g.CHARACTER_COLORS; t++) {
            var i = this.colorButtons[t].getColor();
            e[t] = C.getIndexedColor(t + 1, i.rgb[0], i.rgb[1], i.rgb[2])
        }
        return e
    }
    ,
    s.prototype._selectCurrentHeads = function() {
        if (this.headSexTabs.isVisible()) {
            for (var e = 1, t = this.numBreeds; e <= t; e++)
                this.headContainers[e][Z].hide(),
                this.headContainers[e][$].hide();
            this.headContainers[this.breedId][Z].show(),
            this.headContainers[this.breedId][$].show()
        }
    }
    ,
    s.prototype._updateSprite = function(e) {
        var t = this.allBreeds[this.breedId]
          , i = u(t[(this.sex === $ ? "female" : "male") + "Look"])
          , n = i.skin
          , o = i.scale
          , s = this.headsMap[this.cosmeticId].skins
          , a = this._buildColorsArray().join("#");
        this.spriteStatus.bodySkin === n && this.spriteStatus.headSkin === s && this.spriteStatus.colorsHash === a && this.spriteStatus.orientation === this.orientation && this.spriteStatus.scale === o || (this.spriteStatus.bodySkin = n,
        this.spriteStatus.headSkin = s,
        this.spriteStatus.colorsHash = a,
        this.spriteStatus.orientation = this.orientation,
        this.spriteStatus.scale = o,
        this._drawCharacter(e))
    }
    ,
    s.prototype._getAsset = function(e, t) {
        var i = this;
        return this._assetUrlCache[e] ? t(this._assetUrlCache[e]) : void f.preloadImage(e, function(n) {
            i._assetUrlCache[e] = n,
            t(n)
        })
    }
    ,
    s.prototype._updateBreedIllustration = function() {
        if (this.breedIllustration.isVisible()) {
            var e = "gfx/illusUi/illus_classe/artwork_" + this.breedId + this.sex + ".png";
            if (e !== this.currentIllustration) {
                this.currentIllustration = e;
                var t = this.breedIllustration;
                this.breedIllustration = this.breedIllustrationFade,
                this.breedIllustrationFade = t,
                R(null , 500, null , this.breedIllustrationFade),
                this.breedIllustration.addClassNames("spinner");
                var i = this;
                this._getAsset(e, function(e) {
                    i.breedIllustration && (i.breedIllustration.setStyle("backgroundImage", e),
                    i.breedIllustration.delClassNames("spinner"),
                    R(i.breedIllustration, 500))
                })
            }
        }
    }
    ,
    s.prototype._updateBreedIsland = function() {
        var e = this;
        this._getAsset("gfx/bases/base_" + this.breedId + ".png", function(t) {
            if (e.characterDisplay) {
                var i = V[e.breedId];
                i || (console.warn("Missing center tile data for breed:", e.breedId),
                i = z);
                var n = e.characterDisplay.rootElement.getBoundingClientRect()
                  , o = .5 * n.width
                  , s = ie * n.height;
                e.islandImage.setStyles({
                    backgroundImage: t,
                    left: o - i[0] + "px",
                    top: e.characterDisplay.rootElement.offsetTop + s - i[1] + "px"
                }),
                R(e.islandImage),
                R(e.rotationLeft),
                R(e.rotationRight)
            }
        })
    }
    ,
    s.prototype._updateBreedDescription = function() {
        var e = this.allBreeds[this.breedId];
        this.breedName.setText(e.longNameId),
        this.breedStory.content.setText(e.gameplayDescriptionId),
        this.breedStory.refresh(),
        this.breedStory.goToTop(),
        this.breedComplexity.replaceClassNames(["level1", "level2", "level3"], ["level" + e.complexity])
    }
    ,
    s.prototype._toggleBreedBtn = function(e, t) {
        this.breedBtns[e - 1].setSelected(t),
        this.breedBtns[e - 1 + this.numBreeds].setSelected(t)
    }
    ,
    s.prototype._selectBreed = function(e, t, i) {
        this._toggleBreedBtn(this.breedId, !1),
        this._toggleBreedBtn(e, !0),
        this.breedId = e,
        this._updateBreedIllustration(),
        this.characterDisplay.setStyle("opacity", 0),
        this._updateBreedIsland(),
        this._updateBreedDescription(),
        this._selectCurrentHeads(),
        this._loadHeadImages(e),
        this._selectHead(void 0 !== t ? t : this.headOrder),
        i ? this._loadColors(i) : this._resetColors(),
        this.orientation = K,
        this._updateSprite(!0)
    }
    ,
    s.prototype._updateSex = function(e) {
        this.sex !== e && (this.sex = e,
        this._updateBreedIllustration(),
        this._selectCurrentHeads(),
        this._selectHead(this.headOrder),
        this.headSexTabs.openTab(e),
        this.breedSexTabs.openTab(e),
        this._resetColors(!0),
        this._updateSprite(!0))
    }
    ,
    s.prototype._selectHead = function(e, t) {
        var i = this.headContainers[this.breedId][this.sex].buttons[e];
        if (i.cosmeticId !== this.cosmeticId) {
            this.cosmeticId = i.cosmeticId,
            this.headOrder = e;
            for (var n = this.headContainers[this.breedId][this.sex].buttons, o = 0; o < n.length; o++)
                n[o].setSelected(n[o] === i);
            t && this._updateSprite(!1)
        }
    }
    ;
    var oe, se, ae = 100, re = 500, le = [[255, 144, 0], [255, 228, 0]], ce = 0, ue = 0, he = null , de = null ;
    s.prototype._setupColorTool = function(e) {
        var t = this.colorTool = e.createChild("div", {
            className: "colorTool",
            hidden: !0
        });
        t.setStyle("opacity", 0),
        t.show();
        var i = this.colorSelector = t.createChild("div", {
            className: "colorSelector"
        })
          , o = i.createChild("div", {
            className: "colorButtons"
        })
          , s = o.createChild("div", {
            className: "buttonBox"
        });
        this.colorButtons = new Array(g.CHARACTER_COLORS + 1);
        for (var a = 0; a <= g.CHARACTER_COLORS; a++)
            this.colorButtons[a] = s.appendChild(new x(this,a,p,{
                active: a < g.CHARACTER_COLORS
            }));
        this.selectedColorBtn = null ;
        var r = i.createChild("div", {
            className: "picker"
        })
          , l = this.pickerRect = r.rootElement.getBoundingClientRect();
        this.colorPicker = r.appendChild(new b),
        this.colorPicker.updateDimensions(l.width, l.height),
        t.hide(),
        t.setStyle("opacity", 1);
        var c = this;
        this.colorPicker.on("newColor", function(e) {
            if (c.selectedColorBtn) {
                c.selectedColorBtn.setColor(e, !0);
                var t = Date.now();
                (!c.colorPicker.lastUpdate || t - c.colorPicker.lastUpdate > J) && (c.colorPicker.lastUpdate = t,
                c._updateSprite())
            }
        }),
        this.colorPicker.on("colorChanged", function(e) {
            c.selectedColorBtn && (c.selectedColorBtn.setColor(e, !0),
            c._updateSprite())
        });
        var u = this.colorPickerFooter = t.createChild("div", {
            className: "colorPickerFooter"
        });
        u.appendChild(new n("resetColorBtn","",T("tablet.charCrea.resetCurrentColor"),function() {
            return c.selectedColorBtn && c.selectedColorBtn.getColor() ? (c._resetColorButton(c.selectedColorBtn),
            c._selectColor(c.selectedColorBtn.id, !0),
            void c._updateSprite()) : L.showNotification(T("tablet.charCrea.resetCurrentColor"), this)
        }
        ,(!0))),
        u.appendChild(new n("randomColorBtn",T("tablet.charCrea.randomColors"),T("tablet.charCrea.randomColorsTip"),function() {
            for (var e = 0; e < g.CHARACTER_COLORS; e++)
                c.colorButtons[e].randomize();
            c._selectColor(0, !0),
            c._updateSprite()
        }
        ,(!0))),
        u.appendChild(new n("resetAllColorBtn",T("tablet.charCrea.resetAll"),T("tablet.charCrea.resetAllTip"),function() {
            c._resetColors(),
            c._updateSprite()
        }
        ))
    }
    ,
    s.prototype._createTopLabel = function(e) {
        var t = this.topLabel = e.createChild("div", {
            className: "topLabel"
        });
        t.createChild("div", {
            className: "topLabelBackground"
        }),
        t.createChild("div", {
            className: "fioritureRococo"
        }),
        this.pageTitle = t.createChild("div", {
            className: "topLabelText",
            text: T("ui.charcrea.title")
        })
    }
    ,
    s.prototype._createBreedDescription = function(e) {
        this.breedDescription = e.createChild("div", {
            className: "breedDescription"
        });
        var t = this.breedDescription.createChild("div", {
            className: "descriptionZone"
        })
          , i = t.createChild("div", {
            className: "descriptionText"
        });
        this.breedName = i.createChild("div", {
            className: "breedName",
            text: "."
        }),
        this.breedName.setText(""),
        this.breedStory = i.appendChild(new N({
            className: "breedStory"
        },{
            showHintArrows: !0
        }));
        var o = i.createChild("div", {
            className: "footer"
        })
          , s = this.breedComplexity = o.createChild("div", {
            className: "breedComplexity"
        });
        s.createChild("div", {
            className: "label",
            text: T("tablet.charCrea.difficulty") + T("ui.common.colon")
        }),
        s.createChild("div", {
            className: ["sword", "sword1"]
        }),
        s.createChild("div", {
            className: ["sword", "sword2"]
        }),
        s.createChild("div", {
            className: ["sword", "sword3"]
        });
        var a = this;
        this.moreInfoBtn = o.appendChild(new n("moreInfoBtn",T("ui.charcrea.more"),"",function() {
            k.open("breedDetail", {
                breedData: a.allBreeds[a.breedId]
            })
        }
        ));
        var r = this.rootElement.clientHeight - this.breedDescription.rootElement.offsetTop - 2 * this.breedStory.rootElement.offsetTop;
        this.breedStory.setStyle("maxHeight", r + "px")
    }
    ,
    s.prototype._createNameSelector = function(e) {
        var t = this.nameSelector = e.createChild("div", {
            className: "nameSelector",
            hidden: !0
        });
        this.nameInput = t.appendChild(new A({
            className: "nameInput",
            attr: {
                type: "text",
                id: "nameInput",
                maxlength: M.MAX_PLAYER_NAME_LEN
            }
        },function(e) {
            e.blur()
        }
        )),
        this.nameInput.setPlaceholder(T("ui.popup.charcrea.noName")),
        t.appendChild(new n("randomiseBtn","",T("tablet.charCrea.randomNameTip"),function() {
            window.dofus.sendMessage("CharacterNameSuggestionRequestMessage")
        }
        ,(!0)))
    }
    ,
    s.prototype._createRotationButton = function(e, t) {
        var i = this
          , n = this.characterOnIsland.createChild("div", {
            className: e,
            hidden: !0
        })
          , o = n.appendChild(new _({
            className: "shadow",
            repeatDelay: 100
        },function() {
            i.orientation = i.characterDisplay.rotateCharacter(t)
        }
        ));
        return o.createChild("div", {
            className: "arrow"
        }),
        n
    }
    ,
    s.prototype._setupCharacterOnIsland = function(e) {
        var t = this.characterOnIsland = e.createChild("div", {
            className: "characterOnIsland"
        });
        this.islandImage = t.createChild("div", {
            className: "islandImage"
        }),
        this.characterDisplay = t.appendChild(new y({
            scale: 2
        })),
        this.rotationRight = this._createRotationButton("rotationRight", !0),
        this.rotationLeft = this._createRotationButton("rotationLeft", !1)
    }
    ,
    s.prototype._createNavButtons = function() {
        var e = this;
        this.backButton = this.windowBody.appendChild(new n("cancelBtn","","",function() {
            e._back()
        }
        )),
        this.nextBtn = this.characterOnIsland.appendChild(new _({
            text: T("tablet.charCrea.next"),
            className: ["greenButton", "nextBtn"]
        },function() {
            e._next()
        }
        )),
        this.createBtn = this.characterOnIsland.appendChild(new _({
            text: T("ui.charcrea.create"),
            className: ["greenButton", "createButton"]
        },function() {
            e._createCharacter()
        }
        ))
    }
    ,
    s.prototype._createCharacter = function() {
        var e = this.nameInput.getValue()
          , t = e.length;
        if (0 === t)
            return L.showNotification(T("ui.popup.charcrea.noName"), this.createBtn);
        if (t < M.MIN_PLAYER_NAME_LEN || t > M.MAX_PLAYER_NAME_LEN)
            return L.showNotification(T("ui.charcrea.nameRules"), this.createBtn);
        var i = {
            name: e,
            breed: this.breedId,
            sex: this.sex === $,
            colors: this._buildColorsArray(),
            cosmeticId: this.cosmeticId
        };
        this.relookingParams ? (i.headSkin = this.spriteStatus.headSkin,
        w.confirmCharacterRelooking(i)) : (this.addClassNames(["disabled", "spinner"]),
        document.activeElement.blur(),
        window.dofus.sendMessage("CharacterCreationRequestMessage", i))
    }
    ,
    s.prototype._buildEntityLook = function() {
        return {
            bonesId: 1,
            indexedColors: this._buildColorsArray(),
            scales: [this.spriteStatus.scale],
            skins: [this.spriteStatus.bodySkin, this.spriteStatus.headSkin],
            subentities: []
        }
    }
    ,
    s.prototype._drawCharacter = function(e) {
        this.lastRendering = Date.now();
        var t = this;
        this.characterDisplay.setLook(this._buildEntityLook(), {
            boneType: "characters/",
            skinType: "characters/",
            direction: this.orientation
        }, function() {
            e && R(t.characterDisplay, 300, 50)
        })
    }
    ,
    s.prototype._selectColor = function(e, t) {
        var i = this.colorButtons[e];
        (i !== this.selectedColorBtn || t) && (this.selectedColorBtn && this.selectedColorBtn.deselect(),
        this.selectedColorBtn = i,
        i.select(),
        this.colorPicker.setCurrentColor(i.getColor().rgb))
    }
    ,
    s.prototype._resetColorButton = function(e) {
        var t = (this.sex === $ ? "female" : "male") + "Colors"
          , i = this.allBreeds[this.breedId][t][e.id];
        m(e, i)
    }
    ,
    s.prototype._resetColors = function(e) {
        for (var t = 0; t < g.CHARACTER_COLORS; t++) {
            var i = this.colorButtons[t];
            e && i.isCustomColor() || this._resetColorButton(i)
        }
        this._selectColor(0, !0)
    }
    ,
    s.prototype._loadColors = function(e) {
        for (var t = 0; t < g.CHARACTER_COLORS; t++)
            m(this.colorButtons[t], e[t])
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i, n) {
        n = n || {},
        this.myWindow = e,
        this.id = t,
        this.active = n.active,
        this.selected = !1,
        this.currentColor = null ,
        this.isCustom = !1,
        a.call(this, "div", {
            className: "plusColorButton"
        }),
        r(this),
        this.active && i && "function" == typeof i ? this.on("tap", i) : this.addClassNames("inactive"),
        this.plainColor = this.createChild("div", {
            className: "plainColor"
        })
    }
    i(910);
    var o = i(247)
      , s = i(26).inherits
      , a = i(190)
      , r = i(32);
    s(n, a),
    e.exports = n,
    n.prototype.select = function() {
        this.addClassNames("selected"),
        this.selected = !0
    }
    ,
    n.prototype.deselect = function() {
        this.delClassNames("selected"),
        this.selected = !1
    }
    ,
    n.prototype.isCustomColor = function() {
        return this.isCustom
    }
    ,
    n.prototype.setColor = function(e, t) {
        this.isCustom = t,
        this.currentColor = e,
        e ? (this.plainColor.setStyle("display", "block"),
        this.plainColor.setStyle("background", e.hex),
        this.plainColor.setStyle("background", "-moz-linear-gradient(top,  #ffffff 0%, " + e.hex + " 14%, " + e.hex + " 85%, " + e.hex + " 85%, #110f0d 100%)"),
        this.plainColor.setStyle("background", "-webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(14%," + e.hex + "), color-stop(85%," + e.hex + "), color-stop(85%," + e.hex + "), color-stop(100%,#110f0d))"),
        this.plainColor.setStyle("background", "-webkit-linear-gradient(top,  #ffffff 0%," + e.hex + " 14%," + e.hex + " 85%," + e.hex + " 85%,#110f0d 100%)"),
        this.plainColor.setStyle("background", "-o-linear-gradient(top,  #ffffff 0%," + e.hex + " 14%," + e.hex + " 85%," + e.hex + " 85%,#110f0d 100%)"),
        this.plainColor.setStyle("background", "-ms-linear-gradient(top,  #ffffff 0%," + e.hex + " 14%," + e.hex + " 85%," + e.hex + " 85%,#110f0d 100%)"),
        this.plainColor.setStyle("background", "linear-gradient(to bottom,  #ffffff 0%," + e.hex + " 14%," + e.hex + " 85%," + e.hex + " 85%,#110f0d 100%)")) : this.plainColor.setStyle("display", "none")
    }
    ,
    n.prototype.getColor = function() {
        return this.currentColor
    }
    ,
    n.prototype.randomize = function() {
        var e = Math.floor(255 * Math.random())
          , t = Math.floor(255 * Math.random())
          , i = Math.floor(255 * Math.random())
          , n = [e, t, i];
        n = {
            rgb: n,
            hex: o.colorArrayToHexa(n)
        },
        this.setColor(n, !0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            e = e || {},
            f._totalFailure = 0,
            f._totalSuccess = 0,
            f._done = 0;
            var t = g.playerData.jobs
              , i = []
              , n = f._mySlotElems.getGivenIngredientsInfo()
              , o = f._targetSlotElems.getGivenIngredientsInfo();
            n.length > 0 && o.length <= 0 && (i = n,
            i.push(f._mySlotElems.getRuneSignatureInfo()));
            var s = t.checkRecipe(f._skillId);
            if (f._skillId === t.SKILLID_DECRAFT)
                for (var a = 0; a < i.length; a += 1) {
                    var r = i[a];
                    r.GID && (s.itemToCraft.ingredientIds.push(r.GID),
                    s.itemToCraft.quantities.push(r.quantity))
                }
            f._craftResultBox.checkRecipe(i, s),
            s.isRecipeKnown && !e.keepResultVisible ? (f._itemResult.hide(),
            f._craftResultBox._clearProgress(),
            f._recipeList.highlightRecipe(s.itemToCraft.resultId)) : f._recipeList.highlightRecipe(null )
        }
        function i(e) {
            f._totalQty = e.count,
            f._craftResultBox.setQty(f._totalQty),
            f._isInAutoCraft = f._totalQty > 1
        }
        function n(e) {
            e = e || {
                count: 0
            };
            var t = e.count || 0;
            f._done = f._totalQty - t,
            f._craftResultBox.setProgress(f._done + "/" + f._totalQty)
        }
        function o(e) {
            var i = e.reason;
            c.displayAutoCraftStopReasonMessage(i),
            f._isInAutoCraft = !1,
            i === p.STOPPED_REASON_OK && n({
                count: 0
            }),
            t({
                keepResultVisible: !0
            }),
            f._restoreMergeStopButtons()
        }
        function r(e) {
            var i = g.playerData.jobs;
            h.createItemInstances(e.object, function(n, o) {
                if (n)
                    return console.error("Crafting: addAndModifySlots cannot createItemInstances", n);
                var s = o.array[0]
                  , a = i.addToCraft(s);
                e.remote ? (f._targetSlotElems.addAndModifySlot(s),
                a || f._mySlotElems.incrementAvailableSlots(-1)) : (f._mySlotElems.addAndModifySlot(s),
                a || f._targetSlotElems.incrementAvailableSlots(-1)),
                f._mySlotElems.setNbSlots(),
                f._targetSlotElems.setNbSlots(),
                t()
            })
        }
        function l(e) {
            var i = e.objectUID
              , n = g.playerData.jobs
              , o = n.removeToCraft(i)
              , s = f._mySlotElems.removeIngredient(i)
              , a = f._targetSlotElems.removeIngredient(i);
            o || (a && f._mySlotElems.incrementAvailableSlots(1),
            s && f._targetSlotElems.incrementAvailableSlots(1)),
            f._mySlotElems.setNbSlots(),
            f._targetSlotElems.setNbSlots(),
            t()
        }
        e = e || {},
        s.call(this, {
            className: "CraftingWindow",
            title: "",
            noCloseButton: !0,
            positionInfo: {
                left: "0.5%",
                bottom: "2%",
                width: "76%",
                height: "95%"
            }
        });
        var d = {
            left: "0.5%",
            bottom: "2%",
            width: 320,
            height: "95%"
        };
        this._positionInfos = {
            decrafting: d,
            wrapping: d
        };
        var m = {
            right: "0.5%",
            bottom: "2%",
            width: "34.8%",
            height: "95%"
        };
        this._inventoryPositionInfos = {
            decrafting: m,
            wrapping: m
        },
        this._mergeLabels = {
            crafting: a("ui.common.merge"),
            decrafting: a("ui.common.decraft")
        };
        var f = this
          , g = window.gui;
        this._domCreated = !1,
        this._recipeList = null ,
        this._mySlotElems = null ,
        this._targetSlotElems = null ,
        this._craftResultBox = null ,
        this._itemResult = null ,
        this._totalQty = 1,
        this._done = 0,
        this._isInAutoCraft = !1,
        this._skillId = null ,
        this._onResultEvents = function(e) {
            f._onResult(e, function(e, t) {
                return e ? console.error("Crafting: onResult error", e) : void f.giveTheResult(t.objectInfo, t.message)
            })
        }
        ,
        this._slotCountIncreased = function(e) {
            var t = e.newMaxSlot;
            f._updateRecipeList(t),
            f._updateSlotElems(t)
        }
        ,
        this._updateSlotElems = function(e) {
            f._updateMySlotElems(e)
        }
        ,
        g.on("ExchangeCraftResultMessage", this.localizeEvent(f._onResultEvents)),
        g.on("ExchangeCraftResultWithObjectIdMessage", this.localizeEvent(f._onResultEvents)),
        g.on("ExchangeCraftResultWithObjectDescMessage", this.localizeEvent(f._onResultEvents)),
        g.on("ExchangeObjectAddedMessage", this.localizeEvent(r)),
        g.on("ExchangeObjectModifiedMessage", this.localizeEvent(r)),
        g.on("ExchangeObjectRemovedMessage", this.localizeEvent(l)),
        g.on("ExchangeReplayCountModifiedMessage", this.localizeEvent(i)),
        g.on("ExchangeItemAutoCraftRemainingMessage", this.localizeEvent(n)),
        g.on("ExchangeItemAutoCraftStopedMessage", this.localizeEvent(o)),
        g.on("ExchangeCraftSlotCountIncreasedMessage", this.localizeEvent(f._slotCountIncreased)),
        this.on("open", function(e) {
            f._domCreated || f._createDom(),
            f._onOpen(e)
        }),
        this.on("close", function() {
            f._mySlotElems.clear(),
            f._targetSlotElems.clear(),
            f._recipeList.reset(),
            f._craftResultBox.clear(),
            g.playerData.jobs.clearAfterCraft(),
            f._skillId = null ,
            f._paymentButton.hide(),
            u.close("craftPayment")
        }),
        this.on("closed", function() {
            this._updatePerCraftType()
        }),
        this._buttonMergeAction = function() {
            function e() {
                window.dofus.sendMessage("ExchangeReadyMessage", {
                    ready: !0,
                    step: 2
                }),
                f._isInAutoCraft ? (f._stopBtn.enable(),
                f._buttonMerge.disable()) : f._restoreMergeStopButtons()
            }
            var t = f._mySlotElems.getGivenIngredientsInfo().length;
            if (t += f._targetSlotElems.getGivenIngredientsInfo().length,
            !(t < 1))
                return f._skillId !== g.playerData.jobs.SKILLID_DECRAFT ? e() : void window.gui.openConfirmPopup({
                    title: a("ui.popup.warning"),
                    message: a("ui.craft.decraftConfirm"),
                    cb: function(t) {
                        t && e()
                    }
                })
        }
    }
    i(912);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(756)
      , l = i(204).DofusButton
      , c = i(463)
      , u = i(22)
      , h = i(323)
      , d = i(913)
      , p = i(464)
      , m = i(701)
      , f = i(914)
      , g = i(916)
      , _ = i(186);
    o(n, s),
    e.exports = n,
    n.prototype._restoreMergeStopButtons = function() {
        this._stopBtn.disable(),
        this._buttonMerge.enable()
    }
    ,
    n.prototype._createDom = function() {
        function e(e, i) {
            "craftInventory" === e.source && t._mySlotElems.selectSlots(i),
            "recipeList" === e.source && t._craftResultBox.selectSlot(i)
        }
        var t = this
          , i = this.windowBody.createChild("div", {
            className: "col1"
        })
          , n = this.windowBody.createChild("div", {
            className: "col2"
        });
        this._recipeList = i.appendChild(new r({
            showCraftableFilter: !0
        })),
        this._recipeList.on("recipeSelected", function(e) {
            window.dofus.sendMessage("ExchangeSetCraftRecipeMessage", {
                objectGID: e
            }),
            u.getWindow("craftInventory").emit("recipeSelected")
        }),
        this._recipeList.on("notEnoughIngredient", function() {
            window.gui.openSimplePopup(a("ui.craft.dontHaveAllIngredient"))
        }),
        this._targetSlotElems = n.appendChild(new g),
        this._mySlotElems = n.appendChild(new g),
        _.on("dragStart", t.localizeEvent(function(t, i, n) {
            e(n, !0)
        })),
        _.on("dragEnd", t.localizeEvent(function(t, i, n) {
            e(n, !1)
        })),
        this._craftResultBox = n.appendChild(new f);
        var o = n.createChild("div", {
            className: "buttonsContainer"
        });
        this._buttonMerge = o.appendChild(new l(a("ui.common.merge"),{
            className: "mergeButton"
        })),
        this._buttonMerge.on("tap", t._buttonMergeAction),
        this._stopBtn = o.appendChild(new l(a("ui.common.stop"),{
            className: "stopButton",
            disable: !0
        })),
        this._stopBtn.on("tap", function() {
            window.dofus.sendMessage("ExchangeReplayStopMessage")
        }),
        this._paymentButton = o.appendChild(new l(a("ui.common.payment"),{
            className: "paymentButton"
        })),
        this._paymentButton.on("tap", function() {
            u.open("craftPayment")
        }),
        this._itemResult = n.createChild("div", {
            className: "itemResult"
        });
        var s = this._itemResult.createChild("div", {
            className: "titleBar"
        });
        this._itemName = s.createChild("div", {
            className: "itemName"
        }),
        this._itemLevel = s.createChild("div", {
            className: "itemLevel"
        }),
        this._itemDescription = this._itemResult.appendChild(new m),
        this._domCreated = !0
    }
    ,
    n.prototype._updateRecipeList = function(e) {
        var t = window.gui.playerData.jobs
          , i = t.getRecipesBySkill(this._skillId);
        this._recipeList.addRecipes(i, {
            nbCase: e,
            mode: "craft"
        });
        var n = e > 8 ? 8 : e;
        t.setAvailableSlots(n - t.getUsedSlots()),
        this.toggleClassName("noRecipe", !i.length)
    }
    ,
    n.prototype._updatePerCraftType = function(e) {
        u.positionWindow(this.id, this._positionInfos[e]),
        u.positionWindow("craftInventory", this._inventoryPositionInfos[e]),
        this._buttonMerge.setText(this._mergeLabels[e] || this._mergeLabels.crafting)
    }
    ,
    n.prototype._updateMySlotElems = function(e) {
        var t = 9 === e;
        this._mySlotElems.setNbSlots(),
        this._mySlotElems.toggleSignatureSlot(t)
    }
    ,
    n.prototype._onOpen = function(e) {
        var t = e.msg;
        this._skillId = t.skillId,
        this._totalQty = 1,
        this._totalFailure = 0,
        this._totalSuccess = 0,
        this._craftResultBox.clear(),
        this._itemResult.hide(),
        this._targetSlotElems.hide(),
        this._paymentButton.hide(),
        this._restoreMergeStopButtons(),
        this._mySlotElems.setPlayerName(window.gui.playerData.characterBaseInformations.name);
        var i = t.maxCase || t.nbCase;
        this._updateRecipeList(i),
        this._updateSlotElems(i),
        this._updatePerCraftType(e.type)
    }
    ,
    n.prototype._onResult = function(e, t) {
        var i = ""
          , n = null
          , o = window.gui
          , s = this
          , r = ""
          , l = e.craftResult;
        return n = e.objectGenericId || e.objectInfo && e.objectInfo.objectGID,
        l === d.CRAFT_IMPOSSIBLE ? (s._totalFailure += 1,
        i = a("ui.craft.noResult"),
        o.openSimplePopup(i)) : l === d.CRAFT_FAILED && (s._totalFailure += 1,
        s._isInAutoCraft || o.openSimplePopup(a("ui.craft.failed"))),
        s._isInAutoCraft || s._restoreMergeStopButtons(),
        n ? void h.getItems([n], function(o) {
            if (o)
                return t(o);
            var c = h.items[n];
            r = c.nameId,
            l === d.CRAFT_SUCCESS && (s._totalSuccess += 1,
            i = a("ui.craft.craftSuccessSelf", r)),
            t(null , {
                objectName: r,
                objectInfo: e.objectInfo,
                craftResult: l,
                message: i
            })
        }) : t(null , {
            objectName: r,
            objectInfo: e.objectInfo,
            craftResult: l,
            message: i
        })
    }
    ,
    n.prototype.giveTheResult = function(e, t) {
        function i(e) {
            h.createItemInstances(e, function(t, i) {
                if (t)
                    return console.error("Crafting: updateItemResultDescription Failed to create item instances", t);
                var n = i.map[e.objectUID];
                o._itemDescription.displayItem(n),
                o._itemName.setText(n.item.nameId),
                o._itemLevel.setText(a("ui.common.short.level") + n.item.level),
                o._itemResult.show()
            })
        }
        var n = window.gui
          , o = this;
        t && n.chat.logMsg(t),
        this._isInAutoCraft || this._craftResultBox.setProgress("1/1"),
        this._recipeList.filterRecipes(),
        e && i(e),
        this._craftResultBox.updateFailSuccessValues(this._totalFailure, this._totalSuccess)
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        CRAFT_IMPOSSIBLE: 0,
        CRAFT_FAILED: 1,
        CRAFT_SUCCESS: 2,
        CRAFT_NEUTRAL: 3
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "CraftResultBox"
        });
        var e = this;
        this._maxQuantity = 1,
        this._minMaxSelector = this.appendChild(new r),
        this._minMaxSelector.on("confirm", function(e) {
            window.dofus.sendMessage("ExchangeReplayMessage", {
                count: e
            })
        });
        var t = this.createChild("div", {
            className: "resultContainer"
        })
          , i = t.createChild("div", {
            className: "resultObjectLine"
        });
        this._resultSlot = i.appendChild(new c),
        this._resultName = i.createChild("div", {
            className: "resultName"
        }),
        this._qtyButton = i.appendChild(new u({
            className: ["simpleButton", "qtyButton"]
        })),
        this._quantity = i.createChild("div", {
            className: "quantity",
            text: "x1"
        });
        var n = t.createChild("div", {
            className: "successLine"
        });
        n.createChild("span", {
            className: "label",
            text: a("ui.craft.success") + ": "
        }),
        this._successValue = n.createChild("span", {
            className: "value"
        });
        var o = t.createChild("div", {
            className: "resultStatsLine"
        })
          , l = o.createChild("div", {
            className: "failureLine"
        });
        l.createChild("span", {
            className: "label",
            text: a("ui.craft.failure") + ": "
        }),
        this._failureValue = l.createChild("span", {
            className: "value"
        }),
        this._progressLine = o.createChild("div", {
            className: "progressLine",
            hidden: !0
        }),
        this._progressLine.createChild("span", {
            className: "label",
            text: a("ui.craft.progress") + ": "
        }),
        this._progressValue = this._progressLine.createChild("span", {
            className: "value"
        }),
        h.setDroppable(this, ["recipeList"]),
        this.on("drop", function(e, t, i) {
            i.selectRecipe()
        }),
        this._qtyButton.on("tap", function() {
            e._minMaxSelector.open({
                min: 1,
                max: e._maxQuantity
            })
        })
    }
    i(915);
    var o = i(26).inherits
      , s = i(190)
      , a = i(35).getText
      , r = i(201)
      , l = i(323)
      , c = i(567)
      , u = i(204)
      , h = i(186);
    o(n, s),
    e.exports = n,
    n.prototype.prepareItem = function(e) {
        var t = this;
        l.getItems([e], function(i) {
            if (i)
                return console.error(i);
            var n = l.items[e];
            t._resultSlot.setItem(n),
            t._resultName.setText(n.nameId)
        })
    }
    ,
    n.prototype.setQty = function(e) {
        this._quantity.setText("x" + e)
    }
    ,
    n.prototype.setMaxQuantity = function(e) {
        this._maxQuantity = e
    }
    ,
    n.prototype.setProgress = function(e) {
        this._progressValue.setText(e),
        this._progressLine.show()
    }
    ,
    n.prototype.updateFailSuccessValues = function(e, t) {
        this._failureValue.setText(e),
        this._successValue.setText(t)
    }
    ,
    n.prototype.checkRecipe = function(e, t) {
        function i() {
            var t, i, n = window.gui.playerData, o = n.inventory.objects, s = {}, a = -1;
            for (t = 0,
            i = e.length; t < i; t += 1) {
                var r = e[t];
                if (o[r.UID]) {
                    var l = o[r.UID].quantity;
                    s[r.GID] = l
                }
            }
            for (t = 0,
            i = e.length; t < i; t += 1)
                if (e[t].GID) {
                    var c = e[t].GID
                      , u = e[t].quantity
                      , h = s[c]
                      , d = Math.floor(h / u);
                    (a === -1 || a > d) && (a = d)
                }
            var p = s[n.jobs.RUNE_SIGNATURE_GID];
            return p && a > p && (a = p),
            a
        }
        var n = e.length <= 0;
        if (t.isRecipeKnown ? this.prepareItem(t.itemToCraft.resultId) : this._clearItem(),
        n)
            this._qtyButton.disable(),
            this.setMaxQuantity(1);
        else {
            this._qtyButton.enable();
            var o = i();
            this.setMaxQuantity(o)
        }
    }
    ,
    n.prototype._clearItem = function() {
        this._resultSlot.unset(),
        this._resultName.setText(""),
        this.setQty(1)
    }
    ,
    n.prototype.toggleReady = function(e) {
        this.toggleClassName("isReady", e)
    }
    ,
    n.prototype._clearProgress = function() {
        this._progressLine.hide(),
        this._progressValue.setText(""),
        this._failureValue.setText("-"),
        this._successValue.setText("-")
    }
    ,
    n.prototype.clear = function() {
        this._clearItem(),
        this._clearProgress(),
        this.setMaxQuantity(1)
    }
    ,
    n.prototype.selectSlot = function(e) {
        this._resultSlot.toggleClassName("selected", e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            h.moveItemBetweenCrafAndInventory(c, u, e, a)
        }
        function t(t, i, o) {
            return c = t,
            u = i,
            u === h.RUNE_SIGNATURE_GID ? e(1) : 1 === o ? e(1) : void n._minMaxSelector.open({
                min: 1,
                max: o
            })
        }
        function i() {
            if (!n._isRemote) {
                var e = this.itemInstance;
                e && (a = !1,
                t(e.objectUID, e.objectGID, 1))
            }
        }
        r.call(this, "div", {
            className: "CraftActorBox"
        });
        var n = this;
        this._usedSlots = 0,
        this._runeSignatureUid = null ,
        this._minMaxSelector = this.appendChild(new l),
        this._minMaxSelector.setStyles({
            left: "20px",
            top: "30px"
        });
        var a = !1
          , c = null
          , u = null
          , h = window.gui.playerData.jobs;
        this._minMaxSelector.on("confirm", e);
        var d = this.createChild("div", {
            className: "wrapper"
        })
          , p = this._slotsContainer = d.createChild("div", {
            className: "slotsContainer"
        });
        this._addDoubleTap = function(e) {
            e.on("doubletap", i)
        }
        ,
        this._createSignatureSlot = function() {
            var e = this._signatureSlot = p.appendChild(new s);
            e.addClassNames("signatureSlot"),
            this._addDoubleTap(e)
        }
        ,
        o.setDroppable(this, ["craftInventory"]),
        this.on("drop", function(e) {
            if (!n._isRemote) {
                a = !0;
                var i = e.itemInstance
                  , o = e.getQuantity();
                t(i.objectUID, i.objectGID, o)
            }
        }),
        this._playerName = p.createChild("div", {
            className: "playerName"
        }),
        this._playerRole = p.createChild("div", {
            className: "playerRole"
        }),
        this._allSlots = p.createChild("div", {
            className: "allSlots"
        }),
        this._createSignatureSlot(),
        this._signatureSlot.hide();
        for (var m = 0; m < h.MAX_CRAFT_SLOTS; m += 1)
            this._allSlots.appendChild(new s)
    }
    i(917);
    var o = i(186)
      , s = i(567)
      , a = i(26).inherits
      , r = i(190)
      , l = i(201)
      , c = i(35).getText;
    a(n, r),
    e.exports = n,
    n.prototype.setNbSlots = function() {
        for (var e = this._allSlots.getChildren(), t = this._usedSlots + window.gui.playerData.jobs.getAvailableSlots(), i = 0, n = e.length; i < n; i += 1) {
            var o = e[i]
              , s = i >= t;
            o.toggleClassName("locked", s),
            o.isLocked = s
        }
    }
    ,
    n.prototype.toggleSignatureSlot = function(e) {
        this._signatureSlot.toggleDisplay(e)
    }
    ,
    n.prototype.selectSlots = function(e) {
        for (var t = this._allSlots.getChildren(), i = 0, n = t.length; i < n; i += 1) {
            var o = t[i];
            o.toggleClassName("selected", !o.isLocked && e)
        }
    }
    ,
    n.prototype.incrementAvailableSlots = function(e) {
        var t = window.gui.playerData.jobs
          , i = t.getAvailableSlots()
          , n = i + e;
        t.setAvailableSlots(n)
    }
    ,
    n.prototype.setAsRemote = function() {
        this._isRemote = !0,
        this._slotsContainer.addClassNames("client")
    }
    ,
    n.prototype.setPlayerName = function(e) {
        this._playerName.setText(e)
    }
    ,
    n.prototype.toggleReady = function(e) {
        this.toggleClassName("isReady", e)
    }
    ,
    n.prototype._findSlotByUID = function(e) {
        for (var t = this._allSlots.getChildren(), i = 0, n = t.length; i < n; i += 1) {
            var o = t[i];
            if (o.itemInstance && o.itemInstance.objectUID === e)
                return i
        }
        return null
    }
    ,
    n.prototype.addAndModifySlot = function(e) {
        var t, i = this, n = this._allSlots.getChildren();
        if (e.objectGID === window.gui.playerData.jobs.RUNE_SIGNATURE_GID) {
            var s = this._signatureSlot;
            return this._runeSignatureUid = e.objectUID,
            s.setItem(e),
            void (this._isRemote || o.setDraggable(s, {
                backgroundImage: s.getImage()
            }, "crafting", {
                slot: s
            }))
        }
        var a = this._findSlotByUID(e.objectUID);
        a || 0 === a ? (t = n[a],
        t.setItem(e)) : (t = n[this._usedSlots],
        t.setItem(e),
        i._addDoubleTap(t),
        this._isRemote || o.setDraggable(t, {
            backgroundImage: t.getImage()
        }, "crafting", {
            slot: t
        }),
        this._usedSlots += 1)
    }
    ,
    n.prototype.removeIngredient = function(e) {
        var t = !1;
        if (e === this._runeSignatureUid)
            return this._signatureSlot.destroy(),
            this._runeSignatureUid = null ,
            this._createSignatureSlot(),
            t;
        var i = this._findSlotByUID(e);
        if (!i && 0 !== i)
            return t;
        t = !0;
        var n = this._allSlots.getChildren()
          , o = n[i];
        return o.destroy(),
        this._allSlots.appendChild(new s),
        this.setNbSlots(),
        this._usedSlots -= 1,
        t
    }
    ,
    n.prototype.getGivenIngredientsInfo = function() {
        for (var e = this._allSlots.getChildren(), t = [], i = 0, n = e.length; i < n; i += 1) {
            var o = e[i].itemInstance;
            o && t.push({
                UID: o.objectUID,
                GID: o.objectGID,
                quantity: o.quantity
            })
        }
        return t
    }
    ,
    n.prototype.getRuneSignatureInfo = function() {
        var e = this._signatureSlot.itemInstance;
        return e ? {
            UID: e.objectUID,
            GID: e.objectGID,
            quantity: e.quantity
        } : {}
    }
    ,
    n.prototype.setCrafterJobLevel = function(e, t, i) {
        t ? this._playerRole.setText(i + " " + c("ui.common.short.level") + " " + t) : this._playerRole.setText(c("ui.craft.client"))
    }
    ,
    n.prototype.clear = function() {
        this._minMaxSelector.hide(),
        this._isRemote = !1,
        this._usedSlots = 0,
        this._signatureSlot.destroy(),
        this._runeSignatureUid = null ;
        var e = this._allSlots.getChildren();
        this._createSignatureSlot(),
        this._signatureSlot.hide();
        for (var t = 0, i = e.length; t < i; t += 1) {
            var n = e[t];
            n.destroy(),
            this._allSlots.appendChild(new s)
        }
        this.setNbSlots()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            u += 1
        }
        function t(e) {
            var t = e.ready
              , i = o._buttonMerge;
            o._craftResultBox.toggleReady(t),
            o._mySlotElems.toggleReady(t),
            o._targetSlotElems.toggleReady(t),
            t ? l.playerData.id === e.id && (i.setText(s("ui.common.cancel")),
            o._restoreMergeStopButtons()) : (i.setText(s("ui.common.merge")),
            o._isReady = !1)
        }
        function i() {
            o._craftResultBox.toggleReady(!1),
            o._mySlotElems.toggleReady(!1),
            o._targetSlotElems.toggleReady(!1),
            o._buttonMerge.setText(s("ui.common.merge")),
            o._isReady = !1
        }
        function n(i) {
            var n = i._messageType;
            if (o.openState)
                switch (n) {
                case "ExchangeObjectAddedMessage":
                case "ExchangeObjectModifiedMessage":
                case "ExchangeObjectRemovedMessage":
                case "ExchangeGoldPaymentForCraftMessage":
                case "ExchangeItemPaymentForCraftMessage":
                case "ExchangeModifiedPaymentForCraftMessage":
                case "ExchangeRemovedPaymentForCraftMessage":
                case "ExchangeClearPaymentForCraftMessage":
                    e();
                    break;
                case "ExchangeIsReadyMessage":
                    t(i)
                }
        }
        a.call(this);
        var o = this
          , l = window.gui;
        this._mySlotElems = null ,
        this._targetSlotElems = null ,
        this._craftResultBox = null ,
        this._isReady = !1,
        this._isCrafter = !0;
        var c = ""
          , u = 0;
        this._updateSlotElems = function(e) {
            o._updateMySlotElems(e);
            var t = 9 === e;
            o._targetSlotElems.setPlayerName(c),
            o._targetSlotElems.setNbSlots(),
            o._targetSlotElems.setAsRemote();
            var i = o._isCrafter;
            o._mySlotElems.toggleSignatureSlot(t && i),
            o._targetSlotElems.toggleSignatureSlot(t && !i)
        }
        ,
        this._onResultEvents = function(e) {
            i(),
            o._stopBtn.enable(),
            o._buttonMerge.disable(),
            o._onResult(e, function(e, t) {
                if (e)
                    return console.error("Crafting multi: onResult error", e);
                var i = t.message
                  , n = t.craftResult
                  , a = t.objectInfo
                  , l = t.objectName;
                n === r.CRAFT_SUCCESS && (i = o._isCrafter ? s("ui.craft.successTarget", l, c) : s("ui.craft.successOther", c, l)),
                o.giveTheResult(a, i)
            })
        }
        ,
        l.on("ExchangeObjectAddedMessage", n),
        l.on("ExchangeObjectModifiedMessage", n),
        l.on("ExchangeObjectRemovedMessage", n),
        l.on("ExchangeGoldPaymentForCraftMessage", n),
        l.on("ExchangeItemPaymentForCraftMessage", n),
        l.on("ExchangeModifiedPaymentForCraftMessage", n),
        l.on("ExchangeRemovedPaymentForCraftMessage", n),
        l.on("ExchangeClearPaymentForCraftMessage", n),
        l.on("ExchangeIsReadyMessage", n),
        this.on("close", function() {
            o._isCrafter = !0,
            c = "",
            u = 0,
            i()
        }),
        this._buttonMergeAction = function() {
            var e = o._mySlotElems.getGivenIngredientsInfo().length;
            e += o._targetSlotElems.getGivenIngredientsInfo().length,
            e < 1 || (o._isReady = !o._isReady,
            window.dofus.sendMessage("ExchangeReadyMessage", {
                ready: o._isReady,
                step: u
            }))
        }
    }
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(911)
      , r = i(913)
      , l = i(22);
    o(n, a),
    e.exports = n,
    n.prototype._onOpen = function(e) {
        a.prototype._onOpen.call(this, e),
        l.close("cancel", {
            keepDialog: !0
        }),
        this._isCrafter = e.isCrafter;
        var t = e.msg;
        this._targetSlotElems.setCrafterJobLevel(t.skillId, t.crafterJobLevel, t.enrichData.jobName),
        this._targetSlotElems.show(),
        this._paymentButton.show();
        var i = l.getWindow("craftPayment");
        i.setForCrafter(e.isCrafter),
        i.setOnSuccess(!1)
    }
}
, function(e, t, i) {
    function n() {
        function e() {
            h.open("crafter", {
                crafter: this.crafter,
                job: I
            })
        }
        function t() {
            window.gui.openContextualMenu("player", {
                playerId: this.playerInfo.playerId,
                accountId: w.accountId,
                playerName: this.playerInfo.playerName
            })
        }
        function i(e) {
            var t = new p("div",{
                className: "avatar"
            })
              , i = "gfx/heads/SmallHead_" + e.breed + (e.sex ? 0 : 1) + ".png";
            return m.preloadImage(i, function(e) {
                t && t.rootElement && t.setStyle("backgroundImage", e)
            }),
            t
        }
        function n(e) {
            var i = new d({
                className: "userNameButton",
                text: e.playerName
            });
            return i.playerInfo = e,
            i.on("tap", t),
            i
        }
        function s(t) {
            var s = t || {}
              , a = new d;
            a.crafter = s,
            a.on("tap", e);
            var r = 0 !== (s.jobInfo.userDefinedParams & o.CRAFT_OPTION_NOT_FREE)
              , l = "( " + s.playerInfo.worldX + "," + s.playerInfo.worldY + " )"
              , c = s.playerInfo.isInWorkshop ? l : "-"
              , u = {
                avatar: i(s.playerInfo),
                name: n(s.playerInfo),
                level: s.jobInfo.jobLevel,
                coord: c,
                cost: r ? S : A,
                nbSlots: s.jobInfo.minSlots,
                button: a
            };
            return u
        }
        function f(e) {
            if (w.table.clearContent(),
            e.length)
                for (var t = 0; t < e.length; t += 1)
                    g(e[t])
        }
        function g(e) {
            var t = w.table.addRow(s(e));
            T[e.playerInfo.playerId] = t
        }
        function _(e) {
            var t = T[e.playerId]
              , i = w.table.getRows().indexOf(t);
            w.table.delRow(i),
            delete T[e.playerId]
        }
        function v(e) {
            var t = T[e.playerInfo.playerId]
              , i = w.table.getRows().indexOf(t);
            w.table.updateRow(i, s(e))
        }
        function y() {
            w.selector.clearContent(),
            w.table.clearContent()
        }
        a.call(this, {
            className: "CraftersListWindow",
            title: r("ui.craft.craftersList"),
            positionInfo: {
                top: "c",
                left: "c",
                width: 600,
                height: 480
            }
        });
        var w = this
          , b = window.gui
          , C = []
          , I = {}
          , T = {}
          , S = r("ui.common.yes")
          , A = r("ui.common.no");
        b.on("ExchangeStartOkJobIndexMessage", function(e) {
            h.openDialog(w.id, {
                msg: e
            })
        }),
        b.on("JobCrafterDirectoryListMessage", function(e) {
            f(e.listEntries)
        }),
        b.on("JobCrafterDirectoryAddMessage", function(e) {
            return T[e.listEntry.playerInfo.playerId] ? v(e.listEntry) : void g(e.listEntry)
        }),
        b.on("JobCrafterDirectoryRemoveMessage", _),
        this.once("open", function() {
            w.selector = w.windowBody.appendChild(new l),
            w.table = w.windowBody.appendChild(new c({
                colIds: ["avatar", "name", "level", "coord", "cost", "nbSlots", "button"],
                colCount: 7,
                highlightable: !0,
                headerContent: ["", "Name", "Lvl.", "coord", "cost", "nb", ""]
            })),
            w.selector.on("change", function(e) {
                return e < 0 ? void w.table.clearContent() : (I = e,
                void window.dofus.sendMessage("JobCrafterDirectoryListRequestMessage", {
                    jobId: e.id
                }))
            })
        }),
        this.on("open", function(e) {
            e = e || {},
            C = e.msg.jobs,
            u.getData("Jobs", C, function(e, t) {
                if (e)
                    return console.error(e);
                w.selector.clearContent(),
                w.selector.addOption(r("ui.craft.chooseJob"), -1);
                for (var i = 0; i < t.length; i += 1) {
                    var n = t[i];
                    w.selector.addOption(n.nameId, n)
                }
                1 === t.length && w.selector.select(t[0])
            })
        }),
        this.on("close", y)
    }
    i(920);
    var o = i(904)
      , s = i(26).inherits
      , a = i(402)
      , r = i(35).getText
      , l = i(393)
      , c = i(485)
      , u = i(36)
      , h = i(22)
      , d = i(204)
      , p = i(190)
      , m = i(5);
    s(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            n.characterDisplay.clear(),
            n.characterDisplay.setLook(e, {
                direction: l.DIRECTION_SOUTH,
                animation: "AnimStatique",
                boneType: "characters/",
                skinType: "characters/",
                riderOnly: !0
            })
        }
        function t(t, i) {
            var o = t.playerInfo.playerId;
            window.gui.playerData.id === o ? e(window.gui.playerData.characterBaseInformations.entityLook) : window.dofus.sendMessage("ContactLookRequestByIdMessage", {
                contactType: r.SOCIAL_CONTACT_CRAFTER,
                playerId: t.playerInfo.playerId
            }),
            n.name.setText(t.playerInfo.playerName),
            n.jobName.setText(i.nameId),
            n.jobLevel.setText(t.jobInfo.jobLevel);
            var s = t.playerInfo.alignmentSide;
            s !== f.ALIGNMENT_ANGEL && s !== f.ALIGNMENT_EVIL && (s = f.ALIGNMENT_NEUTRAL);
            var l = "gfx/alignments/wings/Artisan_tx_bg" + s + "_frame0.png";
            m.preloadImage(l, function(e) {
                n.characterDisplay.setStyle("backgroundImage", e)
            }),
            n.nearCraftTable.setText(t.playerInfo.isInWorkshop ? c : g),
            n.coordinates.setText("-"),
            t.playerInfo.isInWorkshop && (n.coordinates.setText("( " + t.playerInfo.worldX + "," + t.playerInfo.worldY + " )"),
            p.getData("SubAreas", t.playerInfo.subAreaId, function(e, t) {
                if (e)
                    return console.error(e);
                var i = window.gui.databases.Areas[t.areaId];
                n.location.setText(i.nameId + " ( " + t.nameId + " )")
            }));
            var u = t.jobInfo.userDefinedParams
              , h = 0 !== (u & a.CRAFT_OPTION_NOT_FREE)
              , d = 0 !== (u & a.CRAFT_OPTION_NOT_FREE_EXCEPT_ON_FAIL)
              , _ = 0 !== (u & a.CRAFT_OPTION_RESOURCES_REQUIRED);
            n.checkboxNotFree.toggleActivation(h),
            n.freeOnFailCheckbox.toggleDisplay(!!i.specializationOfId),
            n.freeOnFailCheckbox.toggleActivation(d),
            n.checkboxRessourcesNeeded.toggleActivation(_),
            n.minItems.setText(t.jobInfo.minSlots),
            n.messageButton.enable()
        }
        function i() {
            n.characterDisplay.release(),
            delete n.crafter
        }
        u.call(this, {
            className: "CrafterWindow",
            title: h("ui.craft.crafter"),
            positionInfo: {
                top: "c",
                left: "c",
                width: 550,
                height: 380
            }
        });
        var n = this
          , c = h("ui.common.yes")
          , g = h("ui.common.no");
        this.once("open", function() {
            var i = this.windowBody.createChild("div", {
                className: "colsWrapper"
            })
              , a = i.createChild("div", {
                className: "col1"
            })
              , r = i.createChild("div", {
                className: "col2"
            })
              , l = a.createChild("div", {
                className: ["block", "blockCharacter"]
            });
            this.characterDisplay = l.appendChild(new s({
                scale: 2
            })),
            this.characterDisplay.clear();
            var c = r.createChild("div", {
                className: ["block", "blockInfos"]
            });
            c.createChild("div", {
                className: "title",
                text: h("ui.common.informations")
            });
            var u = c.createChild("div", {
                className: "line"
            });
            u.createChild("div", {
                className: "label",
                text: h("ui.common.name")
            }),
            this.name = u.createChild("div", {
                className: ["value", "name"]
            });
            var p = c.createChild("div", {
                className: "line"
            });
            p.createChild("div", {
                className: "label",
                text: h("ui.craft.job")
            }),
            this.jobName = p.createChild("div", {
                className: ["value", "job"]
            });
            var m = c.createChild("div", {
                className: "line"
            });
            m.createChild("div", {
                className: "label",
                text: h("ui.craft.jobLevel")
            }),
            this.jobLevel = m.createChild("div", {
                className: ["value", "jobLevel"]
            });
            var f = r.createChild("div", {
                className: ["block", "blockLocation"]
            });
            f.createChild("div", {
                className: "title",
                text: h("ui.common.localisation")
            });
            var g = f.createChild("div", {
                className: "line"
            });
            this.location = g.createChild("div", {
                className: ["value", "location"]
            });
            var _ = f.createChild("div", {
                className: "line"
            });
            _.createChild("div", {
                className: "label",
                text: h("ui.craft.nearCraftTable")
            }),
            this.nearCraftTable = _.createChild("div", {
                className: ["value", "nearCraftTable"]
            });
            var v = f.createChild("div", {
                className: "line"
            });
            v.createChild("div", {
                className: "label",
                text: h("ui.common.coordinates")
            }),
            this.coordinates = v.createChild("div", {
                className: ["value", "coordinates"]
            });
            var y = r.createChild("div", {
                className: ["block", "blockOptions"]
            });
            y.createChild("div", {
                className: "title",
                text: h("ui.craft.jobOptions")
            }),
            this.checkboxNotFree = y.appendChild(new d(h("ui.craft.notFree"))),
            this.checkboxNotFree.disable(),
            this.freeOnFailCheckbox = y.appendChild(new d(h("ui.craft.freeIfFailed"))),
            this.freeOnFailCheckbox.addClassNames("freeOnFail"),
            this.freeOnFailCheckbox.disable(),
            this.checkboxRessourcesNeeded = y.appendChild(new d(h("ui.craft.ressourcesNeeded"))),
            this.checkboxRessourcesNeeded.disable();
            var w = y.createChild("div", {
                className: "line"
            });
            w.createChild("div", {
                className: "label",
                text: h("ui.craft.minItemInCraft")
            }),
            this.minItems = w.createChild("div", {
                className: ["value", "minItems"]
            }),
            this.messageButton = this.windowBody.appendChild(new o(h("ui.common.wMessage"))),
            this.messageButton.addClassNames("messageButton"),
            this.messageButton.on("tap", function() {
                window.gui.chat.startPrivateMessage(n.crafter.playerInfo.playerName)
            }),
            window.gui.on("ContactLookMessage", function(t) {
                n.crafter && e(t.look)
            }),
            window.gui.on("JobCrafterDirectoryAddMessage", function(e) {
                n.crafter && e.listEntry.playerInfo.playerId === n.crafter.playerInfo.playerId && (n.crafter = e.listEntry,
                t(n.crafter, n.job))
            }),
            window.gui.on("JobCrafterDirectoryRemoveMessage", function(e) {
                n.crafter && e.playerId === n.crafter.playerInfo.playerId && n.messageButton.disable()
            })
        }),
        this.on("open", function(e) {
            e = e || {},
            this.crafter = e.crafter,
            this.job = e.job,
            t(this.crafter, this.job)
        }),
        this.on("close", i)
    }
    i(922);
    var o = i(204).DofusButton
      , s = i(238)
      , a = i(904)
      , r = i(923)
      , l = i(279)
      , c = i(26).inherits
      , u = i(402)
      , h = i(35).getText
      , d = i(448)
      , p = i(36)
      , m = i(5)
      , f = i(292);
    c(n, u),
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        SOCIAL_CONTACT_FRIEND: 0,
        SOCIAL_CONTACT_SPOUSE: 1,
        SOCIAL_CONTACT_PARTY: 2,
        SOCIAL_CONTACT_GUILD: 3,
        SOCIAL_CONTACT_ALLIANCE: 4,
        SOCIAL_CONTACT_CRAFTER: 5,
        SOCIAL_CONTACT_INTERLOCUTOR: 6
    }
}
, function(e, t, i) {
    function n() {
        m.call(this, {
            className: "CraftMagusWindow",
            title: "",
            positionInfo: {
                left: "0.5%",
                bottom: "2%",
                width: "76%",
                height: "95%"
            },
            noCloseButton: !0
        }),
        this._initialize(),
        this.once("open", function() {
            this._createDom()
        }),
        this.on("open", function(e) {
            this._onOpen(e)
        }),
        this.on("close", function() {
            this._onClose()
        })
    }
    i(925);
    var o = i(204).DofusButton
      , s = i(463)
      , a = i(913)
      , r = i(186)
      , l = i(35).getText
      , c = i(26).inherits
      , u = i(701)
      , h = i(323)
      , d = i(567)
      , p = i(201)
      , m = i(402)
      , f = i(926)
      , g = s.SMITHMAGIC_RUNE_ID
      , _ = s.SMITHMAGIC_POTION_ID
      , v = s.SIGNATURE_RUNE_ID
      , y = s.SIGNATURE_AVAILABLE_LEVEL
      , w = ["item", "rune", "signatureRune"];
    c(n, m),
    e.exports = n,
    n.prototype._initVariables = function() {
        this.exchangeStep = 0,
        this.isInAutoCraft = !1,
        this.newItemInstance = null ,
        this.newItemSlotType = null ,
        this.skillId = null ,
        this.skillData = null ,
        this.droppedLocation = "",
        this.droppedItemSource = "",
        this.currentCraftingItem = null
    }
    ,
    n.prototype._initialize = function() {
        function e() {
            u.isInAutoCraft = !0,
            u._updateCraftingButtons(),
            d("ExchangeReplayMessage", {
                count: -1
            }),
            d("ExchangeReadyMessage", {
                ready: !0,
                step: u.exchangeStep
            })
        }
        function t() {
            u.isInAutoCraft = !1,
            u._updateCraftingButtons(),
            d("ExchangeReadyMessage", {
                ready: !0,
                step: u.exchangeStep
            })
        }
        function i(e) {
            h.createItemInstances(e.object, function(e, t) {
                if (e)
                    return console.error("Craft Magus: updateSlot cannot createItemInstances", e);
                var i = t.array[0]
                  , n = u._getItemSlotType(i.item)
                  , o = u._getSlotByType(n);
                o.setItem(i),
                o.dragUiInfo.backgroundImage = o.getImage(),
                r.enableDrag(o),
                "item" === n && (u.currentCraftingItem = i,
                u.itemBox.displayItem(i),
                u._updateDisplayOnCraftingItemEquipped()),
                u._updateCraftingButtons()
            })
        }
        function n(e) {
            var t = e.objectUID
              , i = u._getSlotTypeByUID(t);
            i && (u._resetSlot(i),
            u._updateSlotsImage(),
            u._updateCraftingButtons())
        }
        function o(e) {
            i(e),
            p()
        }
        function s(e) {
            n(e),
            p()
        }
        function c(e) {
            var t = window.gui;
            if (e.craftResult === a.CRAFT_IMPOSSIBLE) {
                var i = l("ui.craft.noResult");
                return t.openSimplePopup(i),
                t.chat.logMsg(i),
                d("ExchangeReadyMessage", {
                    ready: !1,
                    step: u.exchangeStep
                }),
                u.isInAutoCraft = !1,
                void u._updateCraftingButtons()
            }
            h.createItemInstances(e.objectInfo, function(t, i) {
                if (t)
                    return console.error("CraftMagusWindow createItemInstances", t);
                var n = i.array[0];
                f.display(u.currentCraftingItem, n, e)
            })
        }
        this._initVariables();
        var u = this
          , d = window.dofus.sendMessage
          , p = this.incrementStep = function() {
            u.exchangeStep += 1
        }
        ;
        this.onMergeAllBtnTap = e,
        this.onMergeBtnTap = t;
        var m = window.gui;
        m.on("ObjectModifiedMessage", this.localizeEvent(i)),
        m.on("ExchangeObjectAddedMessage", this.localizeEvent(o)),
        m.on("ExchangeObjectModifiedMessage", this.localizeEvent(o)),
        m.on("ExchangeObjectRemovedMessage", this.localizeEvent(s)),
        m.on("ExchangeCraftResultMagicWithObjectDescMessage", this.localizeEvent(c)),
        m.on("ExchangeCraftResultMessage", this.localizeEvent(c)),
        m.on("ExchangeItemAutoCraftStopedMessage", this.localizeEvent(this._onAutoCraftStopped.bind(this)))
    }
    ,
    n.prototype._createDom = function() {
        function e(e) {
            var t = new d({
                name: e
            });
            return t.dragUiInfo = {
                backgroundImage: "none"
            },
            r.setDraggable(t, t.dragUiInfo, "crafting", {
                slot: t
            }),
            r.disableDrag(t),
            t
        }
        var t = this.col1 = this.windowBody.createChild("div", {
            className: "col1"
        })
          , i = this.col2 = this.windowBody.createChild("div", {
            className: "col2"
        })
          , n = this.craftingBoxContainer = t.createChild("div", {
            className: "craftingBoxContainer"
        })
          , s = n.createChild("div", {
            className: "craftingBoxDropArea"
        });
        r.setDroppable(s, ["craftInventory", "ingredientsBag"]),
        s.on("drop", this._itemDropOnCraftBox.bind(this));
        for (var a = this.craftingBox = s.createChild("div", {
            className: "craftingBox"
        }), c = this.craftingSlots = a.createChild("div", {
            className: "craftingSlots"
        }), h = 0; h < w.length; h += 1) {
            var m = w[h];
            c.appendChild(e(m))
        }
        this.minMaxSelector = this.windowContent.appendChild(new p),
        this.minMaxSelector.on("confirm", this._moveItem.bind(this));
        var f = t.createChild("div", {
            className: "buttonsContainer"
        });
        this.mergeAllBtn = f.appendChild(new o(l("ui.common.mergeAll"),{
            className: "mergeAllBtn"
        })),
        this.mergeAllBtn.on("tap", this.onMergeAllBtnTap),
        this.mergeBtn = f.appendChild(new o(l("ui.common.merge"),{
            className: "mergeBtn"
        })),
        this.mergeBtn.on("tap", this.onMergeBtnTap),
        this.stopBtn = f.appendChild(new o(l("ui.common.stop"),{
            className: "stopBtn"
        })),
        this.stopBtn.on("tap", this._onStopBtnTap.bind(this)),
        this._setEnableCraftingButtons(!1),
        this.itemBox = i.appendChild(new u({
            showDescription: !0,
            showTitle: !0,
            minRows: 0
        })),
        this.itemBox.addClassNames("hidden")
    }
    ,
    n.prototype._onOpen = function(e) {
        var t = e.msg;
        this.skillId = t.skillId,
        this.skillData = window.gui.playerData.jobs.getSkill(t.skillId),
        this.setTitle(this.skillData.nameId),
        this._updateSlotsImage()
    }
    ,
    n.prototype._onClose = function() {
        this._initVariables(),
        this._resetSlots(),
        this.itemBox.addClassNames("hidden"),
        this._setEnableCraftingButtons(!1)
    }
    ,
    n.prototype._isCraftableItem = function(e) {
        return this.skillData.modifiableItemType === e.typeId
    }
    ,
    n.prototype._hasSignatureSlot = function() {
        var e = window.gui.playerData.jobs.list
          , t = this.skillData.parentJobId
          , i = e[t] || {}
          , n = i.experience || {};
        return n.jobLevel >= y
    }
    ,
    n.prototype._getSlotByType = function(e) {
        return this.craftingSlots.getChild(e)
    }
    ,
    n.prototype._slotHasItem = function(e) {
        var t = this._getSlotByType(e);
        return !!t.itemInstance
    }
    ,
    n.prototype._updateSlotsImage = function() {
        var e = this.skillData.modifiableItemType;
        this._getSlotByType("item").setBackgroundImageByItemType(e),
        this._getSlotByType("rune").setBackgroundImageByItemType(g);
        var t = this._hasSignatureSlot()
          , i = this._getSlotByType("signatureRune");
        i.toggleClassName("signatureSlot", t),
        i.toggleClassName("locked", !t)
    }
    ,
    n.prototype._resetSlot = function(e) {
        var t = this._getSlotByType(e);
        t.unset(),
        r.disableDrag(t)
    }
    ,
    n.prototype._resetSlots = function() {
        for (var e = 0; e < w.length; e += 1)
            this._resetSlot(w[e])
    }
    ,
    n.prototype._getItemSlotType = function(e) {
        var t, i = this.skillData;
        return this._isCraftableItem(e) ? t = "item" : !i.isForgemagus || e.typeId !== g && e.typeId !== _ ? e.id === v && (t = "signatureRune") : t = "rune",
        t
    }
    ,
    n.prototype._getSlotTypeByUID = function(e) {
        for (var t = 0; t < w.length; t += 1) {
            var i = w[t]
              , n = this._getSlotByType(i);
            if (n.itemInstance && n.itemInstance.objectUID === e)
                return i
        }
    }
    ,
    n.prototype._setEnableMergeButtons = function(e) {
        this.mergeAllBtn.setEnable(e),
        this.mergeBtn.setEnable(e)
    }
    ,
    n.prototype._setEnableCraftingButtons = function(e) {
        this._setEnableMergeButtons(e),
        this.stopBtn.setEnable(e)
    }
    ,
    n.prototype._updateCraftingButtons = function() {
        this._setEnableMergeButtons(!this.isInAutoCraft && this._slotHasItem("item") && this._slotHasItem("rune")),
        this.stopBtn.setEnable(this.isInAutoCraft)
    }
    ,
    n.prototype._sendItemMoveMessage = function(e, t, i) {
        window.dofus.sendMessage("ExchangeObjectMoveMessage", {
            objectUID: e,
            quantity: i ? t : -t
        })
    }
    ,
    n.prototype._positionMinMaxSelector = function(e, t) {
        this.minMaxSelector.setStyles({
            left: e + "px",
            top: t + "px"
        })
    }
    ,
    n.prototype._removeCurrentItemInCraftBox = function() {
        if (this.newItemSlotType) {
            var e = this.newItemInstance
              , t = this._getSlotByType(this.newItemSlotType)
              , i = t.itemInstance;
            i && i.objectGID !== v && (i.objectUID !== e.objectUID || this._isCraftableItem(i.item)) && this._sendItemMoveMessage(i.objectUID, i.quantity, !1)
        }
    }
    ,
    n.prototype._moveItem = function(e) {
        this._removeCurrentItemInCraftBox(),
        this._sendItemMoveMessage(this.newItemInstance.objectUID, e, !0)
    }
    ,
    n.prototype._itemDropOnCraftBox = function(e, t, i) {
        if (this.skillId && e.itemInstance && (this.newItemSlotType = this._getItemSlotType(e.itemInstance.item),
        this.newItemSlotType)) {
            var n = this.newItemInstance = e.itemInstance;
            this.droppedLocation = "crafting",
            this.droppedItemSource = t;
            var o = n.objectGID
              , s = e.getQuantity();
            if (o !== v || this._hasSignatureSlot()) {
                if (o === v || 1 === s || this._isCraftableItem(n.item) && s > 1)
                    return this._moveItem(1);
                this._positionMinMaxSelector(i.x, i.y),
                this.minMaxSelector.open({
                    min: 1,
                    max: s
                })
            }
        }
    }
    ,
    n.prototype._onStopBtnTap = function() {
        window.dofus.sendMessage("ExchangeReplayStopMessage")
    }
    ,
    n.prototype._onAutoCraftStopped = function(e) {
        s.displayAutoCraftStopReasonMessage(e.reason),
        this.isInAutoCraft = !1,
        this._updateCraftingButtons()
    }
    ,
    n.prototype._updateDisplayOnCraftingItemEquipped = function() {
        this.itemBox.delClassNames("hidden")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        for (var t = 0; t < e.length; t += 1)
            if ("ObjectEffectMinMax" === e[t]._type || "EffectInstanceMinMax" === e[t]._type)
                return e[t];
        return null
    }
    function o(e) {
        return "ObjectEffectInteger" === e._type || "EffectInstanceInteger" === e._type
    }
    var s = i(224).createEffectInstances
      , a = i(35).getText
      , r = i(927);
    t.display = function(e, t, i) {
        var l = window.gui.chat
          , c = e.effects
          , u = t.effects
          , h = n(c)
          , d = n(u);
        if (h && d && h.actionId !== d.actionId)
            return l.logMsg(a("ui.craft.success"));
        var p = {}
          , m = {};
        c = c.filter(o),
        u = u.filter(o),
        c.forEach(function(e) {
            p[e.actionId] = e
        }),
        u.forEach(function(e) {
            m[e.actionId] = e
        });
        var f, g, _, v, y, w = !1, b = [], C = [];
        for (f = 0; f < c.length; f += 1) {
            v = c[f],
            g = v.actionId,
            y = v.value;
            var I = parseInt(v.effect.operator + v.value, 10);
            if (m.hasOwnProperty(g)) {
                var T = parseInt(m[g].effect.operator + m[g].value, 10);
                _ = T - I
            } else
                _ = -I;
            _ && (b.push({
                _type: v._type,
                actionId: g,
                value: _
            }),
            _ > 0 && (w = !0)),
            C.push(g)
        }
        for (f = 0; f < u.length; f += 1)
            v = u[f],
            g = v.actionId,
            C.indexOf(g) >= 0 || (y = v.value,
            b.push({
                _type: v._type,
                actionId: g,
                value: y
            }),
            y > 0 && (w = !0));
        var S = a(w ? "ui.craft.success" : "ui.craft.failure");
        s(b, function(e, t) {
            if (e)
                return console.error("Craft Magus: craftResultText cannot createItemInstances", e);
            for (var n, o, s = "", c = 0; c < t.length; c += 1)
                n = t[c],
                n.effect.bonusType && (o = n.description,
                o = n.value > 0 ? "+" + o : o,
                s += " " + o + ",",
                s = s.replace("--", "-"));
            var u = "";
            i.magicPoolStatus === r.MAGIC_POOL_INCREASE ? u = " +" + a("ui.craft.smithResidualMagic") : i.magicPoolStatus === r.MAGIC_POOL_LOSS ? u = " -" + a("ui.craft.smithResidualMagic") : s = s.substring(0, s.length - 1),
            s += u,
            s && (S += a("ui.common.colon")),
            l.logMsg(S + s)
        })
    }
}
, function(e, t) {
    e.exports = {
        MAGIC_POOL_NO_CHANGE: 1,
        MAGIC_POOL_INCREASE: 2,
        MAGIC_POOL_LOSS: 3
    }
}
, function(e, t, i) {
    function n() {
        r.call(this),
        this.addClassNames("CraftMagusMultiWindow"),
        this.on("opened", function() {
            this._resizeIngredientSlots()
        })
    }
    i(929);
    var o = i(204).DofusButton
      , s = i(448)
      , a = i(463)
      , r = i(924)
      , l = i(186)
      , c = i(35).getText
      , u = i(26).inherits
      , h = i(323)
      , d = i(567)
      , p = i(571)
      , m = i(22)
      , f = i(190)
      , g = 40
      , _ = 40
      , v = 30
      , y = a.SMITHMAGIC_RUNE_ID
      , w = a.SMITHMAGIC_POTION_ID
      , b = a.SIGNATURE_RUNE_ID
      , C = a.SIGNATURE_AVAILABLE_LEVEL;
    u(n, r),
    e.exports = n,
    n.prototype._initVariables = function() {
        r.prototype._initVariables.call(this),
        this.isCrafter = null ,
        this.isCraftingMode = !1,
        this.allowCrafterIngredients = !1,
        this.crafterSkillLevel = 1,
        this.currentPage = -1,
        this.pageCount = -1
    }
    ,
    n.prototype._initialize = function() {
        function e(e) {
            a.allowCrafterIngredients = !!e.allowed;
            var t = !0;
            a.allowCrafterIngredientsCheckbox.toggleActivation(a.allowCrafterIngredients, t)
        }
        function t(e) {
            var t = e.object;
            h.createItemInstances(t, function(e, i) {
                if (e)
                    return console.error(e);
                var n = i.map[t.objectUID]
                  , o = new d({
                    itemData: n,
                    name: t.objectUID
                });
                o.setQuantity(n.quantity),
                a.ingredientsSlots.appendChild(o),
                l.setDraggable(o, {
                    backgroundImage: o.getImage()
                }, "ingredientsBag", {
                    slot: o
                }),
                a._updateIngrediensSlotsPageCount()
            })
        }
        function i(e) {
            var t = e.object
              , i = t.objectUID
              , n = t.quantity
              , o = a.ingredientsSlots.getChild(i);
            o && o.setQuantity(n)
        }
        function n(e) {
            var t = e.objectUID
              , i = a.ingredientsSlots.getChild(t);
            i && (i.destroy(),
            a._updateIngrediensSlotsPageCount())
        }
        function o(e, t, i) {
            if (!(!a.skillId || !e.itemInstance || !a._getItemSlotType(e.itemInstance.item) || a.isCrafter && "craftInventory" === t || a.isCrafter && "crafting" === t && a._isMyItem(e.itemInstance.objectUID))) {
                a.newItemInstance = e.itemInstance,
                a.droppedLocation = "ingredientsBag",
                a.droppedItemSource = t;
                var n = e.getQuantity();
                if (1 === n)
                    return a._moveItem(1);
                a._positionMinMaxSelector(i.x, i.y),
                a.minMaxSelector.open({
                    min: 1,
                    max: n
                })
            }
        }
        function s(e) {
            var t = e.ready;
            a._updateExchangeReadyDisplay(!!t)
        }
        r.prototype._initialize.call(this);
        var a = this;
        this.itemDropOnBag = o;
        var c = window.gui;
        c.on("ExchangeMultiCraftCrafterCanUseHisRessourcesMessage", this.localizeEvent(e)),
        c.on("ExchangeObjectPutInBagMessage", this.localizeEvent(t)),
        c.on("ExchangeObjectRemovedFromBagMessage", this.localizeEvent(n)),
        c.on("ExchangeObjectModifiedInBagMessage", this.localizeEvent(i)),
        c.on("ExchangeIsReadyMessage", this.localizeEvent(s));
        var u = this.incrementStep;
        c.on("ExchangeGoldPaymentForCraftMessage", this.localizeEvent(u)),
        c.on("ExchangeItemPaymentForCraftMessage", this.localizeEvent(u)),
        c.on("ExchangeModifiedPaymentForCraftMessage", this.localizeEvent(u)),
        c.on("ExchangeRemovedPaymentForCraftMessage", this.localizeEvent(u)),
        c.on("ExchangeClearPaymentForCraftMessage", this.localizeEvent(u))
    }
    ,
    n.prototype._createDom = function() {
        r.prototype._createDom.call(this);
        var e = this
          , t = this.craftingBox.createChild("div");
        this.crafterName = t.createChild("span", {
            className: "playerName"
        }),
        this.crafterDescription = t.createChild("span");
        var i = this.craftingBox.createChild("div");
        this.clientName = i.createChild("span", {
            className: "playerName"
        }),
        this.clientDescription = i.createChild("span"),
        this.craftingBoxOverlay = new f("div",{
            className: "craftingBoxOverlay",
            hidden: !0
        }),
        this.craftingBoxContainer.appendChild(this.craftingBoxOverlay),
        this.acceptBtn = new o(c("ui.common.accept"),{
            className: "acceptBtn"
        }),
        this.acceptBtn.on("tap", function() {
            window.dofus.sendMessage("ExchangeReadyMessage", {
                ready: !0,
                step: e.exchangeStep
            })
        }),
        this.acceptBtn.insertBefore(this.stopBtn),
        this.ingredientsBag = this.col1.createChild("div", {
            className: "ingredientsBag"
        }),
        this.ingredientsBag.createChild("div", {
            className: "title",
            text: c("ui.craft.ingredientBag")
        }),
        this.ingredientsSlotsContainer = this.ingredientsBag.createChild("div", {
            className: "ingredientsSlotsContainer"
        }),
        this.ingredientsSlotsBox = this.ingredientsSlotsContainer.createChild("div", {
            className: "ingredientsSlotsBox"
        }),
        this.ingredientsSlotsMask = this.ingredientsSlotsBox.createChild("div", {
            className: "ingredientsSlotsMask"
        }),
        l.setDroppable(this.ingredientsSlotsMask, ["craftInventory", "crafting"]),
        this.ingredientsSlotsMask.on("drop", this.itemDropOnBag),
        this.ingredientsSlots = this.ingredientsSlotsMask.createChild("div", {
            className: "ingredientsSlots"
        }),
        this.ingredientsSlotsOverlay = this.ingredientsSlotsBox.createChild("div", {
            className: "ingredientsSlotsOverlay",
            hidden: !0
        }),
        this.pagination = this.ingredientsSlotsContainer.appendChild(new p),
        this.pagination.on("previous", function() {
            e._ingrediensSlotsGoToPage(e.currentPage - 1)
        }),
        this.pagination.on("next", function() {
            e._ingrediensSlotsGoToPage(e.currentPage + 1)
        }),
        this.pagination.on("page", function(t) {
            e._ingrediensSlotsGoToPage(t)
        }),
        this.allowCrafterIngredientsCheckbox = this.ingredientsBag.appendChild(new s("",(!1))),
        this.allowCrafterIngredientsCheckbox.on("change", function(e) {
            window.dofus.sendMessage("ExchangeMultiCraftSetCrafterCanUseHisRessourcesMessage", {
                allow: e
            })
        }),
        this.craftClientDescription = new f("div",{
            className: "craftClientDescription",
            text: c("ui.craft.smithMagicTutorial"),
            hidden: !0
        }),
        this.craftClientDescription.insertBefore(this.itemBox),
        this.paymentBtn = new o(c("ui.common.payment"),{
            className: "paymentBtn"
        }),
        this.paymentBtn.on("tap", function() {
            m.open("craftPayment")
        }),
        this.col2.appendChild(this.paymentBtn)
    }
    ,
    n.prototype._onOpen = function(e) {
        var t = e.msg;
        this.skillId = t.skillId,
        this.skillData = window.gui.playerData.jobs.getSkill(t.skillId),
        this.setTitle(this.skillData.nameId),
        this._roleSetup(e),
        this._updateSlotsImage(),
        m.close("cancel", {
            keepDialog: !0
        })
    }
    ,
    n.prototype._onClose = function() {
        r.prototype._onClose.call(this),
        this.ingredientsSlots.clearContent()
    }
    ,
    n.prototype._roleSetup = function(e) {
        var t = this.isCrafter = e.isCrafter;
        this.mergeAllBtn.toggleDisplay(t),
        this.mergeBtn.toggleDisplay(t),
        this.acceptBtn.toggleDisplay(!t),
        this.allowCrafterIngredientsCheckbox.setText(c(t ? "ui.craft.crafterRunesAllowed" : "ui.craft.allowCrafterRunes"));
        var i = !1
          , n = !0;
        this.allowCrafterIngredientsCheckbox.toggleActivation(i, n),
        this.allowCrafterIngredientsCheckbox.setEnable(!t);
        var o = m.getWindow("craftPayment");
        o.setForCrafter(t),
        o.setOnSuccess(!0);
        var s = window.gui.playerData.jobs.list[this.skillData.parentJobId] || {}
          , a = s.experience || {};
        this.crafterSkillLevel = e.msg.crafterJobLevel || a.jobLevel,
        this.crafterName.setText(e.sourceName),
        this.clientName.setText(e.targetName);
        var r = e.msg.enrichData.jobName;
        this.crafterDescription.setText(" - " + r + " " + c("ui.common.level") + " " + this.crafterSkillLevel),
        this.clientDescription.setText(" - " + c("ui.craft.client")),
        this._updateExchangeReadyDisplay(!1)
    }
    ,
    n.prototype._hasSignatureSlot = function() {
        return this.crafterSkillLevel >= C
    }
    ,
    n.prototype._setEnableIngredientsBag = function(e) {
        this.ingredientsSlotsOverlay.toggleDisplay(!e),
        this.ingredientsSlotsBox.toggleClassName("disabled", !e)
    }
    ,
    n.prototype._setEnableCraftingBox = function(e) {
        this.craftingBoxOverlay.toggleDisplay(!e)
    }
    ,
    n.prototype._resizeIngredientSlots = function() {
        var e = this.ingredientsSlotsContainer.rootElement
          , t = e.offsetWidth
          , i = e.offsetHeight - v
          , n = this.ingredientsSlotsRowNum = Math.floor(i / g)
          , o = Math.floor(t / _);
        this.maxIngredientsSlotsPerPage = n * o;
        var s = o * _
          , a = n * g;
        this.ingredientsSlotsBox.setStyles({
            width: t + "px",
            height: i + "px"
        }),
        this.ingredientsSlotsMask.setStyles({
            width: s + "px",
            height: a + "px"
        }),
        this.ingredientsSlotsOverlay.setStyles({
            height: a + "px"
        }),
        this._updateIngrediensSlotsPageCount()
    }
    ,
    n.prototype._updateExchangeReadyDisplay = function(e) {
        var t = this.isCraftingMode = e;
        return this.isCrafter ? (this._setEnableCraftingBox(t),
        this._setEnableIngredientsBag(t),
        void this.craftClientDescription.hide()) : (this._setEnableCraftingBox(!1),
        this._setEnableIngredientsBag(!t),
        this.acceptBtn.setEnable(!t),
        this.stopBtn.setEnable(t),
        void this._handleCraftClientItemBoxDisplay())
    }
    ,
    n.prototype._handleCraftClientItemBoxDisplay = function() {
        var e = this.isCraftingMode && this._slotHasItem("item");
        this.itemBox.toggleClassName("hidden", !e),
        this.craftClientDescription.toggleDisplay(!e)
    }
    ,
    n.prototype._updateCraftingButtons = function() {
        this.isCrafter && r.prototype._updateCraftingButtons.call(this)
    }
    ,
    n.prototype._sendItemMoveMessageForMultiCraft = function(e, t, i) {
        window.dofus.sendMessage("ExchangeObjectUseInWorkshopMessage", {
            objectUID: e,
            quantity: i ? t : -t
        })
    }
    ,
    n.prototype._isMyItem = function(e) {
        return !!window.gui.playerData.inventory.objects[e]
    }
    ,
    n.prototype._isValidCrafterIngredients = function(e) {
        var t = e.item;
        return this.allowCrafterIngredients && this.isCraftingMode && this.isCrafter && this._isMyItem(e.objectUID) && (t.typeId === y || t.typeId === w || t.id === b)
    }
    ,
    n.prototype._removeCurrentItemInCraftBox = function() {
        if (this.newItemSlotType && "crafting" === this.droppedLocation) {
            var e = this.newItemInstance
              , t = this._getSlotByType(this.newItemSlotType)
              , i = t.itemInstance;
            if (i && i.objectGID !== b && (i.objectUID !== e.objectUID || this._isCraftableItem(i.item))) {
                var n = this._isMyItem(i.objectUID) ? this._sendItemMoveMessage : this._sendItemMoveMessageForMultiCraft;
                n(i.objectUID, i.quantity, !1)
            }
        }
    }
    ,
    n.prototype._ingrediensSlotsGoToPage = function(e) {
        if (!(this.currentPage === e || e < 0 || e > this.pageCount - 1)) {
            this.currentPage = e;
            var t = "translateY(-" + e * this.ingredientsSlotsRowNum * g + "px)";
            this.ingredientsSlots.setStyles({
                webkitTransform: t,
                transform: t
            }),
            this.pagination.setCurrent(e)
        }
    }
    ,
    n.prototype._updateIngrediensSlotsPageCount = function() {
        var e = this.ingredientsSlots.getChildren().length;
        this.pageCount = Math.ceil(e / this.maxIngredientsSlotsPerPage) || 1,
        this.pagination.setPageCount(this.pageCount),
        this._ingrediensSlotsGoToPage(this.pageCount - 1)
    }
    ,
    n.prototype._moveItem = function(e) {
        this._removeCurrentItemInCraftBox();
        var t = this.isCraftingMode && "craftInventory" !== this.droppedItemSource ? this._sendItemMoveMessageForMultiCraft : this._sendItemMoveMessage
          , i = "crafting" === this.droppedLocation;
        "ingredientsBag" === this.droppedLocation && (i = "craftInventory" === this.droppedItemSource);
        var n = this.newItemInstance;
        t(n.objectUID, e, i)
    }
    ,
    n.prototype._itemDropOnCraftBox = function(e, t, i) {
        this.skillId && e.itemInstance && ("craftInventory" !== t || this._isValidCrafterIngredients(e.itemInstance)) && r.prototype._itemDropOnCraftBox.call(this, e, t, i)
    }
    ,
    n.prototype._onStopBtnTap = function() {
        return this.isCrafter ? r.prototype._onStopBtnTap.call(this) : void window.dofus.sendMessage("ExchangeReadyMessage", {
            ready: !1,
            step: this.exchangeStep
        })
    }
    ,
    n.prototype._onAutoCraftStopped = function(e) {
        return this.isCrafter ? r.prototype._onAutoCraftStopped.call(this, e) : (a.displayAutoCraftStopReasonMessage(e.reason),
        void (this.isInAutoCraft = !1))
    }
    ,
    n.prototype._updateDisplayOnCraftingItemEquipped = function() {
        return this.isCrafter ? r.prototype._updateDisplayOnCraftingItemEquipped.call(this) : void this._handleCraftClientItemBoxDisplay()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            l.open("craftPayment")
        }
        this._positionInfoNormal = {
            left: "c",
            bottom: "10%",
            width: 550,
            height: 165
        },
        this._positionInfoOnSuccess = {
            left: "c",
            bottom: "10%",
            width: 550,
            height: 225
        },
        s.call(this, {
            className: "CraftPaymentWindow",
            title: a("ui.common.payment"),
            positionInfo: this._positionInfoNormal,
            customClose: !0
        });
        var t = this
          , i = window.gui;
        this._domCreated = !1,
        this._readOnly = !1,
        this.closeButton.on("tap", function() {
            t.hide()
        }),
        i.on("ExchangeGoldPaymentForCraftMessage", function(i) {
            var n = i.goldSum;
            i.onlySuccess ? t._successPayment.setKama(n) : t._normalPayment.setKama(n),
            e()
        }),
        i.on("ExchangeItemPaymentForCraftMessage", function(i) {
            p.createItemInstances(i.object, function(n, o) {
                if (n)
                    return console.error("PaymentWindow: ExchangeItemPaymentForCraftMessage cannot createItemInstances", n);
                var s = o.array[0];
                i.onlySuccess ? t._successPayment.addItem(s) : t._normalPayment.addItem(s),
                e()
            })
        }),
        i.on("ExchangeModifiedPaymentForCraftMessage", function(i) {
            p.createItemInstances(i.object, function(n, o) {
                if (n)
                    return console.error("PaymentWindow: ExchangeModifiedPaymentForCraftMessage cannot createItemInstances", n);
                var s = o.array[0];
                i.onlySuccess ? t._successPayment.modifyItem(s) : t._normalPayment.modifyItem(s),
                e()
            })
        }),
        i.on("ExchangeRemovedPaymentForCraftMessage", function(i) {
            i.onlySuccess ? t._successPayment.removeItem(i.objectUID) : t._normalPayment.removeItem(i.objectUID),
            e()
        }),
        i.on("ExchangeClearPaymentForCraftMessage", function(e) {
            e.paymentType === u.PAYMENT_ON_SUCCESS_ONLY && t._successPayment.clearPayment(),
            e.paymentType === u.PAYMENT_IN_ANY_CASE && t._normalPayment.clearPayment(),
            t.hide()
        }),
        this.once("open", function() {
            t._domCreated || t._createDom()
        }),
        this.on("close", function() {
            t._normalPayment.reset(),
            t._successPayment.reset(),
            t._readOnly = !1
        })
    }
    i(931);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(204).DofusButton
      , l = i(22)
      , c = i(932)
      , u = i(934)
      , h = i(186)
      , d = i(201)
      , p = i(323);
    o(n, s),
    e.exports = n,
    n.prototype._createDom = function() {
        function e(e) {
            window.dofus.sendMessage("ExchangeItemObjectAddAsPaymentMessage", {
                paymentType: s,
                bAdd: !0,
                objectToMoveId: o,
                quantity: e
            })
        }
        function t(t, i) {
            return o = t,
            1 === i ? e(1) : void n._minMaxSelector.open({
                min: 1,
                max: i
            })
        }
        function i(e) {
            if (!n._readOnly) {
                s = this.paymentType;
                var i = e.itemInstance
                  , o = e.getQuantity();
                t(i.objectUID, o)
            }
        }
        var n = this
          , o = null
          , s = u.PAYMENT_IN_ANY_CASE;
        this._minMaxSelector = this.appendChild(new d),
        this._minMaxSelector.setStyles({
            left: "20px",
            top: "30px"
        });
        var l = this.windowBody
          , p = this._normalPayment = l.appendChild(new c(u.PAYMENT_IN_ANY_CASE))
          , m = this._successPayment = l.appendChild(new c(u.PAYMENT_ON_SUCCESS_ONLY));
        this._minMaxSelector.on("confirm", e),
        h.setDroppable(p, ["craftInventory"]),
        p.on("drop", i),
        p.paymentType = u.PAYMENT_IN_ANY_CASE,
        this._addDragEvents(p),
        h.setDroppable(m, ["craftInventory"]),
        m.on("drop", i),
        m.paymentType = u.PAYMENT_ON_SUCCESS_ONLY,
        this._addDragEvents(m),
        p.on("kamaChange", function(e) {
            window.dofus.sendMessage("ExchangeItemGoldAddAsPaymentMessage", {
                paymentType: u.PAYMENT_IN_ANY_CASE,
                quantity: e
            })
        }),
        m.on("kamaChange", function(e) {
            window.dofus.sendMessage("ExchangeItemGoldAddAsPaymentMessage", {
                paymentType: u.PAYMENT_ON_SUCCESS_ONLY,
                quantity: e
            })
        });
        var f = l.appendChild(new r(a("ui.common.confirm"),{
            className: "confirmBtn"
        }));
        f.on("tap", function() {
            n.hide()
        }),
        n._domCreated = !0
    }
    ,
    n.prototype.setForCrafter = function(e) {
        this._domCreated || this._createDom(),
        this._normalPayment.setReadonly(e),
        this._successPayment.setReadonly(e),
        this._readOnly = e
    }
    ,
    n.prototype.setOnSuccess = function(e) {
        this._domCreated || this._createDom(),
        this._successPayment.toggleDisplay(e),
        e ? this.positionInfo = this._positionInfoOnSuccess : this.positionInfo = this._positionInfoNormal
    }
    ,
    n.prototype._addDragEvents = function(e) {
        function t(e, t) {
            n && n.selectSlots(t)
        }
        var i = this
          , n = e;
        h.on("dragStart", i.localizeEvent(function(e, i, n) {
            t(n.source, !0)
        })),
        h.on("dragEnd", i.localizeEvent(function(e, i, n) {
            t(n.source, !1)
        }))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: "PaymentSlotsKamas"
        });
        var t = this;
        this._MAX_SLOTS = 5,
        this._currentKama = 0,
        this._currentItems = [],
        this._currentPage = 1,
        this._readOnly = !1,
        this._paymentType = e;
        var i = this.createChild("div", {
            className: "itemsContent"
        });
        this._previousBtn = i.appendChild(new u({
            className: ["previousBtn", "arrow"]
        },function() {
            t._currentPage -= 1,
            t._updateItems()
        }
        ));
        var n = i.createChild("div", {
            className: "itemsSlotsAndLabel"
        });
        e === h.PAYMENT_ON_SUCCESS_ONLY && n.createChild("div", {
            className: "itemsLabel",
            text: c("ui.craft.additionalPayment")
        });
        for (var o = this._itemsSlots = n.createChild("div", {
            className: "itemsSlots"
        }), d = 0; d < this._MAX_SLOTS; d += 1) {
            var p = o.appendChild(new l);
            p.itemUI = {
                width: 40,
                height: 40,
                onDragClassName: "slot"
            },
            a.setDraggable(p, p.itemUI, "craftPayment", {
                slot: p
            }),
            a.disableDrag(p)
        }
        this._nextBtn = i.appendChild(new u({
            className: ["nextBtn", "arrow"]
        },function() {
            t._currentPage += 1,
            t._updateItems()
        }
        ));
        var m = this.createChild("div", {
            className: "pagesContent"
        });
        this._pagesCount = m.createChild("div", {
            className: "pagesCount"
        }),
        this._updatePagesCount();
        var f = this.createChild("div", {
            className: "kamaContent"
        });
        f.createChild("div", {
            className: "kamaLabel",
            text: c("ui.common.kamas")
        });
        var g = this._numberInput = f.appendChild(new r({
            minValue: 0,
            title: c("ui.common.kamas")
        }));
        g.on("focus", function() {
            g.maxValue = window.gui.playerData.inventory.kamas
        }),
        g.on("change", function(e) {
            t._currentKama !== e && (t._currentKama = e,
            t.emit("kamaChange", e))
        })
    }
    i(933);
    var o = i(26).inherits
      , s = i(190)
      , a = i(186)
      , r = i(208)
      , l = i(567)
      , c = i(35).getText
      , u = i(204)
      , h = i(934);
    o(n, s),
    e.exports = n,
    n.prototype.setKama = function(e) {
        this._numberInput.setValue(e),
        this._numberInput.blur()
    }
    ,
    n.prototype.setReadonly = function(e) {
        this._numberInput.setReadonly(e),
        this._itemsSlots.toggleClassName("disable", e),
        this._readOnly = e
    }
    ,
    n.prototype.selectSlots = function(e) {
        this._readOnly && (e = !1);
        for (var t = this._itemsSlots.getChildren(), i = 0, n = t.length; i < n; i += 1)
            t[i].toggleClassName("selected", e)
    }
    ,
    n.prototype._getPageMax = function() {
        return parseInt(this._currentItems.length / this._MAX_SLOTS, 10) + 1
    }
    ,
    n.prototype._updatePagesCount = function() {
        var e = this._getPageMax();
        this._currentPage > e && (this._currentPage = e),
        this._currentPage < 1 && (this._currentPage = 1);
        var t = this._currentPage;
        this._pagesCount.setText(t + "/" + e),
        t >= e ? this._nextBtn.disable() : this._nextBtn.enable(),
        t <= 1 ? this._previousBtn.disable() : this._previousBtn.enable()
    }
    ,
    n.prototype._getItemIndex = function(e) {
        for (var t = this._currentItems, i = 0, n = t.length; i < n; i += 1) {
            var o = t[i];
            if (o) {
                var s = o.objectUID;
                if (s === e)
                    return i
            }
        }
        return null
    }
    ,
    n.prototype.addItem = function(e) {
        this._currentItems.push(e),
        this._updateItems()
    }
    ,
    n.prototype.modifyItem = function(e) {
        var t = this._getItemIndex(e.objectUID);
        null !== t && (this._currentItems[t] = e,
        this._currentPage = parseInt(t / this._MAX_SLOTS, 10) + 1,
        this._updateItems())
    }
    ,
    n.prototype.removeItem = function(e) {
        var t = this._getItemIndex(e);
        null !== t && (this._currentItems.splice(t, 1),
        this._updateItems())
    }
    ,
    n.prototype._updateItems = function() {
        this._updatePagesCount();
        for (var e = this._itemsSlots.getChildren(), t = this._currentPage - 1, i = 0, n = e.length; i < n; i += 1) {
            var o = i + t * this._MAX_SLOTS
              , s = e[i]
              , r = this._currentItems[o];
            r ? (s.setItem(r),
            s.itemUI.backgroundImage = s.getImage(),
            s.paymentType = this._paymentType,
            this._readOnly ? a.disableDrag(s) : a.enableDrag(s)) : (delete s.paymentType,
            s.unset(),
            a.disableDrag(s))
        }
    }
    ,
    n.prototype.clearPayment = function() {
        this._currentKama = 0,
        this._currentPage = 1,
        this._numberInput.setValue(""),
        this._currentItems = [],
        this._updateItems()
    }
    ,
    n.prototype.reset = function() {
        this._readOnly = !1,
        this.clearPayment()
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        PAYMENT_ON_SUCCESS_ONLY: 0,
        PAYMENT_IN_ANY_CASE: 1
    }
}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            return E === C.SKILLID_WRAP_GIFT || A && A[e.objectGID]
        }
        function i(e) {
            var t = e.item
              , i = C.getSkill(E);
            return t.typeId === i.modifiableItemType || t.typeId === d.SMITHMAGIC_RUNE_ID || t.typeId === d.SMITHMAGIC_POTION_ID || e.objectGID === d.SIGNATURE_RUNE_ID
        }
        function n(e) {
            return r(e.item.type && e.item.type.superTypeId)
        }
        function s(e) {
            return "craftPayment" === T ? window.dofus.sendMessage("ExchangeItemObjectAddAsPaymentMessage", {
                paymentType: y,
                bAdd: !1,
                objectToMoveId: _,
                quantity: e
            }) : "ingredientsBag" === T ? window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: _,
                quantity: -e
            }) : void C.moveItemBetweenCrafAndInventory(_, v, e, "crafting" !== T)
        }
        function p(t) {
            if (!t.remote) {
                var i = t.object.objectUID
                  , n = b.objects[i];
                n && e.setItemQuantity(i, n.quantity - t.object.quantity)
            }
        }
        function m(t) {
            var i = t.count
              , n = C.getCraftTable();
            for (var o in n) {
                var s = parseInt(o, 10)
                  , a = n[o].quantity
                  , r = b.objects[s];
                r && e.setItemQuantity(s, r.quantity - a * i)
            }
        }
        function f(t) {
            e.resetItemQuantity(t.objectUID)
        }
        function g(e, t, i, n) {
            return _ = e.itemInstance.objectUID,
            v = e.itemInstance.objectGID,
            y = e.paymentType,
            v === C.RUNE_SIGNATURE_GID && "craftPayment" !== T ? s(1) : 1 === n ? s(1) : void I.open({
                min: 1,
                max: n,
                x: t,
                y: i
            })
        }
        l.call(this, {
            title: c("ui.common.inventory"),
            className: "CraftInventoryWindow",
            positionInfo: {
                right: "0.5%",
                bottom: "2%",
                width: "23.2%",
                height: "95%"
            }
        }),
        e.registerView(this, {
            manualReset: !0
        });
        var _, v, y, w = window.gui, b = w.playerData.inventory, C = w.playerData.jobs, I = w.windowsContainer.appendChild(new u), T = !1, S = !0, A = null , E = null , x = null , M = null , N = new h(c("ui.craft.craftFilter"),(!0));
        N.on("change", function(t) {
            S = t,
            t ? e.addFilters([M]) : e.removeFilter(M),
            e.filterList()
        }),
        I.on("confirm", s),
        w.on("ExchangeObjectAddedMessage", this.localizeEvent(p)),
        w.on("ExchangeObjectModifiedMessage", this.localizeEvent(p)),
        w.on("ExchangeItemPaymentForCraftMessage", this.localizeEvent(p)),
        w.on("ExchangeModifiedPaymentForCraftMessage", this.localizeEvent(p)),
        w.on("ExchangeObjectPutInBagMessage", this.localizeEvent(p)),
        w.on("ExchangeObjectModifiedInBagMessage", this.localizeEvent(p)),
        this.on("itemModified", this.localizeEvent(function(e) {
            p({
                object: e,
                remote: !1
            })
        })),
        w.on("ExchangeReplayCountModifiedMessage", this.localizeEvent(m)),
        w.on("ExchangeObjectRemovedMessage", this.localizeEvent(f)),
        w.on("ExchangeRemovedPaymentForCraftMessage", this.localizeEvent(f)),
        w.on("ExchangeClearPaymentForCraftMessage", this.localizeEvent(f)),
        w.on("ExchangeObjectRemovedFromBagMessage", this.localizeEvent(f)),
        this.on("open", function(o) {
            o = o || {},
            x = o.type;
            var s = o.msg;
            E = s.skillId;
            var r = s.maxCase || s.nbCase;
            "craftMagus" === x ? (A = {},
            M = i) : "decrafting" === x ? M = n : (A = C.getStorageCraftFilterMap(E, r),
            M = t),
            e.storageUI.appendChild(N),
            e.addFilters([a.unlinkedItemsFilter]),
            S && e.addFilters([M]),
            e.filterList(),
            e.resetDisplay()
        }),
        this.on("close", function() {
            I.hide(),
            A = null ,
            E = null ,
            x = null
        }),
        this.on("closed", function() {
            e.storageUI.removeChild(N),
            e.removeFilter(a.unlinkedItemsFilter),
            S && e.removeFilter(M),
            M = null ,
            e.resetItemsQuantity(),
            e.filterList()
        }),
        this.on("slot-doubletap", function(e, t, i) {
            T = !1,
            g(e, t, i, 1, !1)
        }),
        o(this, ["crafting", "craftPayment", "ingredientsBag"]),
        this.on("drop", function(e, t, i) {
            T = t,
            g(i.slot, i.x, i.y, i.slot.getQuantity())
        }),
        this.on("recipeSelected", function() {
            e.resetDisplay()
        })
    }
    i(936);
    var o = i(186).setDroppable
      , s = i(26).inherits
      , a = i(323)
      , r = i(323).isEquippable
      , l = i(402)
      , c = i(35).getText
      , u = i(201)
      , h = i(448)
      , d = i(463);
    s(n, l),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e(e) {
            if (e.exchangeType === l.PLAYER_TRADE) {
                var t = y.playerData;
                g = t.id,
                _ = t.characterBaseInformations.name;
                var i = d.setupNames(v._targetInfo.targetId, e.source);
                if (!i)
                    return console.error("TradeWithPlayer: setupNames");
                w = i.sourceName,
                b = i.targetName,
                d.setupCancelPopupTexts({
                    title: a("ui.exchange.requestInProgress"),
                    message: a("ui.exchange.requestInProgress")
                }),
                d.setupConfirmPopupTexts({
                    title: a("ui.exchange.exchangeRequest"),
                    message: a("ui.exchange.resquestMessage", w)
                }),
                d.askingExchangePopup()
            }
        }
        function t(e) {
            e.exchangeType === l.PLAYER_TRADE && (r.close("cancel", {
                keepDialog: !0
            }),
            v._domCreated || v._createDom(),
            y.once("ExchangeLeaveMessage", function(e) {
                var t, i = e.success;
                t = a(i ? "ui.exchange.success" : "ui.exchange.cancel"),
                y.chat.logMsg(t)
            }),
            e.firstCharacterId === g ? (I = e.firstCharacterCurrentWeight,
            T = e.secondCharacterCurrentWeight,
            S = e.firstCharacterMaxWeight,
            A = e.secondCharacterMaxWeight,
            C = b) : (T = e.firstCharacterCurrentWeight,
            I = e.secondCharacterCurrentWeight,
            A = e.firstCharacterMaxWeight,
            S = e.secondCharacterMaxWeight,
            C = w),
            v.setTitle(C + " <-> " + _),
            v._myTradeSpace.initializePods(I, S),
            v._otherCharacterTradeSpace.setAsRemote(),
            v._otherCharacterTradeSpace.initializePods(T, A),
            i(),
            r.continueDialog(["tradeWithPlayer", "tradeWithPlayerAndNPCInventory"]))
        }
        function i() {
            var e = v._otherCharacterTradeSpace.getEstimationPrice()
              , t = v._myTradeSpace.getEstimationPrice()
              , i = !1
              , n = !1
              , o = !1;
            t > 0 && t >= 2 * e && (i = !0,
            o = !0),
            e > 0 && e >= 2 * t && (i = !0,
            n = !0),
            v._otherCharacterTradeSpace.setEstimationPrice(e, {
                color: i,
                warning: n
            }),
            v._myTradeSpace.setEstimationPrice(t, {
                color: i,
                warning: o
            })
        }
        function n() {
            i(),
            window.clearTimeout(E),
            E = window.setTimeout(function() {
                (v._myTradeSpace.isGoldOrItemToTrade() || v._otherCharacterTradeSpace.isGoldOrItemToTrade()) && v._buttonConfirm.enable()
            }, 1e3 * p),
            v._buttonConfirm.disable()
        }
        function o(e) {
            v._exchangeStep += 1,
            e.remote ? v._otherCharacterTradeSpace.modifyKama(e.quantity) : v._myTradeSpace.modifyKama(e.quantity),
            n()
        }
        function c(e) {
            var t = e.remote
              , i = e.object
              , o = i.objectUID
              , s = i.quantity;
            v._exchangeStep += 1,
            v._toggleConfirmForMe(!1),
            h.createItemInstances(i, function(e, i) {
                if (e)
                    return console.error(e);
                var a = i.map[o]
                  , r = a.weight
                  , l = x[o];
                l || (l = x[o] = {});
                var c = l.quantity || 0;
                l.weight = r,
                l.quantity = s;
                var u = r * (s - c);
                t ? (v._otherCharacterTradeSpace.addAndModifyItem(a),
                v._otherCharacterTradeSpace.blink(p),
                v._otherCharacterTradeSpace.incrementExchangePodsQty(-u),
                v._myTradeSpace.incrementExchangePodsQty(u)) : (v._myTradeSpace.addAndModifyItem(a),
                v._otherCharacterTradeSpace.incrementExchangePodsQty(u),
                v._myTradeSpace.incrementExchangePodsQty(-u)),
                n()
            })
        }
        function u(e) {
            var t = e.remote
              , i = e.objectUID;
            v._exchangeStep += 1,
            v._toggleConfirmForMe(!1);
            var o = x[i];
            o || console.warn("TradeWithPlayer: no itemMap for", i);
            var s = o.weight * o.quantity;
            x[i] = {},
            t ? (v._otherCharacterTradeSpace.removeItem(i),
            v._otherCharacterTradeSpace.blink(p),
            v._otherCharacterTradeSpace.incrementExchangePodsQty(s),
            v._myTradeSpace.incrementExchangePodsQty(-s)) : (v._myTradeSpace.removeItem(i),
            v._otherCharacterTradeSpace.incrementExchangePodsQty(-s),
            v._myTradeSpace.incrementExchangePodsQty(s)),
            n()
        }
        function m(e) {
            var t = e.id
              , i = e.ready;
            t === g ? v._toggleConfirmForMe(i) : v._otherCharacterTradeSpace.toggleReady(i)
        }
        function f() {
            v.targetInfo = {},
            x = {},
            v._otherCharacterTradeSpace.reset(),
            v._myTradeSpace.reset(),
            v._toggleConfirmForMe(!1),
            v._otherCharacterTradeSpace.toggleReady(!1),
            v._buttonConfirm.disable(),
            v._exchangeStep = 0
        }
        s.call(this, {
            className: "TradeWithPlayerWindow",
            title: "",
            positionInfo: {
                left: "0.5%",
                top: "2%",
                width: "612px",
                height: "350px"
            }
        });
        var g, _, v = this, y = window.gui;
        this._targetInfo = {};
        var w, b, C, I, T, S, A, E, x = {};
        this._domCreated = !1,
        this._otherCharacterTradeSpace = null ,
        this._myTradeSpace = null ,
        this._buttonConfirm = null ,
        this._iConfirmed = !1,
        this._exchangeStep = 0,
        y.on("ExchangeRequestedTradeMessage", e),
        y.on("ExchangeStartedWithPodsMessage", t),
        y.on("ExchangeKamaModifiedMessage", this.localizeEvent(o)),
        y.on("ExchangeObjectAddedMessage", this.localizeEvent(c)),
        y.on("ExchangeObjectModifiedMessage", this.localizeEvent(c)),
        y.on("ExchangeObjectRemovedMessage", this.localizeEvent(u)),
        y.on("ExchangeIsReadyMessage", this.localizeEvent(m)),
        this._toggleConfirmForMe = function(e) {
            v._iConfirmed = e,
            v._myTradeSpace.toggleReady(e),
            e ? v._buttonConfirm.disable() : v._buttonConfirm.enable()
        }
        ,
        this.on("close", f)
    }
    i(938);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(22)
      , l = i(418)
      , c = i(939)
      , u = i(204).DofusButton
      , h = i(323)
      , d = i(465)
      , p = 2;
    o(n, s),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this
          , t = this.windowBody
          , i = t.createChild("div", {
            className: ["otherCharacterSpace", "tradeSpace"]
        });
        this._otherCharacterTradeSpace = i.appendChild(new c({
            blinkDuration: p
        }));
        var n = t.createChild("div", {
            className: ["mySpace", "tradeSpace"]
        });
        this._myTradeSpace = n.appendChild(new c({
            blinkDuration: p,
            dragInteraction: !0,
            canRemove: !0
        }));
        var o = t.createChild("div", {
            className: "tradeButtons"
        });
        this._buttonConfirm = o.appendChild(new u(a("ui.common.validation"),{
            className: "buttonConfirm",
            disable: !0
        })),
        this._buttonConfirm.on("tap", function() {
            e._iConfirmed || window.dofus.sendMessage("ExchangeReadyMessage", {
                ready: !0,
                step: e._exchangeStep
            })
        });
        var s = o.appendChild(new u(a("ui.common.cancel"),{
            className: "buttonCancel"
        }));
        s.on("tap", function() {
            return e._iConfirmed ? window.dofus.sendMessage("ExchangeReadyMessage", {
                ready: !1,
                step: e._exchangeStep
            }) : void r.close(e.id)
        }),
        this._domCreated = !0
    }
    ,
    n.prototype.prepareMakeExchange = function(e) {
        this._targetInfo = e
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        e = e || {},
        s.call(this, "div", {
            className: "TradeSpace"
        });
        var t = this;
        this._isRemote = !1,
        this._blinkDuration = e.blinkDuration || 5,
        this._blinkTimeout = null ,
        this._currentUID = null ,
        this._podsTooltip = new s("div"),
        this._podsTooltipText = "",
        this._maxPods = 0,
        this._currentPods = 0,
        this._exchangePods = 0,
        this._podsPercent = 0,
        this._estimationPrice = {},
        this.selectedSlot = null ,
        this._minMaxSelector = this.appendChild(new l),
        this._minMaxSelector.setStyles({
            left: "20px",
            top: "50px"
        }),
        this._minMaxSelector.on("confirm", function(e) {
            window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: t._currentUID,
                quantity: e * (this.fromInventory ? 1 : -1)
            })
        }),
        this._tradeGold = this.appendChild(new a),
        this._tradeGold.on("kamaChange", function(e) {
            window.dofus.sendMessage("ExchangeObjectMoveKamaMessage", {
                quantity: e
            })
        }),
        this._exchangePodsContent = this.createChild("div", {
            className: "exchangePodsContent"
        }),
        this._exchangePodsProgressBar = this._exchangePodsContent.appendChild(new h({
            className: "exchangePodsProgressBar"
        })),
        d(this._exchangePodsProgressBar, t._podsTooltip);
        var i = this.createChild("div", {
            className: "slotBox"
        });
        e.dragInteraction && (p.setDroppable(i, ["tradeWithPlayerAndNPCInventory"]),
        i.on("drop", function(e) {
            var i = e.itemInstance
              , n = e.getQuantity();
            return 1 === n ? window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: i.objectUID,
                quantity: 1
            }) : (t._currentUID = i.objectUID,
            t._minMaxSelector.fromInventory = !0,
            void t._minMaxSelector.open({
                min: 1,
                max: n
            }))
        })),
        this.canRemove = e.canRemove,
        this._allSlots = i.createChild("div", {
            className: "slots"
        });
        var n = this.createChild("div", {
            className: "estimationContent"
        });
        n.createChild("div", {
            className: ["estimationLabel", "half"],
            text: u("ui.exchange.estimatedValue") + u("ui.common.colon")
        });
        var o = n.createChild("div", {
            className: ["estimationValueContent", "half"]
        });
        this._estimationValue = o.createChild("div", {
            className: "estimationValue"
        }),
        this._estimationWarning = o.createChild("div", {
            className: "estimationWarning"
        });
        var r = null ;
        d(this._estimationWarning, function() {
            return r ? r : r = new s("div",{
                text: u("ui.exchange.warning")
            })
        })
    }
    i(940);
    var o = i(26).inherits
      , s = i(190)
      , a = i(941)
      , r = i(567)
      , l = i(201)
      , c = i(210)
      , u = i(35).getText
      , h = i(643)
      , d = i(206).addTooltip
      , p = i(186);
    o(n, s),
    e.exports = n,
    n.prototype.setAsRemote = function() {
        this._isRemote = !0,
        this._tradeGold.setAsRemote()
    }
    ,
    n.prototype.modifyKama = function(e) {
        this._isRemote && this._tradeGold.blink(this._blinkDuration),
        this._tradeGold.setKama(e)
    }
    ,
    n.prototype.blink = function(e) {
        e = e || 3;
        var t = this;
        window.clearTimeout(this._blinkTimeout),
        this._blinkTimeout = window.setTimeout(function() {
            t._allSlots.delClassNames("blink")
        }, 1e3 * e),
        this._allSlots.addClassNames("blink")
    }
    ,
    n.prototype.setEstimationPrice = function(e, t) {
        t = t || {},
        this._estimationValue.setText(c.kamasToString(e)),
        this._estimationValue.toggleClassName("warning", t.color),
        this._estimationWarning.setStyle("visibility", t.warning ? "visible" : "hidden")
    }
    ,
    n.prototype.addAndModifyItem = function(e) {
        function t() {
            var t = s._estimationPrice[l]
              , i = e.item.averagePrice;
            i < 0 || (t || (t = s._estimationPrice[l] = {}),
            t.averagePrice = e.item.averagePrice,
            t.quantity = c)
        }
        function i() {
            if (!s._isRemote && s.canRemove) {
                var e = o.itemInstance;
                if (e) {
                    s._currentUID = e.objectUID;
                    var t = e.quantity;
                    if (1 === t)
                        return window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                            objectUID: s._currentUID,
                            quantity: -1
                        });
                    s._minMaxSelector.fromInventory = !1,
                    s._minMaxSelector.open({
                        min: 1,
                        max: e.quantity
                    })
                }
            }
        }
        function n(e) {
            "remove" === e && i()
        }
        var o, s = this, a = this._allSlots, l = e.objectUID, c = e.quantity;
        t(),
        o = a.getChild("slot" + l),
        o || (o = a.appendChild(new r({
            name: "slot" + l
        })),
        o.setContextMenu("item", {
            item: o.itemInstance,
            remove: s.canRemove,
            onClose: n,
            enableActions: !1
        }),
        s.canRemove && (o.on("doubletap", i),
        o.on("tap", function() {
            s.selectedSlot && s.selectedSlot.delClassNames("selected"),
            s.selectedSlot = this,
            s.selectedSlot.addClassNames("selected")
        }))),
        o.setItem(e)
    }
    ,
    n.prototype.removeItem = function(e) {
        delete this._estimationPrice[e];
        var t = this._allSlots.getChild("slot" + e);
        t && (t === this.selectedSlot && (this.selectedSlot = null ),
        t.destroy())
    }
    ,
    n.prototype.getEstimationPrice = function() {
        var e = this._tradeGold.getKama()
          , t = this._estimationPrice;
        for (var i in t) {
            var n = t[i];
            e += n.quantity * n.averagePrice
        }
        return e
    }
    ,
    n.prototype.toggleReady = function(e) {
        this._tradeGold.toggleReady(e),
        this._allSlots.toggleClassName("isReady", e)
    }
    ,
    n.prototype.setPodsProgressBar = function() {
        var e = this._maxPods
          , t = this._currentPods
          , i = this._exchangePods;
        if (e) {
            var n = this._podsPercent = Math.min(100, Math.floor(100 * (t + i) / e));
            this._exchangePodsProgressBar.setValue(this._podsPercent / 100),
            n <= 60 ? this._exchangePodsProgressBar.replaceClassNames(["yellow", "orange", "red"], ["green"]) : n <= 70 ? this._exchangePodsProgressBar.replaceClassNames(["green", "orange", "red"], ["yellow"]) : n <= 80 ? this._exchangePodsProgressBar.replaceClassNames(["green", "yellow", "red"], ["orange"]) : this._exchangePodsProgressBar.replaceClassNames(["green", "yellow", "orange"], ["red"]),
            this._podsTooltipText = u("ui.common.player.weight", c.kamasToString(t + i, ""), c.kamasToString(e, "")),
            this._podsTooltip.setText(this._podsTooltipText)
        }
    }
    ,
    n.prototype.initializePods = function(e, t) {
        this._maxPods = t,
        this._currentPods = e,
        this._exchangePods = 0,
        this.setPodsProgressBar()
    }
    ,
    n.prototype.NPCTradeMode = function() {
        this._exchangePodsContent.hide(),
        this._tradeGold.setReadOnly(!0)
    }
    ,
    n.prototype.incrementExchangePodsQty = function(e) {
        this._exchangePods += e,
        this.setPodsProgressBar()
    }
    ,
    n.prototype.isGoldOrItemToTrade = function() {
        if (this._tradeGold.getKama() > 0)
            return !0;
        for (var e = this._allSlots.getChildren(), t = 0, i = e.length; t < i; t += 1) {
            var n = e[t];
            if (n.itemInstance)
                return !0
        }
        return !1
    }
    ,
    n.prototype.reset = function() {
        this._tradeGold.reset(),
        this._isRemote = !1,
        this._currentUID = null ,
        this._maxPods = 0,
        this._currentPods = 0,
        this._exchangePods = 0,
        this._podsPercent = 0,
        this._estimationPrice = {},
        this._exchangePodsContent.show(),
        this._tradeGold.show(),
        window.clearTimeout(this._blinkTimeout),
        this._allSlots.delClassNames("blink"),
        this._podsTooltip.setText(""),
        this._allSlots.clearContent(),
        this.selectedSlot = null
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "TradeGold"
        });
        var e = this;
        this._blinkTimeout = null ,
        this._currentKama = 0,
        this._kamaContent = this.createChild("div", {
            className: "kamaContent"
        });
        var t;
        l.addTooltip(this._kamaContent, function() {
            return t || (t = new s("div",{
                className: "kamaTooltip",
                text: a("ui.exchange.kamas")
            })),
            t
        }),
        l.enableTooltip(this._kamaContent, !1);
        var i = this._kamaContent.createChild("div", {
            className: "imgContent"
        });
        i.createChild("div", {
            className: "kamaImg"
        });
        var n = this._kamaContent.createChild("div", {
            className: "kamaInput"
        })
          , o = this._input = n.appendChild(new r({
            minValue: 0,
            title: a("ui.common.kamas")
        }));
        n.createChild("div", {
            className: "kamaUnit",
            text: a("ui.common.short.kama")
        }),
        o.on("focus", function() {
            o.maxValue = window.gui.playerData.inventory.kamas
        }),
        o.on("change", function(t) {
            e._currentKama !== t && (e._currentKama = t,
            e.emit("kamaChange", t))
        })
    }
    i(942);
    var o = i(26).inherits
      , s = i(190)
      , a = i(35).getText
      , r = i(208)
      , l = i(206);
    o(n, s),
    e.exports = n,
    n.prototype.getKama = function() {
        return this._input.getValue()
    }
    ,
    n.prototype.setKama = function(e) {
        this._input.setValue(e)
    }
    ,
    n.prototype.blink = function(e) {
        e = e || 3;
        var t = this;
        window.clearTimeout(this._blinkTimeout),
        this._blinkTimeout = window.setTimeout(function() {
            t._kamaContent.delClassNames("blink")
        }, 1e3 * e),
        this._kamaContent.addClassNames("blink")
    }
    ,
    n.prototype.toggleReady = function(e) {
        this._kamaContent.toggleClassName("isReady", e)
    }
    ,
    n.prototype.setAsRemote = function() {
        l.enableTooltip(this._kamaContent, !0),
        this._input.setReadonly(!0)
    }
    ,
    n.prototype.reset = function() {
        this._input.setValue(0),
        this._input.setReadonly(!1),
        window.clearTimeout(this._blinkTimeout),
        this._kamaContent.delClassNames("blink"),
        this._currentKama = 0,
        l.enableTooltip(this._kamaContent, !1)
    }
    ,
    n.prototype.setReadOnly = function(e) {
        this._input.setReadonly(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            p._domCreated || p._createDom(),
            m.once("ExchangeLeaveMessage", function(e) {
                var t, i = e.success;
                t = a(i ? "ui.exchange.success" : "ui.exchange.cancel"),
                m.chat.logMsg(t)
            }),
            p.setTitle(p._npcName + " <-> " + m.playerData.characterBaseInformations.name),
            p._myTradeSpace.NPCTradeMode(),
            p._npcTradeSpace.setAsRemote(),
            p._npcTradeSpace.NPCTradeMode(),
            t(),
            r.continueDialog(["tradeWithNPC", "tradeWithPlayerAndNPCInventory"])
        }
        function t() {
            var e = p._npcTradeSpace.getEstimationPrice()
              , t = p._myTradeSpace.getEstimationPrice()
              , i = !1
              , n = !1
              , o = !1;
            t > 0 && t >= 2 * e && (i = !0,
            o = !0),
            e > 0 && e >= 2 * t && (i = !0,
            n = !0),
            p._npcTradeSpace.setEstimationPrice(e, {
                color: i,
                warning: n
            }),
            p._myTradeSpace.setEstimationPrice(t, {
                color: i,
                warning: o
            })
        }
        function i() {
            t(),
            window.clearTimeout(d),
            d = window.setTimeout(function() {
                p._npcTradeSpace.isGoldOrItemToTrade() && p._buttonConfirm.enable()
            }, 1e3 * h),
            p._buttonConfirm.disable()
        }
        function n(e) {
            var t = e.remote
              , n = e.object
              , o = n.objectUID;
            p._exchangeStep += 1,
            u.createItemInstances(n, function(e, n) {
                if (e)
                    return console.error(e);
                var s = n.map[o];
                t ? (p._npcTradeSpace.addAndModifyItem(s),
                p._npcTradeSpace.blink(h)) : p._myTradeSpace.addAndModifyItem(s),
                i()
            })
        }
        function o(e) {
            var t = e.remote
              , n = e.objectUID;
            p._exchangeStep += 1,
            t ? (p._npcTradeSpace.removeItem(n),
            p._npcTradeSpace.blink(h)) : p._myTradeSpace.removeItem(n),
            i()
        }
        function l() {
            p._npcTradeSpace.reset(),
            p._myTradeSpace.reset(),
            p._buttonConfirm.disable(),
            p._exchangeStep = 0
        }
        function c(e) {
            p._exchangeStep += 1,
            e.remote ? p._npcTradeSpace.modifyKama(e.quantity) : p._myTradeSpace.modifyKama(e.quantity)
        }
        s.call(this, {
            className: "TradeWithNPCWindow",
            title: "",
            positionInfo: {
                left: "0.5%",
                top: "2%",
                width: "612px",
                height: "300px"
            }
        });
        var d, p = this, m = window.gui;
        this._npcName = "",
        this._domCreated = !1,
        this._npcTradeSpace = null ,
        this._myTradeSpace = null ,
        this._buttonConfirm = null ,
        this._exchangeStep = 0,
        m.on("ExchangeStartOkNpcTradeMessage", e),
        m.on("ExchangeKamaModifiedMessage", this.localizeEvent(c)),
        m.on("ExchangeObjectAddedMessage", this.localizeEvent(n)),
        m.on("ExchangeObjectModifiedMessage", this.localizeEvent(n)),
        m.on("ExchangeObjectRemovedMessage", this.localizeEvent(o)),
        this.on("closed", l)
    }
    i(944);
    var o = i(26).inherits
      , s = i(402)
      , a = i(35).getText
      , r = i(22)
      , l = i(939)
      , c = i(204).DofusButton
      , u = i(323)
      , h = 2;
    o(n, s),
    e.exports = n,
    n.prototype.prepareExchange = function(e) {
        this._npcName = e
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.windowBody
          , i = t.createChild("div", {
            className: ["otherCharacterSpace", "tradeSpace"]
        });
        this._npcTradeSpace = i.appendChild(new l({
            blinkDuration: h
        }));
        var n = t.createChild("div", {
            className: ["mySpace", "tradeSpace"]
        });
        this._myTradeSpace = n.appendChild(new l({
            blinkDuration: h,
            dragInteraction: !0
        }));
        var o = t.createChild("div", {
            className: "tradeButtons"
        });
        this._buttonConfirm = o.appendChild(new c(a("ui.common.validation"),{
            className: "buttonConfirm",
            disable: !0
        })),
        this._buttonConfirm.on("tap", function() {
            window.dofus.sendMessage("ExchangeReadyMessage", {
                ready: !0,
                step: e._exchangeStep
            })
        });
        var s = o.appendChild(new c(a("ui.common.cancel"),{
            className: "buttonCancel"
        }));
        s.on("tap", function() {
            r.close(e.id)
        }),
        this._domCreated = !0
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t() {
            for (var t in h)
                e.resetItemQuantity(t);
            h = {}
        }
        function i(t) {
            if (!t.remote) {
                var i = t.object.objectUID
                  , n = c.objects[i];
                e.setItemQuantity(i, n.quantity - t.object.quantity),
                h[i] = !0
            }
        }
        function n(t) {
            if (!t.remote) {
                var i = t.objectUID;
                e.resetItemQuantity(i),
                delete h[i]
            }
        }
        a.call(this, {
            title: r("ui.common.inventory"),
            className: "TradeWithPlayerAndNPCInventoryWindow",
            positionInfo: {
                right: "0.5%",
                top: "2%",
                width: "23.2%",
                height: "95%"
            }
        }),
        this.storageViewer = e,
        e.registerView(this, {
            manualReset: !0
        });
        var o, c = window.gui.playerData.inventory, u = window.gui, h = {}, d = this.appendChild(new l);
        d.setStyles({
            left: "-100px",
            top: "100px"
        }),
        d.on("confirm", function(e) {
            window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: o,
                quantity: e
            })
        }),
        u.on("ExchangeObjectRemovedMessage", this.localizeEvent(n)),
        u.on("ExchangeObjectAddedMessage", this.localizeEvent(i)),
        u.on("ExchangeObjectModifiedMessage", this.localizeEvent(i)),
        this.on("open", function() {
            e.addFilters([s.unlinkedItemsFilter]),
            e.filterList(),
            e.resetDisplay()
        }),
        this.on("close", function() {
            e.removeFilter(s.unlinkedItemsFilter),
            d.hide(),
            t()
        }),
        this.on("slot-doubletap", function(e) {
            var t = e.itemInstance;
            o = t.objectUID;
            var i = e.getQuantity();
            return 1 === i ? window.dofus.sendMessage("ExchangeObjectMoveMessage", {
                objectUID: o,
                quantity: 1
            }) : void d.open({
                min: 1,
                max: i
            })
        })
    }
    i(946);
    var o = i(26).inherits
      , s = i(323)
      , a = i(402)
      , r = i(35).getText
      , l = i(201);
    o(n, a),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "CancelWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 600,
                height: 200
            },
            noCloseButton: !0
        });
        var e = this;
        this.message = this.windowBody.createChild("div", {
            className: "message"
        });
        var t = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , i = t.appendChild(new a(r("ui.common.cancel")));
        i.on("tap", function() {
            "function" == typeof e.cb && e.cb(),
            e.close()
        })
    }
    i(948);
    var o = i(26).inherits
      , s = i(402)
      , a = i(204).DofusButton
      , r = i(35).getText;
    o(n, s),
    e.exports = n,
    n.prototype.update = function(e, t) {
        t = t || {},
        this.windowTitle.setText(e.title),
        this.message.setHtml(e.message),
        this.cb = e.cb,
        this.keepDialog = t.keepDialog
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        I.call(this, {
            className: "OptionsWindow",
            title: m("ui.common.options"),
            positionInfo: {
                left: "c",
                top: "c",
                width: "80%",
                height: "70%"
            }
        }),
        this.optionDefinitions = null ,
        this.sections = null ,
        this.currentSection = null ,
        this.optionMap = null ,
        this.on("open", this._open)
    }
    function o(e) {
        g.changeValue(this.myName, e)
    }
    function s(e, t, i) {
        var n = e.appendChild(new p(i,(!1)));
        return n.addClassNames("settingOption"),
        n.myName = t,
        n.on("change", o),
        n
    }
    function a(e, t, i, n) {
        var o = e.appendChild(new d(t,{
            className: ["settingOption", "optionButton"]
        },n));
        i && u.addTooltip(o, i)
    }
    function r(e) {
        g.changeValue(this.myName, e)
    }
    function l(e, t, i, n, o) {
        o = o || n;
        var s = e.createChild("div");
        s.createChild("div", {
            className: ["settingOption", "dropdownLabel"],
            text: i
        });
        var a = s.appendChild(new v({
            className: "settingOption"
        }));
        a.myName = t,
        a.on("change", r);
        for (var l = 0; l < n.length; l++)
            a.addOption(o[l], n[l]);
        return a
    }
    function c(e) {
        var t = e.showedFor;
        if (!t)
            return !0;
        for (var i = 0; i < t.length; i++)
            switch (t[i]) {
            case "narrowScreen":
                if (window.gui.ipadRatio)
                    return !0;
                break;
            default:
                console.error("Invalid showedFor value:", t[i])
            }
        return !1
    }
    i(950);
    var u = i(206)
      , h = i(84)
      , d = i(204).DofusButton
      , p = i(448)
      , m = i(35).getText
      , f = i(26).inherits
      , g = i(25)
      , _ = i(302)
      , v = i(393)
      , y = i(315).SingleSelectionList
      , w = i(951)
      , b = i(601)
      , C = i(30)
      , I = i(402);
    f(n, I),
    e.exports = n,
    n.prototype._initOptionDefinitions = function() {
        this.optionDefinitions = [{
            name: "game",
            title: m("ui.common.general"),
            optionDefs: [{
                type: "header",
                text: m("ui.option.worldOption")
            }, {
                name: "showAllMonsters",
                text: m("ui.option.viewAllMonsterInGroup")
            }, {
                name: "maxActorsBeforeCreatureMode",
                type: "dropdown",
                text: m("ui.option.creaturesMode"),
                values: [0, 10, 20, 40, 9999],
                labels: [0, 10, 20, 40, m("ui.common.infinit")]
            }, {
                name: "alwaysShowGrid",
                text: m("tablet.option.alwaysShowGrid")
            }, {
                name: "menubarSize",
                type: "dropdown",
                text: m("tablet.option.menubarSize"),
                values: [2, 3, 4, 5, 6],
                labels: [2, 3, 4, 5, 6]
            }, {
                type: "header",
                text: m("tablet.option.compass")
            }, {
                name: "autoGpsFlags",
                text: m("tablet.option.autoGpsFlags")
            }, {
                type: "btn",
                text: m("tablet.option.unfollowAllQuests"),
                action: window.gui.GPS.questFollower.unfollowAllQuests.bind(window.gui.GPS.questFollower)
            }, {
                name: "autoGpsPhoenixes",
                text: m("tablet.option.autoGpsPhoenixes")
            }]
        }, {
            name: "fight",
            title: m("tablet.option.fight"),
            optionDefs: [{
                type: "header",
                text: m("tablet.option.fight")
            }, {
                name: "menubarSizeInFight",
                type: "dropdown",
                text: m("tablet.option.fight.menubarSizeInFight"),
                values: [2, 3, 4, 5, 6],
                labels: [2, 3, 4, 5, 6]
            }, {
                name: "toolbarThicknessInFight",
                type: "dropdown",
                showedFor: ["narrowScreen"],
                text: m("tablet.option.fight.toolbarThicknessInFight"),
                values: [1, 2, 3],
                labels: [1, 2, 3]
            }, {
                name: "hideDeadFighters",
                text: m("ui.option.hideDeadFighters")
            }, {
                name: "allowSpellEffects",
                text: m("ui.option.allowSpellEffects")
            }, {
                name: "confirmBoxWhenDragCasting",
                text: m("tablet.option.fight.confirmBoxWhenDragCasting")
            }, {
                name: "confirmBoxWhenClickCasting",
                text: m("tablet.option.fight.confirmBoxWhenClickCasting")
            }, {
                name: "confirmBoxWhenWalking",
                text: m("tablet.option.fight.confirmBoxWhenWalking")
            }, {
                name: "showSpeechBubbleInFight",
                text: m("tablet.option.fight.showSpeechBubbleInFight")
            }, {
                name: "orderFighters",
                text: m("tablet.option.fight.orderFighters")
            }, {
                name: "showApMpUsed",
                text: m("tablet.option.fight.showApMpUsed")
            }]
        }, {
            name: "sounds",
            title: m("ui.option.audio"),
            optionDefs: [{
                type: "header",
                text: m("ui.option.audioSubtitle")
            }, {
                name: "soundOnPlayerTurnStart",
                text: m("ui.option.startTurnSound")
            }],
            create: n.prototype._createSoundOptions,
            init: n.prototype._initSoundOptions
        }, {
            name: "misc",
            title: m("ui.option.miscellaneousOptions"),
            optionDefs: [{
                type: "header",
                text: m("ui.tutorial.tutorial")
            }, {
                name: "tutorialTips",
                text: m("ui.option.allowTutorial")
            }, {
                type: "btn",
                text: m("ui.option.resetHints"),
                action: b.resetTips.bind(b)
            }, {
                type: "header",
                text: m("tablet.option.spellTooltip")
            }, {
                name: "spellTooltipName",
                text: m("tablet.option.spellTooltipName")
            }, {
                name: "spellTooltipApRange",
                text: m("tablet.option.spellTooltipApRange")
            }, {
                name: "spellTooltipCritical",
                text: m("tablet.option.spellTooltipCritical")
            }, {
                name: "spellTooltipEffect",
                text: m("tablet.option.spellTooltipEffect")
            }, {
                name: "spellTooltipDescription",
                text: m("tablet.option.spellTooltipDescription")
            }]
        }]
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this.sections = this.currentSection = null
    }
    ,
    n.prototype._open = function() {
        this.sections || (this._createContent(),
        this.menuList.selectItem(0, {
            noSound: !0
        })),
        this._initContent()
    }
    ,
    n.prototype._initContent = function() {
        for (var e = 0; e < this.optionDefinitions.length; e++)
            this._initOptionSection(e, this.optionDefinitions[e])
    }
    ,
    n.prototype._createContent = function() {
        this.sections = [],
        this.optionMap = {},
        this._initOptionDefinitions();
        var e = this.windowBody.createChild("div", {
            className: "content"
        })
          , t = e.createChild("div", {
            className: "menuCol"
        });
        this.menuList = t.appendChild(new y({
            className: "menu"
        },{
            disableSelectionToggle: !0
        }));
        var i = this;
        this.menuList.on("selected", function(e) {
            i._showSection(e.id),
            this.scrollToElement(e)
        });
        var n = e.createChild("div", {
            className: "settingsCol"
        });
        this.settingsScroller = n.appendChild(new _({
            className: "settings"
        })),
        this.settingsCol = this.settingsScroller.content;
        for (var o = 0; o < this.optionDefinitions.length; o++)
            this._createOptionSection(this.optionDefinitions[o])
    }
    ,
    n.prototype._showSection = function(e) {
        this.currentSection && this.currentSection.hide(),
        this.currentSection = this.sections[e],
        this.currentSection.show(),
        this.settingsScroller.refresh()
    }
    ,
    n.prototype._createOptionSection = function(e) {
        var t = this.sections.length
          , i = this.menuList.addItem({
            id: t,
            element: e.title
        }, {
            noRefresh: !0
        });
        t % 2 && i.addClassNames("odd");
        var n = this.settingsCol.createChild("div", {
            className: ["optionSection", e.name + "Section"],
            hidden: !0
        });
        if (e.text) {
            var o = n.createChild("div", {
                className: "titleBox"
            });
            o.createChild("div", {
                className: "sectionDescription",
                text: e.text
            })
        }
        for (var r = n.createChild("div", {
            className: "allOptions"
        }), u = e.optionDefs, h = 0; h < u.length; h++) {
            var d = u[h];
            if (c(d)) {
                var p = d.type || "bool"
                  , m = null ;
                switch (p) {
                case "bool":
                    m = s(r, d.name, d.text);
                    break;
                case "dropdown":
                    m = l(r, d.name, d.text, d.values, d.labels);
                    break;
                case "btn":
                    a(r, d.text, d.tooltipText, d.action);
                    break;
                case "header":
                    r.createChild("div", {
                        className: "header",
                        text: d.text
                    });
                    break;
                default:
                    console.warn("Unvalid option type:", p)
                }
                m && (this.optionMap[d.name] = m)
            }
        }
        return e.create && e.create.call(this, r),
        this.sections.push(n),
        n
    }
    ,
    n.prototype._initOptionSection = function(e, t) {
        for (var i = t.optionDefs, n = 0; n < i.length; n++) {
            var o = i[n]
              , s = o.name;
            if (c(o)) {
                var a = this.optionMap[s]
                  , r = o.type || "bool";
                switch (r) {
                case "bool":
                    a.toggleActivation(g[s], !0);
                    break;
                case "dropdown":
                    a.select(g[s], !0);
                    break;
                case "btn":
                    break;
                case "header":
                    break;
                default:
                    console.warn("Unvalid option type:", r)
                }
            }
        }
        t.init && t.init.call(this)
    }
    ,
    n.prototype._newSoundChannelOption = function(e, t, i, n) {
        this.optionMap[t + "Sound"] = e.appendChild(new w(n,t,i))
    }
    ,
    n.prototype._setSoundChannelVolume = function(e, t) {
        this.optionMap[e + "Sound"].setPosition(t[e].volume || 0)
    }
    ,
    n.prototype._createSoundOptions = function(e) {
        var t = C.getValue("soundPreferences", h.getDefaultParams(), !0);
        this._newSoundChannelOption(e, "music", m("ui.option.musics"), t),
        this._newSoundChannelOption(e, "sfx", m("ui.option.environment"), t),
        this._newSoundChannelOption(e, "ui", m("ui.option.sounds"), t)
    }
    ,
    n.prototype._initSoundOptions = function() {
        var e = C.getValue("soundPreferences", h.getDefaultParams(), !0);
        this._setSoundChannelVolume("music", e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        function n() {
            a.changeVolume(this.volume),
            l.playUiSound("SPEC_BUTTON")
        }
        o.call(this, "div", {
            className: "SoundChannelVolume"
        });
        var a = this;
        this.channelId = t,
        this.preferences = e,
        this.createChild("div", {
            className: "label",
            text: i
        });
        for (var r = this.createChild("div", {
            className: "volumeButtons"
        }), c = this.buttons = [], u = 0; u < 5; u++) {
            var h = r.appendChild(new s("",{
                className: ["volume", "volume" + u]
            }));
            c.push(h),
            h.volume = u / 4,
            h.disable(),
            h.on("tap", n)
        }
        e[this.channelId] = e[this.channelId] || {
            volume: 0,
            muted: !0
        },
        this.setPosition(e[this.channelId].volume || 0);
    }
    i(952);
    var o = i(190)
      , s = i(204).DofusButton
      , a = i(26).inherits
      , r = i(30)
      , l = i(84);
    a(n, o),
    e.exports = n,
    n.prototype.setPosition = function(e) {
        e = Math.max(0, Math.min(4, ~~(4 * e)));
        for (var t = 0; t < 5; t++)
            this.buttons[t].enable();
        this.buttons[e].disable()
    }
    ,
    n.prototype.changeVolume = function(e) {
        l.setChannelVolume(this.channelId, e),
        this.setPosition(e),
        this.preferences[this.channelId].volume = e,
        this.preferences[this.channelId].muted = 0 === e,
        r.setValue("soundPreferences", this.preferences, null , !0)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, {
            className: "FightEndRewardsWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 356,
                height: 274
            }
        }),
        this.scroller = this.windowBody.appendChild(new a),
        this.scroller.content.addClassNames("overlayBox")
    }
    i(954);
    var o = i(26).inherits
      , s = i(567)
      , a = i(302)
      , r = i(402);
    o(n, r),
    e.exports = n,
    n.prototype.updateContent = function(e, t, i) {
        this.setTitle(e);
        var n = this.scroller.content;
        n.clearContent();
        for (var o = 0; o < t.length; o += 1)
            n.appendChild(new s({
                itemData: t[o],
                quantity: i[t[o].id] || 0
            }));
        this.scroller.refresh()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, {
            className: "HardcoreDeathWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 365
            }
        });
        var e = this;
        this.once("open", function() {
            e._createDom()
        })
    }
    i(956);
    var o = i(26).inherits
      , s = i(50)
      , a = i(402)
      , r = i(190)
      , l = i(22)
      , c = i(204).DofusButton
      , u = i(35).getText
      , h = i(5);
    o(n, a),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this
          , t = this.windowBody.createChild("div", {
            className: "message"
        })
          , i = new r("div",{
            className: "characterIllu"
        });
        this.insertAsFirstChild(i),
        h.preloadImage("gfx/illusUi/Heroique_tx_GameOver.png", function(e) {
            i.setStyle("backgroundImage", e)
        });
        var n = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , o = n.appendChild(new c(u("ui.common.yes")));
        o.on("tap", function() {
            l.close(e.id),
            s.goBackToSelectionOf("character")
        }),
        this.windowTitle.setText(u("ui.common.gameover")),
        t.setHtml(u("ui.gameuicore.hardcoreDeath"))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this, {
            title: s("ui.common.confirm"),
            className: "ShopConfirmWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 300,
                isModal: !0
            }
        }),
        this._reset(),
        this.on("open", this._onOpen),
        this.on("close", this._onClose);
        var e = this;
        l.on("canNotComputeSoftPrices", function() {
            if (e.articleBox) {
                var t = !e.isPurchasing
                  , i = !e.params.article.product && !!e.params.isSoft;
                t && i && u.close(e.id)
            }
        }),
        l.on("computedSoftPricesChange", function() {
            if (e.articleBox) {
                var t = !e.isPurchasing
                  , i = !e.params.article.product && !!e.params.isSoft;
                t && i && (h.enrichWithSoftPrice(e.params.article),
                e.updateAmount())
            }
        })
    }
    i(958);
    var o = i(204)
      , s = i(35).getText
      , a = i(210)
      , r = i(26).inherits
      , l = i(548)
      , c = i(402)
      , u = i(22)
      , h = i(633)
      , d = i(959);
    r(n, c),
    e.exports = n,
    n.prototype._reset = function() {
        this.params = null ,
        this.cb = null ,
        this.articleBox = null ,
        this.buyBtn = null ,
        this.buyBtnAmount = null ,
        this.buyBtnIcon = null ,
        this.purchaseLoader = null ,
        this._setIsPurchasing(!1)
    }
    ,
    n.prototype._onOpen = function() {
        this.articleBox || this._createContent()
    }
    ,
    n.prototype._onClose = function() {
        return this.cb && this.cb(!1)
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this._reset()
    }
    ,
    n.prototype._createContent = function() {
        var e = this.windowBody.createChild("div", {
            className: "twoColumns"
        })
          , t = e.createChild("div", {
            className: "leftCol"
        });
        this.articleBox = t.appendChild(new d(null ,{
            boxWidth: 190,
            boxHeight: 220
        },{
            showTitle: !0,
            promoType: "corner"
        }));
        var i = e.createChild("div", {
            className: "rightCol"
        });
        i.createChild("div", {
            className: "buyLabel",
            text: s("ui.common.buy")
        });
        var n = s("ui.common.quantity") + s("ui.common.colon") + "1";
        i.createChild("div", {
            className: "quantityLabel",
            text: n
        });
        var a = this;
        this.buyBtn = i.appendChild(new o({
            className: ["buyBtn", "greenButton"]
        },function() {
            a._setIsPurchasing(!0),
            a.cb(!0)
        }
        ));
        var r = this.buyBtn.createChild("div", {
            className: "btnContent"
        });
        this.buyBtnAmount = r.createChild("div", {
            className: "btnAmount"
        }),
        this.buyBtnIcon = r.createChild("div", {
            className: "btnIcon"
        }),
        this.purchaseLoader = i.createChild("div", {
            className: ["purchaseLoader", "spinner"],
            hidden: !0
        }),
        this.purchaseLoader.createChild("div", {
            className: "purchaseLoaderLabel",
            text: s("tablet.shop.transactionInProgress")
        })
    }
    ,
    n.prototype.confirmBuy = function(e, t) {
        u.open(this.id),
        this._setIsPurchasing(!1),
        this.params = e,
        this.cb = t,
        this.articleBox.update(e.article),
        this.updateAmount()
    }
    ,
    n.prototype._setIsPurchasing = function(e) {
        this.isPurchasing = !!e,
        this.articleBox && (e ? (this.closeButton.disable(),
        this.buyBtn.disable()) : (this.closeButton.enable(),
        this.buyBtn.enable()),
        this.purchaseLoader.toggleDisplay(e))
    }
    ,
    n.prototype.updateAmount = function() {
        if (this.articleBox) {
            var e = this.params
              , t = e.article
              , i = t.product;
            if (i)
                this.buyBtnAmount.setText(i.price),
                this.buyBtnIcon.hide();
            else {
                var n = e.isSoft
                  , o = window.gui.playerData.inventory
                  , s = n ? o.kamas : o.goultines
                  , r = n ? t._softPrice : t.price;
                r > s ? this.buyBtn.disable() : this.buyBtn.enable(),
                this.buyBtnAmount.setText(a.intToString(r)),
                this.buyBtnIcon.show(),
                this.buyBtnIcon.toggleClassName("hardCcy", !n),
                this.buyBtnIcon.toggleClassName("softCcy", !!n)
            }
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        l.call(this, "div", {
            className: "box"
        }),
        this.options = i || {},
        this._createDom(),
        e && this.update(e),
        t && this.resize(t)
    }
    function o() {
        this.emit("tapItemImage")
    }
    function s(e) {
        return 1 === e.promo.length && e.promo[0].image ? e.promo[0].image : e.image.length > p ? e.image[p].url : null
    }
    function a(e) {
        var t = e._promoRate;
        return t ? t : u("tablet.shop.offer")
    }
    i(960);
    var r = i(26).inherits
      , l = i(190)
      , c = i(32)
      , u = i(35).getText
      , h = i(961)
      , d = i(963)
      , p = 1;
    r(n, l),
    e.exports = n,
    n.prototype._createDom = function() {
        var e = this
          , t = this.options
          , i = this.createChild("div", {
            className: "slot"
        });
        i.createChild("div", {
            className: "slotBackground"
        });
        var n = i.createChild("div", {
            className: "slotIllu"
        });
        if (this.slotImg = n.createChild("div", {
            className: "slotImg"
        }),
        t.showDescription && (this.description = i.createChild("div", {
            className: "description"
        })),
        i.createChild("div", {
            className: "slotBorder"
        }),
        t.canTapImage && (c(i),
        i.on("tap", o.bind(this))),
        t.showTitle && (this.title = this.createChild("div", {
            className: "title"
        })),
        t.showButtons) {
            var s = this._articleButtons = this.appendChild(new h);
            s.on("tapIAPButton", function() {
                e.emit("tapIAPButton")
            }),
            s.on("tapHardButton", function() {
                e.emit("tapHardButton")
            }),
            s.on("tapSoftButton", function() {
                e.emit("tapSoftButton")
            })
        }
        if ("banner" === t.promoType)
            this._promoBanner = i.createChild("div", {
                className: "promoBanner"
            });
        else if ("corner" === t.promoType) {
            var a = this._promoCorner = i.createChild("div", {
                className: "promoCorner"
            });
            a.createChild("div", {
                className: "promoDummy"
            });
            var r = a.createChild("div", {
                className: "promoElement"
            });
            r.createChild("div", {
                className: "margin"
            });
            var l = r.createChild("div", {
                className: "rotatedContainer"
            });
            this._promoRate = l.createChild("div", {
                className: "text"
            })
        } else
            "strip" === t.promoType && (this._promoStrip = this.createChild("div", {
                className: "promoStrip"
            }))
    }
    ,
    n.prototype.clear = function() {
        this.countdown && this.countdown.clear()
    }
    ,
    n.prototype.update = function(e) {
        var t = this.options;
        this.articleId = e.id;
        var i = s(e);
        this.slotImg.setStyle("backgroundImage", i ? "url(" + i + ")" : "none");
        var n, o, r = t.promoType;
        if ("banner" === r) {
            var l = e.enddate;
            if (this._promoBanner.toggleDisplay(!!l),
            l) {
                var c = this;
                this.countdown && this.countdown.clear(),
                this.countdown = new d(new Date(l),function(e, t, i) {
                    return e ? console.error(e) : void c._promoBanner.setText(u("tablet.shop.promo.banner", i).toUpperCase())
                }
                ,function() {
                    c._promoBanner.hide()
                }
                )
            }
        } else
            "corner" === r ? (n = e._promoRate,
            o = !!(n || e.promo.length || e.enddate),
            this._promoCorner.toggleDisplay(o),
            o && this._promoRate.setText(a(e))) : "strip" === r && (n = e._promoRate,
            o = !!(n || e.promo.length || e.enddate),
            this._promoStrip.toggleDisplay(o),
            o && this._promoStrip.setText(a(e)));
        t.showTitle && this.title.setText(e.name),
        this.updatePrice(e),
        t.showDescription && this.description.setHtml(e.description)
    }
    ,
    n.prototype.updatePrice = function(e) {
        this.options.showButtons && this._articleButtons.update(e)
    }
    ,
    n.prototype.resize = function(e) {
        this.setStyles({
            width: e.boxWidth + "px",
            height: e.boxHeight + "px"
        }),
        this.options.showButtons && this._articleButtons.resize(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t) {
        r.call(this, "div", {
            className: "priceButtonsBox"
        }),
        this._createDom(),
        e && this.update(e),
        t && this.resize(t)
    }
    function o(e) {
        this.emit(e)
    }
    function s(e, t, i, n) {
        var o;
        e.toggleClassName("iap", !!n),
        n ? (e.delClassNames(["unavailable"]),
        e.currentPriceText.setText(t)) : (e.toggleClassName("unavailable", !t),
        t ? (e.currentPriceText.setText(l.kamasToString(t, "")),
        t >= d ? e.replaceClassNames(["lowPrice"], ["bigPrice"]) : t < p ? e.replaceClassNames(["bigPrice"], ["lowPrice"]) : e.delClassNames(["lowPrice", "bigPrice"]),
        e.enable(),
        i && (o = l.kamasToString(i, ""),
        e.originalPriceText.setText(o))) : (e.currentPriceText.setText(h("ui.item.averageprice.unavailable")),
        e.replaceClassNames(["lowPrice"], ["bigPrice"]),
        e.disable()))
    }
    i(962);
    var a = i(26).inherits
      , r = i(190)
      , l = i(210)
      , c = i(204)
      , u = c.DofusButton
      , h = i(35).getText
      , d = 1e6
      , p = 1e3;
    a(n, r),
    e.exports = n,
    n.prototype._createDom = function() {
        function e(e, i) {
            var n = i ? ["priceButton", i] : "priceButton"
              , o = t.appendChild(new u("",{
                className: n
            },e))
              , s = o.createChild("div", {
                className: "prices"
            })
              , a = s.createChild("div", {
                className: "original"
            });
            o.originalPriceText = a.createChild("div", {
                className: "text"
            }),
            a.createChild("div", {
                className: "icon"
            });
            var r = s.createChild("div", {
                className: "current"
            });
            return o.currentPriceText = r.createChild("div", {
                className: "text"
            }),
            r.createChild("div", {
                className: "icon"
            }),
            o
        }
        this.createChild("div", {
            className: "priceBorder"
        });
        var t = this.priceButtons = this.createChild("div", {
            className: "priceButtons"
        });
        this.iapButton = e(o.bind(this, "tapIAPButton")),
        this.hardButton = e(o.bind(this, "tapHardButton"), "hard"),
        this.softButton = e(o.bind(this, "tapSoftButton"), "soft")
    }
    ,
    n.prototype.update = function(e) {
        this.articleId = e.id;
        var t = e.original_price
          , i = e.product;
        i ? (this.hardButton.hide(),
        this.softButton.hide(),
        s(this.iapButton, i.price, t, !0),
        this.iapButton.show()) : (this.iapButton.hide(),
        this.priceButtons.toggleClassName("promo", !!t),
        s(this.hardButton, e.price, t),
        s(this.softButton, e._softPrice, e._softOriginalPrice),
        this.hardButton.show(),
        this.softButton.show())
    }
    ,
    n.prototype.resize = function() {}
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        this._endTimestamp = e,
        this._updateCallback = t,
        this._endCallback = i,
        this._endTimeout = null ,
        this._updateTimeout = null ,
        this._setUpdateTimeout(),
        this._setEndTimeout()
    }
    function o(e) {
        var t;
        return e.day ? t = e.day + " " + s("ui.time.days", e.day) : e.hour ? t = e.hour + " " + s("ui.time.hours", e.hour) : e.minute && (t = e.minute + " " + s("ui.time.minutes", e.minute)),
        t
    }
    var s = i(35).getText
      , a = 6e4
      , r = 60 * a
      , l = 24 * r;
    e.exports = n,
    n.prototype.clear = function() {
        clearTimeout(this._updateTimeout),
        clearTimeout(this._endTimeout),
        this._endTimeout = null ,
        this._updateTimeout = null ,
        this._endTimestamp = null ,
        this._updateCallback = null ,
        this._endCallback = null
    }
    ,
    n.prototype._setEndTimeout = function() {
        var e = this
          , t = Date.now()
          , i = this._endTimestamp - t;
        i > l || (i > 0 ? this._endTimeout = setTimeout(function() {
            e._endCallback(),
            e.clear()
        }, i) : (this._endCallback(),
        this.clear()))
    }
    ,
    n.prototype._setUpdateTimeout = function() {
        var e, t = this, i = Date.now(), n = this._endTimestamp - i;
        if (!(n <= 0)) {
            var s = n % a === 0 ? 1 : 0
              , c = Math.max(0, ~~(n / l) - s)
              , u = Math.max(0, ~~(n / r) - s)
              , h = Math.max(0, ~~(n / a) - s);
            c ? e = n % l || l : u ? e = n % r || r : h && (e = n % a || a);
            var d = {
                day: c,
                hour: u,
                minute: h || 1
            }
              , p = o(d);
            if (!p)
                return t._updateCallback(new Error("Time left could not be formatted, day: " + d.day + ", hour: " + d.hour + ", minute: " + d.minute));
            t._updateCallback(null , d, p),
            e && (this._updateTimeout = setTimeout(function() {
                t._setUpdateTimeout()
            }, e))
        }
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "MarketWindow",
            positionInfo: {
                top: 20,
                left: 60,
                right: 20,
                bottom: 20
            }
        });
        var e = ["shop"]
          , t = this.tabsDefinitions = {
            shop: {
                target: new a
            }
        }
          , i = this.windowBody;
        this.tabs = i.appendChild(new r);
        for (var n = 0; n < e.length; n++) {
            var o = e[n]
              , l = t[o]
              , c = i.appendChild(l.target);
            c.tabId = o,
            this.tabs.addTab("", c, o)
        }
        this._initTabs(),
        this.on("open", function(e) {
            this.tabs.openTab(e.tabId, e.tabParams, {
                delayOpenedEvent: !0,
                forceOpen: !0
            })
        }),
        this.on("opened", function(e) {
            e = e || {},
            this.tabs.emitOnCurrentTab("opened", e.tabParams || {})
        }),
        this.on("close", function() {
            this._resetTabs()
        }),
        this._setupEvents()
    }
    i(965);
    var o = i(26).inherits
      , s = i(402)
      , a = i(966)
      , r = i(735);
    o(n, s),
    e.exports = n,
    n.prototype._initTabs = function() {
        var e = this.tabsDefinitions;
        for (var t in e)
            this.tabs.toggleTabAvailability(t, !e[t].disabled)
    }
    ,
    n.prototype._setupEvents = function() {
        var e = this
          , t = window.gui;
        t.on("disconnect", function() {
            e._resetTabs(),
            e._initTabs()
        })
    }
    ,
    n.prototype.getOpenedTabId = function() {
        return this.tabs.getCurrentTabId()
    }
    ,
    n.prototype._resetTabs = function() {
        this.tabs.close()
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        p.close("market")
    }
    function o() {
        l.call(this, "div", {
            className: "ShopWindow",
            name: "shop"
        }),
        this.nbArticlesVisible = 1,
        this.activeTopTab = null ,
        this.selectedTopTab = null ,
        this.selectedSubTab = null ,
        this.openedCategory = null ,
        this.categoriesName = {},
        this.categoriesData = {},
        this.bonusCountdown = null ,
        this.requestTimestamp = 0,
        this.requestTimeout = null ,
        this.lastAction = null ,
        this.isInitializing = !1,
        this.articlesMap = {},
        this._views = {},
        this._currentViewName = null ,
        this._previousViewName = null ,
        this.viewPreviousToGoultines = null ,
        this.categoryToOpenWhenReady = null ,
        this.needsResize = !1;
        var e, t, i;
        this.once("open", function() {
            this._createDom(),
            this._setupEvents()
        }),
        this.on("opened", function(n) {
            if (this._currentViewName)
                return void (n.category && this._navigateToCategory(n.category));
            var o = window.gui.playerData;
            e = Date.now(),
            t = o.inventory.kamas,
            i = o.inventory.goultines,
            this.categoryToOpenWhenReady = n.category,
            this.isInitializing || this.reinitializeShop(),
            this.needsResize && this.resize()
        }),
        this.on("close", function() {
            var n = ~~((Date.now() - e) / 1e3)
              , o = window.gui.playerData
              , s = o.inventory.kamas - t
              , a = o.inventory.goultines - i;
            b.log("HUD.Display_Menu", {
                interface_id: "UI_SHOP",
                time_spent_on_action: n,
                relative_soft_currency_gained: s,
                relative_hard_currency_gained: a
            }),
            this.clearShop()
        })
    }
    function s() {
        return window.gui.playerData.identification.subscriptionEndDate
    }
    i(967);
    var a = i(26).inherits
      , r = i(35).getText
      , l = i(190)
      , c = i(743)
      , u = i(84).playUiSound
      , h = i(204)
      , d = i(32)
      , p = i(22)
      , m = i(833)
      , f = i(548)
      , g = i(968)
      , _ = i(970)
      , v = i(972)
      , y = i(963)
      , w = i(633)
      , b = i(158)
      , C = 500
      , I = "itemsList"
      , T = "homepage"
      , S = "itemDetails"
      , A = "homepage"
      , E = {
        id: A,
        name: "",
        child: []
    }
      , x = 556
      , M = 557
      , N = {
        canTapImage: !1
    }
      , R = {
        lines: 1,
        columns: 2,
        promoType: "strip",
        showArticleDescription: !0,
        canTapImage: !1
    }
      , O = {
        556: N,
        557: R
    }
      , P = {
        557: !0
    };
    a(o, l),
    e.exports = o;
    var D = !0
      , L = !0;
    o.prototype.setSubCategoryRowVisible = function(e) {
        var t = L !== e;
        L = e,
        this.subCategoryRow.toggleDisplay(e),
        this.subCategoryRowSeparator.toggleDisplay(e),
        t && (this.viewContainer.toggleClassName("hasSubCategory", e),
        this.resize())
    }
    ,
    o.prototype._activateTopTab = function(e) {
        var t = e.getWuiName()
          , i = this.activeTopTab;
        if (i) {
            if (e === i)
                return;
            this._deactivateTopTab(i)
        }
        if (t === A)
            this.closeCategory(this.openedCategory),
            this.setSubCategoryRowVisible(!1),
            this.setView(T);
        else {
            if (this._isSameCategory(t))
                return;
            if (e.sublist) {
                for (var n = this.subCategoryRow.getChildren(), o = 0; o < n.length; o++)
                    this.subCategoryRow.removeChild(n[o]);
                this.subCategoryRow.appendChild(e.sublist),
                this.setSubCategoryRowVisible(!0),
                D && (e.sublist.deactivate(),
                this.selectedSubTab = null )
            }
            this._openCategory(t)
        }
        this.activeTopTab = e,
        this.selectedTopTab = t,
        e.addClassNames("on"),
        u("TAB")
    }
    ,
    o.prototype._activateSubCategory = function(e) {
        var t = e.getWuiName();
        this._isSameCategory(t) || (this.selectedSubTab = t,
        this._openCategory(t),
        u("TAB"))
    }
    ;
    var B = !0;
    o.prototype._deactivateTopTab = function(e) {
        var t = e.getWuiName();
        t !== A && (e.sublist && (this.setSubCategoryRowVisible(!1),
        e.sublist.deactivate()),
        this._isSameCategory(t) && this.closeCategory(t)),
        e.delClassNames("on"),
        this.activeTopTab = null
    }
    ,
    o.prototype._deactivateSubCategory = function(e) {
        var t = e.getWuiName();
        this._isSameCategory(t) && (this.closeCategory(t),
        B && (this.selectedSubTab = null ,
        this._openCategory(this.selectedTopTab)))
    }
    ,
    o.prototype.deactivateAllCategories = function() {
        B = !1,
        this.activeTopTab && this._deactivateTopTab(this.activeTopTab),
        B = !0
    }
    ,
    o.prototype.reactivateCategories = function() {
        var e = this.selectedTopTab;
        if (e) {
            D = !1;
            var t = this.topTabsList.getChild(e);
            if (this._activateTopTab(t),
            !t.sublist || !this.selectedSubTab)
                return void (D = !0);
            t.sublist.selectItem(this.selectedSubTab),
            D = !0
        }
    }
    ,
    o.prototype._openGoultinesCategory = function() {
        this._isSameCategory(x) || (this.wallet.goultinesBtn.addClassNames("sunk"),
        this.viewPreviousToGoultines = this._currentViewName,
        this.deactivateAllCategories(),
        this.setSubCategoryRowVisible(!1),
        this._openCategory(x))
    }
    ,
    o.prototype._closeGoultinesCategory = function() {
        if (this._isSameCategory(x))
            return this.wallet.goultinesBtn.delClassNames("sunk"),
            this.closeCategory(x),
            this.viewPreviousToGoultines === I ? this.reactivateCategories() : void this.goToPreviousView()
    }
    ,
    o.prototype._toggleGoultinesCategory = function() {
        return this._isSameCategory(x) ? this._closeGoultinesCategory() : void this._openGoultinesCategory()
    }
    ,
    o.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "row1"
        });
        t.createChild("div", {
            className: ["separator", "first"]
        }),
        this.subCategoryRowSeparator = t.createChild("div", {
            className: ["separator", "second"]
        }),
        E.name = r("tablet.shop.homepage.name"),
        this.topTabsList = t.createChild("div", {
            className: "topTabsList"
        });
        var i = t.appendChild(new h({
            className: "closeButton",
            scaleOnPress: !0
        }));
        i.on("tap", function() {
            n()
        }),
        this.wallet = t.appendChild(new m({
            emitTap: !0
        })),
        this.wallet.on("moreGoultinesTap", function() {
            e._toggleGoultinesCategory()
        }),
        this.subCategoryRow = this.createChild("div", {
            className: "subCategoryRow"
        });
        var o = this.createChild("div", {
            className: "row2"
        });
        this.viewContainer = o,
        this.bonusDisplay = new l("div",{
            className: "bonusDisplay"
        });
        var s = r("tablet.shop.bonusTimeLeft") + r("ui.common.colon");
        this.bonusDisplay.createChild("div", {
            className: "title",
            text: s.toUpperCase()
        }),
        this.bonusDetails = this.bonusDisplay.createChild("div", {
            className: "details"
        }),
        this.setSubCategoryRowVisible(!1),
        this._views[T] = new g,
        this._views[I] = new _,
        this._views[S] = new v
    }
    ,
    o.prototype.setView = function(e, t) {
        if (this._currentViewName !== e) {
            this.deactivateAllCategories(),
            this._previousViewName = this._currentViewName,
            this._currentViewName = e;
            for (var i = this.viewContainer, n = i.getChildren(), o = 0; o < n.length; o++)
                i.removeChild(n[o]);
            var s = this._views[e];
            s && (i.appendChild(s),
            s.update(t))
        }
    }
    ,
    o.prototype.goToPreviousView = function() {
        return this._previousViewName === I || this._previousViewName === T ? this.reactivateCategories() : void this.setView(this._previousViewName)
    }
    ,
    o.prototype._setupEvents = function() {
        function e(e) {
            var t = u.articlesMap[e]
              , i = u.openedCategory || A
              , n = u.categoriesName[i];
            u.setView(S, {
                article: t,
                categoryName: n
            })
        }
        function t(e) {
            w.purchaseArticleOnStore(u.articlesMap[e])
        }
        function i(e, t) {
            w.purchaseArticleOnAnkama(u.articlesMap[e], t)
        }
        function n(e) {
            u.showSubCategoryRow(e)
        }
        function o() {
            u.showSubCategoryRow(!1)
        }
        var s = window.dofus.connectionManager
          , a = window.gui
          , r = this._views
          , l = r[I]
          , c = r[S]
          , u = this;
        s.on("shopOpenError", function(e) {
            u.onShopOpenError(e)
        }),
        s.on("shopOpenSuccess", function(e) {
            u.onShopOpenSuccess(e)
        }),
        s.on("shopOpenCategoryError", function(e) {
            u.onShopOpenCategoryError(e)
        }),
        s.on("shopOpenCategorySuccess", function(e) {
            u.onShopOpenCategorySuccess(e)
        }),
        s.on("AccessoryPreviewErrorMessage", function(e) {
            console.error(new Error("Accessory preview failed with: " + e.error)),
            c.setLook(null )
        }),
        s.on("AccessoryPreviewMessage", function(e) {
            c.setLook(e.look)
        }),
        a.on("resize", function() {
            return u.isOpen() ? void u.resize() : void (u.needsResize = !0)
        });
        for (var h in r) {
            var d = r[h];
            d.on("displayItemDetails", e),
            d.on("purchaseIAP", t),
            d.on("purchaseOnAnkama", i),
            d.on("showSubCategoryRow", n),
            d.on("hideSubCategoryRow", o)
        }
        l.on("loadAdditionalContent", function() {
            u._saveAndExecuteAction(function() {
                u.loadAdditionalContent()
            })
        }),
        l.on("nbArticlesVisibleUpdated", function(e) {
            u.nbArticlesVisible = e
        }),
        c.on("goToPreviousView", function() {
            u.goToPreviousView()
        }),
        c.on("requestPrevisualization", function(e) {
            s.sendMessage("AccessoryPreviewRequestMessage", {
                genericId: e
            })
        }),
        f.on("canNotComputeSoftPrices", function() {
            u.isOpen() && u.updateArticlesPrices()
        }),
        f.on("computedSoftPricesChange", function() {
            u.isOpen() && u.updateArticlesPrices()
        })
    }
    ,
    o.prototype.isOpen = function() {
        return p.getWindow("market").openState
    }
    ,
    o.prototype.showSubCategoryRow = function(e) {
        for (var t = this.subCategoryRow.getChildren(), i = 0; i < t.length; i++)
            this.subCategoryRow.removeChild(t[i]);
        var n = !!e;
        this.setSubCategoryRowVisible(n),
        n && this.subCategoryRow.appendChild(e)
    }
    ,
    o.prototype._navigateToCategory = function(e) {
        "goultines" === e ? this._openGoultinesCategory() : "bonuspack" === e && this._openCategory(M)
    }
    ,
    o.prototype.onShopOpenError = function() {
        this.isInitializing = !1,
        this.viewContainer.delClassNames("spinner"),
        this.isOpen() && this._showErrorPopup(!0)
    }
    ,
    o.prototype.onShopOpenSuccess = function(e) {
        if (this.isInitializing = !1,
        this.viewContainer.delClassNames("spinner"),
        this.isOpen()) {
            this.wallet.goultinesBtn.enable();
            var t = e.home;
            this.setCategories(t.categories);
            var i = this.topTabsList.getChildren();
            i.length && this._activateTopTab(i[0]);
            var n;
            if (t._highlightImageArticle) {
                var o = this.validateArticles([t._highlightImageArticle]);
                o.length && (n = o[0])
            }
            var s;
            t.gondolahead_article && (s = this.validateArticles(t.gondolahead_article));
            var a;
            if (t._highlightCarouselArticle) {
                var r = this.validateArticles([t._highlightCarouselArticle]);
                r.length && (a = r[0])
            }
            var l = {
                gondolaHeadArticles: s,
                highlightCarousel: t._selectedHighlightCarousel,
                highlightCarouselArticle: a,
                highlightImageArticle: n
            };
            this._views[T].update(l),
            this.categoryToOpenWhenReady && this._navigateToCategory(this.categoryToOpenWhenReady),
            window.wizPurchase && w.checkPendingPurchases()
        }
    }
    ,
    o.prototype.onShopOpenCategoryError = function(e) {
        if (this._isSameCategory(e.categoryId)) {
            var t = this._views[I];
            t.setSpinnerVisible(!1),
            t.setLoadingAdditionalContent(!1),
            this._showErrorPopup()
        }
    }
    ,
    o.prototype.onShopOpenCategorySuccess = function(e) {
        this._loadCategoryWithMessage(e)
    }
    ,
    o.prototype.resize = function() {
        var e = this._views;
        for (var t in e)
            e[t].resize(this.viewContainer);
        this.needsResize = !1
    }
    ,
    o.prototype._showErrorPopup = function(e) {
        var t = this;
        p.getWindow("confirm").update({
            title: r("ui.common.error"),
            message: r("ui.popup.accessDenied.serviceUnavailable") + " " + r("tablet.common.askRetry"),
            cb: function(i) {
                return i ? t.lastAction ? void t.lastAction() : void t.reinitializeShop() : void (e && n())
            }
        }),
        p.openDialog(["confirm"])
    }
    ,
    o.prototype._isSameCategory = function(e) {
        return e === this.openedCategory
    }
    ,
    o.prototype._saveAndExecuteAction = function(e) {
        this.lastAction = e,
        e()
    }
    ,
    o.prototype.updateArticlesPrices = function() {
        var e = this.articlesMap;
        for (var t in e)
            w.enrichWithSoftPrice(e[t]);
        var i = this._views;
        for (var n in i)
            i[n].updateArticlesPrices(this.articlesMap)
    }
    ,
    o.prototype.reinitializeShop = function() {
        function e(e) {
            console.error(e),
            t.isInitializing = !1,
            t.viewContainer.delClassNames("spinner"),
            t.isOpen() && t._showErrorPopup(!0)
        }
        var t = this;
        this._saveAndExecuteAction(function() {
            t.isInitializing = !0,
            t.viewContainer.addClassNames("spinner"),
            w.getStoreInfos(function(t) {
                return t ? e(t) : void window.dofus.send("shopOpenRequest")
            })
        })
    }
    ,
    o.prototype.clearShop = function() {
        var e = this.activeTopTab;
        e && this._deactivateTopTab(e),
        this.closeCategory(this.openedCategory),
        this.clearCategories(),
        this.requestTimestamp = 0,
        this.requestTimeout = null ,
        this.lastAction = null ,
        this.isInitializing = !1,
        this.wallet.goultinesBtn.disable(),
        this.setView(T),
        this._currentViewName = null ,
        this._previousViewName = null ;
        var t = this._views;
        for (var i in t)
            t[i].clear();
        this.viewPreviousToGoultines = null
    }
    ,
    o.prototype.setCategories = function(e) {
        this.clearCategories(),
        this._addTopCategories(e)
    }
    ,
    o.prototype._createCategoryLabel = function(e) {
        var t = new l("div",{
            className: "textContainer"
        });
        return t.createChild("div", {
            className: "text",
            text: e.name.toUpperCase()
        }),
        t
    }
    ,
    o.prototype._addTopCategories = function(e) {
        function t(e) {
            s._activateSubCategory(e)
        }
        function i(e) {
            s._deactivateSubCategory(e)
        }
        function n() {
            s._activateTopTab(this)
        }
        function o(e) {
            if (s.categoriesName[e.id] = e.name,
            e.id !== x) {
                var o = s._createCategoryLabel(e)
                  , a = s.topTabsList.createChild("div", {
                    name: e.id,
                    className: "tab"
                });
                if (a.appendChild(o),
                d(a),
                a.on("tap", n.bind(a)),
                e.child.length) {
                    var r = a.sublist = new c;
                    r.on("activate", t),
                    r.on("deactivate", i),
                    s._addSubCategories(r, e.child)
                }
            }
        }
        var s = this;
        o(E);
        for (var a = 0; a < e.length; a++)
            o(e[a])
    }
    ,
    o.prototype._addSubCategories = function(e, t) {
        for (var i = 0; i < t.length; i++) {
            var n = t[i];
            this.categoriesName[n.id] = n.name;
            var o = this._createCategoryLabel(n)
              , s = e.addItem(n.id, o);
            s.addClassNames("tab")
        }
    }
    ,
    o.prototype.clearCategories = function() {
        this.topTabsList.clearContent(),
        this.activeTopTab = null ,
        this.selectedTopTab = null ,
        this.selectedSubTab = null ,
        this.openedCategory = null ,
        this.categoriesName = {},
        this.categoriesData = {},
        this.articlesMap = {}
    }
    ,
    o.prototype._loadCategoryWithMessage = function(e) {
        var t = e.categoryId
          , i = this.categoriesData[t];
        if (i) {
            if (i.page !== e.page - 1)
                return;
            i.page = e.page,
            i.articles = i.articles.concat(e.articles)
        } else
            this.categoriesData[t] = e;
        this._isSameCategory(t) && this._loadCategory(e)
    }
    ,
    o.prototype.validateArticles = function(e) {
        for (var t = w.validateArticles(e), i = 0; i < t.length; i++) {
            var n = t[i];
            this.articlesMap[n.id] = n
        }
        return t
    }
    ,
    o.prototype._loadCategory = function(e) {
        var t = this._views[I];
        if (0 === e.totalArticles)
            return void t.showNoResult(this.categoriesName[this.openedCategory]);
        var i = this.validateArticles(e.articles)
          , n = Math.ceil(e.totalArticles / this.nbArticlesVisible)
          , o = e.page === n;
        t.addArticles(i, o)
    }
    ,
    o.prototype.showBonusDetails = function() {
        var e = this
          , t = s();
        t ? (this.bonusCountdown && this.bonusCountdown.clear(),
        this.bonusCountdown = new y(new Date(t),function(t, i, n) {
            return t ? console.error(t) : void e.bonusDetails.setText(n.toUpperCase())
        }
        ,function() {
            e.bonusDetails.setText(r("tablet.shop.noActiveBonus").toUpperCase())
        }
        )) : this.bonusDetails.setText(r("tablet.shop.noActiveBonus").toUpperCase()),
        this.showSubCategoryRow(this.bonusDisplay)
    }
    ,
    o.prototype._openCategory = function(e) {
        this._currentViewName !== I && this.setView(I);
        var t = this
          , i = this._views[I]
          , n = O[e];
        if (i.setConstraints(n) && i.resize(this.viewContainer),
        i.setClassNames(["itemsListView", "_" + e]),
        !this._isSameCategory(e)) {
            (this.openedCategory || 0 === this.openedCategory) && this.closeCategory(this.openedCategory),
            P[e] && this.showBonusDetails(),
            e === x && this.wallet.goultinesBtn.addClassNames("sunk"),
            this.openedCategory = e;
            var o = this.categoriesData[this.openedCategory];
            o ? this._loadCategory(o) : this._saveAndExecuteAction(function() {
                i.setSpinnerVisible(!0),
                t._requestPageOfCategory(e, 1)
            })
        }
    }
    ,
    o.prototype.loadAdditionalContent = function() {
        if (this.openedCategory) {
            this._views[I].setLoadingAdditionalContent(!0);
            var e = this.categoriesData[this.openedCategory];
            return e ? void this._requestPageOfCategory(this.openedCategory, e.page + 1) : console.error(new Error("Trying to load additional content of a non-opened category."))
        }
    }
    ,
    o.prototype._requestPageOfCategory = function(e, t) {
        var i = {
            categoryId: e,
            page: t,
            size: this.nbArticlesVisible
        }
          , n = function() {
            window.dofus.send("shopOpenCategoryRequest", i)
        };
        window.clearTimeout(this.requestTimeout);
        var o = Date.now()
          , s = o - this.requestTimestamp;
        s > C ? n() : this.requestTimeout = window.setTimeout(n, C - s),
        this.requestTimestamp = o
    }
    ,
    o.prototype.closeCategory = function(e) {
        this.openedCategory && this._isSameCategory(e) && (P[e] && this.bonusCountdown && (this.bonusCountdown.clear(),
        this.bonusCountdown = null ),
        e === x && this.wallet.goultinesBtn.delClassNames("sunk"),
        this._views[I].clearItems(),
        this.openedCategory = null )
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "homepageView"
        }),
        this.highlightArticleBox = null ,
        this.highlightCarouselArticle = null ,
        this._createDom()
    }
    function o(e, t) {
        return {
            boxWidth: e,
            boxHeight: t
        }
    }
    i(969);
    var s = i(26).inherits
      , a = i(190)
      , r = i(959)
      , l = i(635)
      , c = i(32)
      , u = 6
      , h = 5
      , d = 8
      , p = 155
      , m = 200
      , f = 1
      , g = p / m;
    s(n, a),
    e.exports = n,
    n.prototype.clear = function() {
        this.highlightArticleBox && (this.highlightArticleBox.clear(),
        this.highlightArticleBox = null );
        for (var e = this.gondolaHead.getChildren(), t = 0; t < e.length; t++)
            e[t].clear();
        this.highlightCarouselArticle = null ,
        this.highlightCarouselImage.hide(),
        this.highlightImage.clearContent(),
        this.gondolaHead.clearContent()
    }
    ,
    n.prototype._createDom = function() {
        var e = this
          , t = this.createChild("div", {
            className: "highlights"
        });
        this.gondolaHead = this.createChild("div", {
            className: "gondolaHead"
        });
        var i = t.createChild("div", {
            className: "highlightCarousel"
        });
        this.highlightCarouselImage = i.createChild("div", {
            className: "highlightCarouselImage"
        }),
        this.highlightCarouselImage.hide(),
        c(i),
        i.on("tap", function() {
            e.highlightCarouselArticle && e.emit("displayItemDetails", e.highlightCarouselArticle.id)
        }),
        this.highlightImage = t.createChild("div", {
            className: "highlightImage"
        })
    }
    ,
    n.prototype.resize = function() {}
    ,
    n.prototype.update = function(e) {
        function t() {
            y.emit("purchaseIAP", this.articleId)
        }
        function i() {
            y.emit("purchaseOnAnkama", this.articleId, l.GOULTINE)
        }
        function n() {
            y.emit("purchaseOnAnkama", this.articleId, l.KAMA)
        }
        function s() {
            y.emit("displayItemDetails", this.articleId)
        }
        function a(e, o, a) {
            a = a || {},
            a.canTapImage = !0,
            a.showButtons = void 0 === a.showButtons || a.showButtons,
            a.showTitle = void 0 === a.showTitle || a.showTitle;
            var l = new r(e,o,a);
            return l.on("tapIAPButton", t),
            l.on("tapHardButton", i),
            l.on("tapSoftButton", n),
            l.on("tapItemImage", s),
            l
        }
        if (this.emit("hideSubCategoryRow"),
        e) {
            this.clear();
            var c = e.highlightCarousel
              , p = !1;
            if (c) {
                var m = c.image;
                m.length > u && (p = !0,
                this.highlightCarouselArticle = e.highlightCarouselArticle,
                this.highlightCarouselImage.setStyle("backgroundImage", "url(" + m[u].url + ")"))
            }
            this.highlightCarouselImage.toggleDisplay(p);
            var _, v, y = this, w = e.highlightImageArticle;
            if (w) {
                this.highlightImage.show();
                var b = this.highlightImage.rootElement.getBoundingClientRect();
                v = o(b.width, b.height),
                this.highlightArticleBox = a(w, v, {
                    promoType: "banner"
                }),
                this.highlightImage.appendChild(this.highlightArticleBox)
            } else
                this.highlightImage.hide();
            var C = e.gondolaHeadArticles;
            if (C) {
                var I = this.gondolaHead.rootElement.getBoundingClientRect()
                  , T = ~~I.width + 2 * h
                  , S = ~~I.height - d
                  , A = ~~(S * g) + 2 * h
                  , E = Math.min(C.length, ~~(T / A))
                  , x = T - A * E
                  , M = ~~(x / E)
                  , N = A + M;
                A = N / S > f ? S * f - 2 * h : N - 2 * h,
                v = o(A, S);
                for (var R = 0; R < E; R++)
                    _ = a(C[R], v, {
                        promoType: "corner"
                    }),
                    this.gondolaHead.appendChild(_)
            }
        }
    }
    ,
    n.prototype.updateArticlesPrices = function(e) {
        var t = this.gondolaHead.getChildren();
        this.highlightArticleBox && t.push(this.highlightArticleBox);
        for (var i = 0; i < t.length; i++) {
            var n = t[i]
              , o = n.articleId;
            if (o) {
                var s = e[o];
                s ? n.updatePrice(s) : console.error(new Error("Article " + o + " missing for an ArticleBox"))
            }
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "itemsListView"
        }),
        this.articlesPerLine = u,
        this.articlesPerColumn = h,
        this._isAdditionalContentLoading = !1,
        this._boxHeight = _,
        this._boxWidth = g,
        this._scrollMargin = 0,
        this.constraints = {},
        this.setConstraints(w),
        this._createDom()
    }
    i(971);
    var o = i(26).inherits
      , s = i(35).getText
      , a = i(190)
      , r = i(302)
      , l = i(959)
      , c = i(635)
      , u = 2
      , h = 1
      , d = 9
      , p = 0
      , m = 11
      , f = 9
      , g = 155
      , _ = 200
      , v = _ + m
      , y = 40
      , w = {
        lines: null ,
        columns: null ,
        promoType: "corner",
        showArticleDescription: !1,
        canTapImage: !0
    };
    o(n, a),
    e.exports = n,
    n.prototype.clear = function() {
        for (var e = this._getArticleBoxes(), t = 0; t < e.length; t++)
            e[t].clear()
    }
    ,
    n.prototype._createDom = function() {
        var e = this;
        this._itemsScroll = this.appendChild(new r({
            className: "scroll"
        },{
            isHorizontal: !0
        })),
        this._itemsList = this._itemsScroll.content.createChild("div", {
            className: "itemsList"
        });
        for (var t = 0; t < this.articlesPerColumn; t++)
            this._itemsList.createChild("div", {
                className: "itemsLine"
            });
        this._loadContent = this._itemsScroll.content.createChild("div", {
            className: "loadContent"
        }),
        this._loadContent.hide(),
        this._noResultMessage = this._itemsScroll.content.createChild("div", {
            className: "rightLabel"
        }),
        this._noResultMessageText = this._noResultMessage.createChild("div", {
            className: "text"
        }),
        this._noResultMessage.hide(),
        this._itemsScroll.on("scrollEnd", function() {
            !e._isAdditionalContentLoading && e._loadContent.isVisible() && Math.abs(this.iScroll.maxScrollX - this.iScroll.x) < y && e.emit("loadAdditionalContent")
        })
    }
    ,
    n.prototype.update = function() {}
    ,
    n.prototype.resize = function(e) {
        this._computeMargins(e);
        var t = this._getItemsMap()
          , i = this.getArticleBoxSize();
        for (var n in t)
            t[n].resize(i);
        this._itemsScroll.refresh(),
        this.emit("nbArticlesVisibleUpdated", (this.articlesPerLine + 1) * this.articlesPerColumn)
    }
    ,
    n.prototype.getArticleBoxSize = function() {
        return {
            boxWidth: this._boxWidth,
            boxHeight: this._boxHeight
        }
    }
    ,
    n.prototype.setConstraints = function(e) {
        e = e || w;
        var t = !1;
        for (var i in w) {
            var n = e.hasOwnProperty(i) ? e[i] : w[i];
            this.constraints[i] !== e[i] && (this.constraints[i] = n,
            t = !0)
        }
        return t
    }
    ,
    n.prototype.addArticles = function(e, t) {
        this.setSpinnerVisible(!1),
        this.setLoadingAdditionalContent(!1),
        this._loadContent.toggleDisplay(!t),
        this._addArticles(e)
    }
    ,
    n.prototype.showNoResult = function(e) {
        this.clearItems();
        var t;
        t = e ? s("ui.search.noResultFor", e) : s("ui.search.noResult"),
        this._noResultMessageText.setText(t),
        this._noResultMessage.show()
    }
    ,
    n.prototype._addArticles = function(e) {
        function t() {
            h.emit("purchaseIAP", this.articleId)
        }
        function i() {
            h.emit("purchaseOnAnkama", this.articleId, c.GOULTINE)
        }
        function n() {
            h.emit("purchaseOnAnkama", this.articleId, c.KAMA)
        }
        function o() {
            h.emit("displayItemDetails", this.articleId)
        }
        for (var s = 0, a = this._itemsList.getChildren(), r = a.length, u = this.getArticleBoxSize(), h = this, d = {
            showButtons: !0,
            showTitle: !0,
            promoType: this.constraints.promoType,
            showDescription: this.constraints.showArticleDescription,
            canTapImage: this.constraints.canTapImage
        }, p = 0; p < e.length; p++) {
            var m = new l(e[p],u,d);
            m.on("tapIAPButton", t),
            m.on("tapHardButton", i),
            m.on("tapSoftButton", n),
            m.on("tapItemImage", o),
            a[s % r].appendChild(m),
            s++
        }
        this._itemsScroll.refresh()
    }
    ,
    n.prototype.setLoadingAdditionalContent = function(e) {
        this._isAdditionalContentLoading = e,
        e ? (this._loadContent.addClassNames("spinner"),
        this._loadContent.delClassNames("showArrow")) : (this._loadContent.delClassNames("spinner"),
        this._loadContent.addClassNames("showArrow"))
    }
    ,
    n.prototype.setSpinnerVisible = function(e) {
        e ? this._itemsScroll.addClassNames("spinner") : this._itemsScroll.delClassNames("spinner")
    }
    ,
    n.prototype.clearItems = function() {
        this.setSpinnerVisible(!1),
        this.setLoadingAdditionalContent(!1);
        for (var e = this._itemsList.getChildren(), t = 0; t < e.length; t++)
            e[t].clearContent();
        this._loadContent.hide(),
        this._noResultMessage.hide(),
        this._itemsScroll.refresh(),
        this._itemsScroll.goToTop()
    }
    ,
    n.prototype._setNumberOfLines = function(e) {
        if (e !== this.articlesPerColumn) {
            this.articlesPerColumn = e;
            var t, i = [], n = this._itemsList.getChildren(), o = n.length - e;
            for (t = 0; t < n.length; t++) {
                for (var s = n[t], a = s.getChildren(), r = 0; r < a.length; r++)
                    i.push(s.removeChild(a[r]));
                o > 0 && (s.destroy(),
                o--)
            }
            if (n.length < e) {
                var l = e - n.length;
                for (t = 0; t < l; t++)
                    this._itemsList.createChild("div", {
                        className: "itemsLine"
                    })
            }
            if (i.length)
                for (n = this._itemsList.getChildren(),
                t = 0; t < i.length; t++)
                    n[t % e].appendChild(i[t])
        }
    }
    ,
    n.prototype._computeMargins = function(e) {
        var t = this.constraints
          , i = e.rootElement.getBoundingClientRect()
          , n = i.width - 2 * p
          , o = i.height - (2 * p + d)
          , s = t.lines || Math.max(h, ~~(o / v))
          , a = o - v * s
          , r = ~~(a / s);
        if (this._boxHeight = _ + r,
        t.columns) {
            var l = n - (g + 2 * f) * t.columns
              , c = ~~(l / t.columns);
            this._boxWidth = g + c
        } else
            this._boxWidth = g + r;
        var y = this._boxHeight + m
          , w = this._boxWidth + 2 * f;
        this.articlesPerLine = t.columns || Math.max(u, ~~(n / w)),
        a = o - y * s,
        a > 1 && (this._scrollMargin = ~~(.5 * a),
        this._itemsScroll.setStyles({
            "margin-top": this._scrollMargin + "px",
            "margin-bottom": this._scrollMargin + "px"
        })),
        this._setNumberOfLines(s),
        this._itemsScroll.refresh()
    }
    ,
    n.prototype._getArticleBoxes = function() {
        for (var e = [], t = this._itemsList.getChildren(), i = 0; i < t.length; i++)
            e = e.concat(t[i].getChildren());
        return e
    }
    ,
    n.prototype.updateArticlesPrices = function(e) {
        for (var t = this._getArticleBoxes(), i = 0; i < t.length; i++) {
            var n = t[i]
              , o = n.articleId;
            if (o) {
                var s = e[o];
                s ? n.updatePrice(s) : console.error(new Error("Article " + o + " missing for an ArticleBox"))
            }
        }
    }
    ,
    n.prototype._getItemsMap = function() {
        for (var e = {}, t = this._itemsList.getChildren(), i = 0; i < t.length; i++)
            for (var n = t[i].getChildren(), o = 0; o < n.length; o++) {
                var s = n[o];
                e[s.getWuiName()] = s
            }
        return e
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, "div", {
            className: "itemDetailsView"
        }),
        this._resetProperties(),
        this._createDom()
    }
    function o() {
        return window.gui.playerData.characterBaseInformations.entityLook
    }
    i(973);
    var s = i(26).inherits
      , a = i(35).getText
      , r = i(190)
      , l = i(204)
      , c = i(238)
      , u = i(323)
      , h = i(959)
      , d = i(961)
      , p = i(279)
      , m = i(5)
      , f = i(302)
      , g = i(567)
      , _ = i(22)
      , v = i(635)
      , y = i(974)
      , w = i(399)
      , b = i(323).isEquippable
      , C = i(222)
      , I = {};
    I[C.ACTION_LADDER_ID] = !0,
    I[C.ACTION_ITEM_CHANGE_PETS_LIFE] = !0,
    I[C.ACTION_ITEM_PETS_SHAPE] = !0,
    I[C.ACTION_ITEM_PETS_EAT] = !0,
    I[C.ACTION_PETS_LAST_MEAL] = !0,
    I[C.ACTION_ID_LIVING_OBJECT_MOOD] = !0,
    I[C.ACTION_ID_LIVING_OBJECT_SKIN] = !0,
    I[C.ACTION_ID_LIVING_OBJECT_CATEGORY] = !0,
    I[C.ACTION_ID_LIVING_OBJECT_LEVEL] = !0,
    I[983] = !0,
    I[984] = !0,
    I[620] = !0;
    var T = 641
      , S = 429
      , A = S / T
      , E = .85
      , x = 2 / 236;
    s(n, r),
    e.exports = n,
    n.prototype._resetProperties = function() {
        this._classSymbolImage = null ,
        this._firstItemOfSet = null ,
        this._articleId = null
    }
    ,
    n.prototype.clear = function() {
        this._resetProperties(),
        this._articleBox.clear(),
        this._characterDisplay.release()
    }
    ,
    n.prototype._createDom = function() {
        function e() {
            n.emit("purchaseIAP", n._articleId)
        }
        function t() {
            n.emit("purchaseOnAnkama", n._articleId, v.GOULTINE)
        }
        function i() {
            n.emit("purchaseOnAnkama", n._articleId, v.KAMA)
        }
        var n = this
          , o = this._backToCategory = new r("div",{
            className: "goToPrevious"
        })
          , s = new l({
            className: "arrow"
        },function() {
            n.emit("goToPreviousView")
        }
        );
        o.appendChild(s),
        this._backToCategoryText = o.createChild("div", {
            className: "text"
        }),
        this.promoBanner = this.createChild("div", {
            className: "promoBanner"
        });
        var u = this.leftColumn = this.appendChild(new f({
            className: "left"
        }));
        this.promoDescription = u.content.createChild("div", {
            className: "promoDescription"
        });
        var p = u.content.createChild("div", {
            className: "topRow"
        })
          , m = p.createChild("div", {
            className: "illuContainer"
        });
        m.createChild("div", {
            className: "dummy"
        });
        var g = m.createChild("div", {
            className: "illuElement"
        });
        this._articleBox = g.appendChild(new h);
        var w = p.createChild("div", {
            className: "nameAndDescription"
        });
        this._name = w.createChild("div", {
            className: "section"
        }),
        this._description = w.createChild("div", {
            className: "subSection"
        }),
        this._weight = this._articleBox.createChild("div", {
            className: "weight"
        }),
        this._linkToItemSet = p.appendChild(new l({
            className: "setButton",
            scaleOnPress: !0
        },function() {
            n._firstItemOfSet && _.open("itemSets", n._firstItemOfSet)
        }
        ));
        var b = this._itemsListRow = u.content.createChild("div", {
            className: "itemsListRow"
        });
        b.createChild("div", {
            className: "section",
            text: a("tablet.shop.comesWith").toUpperCase()
        }),
        this._itemsList = b.createChild("div", {
            className: "subSection"
        });
        var C = u.content.createChild("div", {
            className: "leftItemDetails"
        });
        this._effectsBox = C.appendChild(new y(a("ui.common.effects", 2).toUpperCase()));
        var I = u.content.createChild("div", {
            className: "rightItemDetails"
        });
        this._conditionsBox = I.appendChild(new y(a("ui.common.conditions").toUpperCase())),
        this._characBox = I.appendChild(new y(a("ui.common.caracteristics").toUpperCase()));
        var T = this.createChild("div", {
            className: "right"
        })
          , S = T.createChild("div", {
            className: "charaContainer"
        });
        S.createChild("div", {
            className: "dummy"
        });
        var A = S.createChild("div", {
            className: "charaElement"
        })
          , E = A.createChild("div", {
            className: "characterOnIsland"
        });
        this._characterOnIsland = E;
        var x = E.createChild("div", {
            className: "islandImage"
        });
        this._islandImage = x,
        this._characterDisplay = E.appendChild(new c);
        var M = this._articleButtons = T.appendChild(new d);
        M.on("tapIAPButton", e),
        M.on("tapHardButton", t),
        M.on("tapSoftButton", i)
    }
    ,
    n.prototype.resize = function() {
        var e = this._characterDisplay.rootElement.getBoundingClientRect()
          , t = A * e.height
          , i = E * e.height;
        this._characterDisplay.setStyle("top", t - i + "px");
        var n = x * e.width;
        this._characterDisplay.setScale(n),
        this.leftColumn.refresh()
    }
    ,
    n.prototype._displayConditions = function(e) {
        for (var t = 0; t < e.length; t++) {
            var i = e[t]
              , n = i.text
              , o = i.isMalus ? ["malus"] : [];
            if ("string" == typeof n)
                this._conditionsBox.addRow(n, o);
            else
                for (var s = 0; s < n.length; s++)
                    this._conditionsBox.addRow(n[s], o)
        }
    }
    ,
    n.prototype._displayOneItem = function(e) {
        this._itemsListRow.hide(),
        this._linkToItemSet.hide();
        var t = a("ui.common.short.weight", e.getProperty("realWeight"));
        this._weight.setText(a("ui.common.weight") + a("ui.common.colon") + t);
        var i;
        if (this._effectsBox.clearContent(),
        this._effectsBox.show(),
        e.hideEffects)
            this._effectsBox.addRow(a("ui.set.secretBonus"));
        else {
            var n = w.getSortedEffectInstances(e);
            if (n && n.length)
                for (i = 0; i < n.length; i++) {
                    var o = n[i];
                    if (!I[o.effectId])
                        if ("" !== o.description) {
                            var s = o.effect.bonusType
                              , r = [];
                            s === -1 ? r.push("malus") : 1 === s && r.push("bonus"),
                            this._effectsBox.addRow(o.description, r)
                        } else
                            console.error("Effect " + o.effectId + " not supported for item " + e.getProperty("id"))
                }
            this._effectsBox.hasRow() || this._effectsBox.addRow(a("tablet.common.none", 0), ["placeholder"])
        }
        this._conditionsBox.clearContent(),
        this._conditionsBox.show();
        var l = e.getProperty("conditionsFormatted")
          , c = e.getProperty("targetConditionsFormatted");
        if (0 === l.length && 0 === c.length ? this._conditionsBox.addRow(a("tablet.common.none", 1), ["placeholder"]) : (this._displayConditions(l),
        this._displayConditions(c)),
        this._characBox.clearContent(),
        e.getProperty("isWeapon")) {
            this._characBox.show();
            var u = e.getProperty("statsFormatted");
            if (0 === u.length)
                this._characBox.addRow(a("tablet.common.none", 1), ["placeholder"]);
            else
                for (i = 0; i < u.length; i++)
                    this._characBox.addRow(u[i])
        } else
            this._characBox.hide();
        this.leftColumn.refresh()
    }
    ,
    n.prototype._displayMultipleItems = function(e) {
        function t() {
            _.open("itemBox", {
                itemData: this.data
            })
        }
        this._itemsListRow.show(),
        this._effectsBox.hide(),
        this._conditionsBox.hide(),
        this._characBox.hide();
        var i, n = 0;
        this._itemsList.clearContent();
        for (var o = 0; o < e.length; o++) {
            i = e[o],
            n += i.getProperty("realWeight");
            var s = new g({
                itemData: i
            });
            s.on("tap", t),
            this._itemsList.appendChild(s)
        }
        var r = a("ui.common.short.weight", n);
        this._weight.setText(a("ui.common.weight") + a("ui.common.colon") + r),
        i = e[0];
        var l = i.itemSetId;
        l && l !== -1 ? (this._firstItemOfSet = i,
        this._linkToItemSet.show()) : (this._firstItemOfSet = null ,
        this._linkToItemSet.hide()),
        this.leftColumn.refresh()
    }
    ,
    n.prototype.update = function(e) {
        if (this.emit("showSubCategoryRow", this._backToCategory),
        e) {
            this._itemsListRow.hide(),
            this._effectsBox.hide(),
            this._conditionsBox.hide(),
            this._characBox.hide(),
            this._backToCategoryText.setText(a("tablet.shop.backTo", e.categoryName));
            var t = e.article;
            this._articleId = t.id,
            this._name.setText(t.name.toUpperCase()),
            this._description.setHtml(t.description),
            this._articleBox.update(t),
            this._articleButtons.update(t),
            this._setClassSymbol(),
            this._characterDisplay.hide(),
            this._islandImage.addClassNames("spinner");
            var i = t.promo && t.promo.length
              , n = t._promoRate;
            if (i || n || t.enddate) {
                this.leftColumn.addClassNames("promo"),
                this.promoBanner.show(),
                this.promoDescription.toggleDisplay(!!i);
                var s, r;
                if (i || n || !t.enddate ? n || t.enddate ? (s = a("tablet.shop.offer") + a("ui.common.colon"),
                n && (s += n),
                t.enddate && (n && (s += " "),
                r = new Date(t.enddate),
                s += a("tablet.common.until", r.toLocaleDateString()))) : s = a("tablet.shop.offer") : (r = new Date(t.enddate),
                s = a("tablet.common.available", a("tablet.common.until", r.toLocaleDateString()))),
                this.promoBanner.setText(s),
                i) {
                    for (var l = t.promo, c = "", h = a("ui.common.colon"), d = 0; d < i - 1; d++)
                        c += l[d].name + h + l[d].description + "<br /><br />";
                    c += l[i - 1].name + h + l[i - 1].description,
                    this.promoDescription.setHtml(c)
                }
            } else
                this.leftColumn.delClassNames("promo"),
                this.promoBanner.hide(),
                this.promoDescription.hide();
            var p = this
              , m = t.itemsId;
            u.getItems(m, function(e, t) {
                if (e)
                    return console.error(e);
                var i = t.length;
                if (m.length !== i)
                    return console.error(new Error("Some items are missing, ids requested: " + m + ", items get: " + t));
                i && (1 === i ? p._displayOneItem(t[0]) : p._displayMultipleItems(t));
                for (var n = [], s = 0; s < i; s++) {
                    var a = t[s];
                    b(a.type.superTypeId) && n.push(a.getProperty("id"))
                }
                n.length ? p.emit("requestPrevisualization", n) : p.setLook(o())
            })
        }
    }
    ,
    n.prototype.setLook = function(e) {
        e = e || o();
        var t = this;
        this._characterDisplay.setLook(e, {
            riderOnly: !0,
            boneType: "characters/",
            skinType: "characters/",
            direction: p.DIRECTION_SOUTH_WEST,
            keepDirection: !1,
            keepModels: !0
        }, function() {
            t._islandImage.delClassNames("spinner"),
            t._characterDisplay.show()
        })
    }
    ,
    n.prototype.updateArticlesPrices = function(e) {
        var t, i = this._articleBox, n = this._articleButtons, o = i.articleId;
        o && (t = e[o],
        t ? i.updatePrice(t) : console.error(new Error("Article " + o + " missing for an ArticleBox"))),
        o = n.articleId,
        o && (t = e[o],
        t ? n.update(t) : console.error(new Error("Article " + o + " missing for an ArticleButtons")))
    }
    ,
    n.prototype._setClassSymbol = function() {
        if (!this._classSymbolImage) {
            var e = this
              , t = window.gui.playerData.characterBaseInformations;
            m.preloadImage("gfx/illusUi/symboles_classe/FichePerso_tx_symboleClasse_frame" + (t.breed - 1) + ".png", function(t) {
                e._classSymbolImage = t,
                e._characterOnIsland.setStyle("backgroundImage", t)
            })
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: "itemDetailsBox"
        }),
        this._createDom(e)
    }
    i(973);
    var o = i(26).inherits
      , s = i(190);
    o(n, s),
    e.exports = n,
    n.prototype._createDom = function(e) {
        var t = this.createChild("div", {
            className: "header"
        });
        t.createChild("div", {
            className: "title",
            text: e
        }),
        t.createChild("div", {
            className: "titleCorner"
        }),
        this._content = this.createChild("div", {
            className: "content"
        })
    }
    ,
    n.prototype.clearContent = function() {
        this._content.clearContent()
    }
    ,
    n.prototype.addRow = function(e, t) {
        t = t || [],
        t.push("row"),
        this._content.createChild("div", {
            className: t,
            text: e
        })
    }
    ,
    n.prototype.hasRow = function() {
        return this._content.getChildCount() > 0
    }
}
, function(e, t, i) {
    function n() {
        r.call(this, {
            title: s("tablet.shop.needMoreHardCurrency").toUpperCase(),
            className: "BuyHardCurrencyConfirmWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 540,
                height: 440,
                isModal: !0
            }
        }),
        this._reset(),
        this.on("open", this._onOpen);
        var e = this
          , t = window.dofus.connectionManager;
        t.on("shopIAPArticlesSuccess", function(t) {
            e.content && e.displayHardCurrencyPack(t)
        }),
        t.on("shopIAPArticlesError", function() {
            e.content && e.displayError(h.NO_PACK, new Error("IAP articles are not available"))
        })
    }
    i(976);
    var o = i(204)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(402)
      , l = i(22)
      , c = i(633)
      , u = i(959)
      , h = {
        NO_PACK: 0,
        AMOUNT_TOO_HIGH: 1
    };
    a(n, r),
    e.exports = n,
    n.prototype._reset = function() {
        this.content = null ,
        this.buyPackText = null ,
        this.articleBoxContainer = null ,
        this.articleBox = null ,
        this.hardCurrencyAmountMissing = 0
    }
    ,
    n.prototype._onOpen = function() {
        this.content || this._createContent()
    }
    ,
    n.prototype.freeContent = function() {
        this.windowBody.clearContent(),
        this._reset()
    }
    ,
    n.prototype._createContent = function() {
        this.content = this.windowBody.createChild("div", {
            className: "content"
        });
        var e = this.content.createChild("div", {
            className: "buyPackTextContainer"
        });
        this.buyPackText = e.createChild("div", {
            className: "buyPackText"
        }),
        this.articleBoxContainer = this.content.createChild("div", {
            className: "articleBoxContainer"
        }),
        this.articleBox = this.articleBoxContainer.appendChild(new u(null ,{
            boxWidth: 190,
            boxHeight: 220
        },{
            showTitle: !0,
            showButtons: !0,
            promoType: "corner"
        })),
        this.content.appendChild(new o({
            text: s("tablet.shop.seeAllHardCurrencyPacks"),
            className: ["greenButton", "seePacksBtn"]
        },function() {
            l.close("buyHardCurrencyConfirm"),
            l.open("market", {
                tabId: "shop",
                tabParams: {
                    category: "goultines"
                }
            })
        }
        ))
    }
    ,
    n.prototype.confirmBuy = function(e) {
        l.open(this.id),
        this.content.hide(),
        this.windowBody.addClassNames("spinner"),
        this.hardCurrencyAmountMissing = e;
        var t = this;
        c.getStoreInfos(function(e) {
            return e ? t.displayError(h.NO_PACK, e) : void window.dofus.send("shopIAPArticlesRequest")
        })
    }
    ,
    n.prototype.displayError = function(e, t) {
        t && console.error(t),
        this.content && (this.content.show(),
        this.articleBoxContainer.hide(),
        this.windowBody.delClassNames("spinner"),
        e === h.AMOUNT_TOO_HIGH ? this.buyPackText.setText(s("tablet.shop.noHardCurrencyPackForAmount")) : this.buyPackText.setText(s("tablet.shop.noHardCurrencyPack")))
    }
    ,
    n.prototype.displayHardCurrencyPack = function(e) {
        var t = c.validateArticles(e.articles)
          , i = null
          , n = Number.MAX_VALUE;
        if (!t.length)
            return this.displayError(h.NO_PACK, new Error("No valid IAP " + t.length + " out of " + e.articles.length + " articles"));
        for (var o = 0; o < t.length; o++) {
            var a = t[o]
              , r = 1 === a.references.length && a.references[0];
            if (r && "GOULTINE" === r.type) {
                var u = parseInt(r.quantity, 10);
                isNaN(u) || u < this.hardCurrencyAmountMissing || u < n && (n = u,
                i = a)
            }
        }
        return i ? (this.content.show(),
        this.articleBoxContainer.show(),
        this.windowBody.delClassNames("spinner"),
        this.buyPackText.setText(s("tablet.shop.buyHardCurrencyPack", n)),
        this.articleBox.update(i),
        void this.articleBox.on("tapIAPButton", function() {
            l.close("buyHardCurrencyConfirm"),
            c.purchaseArticleOnStore(i)
        })) : this.displayError(h.AMOUNT_TOO_HIGH)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        r.call(this, {
            title: s("tablet.purchasesPending.title"),
            className: "PurchasesPendingWindow",
            noCloseButton: !0,
            positionInfo: {
                left: "c",
                top: "c",
                width: 450,
                height: 243,
                isModal: !0
            }
        }),
        this._reset(),
        this.on("open", this._onOpen);
        var e = this
          , t = window.dofus.connectionManager;
        t.on("shopIAPArticlesSuccess", function(t) {
            if (e._content) {
                var i = t.articles;
                c.validateArticles(i),
                e.displayPurchasesList(null , i)
            }
        }),
        t.on("shopIAPArticlesError", function() {
            e._content && e.displayPurchasesList(new Error("IAP articles are not available"))
        })
    }
    i(978);
    var o = i(204)
      , s = i(35).getText
      , a = i(26).inherits
      , r = i(402)
      , l = i(22)
      , c = i(633)
      , u = {
        PENDING: 0,
        FAILED: 1,
        SUCCEEDED: 2
    };
    a(n, r),
    e.exports = n,
    n.prototype._reset = function() {
        this.windowBody.clearContent(),
        this._content = null ,
        this._description = null ,
        this._spinner = null ,
        this._pendingPurchases = [],
        this._purchasesDetails = {},
        this._isProcessing = !1
    }
    ,
    n.prototype._onOpen = function() {
        this._content || this._createContent()
    }
    ,
    n.prototype.freeContent = function() {
        this._reset()
    }
    ,
    n.prototype._createContent = function() {
        this._content = this.windowBody.createChild("div", {
            className: "content"
        });
        var e = this._content.createChild("div", {
            className: "textBox"
        });
        this._description = e.createChild("div", {
            className: "description"
        }),
        this._purchasesList = e.createChild("div", {
            className: "purchasesList"
        }),
        this._spinner = e.createChild("div", {
            className: ["spinnerContainer", "spinner"]
        }),
        this._validationDone = e.createChild("div", {
            className: "validationDone",
            hidden: !0
        }),
        this._okButton = this._content.appendChild(new o({
            text: s("ui.common.ok"),
            className: ["greenButton", "okButton"]
        },function() {
            l.close("purchasesPending")
        }
        )),
        this._okButton.disable()
    }
    ,
    n.prototype._processNext = function() {
        var e = this._pendingPurchases[0]
          , t = this._purchasesDetails[e.productId];
        t && t.article && (this._pendingPurchases.shift(),
        c.validatePendingIAP(e, t.article))
    }
    ,
    n.prototype.displayPurchasesList = function(e, t) {
        if (e && console.error(e),
        this._content)
            if (e)
                this._spinner.hide(),
                this._purchasesList.setText(s("tablet.purchasesPending.listNotAvailable"));
            else {
                for (var i = 0; i < t.length; i++) {
                    var n = t[i]
                      , o = this._purchasesDetails[n.key];
                    if (o) {
                        var a = this._purchasesList.getChild(n.key);
                        a || (a = this._purchasesList.createChild("div", {
                            className: "entry",
                            name: n.key,
                            text: n.name
                        }),
                        a.createChild("div", {
                            className: "state"
                        }),
                        a.createChild("div", {
                            className: "name",
                            text: n.name
                        })),
                        o.article = n;
                        var r = o.state;
                        switch (r) {
                        case u.PENDING:
                            a.delClassNames(["failure", "success"]);
                            break;
                        case u.FAILED:
                            a.replaceClassNames(["success"], ["failure"]);
                            break;
                        case u.SUCCEEDED:
                            a.replaceClassNames(["failure"], ["success"])
                        }
                    }
                }
                this._startProcessing(),
                Object.keys(this._purchasesDetails).length <= this._purchasesList.getChildCount() && this._spinner.hide()
            }
    }
    ,
    n.prototype.validatePendingPurchases = function(e) {
        if (!e || !e.length)
            return console.error(new Error("No purchase to validate: " + e));
        var t = e.filter(function(e) {
            return !this._purchasesDetails[e.productId]
        }, this);
        if (t.forEach(function(e) {
            this._purchasesDetails[e.productId] = {
                state: u.PENDING,
                article: null
            }
        }, this),
        this._pendingPurchases = this._pendingPurchases.concat(t),
        t.length) {
            l.open(this.id),
            this._description.setText(s("tablet.purchasesPending.description", Object.keys(this._purchasesDetails).length) + s("ui.common.colon")),
            this._spinner.show();
            var i = this;
            c.getStoreInfos(function(e) {
                return e ? i.displayPurchasesList(e) : void window.dofus.send("shopIAPArticlesRequest")
            })
        }
    }
    ,
    n.prototype._startProcessing = function() {
        this._isProcessing || (this._isProcessing = !0,
        this._validationDone.hide(),
        this._okButton.disable(),
        this._processNext())
    }
    ,
    n.prototype._endProcessing = function() {
        var e = 0
          , t = !1;
        for (var i in this._purchasesDetails) {
            var n = this._purchasesDetails[i].state;
            n === u.SUCCEEDED ? e++ : t || n !== u.FAILED || (t = !0)
        }
        t && window.wizPurchase.refreshReceipt(function() {}, function(e) {
            console.error("Refresh receipt failed", e)
        }),
        this._isProcessing = !1,
        this._validationDone.setText(s("tablet.purchasesPending.validationDone", e)),
        this._validationDone.show(),
        this._okButton.enable()
    }
    ,
    n.prototype.validateNextPendingPurchases = function(e, t) {
        if (e && console.error(e),
        this._content) {
            var i = this._purchasesList.getChild(t);
            this._purchasesDetails[t].state = e ? u.FAILED : u.SUCCEEDED,
            i && (e ? i.replaceClassNames(["success"], ["failure"]) : i.replaceClassNames(["failure"], ["success"])),
            this._pendingPurchases.length ? this._processNext() : this._endProcessing()
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        a.call(this, "div", {
            className: "connectionSplashScreen",
            hidden: !0
        }),
        this.autoRemoveTimeout = null ,
        this.once("show", this._createContent)
    }
    i(980);
    var o = i(35).getText
      , s = i(26).inherits
      , a = i(190)
      , r = 15e3;
    s(n, a),
    e.exports = n,
    n.prototype._createContent = function() {
        this.createChild("div", {
            className: "lockingDiv"
        });
        var e = this.createChild("div", {
            className: "splashScreenMsg"
        });
        this.message = e.createChild("div", {
            className: "message"
        }),
        this.createChild("div", {
            className: ["spinner", "splashSpinner"]
        })
    }
    ,
    n.prototype.onStateChange = function(e, t) {
        switch ("UNSTABLE" !== e && (this.autoRemoveTimeout = window.clearTimeout(this.autoRemoveTimeout)),
        e) {
        case "UNSTABLE":
            if (this.show(),
            this.message.setText(o("tablet.connect.lost")),
            this.autoRemoveTimeout)
                return;
            var i = this;
            this.autoRemoveTimeout = window.setTimeout(function() {
                i.autoRemoveTimeout = null ,
                i.hide()
            }, r);
            break;
        case "RECONNECTING":
            this.show(),
            this.message.setText(o("tablet.connect.retrying", t));
            break;
        case "RELOADING":
            this.show(),
            this.message.setText(o("tablet.connect.reloading"));
            break;
        case "CONNECTED":
        case "DISCONNECTED":
            this.hide();
            break;
        default:
            console.error("ConnectionSplashScreen#onStateChange: invalid state: " + e)
        }
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: ["loginScreen", "screen"],
            hidden: !0
        }),
        E = v.isWebGlSupported(),
        this._connectMethod = _.getValue("connectMethod", x, !0);
        var e = window.gui
          , t = this;
        this._changeLangMethod = N.UPDATE_DOM,
        this.once("show", function() {
            this._createContent()
        }),
        E && (this.on("show", this._updateContent),
        e.on("appBackFromBackground", function() {
            t.isVisible() && t._updateContent()
        }),
        this.on("hide", function() {
            t.delClassNames("backgroundImage"),
            t._toolTip && t._toolTip.close()
        })),
        e.on("NicknameRegistrationMessage", function() {
            y.open("nickname")
        }),
        window.dofus.on("wasAlreadyConnected", function() {
            e.openSimplePopup(d("ui.connection.disconnectAccount"), d("ui.popup.warning"))
        })
    }
    i(982);
    var o = i(26).inherits
      , s = i(190)
      , a = i(84)
      , r = i(204)
      , l = i(305)
      , c = i(7)
      , u = i(24).dimensions
      , h = i(35)
      , d = h.getText
      , p = i(51)
      , m = i(210)
      , f = i(50)
      , g = i(32)
      , _ = i(30)
      , v = i(267)
      , y = i(22)
      , w = i(983)
      , b = i(988)
      , C = i(990)
      , I = i(992)
      , T = i(996)
      , S = i(999)
      , A = i(987).connectMethod
      , E = !0
      , x = A.lastCharacter
      , M = 670
      , N = {
        UPDATE_DOM: 0,
        RELOAD_PAGE: 1
    };
    o(n, s),
    e.exports = n,
    n.prototype._createContent = function() {
        function e(e) {
            e.on("submit", function(e) {
                e = e || {},
                t._login(e.login, e.password, e.save)
            })
        }
        var t = this;
        if (!E)
            return this._webGlUnsupported = this.createChild("div", {
                className: "webGlUnsupported"
            }),
            void this._webGlUnsupported.setText(d("tablet.login.webGlUnsupported"));
        var i = this.createChild("div", {
            className: "verticalPositionerWrapper"
        })
          , n = i.createChild("div", {
            className: "verticalPositioner"
        });
        n.createChild("div", {
            className: "spacer"
        }),
        n.createChild("div", {
            className: "spacer"
        }),
        this._leftColumn = n.createChild("div", {
            className: "leftColumn"
        }),
        this._newsBlock = this._leftColumn.appendChild(new I(this)),
        this._forumBlock = this._leftColumn.appendChild(new T(this)),
        this._forumBlock.retractableBlock.setBoundedRetractableBlock(this._newsBlock.retractableBlock),
        this._newsBlock.retractableBlock.expand(),
        this._loginForm = n.appendChild(new C(this)),
        this._guestForm = n.appendChild(new w(this)),
        this._tokenForm = n.appendChild(new b(this)),
        n.createChild("div", {
            className: "spacer"
        }),
        n.createChild("div", {
            className: "spacer"
        }),
        e(this._loginForm),
        e(this._guestForm),
        e(this._tokenForm),
        this.displayAppropriateForm(),
        this._createLangButton(),
        this._createBottomLinks(),
        this._createSocialButtons(),
        this._audioSetup()
    }
    ,
    n.prototype._createLangButton = function() {
        this._toolTip = this.appendChild(new l);
        var e = window.Config
          , t = this;
        this._langButton = this.createChild("div", {
            className: "langButton"
        }),
        this._langFlag = this._langButton.createChild("div", {
            className: "flag"
        }),
        g(this._langButton),
        this._langButton.on("tap", function() {
            for (var i = [], n = e.language, o = 0; o < e.serverLanguages.length; o++) {
                var a = e.serverLanguages[o]
                  , r = new s("div",{
                    className: "langLine"
                });
                r.createChild("div", {
                    className: ["flag", a]
                }),
                r.createChild("div", {
                    className: "caption",
                    text: a
                });
                var l = ["langLineParent"];
                a === n && l.push("current"),
                i.push({
                    wuiDomChild: r,
                    addClassNames: l,
                    lang: a
                })
            }
            t._toolTip.openAround(this, {
                title: "",
                actions: i
            })
        }),
        this._toolTip.on("action", function(i) {
            var n = i.lang;
            if (n !== e.language)
                return t._changeLangMethod === N.RELOAD_PAGE ? (_.setValue("lang", n),
                _.saveNow(),
                void window.location.reload()) : void h.initialize({
                    language: n,
                    chaseText: e.chaseText
                }, function(i) {
                    if (i)
                        return console.error("LoginScreen getText init", i);
                    e.language = n,
                    t.backToLogin(),
                    _.setValue("lang", n, 1),
                    t._updateContent();
                    var o = t._toolTip.entryList.getChildren();
                    o[o.length - 1].setText(d("ui.common.cancel"))
                })
        })
    }
    ,
    n.prototype._createBottomLinks = function() {
        function e() {
            m.openUrlInAppBrowser(this.link)
        }
        var t = this.createChild("div", {
            className: "footer"
        });
        this._versionLabel = t.createChild("div", {
            className: "globalMenuVersion"
        }),
        this._tou = t.appendChild(new r({
            className: ["link"]
        })),
        this._gcs = t.appendChild(new r({
            className: ["link"]
        })),
        this._tou.on("tap", e),
        this._gcs.on("tap", e)
    }
    ,
    n.prototype._createSocialButtons = function() {
        function e() {
            var e = window.Config.language;
            return S[e] || (e = S.fallbackLanguage),
            e
        }
        var t = this
          , i = this._leftColumn;
        u.screenHeight < M && (i = t);
        var n = i.createChild("div", {
            className: "socialBox"
        })
          , o = n.appendChild(new r({
            className: ["socialNetworkButton", "facebookButton"]
        }))
          , s = n.appendChild(new r({
            className: ["socialNetworkButton", "twitterButton"]
        }))
          , a = n.appendChild(new r({
            className: ["socialNetworkButton", "forumButton"]
        }));
        g(o),
        o.on("tap", function() {
            var i = e();
            t._openSocialNetwork({
                schemeiOS: "fb://",
                schemeUrl: "fb://profile/" + S[i].facebookPageNumericId,
                browserUrl: "https://www.facebook.com/" + S[i].facebookPageNumericId
            })
        }),
        g(s),
        s.on("tap", function() {
            var i = e();
            t._openSocialNetwork({
                schemeiOS: "twitter://",
                schemeAndroid: "com.twitter.android",
                schemeUrl: "twitter://user?screen_name=" + S[i].twitterAccountId,
                browserUrl: "https://twitter.com/" + S[i].twitterAccountId
            })
        }),
        g(a),
        a.on("tap", function() {
            m.openUrlInAppBrowser(d("tablet.forum.link"))
        })
    }
    ,
    n.prototype._audioSetup = function() {
        var e = _.getValue("soundPreferences", a.getDefaultParams(), !0);
        a.setupChannels(e),
        a.settings.audioPath = window.Config.assetsUrl + "/audio/",
        a.initialize(),
        e.ui.muted || a.createUiSound("GEN_BUTTON")
    }
    ,
    n.prototype.showLoginForm = function() {
        this._loginForm.show(),
        this._guestForm.hide(),
        this._tokenForm.hide()
    }
    ,
    n.prototype.showGuestForm = function() {
        this._loginForm.hide(),
        this._guestForm.show(),
        this._tokenForm.hide()
    }
    ,
    n.prototype.showTokenForm = function() {
        this._loginForm.hide(),
        this._guestForm.hide(),
        this._tokenForm.show()
    }
    ,
    n.prototype.displayAppropriateForm = function() {
        if (p.hasKeyFromStorage() && !window.Config.byPassToken)
            this.showTokenForm();
        else {
            var e = _.getValue("hasAccount", !1, !0);
            e ? this.showLoginForm() : this.showGuestForm()
        }
    }
    ,
    n.prototype.openRegisterWindow = function(e) {
        var t = this
          , i = {
            guestAccount: e,
            onValidate: function(e) {
                t._afterValidation(e)
            },
            isModal: !0
        };
        y.open("register", i)
    }
    ,
    n.prototype._afterValidation = function(e) {
        return e ? (_.delValue("guestAccount"),
        window.localStorage.removeItem("lastIdentification"),
        _.setValue("hasAccount", !0, 1),
        window.gui.openSimplePopup(d("tablet.register.done"), d("ui.common.congratulation")),
        void this.showLoginForm()) : this._updateContent()
    }
    ,
    n.prototype.backToLogin = function() {
        y.closeAll(),
        window.gui.splashScreen.hide(),
        this.show()
    }
    ,
    n.prototype._login = function(e, t, i) {
        function n(e) {
            e || window.gui.initializeAfterLogin(function(e) {
                e && (console.error("initializeAfterLogin failed:", e),
                window.gui.openSimplePopup(d("ui.popup.connectionFailed.text")))
            })
        }
        this._changeLangMethod = N.RELOAD_PAGE,
        window.gui.splashScreen.show(),
        e ? f.startLoginProcessWithPassword(this._connectMethod, e, t, i, n) : f.startLoginProcessWithoutPassword(this._connectMethod, n)
    }
    ,
    n.prototype._updateContent = function() {
        this.addClassNames("backgroundImage"),
        this.displayAppropriateForm(),
        this._loginForm.refresh(),
        this._guestForm.refresh(),
        this._tokenForm.refresh(),
        this._newsBlock.refresh(),
        this._forumBlock.refresh();
        for (var e = 0; e < window.Config.serverLanguages.length; e++) {
            var t = window.Config.serverLanguages[e];
            this._langFlag.toggleClassName(t, t === window.Config.language)
        }
        this._tou.setText(d("tablet.legals.tou")),
        this._gcs.setText(d("tablet.legals.gcs")),
        this._tou.link = d("tablet.legals.link.tou"),
        this._gcs.link = d("tablet.legals.link.gcs"),
        this._versionLabel.setText(window.gui.getBuildVersion())
    }
    ,
    n.prototype._openSocialNetwork = function(e) {
        if (!window.appAvailability)
            return m.openUrlInDeviceBrowser(e.browserUrl);
        var t = "";
        c.isIOSApp ? t = e.schemeiOS : c.isAndroidApp && (t = e.schemeAndroid),
        window.appAvailability.check(t, function() {
            window.open(e.schemeUrl, "_system", "location=no")
        }, function() {
            m.openUrlInDeviceBrowser(e.browserUrl)
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: ["GuestForm", "rightColumn"],
            hidden: !0
        }),
        this.loginScreen = e;
        var t = this;
        this.guestAccount = null ,
        this.isAlreadyGuest = null ,
        this.nickname = null ,
        this.createChild("div", {
            className: ["frame", "frame1"]
        });
        var i = this.createChild("div", {
            className: "content"
        });
        i.createChild("div", {
            className: "dofusTouchLogo"
        });
        var n = i.createChild("div", {
            className: "form"
        });
        this._introText = n.createChild("div", {
            className: "introText"
        }),
        this._btnPlay = n.createChild("div", {
            className: "horizontalCenter"
        }).appendChild(new a({
            className: ["button", "buttonPlay"],
            sound: "OK_BUTTON"
        })),
        this._btnPlay.on("tap", function() {
            if (!t.isAlreadyGuest)
                return t._createGuest();
            var i = window.localStorage.getItem("lastIdentification");
            if (i) {
                var n = Date.now() - i;
                if (n > 864e5)
                    return window.gui.openConfirmPopup({
                        title: r("tablet.oldGuest.register"),
                        message: r("tablet.oldGuest.registerReminder"),
                        cb: function(i) {
                            return i ? e.openRegisterWindow(t.guestAccount) : void t._play()
                        }
                    }),
                    void t._updateLastIdentificationTime()
            } else
                t._updateLastIdentificationTime();
            t._play()
        }),
        this._connectionOptions = n.appendChild(new u(e,this)),
        this._createAccount = this.appendChild(new a({
            className: "switchAccountBtn"
        },function() {
            e.openRegisterWindow(t.guestAccount)
        }
        )),
        this._hasAnAccount = this.appendChild(new a({
            className: "switchAccountBtn2nd"
        },function() {
            l.setValue("hasAccount", !0, 1),
            e.showLoginForm()
        }
        )),
        this.createChild("div", {
            className: "greenLine"
        })
    }
    i(984);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(35).getText
      , l = i(30)
      , c = i(51)
      , u = i(985);
    o(n, s),
    e.exports = n,
    n.prototype.refresh = function() {
        this._btnPlay.setText(r("ui.common.play")),
        this._hasAnAccount.setText(r("tablet.login.haveLogin")),
        this._connectionOptions.refresh(),
        this._update()
    }
    ,
    n.prototype._update = function() {
        this.guestAccount = l.getValue("guestAccount", null , !0),
        this.isAlreadyGuest = !!(this.guestAccount && this.guestAccount.login && this.guestAccount.password),
        this.nickname = this.guestAccount && this.guestAccount.nickname || "guestWithNoNickname",
        this.isAlreadyGuest ? (this._createAccount.setText(r("tablet.oldGuest.register")),
        "guestWithNoNickname" === this.nickname ? this._introText.setText(r("tablet.oldGuest.desc.no.nick")) : this._introText.setText(r("tablet.oldGuest.desc", this.nickname))) : (this._createAccount.setText(r("tablet.login.createAccount")),
        this._introText.setText(r("tablet.newGuest.desc")))
    }
    ,
    n.prototype._createGuest = function() {
        var e = this;
        this._btnPlay.addClassNames("disabled"),
        c.createGuest(function(t, i) {
            if (e._btnPlay.delClassNames("disabled"),
            t) {
                var n = r("ui.secureMode.error.default");
                return t._statusCode >= 600 && (n = t.text),
                window.gui.openSimplePopup(n)
            }
            var o = {
                login: i.login,
                password: i._headers.password
            };
            return l.setValue("guestAccount", o, 1),
            e._play(o)
        })
    }
    ,
    n.prototype._updateLastIdentificationTime = function() {
        window.localStorage.setItem("lastIdentification", Date.now())
    }
    ,
    n.prototype._play = function(e) {
        e = e || {
            login: this.guestAccount.login,
            password: this.guestAccount.password
        },
        this.emit("submit", {
            login: e.login,
            password: e.password,
            save: e.save
        })
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e, t, i) {
        s.call(this, "div", {
            className: "ConnectionOptions"
        }),
        this.loginScreen = e,
        i = i || {};
        var n = this;
        this._bottomLinks = this.appendChild(new a({
            className: "bottomLinks"
        })),
        i.forgotPassword && (this._forgottenPassword = this._bottomLinks.appendChild(new a({
            className: "forgottenPassword"
        })),
        this._forgottenPassword.on("tap", function() {
            l.openUrlInAppBrowser(this.link)
        })),
        this._connectionOptions = this._bottomLinks.appendChild(new a({
            className: "connectionOptions"
        })),
        this._connectionOptions.on("tap", function() {
            var e = !n._advancedOptions.isVisible();
            n._advancedOptions.toggleDisplay(e),
            n._connectionOptions.toggleClassName("selected", e),
            e && n._update()
        }),
        this._advancedOptions = this.createChild("div", {
            className: "advancedOptions"
        }),
        this._advancedOptions.hide(),
        this._grayLine = this._advancedOptions.createChild("div", {
            className: "grayLine"
        }),
        this.connectionMethodSelector = this._advancedOptions.appendChild(new c({
            className: ""
        })),
        this._advancedOptions.createChild("div", {
            className: "clearFloat"
        }),
        this.connectionMethodSelector.on("change", function(e) {
            n.loginScreen._connectMethod = e,
            u.setValue("connectMethod", e, null , !0)
        })
    }
    i(986);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(35).getText
      , l = i(210)
      , c = i(393)
      , u = i(30)
      , h = i(987);
    o(n, s),
    e.exports = n,
    n.prototype.refresh = function() {
        this._forgottenPassword && (this._forgottenPassword.setText(r("ui.login.forgottenPassword")),
        this._forgottenPassword.link = r("tablet.link.findPassword")),
        this._connectionOptions.setText(r("tablet.login.connectionOptions")),
        this.connectionMethodSelector.clearContent();
        for (var e in h.connectMethod)
            this.connectionMethodSelector.addOption(r("tablet.login.connectionOption." + e), e);
        this._update()
    }
    ,
    n.prototype._update = function() {
        this.connectionMethodSelector.select(this.loginScreen._connectMethod, !0)
    }
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        social: {
            fr: {
                facebookPageId: "DOFUSTouch",
                facebookPageNumericId: "1663041913975144",
                twitterAccountId: "DofusTouch"
            },
            en: {
                facebookPageId: "DOFUSTouch",
                facebookPageNumericId: "1663041913975144",
                twitterAccountId: "DOFUSTouch_EN"
            },
            fallbackLanguage: "en"
        },
        connectMethod: {
            manual: "manual",
            lastServer: "lastServer",
            lastCharacter: "lastCharacter"
        }
    }
}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: ["TokenForm", "rightColumn"],
            hidden: !0
        }),
        this.loginScreen = e;
        var t = this;
        this.createChild("div", {
            className: ["frame", "frame1"]
        });
        var i = this.createChild("div", {
            className: "content"
        });
        i.createChild("div", {
            className: "dofusTouchLogo"
        });
        var n = i.createChild("div", {
            className: "form"
        });
        this._introText = n.createChild("div", {
            className: "introText"
        }),
        this._btnPlay = n.createChild("div", {
            className: "horizontalCenter"
        }).appendChild(new a({
            className: ["button", "buttonPlay"],
            sound: "OK_BUTTON"
        })),
        this._btnPlay.on("tap", function() {
            t._play()
        }),
        this._connectionOptions = n.appendChild(new c(e,this)),
        this._guestLink = this.appendChild(new a({
            className: "switchAccountBtn"
        },function() {
            l.resetHaapiKey(),
            t.loginScreen.showLoginForm()
        }
        )),
        this.createChild("div", {
            className: "greenLine"
        })
    }
    i(989);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(35).getText
      , l = i(51)
      , c = i(985);
    o(n, s),
    e.exports = n,
    n.prototype.refresh = function() {
        var e = l.getHaapiUsername();
        this._introText.setText(r("tablet.token.desc", e)),
        this._btnPlay.setText(r("ui.common.play")),
        this._guestLink.setText(r("tablet.token.notme", e)),
        this._connectionOptions.refresh(),
        this._update()
    }
    ,
    n.prototype._update = function() {}
    ,
    n.prototype._play = function() {
        this.emit("submit")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: ["LoginForm", "rightColumn"],
            hidden: !0
        }),
        this.loginScreen = e;
        var t = this;
        this.createChild("div", {
            className: ["frame", "frame1"]
        });
        var i = this.createChild("div", {
            className: ["content"]
        });
        i.createChild("div", {
            className: ["dofusTouchLogo"]
        });
        var n = i.createChild("div", {
            className: ["form"]
        });
        this._labelLogin = n.createChild("label"),
        this._inputLogin = n.appendChild(new c({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "text"
            }
        })),
        this._inputLogin.on("validate", function() {
            t._inputPassword.focus()
        }),
        this._labelPassword = n.createChild("label"),
        this._inputPassword = n.appendChild(new c({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "password"
            }
        })),
        this._inputPassword.on("validate", function() {
            t._play()
        }),
        this._rememberName = n.appendChild(new r("")),
        this._btnPlay = n.createChild("div", {
            className: ["horizontalCenter"]
        }).appendChild(new a({
            className: ["button", "buttonPlay"],
            sound: "OK_BUTTON"
        })),
        this._btnPlay.on("tap", function() {
            t._play()
        }),
        this._connectionOptions = n.appendChild(new d(e,this,{
            forgotPassword: !0
        })),
        this._guestLink = this.appendChild(new a({
            className: "switchAccountBtn"
        },function() {
            h.setValue("hasAccount", !1, 1),
            t.loginScreen.showGuestForm()
        }
        )),
        this.createChild("div", {
            className: "greenLine"
        })
    }
    i(991);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(448)
      , l = i(35).getText
      , c = i(391)
      , u = i(301)
      , h = i(30)
      , d = i(985);
    o(n, s),
    e.exports = n,
    n.prototype.refresh = function() {
        this._labelLogin.setText(l("ui.login.username")),
        this._labelPassword.setText(l("ui.login.password")),
        this._btnPlay.setText(l("ui.common.play")),
        this._rememberName.setText(l("tablet.login.rememberMe")),
        this._guestLink.setText(l("tablet.login.noAccount")),
        this._connectionOptions.refresh(),
        this._update()
    }
    ,
    n.prototype._update = function() {
        this._rememberName.toggleActivation(!1, !0),
        this._inputLogin.setValue(""),
        window.developmentMode ? this._inputPassword.setValue(window.Config.defaultPassword || "") : this._inputPassword.setValue("")
    }
    ,
    n.prototype._play = function() {
        u.hide();
        var e = this._inputLogin.getValue()
          , t = this._inputPassword.getValue()
          , i = this._rememberName.isActivate();
        return window.developmentMode || e && t ? void this.emit("submit", {
            login: e,
            password: t,
            save: i
        }) : window.gui.openSimplePopup(l("ui.popup.accessDenied.wrongCredentials"))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        function t(e) {
            function t() {
                var t = i._newsUrls[e];
                t && c.openUrlInAppBrowser(t)
            }
            i._banners[e].on("tap", t),
            i._bannerTitles[e].on("tap", t)
        }
        s.call(this, "div", {
            className: "NewsBlock",
            hidden: !1
        });
        var i = this;
        this.loginScreen = e,
        this._newsLoadedTime = 0,
        this._currentPage = 0,
        this._newsLang = null ,
        this._transitioning = !1,
        this._setTimoutId = null ,
        this._carouselPages = [],
        this._banners = [],
        this._newsUrls = [],
        this._bannerTitles = [],
        this._date = [],
        this._dots = [],
        this.retractableBlock = this.appendChild(new u((!1)));
        var n = this.retractableBlock.getContainer();
        this._carouselMargin = n.createChild("div", {
            className: "carouselMargin"
        }),
        this._carouselWrapper = this._carouselMargin.createChild("div", {
            className: "carouselWrapper"
        }),
        c.cssTransition(this._carouselWrapper, m + "ms"),
        this._dotsWrapper = this._carouselMargin.createChild("div", {
            className: "dotsWrapper",
            hidden: !0
        });
        for (var o = 0; o < g; o++)
            this._carouselPages[o] = this._carouselWrapper.createChild("div", {
                className: ["carouselPage", "page" + o],
                hidden: !0
            }),
            this._banners[o] = this._carouselPages[o].createChild("div", {
                className: ["banner", "spinner"]
            }),
            h(this._banners[o]),
            this._bannerTitles[o] = this._carouselPages[o].createChild("div", {
                className: "bannerTitle"
            }),
            h(this._bannerTitles[o]),
            this._date[o] = this._carouselPages[o].createChild("div", {
                className: "date"
            }),
            t(o),
            this._dots[o] = this._dotsWrapper.createChild("div", {
                className: "dot"
            });
        this._resetTransform(),
        this._updateDots(),
        this._rightArrow = n.appendChild(new a({
            className: "rightArrow",
            hidden: !0
        },function() {
            i._transitioning || i._scrollToNextNews()
        }
        )),
        this._leftArrow = n.appendChild(new a({
            className: "leftArrow",
            hidden: !0
        },function() {
            i._transitioning || i._scrollToPrevNews()
        }
        )),
        e.on("hide", function() {
            for (var e = 0; e < g; e++)
                i._banners[e].setStyle("backgroundImage", "initial");
            i._newsLoadedTime = 0,
            i._clearTimeout()
        })
    }
    i(993);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = i(35).getText
      , l = i(51)
      , c = i(210)
      , u = i(994)
      , h = i(32)
      , d = 5e3
      , p = 288e5
      , m = 600
      , f = 475
      , g = 3;
    o(n, s),
    e.exports = n,
    n.prototype.refresh = function() {
        this.retractableBlock.show(),
        this.retractableBlock.setTitle(r("tablet.login.news")),
        this._update()
    }
    ,
    n.prototype._update = function() {
        var e = window.Config
          , t = this;
        Date.now() - this._newsLoadedTime < p && this._newsLang === e.language || (this._clearTimeout(),
        this._rightArrow.hide(),
        this._leftArrow.hide(),
        this._dotsWrapper.hide(),
        this._newsLoadedTime = 0,
        this._banners[this._currentPage].addClassNames("spinner"),
        l.getNewsList(g, function(i, n) {
            if (i || !n)
                return t._noNewsFallback();
            if (!n.length)
                return t.loginScreen._forumBlock.retractableBlock.expand(),
                t._noNewsFallback();
            t._newsLoadedTime = Date.now();
            for (var o = 0; o < g; o++) {
                var s = n[o]
                  , a = s.image_url;
                t._banners[o].delClassNames(["spinner", "noNewsFallback"]),
                a && t._banners[o].setStyle("backgroundImage", 'url("' + a + '")'),
                t._date[o].setText(s.date),
                t._newsUrls[o] = s.url,
                t._bannerTitles[o].setText(s.title)
            }
            t._rightArrow.show(),
            t._leftArrow.show(),
            t._dotsWrapper.show(),
            t._registerNextNewsChange(),
            t._newsLang = e.language
        }))
    }
    ,
    n.prototype._scrollToPrevNews = function() {
        this._scrollNews(-1)
    }
    ,
    n.prototype._scrollToNextNews = function() {
        this._scrollNews(1)
    }
    ,
    n.prototype._scrollNews = function(e) {
        if (e === -1 || 1 === e) {
            var t = this;
            this._transitioning || (this._clearTimeout(),
            this._currentPage = (this._currentPage + g + e) % g,
            c.cssTransform(this._carouselWrapper, "translate(" + (1 === e ? 2 * -f : 0) + "px, 0px)"),
            this._updateDots(),
            this._transitioning = !0,
            setTimeout(function() {
                t._resetTransform(),
                t._transitioning = !1,
                t._registerNextNewsChange()
            }, m + 200))
        }
    }
    ,
    n.prototype._updateDots = function() {
        for (var e = 0; e < g; e++)
            this._dots[e].toggleClassName("selected", this._currentPage === e)
    }
    ,
    n.prototype._resetTransform = function() {
        c.cssTransition(this._carouselWrapper, "0ms"),
        c.forceReflow(this._carouselWrapper),
        c.cssTransform(this._carouselWrapper, "translate(-" + f + "px, 0px)"),
        c.forceReflow(this._carouselWrapper),
        c.cssTransition(this._carouselWrapper, m + "ms");
        for (var e = 0; e < g; e++) {
            var t = e === this._currentPage - 1 || e - g === this._currentPage - 1
              , i = e === this._currentPage
              , n = e === this._currentPage + 1 || e + g === this._currentPage + 1
              , o = t || i || n;
            if (o) {
                var s = t ? 0 : i ? f : 2 * f;
                this._carouselPages[e].setStyle("left", s + "px"),
                this._carouselPages[e].show()
            } else
                this._carouselPages[e].hide()
        }
    }
    ,
    n.prototype._registerNextNewsChange = function() {
        var e = this;
        null === this._setTimoutId && (this._transitioning || 0 !== e._newsLoadedTime && (this._setTimoutId = setTimeout(function() {
            this._setTimoutId = null ,
            0 !== e._newsLoadedTime && (e._scrollToNextNews(),
            e._registerNextNewsChange())
        }, d)))
    }
    ,
    n.prototype._clearTimeout = function() {
        null !== this._setTimoutId && (clearTimeout(this._setTimoutId),
        this._setTimoutId = null )
    }
    ,
    n.prototype._noNewsFallback = function() {
        this._newsLoadedTime = 0,
        this._leftArrow.hide(),
        this._rightArrow.hide(),
        this._dotsWrapper.hide(),
        this._clearTimeout();
        for (var e = 0; e < g; e++)
            this._banners[e].delClassNames("spinner"),
            this._bannerTitles[e].setText(r("tablet.login.noNewsFallback"));
        this._banners[this._currentPage].addClassNames("noNewsFallback"),
        this._newsUrls[this._currentPage] = r("tablet.forum.link")
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n(e) {
        s.call(this, "div", {
            className: "RetractableBlock",
            hidden: !1
        });
        var t = this;
        this._isExpanded = !1,
        this._boundedBlock = null ,
        this.createChild("div", {
            className: ["frame", "frame2"]
        });
        var i = this.createChild("div", {
            className: "content"
        });
        this._titleBox = i.createChild("div", {
            className: "titleBox"
        }),
        this._titleBullet = this._titleBox.createChild("div", {
            className: "titleBullet"
        }),
        this._title = this._titleBox.createChild("div", {
            className: "title"
        }),
        e && (this._expandButton = this._titleBox.appendChild(new a({
            className: ["greenButton", "expandButton"]
        },function() {
            t._isExpanded ? (t._retract(),
            t._boundedBlock && t._boundedBlock.expand()) : t.expand()
        }
        )),
        this._expandButton.createChild("div", {
            className: "expandeButtonContent",
            text: "+"
        })),
        this._subTitle = this._titleBox.createChild("div", {
            className: "subTitle"
        }),
        this._retractable = i.createChild("div", {
            className: "retractable"
        }),
        r.push(this)
    }
    i(995);
    var o = i(26).inherits
      , s = i(190)
      , a = i(204)
      , r = [];
    o(n, s),
    e.exports = n,
    n.prototype.getContainer = function() {
        return this._retractable
    }
    ,
    n.prototype.setTitle = function(e) {
        this._title.setText(e)
    }
    ,
    n.prototype.setSubTitle = function(e) {
        this._subTitle.setText(e)
    }
    ,
    n.prototype.expand = function() {
        for (var e = 0; e < r.length; e++) {
            var t = r[e];
            this === t ? t._expand() : t._retract()
        }
    }
    ,
    n.prototype._expand = function() {
        this._isExpanded || (this._retractable.addClassNames("expanded"),
        this._titleBox.addClassNames("expanded"),
        this._expandButton && (this._boundedBlock ? this._expandButton.setText("-") : this._expandButton.addClassNames("expanded")),
        this._isExpanded = !0)
    }
    ,
    n.prototype._retract = function() {
        this._isExpanded && (this._retractable.delClassNames("expanded"),
        this._titleBox.delClassNames("expanded"),
        this._expandButton && (this._boundedBlock ? this._expandButton.setText("+") : this._expandButton.delClassNames("expanded")),
        this._isExpanded = !1)
    }
    ,
    n.prototype.setBoundedRetractableBlock = function(e) {
        return this._boundedBlock || e._boundedBlock ? console.error(new Error("RetractableBlock: a block is already bounded to another one")) : (this._boundedBlock = e,
        void (e._boundedBlock = this))
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this, "div", {
            className: "ForumBlock",
            hidden: !1
        }),
        this._newsLoaded = !1,
        this.retractableBlock = this.appendChild(new m((!0)));
        var e = this.retractableBlock.getContainer().createChild("div", {
            className: ["forumNewsMargin"]
        });
        this._content = e.createChild("div", {
            className: ["forumNews"]
        }),
        s()
    }
    function o(e) {
        return e = e.filter(function(e) {
            return !e.pinned
        }),
        e.sort(function(e, t) {
            return Date.parse(t.added_date) - Date.parse(e.added_date)
        }),
        e[0]
    }
    function s() {
        var e = {
            openTag: function() {
                return "<center>" + h("tablet.login.forumUnsupportedTag") + "</center><br />"
            },
            closeTag: function() {
                return ""
            },
            displayContent: !1
        };
        u.addTags({
            h2: {
                openTag: function() {
                    return "<h3>"
                },
                closeTag: function() {
                    return "</h3>"
                }
            },
            h3: {
                openTag: function() {
                    return "<h4>"
                },
                closeTag: function() {
                    return "</h4>"
                }
            },
            hr: {
                openTag: function() {
                    return '<br /><hr class="postSeparator"><br />'
                },
                closeTag: function() {
                    return ""
                }
            },
            embed: e,
            spoiler: e
        })
    }
    function a(e) {
        return e = e.replace(/\[hr\]/g, "[hr][/hr]"),
        e = e.replace(/\[list=1\]/g, "[list type=decimal]")
    }
    function r(e) {
        return e = e.replace(/(?:\r\n|\r|\n)/g, "<br />")
    }
    i(997);
    var l = i(26).inherits
      , c = i(190)
      , u = i(998)
      , h = i(35).getText
      , d = i(51)
      , p = i(210)
      , m = i(994);
    l(n, c),
    e.exports = n,
    n.prototype.refresh = function() {
        this.retractableBlock.show(),
        this.retractableBlock.setTitle(h("tablet.login.changelog")),
        this._update()
    }
    ,
    n.prototype._update = function() {
        var e = this;
        this._content.clearContent(),
        this._content.addClassNames("spinner"),
        d.getForumTopicsList(function(t, i) {
            if (t)
                return window.developmentMode && console.error(t),
                e._content.delClassNames("spinner"),
                e._content.setHtml(h("tablet.login.forumUnreachable")),
                void p.allLinksOnTargetBlank(e._content);
            var n = o(i);
            d.getForumPostsList(n.id, function(t, i) {
                if (e._content.delClassNames("spinner"),
                t)
                    return e._content.setHtml(h("tablet.login.forumUnreachable")),
                    void p.allLinksOnTargetBlank(e._content);
                var o, s = [n].concat(i), l = "";
                for (o = 0; o < s.length; o++) {
                    l += 0 === o ? "<h2>" + s[o].title + "</h2><br/>" : "<br /><br /><center>* * *</center><br />";
                    var c = s[o].content;
                    c = a(c),
                    c = u.process({
                        text: c
                    }).html,
                    c = r(c),
                    l += c
                }
                e._content.setHtml(l),
                p.allLinksOnTargetBlank(e._content),
                e.retractableBlock.setSubTitle(n.title)
            })
        })
    }
}
, function(e, t) {}
, function(e, t) {
    var i = function() {
        "use strict";
        function e() {
            l = [];
            var e, t, i;
            for (e in r)
                if (r.hasOwnProperty(e)) {
                    for ("*" === e ? l.push("\\" + e) : (l.push(e),
                    r[e].noParse && T.push(e)),
                    r[e].validChildLookup = {},
                    r[e].validParentLookup = {},
                    r[e].restrictParentsTo = r[e].restrictParentsTo || [],
                    r[e].restrictChildrenTo = r[e].restrictChildrenTo || [],
                    i = r[e].restrictChildrenTo.length,
                    t = 0; t < i; t++)
                        r[e].validChildLookup[r[e].restrictChildrenTo[t]] = !0;
                    for (i = r[e].restrictParentsTo.length,
                    t = 0; t < i; t++)
                        r[e].validParentLookup[r[e].restrictParentsTo[t]] = !0
                }
            c = new RegExp("<bbcl=([0-9]+) (" + l.join("|") + ")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi"),
            u = new RegExp("\\[(" + l.join("|") + ")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi"),
            h = new RegExp("\\[(" + T.join("|") + ")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi"),
            function() {
                for (var e = [], t = 0; t < l.length; t++)
                    "\\*" !== l[t] && e.push("/" + l[t]);
                d = new RegExp("(\\[)((?:" + l.join("|") + ")(?:[ =][^\\]]*?)?)(\\])","gi"),
                p = new RegExp("(\\[)(" + e.join("|") + ")(\\])","gi")
            }()
        }
        function t(e, i, n, o, s, a, u) {
            u = u || [],
            n++;
            var h, d, p, m, f = new RegExp("(<bbcl=" + n + " )(" + l.join("|") + ")([ =>])","gi"), g = new RegExp("(<bbcl=" + n + " )(" + l.join("|") + ")([ =>])","i"), _ = a.match(f) || [], v = r[e] || {};
            for (f.lastIndex = 0,
            _ || (a = ""),
            p = 0; p < _.length; p++)
                g.lastIndex = 0,
                m = _[p].match(g)[2].toLowerCase(),
                v && v.restrictChildrenTo && v.restrictChildrenTo.length > 0 && (v.validChildLookup[m] || (d = 'The tag "' + m + '" is not allowed as a child of the tag "' + e + '".',
                u.push(d))),
                h = r[m] || {},
                h.restrictParentsTo.length > 0 && (h.validParentLookup[e] || (d = 'The tag "' + e + '" is not allowed as a parent of the tag "' + m + '".',
                u.push(d)));
            return a = a.replace(c, function(e, i, n, o, s) {
                return u = t(n, e, i, n, o, s, u),
                e
            }),
            u
        }
        function i(e) {
            return e = e.replace(/\<([^\>][^\>]*?)\>/gi, function(e, t) {
                var i = t.match(/^bbcl=([0-9]+) /);
                return null === i ? "<bbcl=0 " + t + ">" : "<" + t.replace(/^(bbcl=)([0-9]+)/, function(e, t, i) {
                    return t + (parseInt(i, 10) + 1)
                }) + ">"
            })
        }
        function n(e) {
            return e.replace(/<bbcl=[0-9]+ \/\*>/gi, "").replace(/<bbcl=[0-9]+ /gi, "&#91;").replace(/>/gi, "&#93;")
        }
        function o(e) {
            var t = e.text;
            return t = t.replace(c, S)
        }
        function s(e) {
            for (e = e.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/gi, "<"),
            e = e.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/gi, ">"); e !== (e = e.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi, function(e, t, i) {
                for (var n = e; n !== (n = n.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i, function(e, t, i) {
                    i = ">/list]" === i ? "</*]</list]" : "</*][*]";
                    var n = "<*]" + t + i;
                    return n
                })); )
                    ;
                return n = n.replace(/>/g, "<")
            })); )
                ;
            return e = e.replace(/</g, "[")
        }
        function a(e) {
            for (var t = function(e, t, n, o) {
                return e = e.replace(/\[/g, "<"),
                e = e.replace(/\]/g, ">"),
                i(e)
            }; e !== (e = e.replace(u, t)); )
                ;
            return e
        }
        var r, l, c, u, h, d, p, m = {}, f = /^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;@#%&()~_?\+=\/\\\.]*$/, g = /^(?:ftps?|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;@#%&()~_?\+=\/\\\.]*$/, _ = /^(?:red|green|blue|orange|yellow|pink|black|white|beige|brown|grey|gray|silver|purple|maroon|lime|limegreen|olive|navy|teal|aqua)$/, v = /^#?[a-fA-F0-9]{6}$/, y = /[^\s@]+@[^\s@]+\.[^\s@]+/, w = /([1-9][\d]?p[xt]|(?:x-)?small(?:er)?|(?:x-)?large[r]?)/, b = /[#]?([A-Za-z][A-Za-z0-9_-]*)/, C = /(?:board=\d+;)?((?:topic|threadid)=[\dmsg#\.\/]{1,40}(?:;start=[\dmsg#\.\/]{1,40})?|action=profile;u=\d+)/, I = /^\/threads\/[a-z0-9\-]*\/posts[a-z0-9?\=\-#\&]*/i, T = [];
        r = {
            anchor: {
                openTag: function(e, t) {
                    var i = e || "";
                    return i = i.substr(1) || "",
                    b.test(i) || (i = ""),
                    '<span id="post_' + i + '">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            abbr: {
                openTag: function(e, t) {
                    var i = e || "";
                    return i = i.substr(1) || "",
                    i = i.replace(/<.*?>/g, ""),
                    '<abbr title="' + i + '">'
                },
                closeTag: function(e, t) {
                    return "</abbr>"
                }
            },
            acronym: {
                openTag: function(e, t) {
                    var i = e || "";
                    return i = i.substr(1) || "",
                    itle = i.replace(/<.*?>/g, ""),
                    '<acronym title="' + i + '">'
                },
                closeTag: function(e, t) {
                    return "</acronym>"
                }
            },
            b: {
                openTag: function(e, t) {
                    return "<b>"
                },
                closeTag: function(e, t) {
                    return "</b>"
                }
            },
            bbcode: {
                openTag: function(e, t) {
                    return ""
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            black: {
                openTag: function(e, t) {
                    return '<span class="bbcode-color-black" style="color: black;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            blue: {
                openTag: function(e, t) {
                    return '<span class="bbcode-color-blue" style="color: blue;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            br: {
                openTag: function(e, t) {
                    return "<br />"
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            btc: {
                openTag: function(e, t) {
                    return '<span class="BTC">BTC</span>'
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            center: {
                openTag: function(e, t) {
                    return '<div align="center">'
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            code: {
                openTag: function(e, t) {
                    return "<code>"
                },
                closeTag: function(e, t) {
                    return "</code>"
                },
                noParse: !0
            },
            color: {
                openTag: function(e, t) {
                    var i = ""
                      , n = e || "=black";
                    return n = e.substr(1) || "black",
                    n = n.toLowerCase(),
                    n = n.trim(),
                    _.lastIndex = 0,
                    v.lastIndex = 0,
                    _.test(n) ? i = n : v.test(n) ? "#" !== n.substr(0, 1) ? (i = "_" + n,
                    n = "#" + n) : i = "_" + n.substr(1) : (n = "black",
                    i = "black"),
                    '<span class="bbcode-color-' + i + '" style="color:' + n + '">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            email: {
                openTag: function(e, t) {
                    var i;
                    return i = e ? e.substr(1) : t.replace(/<.*?>/g, ""),
                    i = i.trim(),
                    y.lastIndex = 0,
                    y.test(i) ? '<a href="mailto:' + i + '" target="_blank">' : "<a>"
                },
                closeTag: function(e, t) {
                    return "</a>"
                }
            },
            ftp: {
                openTag: function(e, t) {
                    var i = "";
                    return i = e ? e.substr(1) : t.replace(/<.*?>/g, ""),
                    i = i.trim(),
                    g.lastIndex = 0,
                    g.test(i) ? '<a href="' + i + '" target="_blank">' : '<a target="_blank">'
                },
                closeTag: function(e, t) {
                    return "</a>"
                }
            },
            glow: {
                openTag: function(e, t) {
                    var i = e || "";
                    i = e.substr(1) || "",
                    i = i.replace(/<.*?>/g, "");
                    var n = ""
                      , o = i.split(",")[0];
                    return o = o.trim(),
                    o = o.toLowerCase(),
                    _.lastIndex = 0,
                    v.lastIndex = 0,
                    _.test(o) ? n = o : v.test(o) ? "#" !== o.substr(0, 1) ? (n = "_" + o,
                    o = "#" + o) : n = "_" + o.substr(1) : (o = "inherit",
                    n = "inherit"),
                    '<span class="bbcode-bgcolor-' + n + '" style="background-color: ' + o + '">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            green: {
                openTag: function(e, t) {
                    return '<span class="bbcode-color-green" style="color: green;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            hr: {
                openTag: function(e, t) {
                    return "<hr />"
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            html: {
                openTag: function(e, t) {
                    return ""
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            i: {
                openTag: function(e, t) {
                    return "<i>"
                },
                closeTag: function(e, t) {
                    return "</i>"
                }
            },
            img: {
                openTag: function(e, t) {
                    var i = t;
                    if (i = i.trim(),
                    f.lastIndex = 0,
                    f.test(i) || (i = ""),
                    !e)
                        return '<img src="' + i + '" />';
                    var n = e;
                    n = n.trim(),
                    n = n.replace(/<.*?>/g, "");
                    var o, s, a;
                    if ((n.match(/alt=/gi) || []).length > 1)
                        return '<img src="' + i + '" />';
                    if ((n.match(/width=/gi) || []).length > 1)
                        return '<img src="' + i + '" />';
                    if ((n.match(/height=/gi) || []).length > 1)
                        return '<img src="' + i + '" />';
                    var r = /^(alt=.+?|width=[0-9]+?|height=[0-9]+?)?\s*(alt=.+?|width=[0-9]+?|height=[0-9]+?)?\s*(alt=.+?|width=[0-9]+?|height=[0-9]+?)$/i.exec(n);
                    if (r)
                        for (var l = 1; l < r.length; l++) {
                            var c = r[l] || "";
                            c = c.trim(),
                            /alt=/i.test(c) ? o = c.substr(4) : /width=/i.test(c) ? s = c.substr(6) : /height=/i.test(c) && (a = c.substr(7))
                        }
                    var u = '<img src="' + i + '" ';
                    return o && (u += 'alt="' + o + '" '),
                    s && (u += 'width="' + s + '" '),
                    a && (u += 'height="' + a + '" '),
                    u += "/>"
                },
                closeTag: function(e, t) {
                    return ""
                },
                displayContent: !1
            },
            iurl: {
                openTag: function(e, t) {
                    var i;
                    return i = e ? e.substr(1) : t.replace(/<.*?>/g, ""),
                    i = i.trim(),
                    f.lastIndex = 0,
                    f.test(i) || (i = "#"),
                    '<a href="' + i + '" />'
                },
                closeTag: function(e, t) {
                    return ""
                }
            },
            left: {
                openTag: function(e, t) {
                    return '<div class="bbcode-text-left" style="text-align: left;">'
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            li: {
                openTag: function(e, t) {
                    return "<li>"
                },
                closeTag: function(e, t) {
                    return "</li>"
                },
                restrictParentsTo: ["list", "ul", "ol"]
            },
            list: {
                openTag: function(e, t) {
                    var i = "<ul>"
                      , n = e || "";
                    return n = n.trim(),
                    n = n.replace(/<.*?>/g, ""),
                    0 === n.indexOf("type=") && (n = n.replace("type=", ""),
                    n = n.trim(),
                    /(none|disc|circle|square|decimal|decimal-leading-zero|lower-roman|upper-roman|lower-alpha|upper-alpha|lower-greek|lower-latin|upper-latin|hebrew|armenian|georgian|cjk-ideographic|hiragana|katakana|hiragana-iroha|katakana-iroha)/i.test(n) && (i = '<ul class="bbcode-list-' + n + '" style="list-style-type: ' + n + '">')),
                    i
                },
                closeTag: function(e, t) {
                    return "</ul>"
                },
                restrictChildrenTo: ["*", "li"]
            },
            ltr: {
                openTag: function(e, t) {
                    return '<div dir="ltr">'
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            me: {
                openTag: function(e, t) {
                    var i = e || "";
                    return i = e.substr(1),
                    i = i.replace(/<.*?>/g, ""),
                    i = i.trim(),
                    t && (i += " "),
                    '<div class="bbcode-color-red" style="color: red;">* ' + i + " "
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            move: {
                openTag: function(e, t) {
                    return "<div>"
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            noparse: {
                openTag: function(e, t) {
                    return ""
                },
                closeTag: function(e, t) {
                    return ""
                },
                noParse: !0
            },
            nobbc: {
                openTag: function(e, t) {
                    return ""
                },
                closeTag: function(e, t) {
                    return ""
                },
                noParse: !0
            },
            ol: {
                openTag: function(e, t) {
                    return "<ol>"
                },
                closeTag: function(e, t) {
                    return "</ol>"
                },
                restrictChildrenTo: ["*", "li"]
            },
            pre: {
                openTag: function(e, t) {
                    return "<pre>"
                },
                closeTag: function(e, t) {
                    return "</pre>"
                }
            },
            php: {
                openTag: function(e, t) {
                    return "<pre>"
                },
                closeTag: function(e, t) {
                    return "</pre>"
                },
                noParse: !0
            },
            quote: {
                openTag: function(e, t) {
                    var i = '<div class="quoteHeader">Quote</div>'
                      , n = '<div class="quote">'
                      , o = e || "";
                    if (o = o.trim(),
                    o = o.replace(/<.*?>/g, ""),
                    "" === o)
                        return i + n;
                    if (0 === o.indexOf("=")) {
                        var s = o.substr(1);
                        return i = '<div class="quoteHeader">',
                        i += "Quote From: " + s,
                        i += "</div>",
                        i + n
                    }
                    if (/author="/i.test(o)) {
                        var a = o.toLowerCase()
                          , r = o.substr(a.indexOf('author="') + 7);
                        return r = r.replace(/"/g, ""),
                        i = '<div class="quoteHeader">',
                        i += "Quote From: " + r,
                        i += "</div>",
                        i + n
                    }
                    var l, c, u, h = o.match(/author=/gi) || [];
                    if (h.length > 1 || 0 === h.length)
                        return i + n;
                    if ((o.match(/link=/gi) || []).length > 1)
                        return i + n;
                    if ((o.match(/date=/gi) || []).length > 1)
                        return i + n;
                    var d = /^(author=.+?|link=.+?|date=[0-9]+?)?\s*(author=.+?|link=.+?|date=[0-9]+?)?\s*(author=.+?|link=.+?|date=[0-9]+?)$/i.exec(o);
                    if (d)
                        for (var p = 1; p < d.length; p++) {
                            var m = d[p] || "";
                            m = m.trim(),
                            /author=/i.test(m) ? l = m.substr(7) : /link=/i.test(m) ? (c = m.substr(5),
                            C.test(c) || I.test(c) || (c = void 0)) : /date=/i.test(m) && (u = Number(m.substr(5)))
                        }
                    return l && (i = '<div class="quoteHeader">',
                    i += "Quote From: " + l,
                    i += "</div>"),
                    l && c && u && (i = '<div class="quoteHeader">',
                    i += '<a href="' + c + '">',
                    i += "Quote from: " + l + " on ept-date=" + u,
                    i += "</a>",
                    i += "</div>"),
                    i + n
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            right: {
                openTag: function(e, t) {
                    return '<div class="bbcode-text-right" style="text-align: right;">'
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            red: {
                openTag: function(e, t) {
                    return '<span class="bbcode-color-red" style="color: red;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            rtl: {
                openTag: function(e, t) {
                    return '<div dir="rtl">'
                },
                closeTag: function(e, t) {
                    return "</div>"
                }
            },
            s: {
                openTag: function(e, t) {
                    return "<del>"
                },
                closeTag: function(e, t) {
                    return "</del>"
                }
            },
            shadow: {
                openTag: function(e, t) {
                    var i = ""
                      , n = ""
                      , o = ""
                      , s = ""
                      , a = /^(?:left|right|top|bottom)$/
                      , r = /^[0-9]\d{0,2}$/
                      , l = e || "";
                    if (l = e.substr(1) || "",
                    l = l.replace(/<.*?>/g, ""),
                    l.indexOf(",") < 0)
                        return "<span>";
                    if (n = l.split(",")[0],
                    n = n.trim(),
                    n = n.toLowerCase(),
                    _.lastIndex = 0,
                    v.lastIndex = 0,
                    _.test(n) || (v.test(n) ? "#" !== n.substr(0, 1) && (n = "#" + n) : n = "black"),
                    o = l.split(",")[1] || "",
                    o = o.trim())
                        if (a.test(o))
                            o = "left" === o ? " -2px 2px" : "right" === o ? " 2px 2px" : "top" === o ? " 0 -2px" : "bottom" === o ? " 0 2px" : " 0 0";
                        else if (r.test(o)) {
                            var c = o
                              , u = .0174532925 * c;
                            o = " " + Math.round(4 * Math.cos(u)) + "px",
                            o += " " + Math.round(-4 * Math.sin(u)) + "px"
                        } else
                            o = " 0 0";
                    else
                        o = " 0 0";
                    s = l.split(",")[2] || "",
                    s = s.trim(),
                    s = s && r.test(s) ? " " + s + "px" : " 0",
                    i = n + o + s;
                    var h = i.replace(/\s/gi, "_");
                    return h = h.replace(/#/gi, "_"),
                    '<span class="bbcode-shadow-' + h + '" style="text-shadow: ' + i + '">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            size: {
                openTag: function(e, t) {
                    var i = e || "";
                    return i = i.substr(1) || "inherit",
                    i = i.trim(),
                    w.lastIndex = 0,
                    w.test(i) || (i = "inherit"),
                    '<span class="bbcode-size-' + i + '" style="font-size: ' + i + ' !important; line-height: 1.3em;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            sub: {
                openTag: function(e, t) {
                    return "<sub>"
                },
                closeTag: function(e, t) {
                    return "</sub>"
                }
            },
            sup: {
                openTag: function(e, t) {
                    return "<sup>"
                },
                closeTag: function(e, t) {
                    return "</sup>"
                }
            },
            tt: {
                openTag: function(e, t) {
                    return "<tt>"
                },
                closeTag: function(e, t) {
                    return "</tt>"
                }
            },
            time: {
                openTag: function(e, t) {
                    var i = t || "";
                    return Number(i) ? i = "ept-date=" + i : (i = new Date(i).getTime(),
                    i = "ept-date=" + i),
                    i
                },
                closeTag: function(e, t) {
                    return ""
                },
                displayContent: !1
            },
            table: {
                openTag: function(e, t) {
                    return "<table>"
                },
                closeTag: function(e, t) {
                    return "</table>"
                },
                restrictChildrenTo: ["tbody", "thead", "tfoot", "tr"]
            },
            tbody: {
                openTag: function(e, t) {
                    return "<tbody>"
                },
                closeTag: function(e, t) {
                    return "</tbody>"
                },
                restrictChildrenTo: ["tr"],
                restrictParentsTo: ["table"]
            },
            tfoot: {
                openTag: function(e, t) {
                    return "<tfoot>"
                },
                closeTag: function(e, t) {
                    return "</tfoot>"
                },
                restrictChildrenTo: ["tr"],
                restrictParentsTo: ["table"]
            },
            thead: {
                openTag: function(e, t) {
                    return "<thead>"
                },
                closeTag: function(e, t) {
                    return "</thead>"
                },
                restrictChildrenTo: ["tr"],
                restrictParentsTo: ["table"]
            },
            td: {
                openTag: function(e, t) {
                    return '<td valign="top">'
                },
                closeTag: function(e, t) {
                    return "</td>"
                },
                restrictParentsTo: ["tr"]
            },
            th: {
                openTag: function(e, t) {
                    return "<th>"
                },
                closeTag: function(e, t) {
                    return "</th>"
                },
                restrictParentsTo: ["tr"]
            },
            tr: {
                openTag: function(e, t) {
                    return "<tr>"
                },
                closeTag: function(e, t) {
                    return "</tr>"
                },
                restrictChildrenTo: ["td", "th"],
                restrictParentsTo: ["table", "tbody", "tfoot", "thead"]
            },
            u: {
                openTag: function(e, t) {
                    return "<u>"
                },
                closeTag: function(e, t) {
                    return "</u>"
                }
            },
            ul: {
                openTag: function(e, t) {
                    return "<ul>"
                },
                closeTag: function(e, t) {
                    return "</ul>"
                },
                restrictChildrenTo: ["*", "li"]
            },
            url: {
                openTag: function(e, t) {
                    var i;
                    return i = e ? e.substr(1) : t.replace(/<.*?>/g, ""),
                    i = i.trim(),
                    f.lastIndex = 0,
                    f.test(i) || (i = "#"),
                    '<a href="' + i + '" target="_blank">'
                },
                closeTag: function(e, t) {
                    return "</a>"
                }
            },
            white: {
                openTag: function(e, t) {
                    return '<span class="bbcode-color-white" style="color: white;">'
                },
                closeTag: function(e, t) {
                    return "</span>"
                }
            },
            "*": {
                openTag: function(e, t) {
                    return "<li>"
                },
                closeTag: function(e, t) {
                    return "</li>"
                },
                restrictParentsTo: ["list", "ul", "ol"]
            }
        },
        e();
        var S = function(e, t, i, o, s) {
            i = i.toLowerCase();
            var a = r[i].noParse ? n(s) : s.replace(c, S)
              , l = r[i].openTag(o, a)
              , u = r[i].closeTag(o, a);
            return r[i].displayContent === !1 && (a = ""),
            l + a + u
        };
        return m.tags = function() {
            return r
        }
        ,
        m.addTags = function(t) {
            var i;
            for (i in t)
                r[i] = t[i];
            e()
        }
        ,
        m.process = function(e) {
            var i = {
                html: "",
                error: !1
            }
              , n = [];
            for (e.text = e.text.replace(/</g, "&lt;"),
            e.text = e.text.replace(/>/g, "&gt;"),
            e.text = e.text.replace(d, function(e, t, i, n) {
                return "<" + i + ">"
            }),
            e.text = e.text.replace(p, function(e, t, i, n) {
                return "<" + i + ">"
            }),
            e.text = e.text.replace(/\[/g, "&#91;"),
            e.text = e.text.replace(/\]/g, "&#93;"),
            e.text = e.text.replace(/</g, "["),
            e.text = e.text.replace(/>/g, "]"); e.text !== (e.text = e.text.replace(h, function(e, t, i, n) {
                return n = n.replace(/\[/g, "&#91;"),
                n = n.replace(/\]/g, "&#93;"),
                i = i || "",
                n = n || "",
                "[" + t + i + "]" + n + "[/" + t + "]"
            })); )
                ;
            return e.text = s(e.text),
            e.text = a(e.text),
            n = t("bbcode", e.text, -1, "", "", e.text),
            i.html = o(e),
            i.html.indexOf("[") === -1 && i.html.indexOf("]") === -1 || n.push("Some tags appear to be misaligned."),
            e.removeMisalignedTags && (i.html = i.html.replace(/\[.*?\]/g, "")),
            e.addInLineBreaks && (i.html = '<div style="white-space:pre;">' + i.html + "</div>"),
            i.html = i.html.replace("&#91;", "["),
            i.html = i.html.replace("&#93;", "]"),
            i.html = i.html.replace(/&lt;/g, "<"),
            i.html = i.html.replace(/&gt;/g, ">"),
            i.error = 0 !== n.length,
            i.errorQueue = n,
            i
        }
        ,
        m
    }();
    e.exports = i
}
, function(e, t) {
    e.exports = {
        fr: {
            facebookPageId: "DOFUSTouch",
            facebookPageNumericId: "1663041913975144",
            twitterAccountId: "DofusTouch"
        },
        en: {
            facebookPageId: "DOFUSTouch",
            facebookPageNumericId: "1663041913975144",
            twitterAccountId: "DOFUSTouch_EN"
        },
        fallbackLanguage: "en"
    }
}
, function(e, t, i) {
    function n() {
        s.call(this, "div", {
            className: "splashScreen",
            hidden: !0
        }),
        this.once("show", n.prototype._createContent);
        var e = this;
        window.gui.on("connected", function() {
            e.hide()
        })
    }
    i(1001);
    var o = i(26).inherits
      , s = i(190);
    o(n, s),
    e.exports = n,
    n.prototype._createContent = function() {
        this.log = this.createChild("div", {
            className: "logBox"
        }),
        this.createChild("div", {
            className: "dofusLogo"
        }),
        this.createChild("div", {
            className: ["spinner", "splashSpinner"]
        })
    }
    ,
    n.prototype.showMessage = function(e) {
        this.log.setText(e)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        function e() {
            var e = m.getValue();
            b.disable(),
            w.disable(),
            v.setText(l("ui.common.waiting")),
            v.delClassNames("error"),
            window.dofus.sendMessage("NicknameChoiceRequestMessage", {
                nickname: e
            })
        }
        function t() {
            m.getValue().length < 3 || !f.isActivate() ? b.disable() : b.enable()
        }
        function i() {
            d.openUrlInAppBrowser(this.link)
        }
        s.call(this, {
            className: "NicknameWindow",
            title: "",
            positionInfo: {
                left: "c",
                top: "c",
                width: 500,
                height: 355
            },
            noCloseButton: !0
        });
        var n = this
          , o = this.windowBody
          , u = o.createChild("div", {
            className: "description"
        })
          , m = o.appendChild(new r({
            className: "nickname",
            attr: {
                maxlength: 29
            }
        }))
          , f = o.appendChild(new h)
          , g = o.appendChild(new c({
            className: "link"
        }))
          , _ = o.appendChild(new c({
            className: "link"
        }))
          , v = o.createChild("div", {
            className: "info"
        })
          , y = o.createChild("div", {
            className: "buttonContainer"
        })
          , w = y.appendChild(new c.DofusButton)
          , b = y.appendChild(new c.DofusButton);
        g.on("tap", i),
        _.on("tap", i),
        this.once("open", function() {
            m.on("change", t),
            f.on("change", t),
            m.on("validate", function() {
                b.tap()
            }),
            b.on("tap", e),
            w.on("tap", function() {
                window.dofus.disconnect(),
                a.close(n.id)
            }),
            window.gui.on("NicknameRefusedMessage", function(e) {
                v.setText(l(p[e.reason])),
                v.addClassNames("error"),
                b.enable(),
                w.enable()
            }),
            window.gui.on("NicknameAcceptedMessage", function() {
                n.close()
            })
        }),
        this.on("open", function() {
            n.setTitle(l("ui.pseudoChoice.title")),
            u.setText(l("ui.pseudoChoice.help")),
            b.disable(),
            w.enable(),
            w.setText(l("ui.common.cancel")),
            b.setText(l("ui.common.validation")),
            f.setText(l("tablet.legals.accept")),
            g.setText(l("tablet.legals.tou")),
            g.link = l("tablet.legals.link.tou"),
            _.setText(l("tablet.legals.gcs")),
            _.link = l("tablet.legals.link.gcs"),
            m.focus()
        }),
        this.on("close", function() {
            v.setText(""),
            v.delClassNames("error"),
            m.setValue(""),
            m.blur()
        })
    }
    i(1003);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(391)
      , l = i(35).getText
      , c = i(204)
      , u = i(1004)
      , h = i(448)
      , d = i(210)
      , p = {};
    p[u.ALREADY_USED] = "ui.nickname.alreadyUsed",
    p[u.SAME_AS_LOGIN] = "ui.nickname.equalsLogin",
    p[u.TOO_SIMILAR_TO_LOGIN] = "ui.nickname.similarToLogin",
    p[u.INVALID_NICK] = "ui.nickname.invalid",
    p[u.UNKNOWN_NICK_ERROR] = "ui.nickname.unknown",
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t) {
    e.exports = {
        ALREADY_USED: 1,
        SAME_AS_LOGIN: 2,
        TOO_SIMILAR_TO_LOGIN: 3,
        INVALID_NICK: 4,
        UNKNOWN_NICK_ERROR: 99
    }
}
, function(e, t, i) {
    function n() {
        function e(e, t) {
            p.series([function(e) {
                return y ? e() : void u.createGuest(function(t, i) {
                    return t ? e(t) : (y = {
                        login: i.login,
                        password: i._headers.password
                    },
                    d.setValue("guestAccount", y, 1),
                    void e())
                })
            }
            , function(t) {
                e.guestLogin = y.login,
                e.guestPassword = y.password,
                u.validateGuest(e, t)
            }
            ], function(i) {
                t(i, {
                    login: e.login,
                    password: e.password
                })
            })
        }
        function t() {
            E.getValue().length && M.getValue().length && R.getValue().length && M.getValue() === R.getValue() && /.+@.+\..+/.test(P.getValue()) && L.getValue().length && k.isActivate() ? z.enable() : z.disable()
        }
        function i() {
            var e = !M.getValue().length
              , t = !R.getValue().length
              , i = M.getValue() === R.getValue();
            e || t || i ? (G.delClassNames("error"),
            G.setText("")) : (G.addClassNames("error"),
            G.setText(r("tablet.register.confirmpwdNotSame")))
        }
        function n() {
            g.openUrlInAppBrowser(this.link)
        }
        function o(e) {
            if (e) {
                for (var t = U.getChildren(), i = 0; i < _; i++)
                    t[i + 1].setText((i > 0 ? ", " : "") + e[i]);
                U.addClassNames("visible")
            }
        }
        var v = f.screenHeight > 655;
        s.call(this, {
            className: "RegisterWindow",
            title: "",
            positionInfo: {
                left: "c",
                top: "c",
                width: 450,
                height: v ? 640 : 550,
                isFullScreen: !0
            },
            noCloseButton: !0
        }),
        v && this.addClassNames("large");
        var y, w, b = this, C = this.windowBody, I = function() {}, T = I, S = C.createChild("div", {
            className: "formWrapper"
        }), A = S.createChild("label", {
            className: "label"
        }), E = S.appendChild(new a({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "text",
                maxlength: 19
            }
        }));
        E.on("validate", function() {
            M.focus()
        });
        var x = S.createChild("label", {
            className: "label"
        })
          , M = S.appendChild(new a({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "password",
                maxlength: 49
            }
        }))
          , N = S.createChild("label", {
            className: "label"
        })
          , R = S.appendChild(new a({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "password",
                maxlength: 49
            }
        }))
          , O = S.createChild("label", {
            className: "label"
        })
          , P = S.appendChild(new a({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "email"
            }
        }))
          , D = S.createChild("label", {
            className: "label"
        })
          , L = S.appendChild(new a({
            className: ["inputText", "whiteStyle"],
            attr: {
                type: "text",
                maxlength: 29
            }
        }))
          , B = S.createChild("div", {
            className: "touWrapper"
        })
          , k = B.appendChild(new h);
        B.createChild("span", {
            text: " ("
        });
        var F = B.appendChild(new l({
            className: "link"
        }));
        B.createChild("span", {
            text: ", "
        });
        var H = B.appendChild(new l({
            className: "link"
        }));
        B.createChild("span", {
            text: ")"
        });
        for (var G = C.createChild("div", {
            className: "info"
        }), U = C.createChild("div", {
            className: "suggestion"
        }), j = U.createChild("label", {
            className: "label"
        }), q = 0; q < _; q++)
            U.createChild("span", {
                className: "set"
            });
        var W = C.createChild("div", {
            className: "buttonContainer"
        })
          , V = W.appendChild(new c);
        V.addClassNames("cancel");
        var z = W.appendChild(new c);
        E.on("change", t),
        M.on("change", t),
        R.on("change", t),
        P.on("change", t),
        L.on("change", t),
        k.on("change", t),
        R.on("change", function() {
            window.clearTimeout(w),
            w = window.setTimeout(i, 1e3)
        }),
        E.on("validate", function() {
            M.focus()
        }),
        M.on("validate", function() {
            R.focus()
        }),
        R.on("validate", function() {
            P.focus()
        }),
        P.on("validate", function() {
            L.focus()
        }),
        L.on("validate", function() {
            z.tap()
        }),
        F.on("tap", n),
        H.on("tap", n),
        z.on("tap", function() {
            V.disable(),
            z.disable(),
            G.setText(r("ui.common.waiting")),
            U.delClassNames("visible"),
            G.delClassNames("error");
            var t = {
                login: E.getValue(),
                password: M.getValue(),
                email: P.getValue(),
                nickname: L.getValue()
            };
            y && (t.guestLogin = y.login,
            t.guestPassword = y.password),
            e(t, function(e, t) {
                return V.enable(),
                z.enable(),
                e ? e._statusCode >= 600 ? (G.addClassNames("error"),
                G.setText(e.text),
                void o(e.suggests)) : (window.gui.openSimplePopup(r("ui.secureMode.error.default")),
                console.error("RegisterWindow haapiCall", e)) : b.close(t)
            })
        }),
        V.on("tap", function() {
            b.close()
        }),
        this.on("open", function(e) {
            T = e.onValidate,
            y = e.guestAccount,
            z.disable(),
            V.enable(),
            A.setText(r("tablet.login.username")),
            x.setText(r("ui.login.password")),
            O.setText(r("tablet.register.email")),
            N.setText(r("tablet.register.confirmpwd")),
            D.setText(r("tablet.login.pseudo")),
            k.setText(r("tablet.legals.accept")),
            F.setText(r("tablet.legals.tou")),
            F.link = r("tablet.legals.link.tou"),
            H.setText(r("tablet.legals.gcs")),
            H.link = r("tablet.legals.link.gcs"),
            V.setText(r("ui.common.cancel")),
            z.setText(r("ui.common.validation")),
            j.setText(r("tablet.register.suggestion")),
            m.setAutomaticHide(!1),
            y ? b.setTitle(r("tablet.oldGuest.register")) : b.setTitle(r("ui.login.createAccount"))
        }),
        this.on("opened", function() {
            E.focus()
        }),
        this.on("close", function(e) {
            E.setValue(""),
            M.setValue(""),
            P.setValue(""),
            R.setValue(""),
            L.setValue(""),
            L.enable(),
            G.setText(""),
            G.delClassNames("error"),
            U.delClassNames("visible"),
            m.setAutomaticHide(!0),
            y = null ,
            window.clearTimeout(w),
            T(e),
            T = I
        })
    }
    i(1006);
    var o = i(26).inherits
      , s = i(402)
      , a = i(391)
      , r = i(35).getText
      , l = i(204)
      , c = l.DofusButton
      , u = i(51)
      , h = i(448)
      , d = i(30)
      , p = i(12)
      , m = i(301)
      , f = i(24).dimensions
      , g = i(210)
      , _ = 3;
    o(n, s),
    e.exports = n
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        c.call(this, {
            className: "connectionQueueWindow",
            positionInfo: {
                left: "c",
                top: "c",
                width: 600,
                height: 200
            },
            noCloseButton: !0
        }),
        this.once("open", this._createContent),
        this._setupEventListeners()
    }
    function o() {
        var e = window.gui.serversData;
        return e ? e.connectedServerData : null
    }
    i(1008);
    var s = i(204).DofusButton
      , a = i(35).getText
      , r = i(26).inherits
      , l = i(50)
      , c = i(402)
      , u = i(22);
    r(n, c),
    e.exports = n,
    n.prototype._setupEventListeners = function() {
        var e = this;
        window.dofus.connectionManager.on("LoginQueueStatusMessage", function(t) {
            e._queueStatusUpdate("login", t.position, t.total)
        }),
        window.dofus.connectionManager.on("QueueStatusMessage", function(t) {
            e._queueStatusUpdate("game", t.position, t.total)
        })
    }
    ,
    n.prototype._createContent = function() {
        this.windowTitle.setText(a("ui.queue.wait"));
        var e = this.windowBody.createChild("div", {
            className: "messageBox"
        });
        this.message = e.createChild("div", {
            className: "message"
        });
        var t = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , i = t.appendChild(new s(a("ui.queue.back")))
          , n = this;
        i.on("tap", function() {
            return o() ? (l.goBackToSelectionOf("server"),
            void u.close(n.id)) : window.dofus.disconnect()
        })
    }
    ,
    n.prototype._queueStatusUpdate = function(e, t, i) {
        if (0 === t)
            return u.close(this.id);
        u.open(this.id);
        var n = a("ui.queue.number", t, i)
          , s = o();
        s && (n += "\n\n" + a("ui.queue.server", s._name)),
        this.message.setText(n)
    }
}
, function(e, t) {}
, function(e, t, i) {
    function n() {
        s.call(this, {
            className: "popupWindow",
            title: "Popup",
            customClose: !0,
            positionInfo: {
                left: "c",
                bottom: "c",
                width: 600,
                height: 210
            }
        }),
        this.messageStack = []
    }
    i(1010);
    var o = i(26).inherits
      , s = i(402)
      , a = i(22)
      , r = i(204).DofusButton
      , l = i(35).getText
      , c = i(210);
    o(n, s),
    e.exports = n,
    n.prototype._createContent = function() {
        function e() {
            return t.messageStack.shift(),
            0 === t.messageStack.length ? void a.close(t.id) : void t._update()
        }
        var t = this
          , i = this.windowBody.createChild("div", {
            className: "messageBox"
        });
        this.message = i.createChild("div", {
            className: "message"
        });
        var n = this.windowBody.createChild("div", {
            className: "buttonContainer"
        })
          , o = n.appendChild(new r(l("ui.common.ok")));
        o.on("tap", e),
        this.closeButton.on("tap", e)
    }
    ,
    n.prototype._update = function() {
        this.message || this._createContent();
        var e = this.messageStack[0]
          , t = e.message.split("<br>").length <= 2 ? "center" : "left";
        this.message.setStyle("text-align", t),
        this.message.setHtml(e.message),
        c.allLinksOnTargetBlank(this.message),
        this.windowTitle.setText(e.title)
    }
    ,
    n.prototype.addContent = function(e) {
        var t = this.messageStack;
        t.length && t[t.length - 1].message === e.message || (t.push(e),
        1 === t.length && this._update())
    }
}
, function(e, t) {}
, function(e, t) {
    var i = 0
      , n = !1
      , o = function(e) {
        for (var t = e.target; t !== document.body; ) {
            var n = window.getComputedStyle(t)
              , o = n.getPropertyValue("-webkit-overflow-scrolling")
              , s = n.getPropertyValue("overflow-y")
              , a = parseInt(n.getPropertyValue("height"), 10)
              , r = "touch" === o && ("auto" === s || "scroll" === s)
              , l = t.scrollHeight > t.offsetHeight;
            if (r && l) {
                var c = e.touches ? e.touches[0].screenY : e.screenY
                  , u = i <= c && 0 === t.scrollTop
                  , h = i >= c && t.scrollHeight - t.scrollTop === a;
                return void ((u || h) && e.preventDefault())
            }
            t = t.parentNode
        }
        e.preventDefault()
    }
      , s = function(e) {
        i = e.touches ? e.touches[0].screenY : e.screenY
    }
      , a = function() {
        window.addEventListener("touchstart", s, !1),
        window.addEventListener("touchmove", o, !1),
        n = !0
    }
      , r = function() {
        window.removeEventListener("touchstart", s, !1),
        window.removeEventListener("touchmove", o, !1),
        n = !1
    }
      , l = function() {
        return n
    }
      , c = document.createElement("div");
    document.documentElement.appendChild(c),
    c.style.WebkitOverflowScrolling = "touch";
    var u = "touch" === window.getComputedStyle(c)["-webkit-overflow-scrolling"];
    document.documentElement.removeChild(c),
    u && a();
    var h = {
        enable: a,
        disable: r,
        isEnabled: l
    };
    e.exports = h
}
, function(e, t, i) {
    i(1013),
    i(1050),
    i(1053),
    i(1056),
    i(1058),
    i(1059),
    i(1060),
    i(1061),
    e.exports = i(1014)
}
, function(e, t, i) {
    var n = i(1014)
      , o = i(625)
      , s = o.compressPath
      , a = i(85)
      , r = i(22)
      , l = i(35).getText
      , c = i(49)
      , u = 3e3
      , h = 1e3;
    n.prototype.onArrived = function(e) {
        if (window.dofus.sendMessage("GameMapMovementConfirmMessage", null ),
        this.mapRenderer.removeMovementFeedback(),
        this.endMovementCallback) {
            var t = this.endMovementCallback;
            this.endMovementCallback = null ,
            t(null , e)
        }
    }
    ,
    n.prototype.cancelUserActorMovement = function(e) {
        if (this.isMovementWaitingForConfirmation)
            return this.lastMoveRequestTime && !r.isDialogActive() && Date.now() - this.lastMoveRequestTime > h && window.gui.connectionSplashScreen.onStateChange("UNSTABLE"),
            this.endMovementCallback = e,
            void (this.isMovementCanceled = !0);
        this.isMovementCanceled = !1;
        var t = this.actorManager.userActor;
        return t.moving ? (this.mapRenderer.removeMovementFeedback(),
        this.endMovementCallback = null ,
        void t.cancelMovement(e)) : (this.endMovementCallback = e,
        this.onArrived())
    }
    ,
    n.prototype.roleplayUserActorMovement = function(e) {
        var t = e[e.length - 1]
          , i = this.actorManager.userActor;
        if (this.isMovementWaitingForConfirmation = !1,
        window.gui.connectionSplashScreen.onStateChange("CONNECTED"),
        window.gui.emit("checkServerLag", "roleplayUserActorMovement", "stop"),
        this.isMovementCanceled)
            return this.cancelUserActorMovement(this.endMovementCallback);
        if (!i.moving) {
            for (var n = null , o = 0; o < e.length; o++)
                if (e[o] === i.cellId) {
                    n = o;
                    break
                }
            if (null === n)
                return i.cellId !== t && i.setDisposition(t),
                this.onArrived(t);
            if (i.cellId === t)
                return i.setDisposition(t),
                this.onArrived(t);
            var s = e.slice(n);
            i.setPath(s),
            i.setCellPosition(s[s.length - 1])
        }
        this.removeAllListeners("arrived"),
        this.once("arrived", this.onArrived);
        var a = [];
        if (!i.isPathMatchingServerPath(e, a)) {
            if (0 !== a.length) {
                this.endMovementCallback = null ;
                var r = this;
                return i.switchPath(a, function() {
                    r.emit("arrived", t)
                })
            }
            return i.noMovement(),
            i.setDisposition(t),
            this.endMovementCallback = null ,
            this.onArrived(t)
        }
    }
    ,
    n.prototype._movePlayerOnMap = function(e, t, i) {
        if (i && "function" == typeof i || (i = function() {}
        ),
        window.gui.playerData.inventory.isOverloaded() && !window.gui.playerData.isMutant())
            return void window.gui.chat.logMsg(l("tablet.inventoryFullCannotMove"));
        t = t || !1;
        var n = this.actorManager.userActor
          , a = n.cellId;
        if (a === e)
            return i(null , e),
            e;
        var r = this.mapRenderer.map
          , c = this.actorManager.occupiedCells
          , u = n.canMoveDiagonally
          , h = o.getPath(a, e, c, u, t);
        if (h.length <= 1)
            return i(new Error("_movePlayerOnMap noPath:" + a + ":" + e)),
            null ;
        this.isMovementWaitingForConfirmation = !0,
        this.lastMoveRequestTime = Date.now(),
        window.gui.emit("checkServerLag", "roleplayUserActorMovement", "start"),
        window.dofus.sendMessage("GameMapMovementRequestMessage", {
            keyMovements: s(h),
            mapId: r.id
        });
        var d = h[h.length - 1]
          , p = this;
        this.mapRenderer.addMovementFeedback(d),
        this.endMovementCallback = i,
        n.setPath(h, {
            cb: function() {
                p.emit("arrived", d)
            }
        });
        var m = this.mapScene.camera;
        return m.setAcceleration(1),
        n.pathTween.removeOnUpdate(),
        n.onMovementUpdate = function() {
            m.moveTo(n.x, n.y)
        }
        ,
        n.pathTween.onUpdate(n.onMovementUpdate),
        this.userPreviousPosition = n.cellId,
        n.setCellPosition(d),
        d
    }
    ,
    n.prototype.cancelCameraMovement = function() {
        var e = this.actorManager.userActor;
        e.pathTween.removeOnUpdate(e.onMovementUpdate)
    }
    ,
    n.prototype.noMovement = function() {
        this.gameContext !== a.FIGHT && (console.warn("[ISO ENGINE] previous movement request has been refused, canceling movement"),
        this.onQuickReconnection())
    }
    ,
    n.prototype.getChangeMapCellAt = function(e, t, i) {
        var n = this.mapScene.convertCanvasToSceneCoordinate(e, t);
        if (!this.mapRenderer.isReady)
            return -1;
        var o = this.mapRenderer.getCellId(n.x, n.y);
        return this.mapRenderer.getChangeMapFlags(o.cell)[i] ? o.cell : -1
    }
    ,
    n.prototype._requestMapChange = function(e, t) {
        window.foreground.lock("loadMap"),
        window.dofus.sendMessage("ChangeMapMessage", {
            mapId: e
        }),
        this.launchMapTransition(t);
        var i = this;
        this.changeMapTimeout = window.setTimeout(function() {
            c.unlockMessages(),
            i.changeMapTimeout = null ;
            var e = window.foreground;
            e.unlock("loadMap"),
            e.hideBorderArrow(),
            i.cancelMapTransition(t)
        }, u)
    }
    ,
    n.prototype.gotoNeighbourMap = function(e, t, i, n) {
        function o(i, n) {
            i || n !== t || s._requestMapChange(s.mapRenderer.map[e + "NeighbourId"], e)
        }
        var s = this;
        if (this.actorManager.userActor.moving)
            return this.cancelUserActorMovement(function() {
                s.gotoNeighbourMap(e, t, i, n)
            });
        var a = window.gui.tutorialManager;
        if (!a.inTutorial || a.isChangingMap) {
            var r = this._movePlayerOnMap(t, !1, o);
            r === t && window.foreground.showBorderArrow(e, i, n)
        }
    }
    ,
    n.prototype.clearPendingMovement = function() {
        this.isMovementWaitingForConfirmation = !1,
        this.endMovementCallback = null ,
        this.isMovementCanceled = !1
    }
}
, function(e, t, i) {
    function n() {
        s.call(this);
        var e = document.createElement("canvas");
        e.id = "engineCanvas";
        var t = document.getElementById("dofusBody");
        t.appendChild(e),
        this.mapScene = new l({
            canvas: e,
            name: "mapScene",
            l: -a.HORIZONTAL_OFFSET,
            t: -a.VERTICAL_OFFSET,
            w: a.MAP_SCENE_WIDTH,
            h: a.MAP_SCENE_HEIGHT,
            canvasWidth: 0,
            canvasHeight: 0,
            maxZoom: a.MAX_ZOOM_MAP,
            pixelRatio: a.PIXEL_RATIO,
            textureRatio: a.PRERENDER_RATIO_MAP,
            cameraAcceleration: 1.15,
            nbCacheableSprites: a.MAX_SPRITES_BUFFER_MAP,
            textureMemoryCacheSize: a.MAX_TEXTURE_MEMORY_MAP,
            prerenderQualityRatio: a.PRERENDER_RATIO_MAP,
            adjustToCanvasRatio: !0,
            usePrecisionRendering: !0
        });
        var i = {
            scene: this.mapScene,
            layer: a.MAP_LAYER_BACKGROUND,
            position: -1,
            x: -a.HORIZONTAL_OFFSET,
            y: -a.VERTICAL_OFFSET,
            w: a.MAP_SCENE_WIDTH,
            h: a.MAP_SCENE_HEIGHT,
            id: "mapBackground"
        };
        this.renderer = this.mapScene.renderer,
        this.background = new u(i),
        this.actorManager = new h({
            isoEngine: this,
            scene: this.mapScene
        }),
        this.mapRenderer = new c(this.mapScene,this.background),
        this.highlightedElements = {},
        this.gameContext = p.ROLE_PLAY,
        this.isInGame = !1,
        this.isMovementWaitingForConfirmation = !1,
        this.endMovementCallback = null ,
        this.isMovementCanceled = !1,
        this.actionQueue = new _,
        r.start(),
        this.mapScene.camera.setZoom(0),
        this._initGridOverlayLayers(),
        this._previousTurn = !1,
        this._isUserTurn = !1;
        var n = this
          , o = this.background;
        this.on("GameFightStartMessage", function() {
            n._resetFightPositionLayer()
        }),
        this.on("GameFightEndMessage", function() {
            n._resetFightPositionLayer(),
            n._resetSpellRangeLayer(),
            n._resetSpellEffectLayer(),
            n._resetWalkLayer(),
            n._resetWalkAreaLayer(),
            n._resetEnemyWalkAreaLayer(),
            o.removeTargetHighlights(),
            window.foreground.confirmBox.close(),
            this._isUserTurn = !1
        }),
        this._initLoadingProgress(),
        this.bitmapFonts = null ,
        this._currentBannerTweens = {
            backTween: null ,
            textTween: null
        }
    }
    var o = i(26).inherits
      , s = i(16).EventEmitter
      , a = i(6)
      , r = i(845)
      , l = i(839)
      , c = i(1015)
      , u = i(1024)
      , h = i(1031)
      , d = i(1034)
      , p = i(85)
      , m = i(250)
      , f = i(22)
      , g = i(291)
      , _ = i(1049)
      , v = i(25)
      , y = i(49);
    o(n, s),
    e.exports = n,
    n.prototype._loadBitmapFonts = function() {
        if (null === this.bitmapFonts) {
            var e = this;
            g.loadModel("bitmapFonts", "atlas", function(t, i) {
                var n = e.mapScene.createTexture(i, "atlas", "mimap", "permanent");
                e.bitmapFonts = {
                    characters: {
                        dimensions: t.characters,
                        texture: n
                    },
                    numbers: {
                        dimensions: t.numbers,
                        texture: n
                    }
                }
            })
        }
    }
    ,
    n.prototype.initialize = function(e) {
        e.config && (window.Config = e.config,
        d.initialize(this),
        this.mapRenderer.initialize(),
        this.actionQueue.initialize(),
        m.loadMissingTemplatesInfo(),
        this._loadBitmapFonts())
    }
    ,
    n.prototype._activateMapScene = function() {
        return this.isInGame === !1 && (r.addScene(this.mapScene),
        r.addScene(this.actorManager),
        this.isInGame = !0,
        !0)
    }
    ,
    n.prototype._deactivateMapScene = function() {
        return this.isInGame === !0 && (this.mapScene.clear(0, 0, 0, 0),
        r.removeScene(this.mapScene),
        r.removeScene(this.actorManager),
        this.clearUserMovementZone(),
        this.background.resetAndClear(),
        this.releaseMap(),
        this.interactiveDisconnect(),
        this.isInGame = !1,
        !0)
    }
    ,
    n.prototype.disconnect = function() {
        y.unlockMessages(),
        this.emit("disconnect"),
        this._deactivateMapScene(),
        this.mapTransitionDisconnect(),
        this.background && this.background.gridAnimator && this.background.gridAnimator.clear(),
        this.clearPendingMovement(),
        this.actionQueue.clear()
    }
    ,
    n.prototype.transmitMessage = function(e) {
        this.emit(e._messageType, e)
    }
    ,
    n.prototype.releaseMap = function(e) {
        this.isInGame !== !1 && (this.gameContext !== p.FIGHT && this.actorManager.removeAllActors(),
        this.cleanupChallenges(),
        this.background.releaseMap(),
        this.mapRenderer.releaseMap(e),
        this.actionQueue.clear())
    }
    ,
    n.prototype.changeGameContext = function(e) {
        this.gameContext = e,
        this.mapRenderer.removeMovementFeedback(),
        this.clearHighlights(),
        this.clearPendingMovement(),
        this.actionQueue.clear();
        var t = e === p.FIGHT;
        t ? (this.cleanupChallenges(),
        r.removeScene(this.actorManager),
        this.mapRenderer.switchGameContextFight()) : (r.addScene(this.actorManager),
        this.actorManager.userActor.show(),
        this.clearUserMovementZone(),
        this.mapRenderer.switchGameContextRoleplay(),
        this.background.deleteAllZones()),
        window.background.changeGameContext(t),
        this.toggleGrid()
    }
    ,
    n.prototype.toggleGrid = function() {
        var e = this.gameContext === p.FIGHT;
        window.background.toggleGrid(e || v.alwaysShowGrid)
    }
    ,
    n.prototype.setInteractiveBlink = function(e) {
        this.interactiveBlink = e
    }
    ,
    n.prototype._updateMapInfoData = function(e, t) {
        this.mapRenderer.setStatedElements(e.statedElements, this.gameContext === p.FIGHT),
        this.addChallenges(e.fights),
        this.mapRenderer.setInteractiveElements(e.interactiveElements),
        this.mapRenderer.updateObstacles(e.obstacles),
        t && t.noMovementWaitReset || (this.isMovementWaitingForConfirmation = !1)
    }
    ,
    n.prototype.onQuickReconnection = function(e) {
        if (!window.gui.isConnected)
            return e && e();
        if (window.gui.playerData && window.gui.playerData.isFighting)
            return e && e();
        if (this.endMovementCallback = null ,
        this.isMovementCanceled = !1,
        this.isMovementWaitingForConfirmation = !1,
        this.mapRenderer.removeMovementFeedback(),
        f.isDialogActive())
            return e && e();
        window.foreground.lock("quickReconnection"),
        this.lastMoveRequestTime = null ,
        this.actorManager.pause(),
        window.dofus.sendMessage("MapInformationsRequestMessage", {
            mapId: this.mapRenderer.mapId
        });
        var t = this;
        this.once("mapLoaded", function() {
            if (window.foreground.unlock("quickReconnection"),
            t.userPreviousPosition) {
                var i = t.userPreviousPosition;
                window.dofus.sendMessage("GameMapMovementCancelMessage", {
                    cellId: i
                });
                var n = t.actorManager.userActor;
                n.noMovement(),
                n.setDisposition(i, n.direction)
            }
            return t.actorManager.unpause(),
            e && e()
        })
    }
    ,
    n.prototype.attackActor = function(e) {
        var t = this.actorManager.actors
          , i = t[e];
        if (i) {
            var n = i.cellId;
            this._movePlayerOnMap(n)
        }
    }
    ,
    n.prototype.updateDimensions = function(e) {
        this.mapScene.setCanvasDimensions(e.mapWidth, e.mapHeight, e.mapLeft, e.mapTop, "absolute") && this.mapScene.camera.setZoom(0),
        this.isInGame && this.mapScene.requireCompleteRefresh()
    }
    ,
    n.prototype.useItem = function(e, t, i) {
        var n = this.mapScene.convertCanvasToSceneCoordinate(e, t)
          , o = this.mapRenderer.getCellId(n.x, n.y).cell
          , s = this.actorManager.occupiedCells[o];
        s && s.length && s[0].actorId >= 0 ? window.dofus.sendMessage("ObjectUseOnCharacterMessage", {
            characterId: s[0].actorId,
            objectUID: i
        }) : window.dofus.sendMessage("ObjectUseOnCellMessage", {
            cells: o,
            objectUID: i
        })
    }
    ,
    n.prototype.toggleTacticMode = function(e) {
        e ? this.mapRenderer.enableTacticMode() : this.mapRenderer.disableTacticMode()
    }
    ,
    n.prototype.sendToFightSequence = function(e) {
        this.emit(e._messageType, e)
    }
}
, function(e, t, i) {
    function n() {
        var e = document.createElement("canvas");
        e.width = H,
        e.height = G;
        var t = e.getContext("2d");
        t.clearRect(0, 0, H, G),
        t.fillStyle = "#5A523C",
        t.strokeStyle = "#CCCCCC";
        var i = [H / 2, H, H, H / 2, 0, 0]
          , n = [0, k / 2, k, G, k, k / 2];
        t.beginPath(),
        t.moveTo(0, k / 2);
        for (var o = 0; o < i.length; o++)
            t.lineTo(i[o], n[o]);
        return t.closePath(),
        t.fill(),
        t.stroke(),
        t.lineTo(H / 2, k),
        t.lineTo(H, k / 2),
        t.moveTo(H / 2, k),
        t.lineTo(H / 2, G),
        t.stroke(),
        e
    }
    function o(e, t) {
        r.call(this),
        this.mapId = null ,
        this.map = null ,
        this.mapScene = e,
        this.background = t,
        this.grid = new a,
        this.graphics = [],
        this.tacticGraphics = [],
        this.statedElements = [],
        this.interactiveElements = {},
        this.identifiedElements = {},
        this.objects = {},
        this.animatedElements = [],
        this.textureTacticBlock = this.mapScene.createTexture(n(), "roleplayTacticBlock", "linear", "permanent"),
        this.isReady = !1,
        this.isFightMode = !1
    }
    function s(e, t) {
        this.mapRenderer = e,
        this.onLoadedCallback = t,
        this.nAssetsLoaded = 0,
        this.nAssetsToLoad = 0,
        this.atlas = document.createElement("canvas"),
        this.atlasContext = this.atlas.getContext("2d"),
        this.obsolete = !1,
        null !== q && (q.obsolete = !0);
        var i = this;
        q = i
    }
    var a = i(1016)
      , r = i(16).EventEmitter
      , l = i(26).inherits
      , c = i(614)
      , u = i(6)
      , h = i(1017)
      , d = i(5)
      , p = i(253)
      , m = i(249)
      , f = i(619)
      , g = i(1018)
      , _ = i(1019)
      , v = i(1020)
      , y = i(1021)
      , w = i(622)
      , b = i(625)
      , C = i(1022)
      , I = u.IMG_PATH
      , T = u.BACKGROUND_PATH
      , S = u.FOREGROUND_PATH
      , A = {
        r: 255,
        g: 0,
        b: 0,
        a: .75
    }
      , E = {
        r: 0,
        g: 0,
        b: 0,
        a: 1
    }
      , x = 1
      , M = 2
      , N = 52
      , R = -u.CELL_HEIGHT / 4
      , O = 131
      , P = 14
      , D = 56
      , L = 224
      , B = u.NB_CELLS
      , k = u.CELL_HEIGHT
      , F = 2
      , H = u.CELL_WIDTH
      , G = Math.round(1.5 * k)
      , U = H + F
      , j = G + F;
    l(o, r),
    e.exports = o,
    o.prototype.initialize = function() {
        w.initialize()
    }
    ,
    o.prototype.setMap = function(e, t) {
        var i = e.mapData;
        this.map = i,
        this.mapId = i.id,
        this.grid.initialize(i.cells, !this.isFightMode),
        this.loadMap(e, t)
    }
    ,
    o.prototype.releaseMap = function(e) {
        e !== this.mapId && (this.mapScene.clean(),
        this.isReady = !1,
        this.graphics = [],
        this.tacticGraphics = [],
        this.statedElements = [],
        this.interactiveElements = {},
        this.identifiedElements = {},
        this.objects = {},
        this.animatedElements = [],
        this.mapId = null ,
        this.map = null )
    }
    ,
    o.prototype.stopAnimatedElements = function() {
        for (var e = this.animatedElements, t = 0; t < e.length; t++)
            e[t].stop()
    }
    ,
    o.prototype.startAnimatedElements = function() {
        for (var e = this.animatedElements, t = 0; t < e.length; t++)
            e[t].animate()
    }
    ;
    var q = null ;
    s.prototype.notifyAssetAsLoaded = function() {
        if (this.nAssetsLoaded += 1,
        window.isoEngine.showLoadingProgress(this.nAssetsLoaded / this.nAssetsToLoad),
        this.nAssetsLoaded === this.nAssetsToLoad) {
            if (this.onLoadedCallback(),
            this.onLoadedCallback = null ,
            this.obsolete)
                return;
            this.mapRenderer.isReady = !0,
            this.mapRenderer.emit("ready"),
            this.obsolete = !0
        }
    }
    ,
    s.prototype.loadStatedElement = function(e) {
        var t = new h(e)
          , i = this;
        return this.nAssetsToLoad += 1,
        m.loadAnimationManager(t, "bone", e.look + "/state", function() {
            t.changeState(t.state, !0),
            i.notifyAssetAsLoaded()
        }),
        t
    }
    ,
    s.prototype.loadAnimatedGraphic = function(e) {
        var t = new _(e)
          , i = this;
        return this.nAssetsToLoad += 1,
        m.loadAnimationManager(t, "bone", e.look + "/motion", function() {
            i.mapRenderer.isFightMode ? t.stop() : t.animate(),
            i.notifyAssetAsLoaded()
        }),
        t
    }
    ,
    s.prototype.loadAtlas = function(e, t) {
        function i() {
            if (r += 1,
            r === a) {
                var e = l.mapRenderer.mapScene
                  , i = l.mapRenderer.mapId
                  , n = e.createTexture(l.atlas, "mapAtlas" + i, "linear");
                l.atlas.width = 1,
                l.atlas.height = 1,
                t.setTexture(n)
            }
            l.notifyAssetAsLoaded()
        }
        function n(e, t) {
            d.loadImage(e, function(e) {
                if (!l.obsolete) {
                    var n = t.sx
                      , o = t.sy
                      , s = t.sw
                      , a = t.sh
                      , r = t.cx || 0
                      , c = t.cy || 0
                      , u = t.cw || s
                      , h = t.ch || a;
                    r + u > e.width && (u = e.width - r),
                    c + h > e.height && (h = e.height - c),
                    l.atlasContext.drawImage(e, r, c, u, h, n, o, s, a),
                    i()
                }
            })
        }
        this.atlas.width = e.width,
        this.atlas.height = e.height;
        var o = e.graphicsPositions
          , s = Object.keys(o)
          , a = s.length
          , r = 0;
        this.nAssetsToLoad += a;
        for (var l = this, c = 0; c < s.length; c += 1) {
            var u = s[c]
              , h = o[u]
              , p = h.jpg ? "jpg" : "png"
              , m = p + "/" + u + "." + p
              , f = I + m;
            n(f, h)
        }
    }
    ,
    o.prototype.loadMap = function(e, t) {
        for (var i = e.mapData, n = e.msg, o = {}, a = n.statedElements, r = 0; r < a.length; r++)
            o[a[r].elementId] = !0;
        this.graphics = [],
        this.statedElements = [],
        this.animatedElements = [];
        var l = new s(this,t);
        l.nAssetsToLoad += 1;
        var c = new g({
            id: "mapSceneStaticSprites" + this.mapId,
            scene: this.mapScene,
            holdsStatics: !0
        });
        this.graphics.push(c);
        var h = i.atlasLayout
          , d = h.graphicsPositions;
        l.loadAtlas(h, c);
        for (var m, _ = i.midgroundLayer, v = Object.keys(_), y = 0; y < v.length; y++)
            for (var w = v[y], b = _[w], C = 0; C < b.length; C++) {
                var I = b[C];
                I.position = parseInt(w, 10),
                I.layer = u.MAP_LAYER_PLAYGROUND,
                I.scene = this.mapScene;
                var A = I.hue;
                if (A[0] = 1 + A[0] / 127,
                A[1] = 1 + A[1] / 127,
                A[2] = 1 + A[2] / 127,
                A[3] = 1,
                I.look)
                    if (I.id && o[I.id])
                        m = l.loadStatedElement(I),
                        this.statedElements.push(m);
                    else {
                        if (!I.anim) {
                            console.warn("[MapRenderer.loadMap] Animated Graphic skipped", I);
                            continue
                        }
                        m = l.loadAnimatedGraphic(I),
                        this.animatedElements.push(m),
                        this.graphics.push(m)
                    }
                else {
                    if (!I.g) {
                        console.warn("[MapRenderer.loadMap] Element of unidentified type skipped", I);
                        continue
                    }
                    m = c.addSprite(I, d[I.g]),
                    I.isBoundingBox && (m.alpha = .15,
                    I.id || console.warn("[MapRenderer.loadMap] Element notified as a bounding box but has no id", I))
                }
                m.id && (this.identifiedElements[m.id] = m)
            }
        c.finalize(h.width, h.height);
        var E = this
          , x = T + i.id + ".jpg";
        if (l.nAssetsToLoad += 1,
        p.loadTexture(x, function(e) {
            E.background.updateMap(e),
            l.notifyAssetAsLoaded()
        }, this.mapScene.renderer, "linear"),
        i.foreground) {
            var M = new f({
                x: -u.HORIZONTAL_OFFSET,
                y: -u.VERTICAL_OFFSET,
                w: u.MAP_SCENE_WIDTH,
                h: u.MAP_SCENE_HEIGHT,
                scene: this.mapScene,
                layer: u.MAP_LAYER_FOREGROUND
            });
            this.graphics.push(M);
            var N = S + i.id + ".png";
            l.nAssetsToLoad += 1,
            p.loadTexture(N, function(e) {
                if ("empty_texture" === e.id) {
                    M.remove();
                    var t = E.graphics.indexOf(M);
                    t !== -1 && E.graphics.splice(t, 1)
                } else
                    M.texture = e,
                    M.forceRefresh();
                l.notifyAssetAsLoaded()
            }, this.mapScene.renderer, "linear")
        }
        l.notifyAssetAsLoaded()
    }
    ,
    o.prototype.switchGameContextFight = function() {
        this.isFightMode = !0,
        this.stopAnimatedElements();
        for (var e = 0; e < this.statedElements.length; e++) {
            var t = this.statedElements[e];
            t.changeState(1, !0)
        }
        for (var i in this.objects)
            this.objects[i].remove();
        this.objects = {},
        this.map && this.grid.initialize(this.map.cells, !1)
    }
    ,
    o.prototype.hideGraphics = function(e) {
        for (var t = 0; t < e.length; t++)
            e[t].hide()
    }
    ,
    o.prototype.showGraphics = function(e) {
        for (var t = 0; t < e.length; t++)
            e[t].show()
    }
    ,
    o.prototype.switchGameContextRoleplay = function() {
        this.isFightMode = !1,
        this.startAnimatedElements(),
        this.map && this.grid.initialize(this.map.cells, !0)
    }
    ,
    o.prototype.enableTacticMode = function() {
        if (this.hideGraphics(this.graphics),
        this.hideGraphics(this.statedElements),
        !this.map || !this.map.cells)
            return void this.once("ready", this.enableTacticMode);
        this.tacticGraphics = [];
        for (var e = this.map.cells, t = 0; t < B; t++)
            if (!(7 & e[t].l)) {
                var i = c.cellCoord[t];
                this.tacticGraphics.push(new f({
                    position: t,
                    hue: [1, 1, 1, 1],
                    x: i.x - U / 2,
                    y: i.y - k,
                    g: 1,
                    w: U,
                    h: j,
                    scene: this.mapScene
                },this.textureTacticBlock))
            }
        this.showGraphics(this.tacticGraphics),
        this.background.toggleTacticMode(!0)
    }
    ,
    o.prototype.disableTacticMode = function() {
        this.hideGraphics(this.tacticGraphics),
        this.showGraphics(this.graphics),
        this.showGraphics(this.statedElements),
        this.background.toggleTacticMode(!1)
    }
    ,
    o.prototype.addObjects = function(e) {
        if (!this.isReady) {
            var t = this
              , i = this.mapId;
            return this.once("ready", function() {
                t.mapId === i && t.addObjects(e)
            })
        }
        for (var n = 0; n < e.length; n++) {
            var o = e[n];
            if (o.img) {
                var s = this.getCellSceneCoordinate(o.cellId);
                o.x = s.x - N / 2,
                o.y = s.y - N / 2 + R,
                o.position = o.cellId,
                o.w = N,
                o.h = N,
                o.scene = this.mapScene;
                var a = this.mapScene.createTexture(o.img, "object:" + o.objectGID)
                  , r = new f(o,a);
                this.objects[o.cellId] = r
            } else
                console.error("createObjectGfx: no img for " + JSON.stringify(o))
        }
    }
    ,
    o.prototype.removeObjects = function(e) {
        for (var t = 0; t < e.length; t++) {
            var i = e[t]
              , n = this.objects[i];
            n && (n.remove(),
            delete this.objects[i])
        }
    }
    ,
    o.prototype.setInteractiveElements = function(e) {
        this.interactiveElements = {};
        for (var t = 0, i = e.length; t < i; t++) {
            var n = e[t];
            this.interactiveElements[n.elementId] = n
        }
    }
    ,
    o.prototype.updateInteractiveElements = function(e) {
        for (var t = this.interactiveElements, i = 0; i < e.length; i++) {
            var n = e[i]
              , o = t[n.elementId];
            o ? (o.disabledSkills = n.disabledSkills,
            o.enabledSkills = n.enabledSkills) : console.warn("Interactive element id " + n.elementId + " does not exist.")
        }
    }
    ,
    o.prototype.setStatedElements = function(e, t) {
        for (var i = 0, n = e.length; i < n; i++) {
            var o = e[i]
              , s = this.identifiedElements[o.elementId];
            s ? s instanceof h && (t ? (s.state = -1,
            s.changeState(1)) : s.changeState ? s.changeState(o.elementState) : s.state = o.elementState) : console.warn("stated element not identified:" + o.elementId + ", cellId=" + o.elementCellId)
        }
    }
    ,
    o.prototype.updateStatedElements = function(e) {
        for (var t = this.identifiedElements, i = 0, n = e.length; i < n; i++) {
            var o = e[i]
              , s = t[o.elementId];
            s ? s.changeState ? s.changeState(o.elementState) : (console.warn("Identified element " + o.elementId + " is not a stated element."),
            s.state = o.elementState) : console.warn("Identified element " + o.elementId + " not found.")
        }
    }
    ,
    o.prototype.addArrowsOnCellsOneShot = function(e, t, i, n) {
        for (var o = [], s = 0; s < e.length; s++)
            o[s] = this.getCellSceneCoordinate(e[s]),
            o[s].x += t || 0,
            o[s].y += i || 0;
        v.addArrowsOneShot(o, e, n, this.mapScene)
    }
    ,
    o.prototype.addTapFeedback = function(e, t) {
        w.addTapFeedback({
            x: e,
            y: t
        })
    }
    ,
    o.prototype.addMovementFeedback = function(e) {
        var t = this.getCellSceneCoordinate(e);
        w.addMovementFeedback({
            x: t.x,
            y: t.y,
            position: e
        })
    }
    ,
    o.prototype.removeTapFeedback = function() {
        w.removeTapFeedback()
    }
    ,
    o.prototype.removeMovementFeedback = function() {
        w.removeMovementFeedback()
    }
    ,
    o.prototype.addArrowOnCell = function(e, t, i, n, o) {
        var s = this.getCellSceneCoordinate(e);
        s.x += t || 0,
        s.y += i || 0,
        v.addArrow(s, e, n, this.mapScene, o)
    }
    ,
    o.prototype.addArrowOnGraphic = function(e, t, i, n, o) {
        if (!e || !e.bbox)
            return console.warn("addArrowOnGraphic: invalid graphic entity");
        var s = {
            x: (e.bbox[0] + e.bbox[1]) / 2 + (t || 0),
            y: (e.bbox[2] + e.bbox[3]) / 2 + (i || 0)
        };
        v.addArrow(s, null , n, this.mapScene, o)
    }
    ,
    o.prototype.addArrowsSequence = function(e, t, i, n) {
        for (var o = [], s = 0; s < e.length; s++)
            o[s] = this.getCellSceneCoordinate(e[s]),
            o[s].x += t || 0,
            o[s].y += i || 0;
        v.addArrowsSequence(o, e, n, this.mapScene)
    }
    ,
    o.prototype.removeArrows = function() {
        v.removeArrows()
    }
    ,
    o.prototype.addPingPictoOnCell = function(e, t, i) {
        var n = this.getCellSceneCoordinate(t);
        y.addPingPicto(e, n, t, i)
    }
    ,
    o.prototype.removePingPicto = function(e) {
        y.removePingPicto(e)
    }
    ,
    o.prototype.removeAllPingPictos = function() {
        y.removeAllPingPictos()
    }
    ,
    o.prototype.addCellHighlight = function(e, t, i, n) {
        i = i || A,
        n = n || E;
        for (var o = 0, s = t.length; o < s; o += 1) {
            var a = t[o]
              , r = "rgba(" + i.r + "," + i.g + "," + i.b + "," + i.a + ")"
              , l = "rgba(" + n.r + "," + n.g + "," + n.b + "," + n.a + ")";
            window.background.addZone(new C([a],{
                color: r,
                outline: l
            }), e)
        }
    }
    ,
    o.prototype.deleteCellHighlight = function(e) {
        window.background.deleteZoneById(e)
    }
    ,
    o.prototype.updateObstacles = function(e) {
        if (!this.isReady) {
            var t = this
              , i = this.mapId;
            return this.once("ready", function() {
                t.mapId === i && t.updateObstacles(e)
            })
        }
        for (var n = this.map.cells, o = 0, s = e.length; o < s; o++) {
            var a = e[o]
              , r = a.obstacleCellId
              , l = n[r]
              , c = l.l;
            a.state === x ? l.l |= 1 : a.state === M && (l.l &= 254),
            this.grid.updateCellState(r, l, c),
            b.updateCellPath(r, l)
        }
    }
    ,
    o.prototype.isWalkable = function(e, t) {
        var i = t ? 5 : 1;
        return 1 === (this.map.cells[e].l & i)
    }
    ,
    o.prototype.isFarmCell = function(e) {
        return 32 === (32 & this.map.cells[e].l)
    }
    ,
    o.prototype.isVisibleCell = function(e) {
        return 64 === (64 & this.map.cells[e].l)
    }
    ,
    o.prototype.getChangeMapFlags = function(e) {
        var t = this.map.cells[e].c || 0;
        return 0 === t ? {} : {
            left: t & D && e % 14 === 0,
            right: t & O && e % 14 === 13,
            top: t & L && e < 28,
            bottom: t & P && e > 531
        }
    }
    ,
    o.prototype.getFirstMapFlag = function(e) {
        var t = this.getChangeMapFlags(e);
        return t.left ? "left" : t.right ? "right" : t.top ? "top" : t.bottom ? "bottom" : null
    }
    ,
    o.prototype.getCellId = function(e, t) {
        return this.grid.getCellAtSceneCoordinate({
            x: e,
            y: t
        })
    }
    ,
    o.prototype.getCellSceneCoordinate = function(e) {
        var t = c.getCellCoord(e);
        return this.isReady && (t.y -= this.map.cells[e].f || 0),
        t
    }
}
, function(e, t, i) {
    "use strict";
    function n() {
        this.cells = [],
        this.bounds = [],
        this.cellId = void 0
    }
    function o() {
        this.grid = [],
        this.scenePositions = []
    }
    function s(e, t, i, n, o) {
        for (var s = 0; s < e.length; s += 1) {
            var a = e[s]
              , r = t[a]
              , l = (r.x - i) * _
              , c = (r.y - n) * v
              , u = l * l + c * c;
            u < o.dist && (o.dist = u,
            o.cell = a)
        }
    }
    function a(e, t) {
        var i = e.cells.indexOf(t);
        i !== -1 && (e.cells.splice(i, 1),
        e.bounds.splice(i, 1))
    }
    var r = i(6)
      , l = i(626)
      , c = r.CELL_WIDTH
      , u = r.CELL_HEIGHT
      , h = r.HORIZONTAL_OFFSET - c
      , d = r.VERTICAL_OFFSET - u / 2
      , p = 19
      , m = p + .225
      , f = Math.sqrt(2)
      , g = f / 2
      , _ = f / c
      , v = f / u
      , y = 33
      , w = 34
      , b = 14
      , C = 2 * b;
    e.exports = o,
    o.prototype.getCoordinateGridFromCellId = function(e) {
        var t = e % b - ~~(e / C)
          , i = t + p
          , n = t + ~~(e / b);
        return {
            i: i,
            j: n
        }
    }
    ,
    o.prototype.getCoordinateCellIdFromGrid = function(e) {
        return this.grid[e.i][e.j].cellId
    }
    ,
    o.prototype.getCoordinateGridFromScene = function(e) {
        var t = (e.x - h) * _
          , i = (e.y - d) * v
          , n = g * t - g * i + m
          , o = g * t + g * i
          , s = Math.max(0, Math.min(y - 1, ~~n))
          , a = Math.max(0, Math.min(w - 1, ~~o));
        return {
            i: s,
            j: a,
            dx: n - s,
            dy: o - a
        }
    }
    ,
    o.prototype.getCoordinateSceneFromGrid = function(e) {
        var t = e.i - m
          , i = e.j;
        return {
            x: (g * t + g * i) / _ + c / 2 + h,
            y: (g * i - g * t) / v + d
        }
    }
    ,
    o.prototype.getSceneCoordinateFromCellId = function(e) {
        return this.getCoordinateSceneFromGrid(this.getCoordinateGridFromCellId(e))
    }
    ,
    o.prototype.getCellAtSceneCoordinate = function(e) {
        var t = this.getCoordinateGridFromScene(e)
          , i = this.grid[t.i][t.j]
          , n = i.cells;
        if (0 === n.length)
            return this.getClosestCell(t, e);
        for (var o = t.dx, s = t.dy, a = i.bounds, r = 0, l = a.length; r < l; r += 1) {
            var c = a[r];
            if (c[0] <= o && o <= c[1] && c[2] <= s && s <= c[3])
                return {
                    cell: n[r],
                    dist: 0
                }
        }
        return this.getClosestCell(t, e)
    }
    ,
    o.prototype.getClosestCell = function(e, t) {
        for (var i, n, o, a, r = e.i, l = e.j, c = t.x, u = t.y, h = 0, d = {
            cell: -1,
            dist: 1 / 0
        }; d.cell === -1; ) {
            for (o = Math.max(l - h, 0),
            a = Math.min(l + h, w - 1),
            n = Math.min(r + h, y - 1),
            i = Math.max(r - h, 0); i <= n; i += 1)
                s(this.grid[i][o].cells, this.scenePositions, c, u, d),
                s(this.grid[i][a].cells, this.scenePositions, c, u, d);
            for (i = Math.max(r - h, 0),
            n = Math.min(r + h, y - 1),
            a = Math.min(l + h - 1, w - 1),
            o = Math.max(l - h + 1, 0); o <= a; o += 1)
                s(this.grid[i][o].cells, this.scenePositions, c, u, d),
                s(this.grid[n][o].cells, this.scenePositions, c, u, d);
            h += 1
        }
        return d
    }
    ,
    o.prototype.getNearbyCellInZone = function(e, t, i, n) {
        if (void 0 !== n[e])
            return e;
        for (var o = null , s = [], a = l.getNeighbourCells(e, !0), r = 0; r < a.length; r++)
            void 0 !== a[r] && void 0 !== n[a[r]] && s.push(a[r]);
        var c = 1 / 0;
        for (r = 0; r < s.length; r++) {
            var u = s[r]
              , h = this.scenePositions[u]
              , d = (h.x - t) * _
              , p = (h.y - i) * v
              , m = d * d + p * p;
            m < c && (c = m,
            o = u)
        }
        return o
    }
    ,
    o.prototype.updateCellState = function(e, t, i) {
        var n = t.l;
        0 === (1 & n) ? 0 !== (1 & i) && this._removeCell(e, t) : 0 === (1 & i) && this._addCell(e, t)
    }
    ,
    o.prototype._removeCell = function(e, t) {
        delete this.scenePositions[e];
        var i = this.useAltitude && t.f || 0
          , n = this.getCoordinateGridFromCellId(e);
        if (0 === i)
            a(this.grid[n.i][n.j], e);
        else {
            var o = i / u
              , s = Math.floor(n.i + o)
              , r = Math.floor(n.j - o);
            if (s >= y || r >= w)
                return;
            var l = s + 1
              , c = r + 1;
            if (l < 0 || c < 0)
                return;
            s >= 0 && (r >= 0 && a(this.grid[s][r], e),
            c < w && a(this.grid[s][c], e)),
            l < y && (r >= 0 && a(this.grid[l][r], e),
            c < w && a(this.grid[l][c], e))
        }
    }
    ,
    o.prototype._addCell = function(e, t) {
        var i, n = this.getCoordinateGridFromCellId(e);
        this.grid[n.i][n.j].cellId = e;
        var o = this.useAltitude && t.f || 0
          , s = this.getCoordinateSceneFromGrid(n);
        if (s.y -= o,
        this.scenePositions[e] = s,
        0 === o)
            i = this.grid[n.i][n.j],
            i.cells.push(e),
            i.bounds.push([0, 1, 0, 1]);
        else {
            var a = o / u
              , r = n.i + a
              , l = n.j - a
              , c = Math.floor(r)
              , h = Math.floor(l);
            if (c >= y || h >= w)
                return;
            var d = c + 1
              , p = h + 1;
            if (d < 0 || p < 0)
                return;
            var m = r - c
              , f = l - h;
            c >= 0 && (h >= 0 && (i = this.grid[c][h],
            i.cells.push(e),
            i.bounds.push([m, 1, f, 1])),
            p < w && (i = this.grid[c][p],
            i.cells.push(e),
            i.bounds.push([m, 1, 0, f]))),
            d < y && (h >= 0 && (i = this.grid[d][h],
            i.cells.push(e),
            i.bounds.push([0, m, f, 1])),
            p < w && (i = this.grid[d][p],
            i.cells.push(e),
            i.bounds.push([0, m, 0, f])))
        }
    }
    ,
    o.prototype.initialize = function(e, t) {
        this.cellList = e,
        this.useAltitude = t,
        this.grid = [],
        this.scenePositions = [];
        for (var i = 0; i < y; i += 1) {
            var o = new Array(w);
            this.grid[i] = o;
            for (var s = 0; s < w; s += 1)
                o[s] = new n
        }
        for (var a = e.length - 1; a >= 0; a -= 1) {
            var r = e[a];
            0 !== (1 & r.l) && this._addCell(a, r)
        }
    }
}
, function(e, t, i) {
    function n(e, t) {
        s.call(this, e, t),
        this.state = -1,
        this.animated = !1
    }
    var o = i(26).inherits
      , s = i(243)
      , a = {
        2: !0
    };
    o(n, s),
    e.exports = n,
    n.prototype.changeState = function(e, t) {
        function i() {
            o.assignSymbol(l, c),
            n.animated = c
        }
        if (this.state !== e) {
            var n = this
              , o = this.animManager
              , s = this.state;
            if (this.state = e,
            !o.isVoidAnimManager) {
                var r = {
                    id: "AnimState" + s + "_to_AnimState" + e + "_0",
                    base: "AnimState" + s + "_to_AnimState" + e,
                    direction: 0
                }
                  , l = {
                    id: "AnimState" + e + "_0",
                    base: "AnimState" + e,
                    direction: 0
                }
                  , c = a[e] || !1;
                !t && o.template && o.template.exposedSymbols[r.id] ? (this.animated = !0,
                o.assignSymbol(r, !1, i)) : i()
            }
        }
    }
}
, function(e, t, i) {
    function n(e) {
        a.call(this, e),
        this._updatedSprites = [],
        this._atlasTexture = null ,
        this._spriteByteSize = this.renderer.getNbBytesPerSprite(),
        this._vertexBuffer = null ,
        this._floatView = null ,
        this._longView = null ,
        this._sprites = [],
        this._vertexBufferCreated = !1,
        this._vertexBufferIndexPerPosition = new Array(l + 1)
    }
    function o(e, t, i) {
        r.call(this, e),
        this.batch = i,
        this.renderer = i.renderer;
        var n = e.cx || 0
          , o = e.cy || 0
          , s = e.x
          , a = e.y
          , l = e.sx || 1
          , c = e.sy || 1
          , u = e.cw
          , h = e.ch
          , d = -n * l
          , p = -o * c
          , m = (u - n) * l
          , f = -o * c
          , g = -n * l
          , _ = (h - o) * c
          , v = (u - n) * l
          , y = (h - o) * c
          , w = e.rotation || 0;
        if (0 !== w) {
            var b = Math.cos(w)
              , C = Math.sin(w)
              , I = d
              , T = m
              , S = g
              , A = v;
            d = d * b - p * C,
            p = I * C + p * b,
            m = m * b - f * C,
            f = T * C + f * b,
            g = g * b - _ * C,
            _ = S * C + _ * b,
            v = v * b - y * C,
            y = A * C + y * b
        }
        this.x0 = d + s,
        this.y0 = p + a,
        this.x1 = m + s,
        this.y1 = f + a,
        this.x2 = g + s,
        this.y2 = _ + a,
        this.x3 = v + s,
        this.y3 = y + a,
        this.bbox[0] = Math.min(this.x0, this.x1, this.x2, this.x3),
        this.bbox[1] = Math.max(this.x0, this.x1, this.x2, this.x3),
        this.bbox[2] = Math.min(this.y0, this.y1, this.y2, this.y3),
        this.bbox[3] = Math.max(this.y0, this.y1, this.y2, this.y3),
        this.graphicInAtlas = t,
        this.spriteIndex = 0
    }
    var s = i(26).inherits
      , a = i(244)
      , r = i(245)
      , l = i(6).NB_CELLS;
    s(n, a),
    e.exports = n,
    n.prototype.holdsStatics = !0,
    n.prototype.setTexture = function(e) {
        this._atlasTexture = e,
        this._updatedSprites.push(this),
        this.forceRefresh()
    }
    ,
    n.prototype.draw = function(e, t) {
        if (null !== this._atlasTexture && !(e.layer > this.layer || t.layer < this.layer)) {
            var i;
            e.layer < this.layer ? i = 0 : (i = Math.round(e.position),
            i < 0 ? i = 0 : i > l && (i = l));
            var n;
            t.layer > this.layer ? n = l : (n = Math.round(t.position),
            n < 0 ? n = 0 : n > l && (n = l));
            var o = this._vertexBufferIndexPerPosition[i]
              , s = this._vertexBufferIndexPerPosition[n];
            o !== s && this.renderer.drawSpriteSubBatch(this.id, o, s)
        }
    }
    ,
    s(o, r),
    o.prototype.isWithinBounds = function(e, t) {
        return this.bbox[0] <= e && e <= this.bbox[1] && this.bbox[2] <= t && t <= this.bbox[3]
    }
    ,
    o.prototype.render = function() {
        null !== this.batch._atlasTexture && this.renderer.drawSpriteSubBatch(this.batch.id, 6 * this.spriteIndex, 6 * this.spriteIndex + 6)
    }
    ,
    o.prototype.forceRefresh = function() {
        this.isOutdated === !1 && (this.isOutdated = !0,
        this.batch._updatedSprites.push(this),
        this.batch.forceRefresh())
    }
    ,
    n.prototype.addSprite = function(e, t) {
        var i = new o(e,t,this);
        return this._sprites.push(i),
        i
    }
    ,
    n.prototype.finalize = function(e, t) {
        this._createVertexBuffer(e, t),
        this._updatedSprites.push(this),
        this.forceRefresh()
    }
    ,
    n.prototype.refreshAnimation = function(e) {
        if (this.isOutdated = !1,
        0 !== this._updatedSprites.length) {
            for (var t = 0; t < this._updatedSprites.length; t += 1) {
                var i = this._updatedSprites[t];
                this._updateSpriteHighlight(i),
                void 0 !== e && e.push(i.bbox.slice()),
                i.isOutdated = !1
            }
            var n = this.id
              , o = this.renderer.getBufferData(n);
            if (void 0 === o) {
                var s = this._atlasTexture;
                if (null !== s && this._vertexBufferCreated) {
                    var a = this._floatView
                      , r = !1;
                    this.renderer.loadSpriteBuffer(n, a, s, this.bbox, r),
                    this.renderer.lockBuffer(n)
                }
            }
            this._updatedSprites.length = 0
        }
    }
    ,
    n.prototype._updateSpriteHighlight = function(e) {
        var t = e.spriteIndex * this._spriteByteSize
          , i = t / 4
          , n = this._longView.subarray(i, i + this._spriteByteSize / 4)
          , o = e.tint
          , s = Math.max(-128, Math.min(127, 64 * o[0]))
          , a = Math.max(-128, Math.min(127, 64 * o[1]))
          , r = Math.max(-128, Math.min(127, 64 * o[2]))
          , l = Math.max(-128, Math.min(127, 64 * o[3]))
          , c = (l << 24 & 4278190080) + (r << 16 & 16711680) + (a << 8 & 65280) + (255 & s);
        n[3] = n[8] = n[13] = c,
        n[18] = n[23] = n[28] = c,
        this.renderer.updateVertexBuffer(this.id, n, t)
    }
    ,
    n.prototype._createVertexBuffer = function(e, t) {
        this._vertexBuffer = new ArrayBuffer(this._spriteByteSize * this._sprites.length),
        this._floatView = new Float32Array(this._vertexBuffer),
        this._longView = new Uint32Array(this._vertexBuffer);
        for (var i = this._floatView, n = this._longView, o = this._longView, s = 1 / 0, a = -(1 / 0), r = 1 / 0, c = -(1 / 0), u = 0, h = 0; h < this._sprites.length; h += 1) {
            var d = this._sprites[h]
              , p = d.graphicInAtlas
              , m = h * this._spriteByteSize / 4;
            for (d.spriteIndex = h; u < d._position; )
                this._vertexBufferIndexPerPosition[u] = 6 * h,
                u += 1;
            this._vertexBufferIndexPerPosition[u] = 6 * h + 6;
            var f = d.bbox;
            f[0] < s && (s = f[0]),
            f[1] > a && (a = f[1]),
            f[2] < r && (r = f[2]),
            f[3] > c && (c = f[3]),
            i[m + 0] = d.x0,
            i[m + 1] = d.y0,
            i[m + 5] = d.x2,
            i[m + 6] = d.y2,
            i[m + 10] = d.x3,
            i[m + 11] = d.y3,
            i[m + 15] = d.x0,
            i[m + 16] = d.y0,
            i[m + 20] = d.x3,
            i[m + 21] = d.y3,
            i[m + 25] = d.x1,
            i[m + 26] = d.y1;
            var g = p.sx / e * 65535 & 65535
              , _ = p.sy / t * 4294901760 & 4294901760
              , v = (p.sx + p.sw) / e * 65535 & 65535
              , y = (p.sy + p.sh) / t * 4294901760 & 4294901760;
            n[m + 2] = g + _,
            n[m + 7] = g + y,
            n[m + 12] = v + y,
            n[m + 17] = g + _,
            n[m + 22] = v + y,
            n[m + 27] = v + _;
            var w = d.tint
              , b = Math.max(-128, Math.min(127, 64 * w[0]))
              , C = Math.max(-128, Math.min(127, 64 * w[1]))
              , I = Math.max(-128, Math.min(127, 64 * w[2]))
              , T = Math.max(-128, Math.min(127, 64 * w[3]))
              , S = (T << 24 & 4278190080) + (I << 16 & 16711680) + (C << 8 & 65280) + (255 & b);
            o[m + 3] = o[m + 8] = o[m + 13] = S,
            o[m + 18] = o[m + 23] = o[m + 28] = S,
            o[m + 4] = o[m + 9] = o[m + 14] = 0,
            o[m + 19] = o[m + 24] = o[m + 29] = 0
        }
        for (; u <= l; )
            this._vertexBufferIndexPerPosition[u] = 6 * h,
            u += 1;
        this.bbox[0] = s,
        this.bbox[1] = a,
        this.bbox[2] = r,
        this.bbox[3] = c,
        this._vertexBufferCreated = !0
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id),
        this._atlasTexture && this._atlasTexture.release()
    }
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e, e.animManager),
        this.animStatic = !!e.astc,
        this.delayMin = e.dmin || 0,
        this.delayMax = e.dmax || 0,
        this._timeout = null ,
        this._stopped = !0
    }
    var o = i(26).inherits
      , s = i(243)
      , a = {
        id: "AnimStatique_0",
        base: "AnimStatique",
        direction: 0
    }
      , r = {
        id: "AnimStart_0",
        base: "AnimStart",
        direction: 0
    };
    o(n, s),
    e.exports = n,
    n.prototype.animate = function() {
        this._stopped && (this._stopped = !1,
        this.delayMax ? (this.animStatic && this.animManager.assignSymbol(a, !1),
        this._animateShoot()) : this._animateLoop())
    }
    ,
    n.prototype.stop = function() {
        this._stopped = !0,
        this._timeout && (window.clearTimeout(this._timeout),
        this._timeout = null ),
        this.delayMax || this.animManager.assignSymbol(a, !1)
    }
    ,
    n.prototype.remove = function() {
        this.stop(),
        s.prototype.remove.call(this)
    }
    ,
    n.prototype._animateLoop = function() {
        this.animManager.assignSymbol(r, !0)
    }
    ,
    n.prototype._animateShoot = function() {
        var e = this;
        if (!this._stopped) {
            var t = 1e3 * (this.delayMin + (this.delayMax - this.delayMin) * Math.random());
            this._timeout = window.setTimeout(function() {
                e._stopped || e.animManager.assignSymbol(r, !1, function() {
                    e._stopped || (e.animStatic && e.animManager.assignSymbol(a, !1),
                    e._animateShoot())
                })
            }, t)
        }
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        h.call(this, e, t),
        this._centerX = e.w / 2,
        this._centerY = e.h,
        this.orientation = e.orientation,
        this.tween = null ,
        this._startAnimation(i)
    }
    function o() {
        0 !== v.length && (v.forEach(function(e) {
            t.addArrow.apply(null , e)
        }),
        v = [])
    }
    function s(e, t, i, s, a) {
        if (!y)
            return v.push(arguments),
            void (w || (w = !0,
            g.loadTexture("ui/hintArrow/arrow.png", function(e) {
                y = e,
                o()
            }, s.renderer, "linear", "permanent")));
        var r = {
            x: e.x,
            y: e.y,
            w: b,
            h: C,
            position: t,
            layer: u.MAP_LAYER_POINT_LABELS,
            orientation: i,
            scene: s
        };
        _.push(new n(r,y,a))
    }
    function a() {
        v = [];
        for (var e = 0; e < _.length; e++)
            _[e].remove();
        _ = [],
        (M.playing || M.starting) && M.stop(),
        (N.playing || N.starting) && N.stop()
    }
    function r(e, t, i, n, o) {
        a(),
        s(e[o], t[o], i, n),
        M.reset(S, function() {
            ++o >= e.length && (o = 0),
            r(e, t, i, n, o)
        }),
        M.start()
    }
    function l(e, t, i, n) {
        r(e, t, i, n, 0)
    }
    function c(e, t, i, n) {
        if (!N.playing && !N.starting) {
            a();
            for (var o = 0; o < e.length; o++)
                s(e[o], t[o], i, n);
            N.reset(S, function() {
                a()
            }),
            N.start()
        }
    }
    var u = i(6)
      , h = i(619)
      , d = i(26).inherits
      , p = i(261).easing
      , m = i(261).Tween
      , f = i(261).Delay
      , g = i(253)
      , _ = []
      , v = []
      , y = null
      , w = !1
      , b = 60
      , C = 60
      , I = 24
      , T = 2
      , S = 2 * (I + T)
      , A = {
        up: 0,
        down: 180,
        left: -90,
        right: 90,
        upLeft: -45,
        upRight: 45,
        downLeft: -135,
        downRight: 135
    }
      , E = 3
      , x = 3;
    d(n, h),
    Object.defineProperty(n.prototype, "centerX", {
        get: function() {
            return this._centerX
        },
        set: function(e) {
            this._centerX = e,
            this.forceRefresh()
        }
    }),
    Object.defineProperty(n.prototype, "centerY", {
        get: function() {
            return this._centerY
        },
        set: function(e) {
            this._centerY = e,
            this.forceRefresh()
        }
    }),
    n.prototype._startAnimation = function(e) {
        var t = A[this.orientation] || 0;
        this.rotation = t * Math.PI / 180,
        this.tween && (this.tween.stop(),
        this.tween = null );
        var i = this.centerY - E
          , n = this.centerY + E;
        return this.tween = new m(this,["alpha", "centerY"]).from({
            alpha: 0,
            centerY: i
        }).to({
            alpha: 1,
            centerY: i
        }, T).to({
            alpha: 1,
            centerY: n
        }, I, p.trigo, x).to({
            alpha: 0,
            centerY: n
        }, T).to({
            alpha: 0,
            centerY: n
        }, I).start(e || !0),
        this
    }
    ,
    n.prototype.stop = function() {
        this.tween.stop()
    }
    ,
    n.prototype.render = function() {
        var e = this.renderer;
        e.save(),
        e.translate(this._x, this._y),
        e.rotate(this._rotation),
        e.translate(-this._centerX, -this._centerY),
        e.multiplyColor(this.tint[0], this.tint[1], this.tint[2], this.tint[3]),
        e.drawImage(this.texture, 0, 0, this.w, this.h),
        e.restore()
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        return [-this._centerX, this.w - this._centerX, -this._centerY, this.h - this._centerY]
    }
    ,
    t.addArrow = s;
    var M = new f
      , N = new f;
    t.removeArrows = a,
    t.addArrowsSequence = l,
    t.addArrowsOneShot = c
}
, function(e, t, i) {
    var n = i(6)
      , o = i(249)
      , s = i(248)
      , a = {
        up: 0,
        down: 180 * Math.PI / 180
    }
      , r = {
        pingIcon: "ping_Icon",
        mp: "btn_DeplaceToi",
        warning: "btn_Attention",
        stop: "btn_Stop",
        attack: "btn_Attaque",
        move: "btn_Deplace",
        heal: "btn_Soigne",
        boost: "btn_Boost",
        tackle: "btn_Entrave",
        valid: "btn_Valide"
    }
      , l = {};
    t.addPingPicto = function(e, t, i, c) {
        if (!r[c])
            return void console.error("[IsoEngine.addPingPicto] No base for type", c);
        var u = new s({
            layer: n.MAP_LAYER_ICONS,
            x: t.x,
            y: t.y,
            scene: window.isoEngine.mapScene
        })
          , h = new s({
            layer: n.MAP_LAYER_ICONS,
            x: t.x,
            y: t.y,
            scene: window.isoEngine.mapScene
        });
        o.loadAnimationManager(u, "embedded", "ping", function(e) {
            e.assignSymbol({
                base: r.pingIcon,
                direction: -1
            }, !1)
        }),
        o.loadAnimationManager(h, "embedded", "ping", function(e) {
            e.assignSymbol({
                base: r[c],
                direction: -1
            }, !1)
        }),
        l[e] = {
            back: u,
            front: h
        };
        var d = 70
          , p = 0;
        u.rotation = a.up;
        var m = window.isoEngine.actorManager.occupiedCells[i] || [];
        if (m.length > 0) {
            var f = m[0].bbox;
            p = f ? f[2] - t.y : -100,
            p -= d,
            t.y + p < 0 && (p = f ? f[3] - t.y : 100,
            p += d,
            u.rotation = a.down)
        } else
            p = -d,
            t.y + p < 0 && (p = d,
            u.rotation = a.down);
        u.y = t.y + p,
        h.y = t.y + p,
        window.isoEngine.mapRenderer.addCellHighlight(e, [i], window.gui.pingSystem.PING_CELL_COLOR)
    }
    ,
    t.removePingPicto = function(e) {
        window.isoEngine.mapRenderer.deleteCellHighlight(e);
        var t = l[e];
        return t ? (t.back && t.back.remove(),
        t.front && t.front.remove(),
        void delete l[e]) : void console.warn("IsoEngine removePing: There no ping picto with the id", e)
    }
    ,
    t.removeAllPingPictos = function() {
        for (var e in l)
            l.hasOwnProperty(e) && t.removePingPicto(e)
    }
}
, function(e, t, i) {
    function n(e, t) {
        if (t = t || {},
        this.id = null ,
        this.outline = t.outline || !1,
        this.color = t.color,
        this.data = t.data || null ,
        this.gfx = null ,
        this._boxBatch = null ,
        this._lineBatch = null ,
        !this.outline && !this.color)
            return void console.error("[Zone] It is not possible to create a zone without colors and outline");
        if (this.outline) {
            var i = s.getZoneOutlines(e);
            this._lineBatch = new l({
                scene: window.isoEngine.mapScene,
                x: 0,
                y: 0,
                position: 5,
                lines: i,
                lineWidth: 4,
                hue: r.anyToColorArray(this.outline),
                layer: a.MAP_LAYER_BACKGROUND,
                id: "zoneOutline" + f++
            })
        }
        if (this.color) {
            for (var n = [], h = 0; h < e.length; h++) {
                var g = o.cellCoord[e[h]]
                  , _ = u
                  , v = g.x
                  , y = g.y - _;
                n.push({
                    x0: v,
                    y0: y,
                    x1: v + p,
                    y1: y + m,
                    x2: v,
                    y2: y + d,
                    x3: v - p,
                    y3: y + m
                })
            }
            this._boxBatch = new c({
                scene: window.isoEngine.mapScene,
                x: 0,
                y: 0,
                position: 1,
                boxes: n,
                hue: r.anyToColorArray(this.color),
                layer: a.MAP_LAYER_BACKGROUND,
                id: "zoneColor" + f++
            })
        }
    }
    var o = i(614)
      , s = i(1023)
      , a = i(6)
      , r = i(247)
      , l = i(843)
      , c = i(844)
      , u = a.GRID_ALTITUDE_OFFSET
      , h = a.CELL_WIDTH
      , d = a.CELL_HEIGHT
      , p = h / 2
      , m = d / 2
      , f = 1;
    e.exports = n,
    n.prototype.destroy = function() {
        null !== this.gfx && this.gfx.remove(),
        this._lineBatch && (this._lineBatch.remove(),
        this._lineBatch = null ),
        this._boxBatch && (this._boxBatch.remove(),
        this._boxBatch = null )
    }
}
, function(e, t, i) {
    function n(e) {
        var t = y * (e[0] - f)
          , i = y * e[1]
          , n = (t + i) / w + g
          , o = (i - t) / b + _;
        return n = ~~Math.round(n),
        o = ~~Math.round(2 * o) / 2 - u,
        {
            x: n,
            y: o
        }
    }
    function o(e, t) {
        t[e] ? delete t[e] : t[e] = !0
    }
    function s(e, t) {
        var i = r.getMapPointFromCellId(e);
        o(i.x + ":" + i.y + ":H", t),
        o(i.x + 1 + ":" + i.y + ":V", t),
        o(i.x + ":" + (i.y + 1) + ":H", t),
        o(i.x + ":" + i.y + ":V", t)
    }
    function a(e) {
        for (var t = {}, i = 0; i < e.length; i++)
            s(e[i], t);
        t = Object.keys(t);
        for (var o = [], a = 0; a < t.length; a++) {
            var r = t[a].split(":");
            r[0] = ~~r[0],
            r[1] = ~~r[1];
            var l = n(r);
            "H" === r[2] ? r[0] += 1 : r[1] += 1;
            var u = n(r);
            o.push(new c(l.x,l.y,u.x,u.y))
        }
        return o
    }
    var r = i(626)
      , l = i(6)
      , c = i(841)
      , u = l.GRID_ALTITUDE_OFFSET
      , h = l.CELL_WIDTH
      , d = l.CELL_HEIGHT
      , p = .325
      , m = 1.338
      , f = 20.225
      , g = l.HORIZONTAL_OFFSET - h / 2 - p
      , _ = l.VERTICAL_OFFSET - d / 2 - m
      , v = Math.sqrt(2)
      , y = v / 2
      , w = v / h
      , b = v / d;
    e.exports.getZoneOutlines = a
}
, function(e, t, i) {
    function n(e) {
        l.call(this, e, e.scene.renderer.getEmptyTexture()),
        this.zones = [],
        this.displayGrid = !1,
        this.tacticalMode = !1,
        this.isFightMode = !1,
        this.gridLines = null ,
        this.tacticalBoxes = null ,
        this.gridAnimator = null ,
        this.isDebugMode = !1
    }
    function o(e, t) {
        var i = window.foreground.convertScreenToCanvasCoordinate(e, t)
          , n = window.isoEngine.mapScene.convertCanvasToSceneCoordinate(i.x, i.y);
        return window.isoEngine.mapRenderer.getCellId(n.x, n.y)
    }
    var s = i(6)
      , a = i(614)
      , r = i(26).inherits
      , l = i(619)
      , c = i(841)
      , u = i(842)
      , h = i(843)
      , d = i(844)
      , p = i(1025)
      , m = i(1029)
      , f = i(261).Tween
      , g = i(1030)
      , _ = s.CELL_WIDTH
      , v = s.CELL_HEIGHT
      , y = s.GRID_ALTITUDE_OFFSET
      , w = s.MAP_LAYER_BACKGROUND
      , b = _ / 2
      , C = v / 2
      , I = [0, 0, 0, 1]
      , T = [.569, .522, .38, 1]
      , S = [.8, .8, .8, .8];
    r(n, l),
    e.exports = n,
    n.prototype.resetAndClear = function() {
        this.displayGrid = !1,
        this.isFightMode = !1
    }
    ,
    n.prototype.clear = function() {
        this.texture ? (this.texture.release(),
        this.texture = null ) : console.warn("[Background.clear] Clearing background although no texture was ever set")
    }
    ,
    n.prototype.releaseMap = function() {
        this.deleteAllZones(),
        this.gridLines && (this.gridLines.remove(),
        this.gridLines = null )
    }
    ,
    n.prototype.updateMap = function(e) {
        this._cleared = !1,
        this.texture = e,
        this.show(),
        this.gridLines || this.generateWalkableGrid()
    }
    ,
    n.prototype.changeGameContext = function(e) {
        this.isFightMode = e,
        this.generateWalkableGrid()
    }
    ,
    n.prototype.toggleGrid = function(e) {
        if (this.displayGrid !== e && (this.displayGrid = e,
        null !== this.gridLines))
            if (e)
                this.gridLines.show(),
                f(this.gridLines, ["alpha"]).to({
                    alpha: 1
                }, 20).start();
            else {
                var t = this;
                f(this.gridLines, ["alpha"]).to({
                    alpha: 0
                }, 15).start().onFinish(function() {
                    t.gridLines && t.gridLines.hide()
                })
            }
    }
    ,
    n.prototype.toggleTacticMode = function(e) {
        null !== this.tacticalBoxes && (e ? (this.tacticalBoxes.show(),
        this.tacticalBackground.show(),
        this.hide()) : (this.tacticalBoxes.hide(),
        this.tacticalBackground.hide(),
        this.show())),
        this.tacticalMode = e
    }
    ,
    n.prototype.generateWalkableGrid = function() {
        this.gridAnimator || (this.gridAnimator = new p);
        var e = window.isoEngine.mapRenderer;
        if (e.map && e.map.cells) {
            for (var t = e.map.cells, i = !this.isFightMode, n = {}, o = [], r = [], l = 0; l < s.NB_CELLS; l++) {
                var m = e.isWalkable(l, this.isFightMode);
                if (m) {
                    var g = t[l]
                      , A = a.cellCoord[l]
                      , E = (i && g.f || 0) + y
                      , x = A.x
                      , M = x - b
                      , N = x + b
                      , R = A.y - E
                      , O = R + C
                      , P = R + v
                      , D = x + "." + R + "-" + N + "." + O
                      , L = x + "." + P + "-" + N + "." + O
                      , B = x + "." + P + "-" + M + "." + O
                      , k = x + "." + R + "-" + M + "." + O;
                    void 0 === n[D] && (n[D] = !0,
                    r.push(new c(x,R,N,O))),
                    void 0 === n[L] && (n[L] = !0,
                    r.push(new c(N,O,x,P))),
                    void 0 === n[B] && (n[B] = !0,
                    r.push(new c(x,P,M,O))),
                    void 0 === n[k] && (n[k] = !0,
                    r.push(new c(M,O,x,R)));
                    var F = new u(x,R,N,O,x,P,M,O);
                    F.cellId = l,
                    o.push(F)
                }
            }
            this.gridLines && this.gridLines.remove(),
            this.tacticalBackground && this.tacticalBackground.remove(),
            this.tacticalBoxes && this.tacticalBoxes.remove(),
            this.gridLines = new h({
                scene: window.isoEngine.mapScene,
                x: 0,
                y: 0,
                position: 3,
                lines: r,
                lineWidth: 2,
                hue: S,
                layer: w,
                id: "combatGrid"
            }),
            this.gridLines.alpha = 0,
            this.displayGrid ? (this.gridLines.show(),
            f(this.gridLines, ["alpha"]).to({
                alpha: 1
            }, 20).start()) : this.gridLines.hide(),
            this.tacticalBackground = new d({
                scene: window.isoEngine.mapScene,
                x: 0,
                y: 0,
                position: -4,
                boxes: [new u((-_),(-v),(-_),this.h,this.w,this.h,this.w,(-v))],
                hue: I,
                layer: w,
                id: "tacticalBackground"
            }),
            this.tacticalBoxes = new d({
                scene: window.isoEngine.mapScene,
                x: 0,
                y: 0,
                position: -3,
                boxes: o,
                hue: T,
                layer: w,
                id: "tacticalBoxes"
            }),
            this.tacticalMode || (this.tacticalBoxes.hide(),
            this.tacticalBackground.hide()),
            this.isDebugMode && (this.initDebugOverlay(),
            this.cellIdOverlay.clear(),
            this.cellIdOverlay.generateOverlay())
        }
    }
    ,
    n.prototype.setGridColor = function(e) {
        this.gridLines.hue = e
    }
    ,
    n.prototype.initDebugOverlay = function() {
        if (!this.cellIdOverlay) {
            var e = {
                scene: this.scene,
                layer: s.MAP_LAYER_FOREGROUND,
                position: 1,
                x: -s.HORIZONTAL_OFFSET,
                y: -s.VERTICAL_OFFSET,
                w: s.MAP_SCENE_WIDTH,
                h: s.MAP_SCENE_HEIGHT,
                id: "cellIdOverlay"
            };
            this.cellIdOverlay = new g(e)
        }
    }
    ,
    n.prototype.toggleDebugMode = function(e) {
        this.isDebugMode = !this.isDebugMode,
        this.initDebugOverlay(),
        this.isDebugMode ? this.cellIdOverlay.generateOverlay(e) : this.cellIdOverlay.clear()
    }
    ,
    n.prototype.highlightDebugCells = function(e, t) {
        this.isDebugMode && this.cellIdOverlay && this.cellIdOverlay.colorCells(e, t)
    }
    ,
    n.prototype.deleteAllZones = function() {
        for (var e = 0; e < this.zones.length; e++)
            this.zones[e].destroy();
        this.zones = []
    }
    ,
    n.prototype.addZone = function(e, t) {
        this.zones.push(e),
        e.id = t
    }
    ,
    n.prototype.deleteZone = function(e) {
        e.destroy();
        var t = this.zones.indexOf(e);
        return t === -1 ? console.warn("Removing a non existing zone") : void this.zones.splice(t, 1)
    }
    ,
    n.prototype.deleteZoneById = function(e, t) {
        for (var i = 0; i < this.zones.length; )
            this.zones[i].id === e ? (t && t(this.zones[i]),
            this.zones[i].destroy(),
            this.zones.splice(i, 1)) : i++
    }
    ,
    n.prototype.getDataOfZoneId = function(e) {
        for (var t = 0; t < this.zones.length; t++)
            if (this.zones[t].id === e)
                return this.zones[t].data;
        return null
    }
    ;
    var A = 10;
    n.prototype.colorCurrentDragCell = function(e, t, i) {
        if (i.data) {
            var n = window.foreground.convertScreenToCanvasCoordinate(e, t - A)
              , o = window.isoEngine.mapScene.convertCanvasToSceneCoordinate(n.x, n.y)
              , s = window.isoEngine.mapRenderer.getCellId(o.x, o.y)
              , a = s.cell;
            window.isoEngine.cellHover(a, i.data.id)
        }
    }
    ,
    n.prototype.dragCellRelease = function(e, t, i) {
        if (this.isFightMode) {
            if (!i.data)
                return;
            var n = o(e, t - A);
            window.isoEngine.cellHoverRelease(n.cell)
        }
    }
    ,
    n.prototype.addGridAnimation = function(e) {
        return this.gridAnimator.addGridAnimation(e)
    }
    ,
    n.prototype.removeGridLayer = function(e) {
        this.gridAnimator ? this.gridAnimator.removeGridLayer(e) : this.gridAnimator = new p
    }
    ;
    var E = [];
    n.prototype.addTargetHighLights = function(e, t, i, n, o, s) {
        var a = new m(e,t,i);
        E.push(a),
        a.animate(n, o),
        s && a.hide()
    }
    ,
    n.prototype.removeTargetHighlights = function() {
        E.forEach(function(e) {
            e.stopped === !1 && (e.stop(),
            e.remove())
        }),
        E = []
    }
    ,
    n.prototype.hideTargetHighlights = function() {
        E.forEach(function(e) {
            e.hide()
        })
    }
    ,
    n.prototype.showTargetHighlights = function() {
        E.forEach(function(e) {
            e.show()
        })
    }
}
, function(e, t, i) {
    function n() {
        this._gridOverlay = new o,
        this._gridOverlay.hide(),
        this._layers = new a,
        this._layersBeingRemoved = new a
    }
    var o = i(1026)
      , s = i(1028)
      , a = i(252)
      , r = i(65)
      , l = i(66);
    e.exports = n,
    n.prototype.addGridAnimation = function(e) {
        if (0 === Object.keys(e).length)
            return console.error("Trying to add animation with no cells!"),
            null ;
        this._gridOverlay.show();
        var t = new s(e,this._gridOverlay);
        return t.playAnimation(),
        t._listReference = this._layers.addFront(t),
        this._resetBoundingBox(),
        t
    }
    ,
    n.prototype.removeGridLayer = function(e) {
        if (e) {
            this._layers.removeByReference(e._listReference),
            e._listReference = null ;
            for (var t, i, n = e.cellInfos, o = Object.keys(n), a = {}, c = this._layers.first; null !== c; c = c.next)
                for (t = 0; t < o.length; t++)
                    i = o[t],
                    c.object.cellInfos[i] && void 0 === a[i] && (a[i] = c.object.cellInfos[i]);
            for (t = 0; t < o.length; t++) {
                i = o[t];
                var u = n[i];
                void 0 === a[i] && (a[i] = new r(i,u.distanceToPlayer,l.empty))
            }
            e._listReference = this._layersBeingRemoved.add(e);
            var h = this
              , d = new s(a,this._gridOverlay);
            d.playAnimation(function() {
                h._resetBoundingBox(),
                h._layersBeingRemoved.removeByReference(e._listReference),
                e._listReference = null
            })
        }
    }
    ,
    n.prototype._resetBoundingBox = function() {
        this._gridOverlay._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)];
        for (var e = this._layersBeingRemoved.first; null !== e; e = e.next)
            this._expandToFitBox(e.object);
        if (0 === this._layers.length)
            this._gridOverlay.hide();
        else
            for (this._layers.length > 64 && console.error("layers are likely leaking"),
            e = this._layers.first; null !== e; e = e.next)
                this._expandToFitBox(e.object)
    }
    ,
    n.prototype.clear = function() {
        this._layers.clear()
    }
    ,
    n.prototype._expandToFitPoint = function(e, t) {
        var i = this._gridOverlay._bbox;
        i[0] > e && (i[0] = e),
        i[2] > t && (i[2] = t),
        i[1] < e && (i[1] = e),
        i[3] < t && (i[3] = t)
    }
    ,
    n.prototype._expandToFitBox = function(e) {
        var t = this._gridOverlay._bbox
          , i = e.bbox[0] - 43;
        i < t[0] && (t[0] = i);
        var n = e.bbox[1] + 43;
        n > t[1] && (t[1] = n);
        var o = e.bbox[2] - 22;
        o < t[2] && (t[2] = o);
        var s = e.bbox[3] + 22;
        s > t[3] && (t[3] = s)
    }
}
, function(e, t, i) {
    function n() {
        var e = {
            scene: window.isoEngine.mapScene,
            position: 1,
            hue: [0, 0, 0, 0],
            layer: -1,
            id: "gridFeedbackOverlay"
        };
        s.call(this, e),
        this._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this._boxByteSize = this.renderer.getNbBytesPerBox(),
        this.createGrid(),
        this.forceRefresh(),
        this._updated = !1
    }
    var o = i(1027)
      , s = i(244)
      , a = i(26).inherits
      , r = i(6)
      , l = i(614)
      , c = i(842)
      , u = r.CELL_WIDTH
      , h = r.CELL_HEIGHT
      , d = u / 2
      , p = h / 2;
    a(n, s),
    e.exports = n,
    n.prototype.createGrid = function() {
        this.spriteBoxes = [],
        this._vertexBuffer = new ArrayBuffer(r.NB_CELLS * this._boxByteSize);
        for (var e = 0; e < r.NB_CELLS; e++) {
            var t = l.cellCoord[e]
              , i = t.x
              , n = i - d
              , s = i + d
              , a = t.y - r.GRID_ALTITUDE_OFFSET
              , u = a + p
              , m = a + h
              , f = new c(i,a,s,u,i,m,n,u)
              , g = e * this._boxByteSize
              , _ = new Float32Array(this._vertexBuffer,g,this._boxByteSize / 4)
              , v = new Uint32Array(this._vertexBuffer,g,this._boxByteSize / 4)
              , y = new o(e,f,_,v,this);
            this.spriteBoxes[y.cellId] = y
        }
    }
    ,
    n.prototype._expandToFitPoint = function(e, t) {
        this._bbox[0] > e && (this._bbox[0] = e),
        this._bbox[1] < e && (this._bbox[1] = e),
        this._bbox[2] > t && (this._bbox[2] = t),
        this._bbox[3] < t && (this._bbox[3] = t)
    }
    ,
    n.prototype._expandToFitBox = function(e) {
        this._expandToFitPoint(e.x0, e.y0),
        this._expandToFitPoint(e.x1, e.y1),
        this._expandToFitPoint(e.x2, e.y2),
        this._expandToFitPoint(e.x3, e.y3)
    }
    ,
    n.prototype.draw = function() {
        this.renderer.drawBoxBatch(this.id)
    }
    ,
    n.prototype.render = function() {
        this.renderer.save(),
        this.draw(this.renderer),
        this.renderer.restore()
    }
    ,
    n.prototype.remove = function() {}
    ,
    n.prototype.generateCurrentFrameData = function() {
        this._updated && (this.renderer.releaseBuffer(this.id),
        this._updated = !1);
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this.id
              , i = !1;
            this.renderer.loadSpriteBuffer(t, this._vertexBuffer, null , this._bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t, i) {
    function n(e, t, i, n, s) {
        this._cellId = e;
        var r = a.empty;
        this.r = r.r,
        this.g = r.g,
        this.b = r.b,
        this.a = r.a,
        this.sx = r.sx,
        this.sy = r.sy,
        this.rotation = 0,
        this.gridOverlay = s,
        this._translateX = t.x0,
        this._translateY = t.y1,
        this._box = t,
        this._vertexBuffer = i,
        this._colorBuffer = n,
        this._restore(),
        this._translate(),
        this._fillVertexBuffer(),
        this.tween = new o(this,["sx", "sy", "r", "g", "b", "a"]);
        var l = this;
        this.tween.onUpdate(function() {
            l.setBuffer()
        }),
        this._transformState = a.empty
    }
    var o = i(261).Tween
      , s = i(261).easing
      , a = i(66);
    e.exports = n,
    Object.defineProperty(n.prototype, "cellId", {
        get: function() {
            return this._cellId
        }
    }),
    n.prototype.animate = function(e, t) {
        this._transformState = e;
        var i = 11;
        return this.tween.reset().wait(t).to(e, i, s.backOut, 2.3).start(),
        t + i
    }
    ,
    n.prototype._restore = function() {
        this._x0 = 0,
        this._y0 = -21.5,
        this._x1 = -43,
        this._y1 = 0,
        this._x2 = 0,
        this._y2 = 21.5,
        this._x3 = 43,
        this._y3 = 0
    }
    ,
    n.prototype._translate = function() {
        this._x0 += this._translateX,
        this._x1 += this._translateX,
        this._x2 += this._translateX,
        this._x3 += this._translateX,
        this._y0 += this._translateY,
        this._y1 += this._translateY,
        this._y2 += this._translateY,
        this._y3 += this._translateY
    }
    ,
    n.prototype._rotate = function() {
        if (0 !== this.rotation) {
            var e = Math.cos(this.rotation)
              , t = Math.sin(this.rotation)
              , i = this._x0
              , n = this._x1
              , o = this._x2
              , s = this._x3;
            this._x0 = e * i - t * this._y0,
            this._y0 = t * i + e * this._y0,
            this._x1 = e * n - t * this._y1,
            this._y1 = t * n + e * this._y1,
            this._x2 = e * o - t * this._y2,
            this._y2 = t * o + e * this._y2,
            this._x3 = e * s - t * this._y3,
            this._y3 = t * s + e * this._y3
        }
    }
    ,
    n.prototype._scale = function() {
        this._x0 *= this.sx,
        this._x1 *= this.sx,
        this._x2 *= this.sx,
        this._x3 *= this.sx,
        this._y0 *= this.sy,
        this._y1 *= this.sy,
        this._y2 *= this.sy,
        this._y3 *= this.sy
    }
    ,
    n.prototype.setBuffer = function() {
        this._restore(),
        this._scale(),
        this._rotate(),
        this._translate(),
        this._fillVertexBuffer(),
        this.gridOverlay._updated = !0,
        this.gridOverlay.forceRefresh()
    }
    ,
    n.prototype._fillVertexBuffer = function() {
        var e = Math.max(-128, Math.min(127, 64 * this.r))
          , t = Math.max(-128, Math.min(127, 64 * this.g))
          , i = Math.max(-128, Math.min(127, 64 * this.b))
          , n = Math.max(-128, Math.min(127, 64 * this.a))
          , o = (n << 24 & 4278190080) + (i << 16 & 16711680) + (t << 8 & 65280) + (255 & e);
        this._vertexBuffer[0] = this._x0,
        this._vertexBuffer[1] = this._y0,
        this._colorBuffer[3] = o,
        this._vertexBuffer[5] = this._x1,
        this._vertexBuffer[6] = this._y1,
        this._colorBuffer[8] = o,
        this._vertexBuffer[10] = this._x2,
        this._vertexBuffer[11] = this._y2,
        this._colorBuffer[13] = o,
        this._vertexBuffer[15] = this._x2,
        this._vertexBuffer[16] = this._y2,
        this._colorBuffer[18] = o,
        this._vertexBuffer[20] = this._x3,
        this._vertexBuffer[21] = this._y3,
        this._colorBuffer[23] = o,
        this._vertexBuffer[25] = this._x0,
        this._vertexBuffer[26] = this._y0,
        this._colorBuffer[28] = o
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.cellInfos = e,
        this._gridOverlay = t,
        this.bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this._listReference = null
    }
    var o = i(261).Delay;
    e.exports = n,
    n.prototype.playAnimation = function(e) {
        for (var t = -(1 / 0), i = this._gridOverlay.spriteBoxes, n = Object.keys(this.cellInfos), s = 0; s < n.length; s++) {
            var a = n[s]
              , r = this.cellInfos[a]
              , l = i[a]
              , c = r.transformState;
            if (l.transformState !== c) {
                var u = l.animate(c, .6 * r.distanceToPlayer);
                t < u && (t = u),
                this._expandToFitBox(l)
            }
        }
        e && (t <= 0 ? e() : o(t, e).start())
    }
    ,
    n.prototype._expandToFitPoint = function(e, t) {
        this.bbox[0] > e && (this.bbox[0] = e),
        this.bbox[2] > t && (this.bbox[2] = t),
        this.bbox[1] < e && (this.bbox[1] = e),
        this.bbox[3] < t && (this.bbox[3] = t)
    }
    ,
    n.prototype._expandToFitBox = function(e) {
        this._expandToFitPoint(e._x0, e._y0),
        this._expandToFitPoint(e._x1, e._y1),
        this._expandToFitPoint(e._x2, e._y2),
        this._expandToFitPoint(e._x3, e._y3)
    }
}
, function(e, t, i) {
    function n(e, t, i) {
        var n = {
            scene: window.isoEngine.mapScene,
            position: 1,
            layer: a.MAP_LAYER_TARGET_INDICATOR,
            id: "lightColumn" + e,
            x: t,
            alpha: 0
        };
        o.call(this, n),
        this.red = 0,
        this.green = 0,
        this.blue = 0,
        this.stopped = !1,
        this._defineShape(i);
        var s = this;
        this._tween = new r(this,["scaleX", "scaleY", "red", "green", "blue", "alpha"]),
        this._tween.onUpdate(function() {
            var e = s.tint;
            e[0] = s.red,
            e[1] = s.green,
            e[2] = s.blue
        })
    }
    var o = i(244)
      , s = i(26).inherits
      , a = i(6)
      , r = i(261).Tween
      , l = i(261).easing;
    s(n, o),
    e.exports = n,
    n.prototype.draw = function() {
        this.renderer.drawBoxBatch(this.id)
    }
    ,
    n.prototype._defineShape = function(e) {
        this._x0 = 16,
        this._y0 = e,
        this._x1 = 23,
        this._y1 = -a.VERTICAL_OFFSET,
        this._x2 = -23,
        this._y2 = -a.VERTICAL_OFFSET,
        this._x3 = -16,
        this._y3 = e,
        this._x4 = 20,
        this._y4 = -a.VERTICAL_OFFSET,
        this._x5 = -20,
        this._y5 = -a.VERTICAL_OFFSET,
        this._bbox = [this._x2, this._x1, this._y1, this._y0];
        var t = this.renderer.getNbBytesPerVertex()
          , i = new ArrayBuffer(12 * t);
        this._vertexBuffer = new Float32Array(i),
        this._colorBuffer = new Uint32Array(i);
        var n = 1077952576
          , o = 4210752;
        this._vertexBuffer[0] = this._x0,
        this._vertexBuffer[1] = this._y0,
        this._colorBuffer[3] = o,
        this._vertexBuffer[5] = this._x1,
        this._vertexBuffer[6] = this._y1,
        this._colorBuffer[8] = o,
        this._vertexBuffer[10] = this._x4,
        this._vertexBuffer[11] = this._y4,
        this._colorBuffer[13] = n,
        this._vertexBuffer[15] = this._x0,
        this._vertexBuffer[16] = this._y0,
        this._colorBuffer[18] = o,
        this._vertexBuffer[20] = this._x4,
        this._vertexBuffer[21] = this._y4,
        this._colorBuffer[23] = n,
        this._vertexBuffer[25] = this._x5,
        this._vertexBuffer[26] = this._y5,
        this._colorBuffer[28] = n,
        this._vertexBuffer[30] = this._x0,
        this._vertexBuffer[31] = this._y0,
        this._colorBuffer[33] = o,
        this._vertexBuffer[35] = this._x5,
        this._vertexBuffer[36] = this._y5,
        this._colorBuffer[38] = n,
        this._vertexBuffer[40] = this._x3,
        this._vertexBuffer[41] = this._y3,
        this._colorBuffer[43] = o,
        this._vertexBuffer[45] = this._x2,
        this._vertexBuffer[46] = this._y2,
        this._colorBuffer[48] = o,
        this._vertexBuffer[50] = this._x3,
        this._vertexBuffer[51] = this._y3,
        this._colorBuffer[53] = o,
        this._vertexBuffer[55] = this._x5,
        this._vertexBuffer[56] = this._y5,
        this._colorBuffer[58] = n
    }
    ,
    n.prototype.animate = function(e, t) {
        var i = {
            scaleX: e.sx,
            scaleY: e.sy,
            red: e.r,
            green: e.g,
            blue: e.b,
            alpha: e.a
        }
          , n = {
            scaleX: t.sx,
            scaleY: t.sy,
            red: t.r,
            green: t.g,
            blue: t.b,
            alpha: t.a
        }
          , o = this;
        this._tween.reset().from({
            scaleX: e.sx / 2,
            scaleY: e.sy,
            red: e.r,
            green: e.g,
            blue: e.b,
            alpha: 0
        }, l.polyOut, 4).to(i, 6).onFinish(function() {
            this.stopped || o._tween.reset().from(i).to(n, 20, l.trigo, 1).start(!0)
        }).start()
    }
    ,
    n.prototype.stop = function() {
        this._tween.stop(),
        this.stopped = !0
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this.id
              , i = !1;
            this.renderer.loadSpriteBuffer(t, this._vertexBuffer, null , this._bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t, i) {
    function n(e) {
        r.call(this, e),
        this.indexText = document.createElement("canvas"),
        this.indexText.width = e.w,
        this.indexText.height = e.h,
        this.indexTextContext = this.indexText.getContext("2d"),
        this.indexTextContext.font = "20px Verdana",
        this.indexTextContext.fillStyle = "rgba(0,0,0,0.6)",
        this.indexTextContext.textAlign = "center"
    }
    var o = i(6)
      , s = i(614)
      , a = i(26).inherits
      , r = i(619)
      , l = o.CELL_WIDTH
      , c = o.CELL_HEIGHT
      , u = o.GRID_ALTITUDE_OFFSET
      , h = l / 2;
    a(n, r),
    e.exports = n,
    n.prototype.generateOverlay = function(e) {
        this._generateOverlay(e)
    }
    ,
    n.prototype._generateOverlay = function(e, t, i) {
        var n = window.isoEngine.mapRenderer;
        if (n.map && n.map.cells) {
            var a = n.map.cells;
            "string" == typeof e && (this.indexTextContext.fillStyle = e),
            this.indexTextContext.clearRect(0, 0, this.indexText.width, this.indexText.height);
            for (var r = 0; r < o.NB_CELLS; r++) {
                var l = n.isWalkable(r, window.background.isFightMode);
                if (l) {
                    var d = a[r]
                      , p = s.cellCoord[r]
                      , m = d.f ? d.f + u : u
                      , f = p.x
                      , g = p.y - m;
                    if (t && t.indexOf(r) >= 0) {
                        var _ = this.indexTextContext.fillStyle;
                        this.indexTextContext.fillStyle = i,
                        this.indexTextContext.fillText(r, f + h + 10, g + c),
                        this.indexTextContext.fillStyle = _
                    } else
                        this.indexTextContext.fillText(r, f + h + 10, g + c)
                }
            }
            this.texture && this.texture.release(),
            this.texture = window.isoEngine.mapScene.createTexture(this.indexText),
            this.show()
        }
    }
    ,
    n.prototype.clear = function() {
        this.texture ? (this.texture.release(),
        this.texture = null ) : console.warn("[CellIdOverlay.clear] Clearing CellIdOverlay although no texture was ever set"),
        this.hide()
    }
    ,
    n.prototype.colorCells = function(e, t) {
        this._generateOverlay(null , e, t)
    }
}
, function(e, t, i) {
    function n(e) {
        var t = this;
        o.prototype.actorManager = this,
        this.isoEngine = e.isoEngine,
        this.scene = e.scene,
        this.isTransparentModeOn = !1,
        this.isCreatureModeOn = !1,
        this.paused = !0,
        this.actors = {},
        this.occupiedCells = {},
        this.followers = [],
        this.customAnimMethods = {},
        this.userId = 0,
        this.userActor = new o({
            data: {
                _type: "GameRolePlayCharacterInformations"
            },
            scene: this.scene,
            actorManager: this
        }),
        this.userActor.setWhiteListedness(!0),
        this.isoEngine.on("GameFightSynchronizeMessage", function(e) {
            for (var i = e.fighters, n = 0, o = i.length; n < o; n++) {
                var s = i[n];
                if (s.alive) {
                    var a = s.contextualId
                      , r = t.getActor(a);
                    if (r) {
                        var l = s.disposition.cellId;
                        l === -1 || r.cellId === l || r.moving || r.setDisposition(l, null )
                    } else
                        t.addEmptyActor(s)
                }
            }
        }),
        this.isoEngine.on("GameContextCreateMessage", function(e) {
            e.context === l.ROLE_PLAY && t.cleanupActorAnimations()
        }),
        this.fighterIndicator = null ,
        this._onIdAdded = {}
    }
    var o = i(610)
      , s = i(25)
      , a = i(626)
      , r = i(625)
      , l = i(85)
      , c = i(6)
      , u = i(1032)
      , h = i(233)
      , d = i(614)
      , p = i(622)
      , m = i(1033)
      , f = .001
      , g = 1.5
      , _ = .38
      , v = .002
      , y = .5
      , w = .2;
    e.exports = n,
    n.prototype.removeInvisibilityOfAllActors = function() {
        var e = h.VISIBLE;
        this.userActor.setInvisibility(e);
        for (var t in this.actors)
            this.actors[t].setInvisibility(e)
    }
    ,
    n.prototype.cleanupActorAnimations = function() {
        this.userActor.cleanupAnimations();
        for (var e in this.actors)
            this.actors[e].cleanupAnimations()
    }
    ,
    n.prototype.isActorInvisible = function(e) {
        var t = this.getActor(e);
        return t.isInvisible
    }
    ,
    n.prototype.getActor = function(e) {
        var t = e === this.userId ? this.userActor : this.actors[e];
        return t
    }
    ,
    n.prototype.getActorFromNpcId = function(e) {
        var t = this.actors;
        for (var i in t) {
            var n = t[i]
              , o = n.data || {};
            if (o.npcId && (o.npcId === e || e === -1))
                return n
        }
        return null
    }
    ,
    n.prototype.getActorFromMonsterId = function(e) {
        var t = this.actors;
        for (var i in t) {
            var n = t[i]
              , o = n.data || {}
              , s = o.staticInfos;
            if (s && s.mainCreatureLightInfos && (s.mainCreatureLightInfos.creatureGenericId === e || e === -1))
                return n
        }
        return null
    }
    ,
    n.prototype.getActorData = function(e, t) {
        var i = this.getActor(e);
        return i ? t(null , i.data) : t(new Error("actorNotFound"))
    }
    ,
    n.prototype.pause = function() {
        this.paused = !0
    }
    ,
    n.prototype.unpause = function() {
        this.paused = !1
    }
    ,
    n.prototype.setUserCharacterData = function(e) {
        var t = e.id
          , i = e.entityLook;
        this.userId = t,
        this.userActor.actorId = t,
        this.userActor.actorManager = this,
        this.userActor.data.name = e.name,
        this.userActor.data.playerId = t,
        this.setActorLook(t, i)
    }
    ,
    n.prototype.switchUserActor = function(e) {
        if (this.userId !== e) {
            var t = this.getActor(e);
            if (!t)
                return console.error("switchUserActor: No actor with id", e);
            var i = !1;
            this.userActor.isDead ? i = !0 : this.actors[this.userId] = this.userActor,
            this.userId = e,
            this.userActor = t,
            delete this.actors[e],
            i || window.isoEngine.tryDisplayUserMovementZone()
        }
    }
    ,
    n.prototype.setActorLook = function(e, t, i, n) {
        var o = this.getActor(e);
        return o ? void (o.animated || (o.riderEntity = null ,
        o.setLook(t, {}, function() {
            var e = o.animManager;
            o.isFollower && (e.audioVol = w);
            var n = o.look;
            1 === n.bonesId && n.skins && n.skins[0] && u[n.skins[0]] && e.addAnimationModifier("AnimStatique", "AnimStatique" + n.skins[0]);
            var s = o.parentActor;
            if (s ? (s.carriedEntity.setAnimManager(e),
            s.staticAnim()) : o.staticAnim(),
            !t._icons)
                return i && i();
            for (var a = 0; a < t._icons.length; a++)
                o.addIcon(t._icons[a]);
            return i && i()
        }, n))) : (console.warn("setActorLook: No actor with id", e),
        i && i())
    }
    ,
    n.prototype.getIndexedVisibleActors = function() {
        var e = {};
        for (var t in this.actors)
            this.actors[t].isInvisible || (e[this.actors[t].cellId] = this.actors[t]);
        return e[this.userActor.cellId] = this.userActor,
        e
    }
    ,
    n.prototype.removeAllActors = function() {
        this.cleanupActorAnimations();
        for (var e in this.actors)
            this.actors[e].removeTeamCircle(),
            this.actors[e].remove();
        this.actors = {},
        this.occupiedCells = {},
        this.followers = [],
        this.customAnimMethods = {}
    }
    ,
    n.prototype.updateMapInfoData = function(e) {
        var t = this.userActor;
        if (t.show(),
        this.isoEngine.gameContext !== l.FIGHT) {
            var i, n, o, s = e.actors, a = s.length, r = 0;
            for (i = 0; i < a; i++) {
                o = s[i],
                n = this.getActor(o.contextualId),
                n || (r += 1);
                var c = o.staticInfos && o.staticInfos.underlings;
                r += c ? c.length : 0
            }
            for (this.checkCreatureMode(r),
            i = 0; i < a; i++) {
                o = s[i];
                var u = o.contextualId;
                u === this.userId && (t.removeIcons(),
                this.isoEngine.userPreviousPosition = o.disposition.cellId),
                n = this.getActor(u),
                n ? n.updateData(o) : n = this.addEmptyActor(o),
                this.setActorLook(u, o.look),
                o.staticInfos && o.staticInfos.underlings && this.addActorFollowers(n, o.staticInfos.underlings),
                "GameRolePlayNpcWithQuestInformations" === o._type && n.addQuestIcon(o.questFlag)
            }
        }
    }
    ,
    n.prototype.updateQuestIcons = function(e) {
        if (e.mapId === this.isoEngine.mapRenderer.mapId) {
            for (var t, i = e.npcsIdsWithoutQuest, n = 0; n < i.length; n++)
                t = this.getActor(i[n]),
                t && t.removeQuestIcon();
            var o = e.npcsIdsWithQuest;
            for (n = 0; n < o.length; n++)
                t = this.getActor(o[n]),
                t && t.addQuestIcon(e.questFlags[n])
        }
    }
    ,
    n.prototype.addActor = function(e, t) {
        var i = this
          , n = e.contextualId
          , o = this.getActor(n);
        o ? o.updateData(e) : o = this.addEmptyActor(e),
        this.setActorLook(n, e.look, function() {
            e.staticInfos && e.staticInfos.underlings && i.addActorFollowers(o, e.staticInfos.underlings);
            var s = e.disposition && e.disposition.carryingCharacterId;
            if (s) {
                var a = i.getActor(s);
                a && a.carryCharacter(o)
            }
            return t && t(i.actors[n])
        });
        var s = o.getFighter();
        return window.gui.playerData.isFighting && !o.isFollower && s && o.addTeamCircle(),
        this.addedActor(o.actorId),
        o
    }
    ,
    n.prototype.addEmptyActor = function(e) {
        var t = e.contextualId
          , i = this.getActor(t);
        if (i)
            return i;
        var n = e.disposition
          , s = n.cellId
          , a = n.direction;
        return i = new o({
            actorId: t,
            position: s,
            cellId: s,
            direction: a,
            data: e,
            scene: this.scene,
            layer: this.isTransparentModeOn ? c.MAP_LAYER_TRANSPARENT : c.MAP_LAYER_PLAYGROUND,
            alpha: this.isTransparentModeOn ? c.TRANSPARENT_MODE_ALPHA : 1,
            actorManager: this
        }),
        this.actors[t] = i,
        i.setDisposition(s, a),
        i
    }
    ,
    n.prototype.removeActor = function(e) {
        var t, i = this;
        if (e === this.userId) {
            if (t = this.userActor,
            !t.isDead)
                return
        } else
            t = this.actors[e];
        return t ? t.moving ? void t.pathTween.onceFinish(function() {
            i.removeActor(e)
        }) : void t.remove() : console.warn("[ACTOR MANAGER] removeActor: actor not found", e)
    }
    ,
    n.prototype._removeActor = function(e) {
        e.fighterIndicator && e.fighterIndicator.remove(),
        e.removeTurnNumber();
        var t = e.actorId;
        if (this.removeActorOccupation(e),
        this.customAnimMethods[t] && delete this.customAnimMethods[t],
        e.removeTeamCircle(),
        delete this.actors[t],
        e.followers) {
            for (var i = e.followers, n = [], o = 0; o < i.length; o++) {
                var s = i[o];
                n.push(s.actorId);
                var a = this.followers.indexOf(s);
                a !== -1 && this.followers.splice(a, 1)
            }
            this.removeActors(n)
        }
    }
    ,
    n.prototype.removeActors = function(e) {
        for (var t = 0, i = e.length; t < i; t++)
            this.removeActor(e[t])
    }
    ,
    n.prototype.resetActors = function() {
        this.removeAllActors(),
        this.userActor.show()
    }
    ,
    n.prototype.actorMovement = function(e, t) {
        var i = e.actorId
          , n = e.keyMovements
          , o = n[n.length - 1]
          , s = window.isoEngine;
        if (s.gameContext === l.ROLE_PLAY && i === this.userId)
            return s.roleplayUserActorMovement(n);
        var a = this.getActor(i);
        return a ? (a.setCellPosition(o),
        this.paused ? (a.position = o,
        t && t()) : (2 === n.length && (n = r.normalizePath(n)),
        n.length > 1 ? void (this.isoEngine.mapRenderer.isReady ? a.setPath(n, {
            slide: e.slide,
            cb: t
        }) : a.setDisposition(o)) : t && t())) : (this.addEmptyActor({
            contextualId: i,
            disposition: {
                cellId: o,
                direction: 1
            }
        }),
        t && t())
    }
    ,
    n.prototype.setActorsDisposition = function(e, t) {
        for (var i = 0, n = e.length; i < n; i++) {
            var o = e[i];
            if (o.cellId !== -1) {
                var s = o.id
                  , a = this.getActor(s);
                if (!a) {
                    if (t)
                        continue;
                    if (!o.cellId && 0 !== o.cellId)
                        continue;
                    var r = window.gui.fightManager.getFighter(s);
                    if (r && r.data && !r.data.alive)
                        continue;
                    a = this.addEmptyActor({
                        contextualId: s,
                        disposition: o
                    })
                }
                a.cellId === o.cellId && a.direction === o.direction || a.setDisposition(o.cellId, o.direction)
            }
        }
    }
    ,
    n.prototype.removeActorOccupation = function(e) {
        var t = e.cellId;
        if (null !== t) {
            var i = this.occupiedCells[t];
            if (void 0 === i)
                return;
            var n = i.indexOf(e);
            n === -1 ? console.warn("[ActorManager.removeActorOccupation] Trying to remove an actor from an empty cell", e) : 1 === i.length ? delete this.occupiedCells[t] : i.splice(n, 1)
        }
    }
    ,
    n.prototype.addActorOccupation = function(e) {
        var t = e.cellId
          , i = this.occupiedCells[t];
        if (void 0 === i)
            this.occupiedCells[t] = [e];
        else {
            var n = i.indexOf(e);
            n === -1 ? i.push(e) : console.warn("[ActorManager.addActorOccupation] Trying to add an actor to a cell that it already belongs to", e)
        }
    }
    ,
    n.prototype.computeFollowerPosition = function(e) {
        var t = a.getMapPointFromCellId(e);
        t.i = t.x,
        t.j = t.y;
        for (var i = 1; Math.random() < i; ) {
            var n = r.getAccessibleCells(t.i, t.j)
              , o = n.length;
            if (0 === o)
                break;
            for (var s = [], l = 0, c = 0; c < o; c++) {
                var u = n[c]
                  , h = a.getCellIdFromMapPoint(u.i, u.j)
                  , d = void 0 === this.occupiedCells[h] ? 1 : f;
                s[c] = d,
                l += d
            }
            for (var p = 0, m = l * Math.random() - s[0]; m > 0 && p < o; )
                p += 1,
                m -= s[p];
            t = n[p === o ? p - 1 : p],
            e = a.getCellIdFromMapPoint(t.i, t.j),
            i = this.occupiedCells[e] ? .995 : .8
        }
        return e
    }
    ,
    n.prototype.addActorFollowers = function(e, t, i) {
        var n = t.length;
        if (0 !== n && s.showAllMonsters) {
            null === e.followers && (e.followers = []);
            for (var o = e.actorId, a = 0; a < n; a++) {
                var r = t[a]
                  , l = o + ":follower:" + a
                  , c = this.getActor(l);
                if (!c) {
                    var u = this.computeFollowerPosition(e.cellId);
                    c = this.addEmptyActor({
                        contextualId: l,
                        disposition: {
                            cellId: u,
                            direction: 1 + 2 * Math.round(3 * Math.random())
                        }
                    }),
                    c.isFollower = !0,
                    i === !0 ? c.isolationCoefficient = y : c.isolationCoefficient = v,
                    e.followers.push(c),
                    c.groupBoss = e,
                    c.data = e.data,
                    this.followers.push(c)
                }
                this.setActorLook(l, r.look)
            }
        }
    }
    ,
    n.prototype.addAnimBehaviourToActor = function(e, t) {
        var i = this.actors[e];
        return i ? this.customAnimMethods[e] ? console.warn("ActorManager.addAnimBehaviourToActor: actor " + e + " already has a custom animation") : this.followers.indexOf(i) !== -1 ? console.error(new Error("ActorManager.addAnimBehaviourToActor: cannot add an anim behaviour to a follower")) : "function" != typeof t ? console.error(new Error("ActorManager.addAnimBehaviourToActor: animationMethod is not a function")) : void (this.customAnimMethods[e] = t) : console.error(new Error("ActorManager.addAnimBehaviourToActor: actor " + e + " unknown"))
    }
    ,
    n.prototype._moveFollower = function(e) {
        if (e.moving !== !0) {
            var t = e.cellId
              , i = a.getMapPointFromCellId(t)
              , n = a.getMapPointFromCellId(e.groupBoss.cellId)
              , o = i.x
              , s = i.y
              , l = n.x - o
              , c = n.y - s
              , u = Math.sqrt(l * l + c * c);
            if (1 === this.occupiedCells[t].length) {
                var h = .95 / (1 + (u - 1) * e.isolationCoefficient);
                if (e.groupBoss.moving === !0 && (h *= .8),
                Math.random() < h)
                    return
            }
            for (var d, p = {
                i: i.x,
                j: i.y
            }, m = [t], _ = 1; Math.random() < _; ) {
                var v = r.getAccessibleCells(p.i, p.j)
                  , y = v.length;
                if (0 === y)
                    return;
                for (var w = [], b = 0, C = 0; C < y; C++) {
                    var I = v[C]
                      , T = a.getCellIdFromMapPoint(I.i, I.j)
                      , S = void 0 === this.occupiedCells[T] ? 1 : f
                      , A = I.i - p.i
                      , E = I.j - p.j;
                    S *= 0 === A && 0 === E ? f * f : 0 === A ? Math.pow(g, c / E) : Math.pow(g, l / A),
                    w[C] = S,
                    b += S
                }
                for (var x = 0, M = b * Math.random() - w[0]; M > 0 && x < y; )
                    x += 1,
                    M -= w[x];
                p = v[x === y ? x - 1 : x],
                d = a.getCellIdFromMapPoint(p.i, p.j),
                m.push(d),
                _ = 1 - 1 / (1 + .5 * u)
            }
            e.setCellPosition(d),
            e.setPath(m)
        }
    }
    ,
    n.prototype.refresh = function() {
        for (var e in this.customAnimMethods)
            this.customAnimMethods[e]();
        var t = this.followers.length;
        if (t > 0) {
            var i = Object.keys(this.actors).length;
            if (Math.random() > Math.min(.1, _ / i))
                return;
            for (var n = 0; n < t; n++)
                this._moveFollower(this.followers[n])
        }
    }
    ,
    n.prototype.updateActorsAggressableStatus = function(e, t) {
        for (var i = 0; i < e.length; i++) {
            var n = e[i]
              , o = t[i]
              , s = this.getActor(n);
            if (s && s.data.humanoidInfo && s.data.humanoidInfo.options)
                for (var a = s.data.humanoidInfo.options, r = 0; r < a.length; r++) {
                    var l = a[r];
                    if ("HumanOptionAlliance" === l._type) {
                        l.aggressable = o,
                        s.addConquestIcon(l);
                        break
                    }
                }
        }
    }
    ,
    n.prototype.addSmileyOnActor = function(e, t) {
        var i = this.getActor(e);
        i && i.addSmileyIcon(t)
    }
    ,
    n.prototype.setReadyIconOnActor = function(e, t) {
        void 0 === t && (t = !1);
        var i = this.getActor(e);
        i && (t ? i.addReadyIconOnActor() : i.removeReadyIconOnActor())
    }
    ,
    n.prototype.removeReadyIcon = function() {
        for (var e = Object.keys(this.actors), t = e.length, i = 0; i < t; i++) {
            var n = this.actors[e[i]];
            n.removeReadyIconOnActor()
        }
        this.userActor.removeReadyIconOnActor()
    }
    ,
    n.prototype.setTransparentMode = function(e) {
        if (this.isTransparentModeOn !== e) {
            var t, i;
            e ? (t = c.MAP_LAYER_TRANSPARENT,
            i = c.TRANSPARENT_MODE_ALPHA) : (t = c.MAP_LAYER_PLAYGROUND,
            i = 1);
            for (var n in this.actors) {
                var o = this.actors[n];
                o.layer = t,
                o.alpha = i
            }
            this.userActor.layer = t,
            this.userActor.alpha = i,
            this.isTransparentModeOn = e
        }
    }
    ,
    n.prototype.checkCreatureMode = function(e) {
        var t = Object.keys(this.actors).length + e + 1
          , i = s.maxActorsBeforeCreatureMode < t;
        this.setCreatureMode(i)
    }
    ,
    n.prototype.onMaxActorsBeforeCreatureModeChange = function(e) {
        var t = Object.keys(this.actors).length + 1
          , i = e < t;
        this.setCreatureMode(i)
    }
    ,
    n.prototype.setCreatureMode = function(e) {
        if (e !== this.isCreatureModeOn) {
            if (!e)
                return this._exitCreatureMode();
            this.isCreatureModeOn = !0;
            for (var t in this.actors) {
                var i = this.actors[t];
                i.setCreatureLook(),
                i.fighterIndicator && (i.fighterIndicator.y = i.bbox[2] - i.y)
            }
            this.userActor.setCreatureLook()
        }
    }
    ,
    n.prototype._exitCreatureMode = function() {
        if (this.isCreatureModeOn) {
            this.isCreatureModeOn = !1;
            for (var e in this.actors) {
                var t = this.actors[e];
                t.useRealLook(),
                t.fighterIndicator && (t.fighterIndicator.y = t.bbox[2] - t.y)
            }
            this.userActor.useRealLook()
        }
    }
    ,
    n.prototype.getPlayers = function(e) {
        var t = [];
        for (var i in this.actors) {
            var n = this.actors[i];
            n.data && (n.data.playerId || 0 === n.data.playerId) && t.push(n)
        }
        return e && t.push(this.userActor),
        t
    }
    ,
    n.prototype.turnIndicatorOff = function() {
        window.isoEngine.mapRenderer.removeMovementFeedback()
    }
    ,
    n.prototype.turnIndicatorOn = function(e) {
        this.turnIndicatorOff();
        var t = this.getActor(e.id);
        if (t) {
            var i = t.getFighterData().teamId
              , n = e.data.disposition.cellId;
            if (n !== -1 && window.isoEngine.mapRenderer.map) {
                var o = d.cellCoord[n];
                p.addTurnFeedback({
                    x: o.x,
                    y: o.y,
                    position: n
                }, i)
            }
        }
    }
    ,
    n.prototype.removeTeamCircles = function() {
        this.userActor.removeTeamCircle();
        for (var e = 0; e < this.actors.length; e++) {
            var t = this.actors[e];
            t.removeTeamCircle()
        }
    }
    ,
    n.prototype.selectionIndicatorOff = function(e) {
        var t = this.getActor(e.id);
        t && t.fighterIndicator && t.fighterIndicator.remove()
    }
    ,
    n.prototype.selectionIndicatorOn = function(e) {
        var t = this.getActor(e.id);
        t && (t.fighterIndicator && t.fighterIndicator.remove(),
        e.data.disposition.cellId !== -1 && (t.fighterIndicator = new m(t.x,t.bbox[2] - 12)))
    }
    ,
    n.prototype.removeAllFighterIndicators = function() {
        this.userActor.fighterIndicator && this.userActor.fighterIndicator.remove();
        for (var e = 0; e < this.actors.length; e++) {
            var t = this.actors[e];
            t.fighterIndicator && t.fighterIndicator.remove()
        }
    }
    ,
    n.prototype.turnNumberOn = function(e, t) {
        function i(e, i) {
            i || (i = e === o.userActor.actorId ? o.userActor : o.actors[e]),
            "" === t ? i.removeTurnNumber() : i.addTurnNumber(t)
        }
        var n, o = this;
        n = e === this.userActor.actorId ? this.userActor : this.actors[e],
        n ? i(e, n) : this._onIdAdded[e] = i
    }
    ,
    n.prototype.addedActor = function(e) {
        var t = this._onIdAdded[e];
        t && (t(e),
        delete this._onIdAdded[e])
    }
    ,
    n.prototype.allTurnNumbersOff = function() {
        for (var e in this.actors)
            this.actors[e].removeTurnNumber();
        this.userActor.removeTurnNumber()
    }
    ,
    n.prototype.refreshFighter = function(e) {
        var t = window.actorManager.getActor(e.informations.contextualId);
        if (t) {
            window.gui.transmitFightSequenceMessage(e),
            t.setDisposition(e.informations.disposition.cellId, e.informations.disposition.direction);
            var i = {};
            t.setLook(e.informations.look, i, function() {
                t.applyLook({
                    look: e.informations.look
                })
            })
        }
    }
}
, function(e, t) {
    e.exports = {
        10: !0,
        11: !0,
        20: !0,
        21: !0,
        30: !0,
        31: !0,
        40: !0,
        41: !0,
        50: !0,
        51: !0,
        60: !0,
        61: !0,
        70: !0,
        71: !0,
        80: !0,
        81: !0,
        90: !0,
        91: !0,
        100: !0,
        101: !0,
        110: !0,
        111: !0,
        120: !0,
        121: !0,
        1405: !0,
        1407: !0,
        1437: !0,
        1438: !0,
        1663: !0,
        1664: !0
    }
}
, function(e, t, i) {
    function n(e, t) {
        this.vertices = [{
            x: -40,
            y: 60,
            r: 1,
            g: 0,
            b: 0,
            a: 1
        }, {
            x: 40,
            y: 60,
            r: 1,
            g: 0,
            b: 0,
            a: 1
        }, {
            x: -30,
            y: 50,
            r: 1,
            g: 1,
            b: 0,
            a: .3
        }, {
            x: 30,
            y: 50,
            r: 1,
            g: 1,
            b: 0,
            a: .3
        }, {
            x: -40,
            y: 40,
            r: 1,
            g: 0,
            b: 0,
            a: 1
        }, {
            x: -30,
            y: 45,
            r: 1,
            g: 1,
            b: 0,
            a: .3
        }, {
            x: 30,
            y: 45,
            r: 1,
            g: 1,
            b: 0,
            a: .3
        }, {
            x: 40,
            y: 40,
            r: 1,
            g: 0,
            b: 0,
            a: 1
        }, {
            x: 0,
            y: 10,
            r: 1,
            g: 1,
            b: 0,
            a: .5
        }, {
            x: 0,
            y: 0,
            r: 1,
            g: 0,
            b: 0,
            a: 1
        }],
        this.triangles = [[1, 0, 2], [2, 0, 4], [4, 5, 2], [8, 5, 4], [4, 9, 8], [8, 9, 7], [7, 6, 8], [3, 6, 7], [7, 1, 3], [2, 3, 1], [3, 2, 5], [5, 6, 3], [5, 8, 6]];
        var i = {
            scene: window.isoEngine.mapScene,
            position: 1,
            layer: 1,
            x: e,
            y: t,
            id: "FighterIndicator" + u++
        };
        o.call(this, i),
        this._indicatorByteSize = this.renderer.getNbBytesPerVertex() * this.triangles.length * l,
        this.updated = !0,
        this.red = 1,
        this.green = 1,
        this.blue = 0,
        this.alpha = 1,
        this.sx = .4,
        this.sy = .4,
        this.rotation = Math.PI,
        this._buffer = new ArrayBuffer(this._indicatorByteSize),
        this._vertexBuffer = new Float32Array(this._buffer),
        this._colorBuffer = new Uint32Array(this._buffer),
        this.loadIndicator(),
        this.renderer.releaseBuffer(i.id),
        this.forceRefresh();
        var n = this
          , s = this.sx
          , c = this.sy
          , h = this.green
          , d = this.alpha;
        this.tween = new a(this,["scaleX", "scaleY", "green", "alpha"]).from({
            scaleX: s,
            scaleY: c,
            green: h,
            alpha: d
        }).to({
            scaleX: .25,
            scaleY: .25,
            green: .8,
            alpha: .7
        }, 7, r.sineIn).to({
            scaleX: s,
            scaleY: c,
            green: h,
            alpha: d
        }, 7, r.sineOut).onUpdate(function() {
            n.loadIndicator()
        }).start(!0)
    }
    var o = i(244)
      , s = i(26).inherits
      , a = i(261).Tween
      , r = i(261).easing
      , l = 3
      , c = 5
      , u = 0;
    s(n, o),
    e.exports = n,
    n.prototype.loadIndicator = function() {
        for (var e = 1 / 0, t = -(1 / 0), i = 1 / 0, n = -(1 / 0), o = 0; o < this.triangles.length; o++)
            for (var s = 0; s < l; s++) {
                var a = (o * l + s) * c
                  , r = this.vertices[this.triangles[o][s]]
                  , u = r.x
                  , h = r.y
                  , d = Math.max(-128, Math.min(127, 64 * r.r))
                  , p = Math.max(-128, Math.min(127, 64 * this.green))
                  , m = Math.max(-128, Math.min(127, 64 * r.b))
                  , f = Math.max(-128, Math.min(127, 64 * (this.alpha && r.a)))
                  , g = (f << 24 & 4278190080) + (m << 16 & 16711680) + (p << 8 & 65280) + (255 & d);
                this._vertexBuffer[a] = u,
                this._vertexBuffer[a + 1] = h,
                this._colorBuffer[a + 3] = g,
                e > u ? e = u : t < u && (t = u),
                i > h ? i = h : n < h && (n = h)
            }
        this._bbox = [e, t, i, n],
        this.updated = !0
    }
    ,
    n.prototype.render = function() {
        this.renderer.save(),
        this.renderer.translate(this._x, this._y),
        0 !== this._rotation && this.renderer.rotate(this._rotation),
        this.renderer.scale(this._scaleX, this._scaleY),
        this.updated && (this.renderer.drawBoxBatch(this.id),
        this.renderer.releaseBuffer(this.id),
        this.updated = !1,
        this.forceRefresh()),
        this.renderer.restore()
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this.id
              , i = !1;
            this.renderer.loadSpriteBuffer(t, this._vertexBuffer, null , this._bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
    ,
    n.prototype.remove = function() {
        this.tween && this.tween.stop(),
        o.prototype.remove.call(this)
    }
}
, function(e, t, i) {
    function n(e, t) {
        t.push(function(t) {
            return window.gui.transmitFightSequenceMessage(e),
            t()
        })
    }
    function o(e) {
        window.dofus.connectionManager.emit(e._messageType, e)
    }
    function s(e, t) {
        var i = window.actorManager.getActor(e.sourceId);
        i && t.push(function(t) {
            window.gui.transmitFightSequenceMessage(e),
            i.oneShootAnim({
                base: "AnimTacle"
            }, !0, t)
        })
    }
    function a(e, t) {
        if (e._spell)
            return n(e, t);
        var i = window.actorManager
          , o = i.getActor(e.targetId);
        t.push(function(t) {
            function n() {
                i.userActor.isDead || !window.gui.fightManager.isFightersTurn(i.userActor.actorId) || window.gui.fightManager.getIsTurnEndRequestPending() || window.isoEngine.displayUserMovementZone(),
                t()
            }
            return window.gui.transmitFightSequenceMessage(e),
            o ? void o.death(n) : (console.warn("Actor " + e.targetId + " not found."),
            t())
        })
    }
    function r(e, t) {
        t.push(function(t) {
            window.gui.transmitFightSequenceMessage(e),
            e._summon.show(),
            t()
        })
    }
    function l(e, t) {
        e._doNotProcess || t.push(function(t) {
            window.gui.transmitFightSequenceMessage(e);
            var i = window.actorManager.getActor(e.targetId);
            i.applyLook(e._loadedLook),
            t()
        })
    }
    function c(e, t) {
        t.push(function(t) {
            window.actorManager.refreshFighter(e),
            t()
        })
    }
    function u() {
        f = !0,
        g = !1,
        _ = !1,
        v = null ,
        y = !1,
        w = null ,
        b = []
    }
    function h() {
        return f ? (window.gui.transmitFightSequenceMessage({
            _messageType: "confirmTurnEnd"
        }),
        window.dofus.sendMessage("GameFightTurnReadyMessage", {
            isReady: !0
        }),
        void (g = !1)) : void (g = !0)
    }
    function d(e) {
        return f ? (v._synchronizeBuff = e,
        window.gui.transmitFightSequenceMessage(v),
        _ = !1,
        void (v = null )) : void (_ = !0)
    }
    function p() {
        return window.actorManager.removeAllFighterIndicators(),
        window.actorManager.allTurnNumbersOff(),
        f ? (window.gui.transmitFightSequenceMessage(w),
        y = !1,
        w = null ,
        void (window.actorManager.userActor.isDead = !1)) : void (y = !0)
    }
    function m(e) {
        function t() {
            f = !0;
            try {
                window.gui.transmitFightSequenceMessage({
                    _messageType: "sendAllFightEvent"
                })
            } catch (e) {
                console.error(e)
            }
            return b.length ? (_ && d(!1),
            m(b.shift())) : (window.dofus.sendMessage("GameActionAcknowledgementMessage", {
                valid: !0,
                actionId: s.actionId
            }),
            _ && d(!0),
            y ? p() : void (g && h()))
        }
        var i = window.isoEngine;
        if (!i.mapRenderer.isReady)
            return i.once("mapLoaded", function() {
                m(e)
            });
        if (window.gui.fightManager.fightState !== R.UNDEFINED) {
            if (!f)
                return void b.push(e);
            f = !1;
            var n = e.sequence
              , o = n.shift()
              , s = n.pop();
            return o.sequenceType !== s.sequenceType ? console.error(new Error("Different sequenceType")) : o.authorId !== s.authorId ? console.error(new Error("Different authorId")) : void T(n, function(e) {
                if (e)
                    return console.error(e),
                    t();
                for (var i = [], o = 0; o < n.length; o++) {
                    var s = n[o]
                      , a = O[s._messageType];
                    void 0 !== a ? a && a(s, i) : console.error(new Error("[process messageSequence] Unsupported game action: " + s._messageType))
                }
                try {
                    C.series(i, function(e) {
                        e && console.error(e),
                        t()
                    })
                } catch (r) {
                    console.error(r),
                    t()
                }
            })
        }
    }
    var f, g, _, v, y, w, b, C = i(12), I = i(85), T = i(1035), S = i(1041), A = i(1043), E = i(1045), x = i(1046), M = i(1047), N = i(1048), R = i(217).FIGHT_STATES, O = {
        GameMapMovementMessage: E.mapMovement,
        GameActionFightSlideMessage: E.slideMovement,
        GameActionFightTeleportOnSameMapMessage: E.teleport,
        GameActionFightExchangePositionsMessage: E.exchangePositions,
        GameActionFightCloseCombatMessage: S,
        GameActionFightSpellCastMessage: S,
        GameActionFightLifePointsGainMessage: A.lifePointVariation,
        GameActionFightLifePointsLostMessage: A.lifePointVariation,
        GameActionFightLifeAndShieldPointsLostMessage: A.lifePointVariation,
        GameActionFightPointsVariationMessage: A.actionOrMovementPointVariation,
        GameActionFightDispellableEffectMessage: A.buffVariation,
        GameActionFightMarkCellsMessage: x.addMark,
        GameActionFightUnmarkCellsMessage: x.removeMark,
        GameActionFightTriggerGlyphTrapMessage: x.triggerGlyphTrap,
        GameActionFightVanishMessage: M.vanish,
        GameActionFightInvisibilityMessage: M.setVisibility,
        GameActionFightInvisibleDetectedMessage: M.detected,
        GameActionFightInvisibleObstacleMessage: null ,
        GameActionFightCarryCharacterMessage: N.carryCharacter,
        GameActionFightThrowCharacterMessage: N.throwCharacter,
        GameActionFightDropCharacterMessage: N.dropCharacter,
        GameActionFightSummonMessage: r,
        GameActionFightChangeLookMessage: l,
        GameActionFightTackledMessage: s,
        _GameActionFightLeaveMessage: a,
        GameActionFightDeathMessage: a,
        GameActionFightKillMessage: a,
        GameActionFightDispellEffectMessage: n,
        GameActionFightDispellSpellMessage: n,
        GameActionFightDispellMessage: n,
        GameActionFightSpellCooldownVariationMessage: n,
        GameActionFightSpellImmunityMessage: n,
        GameActionFightReduceDamagesMessage: n,
        GameActionFightReflectDamagesMessage: n,
        GameActionFightReflectSpellMessage: n,
        GameActionFightModifyEffectsDurationMessage: n,
        GameActionFightDodgePointLossMessage: n,
        GameFightTurnListMessage: n,
        GameActionFightStealKamaMessage: null ,
        GameActionFightTriggerEffectMessage: null ,
        GameFightRefreshFighterMessage: c,
        TextInformationMessage: o,
        FighterStatsListMessage: n,
        SequenceStartMessage: null ,
        SequenceEndMessage: null
    };
    u(),
    t.initialize = function(e) {
        function t(e) {
            x.syncMarks(e.marks)
        }
        e.on("messageSequence", m),
        e.on("GameFightTurnReadyRequestMessage", h),
        e.on("GameFightSynchronizeMessage", function(e) {
            v = e,
            d(!1)
        }),
        e.on("disconnect", function() {
            u()
        }),
        e.on("GameFightLeaveMessage", function(t) {
            var i = t.charId === window.actorManager.userId
              , n = window.gui
              , o = n.fightManager.fightState;
            if (o === R.BATTLE) {
                var s = n.fightManager.getFighter(t.charId);
                if (s && s.data.alive) {
                    var a = {
                        _messageType: "messageSequence",
                        sequence: [{
                            _messageType: "SequenceStartMessage"
                        }, {
                            _messageType: "_GameActionFightLeaveMessage",
                            actionId: 0,
                            sourceId: 0,
                            targetId: t.charId
                        }, {
                            _messageType: "SequenceEndMessage"
                        }]
                    };
                    e.emit("messageSequence", a)
                }
            }
            n.transmitFightSequenceMessage(t),
            i && e.emit("GameFightEndMessage", {
                _messageType: "GameFightEndMessage"
            })
        }),
        e.on("FighterStatsListMessage", function(t) {
            var i = window.gui
              , n = i.fightManager.fightState;
            if (n === R.BATTLE) {
                var o = {
                    _messageType: "messageSequence",
                    sequence: [{
                        _messageType: "SequenceStartMessage"
                    }, t, {
                        _messageType: "SequenceEndMessage"
                    }]
                };
                e.emit("messageSequence", o)
            } else
                i.transmitFightSequenceMessage(t)
        }),
        e.on("GameFightEndMessage", function(e) {
            window.actorManager.removeInvisibilityOfAllActors(),
            w = e,
            p()
        }),
        e.on("GameFightSpectateMessage", t),
        e.on("GameFightResumeMessage", t),
        e.on("GameFightResumeWithSlavesMessage", t),
        e.on("GameContextDestroyMessage", function() {
            e.gameContext !== I.FIGHT || f || (y && window.gui.transmitFightSequenceMessage(w),
            u())
        })
    }
    ,
    t.getMarkedCells = x.getMarkedCells
}
, function(e, t, i) {
    function n(e, t) {
        var i = t.actors;
        return i[e] || (i[e] = {}),
        i[e]
    }
    function o(e, t) {
        var i = n(e, t);
        if (!i.position && 0 !== i.position) {
            var o = window.actorManager.getActor(e);
            if (!o)
                return console.error("No actor " + e);
            i.position = o.cellId,
            i.direction = o.direction
        }
        return i
    }
    function s(e, t, i, n) {
        if (0 !== t) {
            var s = window.actorManager.getActor(t);
            if (!s || s.animManager.isTemporary)
                return console.warn("No actor", t);
            i.direction = o(t, n).direction,
            e.addAnimation(s, i)
        }
    }
    function a(e, t) {
        var i = x.getMapPointFromCellId(e)
          , n = x.getMapPointFromCellId(t)
          , o = x.getCoordinateSceneFromGrid(i)
          , s = x.getCoordinateSceneFromGrid(n)
          , a = s.y - o.y
          , r = s.x - o.x;
        return Math.atan2(a, r)
    }
    function r(e, t, i, n, o, s, r, l, c) {
        o = o || 0;
        var u = M.cellCoord[s];
        if (u) {
            var h = new D({
                scene: window.isoEngine.mapScene,
                position: s,
                x: u.x,
                y: u.y - (r || 0)
            });
            if (c) {
                var d;
                d = c === G.TOWARD_POSITION2 ? a(s, l) : a(l, s),
                h.rotation = k[o] ? d + Math.PI : d
            }
            return t["_" + n + "Orientation"] = o,
            t["_" + n] = h,
            e.loadAnimationManager(h, i + "/FX"),
            h
        }
    }
    function l(e, t, i) {
        var n = window.actorManager
          , o = n.getActor(t);
        if (!o)
            return void console.warn("Source actor does not exist");
        var s = new P({
            actorId: i + ":" + t,
            position: o.position,
            scene: n.scene
        });
        return e.loadAnimationManager(s, i + "/FX"),
        s
    }
    function c(e, t, i) {
        t._missileGfx = l(e, t.sourceId || t.casterId, i)
    }
    function u(e, t, i, n, o, s, a, l, c, u) {
        var h = p(l, s)
          , d = m(c, l, "casterGfx" === n);
        return r(e, t, i, n, h, o, a, u, d)
    }
    function h(e, t, i, n, o) {
        function s(i, n) {
            var o = a.getCoordinateCellIdFromGrid({
                i: i,
                j: n
            });
            x && w === o && (M = !0,
            y.stop());
            var s = u(e, t, c, "trailGfx", o, h, I, T, S, d);
            s && (s.scaleX = E,
            s.scaleY = E,
            N.push(s))
        }
        var a = window.isoEngine.mapRenderer.grid
          , r = window.actorManager.getActor(t.sourceId || t.casterId)
          , l = t._scriptParams
          , c = l.trailGfxId
          , h = i.direction
          , d = r.position
          , p = a.getCoordinateGridFromCellId(d)
          , m = p.i
          , f = p.j
          , g = a.getCoordinateGridFromCellId(t.destinationCellId || t.targetCellId)
          , _ = g.i
          , v = g.j
          , y = new O;
        y.set(m, f, _, v);
        var w, b = 1 + (l.trailGfxMinScale || 0) / 10, C = 1 + (l.trailGfxMaxScale || 0) / 10, I = l.targetGfxYOffset2, T = l.trailDisplayType, S = l.targetGfxOriented2, A = t.spellLevel / 6, E = C * A + b * (1 - A), x = l.endTrailOnTarget, M = !1;
        x && (w = n.position);
        var N = [];
        y.exec(s);
        for (var R = 1; R < o.length && !M; R += 1) {
            var P = o[R]
              , D = a.getCoordinateGridFromCellId(P);
            s(D.i, D.j)
        }
        t._trailGfxs = N,
        t._trailGfxsOrientation = h
    }
    function d(e, t, i, n) {
        if (t._scriptParams.useSpellZone) {
            e.addWaitingRequest();
            var o = t.sourceId || t.casterId
              , s = t.destinationCellId || t.targetCellId
              , a = t.spellId
              , r = t.spellLevel;
            window.gui.fightManager.getFighterSpell(a, o, function(o, a) {
                var l;
                if (o)
                    console.error(o),
                    l = [];
                else {
                    var c = a;
                    if (c.setLevel(r),
                    !window.isoEngine.mapRenderer.map || !window.isoEngine.mapRenderer.map.cells)
                        return;
                    var u = window.isoEngine.mapRenderer.map.cells;
                    l = L(u, i.position, s, c.getZoneEffect())
                }
                h(e, t, i, n, l),
                e.removeWaitingRequest()
            })
        } else
            h(e, t, i, n, [])
    }
    function p(e, t) {
        switch (e) {
        case H.RANDOM:
            return Math.floor(8 * Math.random());
        case H.ORIENTED:
            return t;
        default:
            return 0
        }
    }
    function m(e, t, i) {
        return t === H.ORIENTED ? G.NONE : e ? i ? G.TOWARD_POSITION2 : G.TOWARD_POSITION1 : G.NONE
    }
    function f(e, t, i) {
        var n = "GameActionFightCloseCombatMessage" === t._messageType
          , a = "GameRolePlaySpellAnimMessage" === t._messageType
          , l = t.sourceId || t.casterId
          , h = o(l, i);
        if (h) {
            if (t.destinationCellId !== -1 && h.position !== t.destinationCellId) {
                var p = x.getOrientation(h.position, t.destinationCellId, !1);
                h.direction = p,
                t._casterOrientation = p
            }
            if (!t.silentCast) {
                var m;
                if (t.targetId) {
                    if (m = o(t.targetId, i),
                    !m)
                        return
                } else
                    m = {
                        direction: 1
                    };
                var f = m.position || t.destinationCellId || t.targetCellId;
                t._targetCellId = f;
                var g = t._scriptParams || {};
                if (g.casterGfxId && u(e, t, g.casterGfxId, "casterGfx", h.position, h.direction, g.casterGfxYOffset, g.casterGfxDisplayType, g.casterGfxOriented, f),
                g.targetGfxId && u(e, t, g.targetGfxId, "targetGfx", f, h.direction, g.targetGfxYOffset, g.targetGfxDisplayType, g.targetGfxOriented, h.position),
                g.targetGfxId2 && u(e, t, g.targetGfxId2, "targetGfx2", f, h.direction, g.targetGfxYOffset2, g.targetGfxDisplayType2, g.targetGfxOriented2, h.position),
                a) {
                    var _ = g.animId;
                    _ && (g.targetGfxId2 && console.error(new Error("Message contains a targetGfdId2 and ")),
                    r(e, t, _, "targetGfx2", 1, f)),
                    t._spellAnimSymbol = {
                        base: "AnimAttaque",
                        type: 403
                    }
                } else
                    g.missileGfxId && c(e, t, g.missileGfxId),
                    n ? t._spellAnimSymbol = {
                        base: "AnimArme",
                        type: t._weaponTypeId || 0
                    } : void 0 !== g.animId && (t._spellAnimSymbol = {
                        base: "AnimAttaque",
                        type: g.animId
                    });
                g.trailGfxId && d(e, t, h, m),
                t._spellAnimSymbol && s(e, l, t._spellAnimSymbol, i);
                for (var v = t._lifeVariationMsgs || [], y = t._deadIds, w = 0; w < v.length; w++) {
                    var b = v[w]
                      , C = b.targetId;
                    y && y.indexOf(C) !== -1 ? b._isDead = !0 : v[w].loss && s(e, C, {
                        base: "AnimHit"
                    }, i)
                }
            }
        }
    }
    function g(e, t, i) {
        var n = window.actorManager.getActor(t.sourceId);
        n && !n.animManager.isVoidAnimManager && (e.addAnimation(n, {
            base: "carrying",
            direction: -1
        }),
        s(e, t.sourceId, {
            base: "AnimPickup"
        }, i),
        t._direction = o(t.sourceId, i).direction)
    }
    function _(e, t, i) {
        s(e, t.sourceId, {
            base: "AnimDrop"
        }, i),
        t._direction = o(t.sourceId, i).direction
    }
    function v(e, t, i) {
        s(e, t.sourceId, {
            base: "AnimThrow"
        }, i),
        t._throwingProjectile = l(e, t.sourceId, F),
        t._direction = o(t.sourceId, i).direction
    }
    function y(e, t) {
        window.gui.fightManager.loadFighter(t);
        var i = e.loadActor(t.summon);
        i.hide(),
        t._summon = i
    }
    function w(e, t, i) {
        var o = n(t.targetId, i);
        if (o.look !== t.entityLook)
            return void (t._doNotProcess = !0);
        var s = window.actorManager.getActor(t.targetId);
        e.loadLook(t, s, t.entityLook)
    }
    function b(e, t) {
        var i = t.informations
          , n = window.actorManager.getActor(i.contextualId);
        e.loadLook(t, n, i.look)
    }
    function C(e, t, i) {
        s(e, t.targetId, {
            base: "AnimMort"
        }, i),
        t._animSymbol = "AnimMort"
    }
    function I(e, t, i) {
        s(e, t.targetId, {
            base: "AnimHit"
        }, i),
        t._animSymbol = "AnimHit"
    }
    function T(e, t, i) {
        s(e, t.sourceId, {
            base: "AnimTacle"
        }, i)
    }
    function S(e, t, i) {
        s(e, t.targetId, {
            base: "AnimVanish"
        }, i)
    }
    function A(e, t) {
        var i = t.mark;
        i._glyphGfxId && r(e, i, i._glyphGfxId, "glyph", 0, 0)
    }
    function E(e, t) {
        if (this instanceof E == !1)
            return new E(e,t);
        var i = N(e);
        this.nAssetsToLoad = 1,
        this.nAssetsLoaded = 0;
        var n = this;
        this.onAssetsLoaded = function() {
            n.nAssetsLoaded += 1,
            n.nAssetsLoaded === n.nAssetsToLoad && t()
        }
        ;
        for (var o = 0; o < e.length; o++) {
            var s = e[o]
              , a = U[s._messageType];
            a && a(this, s, i)
        }
        this.onAssetsLoaded()
    }
    var x = i(626)
      , M = i(614)
      , N = i(1036)
      , R = i(6)
      , O = i(1037)
      , P = i(1038)
      , D = i(248)
      , L = i(1040).getSpellEffectZone
      , B = i(249)
      , k = R.ANIM_SYMETRY
      , F = "21209"
      , H = {
        NORMAL: 0,
        RANDOM: 1,
        ORIENTED: 2
    }
      , G = {
        NONE: 0,
        TOWARD_POSITION1: 1,
        TOWARD_POSITION2: 2
    }
      , U = {
        GameActionFightSpellCastMessage: f,
        GameActionFightCloseCombatMessage: f,
        GameActionFightChangeLookMessage: w,
        GameActionFightSummonMessage: y,
        GameActionFightDeathMessage: C,
        GameActionFightKillMessage: C,
        GameActionFightTackledMessage: T,
        GameActionFightMarkCellsMessage: A,
        GameActionFightCarryCharacterMessage: g,
        GameActionFightThrowCharacterMessage: v,
        GameActionFightDropCharacterMessage: _,
        _GameActionFightLeaveMessage: C,
        GameActionFightVanishMessage: S,
        GameActionFightLifeAndShieldPointsLostMessage: I,
        GameActionFightLifePointsLostMessage: I,
        GameFightRefreshFighterMessage: b,
        GameRolePlaySpellAnimMessage: f
    };
    E.prototype.addAnimation = function(e, t) {
        this.nAssetsToLoad += 1,
        e.animManager.addAnimation(t, this.onAssetsLoaded)
    }
    ,
    E.prototype.loadAnimationManager = function(e, t) {
        this.nAssetsToLoad += 1,
        B.loadAnimationManager(e, "bone", t, this.onAssetsLoaded)
    }
    ,
    E.prototype.loadActor = function(e) {
        return this.nAssetsToLoad += 1,
        window.actorManager.addActor(e, this.onAssetsLoaded)
    }
    ,
    E.prototype.loadLook = function(e, t, i) {
        this.nAssetsToLoad += 1;
        var n = this.onAssetsLoaded
          , o = {
            addToSprite: !1
        };
        B.loadLook(t, i, o, function(t) {
            e._loadedLook = {
                animationManager: t,
                look: i
            },
            n()
        })
    }
    ,
    E.prototype.addWaitingRequest = function() {
        this.nAssetsToLoad += 1
    }
    ,
    E.prototype.removeWaitingRequest = function() {
        this.nAssetsToLoad -= 1
    }
    ,
    e.exports = function(e, t) {
        E(e, t)
    }
}
, function(e, t, i) {
    function n() {
        m = {},
        f = null
    }
    function o(e) {
        return m[e] || (m[e] = {
            id: e
        }),
        m[e]
    }
    function s(e) {
        var t = o(e.targetId);
        return t ? (t.death = !0,
        void (f && (e._spell = f,
        f._deathMsgs.push(e),
        f._deadIds.push(e.targetId)))) : console.error("Actor " + e.targetId + " not found.")
    }
    function a(e) {
        var t = o(e.sourceId);
        t.tackled = !0
    }
    function r(e) {
        f && (e._spell = f,
        f._pointVariationMsgs.push(e))
    }
    function l(e) {
        f && (e._spell = f,
        f._lifeVariationMsgs.push(e))
    }
    function c(e) {
        var t = window.actorManager.getActor(e.targetId);
        t && t.setOnScreenPosition(e.cellId)
    }
    function u(e) {
        var t = o(e.targetId);
        t.look = e.entityLook
    }
    function h(e) {
        var t = e.summon.contextualId
          , i = o(t)
          , n = e.summon.disposition;
        i.position = n.cellId,
        i.direction = n.direction,
        i.isSummoned = !0,
        f && (f.targetId = t)
    }
    function d(e) {
        f = e,
        f._deathMsgs = [],
        f._deadIds = [],
        f._lifeVariationMsgs = [],
        f._pointVariationMsgs = []
    }
    function p(e) {
        if (e.cellId !== -1) {
            var t = window.actorManager.getActor(e.sourceId);
            t && 1 === g.getDistance(t.cellId, e.cellId) && (e._messageType = "GameActionFightDropCharacterMessage")
        }
    }
    var m, f, g = i(626), _ = {
        GameActionFightCloseCombatMessage: d,
        GameActionFightSpellCastMessage: d,
        GameMapMovementMessage: null ,
        GameActionFightSlideMessage: null ,
        GameActionFightPointsVariationMessage: r,
        GameActionFightLifeAndShieldPointsLostMessage: l,
        GameActionFightLifePointsGainMessage: l,
        GameActionFightLifePointsLostMessage: l,
        GameActionFightTeleportOnSameMapMessage: null ,
        GameActionFightExchangePositionsMessage: null ,
        GameActionFightSummonMessage: h,
        GameActionFightMarkCellsMessage: null ,
        GameActionFightUnmarkCellsMessage: null ,
        GameActionFightChangeLookMessage: u,
        GameActionFightInvisibilityMessage: null ,
        _GameActionFightLeaveMessage: s,
        GameActionFightDeathMessage: s,
        GameActionFightKillMessage: s,
        GameActionFightVanishMessage: null ,
        GameActionFightTriggerEffectMessage: null ,
        GameActionFightDispellEffectMessage: null ,
        GameActionFightDispellSpellMessage: null ,
        GameActionFightDispellMessage: null ,
        GameActionFightDodgePointLossMessage: null ,
        GameActionFightSpellCooldownVariationMessage: null ,
        GameActionFightSpellImmunityMessage: null ,
        GameActionFightInvisibleObstacleMessage: null ,
        GameActionFightReduceDamagesMessage: null ,
        GameActionFightReflectDamagesMessage: null ,
        GameActionFightReflectSpellMessage: null ,
        GameActionFightStealKamaMessage: null ,
        GameActionFightTackledMessage: a,
        GameActionFightTriggerGlyphTrapMessage: null ,
        GameActionFightDispellableEffectMessage: null ,
        GameActionFightModifyEffectsDurationMessage: null ,
        GameActionFightCarryCharacterMessage: null ,
        GameActionFightThrowCharacterMessage: p,
        GameActionFightDropCharacterMessage: null ,
        GameActionFightInvisibleDetectedMessage: c,
        GameFightTurnListMessage: null ,
        GameRolePlaySpellAnimMessage: null
    };
    e.exports = function(e) {
        n();
        for (var t = 0; t < e.length; t++) {
            var i = e[t]
              , o = _[i._messageType];
            o && o(i)
        }
        return {
            actors: m
        }
    }
}
, function(e, t) {
    function i() {
        this.sourceX = 0,
        this.sourceY = 0,
        this.targetX = 0,
        this.targetY = 0,
        this.x = 0,
        this.y = 0,
        this.incX = 0,
        this.incY = 0,
        this.error = 0,
        this.deltaError = 0,
        this._stop = !1,
        this.cb = null
    }
    e.exports = i,
    i.prototype.set = function(e, t, i, n) {
        this.sourceX = ~~e || 0,
        this.sourceY = ~~t || 0,
        this.targetX = ~~i || 0,
        this.targetY = ~~n || 0
    }
    ,
    i.prototype.exec = function(e) {
        var t = [];
        e && "function" == typeof e || (e = function(e, i) {
            t.push([e, i])
        }
        ),
        this.cb = e,
        this._stop = !1,
        this.error = 0,
        this.deltaError = 0,
        this.x = this.sourceX,
        this.y = this.sourceY;
        var i = this.targetX - this.sourceX
          , n = this.targetY - this.sourceY
          , o = Math.abs(i)
          , s = Math.abs(n);
        this.incX = i > 0 ? 1 : -1,
        this.incY = n > 0 ? 1 : -1;
        var a;
        for (0 === i && 0 === n ? (this._stop = !0,
        a = null ) : 0 === i ? a = this._vertical : 0 === n ? a = this._horizontal : o === s ? a = this._equalSlope : o > s ? (a = this._xSlope,
        this.deltaError = s / o) : (a = this._ySlope,
        this.deltaError = o / s); !this._stop; )
            a.apply(this),
            this.x === this.targetX && this.y === this.targetY && (this._stop = !0),
            this.cb(this.x, this.y, !0);
        return t
    }
    ,
    i.prototype.stop = function() {
        this._stop = !0
    }
    ,
    i.prototype._horizontal = function() {
        this.x += this.incX
    }
    ,
    i.prototype._vertical = function() {
        this.y += this.incY
    }
    ,
    i.prototype._equalSlope = function() {
        this.x += this.incX,
        this.y += this.incY
    }
    ,
    i.prototype._xSlope = function() {
        this.error += this.deltaError,
        this.error >= .5 && (this.y += this.incY,
        this.error -= 1),
        this.x += this.incX
    }
    ,
    i.prototype._ySlope = function() {
        this.error += this.deltaError,
        this.error >= .5 && (this.x += this.incX,
        this.error -= 1),
        this.y += this.incY
    }
}
, function(e, t, i) {
    function n(e) {
        s.call(this, e, e.animManager),
        this.actorId = void 0 !== e.actorId ? e.actorId : null ,
        this.path = [],
        this.step = 0,
        this.moving = !1
    }
    var o = i(26).inherits
      , s = i(243)
      , a = i(261).Tween
      , r = i(1039).prepare(3)
      , l = i(1037)
      , c = i(614)
      , u = i(626)
      , h = new l
      , d = {
        base: "FX",
        direction: 0
    };
    o(n, s),
    e.exports = n,
    n.prototype.isFx = !0,
    n.prototype.isTapped = function() {
        return !1
    }
    ,
    n.prototype.tap = function() {}
    ,
    n.prototype.refreshAnimation = function(e) {
        if (this.moving === !0) {
            var t = this.path
              , i = this.step
              , n = ~~i
              , o = this.prevCoords
              , s = {
                x: r([this.source[0], this.bezier[0], this.target[0]], i / this.pathLength),
                y: r([this.source[1], this.bezier[1], this.target[1]], i / this.pathLength)
            };
            this.x = s.x,
            this.y = s.y;
            var a = s.x - o.x
              , l = s.y - o.y;
            this.rotation = Math.atan2(l, a);
            var c = t[n];
            c !== this.prevPos && (this.position = c),
            this.prevPos = c,
            this.prevCoords = s
        }
        this._refreshAnimation(e)
    }
    ,
    n.prototype._startPath = function(e) {
        this.animManager.assignSymbol(d, !0),
        this.moving = !0;
        var t = this;
        a(this, ["step"]).from({
            step: 0
        }).to({
            step: this.pathLength
        }, this.duration).start().onFinish(function() {
            return t.remove(),
            e()
        })
    }
    ,
    n.prototype.launch = function(e, t, i, n, o) {
        var s = window.isoEngine.mapRenderer.map
          , a = s.cells
          , r = this.position
          , l = [r]
          , d = u.getMapPointFromCellId(r)
          , p = u.getMapPointFromCellId(e);
        h.set(d.x, d.y, p.x, p.y),
        h.exec(function(e, t) {
            l.push(u.getCellIdFromMapPoint(e, t))
        }),
        this.path = l,
        this.pathLength = l.length,
        this.mirrored = d.x > p.x,
        this.scaleY = this.mirrored ? -1 : 1;
        var m = c.getCellCoord(r)
          , f = c.getCellCoord(e)
          , g = Math.abs(f.x - m.x)
          , _ = Math.abs(f.y - m.y)
          , v = Math.sqrt(g * g + _ * _);
        this.duration = v / 10 * t / 1e3 * 24,
        m.y -= (a[r].f || 0) + n,
        f.y -= (a[e].f || 0) + n,
        m = [m.x, m.y],
        f = [f.x, f.y],
        this.source = m,
        this.target = f,
        this.bezier = [(m[0] + f[0]) / 2, (m[1] + f[1]) / 2 - v * i],
        this.prevPos = r,
        this.prevCoords = {
            x: 2 * m[0] - this.bezier[0],
            y: 2 * m[1] - this.bezier[1]
        },
        this._startPath(o)
    }
}
, function(e, t) {
    function i(e, t) {
        return n(e.length)(e, t)
    }
    function n(e) {
        if (e = 0 | +e,
        !e)
            throw new Error("Cannot create a interpolator with no elements");
        if (l[e])
            return l[e];
        for (var t = ["var ut = 1 - t", ""], i = e; i--; ) {
            for (var n = 0; n < i; n += 1)
                i + 1 === e ? t.push("var p" + n + " = arr[" + n + "] * ut + arr[" + (n + 1) + "] * t") : i > 1 ? t.push("p" + n + " = p" + n + " * ut + p" + (n + 1) + " * t") : t.push("return p" + n + " * ut + p" + (n + 1) + " * t");
            i > 1 && t.push("")
        }
        return t = ["return function bezier" + e + "(arr, t) {", t.map(function(e) {
            return "  " + e
        }).join("\n"), "}"].join("\n"),
        Function(t)()
    }
    function o(e) {
        return e[0]
    }
    function s(e, t) {
        return e[0] + (e[1] - e[0]) * t
    }
    function a(e, t) {
        var i = 1 - t;
        return (e[0] * i + e[1] * t) * i + (e[1] * i + e[2] * t) * t
    }
    function r(e, t) {
        var i = 1 - t
          , n = e[1] * i + e[2] * t;
        return ((e[0] * i + e[1] * t) * i + n * t) * i + (n * i + (e[2] * i + e[3] * t) * t) * t
    }
    var l = {
        1: o,
        2: s,
        3: a,
        4: r
    };
    e.exports = i,
    e.exports.prepare = n
}
, function(e, t, i) {
    function n(e, t, i, n) {
        var o = [];
        0 === i && o.push([e, t, 0]);
        for (var s = i || 1; s <= n; s++)
            for (var a = 0; a < s; a++) {
                var r = s - a;
                o.push([e + a, t - r, s]),
                o.push([e + r, t + a, s]),
                o.push([e - a, t + r, s]),
                o.push([e - r, t - a, s])
            }
        return o
    }
    function o(e, t, i, n) {
        var o = [];
        0 === i && o.push([e, t, 0]);
        for (var s = i || 1; s <= n; s++)
            o.push([e - s, t, s]),
            o.push([e + s, t, s]),
            o.push([e, t - s, s]),
            o.push([e, t + s, s]);
        return o
    }
    function s(e, t, i, n) {
        var o = [];
        0 === i && o.push([e, t, 0]);
        for (var s = i || 1; s <= n; s++)
            o.push([e - s, t - s, s]),
            o.push([e - s, t + s, s]),
            o.push([e + s, t - s, s]),
            o.push([e + s, t + s, s]);
        return o
    }
    function a(e, t, i, n) {
        var o = [];
        0 === i && o.push([e, t, 0]);
        for (var s = i || 1; s <= n; s++)
            o.push([e - s, t, s]),
            o.push([e + s, t, s]),
            o.push([e, t - s, s]),
            o.push([e, t + s, s]),
            o.push([e - s, t - s, s]),
            o.push([e - s, t + s, s]),
            o.push([e + s, t - s, s]),
            o.push([e + s, t + s, s]);
        return o
    }
    function r(e, t, i, n) {
        var o = [];
        0 === i && o.push([e, t, 0]);
        for (var s = i || 1; s <= n; s++) {
            o.push([e - s, t, s]),
            o.push([e + s, t, s]),
            o.push([e, t - s, s]),
            o.push([e, t + s, s]),
            o.push([e - s, t - s, s]),
            o.push([e - s, t + s, s]),
            o.push([e + s, t - s, s]),
            o.push([e + s, t + s, s]);
            for (var a = 1; a < s; a++)
                o.push([e + s, t + a, s]),
                o.push([e + s, t - a, s]),
                o.push([e - s, t + a, s]),
                o.push([e - s, t - a, s]),
                o.push([e + a, t + s, s]),
                o.push([e - a, t + s, s]),
                o.push([e + a, t - s, s]),
                o.push([e - a, t - s, s])
        }
        return o
    }
    function l(e, t, i, n, o, s) {
        for (var a = [], r = i; r <= n; r++) {
            var l = e + r * o
              , c = t + r * s;
            a.push([l, c, r]);
            for (var u = 1; u <= r; u++)
                a.push([l + u * s, c - u * o, r]),
                a.push([l - u * s, c + u * o, r])
        }
        return a
    }
    function c(e, t, i, n, o, s) {
        var a = [];
        0 === i && a.push([e, t, 0]);
        for (var r = i || 1; r <= n; r++) {
            var l = e - r * o
              , c = t - r * s;
            a.push([l + r * s, c - r * o, r]),
            a.push([l - r * s, c + r * o, r])
        }
        return a
    }
    function u(e, t, i, n) {
        for (var o = [], s = i || 1; s <= n; s++) {
            o.push([e - s, t, s]),
            o.push([e + s, t, s]),
            o.push([e, t - s, s]),
            o.push([e, t + s, s]);
            for (var a = 1; a < s; a++)
                o.push([e + s, t + a, s]),
                o.push([e + s, t - a, s]),
                o.push([e - s, t + a, s]),
                o.push([e - s, t - a, s]),
                o.push([e + a, t + s, s]),
                o.push([e - a, t + s, s]),
                o.push([e + a, t - s, s]),
                o.push([e - a, t - s, s])
        }
        return o
    }
    function h(e, t, i, n, o, s) {
        for (var a = [], r = i; r <= n; r++)
            a.push([e + o * r, t + s * r, r]);
        return a
    }
    function d(e, t, i, o) {
        return n(e, t, o, o)
    }
    function p(e, t, i, o) {
        return n(e, t, o, y)
    }
    function m(e, t, i, n, o, s) {
        var a = [];
        0 === i && a.push([e, t, 0]);
        for (var r = i || 1; r <= n; r++)
            a.push([e + s * r, t - o * r, r]),
            a.push([e - s * r, t + o * r, r]);
        return a
    }
    function f(e, t, i, n) {
        for (var o = _.getMapPointFromCellId(t), s = n(o.x, o.y, 0, i), a = [], r = 0; r < s.length; r++) {
            var l = _.getCellIdFromMapPoint(s[r][0], s[r][1]);
            if (void 0 !== l) {
                var c = e[l].l || 0;
                1 === (5 & c) && a.push(l)
            }
        }
        return a
    }
    var g = i(65)
      , _ = i(626)
      , v = i(66)
      , y = 39;
    e.exports.getSpellRange = function(e, t, i) {
        var a, r = _.getMapPointFromCellId(t);
        return a = i.castInLine && i.castInDiagonal ? o(r.x, r.y, i.minRange, i.range).concat(s(r.x, r.y, i.minRange, i.range)) : i.castInLine ? o(r.x, r.y, i.minRange, i.range) : i.castInDiagonal ? s(r.x, r.y, i.minRange, i.range) : n(r.x, r.y, i.minRange, i.range)
    }
    ,
    e.exports.getCircleArea = function(e, t, i) {
        return f(e, t, i, n)
    }
    ,
    e.exports.getCrossArea = function(e, t, i) {
        return f(e, t, i, o)
    }
    ;
    var w = {
        P: null ,
        A: null ,
        D: null ,
        X: {
            fn: o,
            hasDirection: !1,
            withoutCenter: !1
        },
        L: {
            fn: h,
            hasDirection: !0,
            withoutCenter: !1
        },
        T: {
            fn: m,
            hasDirection: !0,
            withoutCenter: !1
        },
        C: {
            fn: n,
            hasDirection: !1,
            withoutCenter: !1
        },
        O: {
            fn: d,
            hasDirection: !1,
            withoutCenter: !1
        },
        "+": {
            fn: s,
            hasDirection: !1,
            withoutCenter: !1
        },
        G: {
            fn: r,
            hasDirection: !1,
            withoutCenter: !1
        },
        V: {
            fn: l,
            hasDirection: !0,
            withoutCenter: !1
        },
        W: {
            fn: u,
            hasDirection: !1,
            withoutCenter: !1
        },
        "/": {
            fn: h,
            hasDirection: !0,
            withoutCenter: !1
        },
        "-": {
            fn: m,
            hasDirection: !0,
            withoutCenter: !1
        },
        U: {
            fn: c,
            hasDirection: !0,
            withoutCenter: !1
        },
        Q: {
            fn: o,
            hasDirection: !1,
            withoutCenter: !0
        },
        "#": {
            fn: s,
            hasDirection: !1,
            withoutCenter: !0
        },
        "*": {
            fn: a,
            hasDirection: !1,
            withoutCenter: !1
        },
        I: {
            fn: p,
            hasDirection: !1,
            withoutCenter: !1
        }
    };
    e.exports.getSpellEffectZone = function(e, t, i, n) {
        var o = {}
          , s = w[n.zoneShape];
        if (s) {
            var a, r, l = _.getMapPointFromCellId(i);
            if (s.hasDirection) {
                var c = _.getMapPointFromCellId(t);
                a = l.x === c.x ? 0 : l.x > c.x ? 1 : -1,
                r = l.y === c.y ? 0 : l.y > c.y ? 1 : -1
            }
            for (var u = s.withoutCenter ? n.zoneMinSize || 1 : n.zoneMinSize, h = s.fn(l.x, l.y, u, n.zoneSize, a, r), d = 0; d < h.length; d++) {
                var p = _.getCellIdFromMapPoint(h[d][0], h[d][1]);
                if (void 0 !== p) {
                    var m = e[p].l || 0;
                    1 === (5 & m) && (o[p] = new g(p,h[d][2],window.foreground.fightIsUserTurn ? v.areaOfEffect : v.areaOfEffectEnemyTurn))
                }
            }
        } else
            void 0 === s && console.error("Incorrect Effect shape id: " + n.zoneShape),
            o[i] = new g(i,0,window.foreground.fightIsUserTurn ? v.areaOfEffect : v.areaOfEffectEnemyTurn);
        return o
    }
}
, function(e, t, i) {
    var n = i(1042)
      , o = i(1043)
      , s = i(261).Delay
      , a = i(25)
      , r = i(12)
      , l = 17;
    e.exports = function(e, t) {
        function i(i) {
            t.push(function(t) {
                return n.playGfx(e._targetGfx, e._targetGfxOrientation, p.targetGfxShowUnder, i ? t : null ),
                !i && t()
            })
        }
        function c() {
            t.push(function(t) {
                return n.playGfx(e._targetGfx2, e._targetGfx2Orientation, p.targetGfxShowUnder2),
                t()
            })
        }
        if (!e.silentCast) {
            var u = window.actorManager
              , h = u.getActor(e.sourceId || e.casterId)
              , d = e._casterOrientation;
            d && t.push(function(e) {
                return h.setDisposition(null , d),
                e()
            });
            var p = e._scriptParams || {};
            if (a.allowSpellEffects) {
                var m = e._spellAnimSymbol;
                m && t.push(function(e) {
                    h.oneShootAnim(m, !0);
                    var t = h.animManager.nbFrames;
                    s(Math.min(l, t), e).start()
                });
                var f = e._targetCellId || e.destinationCellId !== -1;
                f && (e._targetGfx && p.playTargetGfxFirst && i(),
                e._targetGfx2 && p.playTargetGfxFirst2 && c()),
                p.casterGfxId && t.push(function(t) {
                    return n.playGfx(e._casterGfx, e._casterGfxOrientation, p.casterGfxShowUnder),
                    t()
                }),
                e._missileGfx && e.destinationCellId !== -1 && t.push(function(t) {
                    e._missileGfx.launch(e.destinationCellId, void 0 !== p.missileSpeed ? p.missileSpeed + 10 : 10, (p.missileCurvature || 0) / 10, p.missileGfxYOffset || 0, t)
                }),
                p.trailGfxId && t.push(function(t) {
                    n.playGfxTrailAnimation(e._trailGfxs, e._trailGfxsOrientation, p.trailGfxShowUnder, t)
                }),
                f && (e._targetGfx && !p.playTargetGfxFirst && i(),
                e._targetGfx2 && !p.playTargetGfxFirst2 && c())
            }
            var g = e._lifeVariationMsgs && e._lifeVariationMsgs.length > 0;
            g && (o.lifePointVariationBatch(e._lifeVariationMsgs, t),
            t.push(function(t) {
                for (var i = 0; i < e._lifeVariationMsgs.length; i++) {
                    var n = e._lifeVariationMsgs[i];
                    if (!(n._isDead || n.delta > 0)) {
                        var o = u.getActor(n.targetId)
                          , s = {
                            base: n._animSymbol || "AnimHit"
                        };
                        o.oneShootAnim(s, !0)
                    }
                }
                return t()
            }));
            var _ = e._pointVariationMsgs && e._pointVariationMsgs.length > 0;
            _ && o.actionOrMovementPointVariationBatch(e._pointVariationMsgs, t);
            var v = e._deathMsgs && e._deathMsgs.length > 0;
            v && t.push(function(t) {
                function i(e, t) {
                    var i = u.getActor(e.targetId);
                    return i ? (i.isDead = !0,
                    void i.death(t)) : (console.error("Actor " + e.targetId + "not found."),
                    t())
                }
                r.each(e._deathMsgs, i, function() {
                    u.userActor.isDead || !window.gui.fightManager.isFightersTurn(u.userActor.actorId) || window.gui.fightManager.getIsTurnEndRequestPending() || window.isoEngine.tryDisplayUserMovementZone()
                }),
                t()
            }),
            (g || _ || v) && t.push(function(e) {
                s(15, e).start()
            }),
            t.push(function(t) {
                return window.gui.transmitFightSequenceMessage(e),
                t()
            })
        }
    }
}
, function(e, t, i) {
    function n(e, t, i, n) {
        e.position += i ? -.1 : .1,
        e.animManager.assignSymbol({
            base: "FX",
            direction: t
        }, !1, function() {
            if (e.remove(),
            n)
                return n()
        })
    }
    function o(e, t, i, o) {
        new s(o,function() {
            n(e, t, i)
        }
        ).start()
    }
    var s = i(261).Delay
      , a = 3;
    t.playGfx = n,
    t.playGfxTrailAnimation = function(e, t, i, n) {
        for (var r = 0, l = 0; l < e.length; l += 1)
            o(e[l], t, i, r),
            r += a;
        new s(r,n).start()
    }
}
, function(e, t, i) {
    function n(e) {
        var t = window.isoEngine.bitmapFonts;
        if (t) {
            var i = e.maxRotation || 0
              , n = new r({
                position: 0,
                layer: l.MAP_LAYER_POINT_LABELS,
                bitmapFont: t.numbers,
                scene: window.actorManager.scene,
                text: e.pointVariation,
                color: e.color || f,
                x: e.x + 30 * (Math.random() - .5),
                y: e.y + 30 * (Math.random() - .5),
                rotation: (Math.random() - .5) * i
            });
            n.hide(),
            h(e.delay || 0, function() {
                c(n.highlight, ["red", "green", "blue"]).from({
                    red: 1,
                    green: 1,
                    blue: 1
                }).to({
                    red: 4,
                    green: 4,
                    blue: 4
                }, 3, u.polyOut, 4).to({
                    red: 1,
                    green: 1,
                    blue: 1
                }, 8, u.polyOut, 4).start(),
                c(n, ["scaleX", "scaleY"]).from({
                    scaleX: .2,
                    scaleY: .2
                }).to({
                    scaleX: 1.8,
                    scaleY: 1.8
                }, 4, u.polyOut, 4).to({
                    scaleX: 1,
                    scaleY: 1
                }, 10, u.polyOut, 4).start();
                var e = n.rotation
                  , t = (Math.random() - .5) * e;
                c(n, ["y", "rotation"]).from({
                    y: n.y,
                    rotation: e
                }).to({
                    y: n.y,
                    rotation: e
                }, 8).to({
                    y: n.y - 60,
                    rotation: t
                }, 30, u.polyOut, 7).start(),
                c(n, ["alpha"]).from({
                    alpha: 0
                }).to({
                    alpha: 1
                }, 3, u.polyOut, 4).to({
                    alpha: 0
                }, 38, u.polyIn, 4).start().onFinish(function() {
                    n.remove()
                }),
                n.show()
            }).start()
        }
    }
    function o(e, t, i) {
        var o = window.actorManager.getActor(e.targetId);
        if (o) {
            var s = window.gui.fightManager.isFighterOnUsersTeam(e.targetId)
              , a = window.actorManager.isActorInvisible(e.targetId)
              , r = e.actionId === p.ACTION_CHARACTER_MOVEMENT_POINTS_USE;
            if ((s || !r || !a) && (e.shieldLoss || 0 !== e.delta && 0 !== e.loss)) {
                var l;
                l = e.actionId === p.ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS ? "-" + e.delta : e.delta ? e.delta > 0 ? "+" + e.delta : e.delta : e.shieldLoss ? "-" + e.shieldLoss : "-" + e.loss,
                n({
                    x: o.x,
                    y: o.y - 70,
                    maxRotation: .3,
                    color: t,
                    delay: i,
                    pointVariation: l
                })
            }
        }
    }
    function s(e, t, i) {
        return !e._spell && i && (d.showApMpUsed || e.actionId !== p.ACTION_CHARACTER_MOVEMENT_POINTS_USE && e.actionId !== p.ACTION_CHARACTER_ACTION_POINTS_USE) ? void t.push(function(t) {
            o(e, i),
            window.gui.transmitFightSequenceMessage(e),
            window.setTimeout(t, 500)
        }) : t.push(function(t) {
            return window.gui.transmitFightSequenceMessage(e),
            t()
        })
    }
    function a(e, t) {
        e.sort(function(e, t) {
            return e.targetId - t.targetId
        });
        for (var i = [], n = null , s = 0, a = 0; a < e.length; a++) {
            var r = e[a];
            if (r._labelColor) {
                var l = r.targetId;
                n === l ? s += m : s = 0,
                i[a] = s,
                n = l
            }
        }
        t.push(function(t) {
            for (var n = 0; n < e.length; n++) {
                var s = e[n];
                (d.showApMpUsed || s.actionId !== p.ACTION_CHARACTER_MOVEMENT_POINTS_USE && s.actionId !== p.ACTION_CHARACTER_ACTION_POINTS_USE) && s._labelColor && o(s, s._labelColor, i[n])
            }
            return t()
        })
    }
    var r = i(1044)
      , l = i(6)
      , c = i(261).Tween
      , u = i(261).easing
      , h = i(261).Delay
      , d = i(25)
      , p = i(222)
      , m = 10
      , f = [0, 0, 0, 0]
      , g = [.5, -.3, -.3, 0]
      , _ = [.3, .3, -.5, 0]
      , v = [-.2, -.3, .5, 0]
      , y = [.2, .5, -.2, 0]
      , w = [.3, 0, .5, 0]
      , b = {};
    b[p.ACTION_CHARACTER_ACTION_POINTS_USE] = v,
    b[p.ACTION_CHARACTER_MOVEMENT_POINTS_USE] = y,
    b[p.ACTION_CHARACTER_MOVEMENT_POINTS_LOST] = y,
    b[p.ACTION_CHARACTER_ACTION_POINTS_LOST] = v,
    b[p.ACTION_CHARACTER_BOOST_ACTION_POINTS] = v,
    b[p.ACTION_CHARACTER_DEBOOST_ACTION_POINTS] = v,
    b[p.ACTION_CHARACTER_BOOST_MOVEMENT_POINTS] = y,
    b[p.ACTION_CHARACTER_DEBOOST_MOVEMENT_POINTS] = y,
    t.createPointVariationLabel = n,
    t.lifePointVariation = function(e, t) {
        e.shieldLoss ? s(e, t, w) : e._spell && 2 === e._spell.critical ? s(e, t, _) : s(e, t, g)
    }
    ,
    t.actionOrMovementPointVariation = function(e, t) {
        d.showApMpUsed || e.actionId === p.ACTION_CHARACTER_ACTION_POINTS_LOST || e.actionId === p.ACTION_CHARACTER_MOVEMENT_POINTS_LOST ? s(e, t, b[e.actionId]) : s(e, t, null )
    }
    ,
    t.buffVariation = function(e, t) {
        "FightTemporaryBoostEffect" === e.effect._type && (e.effect.actionId = e.actionId,
        s(e.effect, t, b[e.actionId])),
        t.push(function(t) {
            return window.gui.transmitFightSequenceMessage(e),
            t()
        })
    }
    ,
    t.lifePointVariationBatch = function(e, t) {
        for (var i = 0; i < e.length; i++) {
            var n = e[i];
            n.shieldLoss ? n._labelColor = w : n._spell && 2 === n._spell.critical ? n._labelColor = _ : n._labelColor = g
        }
        a(e, t)
    }
    ,
    t.actionOrMovementPointVariationBatch = function(e, t) {
        for (var i = 0; i < e.length; i++) {
            var n = e[i];
            n._labelColor = b[n.actionId]
        }
        a(e, t)
    }
}
, function(e, t, i) {
    function n(e) {
        e.id = "textSpriteCount" + a++,
        s.call(this, e);
        var t = e.bitmapFont;
        this.characterDimensions = t.dimensions,
        this.texture = t.texture,
        this._characterByteSize = this.renderer.getNbBytesPerSprite(),
        this._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)];
        var i = e.text;
        "number" == typeof i && (i = i.toString());
        for (var n = 0; n < i.length; n += 1)
            " " === i[n] || this.characterDimensions[i[n]] || (e.fallbackText || 0 === e.fallbackText ? (console.error(new Error("TextSprite: character " + i[n] + " not in bitmap font: using fallback text")),
            i = e.fallbackText,
            "number" == typeof i && (i = i.toString()),
            e.fallbackText = null ,
            n = -1) : (console.error(new Error("TextSprite: character " + i[n] + ' not in bitmap font: replacing with a "."')),
            i = i.substr(0, n) + "." + i.substr(n + 1)));
        this.textWidth = 0,
        this.textHeight = 0;
        var o, r, l, c = 30;
        for (o = 0; o < i.length; o += 1)
            r = i[o],
            " " === r ? this.textWidth += c : (l = this.characterDimensions[r],
            this.textWidth += l.w,
            l.h > this.textHeight && (this.textHeight = l.h));
        var u = -this.textWidth / 2
          , h = -this.textHeight / 2;
        for (this._bbox[0] = u,
        this._bbox[1] = u + this.textWidth,
        this._bbox[2] = h,
        this._bbox[3] = h + this.textHeight,
        this.characterPositions = [],
        o = 0; o < i.length; o += 1)
            if (r = i[o],
            " " === r)
                u += c;
            else {
                l = this.characterDimensions[r];
                var d = (this.textHeight - l.h) / 2;
                this.characterPositions[o] = {
                    x: u,
                    y: h + d
                },
                u += l.w
            }
        this._createVertexBuffer(i, e.color)
    }
    var o = i(26).inherits
      , s = i(244)
      , a = 0;
    o(n, s),
    e.exports = n,
    n.prototype._createVertexBuffer = function(e, t) {
        var i = e.length;
        this._vertexBuffer = new ArrayBuffer(i * this._characterByteSize),
        this._floatView = new Float32Array(this._vertexBuffer),
        this._longView = new Uint32Array(this._vertexBuffer);
        for (var n = this._floatView, o = this._longView, s = this._longView, a = this.texture.element.width, r = this.texture.element.height, l = 0; l < e.length; l += 1) {
            var c = e[l];
            if (" " !== c) {
                var u = this.characterPositions[l]
                  , h = this.characterDimensions[c]
                  , d = l * this._characterByteSize / 4
                  , p = u.x
                  , m = u.x + h.w
                  , f = u.y
                  , g = u.y + h.h;
                n[d + 0] = p,
                n[d + 1] = f,
                n[d + 5] = p,
                n[d + 6] = g,
                n[d + 10] = m,
                n[d + 11] = g,
                n[d + 15] = p,
                n[d + 16] = f,
                n[d + 20] = m,
                n[d + 21] = g,
                n[d + 25] = m,
                n[d + 26] = f;
                var _ = h.x / a * 65535 & 65535
                  , v = h.y / r * 4294901760 & 4294901760
                  , y = (h.x + h.w) / a * 65535 & 65535
                  , w = (h.y + h.h) / r * 4294901760 & 4294901760;
                o[d + 2] = _ + v,
                o[d + 7] = _ + w,
                o[d + 12] = y + w,
                o[d + 17] = _ + v,
                o[d + 22] = y + w,
                o[d + 27] = y + v;
                var b = 1077952576;
                s[d + 3] = s[d + 8] = s[d + 13] = b,
                s[d + 18] = s[d + 23] = s[d + 28] = b;
                var C = Math.max(-128, Math.min(127, 128 * t[0]))
                  , I = Math.max(-128, Math.min(127, 128 * t[1]))
                  , T = Math.max(-128, Math.min(127, 128 * t[2]))
                  , S = Math.max(-128, Math.min(127, 128 * t[3]))
                  , A = (S << 24 & 4278190080) + (T << 16 & 16711680) + (I << 8 & 65280) + (255 & C);
                s[d + 4] = s[d + 9] = s[d + 14] = A,
                s[d + 19] = s[d + 24] = s[d + 29] = A
            }
        }
        this.renderer.releaseBuffer(this.id),
        this.forceRefresh()
    }
    ,
    n.prototype.draw = function() {
        this.renderer.drawSpriteBatch(this.id)
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this._floatView
              , i = !1;
            this.renderer.loadSpriteBuffer(this.id, t, this.texture, this.bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t) {
    function i(e) {
        e === window.actorManager.userId && window.isoEngine.displayUserMovementZone()
    }
    function n(e) {
        e === window.actorManager.userId && window.isoEngine.clearUserMovementZone()
    }
    t.mapMovement = function(e, t) {
        t.push(function(t) {
            n(e.actorId),
            window.gui.transmitFightSequenceMessage(e),
            window.actorManager.actorMovement(e, t)
        })
    }
    ,
    t.slideMovement = function(e, t) {
        e.startCellId !== -1 && e.endCellId !== -1 && t.push(function(t) {
            n(e.actorId),
            window.gui.transmitFightSequenceMessage(e),
            window.actorManager.actorMovement({
                actorId: e.targetId,
                keyMovements: [e.startCellId, e.endCellId],
                slide: !0
            }, t)
        })
    }
    ,
    t.teleport = function(e, t) {
        if (e.cellId !== -1) {
            var n = window.actorManager.getActor(e.targetId);
            n && t.push(function(t) {
                return window.gui.transmitFightSequenceMessage(e),
                n.setDisposition(e.cellId),
                i(e.targetId),
                t()
            })
        }
    }
    ,
    t.exchangePositions = function(e, t) {
        var n = window.actorManager.getActor(e.sourceId)
          , o = window.actorManager.getActor(e.targetId);
        t.push(function(t) {
            return window.gui.transmitFightSequenceMessage(e),
            n && n.setDisposition(e.casterCellId),
            o && o.setDisposition(e.targetCellId),
            i(e.sourceId),
            i(e.targetId),
            t()
        })
    }
}
, function(e, t, i) {
    function n(e) {
        var t = window.background
          , i = window.isoEngine
          , o = i.mapRenderer.map;
        if (!o)
            return i.once("mapLoaded", function() {
                n(e)
            });
        d[e.markId] = e;
        for (var l = e._glyph, u = 0, p = e.cells.length; u < p; u++) {
            var m = e.cells[u]
              , f = m.cellId
              , g = r.parseIndexedColor(m.cellColor).color
              , _ = "rgba(" + g.r + "," + g.g + "," + g.b + ", 0.6)"
              , v = "rgba(" + g.r + "," + g.g + "," + g.b + ", 0.3)"
              , y = 0 === m.cellsType ? s.getCircleArea : s.getCrossArea
              , w = y(o.cells, f, m.zoneSize)
              , b = {
                spellId: e.markSpellId
            }
              , C = new c(w,{
                color: v,
                outline: _,
                data: b
            });
            if (l) {
                var I = a.cellCoord[f];
                l.x = I.x,
                l.y = I.y,
                l.position = f - .1,
                l.animManager.assignSymbol(h, !1),
                C.gfx = l
            }
            t.addZone(C, "mark:" + e.markId)
        }
    }
    function o(e) {
        return e._glyphGfxId && !e._glyph ? (e._glyph = new l({
            scene: window.isoEngine.mapScene
        }),
        void u.loadAnimationManager(e._glyph, "bone", e._glyphGfxId + "/FX", function() {
            n(e)
        })) : void n(e)
    }
    var s = i(1040)
      , a = i(614)
      , r = i(247)
      , l = i(248)
      , c = i(1022)
      , u = i(249)
      , h = {
        base: "FX",
        direction: 0
    }
      , d = {};
    t.addMark = function(e, t) {
        t.push(function(t) {
            return n(e.mark),
            t()
        })
    }
    ,
    t.removeMark = function(e, t) {
        delete d[e.markId];
        var i = window.background;
        t.push(function(t) {
            return i.deleteZoneById("mark:" + e.markId, function(e) {
                var t = e.gfx;
                e.gfx = null ,
                t && t.animManager.assignSymbol(h, !1, function() {
                    t.remove()
                })
            }),
            t()
        })
    }
    ,
    t.triggerGlyphTrap = function(e, t) {
        t.push(function(t) {
            var i = window.background.getDataOfZoneId("mark:" + e.markId);
            return i ? (e._spellId = i.spellId,
            window.gui.transmitFightSequenceMessage(e),
            t()) : (console.warn("No data found for zone: mark:" + e.markId),
            t())
        })
    }
    ,
    t.syncMarks = function(e) {
        for (var t = 0; t < e.length; t++)
            o(e[t])
    }
    ,
    t.getMarkedCells = function() {
        for (var e = {}, t = Object.keys(d), i = 0; i < t.length; i++)
            for (var n = d[t[i]], o = 0; o < n.cells.length; o++)
                e[n.cells[o].cellId] = !0;
        return e
    }
}
, function(e, t) {
    t.setVisibility = function(e, t) {
        var i = window.actorManager
          , n = i.getActor(e.targetId);
        n && t.push(function(t) {
            window.gui.transmitFightSequenceMessage(e);
            var i = n.getFighterData();
            return n.setInvisibility(e.state, i.teamId),
            t()
        })
    }
    ,
    t.vanish = function(e, t) {
        var i = window.actorManager
          , n = i.getActor(e.targetId);
        return n ? void t.push(function(t) {
            window.gui.transmitFightSequenceMessage(e),
            n.oneShootAnim({
                base: "AnimVanish"
            }, !1, function() {
                return i.removeActor(e.targetId),
                t()
            })
        }) : console.warn("No found actor with id " + e.targetId)
    }
    ,
    t.detected = function(e, t) {
        var i = window.actorManager
          , n = i.getActor(e.targetId);
        if (!n)
            return console.error("No found actor with id " + e.targetId);
        var o = n.getFighterData()
          , s = i.userActor.getFighterData();
        o.teamId !== s.teamId && t.push(function(e) {
            return n.invisibleDetectedAnimation(),
            e()
        })
    }
}
, function(e, t, i) {
    function n(e) {
        var t = e.riderEntity || e.animManager;
        t.removeAnimationModifier("AnimStatique"),
        t.removeAnimationModifier("AnimMarche"),
        t.removeAnimationModifier("AnimCourse"),
        t.removeAnimationModifier("AnimHit"),
        t.removeAnimationModifier("AnimTacle"),
        t.removeSubentity(e.carriedEntity),
        e.carriedActor.parentActor = null ,
        e.carriedEntity = null ,
        e.carriedActor = null
    }
    var o = i(263)
      , s = i(261).Delay
      , a = 3;
    t.carryCharacter = function(e, t) {
        var i = window.actorManager
          , n = i.getActor(e.sourceId)
          , s = i.getActor(e.targetId);
        if (n && s) {
            var r = {
                base: "AnimPickup",
                direction: e._direction
            }
              , l = n.riderEntity || n.animManager;
            t.push(function(e) {
                l.addAnimationModifier("AnimStatique", "AnimStatiqueCarrying"),
                l.addAnimationModifier("AnimMarche", "AnimMarcheCarrying"),
                l.addAnimationModifier("AnimCourse", "AnimCourseCarrying"),
                l.addAnimationModifier("AnimHit", "AnimHitCarrying"),
                l.addAnimationModifier("AnimTacle", "AnimTacleCarrying");
                var t = {
                    animManager: s.animManager,
                    bindingPoint: "carried_3_0",
                    symbolModifier: o[a],
                    bindingPointCategory: a
                };
                s.parentActor = n,
                n.carriedEntity = t,
                n.carriedActor = s,
                l.addSubentity(t),
                s.setDisposition(n.cellId),
                s.getFighterData().isCarryied = !0,
                s.y = -1e3,
                n.oneShootAnim(r, !0, e)
            })
        }
    }
    ,
    t.removeCarrying = n,
    t.throwCharacter = function(e, t) {
        var i = window.actorManager
          , o = i.getActor(e.targetId)
          , a = i.getActor(e.sourceId);
        if (a && o) {
            var r = e.cellId
              , l = {
                base: "AnimThrow",
                direction: e._direction
            };
            t.push(function(e) {
                a.oneShootAnim(l, !1, function() {
                    n(a),
                    a.staticAnim(),
                    o.getFighterData().isCarryied = !1
                });
                var t = new s(7,e);
                t.start(!1)
            }),
            r !== -1 && (t.push(function(t) {
                e._throwingProjectile.launch(r, 13, .3, 70, t)
            }),
            t.push(function(t) {
                return o.setDisposition(r),
                window.gui.transmitFightSequenceMessage(e),
                t()
            }))
        }
    }
    ,
    t.dropCharacter = function(e, t) {
        var i = window.actorManager
          , o = i.getActor(e.sourceId)
          , s = i.getActor(e.targetId);
        if (o) {
            var a = {
                base: "AnimDrop",
                direction: e._direction
            };
            t.push(function(t) {
                o.oneShootAnim(a, !1, function() {
                    return n(o),
                    s.setDisposition(e.cellId),
                    s.getFighterData().isCarryied = !1,
                    o.staticAnim(),
                    window.gui.transmitFightSequenceMessage(e),
                    t()
                })
            })
        }
    }
}
, function(e, t, i) {
    function n() {
        this._queue = [],
        this._actionMap = {},
        this._isActive = !1,
        this._currentActionId = null ,
        this._endOfQueueOnly = !1
    }
    var o = i(36)
      , s = null ;
    e.exports = n,
    n.prototype.initialize = function() {
        s || o.getAllDataMap("Interactives", function(e, t) {
            if (e)
                return void console.error(new Error("ActionQueue.staticContent.getAllDataMap: " + e));
            s = {};
            for (var i in t)
                1 !== t[i].actionId && (s[i] = !0);
            s[-1] = !0
        })
    }
    ,
    n.prototype.enqueue = function(e, t, i) {
        return !!this.canQueueMore() && (this._isActive ? !!this._actionMap[e] || (this._queue.push({
            actionId: e,
            action: i,
            endOfQueueOnly: t
        }),
        this._actionMap[e] = !0,
        !0) : (this._isActive = !0,
        this._actionMap[e] = !0,
        this._currentActionId = e,
        this._endOfQueueOnly = t,
        i(),
        !0))
    }
    ,
    n.prototype.enqueueInteractive = function(e, t, i) {
        var n = s && s[t] || !1;
        return this.enqueue(e, n, i)
    }
    ,
    n.prototype.dequeue = function(e) {
        if (this._isActive && this._isCurrentAction(e)) {
            delete this._actionMap[e];
            var t = this._queue.shift();
            if (!t)
                return void this.clear();
            this._currentActionId = t.actionId,
            this._endOfQueueOnly = t.endOfQueueOnly,
            t.action()
        }
    }
    ,
    n.prototype.canQueueMore = function() {
        if (!this._isActive)
            return !0;
        var e;
        return e = this._queue.length > 0 ? !this._queue[this._queue.length - 1].endOfQueueOnly : !this._endOfQueueOnly
    }
    ,
    n.prototype.isActive = function() {
        return this._isActive
    }
    ,
    n.prototype._isCurrentAction = function(e) {
        return this._currentActionId === e
    }
    ,
    n.prototype.clear = function() {
        this._queue = [],
        this._actionMap = {},
        this._isActive = !1,
        this._currentActionId = null ,
        this._endOfQueueOnly = !1
    }
}
, function(e, t, i) {
    function n(e, t) {
        return t.position - e.position
    }
    function o(e) {
        switch (e) {
        case 183:
        case 200:
        case 212:
        case 213:
            return !0;
        default:
            return !1
        }
    }
    function s(e, t) {
        var i = {
            red: 1,
            green: 1,
            blue: 1
        }
          , n = {
            red: 1.8,
            green: 1.8,
            blue: 1.8
        }
          , o = new y(e.highlight,["red", "green", "blue"]);
        o.from(i);
        for (var s = 0; s < t; s++)
            o.to(n, 12),
            o.to(i, 12);
        o.start()
    }
    var a = i(6)
      , r = i(1014)
      , l = i(626)
      , c = i(35).getText
      , u = i(35).getTextFailover
      , h = i(1044)
      , d = i(1051)
      , p = i(610)
      , m = i(1043)
      , f = i(217).FIGHT_STATES
      , g = i(1052).trueName
      , _ = i(261)
      , v = _.Delay
      , y = _.Tween
      , w = _.easing
      , b = {
        red: 1.7,
        green: 1.7,
        blue: 1.7,
        alpha: 1
    }
      , C = 10
      , I = {
        DEFAULT: 1,
        QUEUE: 2
    }
      , T = [{
        elementTypeId: 16,
        skillId: 114
    }, {
        elementTypeId: -1,
        skillId: 84
    }, {
        elementTypeId: -1,
        skillId: 104
    }, {
        elementTypeId: 120,
        skillId: 175
    }]
      , S = 3e3
      , A = {}
      , E = null
      , x = 4
      , M = 4
      , N = new Uint8Array(x * M * 4)
      , R = null ;
    r.prototype._isElementClicked = function(e, t, i) {
        if (!e.isWithinBounds(t, i))
            return !1;
        var n = x
          , o = M;
        t -= n / 2,
        i -= o / 2;
        var s = e.renderer;
        null === R && (R = s.startTextureUsage(n, o, 1, "clickedInteractive")),
        s.startTextureRendering(R, t, t + n, i, i + o, !0),
        e.render();
        var a = s.gl;
        a.readPixels(0, 0, n, o, a.RGBA, a.UNSIGNED_BYTE, N),
        s.stopTextureRendering();
        for (var r = N.length, l = 0, c = 3; c < r; c += 4)
            l += N[c];
        return l > 8
    }
    ,
    r.prototype._getAllInteractives = function() {
        for (var e = this.mapRenderer, t = e.identifiedElements, i = e.interactiveElements, o = this.actorManager.actors, s = [], a = Object.keys(i), r = 0; r < a.length; r += 1) {
            var l = a[r]
              , c = i[l];
            if (0 !== c.enabledSkills.length || 0 !== c.disabledSkills.length) {
                var u = t[l];
                u && s.push(u)
            }
        }
        for (var h = Object.keys(o), d = 0; d < h.length; d += 1)
            s.push(o[h[d]]);
        return s.push(this.actorManager.userActor),
        s.sort(n),
        s
    }
    ,
    r.prototype._tapInteractive = function(e, t) {
        for (var i = this.mapRenderer.interactiveElements, n = this._getAllInteractives(), s = window.gui.playerData.isAlive(), a = null , r = null , l = null , c = 0; c < n.length; c++) {
            var u = n[c];
            if (this._isElementClicked(u, e, t))
                if (u.actorId)
                    if (u.data && u.data.npcId) {
                        if (!a) {
                            var h = u.data.npcData && u.data.npcData.actions && u.data.npcData.actions.length > 0;
                            (s || h) && (a = u)
                        }
                    } else
                        l || (l = u);
                else
                    r || (r = u)
        }
        var d = a || r || l;
        if (null === d)
            return this._lastTapId = null ,
            !1;
        var p = !1
          , m = d.id || d.actorId
          , f = g([d._position, window.gui.playerData.position.mapId, m]);
        f === this._lastTapId ? (p = !0,
        this._lastTapId = null ) : this._lastTapId = f,
        this.clearHighlights(null , I.DEFAULT);
        var _ = this.actionQueue.isActive();
        if (d.tap)
            return _ || (p && d.actorId && "GameRolePlayGroupMonsterInformations" === d.data.type ? window.isoEngine.attackActor(d.actorId) : d.tap(e, t)),
            !0;
        var v = i[d.id];
        if (!v)
            return !0;
        var y = v.enabledSkills[0];
        if (1 === v.enabledSkills.length && !o(y.skillId)) {
            var w = this
              , b = this.actionQueue.enqueueInteractive(v.elementId, v.elementTypeId, function() {
                var e = v.enabledSkills
                  , t = 1 === e.length && e[0];
                return t ? void w.queueUseInteractive(v.elementId, t.skillInstanceUid) : (w.actionQueue.clear(),
                w.clearHighlights(null , I.QUEUE))
            });
            return b ? (this._addHighlight(d, I.QUEUE),
            !0) : (_ || (this.instantUseInteractive(v.elementId, y.skillInstanceUid),
            this._addHighlight(d)),
            !0)
        }
        if (_)
            return !0;
        if (this._addHighlight(d),
        p)
            for (var C = 0; C < T.length; C++)
                if (v.elementTypeId === T[C].elementTypeId)
                    for (var S = 0; S < v.enabledSkills.length; S++)
                        if (v.enabledSkills[S].skillId === T[C].skillId)
                            return this.instantUseInteractive(v.elementId, y.skillInstanceUid),
                            !0;
        var A = this.mapScene.convertSceneToCanvasCoordinate(e, t);
        return window.gui.openContextualMenu("interactive", v, {
            x: A.x,
            y: A.y
        }),
        !0
    }
    ,
    r.prototype._addHighlight = function(e, t) {
        t = t || I.DEFAULT,
        e.highlight = b,
        this.highlightedElements[t] || (this.highlightedElements[t] = []),
        this.highlightedElements[t].push(e)
    }
    ,
    r.prototype._clearHighlightType = function(e) {
        var t = this.highlightedElements[e];
        if (t) {
            for (var i = 0; i < t.length; i++)
                t[i].highlight = null ;
            this.highlightedElements[e] = []
        }
    }
    ,
    r.prototype.clearHighlights = function(e, t) {
        if (e) {
            var i = this
              , n = new v(e,function() {
                i.clearHighlights(null , t)
            }
            );
            return n.start()
        }
        if (t)
            this._clearHighlightType(t);
        else {
            for (var o in this.highlightedElements)
                this._clearHighlightType(o);
            this.highlightedElements = {}
        }
    }
    ,
    r.prototype.queueUseInteractive = function(e, t) {
        this.clearHighlights(null , I.DEFAULT),
        this._useInteractive(e, t)
    }
    ,
    r.prototype.instantUseInteractive = function(e, t) {
        this.clearHighlights(C),
        this._useInteractive(e, t)
    }
    ,
    r.prototype.useInteractive = function(e, t) {
        this.clearHighlights(),
        this._useInteractive(e, t)
    }
    ,
    r.prototype._useInteractive = function(e, t) {
        var i = this
          , n = this.mapRenderer.identifiedElements[e]
          , o = n.position
          , s = this.actorManager.userActor
          , a = function() {
            var n = l.getOrientation(s.cellId, o, !1);
            s.setDisposition(null , n),
            i._interactiveUseTrackServerAnswer(e, t),
            window.dofus.sendMessage("InteractiveUseRequestMessage", {
                elemId: e,
                skillInstanceUid: t
            })
        };
        return l.areCellsNeighbours(s.cellId, o, !0) ? a() : void this._movePlayerOnMap(o, !0, a)
    }
    ,
    r.prototype.onInteractiveUseErrorMessage = function(e) {
        var t = e.elemId;
        void 0 !== A[t] && (window.clearTimeout(A[t]),
        delete A[t]),
        this.actionQueue.clear();
        var i = this.mapRenderer.identifiedElements[t];
        i && (i.highlight = null )
    }
    ,
    r.prototype._interactiveUseTrackServerAnswer = function(e) {
        var t = this;
        A[e] = window.setTimeout(function() {
            console.warn("Server has been too slow to answer to an interactiveUseRequest: we are not waiting for him"),
            delete A[e],
            t.actionQueue.clear()
        }, S)
    }
    ,
    r.prototype.isWaitingForInteractiveUseServerAnswer = function() {
        return Object.keys(A).length > 0
    }
    ,
    r.prototype.interactiveUseStart = function(e) {
        var t = this
          , i = this.actorManager.getActor(e.entityId)
          , n = this.mapRenderer.identifiedElements[e.elemId]
          , o = e.entityId === window.gui.playerData.id
          , s = 0 !== e.duration;
        if (o && (void 0 !== A[e.elemId] && (window.clearTimeout(A[e.elemId]),
        delete A[e.elemId]),
        null !== E && (console.error("interactiveUseStart: InteractiveUseStart received but was waiting an InteractiveUseEnded"),
        this._userStopUsingInteractive())),
        !i)
            return o ? console.error("interactiveUseStart: user actor is not ready") : console.warn("interactiveUseStart: no actor with id " + e.entityId);
        if (!n)
            return console[o ? "error" : "warn"]("interactiveUseStart: no interactive with id " + e.elemId);
        var a = e._useAnimation;
        if (!a || "AnimStatique" === a)
            return void (o && t.actionQueue.dequeue(e.elemId));
        n.highlight = null ;
        var r = l.getOrientation(i.cellId, n.position, !1);
        return i.setDisposition(null , r),
        i.loadAndPlayAnimation({
            base: a
        }, s),
        s ? void (o ? (i.isLocked = !0,
        E = window.setTimeout(function() {
            t._userStopUsingInteractive(e.elemId)
        }, 100 * e.duration * 2)) : window.setTimeout(function() {
            i.staticAnim()
        }, 100 * e.duration)) : void (o && t.actionQueue.dequeue(e.elemId))
    }
    ,
    r.prototype.interactiveUseEndedMessage = function(e) {
        this._userStopUsingInteractive(e.elemId)
    }
    ,
    r.prototype._userStopUsingInteractive = function(e) {
        null !== E && (clearTimeout(E),
        E = null );
        var t = this.actorManager.userActor;
        t.isLocked = !1,
        t.staticAnim(),
        this.actionQueue.dequeue(e)
    }
    ,
    r.prototype.updateInteractiveElements = function(e) {
        this.mapRenderer.updateInteractiveElements(e)
    }
    ,
    r.prototype.updateObstacles = function(e) {
        this.mapRenderer.updateObstacles(e)
    }
    ,
    r.prototype.updateStatedElements = function(e) {
        this.mapRenderer.updateStatedElements(e)
    }
    ,
    r.prototype.addObjects = function(e) {
        this.mapRenderer.addObjects(e)
    }
    ,
    r.prototype.removeObjects = function(e) {
        this.mapRenderer.removeObjects(e)
    }
    ,
    r.prototype._removeArrowsNowAndLater = function(e) {
        this.removeArrows(),
        this.arrowTimeout && (window.clearTimeout(this.arrowTimeout),
        this.arrowTimeout = null );
        var t = this;
        this.arrowTimeout = window.setTimeout(function() {
            t.arrowTimeout = null ,
            t.removeArrows()
        }, e)
    }
    ,
    r.prototype.addArrowOnCell = function(e, t, i, n, o) {
        this.mapRenderer.addArrowOnCell(e, t, i, n, o)
    }
    ,
    r.prototype.addArrowOnGraphic = function(e, t, i, n, o) {
        this.mapRenderer.addArrowOnGraphic(e, t, i, n, o)
    }
    ,
    r.prototype.addArrowsSequence = function(e, t, i, n) {
        this.mapRenderer.addArrowsSequence(e, t, i, n)
    }
    ;
    var O = {
        upLeft: {
            npc: [-.3, -3],
            monster: [-.5, -2]
        },
        downLeft: {
            npc: [-.5, -.3],
            monster: [-.5, .5]
        }
    };
    r.prototype._addArrowOnActor = function(e, t, i) {
        var n = t ? "monster" : "npc"
          , o = "upLeft"
          , s = O[o][n]
          , r = s[0]
          , l = s[1];
        e.y + l < 60 && (o = "downLeft",
        s = O[o][n],
        r = s[0],
        l = s[1]),
        i && this._removeArrowsNowAndLater(i),
        this.mapRenderer.addArrowOnCell(e.cellId, r * a.CELL_WIDTH, l * a.CELL_HEIGHT, o)
    }
    ,
    r.prototype.addArrowOnNpc = function(e, t) {
        var i = this.actorManager.getActorFromNpcId(e);
        return i ? void this._addArrowOnActor(i, !1, t) : console.warn("NPC not found with ID: " + e)
    }
    ,
    r.prototype.addArrowOnMonster = function(e, t) {
        var i = this.actorManager.getActorFromMonsterId(e);
        return i ? void this._addArrowOnActor(i, !0, t) : console.warn("Monster not found with ID: " + e)
    }
    ,
    r.prototype.removeArrows = function() {
        this.mapRenderer.removeArrows()
    }
    ,
    r.prototype.highlightAllInteractives = function(e) {
        e = e || 1;
        var t = this.mapRenderer.interactiveElements
          , i = this.mapRenderer.identifiedElements
          , n = window.gui.fightManager.fightState
          , o = n === f.PREPARATION || n === f.BATTLE;
        for (var a in t) {
            var r = t[a]
              , l = i[a]
              , c = l instanceof p;
            l && (o && !c || 0 === r.enabledSkills.length && 0 === r.disabledSkills.length || s(l, e))
        }
    }
    ,
    r.prototype.highlightInteractivesWithDifferentType = function() {
        var e, t, i = this.mapRenderer.interactiveElements, n = this.mapRenderer.identifiedElements, o = {};
        for (e in i) {
            var a = i[e]
              , r = n[e];
            r && 0 !== a.enabledSkills.length && (t = a.elementTypeId,
            o[t] || (o[t] = []),
            o[t].push(r))
        }
        var l = [];
        for (t in o)
            if (~~t === -1)
                l = l.concat(o[t]);
            else {
                var c = o[t].length
                  , u = ~~(Math.random() * c);
                l.push(o[t][u])
            }
        for (var h = 0; h < l.length; h++)
            s(l[h], 5)
    }
    ,
    r.prototype.displayNumericalValue = function(e) {
        var t = this.actorManager.getActor(e.entityId);
        if (!t)
            return console.error("No entity with id", e.entityId);
        var i = t.x
          , n = t.y - 80;
        m.createPointVariationLabel({
            x: i,
            y: n,
            pointVariation: "+" + e.value,
            color: [.2, -.1, -.2, 0],
            maxRotation: .4
        }),
        e.valueOfBonus && m.createPointVariationLabel({
            x: i,
            y: n,
            pointVariation: "+" + e.valueOfBonus,
            color: [.7, 0, -.3, 0],
            maxRotation: .4,
            delay: 17
        })
    }
    ;
    var P = 0;
    r.prototype.displayTextBanner = function(e) {
        if (this.bitmapFonts && !window.gui.fightManager.isInactive) {
            var t = c(e)
              , i = u(e)
              , n = this.mapScene
              , o = n.w / 2
              , s = n.h / 2
              , r = this.bitmapFonts.characters
              , l = new h({
                x: o,
                y: s,
                scene: n,
                text: t,
                fallbackText: i,
                position: 2 * P + 1,
                layer: a.MAP_LAYER_POINT_LABELS,
                bitmapFont: r,
                color: [.2, .5, -.2, 0],
                isHudElement: !0
            })
              , p = r.dimensions.bann
              , m = l.textWidth
              , f = l.textHeight
              , g = p.h
              , _ = p.w
              , v = 2
              , b = Math.floor(_ / 2 - v)
              , C = p.x
              , I = p.y
              , T = new d({
                x: o,
                y: s - f / 2,
                scene: n,
                position: 2 * P,
                layer: a.MAP_LAYER_POINT_LABELS,
                texture: r.texture,
                controlPoints: [{
                    x: -m / 2 - b,
                    u: C,
                    y: 0,
                    v: I
                }, {
                    x: -m / 2,
                    u: C + b,
                    y: 0,
                    v: I
                }, {
                    x: m / 2,
                    u: C + b + v,
                    y: g,
                    v: I + g
                }, {
                    x: m / 2 + b,
                    u: C + _,
                    y: g,
                    v: I + g
                }],
                isHudElement: !0
            })
              , S = new y(l,["y", "alpha"]).from({
                y: s - 30,
                alpha: 0
            }).to({
                y: s - 30,
                alpha: 0
            }, 4).to({
                y: s,
                alpha: 1
            }, 8, w.backOut, 2).to({
                y: s,
                alpha: 1
            }, 17).to({
                y: s - 30,
                alpha: 0
            }, 8, w.backIn, 2).onFinish(function() {
                l.remove()
            }).start()
              , A = new y(T,["scaleX", "alpha"]).from({
                scaleX: .7,
                alpha: 0
            }).to({
                scaleX: 1,
                alpha: 1
            }, 8, w.backOut, 2).to({
                scaleX: 1,
                alpha: 1
            }, 24).to({
                scaleX: .7,
                alpha: 0
            }, 8, w.backIn, 2).onFinish(function() {
                T.remove()
            }).start();
            P += 1,
            null !== this._currentBannerTweens.backTween && (this._currentBannerTweens.backTween.starting || this._currentBannerTweens.backTween.playing) && (this._currentBannerTweens.backTween.reset().to({
                scaleX: .7,
                alpha: 0
            }, 8, w.polyOut, 2).start(),
            this._currentBannerTweens.textTween.reset().to({
                y: s - 30,
                alpha: 0
            }, 8, w.polyOut, 2).start()),
            this._currentBannerTweens.backTween = A,
            this._currentBannerTweens.textTween = S
        }
    }
    ,
    r.prototype.highlightActorOnAction = function(e, t) {
        var i = this.actorManager.getActor(e);
        return i ? (this._addHighlight(i),
        void this.clearHighlights(t || C)) : console.warn("Actor with id " + e + " to highlight not found.")
    }
    ,
    r.prototype.interactiveDisconnect = function() {
        for (var e = Object.keys(A), t = 0; t < e.length; t++)
            window.clearTimeout(A[e[t]]),
            delete A[e[t]];
        this.actionQueue.clear()
    }
}
, function(e, t, i) {
    function n(e) {
        e.id = "grid9ScaleCount" + a++,
        s.call(this, e),
        this._spriteByteSize = this.renderer.getNbBytesPerSprite(),
        this._bbox = [1 / 0, -(1 / 0), 1 / 0, -(1 / 0)],
        this.controlPoints = e.controlPoints;
        var t = this.controlPoints[0]
          , i = this.controlPoints[3];
        this.w = i.x - t.x,
        this.h = i.y - t.y,
        this._bbox[0] = t.x,
        this._bbox[1] = i.x,
        this._bbox[2] = t.y,
        this._bbox[3] = i.y,
        this.texture = e.texture,
        this._createVertexBuffer()
    }
    var o = i(26).inherits
      , s = i(244)
      , a = 0;
    o(n, s),
    e.exports = n,
    n.prototype._populateSpriteVertexBuffer = function(e, t, i, n, o, s, a, r, l) {
        var c = this._floatView
          , u = this._longView
          , h = this._longView
          , d = this.texture.element.width
          , p = this.texture.element.height
          , m = e * this._spriteByteSize / 4;
        c[m + 0] = t,
        c[m + 1] = s,
        c[m + 5] = t,
        c[m + 6] = r,
        c[m + 10] = n,
        c[m + 11] = r,
        c[m + 15] = t,
        c[m + 16] = s,
        c[m + 20] = n,
        c[m + 21] = r,
        c[m + 25] = n,
        c[m + 26] = s;
        var f = i / d * 65535 & 65535
          , g = o / d * 65535 & 65535
          , _ = a / p * 4294901760 & 4294901760
          , v = l / p * 4294901760 & 4294901760;
        u[m + 2] = f + _,
        u[m + 7] = f + v,
        u[m + 12] = g + v,
        u[m + 17] = f + _,
        u[m + 22] = g + v,
        u[m + 27] = g + _;
        var y = 1077952576;
        h[m + 3] = h[m + 8] = h[m + 13] = y,
        h[m + 18] = h[m + 23] = h[m + 28] = y
    }
    ,
    n.prototype._createVertexBuffer = function() {
        this._vertexBuffer = new ArrayBuffer(9 * this._spriteByteSize),
        this._floatView = new Float32Array(this._vertexBuffer),
        this._longView = new Uint32Array(this._vertexBuffer);
        var e = this.controlPoints[0]
          , t = this.controlPoints[1]
          , i = this.controlPoints[2]
          , n = this.controlPoints[3];
        this._populateSpriteVertexBuffer(0, e.x, e.u, t.x, t.u, e.y, e.v, t.y, t.v),
        this._populateSpriteVertexBuffer(1, t.x, t.u, i.x, i.u, e.y, e.v, t.y, t.v),
        this._populateSpriteVertexBuffer(2, i.x, i.u, n.x, n.u, e.y, e.v, t.y, t.v),
        this._populateSpriteVertexBuffer(3, e.x, e.u, t.x, t.u, t.y, t.v, i.y, i.v),
        this._populateSpriteVertexBuffer(4, t.x, t.u, i.x, i.u, t.y, t.v, i.y, i.v),
        this._populateSpriteVertexBuffer(5, i.x, i.u, n.x, n.u, t.y, t.v, i.y, i.v),
        this._populateSpriteVertexBuffer(6, e.x, e.u, t.x, t.u, i.y, i.v, n.y, n.v),
        this._populateSpriteVertexBuffer(7, t.x, t.u, i.x, i.u, i.y, i.v, n.y, n.v),
        this._populateSpriteVertexBuffer(8, i.x, i.u, n.x, n.u, i.y, i.v, n.y, n.v),
        this.renderer.releaseBuffer(this.id),
        this.forceRefresh()
    }
    ,
    n.prototype.draw = function() {
        this.renderer.drawSpriteBatch(this.id)
    }
    ,
    n.prototype.generateCurrentFrameData = function() {
        var e = this.renderer.getBufferData(this.id);
        if (void 0 === e) {
            var t = this._floatView
              , i = !1;
            this.renderer.loadSpriteBuffer(this.id, t, this.texture, this.bbox, i),
            this.renderer.lockBuffer(this.id)
        }
        return this._bbox
    }
    ,
    n.prototype.clear = function() {
        this.renderer.releaseBuffer(this.id)
    }
}
, function(e, t) {
    var i = Array.isArray;
    t.emaNeurt = function(e) {
        return t.trueName(e, "")
    }
    ,
    t.trueName = function n(e, t) {
        var o = (typeof e)[0]
          , s = "";
        if (t) {
            if ("object" == typeof t && (t = t.valueOf()),
            "string" != typeof t)
                throw new TypeError("Invalid type for salt: must be a string");
            s = t
        }
        var a = e;
        if ("o" === o && null !== e && (a = e.valueOf()),
        o = (typeof a)[0],
        "o" !== o || null === a)
            return s.concat(o, a);
        if (a instanceof Date)
            return s.concat("d", a.toJSON());
        if (a instanceof RegExp)
            return s.concat("r", a.toString());
        if ("f" === o)
            throw new TypeError("Invalid type: function");
        i(a) && (o = "a");
        var r, l;
        r = Object.keys(a),
        r.sort();
        for (var c = 0; c < r.length; c += 1)
            l = r[c],
            s = s.concat(o, l, n(a[l]));
        return s
    }
}
, function(e, t, i) {
    function n(e, t) {
        e ? (w = !0,
        window.foreground.showInfobox(e, t)) : w && (w = !1,
        window.foreground.hideInfobox())
    }
    function o() {
        v = null ,
        b = null ,
        n(!1)
    }
    function s() {
        y = null ,
        o()
    }
    function a(e, t, i) {
        var n = i[t];
        if (!n)
            return null ;
        if (!n.path) {
            for (var o = t, s = [], a = {}, r = [], l = {}, c = 0, u = 0, h = 0; o !== e; ) {
                var d = i[o];
                d.reachable ? (s.unshift(o),
                a[o] = h) : (r.unshift(o),
                l[o] = h),
                c += d.mp,
                u += d.ap,
                o = d.from,
                h += 1
            }
            n.path = {
                reachable: s,
                unreachable: r,
                mp: c,
                ap: u,
                reachableMap: a,
                unreachableMap: l
            }
        }
        return n.path
    }
    var r = i(1014)
      , l = i(1054)
      , c = i(625).compressPath
      , u = i(1037)
      , h = i(626)
      , d = i(84).playUiSound
      , p = i(65)
      , m = i(66)
      , f = i(1055)
      , g = i(25)
      , _ = i(1052).trueName
      , v = null
      , y = null
      , w = !1
      , b = null
      , C = new u;
    r.prototype.fightTurnStart = function(e) {
        this._previousTurn = this._isUserTurn,
        this._isUserTurn = e,
        window.background.hideTargetHighlights(),
        this._resetFightPositionLayer(),
        this._previousTurn !== this._isUserTurn && (e ? this._enemyToUserTurn() : this._userToEnemyTurn()),
        this._resetWalkLayer(),
        s()
    }
    ,
    r.prototype._switchTurn = function(e, t, i, n, o) {
        if (this._spellRangeLayer) {
            for (var s = {}, a = this._spellRangeLayer.cellInfos, r = Object.keys(a), l = 0; l < r.length; l++) {
                var c = a[r[l]];
                c.transformState === e ? s[c.cellId] = new p(c.cellId,c.distanceToPlayer,t) : c.transformState === i && (s[c.cellId] = new p(c.cellId,c.distanceToPlayer,n))
            }
            0 !== Object.keys(s).length && this._resetSpellRangeLayer(s)
        }
        if (this._spellEffectLayer) {
            for (s = {},
            a = this._spellEffectLayer.cellInfos,
            r = Object.keys(a),
            l = 0; l < r.length; l++)
                c = a[r[l]],
                s[c.cellId] = new p(c.cellId,c.distanceToPlayer,o);
            this._resetSpellEffectLayer(s)
        }
    }
    ,
    r.prototype._enemyToUserTurn = function() {
        window.background.showTargetHighlights(),
        window.foreground.confirmBox.show(),
        this._switchTurn(m.inSightEnemyTurn, m.inSight, m.outSightEnemyTurn, m.outSight, m.areaOfEffect)
    }
    ,
    r.prototype._userToEnemyTurn = function() {
        this._switchTurn(m.inSight, m.inSightEnemyTurn, m.outSight, m.outSightEnemyTurn, m.areaOfEffectEnemyTurn)
    }
    ,
    r.prototype.touchCancel = function() {
        this.clearHighlights(),
        s()
    }
    ,
    r.prototype.touchMove = function(e, t, i) {
        var n = this.mapScene.convertCanvasToSceneCoordinate(e, t)
          , o = this.mapRenderer.getCellId(n.x, n.y).cell;
        if (v !== o)
            if (v = o,
            "fight" === i.mode && void 0 !== i.spellId)
                this.displayEffectZone(o);
            else if ("fight" === i.mode && this._isUserTurn) {
                var s = this.actorManager.occupiedCells;
                s[o] ? this._resetWalkLayer() : (window.foreground.confirmBox.close(),
                b = this._displayPathInFight(o))
            }
    }
    ,
    r.prototype._displayPathInFight = function(e) {
        var t = this.actorManager.userActor
          , i = t.cellId;
        y = y || l.getReachableZone(t, i);
        var s = e;
        if (!y[e]) {
            var r = h.getMapPointFromCellId(i)
              , c = h.getMapPointFromCellId(s);
            C.set(r.x, r.y, c.x, c.y),
            C.exec(function(e, t) {
                var i = h.getCellIdFromMapPoint(e, t);
                y[i] ? s = i : C.stop()
            })
        }
        var u = a(i, s, y);
        if (!u)
            return o();
        for (var d = u.reachable[u.reachable.length - 1], f = {}, g = 0; g < u.reachable.length; g++)
            f[u.reachable[g]] = new p(u.reachable[g],u.reachableMap[u.reachable[g]],m.walkable);
        for (var _ = 0; _ < u.unreachable.length; _++)
            f[u.unreachable[_]] = new p(u.unreachable[_],u.unreachableMap[u.unreachable[_]],m.unwalkable);
        return u.reachable.length > 0 && (f[d] = new p(d,0,m.walkableLast)),
        window.background.removeTargetHighlights(),
        this._resetWalkLayer(f),
        u.mp > 0 || u.ap > 0 ? n("tackle", {
            ap: u.ap,
            mp: u.mp
        }) : n(!1),
        u
    }
    ,
    r.prototype.touchEnd = function(e, t, i) {
        i = i || {},
        i.canvasX = e,
        i.canvasY = t;
        var n = this.mapScene.convertCanvasToSceneCoordinate(e, t)
          , o = this.mapRenderer
          , s = o.getCellId(n.x, n.y)
          , a = o.getCellSceneCoordinate(s.cell);
        o.addTapFeedback(a.x, a.y),
        this._touchEnd(n.x, n.y, s, i)
    }
    ;
    var I = null ;
    r.prototype.cellHover = function(e) {
        window.gui.playerData.isFighting && (this._hovering = !0,
        I !== e && (I = e,
        this.displayEffectZone(e)))
    }
    ,
    r.prototype.cellHoverRelease = function(e) {
        this._spellRangeLayer && this._spellRangeLayer.cellInfos.hasOwnProperty(e) ? g.confirmBoxWhenDragCasting ? this._castSpellImmediatelyConfirm(e) : (this._castSpellImmediately(e),
        this.clearSpellDisplay()) : this.clearSpellDisplay(),
        this._hovering = !1,
        this._isUserTurn && !g.confirmBoxWhenDragCasting && this.displayUserMovementZone()
    }
    ,
    r.prototype._touchEnd = function(e, t, i, n) {
        n.hasOwnProperty("mode") && (window.gui.pingSystem.isActive() ? this._tapPing(e, t, i) : "fightPlacement" === n.mode ? this._tapFightPlacement(e, t, i, n) : "fight" === n.mode && void 0 !== n.spellId ? this._tapFightWithSpell(e, t, i, n) : "fight" === n.mode && this._isUserTurn ? this._tapFight(e, t, i, n) : "roleplay" === n.mode && this._tapRoleplay(e, t, i, n),
        s())
    }
    ,
    r.prototype._tapPing = function(e, t, i) {
        var n = window.gui.pingSystem;
        if (n.isPingBoxOpen())
            return n.cancelPingBox();
        var o = !0
          , s = this.actorManager.occupiedCells[i.cell] || [];
        s.length > 0 && (o = !1);
        var a = i.cell;
        n.openPingBox(a, o)
    }
    ,
    r.prototype._tapRoleplay = function(e, t, i, n) {
        var o = this
          , s = n.canvasX
          , a = n.canvasY
          , r = n.changeMapRequest
          , l = this.mapRenderer
          , c = this.actorManager.userActor
          , u = this.actionQueue.isActive();
        if (u) {
            var h = this._tapInteractive(e, t);
            if (!h && !c.moving) {
                if (r = r || l.getFirstMapFlag(i.cell)) {
                    var d = !0
                      , p = this.actionQueue.enqueue("changeMap", d, function() {
                        o.gotoNeighbourMap(r, i.cell, s, a)
                    });
                    return void (p && window.foreground.showBorderArrow(r, s, a))
                }
                if (this.isWaitingForInteractiveUseServerAnswer())
                    return
            }
        }
        if (!c.isLocked) {
            if (c.moving || this.isMovementWaitingForConfirmation) {
                if (window.foreground.hideBorderArrow(),
                u && !r && this._tapInteractive(e, t))
                    return;
                return this.clearHighlights(),
                this.actionQueue.clear(),
                void this.cancelUserActorMovement(function() {
                    o._touchEnd(e, t, i, n)
                })
            }
            if (!r) {
                if (this._tapInteractive(e, t))
                    return;
                var m = this.actorManager.occupiedCells[i.cell];
                if (m && m[0] && m[0].position === i)
                    return void (0 === i.dist && m[0].tap(e, t, l.camera))
            }
            this.clearHighlights();
            var f = i.cell;
            return (r = r || l.getFirstMapFlag(i.cell)) ? this.gotoNeighbourMap(r, i.cell, s, a) : void this._movePlayerOnMap(f)
        }
    }
    ,
    r.prototype._tapFightWithSpell = function(e, t, i, n) {
        var o = i.cell;
        window.foreground.fightIsUserTurn ? n.hideConfirmWindow = !1 : n.hideConfirmWindow = !0,
        g.confirmBoxWhenClickCasting ? this._castSpellConfirm(o, e, t, n) : this._castSpell(o, e, t, n)
    }
    ,
    r.prototype.displayUserMovementZone = function() {
        if (this.mapRenderer.isReady && !this._hovering && !window.gui.playerData.isSpectator) {
            this.clearSpellDisplay();
            var e = this.actorManager.userActor
              , t = e.cellId
              , i = y || l.getReachableZone(e, t);
            this.clearUserMovementZone();
            var n, o = {}, s = window.isoEngine.actorManager.userActor.cellId;
            for (var a in i) {
                var r, c = f.getDistance(s, a);
                r = i[a].reachable ? i[a].ap > 0 ? m.walkAreaRequiresAP : m.walkArea : m.walkAreaRestricted,
                o[a] = new p((~~a),c,r),
                n = !0
            }
            n && this._resetWalkAreaLayer(o)
        }
    }
    ,
    r.prototype.tryDisplayUserMovementZone = function() {
        return this._spellRangeLayer ? void this.displaySpellRange() : void this.displayUserMovementZone()
    }
    ,
    r.prototype.displayEnemyMovementZone = function(e) {
        if (this.mapRenderer.isReady) {
            this.clearSpellDisplay();
            var t = this.actorManager.getActor(e.id)
              , i = t.cellId
              , n = l.getReachableZone(t, i);
            this._resetWalkAreaLayer();
            for (var o, s = {}, a = Object.keys(n), r = 0; r < a.length; r++) {
                var c, u = a[r], h = f.getDistance(i, u);
                c = n[u].reachable ? n[u].ap > 0 ? m.enemyWalkAreaRequiresAP : m.enemyWalkArea : m.enemyWalkAreaRestricted,
                s[u] = new p((~~u),h,c),
                o = !0
            }
            o && this._resetEnemyWalkAreaLayer(s)
        }
    }
    ,
    r.prototype.removeEnemyMovementZone = function() {
        this._resetEnemyWalkAreaLayer(),
        this._isUserTurn && (window.foreground.isSpellSelected() ? window.foreground._displaySpellRange() : this.displayUserMovementZone())
    }
    ,
    r.prototype._tapFight = function(e, t, i) {
        function n(e) {
            return e ? (d.unshift(l),
            window.gui.emit("checkServerLag", "fightAction", "start"),
            window.dofus.sendMessage("GameMapMovementRequestMessage", {
                keyMovements: c(d),
                mapId: a
            }),
            h._resetWalkLayer(),
            void s()) : void h._resetWalkLayer()
        }
        var a = this.mapRenderer.map.id
          , r = i.cell
          , l = this.actorManager.userActor.cellId
          , u = window.foreground.confirmBox
          , h = this;
        if (this.actorManager.occupiedCells[r] || !this._isUserTurn)
            return o(),
            this._resetWalkLayer(),
            void u.close();
        if (b || (b = this._displayPathInFight(r)),
        !b || 0 === b.reachable.length || !v && b.reachable.indexOf(r) === -1 && b.unreachable.indexOf(r) === -1)
            return o(),
            this._resetWalkLayer(),
            void u.close();
        if (b) {
            var d = b.reachable
              , p = {
                mp: d.length + b.mp,
                ap: b.ap
            }
              , m = _(["move", p, d, r, a]);
            g.confirmBoxWhenWalking ? u.open("move", p, n, m) : n(!0)
        }
    }
    ,
    r.prototype._tapFightPlacement = function(e, t, i, n) {
        var o = this.actorManager.occupiedCells[i.cell];
        if (o)
            return void (0 === i.dist && o[0].tap(e, t, this.mapRenderer.camera));
        var s = i.cell
          , a = n.possiblePlacements || []
          , r = a.indexOf(s);
        r !== -1 && (window.dofus.sendMessage("GameFightPlacementPositionRequestMessage", {
            cellId: s
        }),
        d("FIGHT_POSITION"))
    }
    ;
    var T, S;
    r.prototype.holdStart = function() {
        this.highlightAllInteractives(5),
        T = this._getAllInteractives(),
        S = null
    }
    ,
    r.prototype.holdEnd = function() {
        this.clearHighlights(),
        this.removeEnemyMovementZone()
    }
    ,
    r.prototype.holdAndMove = function(e, t) {
        for (var i = this.mapScene.convertCanvasToSceneCoordinate(e, t), n = null , o = 0; o < T.length; o++) {
            var s = T[o];
            if (this._isElementClicked(s, i.x, i.y)) {
                n = s;
                break
            }
        }
        return n ? S === n ? n : (S = n,
        this.clearHighlights(),
        this._addHighlight(n),
        n) : (S = null ,
        void this.clearHighlights())
    }
}
, function(e, t, i) {
    function n(e, t) {
        var i = e.getFighter()
          , n = t.getFighter();
        return i && n ? i.data.stats.invisibilityState !== p && (i.data.stats.invisibilityState !== m && (i.data.teamId !== n.data.teamId && (i.data.alive !== !1 && (!i.data.isCarryied && (!i.hasState(g) && (!i.hasState(f) && i.canTackle)))))) : (console.warn("canBeTackler: Corresponding fighters could not be found."),
        !1)
    }
    function o(e) {
        var t = e.getFighter();
        return t ? t.data.stats.invisibilityState !== p && (t.data.stats.invisibilityState !== m && (!t.data.isCarryied && (!t.hasState(_) && !t.hasState(f)))) : (console.error("Corresponding fighter could not be found."),
        !1)
    }
    function s(e, t) {
        var i = Math.max(0, e.getFighterData().stats.tackleEvade || 0)
          , n = Math.max(0, t.getFighterData().stats.tackleBlock || 0);
        return (i + 2) / (n + 2) / 2
    }
    function a(e, t, i, a) {
        i = Math.max(0, i),
        a = Math.max(0, a);
        var r = {
            mp: 0,
            ap: 0
        };
        if (!o(e))
            return r;
        if (0 === t.length)
            return r;
        for (var l = 0; l < t.length; l++) {
            var c = t[l];
            if (c && n(c, e)) {
                var u = s(e, c);
                u >= 1 || (r.mp += ~~(i * (1 - u) + .5),
                r.ap += ~~(a * (1 - u) + .5))
            }
        }
        return r
    }
    function r(e, t, i, n, o, s) {
        this.cellId = e,
        this.availableMp = t,
        this.availableAp = i,
        this.tackleMp = n,
        this.tackleAp = o,
        this.distance = s
    }
    function l(e, t, i) {
        this.ap = e.ap,
        this.mp = e.mp,
        this.from = t,
        this.reachable = i,
        this.path = null
    }
    function c(e, t) {
        var i = {}
          , n = e.getFighterData()
          , o = n.stats
          , s = o.movementPoints;
        if (s <= 0)
            return i;
        var c = window.actorManager
          , h = window.isoEngine.mapRenderer
          , p = []
          , m = {}
          , f = new r(t,o.movementPoints,o.actionPoints,0,0,1);
        p.push(f),
        m[t] = f;
        for (var g = c.getIndexedVisibleActors(), _ = d.getMarkedCells(); p.length; ) {
            for (var v, y = p.pop(), w = y.cellId, b = u.getNeighbourCells(w, !1), C = [], I = 0; I < b.length; ) {
                v = b[I];
                var T = g[v];
                void 0 === v || T ? (b.splice(I, 1),
                T && C.push(T)) : I++
            }
            var S = a(e, C, y.availableMp, y.availableAp)
              , A = y.availableMp - S.mp - 1
              , E = y.availableAp - S.ap
              , x = y.tackleMp + S.mp
              , M = y.tackleAp + S.ap
              , N = y.distance + 1
              , R = A >= 0;
            for (_[w] && t !== w && (A = 0),
            I = 0; I < b.length; I++) {
                if (v = b[I],
                m[v]) {
                    var O = m[v];
                    if (O.availableMp > A)
                        continue;
                    if (O.availableMp === A && O.availableAp >= E)
                        continue
                }
                h.isWalkable(v, !0) && (i[v] = new l(S,w,R),
                f = new r(v,A,E,x,M,N),
                m[v] = f,
                y.distance < s && p.push(f))
            }
        }
        return i
    }
    var u = i(626)
      , h = i(233)
      , d = i(1034)
      , p = h.INVISIBLE
      , m = h.DETECTED
      , f = 6
      , g = 95
      , _ = 96;
    t.getReachableZone = c
}
, function(e, t, i) {
    function n(e, t) {
        var i = a(e)
          , n = a(t)
          , o = Math.abs(i.x - n.x) + Math.abs(i.y - n.y);
        return o
    }
    function o(e, t) {
        var i = a(e)
          , n = a(t)
          , o = i.x - n.x
          , s = i.y - n.y
          , r = Math.sqrt(o * o + s * s);
        return r
    }
    var s = i(626)
      , a = s.getMapPointFromCellId;
    e.exports.getCellDistance = n,
    e.exports.getDistance = o
}
, function(e, t, i) {
    function n(e, t, i, n) {
        for (var o = d(i), s = Object.keys(t), a = 0; a < s.length; a++) {
            for (var r = s[a], u = d(r), p = c.getLine(o.x, o.y, u.x, u.y), m = !1, f = 0, g = p.length; f < g; f++) {
                var _ = l(p[f].x, p[f].y)
                  , v = e[_];
                if (n[_] && f < g - 1 || 2 !== (2 & v.l)) {
                    m = !0;
                    break
                }
            }
            m && (t[r].transformState = window.foreground.fightIsUserTurn ? h.outSight : h.outSightEnemyTurn)
        }
        return t
    }
    var o = i(1014)
      , s = i(1040)
      , a = i(1052).trueName
      , r = i(626)
      , l = r.getCellIdFromMapPoint
      , c = i(1057)
      , u = i(65)
      , h = i(66)
      , d = r.getMapPointFromCellId
      , p = null
      , m = null ;
    o.prototype._initGridOverlayLayers = function() {
        this._fightPositionLayer = null ,
        this._spellRangeLayer = null ,
        this._spellEffectLayer = null ,
        this._walkLayer = null ,
        this._walkAreaLayer = null ,
        this._enemyWalkAreaLayer = null
    }
    ,
    o.prototype._resetFightPositionLayer = function(e) {
        this.background.removeGridLayer(this._fightPositionLayer),
        this._fightPositionLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype._resetSpellRangeLayer = function(e) {
        this.background.removeGridLayer(this._spellRangeLayer),
        this._spellRangeLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype._resetSpellEffectLayer = function(e) {
        this.background.removeGridLayer(this._spellEffectLayer),
        this._spellEffectLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype._resetWalkLayer = function(e) {
        this.background.removeGridLayer(this._walkLayer),
        this._walkLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype._resetWalkAreaLayer = function(e) {
        this.background.removeGridLayer(this._walkAreaLayer),
        this._walkAreaLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype._resetEnemyWalkAreaLayer = function(e) {
        this.background.removeGridLayer(this._enemyWalkAreaLayer),
        this._enemyWalkAreaLayer = e ? this.background.addGridAnimation(e) : null
    }
    ,
    o.prototype.clearUserMovementZone = o.prototype._resetWalkAreaLayer,
    o.prototype.setCurrentSpell = function(e) {
        p = e
    }
    ,
    o.prototype.displaySpellRange = function() {
        if (this.mapRenderer.map && this.mapRenderer.map.cells && p && !this.actorManager.userActor.isDead) {
            this.clearUserMovementZone();
            for (var e = this.mapRenderer.map.cells, t = this.actorManager.userActor.cellId, i = s.getSpellRange(e, t, p), o = window.actorManager.getIndexedVisibleActors(), a = {}, l = {}, c = window.foreground.fightIsUserTurn ? h.outSight : h.outSightEnemyTurn, d = window.foreground.fightIsUserTurn ? h.inSight : h.inSightEnemyTurn, f = 0; f < i.length; f++) {
                var g = r.getCellIdFromMapPoint(i[f][0], i[f][1]);
                if (void 0 !== g && !a[g])
                    if (p.needFreeCell && o[g])
                        l[g] = i[f][2],
                        a[g] = new u(g,i[f][2],c);
                    else {
                        var _ = e[g].l || 0;
                        3 === (7 & _) && (a[g] = new u(g,i[f][2],d),
                        l[g] = i[f][2])
                    }
            }
            p.castTestLos && n(e, a, t, o),
            m = a,
            this._resetSpellRangeLayer(a),
            this._spellEffectLayer && this._resetSpellEffectLayer(this._spellEffectLayer.cellInfos),
            this._walkLayer && (this._resetWalkLayer(),
            window.foreground.confirmBox.hide())
        }
    }
    ,
    e.exports.getCell = n,
    o.prototype.displayEffectZone = function(e) {
        if (this.background.removeTargetHighlights(),
        m && p) {
            if (!m.hasOwnProperty(e))
                return void this._resetSpellEffectLayer();
            if (m[e].transformState === h.outSight || m[e].transformState === h.outSightEnemyTurn)
                return void this._resetSpellEffectLayer();
            if (this.mapRenderer.map && this.mapRenderer.map.cells) {
                for (var t = this.actorManager.userActor.cellId, i = this.mapRenderer.map.cells, n = s.getSpellEffectZone(i, t, e, p.zoneEffect), o = this.actorManager.occupiedCells, a = Object.keys(n), r = 0; r < a.length; r++)
                    if (t = a[r],
                    o[t]) {
                        var l = o[t][0]
                          , c = l.getFighterData().teamId;
                        0 === c ? this.background.addTargetHighLights(t, o[t][0]._x, o[t][0]._y, h.redTeamStart, h.redTeamEnd, !window.foreground.fightIsUserTurn) : this.background.addTargetHighLights(t, o[t][0]._x, o[t][0]._y, h.blueTeamStart, h.blueTeamEnd, !window.foreground.fightIsUserTurn)
                    }
                this._resetSpellEffectLayer(n)
            }
        }
    }
    ,
    o.prototype._castSpell = function(e, t, i, n) {
        var o = this.mapRenderer.grid.getNearbyCellInZone(e, t, i, m);
        return null === o ? (window.foreground.deselectSpell(),
        window.gui.shortcutBar.deselectIcon(),
        void this.clearSpellDisplay()) : (this.displayEffectZone(o),
        window.gui.emit("checkServerLag", "fightAction", "start"),
        window.dofus.sendMessage("GameActionFightCastRequestMessage", {
            spellId: p.spellId,
            cellId: o
        }),
        window.gui.fightManager.spellCastSucceeded(n.spellId, n.characterId),
        p = null ,
        this.clearSpellDisplay(),
        void window.gui.shortcutBar.deselectIcon())
    }
    ,
    o.prototype._castSpellConfirm = function(e, t, i, n) {
        var o = this.mapRenderer.grid.getNearbyCellInZone(e, t, i, m);
        if (null === o)
            return window.foreground.deselectSpell(),
            void window.gui.shortcutBar.deselectIcon();
        this.displayEffectZone(o);
        var s = a(["spell", p.spellId, e, o])
          , r = this;
        window.foreground.confirmBox.open("spell", p, function(e) {
            return e ? (window.gui.emit("checkServerLag", "fightAction", "start"),
            window.dofus.sendMessage("GameActionFightCastRequestMessage", {
                spellId: p.spellId,
                cellId: o
            }),
            window.gui.fightManager.spellCastSucceeded(n.spellId, n.characterId),
            p = null ,
            r.clearSpellDisplay(),
            void window.gui.shortcutBar.deselectIcon()) : (r.clearSpellDisplay(),
            void window.gui.shortcutBar.deselectIcon())
        }, s, n.hideConfirmWindow)
    }
    ,
    o.prototype._castSpellImmediately = function(e) {
        if (m && p) {
            if (null === e)
                return window.foreground.deselectSpell(),
                void window.gui.shortcutBar.deselectIcon();
            window.gui.emit("checkServerLag", "fightAction", "start"),
            window.dofus.sendMessage("GameActionFightCastRequestMessage", {
                spellId: p.spellId,
                cellId: e
            }),
            window.gui.fightManager.spellCastSucceeded(p.spellId, window.gui.playerData.characters.controlledCharacterId),
            this.clearSpellDisplay(),
            p = null ,
            window.gui.shortcutBar.deselectIcon()
        }
    }
    ,
    o.prototype._castSpellImmediatelyConfirm = function(e) {
        if (m && p) {
            if (null === e)
                return window.foreground.deselectSpell(),
                void window.gui.shortcutBar.deselectIcon();
            var t = a(["spell", p.spellId, e, e])
              , i = this;
            window.foreground.confirmBox.open("spell", p, function(t) {
                return t ? (window.gui.emit("checkServerLag", "fightAction", "start"),
                window.dofus.sendMessage("GameActionFightCastRequestMessage", {
                    spellId: p.spellId,
                    cellId: e
                }),
                window.gui.fightManager.spellCastSucceeded(p.spellId, window.gui.playerData.characters.controlledCharacterId),
                p = null ,
                i.clearSpellDisplay(),
                void window.gui.shortcutBar.deselectIcon()) : (i.clearSpellDisplay(),
                void window.gui.shortcutBar.deselectIcon())
            }, t, !window.foreground.fightIsUserTurn)
        }
    }
    ,
    o.prototype.displayFightPositions = function(e) {
        for (var t = {}, i = 0, n = 0; n < e.positionsForChallengers.length; n++) {
            var o = e.positionsForChallengers[n];
            t[o] = new u(o,i,h.fullRed)
        }
        for (var s = 0; s < e.positionsForDefenders.length; s++)
            o = e.positionsForDefenders[s],
            t[o] = new u(o,i,h.fullBlue);
        this._resetFightPositionLayer(t)
    }
    ,
    o.prototype.clearSpellDisplay = function() {
        this.background.removeTargetHighlights(),
        this._resetSpellEffectLayer(),
        this._resetSpellRangeLayer()
    }
}
, function(e, t) {
    e.exports.getLine = function(e, t, i, n) {
        var o = [];
        e += .5,
        t += .5,
        i += .5,
        n += .5;
        var s = 0
          , a = 0
          , r = 0
          , l = 0;
        Math.abs(e - i) === Math.abs(t - n) ? (r = Math.abs(e - i),
        s = i > e ? 1 : -1,
        a = n > t ? 1 : -1,
        l = 1) : Math.abs(e - i) > Math.abs(t - n) ? (r = Math.abs(e - i),
        s = i > e ? 1 : -1,
        a = (n - t) / r,
        a = 100 * a,
        a = Math.ceil(a) / 100,
        l = 2) : (r = Math.abs(t - n),
        s = (i - e) / r,
        s = 100 * s,
        s = Math.ceil(s) / 100,
        a = n > t ? 1 : -1,
        l = 3);
        for (var c = ~~(3 + r / 2), u = ~~(97 - r / 2), h = 0; h < r; h++) {
            var d, p, m = e + s, f = t + a;
            if (2 === l) {
                var g = Math.ceil(100 * t + 50 * a) / 100
                  , _ = Math.floor(100 * t + 150 * a) / 100
                  , v = Math.floor(Math.abs(100 * Math.floor(g) - 100 * g)) / 100
                  , y = Math.ceil(Math.abs(100 * Math.ceil(_) - 100 * _)) / 100;
                d = Math.floor(m),
                Math.floor(g) === Math.floor(_) ? (p = Math.floor(f),
                (g === p && _ < p || _ === p && g < p) && (p = Math.ceil(f)),
                o.push({
                    x: d,
                    y: p
                })) : Math.ceil(g) === Math.ceil(_) ? (p = Math.ceil(f),
                (g === p && _ < p || _ === p && g < p) && (p = Math.floor(f)),
                o.push({
                    x: d,
                    y: p
                })) : ~~(100 * v) <= c ? o.push({
                    x: d,
                    y: Math.floor(_)
                }) : ~~(100 * y) >= u ? o.push({
                    x: d,
                    y: Math.floor(g)
                }) : (o.push({
                    x: d,
                    y: Math.floor(g)
                }),
                o.push({
                    x: d,
                    y: Math.floor(_)
                }))
            } else if (3 === l) {
                var w = Math.ceil(100 * e + 50 * s) / 100
                  , b = Math.floor(100 * e + 150 * s) / 100
                  , C = Math.floor(Math.abs(100 * Math.floor(w) - 100 * w)) / 100
                  , I = Math.ceil(Math.abs(100 * Math.ceil(b) - 100 * b)) / 100;
                p = Math.floor(f),
                Math.floor(w) === Math.floor(b) ? (d = Math.floor(m),
                (w === d && b < d || b === d && w < d) && (d = Math.ceil(m)),
                o.push({
                    x: d,
                    y: p
                })) : Math.ceil(w) === Math.ceil(b) ? (d = Math.ceil(m),
                (w === d && b < d || b === d && w < d) && (d = Math.floor(m)),
                o.push({
                    x: d,
                    y: p
                })) : ~~(100 * C) <= c ? o.push({
                    x: Math.floor(b),
                    y: p
                }) : ~~(100 * I) >= u ? o.push({
                    x: Math.floor(w),
                    y: p
                }) : (o.push({
                    x: Math.floor(w),
                    y: p
                }),
                o.push({
                    x: Math.floor(b),
                    y: p
                }))
            } else
                o.push({
                    x: Math.floor(m),
                    y: Math.floor(f)
                });
            e = (100 * e + 100 * s) / 100,
            t = (100 * t + 100 * a) / 100
        }
        return o
    }
}
, function(e, t, i) {
    function n(e, t) {
        return "fight:" + e + ":" + t
    }
    function o(e) {
        _[e] && (console.warn("Fight with id " + e + " already exist."),
        _[e].remove()),
        this.id = e,
        this.teams = {},
        _[e] = this
    }
    function s(e, t) {
        switch (e.fightType) {
        case c.FIGHT_TYPE_AGRESSION:
            return O[t.teamSide][~~(t.teamTypeId === h.TEAM_TYPE_BAD_PLAYER)];
        case c.FIGHT_TYPE_Koh:
            var i, n = null , o = null , s = null ;
            switch ("FightTeamMemberWithAllianceCharacterInformations" === t.teamMembers[0]._type && (n = t.teamMembers[0].allianceInfos.allianceId),
            !0) {
            case null !== o && o === n:
                i = 0;
                break;
            case null !== s && n === s:
                i = 1;
                break;
            default:
                i = 2
            }
            return P[t.teamId][i];
        case c.FIGHT_TYPE_CHALLENGE:
            return v;
        case c.FIGHT_TYPE_PvT:
            return t.teamId === u.TEAM_CHALLENGER ? v : w;
        default:
            return t.teamId === u.TEAM_CHALLENGER ? v : y
        }
    }
    var a = i(1014)
      , r = i(6)
      , l = i(217)
      , c = i(502)
      , u = i(213)
      , h = i(730)
      , d = i(85)
      , p = i(253)
      , m = i(619)
      , f = l.FIGHT_OPTION_KEY_TO_ENUM
      , g = l.FIGHT_OPTION_ICON_ID
      , _ = {};
    o.prototype.addTeam = function(e, t) {
        this.teams[e] = {
            id: e,
            contextualId: n(this.id, e),
            icons: {},
            options: {},
            cellId: t
        }
    }
    ,
    o.prototype.remove = function() {
        for (var e in this.teams) {
            var t = this.teams[e];
            window.actorManager.removeActor(t.contextualId);
            for (var i in t.icons)
                t.icons[i].remove()
        }
        delete _[this.id]
    }
    ,
    o.prototype._createIcon = function(e, t, i) {
        function n(i) {
            return _[o.id] ? a.icons[t] ? i.release() : (a.icons[t] = new m({
                layer: r.MAP_LAYER_ICONS,
                w: i.element.width,
                h: i.element.height,
                scene: s
            },i),
            a.options[t] || a.icons[t].hide(),
            void o._updateIconsPosition(e)) : i.release()
        }
        var o = this
          , s = window.isoEngine.mapScene
          , a = this.teams[e];
        return a ? g.indexOf(t) === -1 ? console.error(new Error("Unknown fightOption:" + t)) : a.icons[t] ? (console.warn("Icon " + t + " already exists for team " + e + " in fight " + this.id),
        void a.icons[t].show()) : void p.loadTexture(i, n, s.renderer) : console.error(new Error("No team with id " + e + " in fight " + this.id))
    }
    ,
    o.prototype._updateIconsPosition = function(e) {
        var t = this.teams[e];
        if (!t)
            return console.error(new Error("No team with id " + e + " in fight " + this.id));
        var i = 0
          , n = 0;
        for (var o in t.icons)
            t.icons[o].isDisplayed && i++,
            n = Math.max(t.icons[o].w, n);
        var s = .1 * n
          , a = window.isoEngine.mapRenderer.grid.getSceneCoordinateFromCellId(t.cellId)
          , l = a.x - (n + s) / 2 * (i - 1)
          , c = 0;
        for (o in t.icons)
            t.icons[o].isDisplayed && (t.icons[o].x = l + c * (n + s) - t.icons[o].w / 2,
            t.icons[o].y = a.y - 2.1 * r.CELL_HEIGHT,
            c++)
    }
    ,
    o.prototype.setFightOption = function(e, t, i) {
        var n = this.teams[e];
        if (!n)
            return console.error(new Error("No team with id " + e + " in fight " + this.id));
        if (void 0 === n.options[t])
            return n.options[t] = i,
            void this._createIcon(e, t, "ui/spectator/fightOption" + t + ".png");
        if (n.options[t] = i,
        n.icons[t]) {
            var o = i ? "show" : "hide";
            n.icons[t][o](),
            this._updateIconsPosition(e)
        }
    }
    ,
    o.prototype.challengeOptionChange = function(e, t, i) {
        var n = this.teams[e];
        return n ? void (g.indexOf(t) !== -1 && this.setFightOption(e, t, i)) : console.error(new Error("No team with id " + e + " in fight " + this.id))
    }
    ;
    var v = 19
      , y = 20
      , w = 21
      , b = 32
      , C = 33
      , I = 1237
      , T = 1235
      , S = 1236
      , A = 2248
      , E = 2249
      , x = 2251
      , M = 2252
      , N = 2253
      , R = 2255
      , O = {
        "-1": [v, v],
        0: [I, I],
        1: [T, b],
        2: [S, C],
        3: [I, I]
    }
      , P = {
        0: [A, x, E],
        1: [M, R, N]
    };
    a.prototype.showChallenge = function(e) {
        for (var t = this.actorManager, i = e.fightId, a = e.fightTeams, r = e.fightTeamsPositions, l = e.fightTeamsOptions, c = new o(i), u = 0; u < a.length; u++) {
            var h = a[u]
              , d = s(e, h);
            h.fightId = i,
            h.look = {
                bonesId: d,
                scales: [100],
                skins: [],
                indexedColors: []
            },
            h.disposition = {
                cellId: r[u],
                direction: 0
            },
            h.contextualId = n(i, h.teamId),
            t.addEmptyActor(h),
            c.addTeam(h.teamId, r[u]),
            t.setActorLook(h.contextualId, h.look);
            for (var p in l[u])
                void 0 !== f[p] && l[u][p] && c.setFightOption(h.teamId, f[p], !0)
        }
    }
    ,
    a.prototype.addChallenges = function(e) {
        for (var t = 0; t < e.length; t++)
            this.showChallenge(e[t])
    }
    ,
    a.prototype.removeChallenge = function(e) {
        var t = _[e];
        return t ? void t.remove() : console.warn("No challenge with id " + e)
    }
    ,
    a.prototype.cleanupChallenges = function() {
        for (var e in _)
            _[e].remove()
    }
    ,
    a.prototype.challengeOptionChange = function(e, t, i, n) {
        var o = _[e];
        return o ? void o.challengeOptionChange(t, i, n) : console.warn("No challenge with id " + e)
    }
    ,
    a.prototype.updateFightTeam = function(e) {
        if (this.gameContext !== d.FIGHT) {
            var t = e.fightId
              , i = e.team;
            i.fightId = t;
            var o = i.teamId
              , s = n(t, o)
              , a = this.actorManager.getActor(s);
            return a ? void a.updateData(i) : console.warn("No fight id " + s)
        }
    }
}
, function(e, t, i) {
    var n = i(1014)
      , o = i(12)
      , s = i(1035)
      , a = i(1041)
      , r = i(84).playUiSound
      , l = i(6)
      , c = i(1029)
      , u = i(1044)
      , h = i(261)
      , d = h.Tween
      , p = h.easing;
    n.prototype.playEmote = function(e) {
        if (!this.actorManager.isCreatureModeOn) {
            var t = this.actorManager.getActor(e.actorId);
            if (t) {
                if (0 === e.emoteId)
                    return void t.staticAnim();
                var i = e._emote;
                if (i) {
                    var n = i.defaultAnim;
                    if (n = n.substring(0, 1).toUpperCase() + n.substring(1) + "_0",
                    !i.eight_directions) {
                        var o = 2 * ~~(t.direction / 2) + 1;
                        o !== t.direction && t.setDisposition(null , o)
                    }
                    t.loadAndPlayAnimation({
                        base: "AnimEmote",
                        type: n
                    }, !1)
                }
            }
        }
    }
    ,
    n.prototype.playLevelUpAnimation = function(e, t) {
        var i = this.actorManager.getActor(e);
        if (i) {
            var n, o = i.look;
            if (o && o.skins && o.skins[0]) {
                var s = o.skins[0];
                n = (1 & s).toString()
            } else
                n = Math.random() < .5 ? "0" : "1";
            var a = "AnimEmoteInterface_" + n;
            i.loadAndPlayAnimation({
                base: a,
                direction: 1
            }, !1, t),
            r("LEVEL_UP");
            var h = i.x
              , m = i.y
              , f = "LEVEL UP"
              , g = this.bitmapFonts.characters
              , _ = new u({
                x: h,
                y: m,
                scene: this.mapScene,
                text: f,
                fallbackText: f,
                layer: l.MAP_LAYER_POINT_LABELS,
                bitmapFont: g,
                color: [.3, .5, -.1, 0]
            });
            _.scaleX = .7,
            _.scaleY = .7,
            d(_, ["y", "alpha"]).from({
                y: m,
                alpha: 0
            }).to({
                y: m,
                alpha: 0
            }, 9).to({
                y: m - 40,
                alpha: 1
            }, 8, p.backOut, 2).to({
                y: m - 40,
                alpha: 1
            }, 16).to({
                y: m - 90,
                alpha: 0
            }, 12, p.backIn, 2).onFinish(function() {
                _.remove()
            }).start();
            var v = new c(i.position,h,m);
            v.red = 1,
            v.green = 1,
            v.blue = .9,
            d(v, ["scaleX", "scaleY", "alpha"]).from({
                scaleX: .3,
                scaleY: .3,
                alpha: 0
            }).to({
                scaleX: 1,
                scaleY: 1,
                alpha: 1.7
            }, 7, p.polyOut, 4).to({
                scaleX: .3,
                scaleY: 1,
                alpha: 1.7
            }, 20, p.polyOut, 2).to({
                scaleX: .3,
                scaleY: 1,
                alpha: 0
            }, 7, p.polyOut, 2).onFinish(function() {
                v.remove()
            }).start()
        }
    }
    ,
    n.prototype.playRoleplaySpellAnim = function(e) {
        s([e], function() {
            var t = [];
            a(e, t),
            o.series(t)
        })
    }
}
, function(e, t, i) {
    var n = i(1014)
      , o = 14
      , s = 40;
    n.prototype._logMap = function(e) {
        e = e || [];
        for (var t = {}, i = 0; i < e.length; i++)
            t[e[i]] = !0;
        var n, a, r, l, c = this.mapRenderer.map, u = this.actorManager.occupiedCells, h = this.actorManager.userActor, d = "", p = [];
        for (n = 0; n < o; n++)
            d += "   ";
        var m = !0;
        for (a = 0; a < s; a++) {
            for (d += "\n",
            d += m ? "" : "",
            n = 0; n < o; n++)
                r = a * o + n,
                l = r < 100 ? " " : "",
                l += r,
                l += r < 10 ? " " : "",
                d += m ? "%c" + l + "%c" : "%c" + l + "%c",
                t[r] ? p.push("background-color: #FF0") : c && 2 !== (2 & c.cells[r].l) ? p.push("background-color: #00F") : c && 0 === (1 & c.cells[r].l) ? p.push("background-color: #113; color: #779") : h.cellId === r ? p.push("background-color: #CD8; color: #072") : u[r] ? p.push("background-color: #F88") : p.push("background-color: #FFF"),
                p.push("background-color: #FFF, color: #000");
            m = !m
        }
        for (d += "\n ",
        n = 0; n < o; n++)
            d += "   ";
        p.unshift(d),
        console.log.apply(window.console, p)
    }
}
, function(e, t, i) {
    function n(e) {
        this.progressEgg = new d({
            scene: e,
            position: 5,
            alpha: 1,
            x: e.w / 2,
            y: e.h / 2,
            isHudElement: !0,
            id: "loadingProgressEgg"
        }),
        this.progressEgg.setAnimManager(new p(this.progressEgg,new m(""),1.7,0)),
        this.progressEggFrameTween = new c(this.progressEgg.animManager,["frame"]),
        this.hide()
    }
    var o = i(6)
      , s = i(1014)
      , a = i(625)
      , r = i(5)
      , l = i(250)
      , c = i(261).Tween
      , u = i(261).easing
      , h = i(619)
      , d = i(1019)
      , p = i(260)
      , m = i(259)
      , f = i(49)
      , g = 1200
      , _ = 100
      , v = 20;
    n.prototype.loadAssets = function(e) {
        var t = this.progressEgg.animManager
          , i = this.progressEgg.renderer;
        l.loadTemplate("loader", "loadingLogo", "", function(i) {
            t.template = i,
            t.assignSymbol({
                base: "loadeur",
                direction: -1
            }, !1),
            t.tween.stop(),
            t.frame = 0,
            e()
        }, i, "archivable")
    }
    ,
    n.prototype.hide = function() {
        this.progressEgg.hide(),
        this.progressEgg.animManager.clear()
    }
    ,
    n.prototype.show = function() {
        this.progressEgg.show()
    }
    ,
    s.prototype._initLoadingProgress = function() {
        this._loadingProgress = new n(this.mapScene),
        this._resetTransition()
    }
    ,
    s.prototype._resetTransition = function() {
        this._loadingFadeInTransitionRunning = !1,
        this._loadingProgressVisible = !1,
        this._waitingForMessage = !1,
        this._mapLoadingMessage = null ,
        this._isMapLoading = !1,
        this._mapSceneTransitionGraphic = null
    }
    ,
    s.prototype.showLoadingProgress = function(e) {
        var t = this._loadingProgress.progressEgg
          , i = t.animManager.nbFrames;
        this._loadingProgressVisible === !1 ? (this._loadingProgressVisible = !0,
        t.x = this.mapScene.w / 2,
        t.y = this.mapScene.h / 2,
        this._loadingProgress.show(),
        this._loadingProgress.progressEggFrameTween.reset().from({
            frame: 0
        }).to({
            frame: .4 * i
        }, 30, u.polyIn, 2).start()) : this._loadingProgress.progressEggFrameTween.reset().from({
            frame: t.animManager.frame
        }).to({
            frame: (.7 * e + .4) * i
        }, 5).start()
    }
    ,
    s.prototype._hideLoadingProgress = function() {
        this._loadingProgressVisible = !1,
        this._loadingProgress.hide()
    }
    ,
    s.prototype.mapTransitionDisconnect = function() {
        this._mapSceneTransitionGraphic && (this._mapSceneTransitionGraphic.remove(),
        this._resetTransition())
    }
    ,
    s.prototype._makeUserActorWalkInDirection = function(e, t) {
        this.makeActorWalkInDirection(this.actorManager.userActor, e, t)
    }
    ,
    s.prototype.makeActorWalkInDirection = function(e, t, i, n) {
        if (!e)
            return console.error(new Error("makeActorWalkInDirection: actor is " + e)),
            void (n && n());
        var s;
        switch (t) {
        case "top":
            s = 6;
            break;
        case "bottom":
            s = 2;
            break;
        case "left":
            s = 4;
            break;
        case "right":
            s = 0;
            break;
        default:
            s = 0
        }
        var a = o.ANGLE_PER_DIRECTION[s];
        i && (a += Math.PI);
        var r = Math.cos(a) * _
          , l = Math.sin(a) * _;
        e.walkToSceneCoordinate(e.x + r, e.y + l, s, v, n)
    }
    ,
    s.prototype.launchMapTransition = function(e) {
        var t = this;
        this._loadingProgress.loadAssets(function() {
            t.mapScene.setShader("mapTransition"),
            t.emit("launchMapTransition", e),
            t._activateMapScene() ? (t._loadingProgress.progressEgg.alpha = 1,
            t.mapScene.renderingParams.ratio = 1,
            t._saveImageForTransition("black"),
            t._startLoading()) : t._loadingFadeInTransitionRunning === !1 && (t._isMapLoading ? t._startLoading() : (e && t._makeUserActorWalkInDirection(e, !1),
            t._runLoadingFadeInTransition()))
        })
    }
    ,
    s.prototype.cancelMapTransition = function(e) {
        this.emit("cancelMapTransition", e),
        this.actorManager.userActor.setOnScreenPosition(this.actorManager.userActor.position),
        this._makeUserActorWalkInDirection(e, !0),
        this._waitingForMessage && this._runLoadingFadeOutTransition(),
        this._mapLoadingMessage = null ,
        this._waitingForMessage = !1
    }
    ,
    s.prototype._saveImageForTransition = function(e) {
        var t = g
          , i = t * this.mapScene.h / this.mapScene.w
          , n = this.mapScene.renderer
          , o = n.startTextureUsage(t, i, 1, null , "linear");
        if (n.startTextureRendering(o, 0, t, 0, i, !1),
        "black" === e)
            this.mapScene.clear(0, 0, 0, 1);
        else {
            var s = t / this.mapScene.w;
            n.save(),
            n.scale(s, s),
            this.mapScene.render(),
            n.restore()
        }
        var a = !0;
        n.stopTextureRendering(a),
        null === this._mapSceneTransitionGraphic ? this._mapSceneTransitionGraphic = new h({
            w: this.mapScene.w,
            h: this.mapScene.h,
            scene: this.mapScene,
            position: 0,
            isHudElement: !0,
            alpha: 1
        },o.texture) : (this._mapSceneTransitionGraphic.clear(),
        this._mapSceneTransitionGraphic.texture = o.texture,
        this._mapSceneTransitionGraphic.show())
    }
    ,
    s.prototype._runLoadingFadeInTransition = function() {
        this._loadingFadeInTransitionRunning = !0,
        this._waitingForMessage = !0,
        this.showLoadingProgress(0),
        c(this._loadingProgress.progressEgg, ["alpha", "scaleX", "scaleY"]).from({
            alpha: 0,
            scaleX: .8,
            scaleY: .8
        }).to({
            alpha: 1,
            scaleX: 1,
            scaleY: 1
        }, 15, u.backOut, 1.5).start(),
        this.mapScene.renderingParams.ratio = 0;
        var e = this;
        c(this.mapScene.renderingParams, ["ratio"]).from({
            ratio: 0
        }).to({
            ratio: 1
        }, 15, u.polyInOut, 3).start().onFinish(function() {
            e._saveImageForTransition("current"),
            e._loadingFadeInTransitionRunning = !1,
            e._startLoading()
        })
    }
    ,
    s.prototype._runLoadingFadeOutTransition = function() {
        var e = this
          , t = this.mapScene;
        c(this._loadingProgress.progressEgg, ["alpha", "scaleX", "scaleY"]).from({
            alpha: 1,
            scaleX: 1,
            scaleY: 1
        }).to({
            alpha: 0,
            scaleX: .8,
            scaleY: .8
        }, 10, u.backIn, 1.5).start(),
        c(this._mapSceneTransitionGraphic, ["alpha"]).from({
            alpha: 1
        }).to({
            alpha: 0
        }, 10).onFinish(function() {
            null !== e._mapSceneTransitionGraphic && (e._mapSceneTransitionGraphic.remove(),
            e._mapSceneTransitionGraphic = null )
        }).start(),
        c(t.renderingParams, ["ratio"]).from({
            ratio: 1
        }).to({
            ratio: 0
        }, 25, u.polyInOut, 2).onFinish(function() {
            t.setShader("unfiltering"),
            t.renderingParams.ratio = .15,
            e._hideLoadingProgress()
        }).start(),
        this.makeActorWalkIn(this.actorManager.userActor)
    }
    ,
    s.prototype.makeActorWalkIn = function(e, t, i) {
        t = t || 100;
        var n, s = this.mapScene, a = e.x, r = e.y, l = Math.abs(s.l - a), c = Math.abs(s.l + s.w - a), u = Math.abs(s.t - r), h = Math.abs(s.t + s.h - r), d = l < t, p = c < t, m = u < t, f = h < t;
        if (d)
            n = m ? 1 : f ? 7 : 0;
        else if (p)
            n = m ? 3 : f ? 5 : 4;
        else if (m)
            n = 2;
        else {
            if (!f)
                return;
            n = 6
        }
        var g = o.ANGLE_PER_DIRECTION[n];
        e.x -= Math.cos(g) * _,
        e.y -= Math.sin(g) * _,
        e.walkToSceneCoordinate(a, r, n, v, i)
    }
    ,
    s.prototype.loadMap = function(e) {
        this.changeMapTimeout ? (window.clearTimeout(this.changeMapTimeout),
        this.changeMapTimeout = null ) : window.foreground.lock("loadMap"),
        this._mapLoadingMessage = e,
        this._loadingFadeInTransitionRunning === !1 && (this._waitingForMessage ? this._startLoading() : this.launchMapTransition())
    }
    ,
    s.prototype.reloadMap = function(e) {
        if (!this.mapRenderer.isReady) {
            var t = this;
            return void this.mapRenderer.once("ready", function() {
                t.reloadMap(e)
            })
        }
        this._updateMapInfoData(e, {
            noMovementWaitReset: !0
        }),
        window.foreground.show(),
        window.foreground.unlock("loadMap"),
        this.actorManager.updateMapInfoData(e),
        this.emit("mapLoaded", {
            isReload: !0
        }),
        this.interactiveBlink && this.highlightInteractivesWithDifferentType()
    }
    ;
    var y = null
      , w = null ;
    s.prototype._startLoading = function() {
        var e = this._mapLoadingMessage;
        if (null !== e) {
            this._mapLoadingMessage = null ,
            this._waitingForMessage = !1,
            this.actorManager.pause();
            var t = e.mapId;
            if (t !== w) {
                this.releaseMap(w),
                w = t,
                this._isMapLoading = !0;
                var i = this
                  , n = o.MAP_PATH + t + ".json";
                r.loadJson(n, function(t) {
                    return t === o.EMPTY_JSON ? window.dofus.disconnect("ASSET_MISSING") : void (t.id === w && (null === y ? (y = {
                        msg: e,
                        mapData: t
                    },
                    i._loadMapAssets()) : y = {
                        msg: e,
                        mapData: t
                    }))
                })
            }
        }
    }
    ,
    s.prototype._loadMapAssets = function() {
        var e = y.msg
          , t = y.mapData
          , i = this;
        this.mapRenderer.setMap(y, function() {
            return null !== y && w !== t.id ? void i._loadMapAssets() : (window.foreground.show(),
            window.foreground.unlock("loadMap"),
            a.fillPathGrid(t),
            i._updateMapInfoData(e),
            i.actorManager.updateMapInfoData(e),
            i.actorManager.unpause(),
            i.actorManager.userActor.moving = !1,
            f.unlockMessages(),
            i.emit("mapLoaded"),
            i._runLoadingFadeOutTransition(),
            i.interactiveBlink && i.highlightInteractivesWithDifferentType(),
            w = null ,
            y = null ,
            void (i._isMapLoading = !1))
        })
    }
}
]);
//# sourceMappingURL=script.js.map
